Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};;(function(){var $D=Date,$P=$D.prototype,p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$P.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};$P.setTimeToNow=function(){var n=new Date();this.setHours(n.getHours());this.setMinutes(n.getMinutes());this.setSeconds(n.getSeconds());this.setMilliseconds(n.getMilliseconds());return this;};$D.today=function(){return new Date().clearTime();};$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2)){throw new Error(date1+" - "+date2);}else if(date1 instanceof Date&&date2 instanceof Date){return(date1<date2)?-1:(date1>date2)?1:0;}else{throw new TypeError(date1+" - "+date2);}};$D.equals=function(date1,date2){return(date1.compareTo(date2)===0);};$D.getDayNumberFromName=function(name){var n=$D.CultureInfo.dayNames,m=$D.CultureInfo.abbreviatedDayNames,o=$D.CultureInfo.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s){return i;}}
return-1;};$D.getMonthNumberFromName=function(name){var n=$D.CultureInfo.monthNames,m=$D.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++){if(n[i].toLowerCase()==s||m[i].toLowerCase()==s){return i;}}
return-1;};$D.isLeapYear=function(year){return((year%4===0&&year%100!==0)||year%400===0);};$D.getDaysInMonth=function(year,month){return[31,($D.isLeapYear(year)?29:28),31,30,31,30,31,31,30,31,30,31][month];};$D.getTimezoneAbbreviation=function(offset){var z=$D.CultureInfo.timezones,p;for(var i=0;i<z.length;i++){if(z[i].offset===offset){return z[i].name;}}
return null;};$D.getTimezoneOffset=function(name){var z=$D.CultureInfo.timezones,p;for(var i=0;i<z.length;i++){if(z[i].name===name.toUpperCase()){return z[i].offset;}}
return null;};$P.clone=function(){return new Date(this.getTime());};$P.compareTo=function(date){return Date.compare(this,date);};$P.equals=function(date){return Date.equals(this,date||new Date());};$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime();};$P.isAfter=function(date){return this.compareTo(date||new Date())===1;};$P.isBefore=function(date){return(this.compareTo(date||new Date())===-1);};$P.isToday=$P.isSameDay=function(date){return this.clone().clearTime().equals((date||new Date()).clone().clearTime());};$P.addMilliseconds=function(value){this.setMilliseconds(this.getMilliseconds()+value*1);return this;};$P.addSeconds=function(value){return this.addMilliseconds(value*1000);};$P.addMinutes=function(value){return this.addMilliseconds(value*60000);};$P.addHours=function(value){return this.addMilliseconds(value*3600000);};$P.addDays=function(value){this.setDate(this.getDate()+value*1);return this;};$P.addWeeks=function(value){return this.addDays(value*7);};$P.addMonths=function(value){var n=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+value*1);this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};$P.addYears=function(value){return this.addMonths(value*12);};$P.add=function(config){if(typeof config=="number"){this._orient=config;return this;}
var x=config;if(x.milliseconds){this.addMilliseconds(x.milliseconds);}
if(x.seconds){this.addSeconds(x.seconds);}
if(x.minutes){this.addMinutes(x.minutes);}
if(x.hours){this.addHours(x.hours);}
if(x.weeks){this.addWeeks(x.weeks);}
if(x.months){this.addMonths(x.months);}
if(x.years){this.addYears(x.years);}
if(x.days){this.addDays(x.days);}
return this;};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;$y=(!$y)?this.getFullYear():$y;$m=(!$m)?this.getMonth()+1:$m;$d=(!$d)?this.getDate():$d;if($m<=2){a=$y-1;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=0;f=$d-1+(31*($m-1));}else{a=$y;b=(a/4|0)-(a/100|0)+(a/400|0);c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0);s=b-c;e=s+1;f=$d+((153*($m-3)+2)/5)+58+s;}
g=(a+b)%7;d=(f+g-e)%7;n=(f+3-d)|0;if(n<0){w=53-((g-s)/5|0);}else if(n>364+s){w=1;}else{w=(n/7|0)+1;}
$y=$m=$d=null;return w;};$P.getISOWeek=function(){$y=this.getUTCFullYear();$m=this.getUTCMonth()+1;$d=this.getUTCDate();return p(this.getWeek());};$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek());};var validate=function(n,min,max,name){if(typeof n=="undefined"){return false;}else if(typeof n!="number"){throw new TypeError(n+" is not a Number.");}else if(n<min||n>max){throw new RangeError(n+" is not a valid value for "+name+".");}
return true;};$D.validateMillisecond=function(value){return validate(value,0,999,"millisecond");};$D.validateSecond=function(value){return validate(value,0,59,"second");};$D.validateMinute=function(value){return validate(value,0,59,"minute");};$D.validateHour=function(value){return validate(value,0,23,"hour");};$D.validateDay=function(value,year,month){return validate(value,1,$D.getDaysInMonth(year,month),"day");};$D.validateMonth=function(value){return validate(value,0,11,"month");};$D.validateYear=function(value){return validate(value,0,9999,"year");};$P.set=function(config){if($D.validateMillisecond(config.millisecond)){this.addMilliseconds(config.millisecond-this.getMilliseconds());}
if($D.validateSecond(config.second)){this.addSeconds(config.second-this.getSeconds());}
if($D.validateMinute(config.minute)){this.addMinutes(config.minute-this.getMinutes());}
if($D.validateHour(config.hour)){this.addHours(config.hour-this.getHours());}
if($D.validateMonth(config.month)){this.addMonths(config.month-this.getMonth());}
if($D.validateYear(config.year)){this.addYears(config.year-this.getFullYear());}
if($D.validateDay(config.day,this.getFullYear(),this.getMonth())){this.addDays(config.day-this.getDate());}
if(config.timezone){this.setTimezone(config.timezone);}
if(config.timezoneOffset){this.setTimezoneOffset(config.timezoneOffset);}
if(config.week&&validate(config.week,0,53,"week")){this.setWeek(config.week);}
return this;};$P.moveToFirstDayOfMonth=function(){return this.set({day:1});};$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())});};$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0){shift=occurrence-1;}
else if(occurrence===-1){this.moveToLastDayOfMonth();if(this.getDay()!==dayOfWeek){this.moveToDayOfWeek(dayOfWeek,-1);}
return this;}
return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,+1).addWeeks(shift);};$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||+1))%7;return this.addDays((diff===0)?diff+=7*(orient||+1):diff);};$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||+1))%12;return this.addMonths((diff===0)?diff+=12*(orient||+1):diff);};$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset());};$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here);};$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset));};$P.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};$P.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!=this.getTimezoneOffset();};$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;if(n<0){r=(n-10000).toString();return r.charAt(0)+r.substr(2);}else{r=(n+10000).toString();return"+"+r.substr(1);}};$P.getElapsed=function(date){return(date||new Date())-this;};if(!$P.toISOString){$P.toISOString=function(){function f(n){return n<10?'0'+n:n;}
return'"'+this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z"';};}
$P._toString=$P.toString;$P.toString=function(format){var x=this;if(format&&format.length==1){var c=$D.CultureInfo.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth);}}
var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\"){return m.replace("\\","");}
x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?(x.h()===0?12:x.h()):(x.h()-12));case"h":return x.h()<13?(x.h()===0?12:x.h()):(x.h()-12);case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $D.CultureInfo.dayNames[x.getDay()];case"ddd":return $D.CultureInfo.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $D.CultureInfo.monthNames[x.getMonth()];case"MMM":return $D.CultureInfo.abbreviatedMonthNames[x.getMonth()];case"MM":return p((x.getMonth()+1));case"M":return x.getMonth()+1;case"t":return x.h()<12?$D.CultureInfo.amDesignator.substring(0,1):$D.CultureInfo.pmDesignator.substring(0,1);case"tt":return x.h()<12?$D.CultureInfo.amDesignator:$D.CultureInfo.pmDesignator;case"S":return ord(x.getDate());default:return m;}}):this._toString();};}());;(function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'";}};var $P=Date.Parsing;var _=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx){return([mx[0],s.substring(mx[0].length)]);}else{throw new $P.Exception(s);}};},token:function(s){return function(s){return _.rtoken(new RegExp("^\s*"+s+"\s*"))(s);};},stoken:function(s){return _.rtoken(new RegExp("^"+s));},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s);}catch(e){qx.push(rx[0]);s=rx[1];continue;}
break;}
return[qx,s];};},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s);}catch(e){return[rx,s];}
rx.push(r[0]);s=r[1];}
return[rx,s];};},optional:function(p){return function(s){var r=null;try{r=p.call(this,s);}catch(e){return[null,s];}
return[r[0],r[1]];};},not:function(p){return function(s){try{p.call(this,s);}catch(e){return[null,s];}
throw new $P.Exception(s);};},ignore:function(p){return p?function(s){var r=null;r=p.call(this,s);return[null,r[1]];}:null;},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++){rx.push(_.each(px[i],qx));}
return rx;},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=(cache[s]||rule.call(this,s));}catch(e){r=cache[s]=e;}
if(r instanceof $P.Exception){throw r;}else{return r;}};},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){r=null;}
if(r){return r;}}
throw new $P.Exception(s);};},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null){continue;}
try{r=(px[i].call(this,s));}catch(e){throw new $P.Exception(s);}
rx.push(r[0]);s=r[1];}
return[rx,s];};},all:function(){var px=arguments,_=_;return _.each(_.optional(px));},sequence:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;if(px.length==1){return px[0];}
return function(s){var r=null,q=null;var rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s);}catch(e){break;}
rx.push(r[0]);try{q=d.call(this,r[1]);}catch(ex){q=null;break;}
s=q[1];}
if(!r){throw new $P.Exception(s);}
if(q){throw new $P.Exception(q[1]);}
if(c){try{r=c.call(this,r[1]);}catch(ey){throw new $P.Exception(r[1]);}}
return[rx,(r?r[1]:s)];};},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]];};},list:function(p,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return(p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c)));},set:function(px,d,c){d=d||_.rtoken(/^\s*/);c=c||null;return function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=false;for(var i=0;i<px.length;i++){q=null;p=null;r=null;last=(px.length==1);try{r=px[i].call(this,s);}catch(e){continue;}
rx=[[r[0]],r[1]];if(r[1].length>0&&!last){try{q=d.call(this,r[1]);}catch(ex){last=true;}}else{last=true;}
if(!last&&q[1].length===0){last=true;}
if(!last){var qx=[];for(var j=0;j<px.length;j++){if(i!=j){qx.push(px[j]);}}
p=_.set(qx,d).call(this,q[1]);if(p[0].length>0){rx[0]=rx[0].concat(p[0]);rx[1]=p[1];}}
if(rx[1].length<best[1].length){best=rx;}
if(best[1].length===0){break;}}
if(best[0].length===0){return best;}
if(c){try{q=c.call(this,best[1]);}catch(ey){throw new $P.Exception(best[1]);}
best[1]=q[1];}
return best;};},forward:function(gr,fname){return function(s){return gr[fname].call(this,s);};},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]];};},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]];};},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min){throw new $P.Exception(s);}
return rx;};}};var _generator=function(op){return function(){var args=null,rx=[];if(arguments.length>1){args=Array.prototype.slice.call(arguments);}else if(arguments[0]instanceof Array){args=arguments[0];}
if(args){for(var i=0,px=args.shift();i<px.length;i++){args.unshift(px[i]);rx.push(op.apply(null,args));args.shift();return rx;}}else{return op.apply(null,arguments);}};};var gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++){_[gx[i]]=_generator(_[gx[i]]);}
var _vector=function(op){return function(){if(arguments[0]instanceof Array){return op.apply(null,arguments[0]);}else{return op.apply(null,arguments);}};};var vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++){_[vx[j]]=_vector(_[vx[j]]);}}());(function(){var $D=Date,$P=$D.prototype;var flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++){if(ax[i]instanceof Array){rx=rx.concat(flattenAndCompact(ax[i]));}else{if(ax[i]){rx.push(ax[i]);}}}
return rx;};$D.Grammar={};$D.Translator={hour:function(s){return function(){this.hour=Number(s);};},minute:function(s){return function(){this.minute=Number(s);};},second:function(s){return function(){this.second=Number(s);};},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase();};},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");if(n.length){this.timezoneOffset=Number(n);}else{this.timezone=s.toLowerCase();}};},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0]);};},month:function(s){return function(){this.month=(s.length==3)?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1;};},year:function(s){return function(){var n=Number(s);this.year=((s.length>2)?n:(n+(((n+2000)<$D.CultureInfo.twoDigitYearMax)?2000:1900)));};},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0;this.now=true;break;}};},finishExact:function(x){x=(x instanceof Array)?x:[x];for(var i=0;i<x.length;i++){if(x[i]){x[i].call(this);}}
var now=new Date();if((this.hour||this.minute)&&(!this.month&&!this.year&&!this.day)){this.day=now.getDate();}
if(!this.year){this.year=now.getFullYear();}
if(!this.month&&this.month!==0){this.month=now.getMonth();}
if(!this.day){this.day=1;}
if(!this.hour){this.hour=0;}
if(!this.minute){this.minute=0;}
if(!this.second){this.second=0;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.day>$D.getDaysInMonth(this.year,this.month)){throw new RangeError(this.day+" is not a valid value for days.");}
var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);if(this.timezone){r.set({timezone:this.timezone});}else if(this.timezoneOffset){r.set({timezoneOffset:this.timezoneOffset});}
return r;},finish:function(x){x=(x instanceof Array)?flattenAndCompact(x):[x];if(x.length===0){return null;}
for(var i=0;i<x.length;i++){if(typeof x[i]=="function"){x[i].call(this);}}
var today=$D.today();if(this.now&&!this.unit&&!this.operator){return new Date();}else if(this.now){today=new Date();}
var expression=!!(this.days&&this.days!==null||this.orient||this.operator);var gap,mod,orient;orient=((this.orient=="past"||this.operator=="subtract")?-1:1);if(!this.now&&"hour minute second".indexOf(this.unit)!=-1){today.setTimeToNow();}
if(this.month||this.month===0){if("year day hour minute second".indexOf(this.unit)!=-1){this.value=this.month+1;this.month=null;expression=true;}}
if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(!this.month){this.month=temp.getMonth();}
this.year=temp.getFullYear();}
if(expression&&this.weekday&&this.unit!="month"){this.unit="day";gap=($D.getDayNumberFromName(this.weekday)-today.getDay());mod=7;this.days=gap?((gap+(orient*mod))%mod):(orient*mod);}
if(this.month&&this.unit=="day"&&this.operator){this.value=(this.month+1);this.month=null;}
if(this.value!=null&&this.month!=null&&this.year!=null){this.day=this.value*1;}
if(this.month&&!this.day&&this.value){today.set({day:this.value*1});if(!expression){this.day=this.value*1;}}
if(!this.month&&this.value&&this.unit=="month"&&!this.now){this.month=this.value;expression=true;}
if(expression&&(this.month||this.month===0)&&this.unit!="year"){this.unit="month";gap=(this.month-today.getMonth());mod=12;this.months=gap?((gap+(orient*mod))%mod):(orient*mod);this.month=null;}
if(!this.unit){this.unit="day";}
if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null){this[this.unit+"s"]=this[this.unit+"s"]+((this.operator=="add")?1:-1)+(this.value||0)*orient;}else if(this[this.unit+"s"]==null||this.operator!=null){if(!this.value){this.value=1;}
this[this.unit+"s"]=this.value*orient;}
if(this.meridian&&this.hour){if(this.meridian=="p"&&this.hour<12){this.hour=this.hour+12;}else if(this.meridian=="a"&&this.hour==12){this.hour=0;}}
if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate();if(temp.getMonth()!==today.getMonth()){this.month=temp.getMonth();}}
if((this.month||this.month===0)&&!this.day){this.day=1;}
if(!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month){return Date.today().setWeek(this.value);}
if(expression&&this.timezone&&this.day&&this.days){this.day=this.days;}
return(expression)?today.add(this):today.set(this);}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/);g.timePartDelimiter=_.stoken(":");g.whiteSpace=_.rtoken(/^\s*/);g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$D.CultureInfo.regexPatterns;var kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++){px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));}
fn=_C[keys]=_.any.apply(null,px);}
return fn;};g.ctoken2=function(key){return _.rtoken($D.CultureInfo.regexPatterns[key]);};g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour));g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour));g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour));g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour));g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute));g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute));g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second));g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second));g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter));g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian));g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian));g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone));g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone));g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz]));g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix);g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day));g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s;};}));g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month));g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month));g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month));g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year));g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year));g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year));g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year));_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")));};g.day=_fn(g.d,g.dd);g.month=_fn(g.M,g.MMM);g.year=_fn(g.yyyy,g.yy);g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s;};});g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s;};});g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday);g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s;};});g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"");};});g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]);_fn=function(){return _.set(arguments,g.datePartDelimiter);};g.mdy=_fn(g.ddd,g.month,g.day,g.year);g.ymd=_fn(g.ddd,g.year,g.month,g.day);g.dmy=_fn(g.ddd,g.day,g.month,g.year);g.date=function(s){return((g[$D.CultureInfo.dateElementOrder]||g.mdy).call(this,s));};g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt]){return g[fmt];}else{throw $D.Parsing.Exception(fmt);}}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s));}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact);});var _F={};var _get=function(f){return _F[f]=(_F[f]||g.format(f)[0]);};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++){rx.push(_get(fx[i]));}
return _.any.apply(null,rx);}else{return _get(fx);}};g._formats=g.formats(["\"yyyy-MM-ddTHH:mm:ssZ\"","yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]);g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish);g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0){return r;}}catch(e){}
return g._start.call({},s);};$D._parse=$D.parse;$D.parse=function(s){var r=null;if(!s){return null;}
if(s instanceof Date){return s;}
try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"));}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s);}catch(e){return null;}
return((r[1].length===0)?r[0]:null);};};$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s);};}());;(function(){var $D=Date,$P=$D.prototype,$N=Number.prototype;$P._orient=+1;$P._nth=null;$P._is=false;$P._same=false;$P._isSecond=false;$N._dateElement="day";$P.next=function(){this._orient=+1;return this;};$D.next=function(){return $D.today().next();};$P.last=$P.prev=$P.previous=function(){this._orient=-1;return this;};$D.last=$D.prev=$D.previous=function(){return $D.today().last();};$P.is=function(){this._is=true;return this;};$P.same=function(){this._same=true;this._isSecond=false;return this;};$P.today=function(){return this.same().day();};$P.weekday=function(){if(this._is){this._is=false;return(!this.is().sat()&&!this.is().sun());}
return false;};$P.at=function(time){return(typeof time==="string")?$D.parse(this.toString("d")+" "+time):this.set(time);};$N.fromNow=$N.after=function(date){var c={};c[this._dateElement]=this;return((!date)?new Date():date.clone()).add(c);};$N.ago=$N.before=function(date){var c={};c[this._dateElement]=this*-1;return((!date)?new Date():date.clone()).add(c);};var dx=("sunday monday tuesday wednesday thursday friday saturday").split(/\s/),mx=("january february march april may june july august september october november december").split(/\s/),px=("Millisecond Second Minute Hour Day Week Month Year").split(/\s/),pxf=("Milliseconds Seconds Minutes Hours Date Week Month FullYear").split(/\s/),nth=("final first second third fourth fifth").split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++){o[px[i].toLowerCase()]=this["get"+pxf[i]]();}
return o;};$D.fromObject=function(config){config.week=null;return Date.today().set(config);};var df=function(n){return function(){if(this._is){this._is=false;return this.getDay()==n;}
if(this._nth!==null){if(this._isSecond){this.addSeconds(this._orient*-1);}
this._isSecond=false;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp){throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");}
return this;}
return this.moveToDayOfWeek(n,this._orient);};};var sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();if(n===0&&$D.CultureInfo.firstDayOfWeek===1&&t.getDay()!==0){shift=shift+7;}
return t.addDays(shift);};};for(var i=0;i<dx.length;i++){$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i;$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i);$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);}
var mf=function(n){return function(){if(this._is){this._is=false;return this.getMonth()===n;}
return this.moveToMonth(n,this._orient);};};var smf=function(n){return function(){return $D.today().set({month:n,day:1});};};for(var j=0;j<mx.length;j++){$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j;$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j);$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);}
var ef=function(j){return function(){if(this._isSecond){this._isSecond=false;return this;}
if(this._same){this._same=this._is=false;var o1=this.toObject(),o2=(arguments[0]||new Date()).toObject(),v="",k=j.toLowerCase();for(var m=(px.length-1);m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v]){return false;}
if(k==v){break;}}
return true;}
if(j.substring(j.length-1)!="s"){j+="s";}
return this["add"+j](this._orient);};};var nf=function(n){return function(){this._dateElement=n;return this;};};for(var k=0;k<px.length;k++){de=px[k].toLowerCase();$P[de]=$P[de+"s"]=ef(px[k]);$N[de]=$N[de+"s"]=nf(de);}
$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){if(this._same){return this._ss(arguments[0]);}
if(dayOfWeek||dayOfWeek===0){return this.moveToNthOccurrence(dayOfWeek,n);}
this._nth=n;if(n===2&&(dayOfWeek===undefined||dayOfWeek===null)){this._isSecond=true;return this.addSeconds(this._orient);}
return this;};};for(var l=0;l<nth.length;l++){$P[nth[l]]=(l===0)?nthfn(-1):nthfn(l);}}());;(function(){var $D=Date,$P=$D.prototype,$f=[],p=function(s,l){if(!l){l=2;}
return("000"+s).slice(l*-1);};$D.normalizeFormat=function(format){$f=[];var t=new Date().$format(format);return $f.join("");};$D.strftime=function(format,time){return new Date(time*1000).$format(format);};$D.strtotime=function(time){var d=$D.parse(time);d.addMinutes(d.getTimezoneOffset()*-1);return Math.round($D.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds())/1000);};$P.$format=function(format){var x=this,y,t=function(v){$f.push(v);return x.toString(v);};return format?format.replace(/(%|\\)?.|%%/g,function(m){if(m.charAt(0)==="\\"||m.substring(0,2)==="%%"){return m.replace("\\","").replace("%%","%");}
switch(m){case"d":case"%d":return t("dd");case"D":case"%a":return t("ddd");case"j":case"%e":return t("d");case"l":case"%A":return t("dddd");case"N":case"%u":return x.getDay()+1;case"S":return t("S");case"w":case"%w":return x.getDay();case"z":return x.getOrdinalNumber();case"%j":return p(x.getOrdinalNumber(),3);case"%U":var d1=x.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),d2=x.clone().addDays(1).moveToDayOfWeek(0,-1);return(d2<d1)?"00":p((d2.getOrdinalNumber()-d1.getOrdinalNumber())/7+1);case"W":case"%V":return x.getISOWeek();case"%W":return p(x.getWeek());case"F":case"%B":return t("MMMM");case"m":case"%m":return t("MM");case"M":case"%b":case"%h":return t("MMM");case"n":return t("M");case"t":return $D.getDaysInMonth(x.getFullYear(),x.getMonth());case"L":return($D.isLeapYear(x.getFullYear()))?1:0;case"o":case"%G":return x.setWeek(x.getISOWeek()).toString("yyyy");case"%g":return x.$format("%G").slice(-2);case"Y":case"%Y":return t("yyyy");case"y":case"%y":return t("yy");case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"g":case"%I":return t("h");case"G":return t("H");case"h":return t("hh");case"H":case"%H":return t("HH");case"i":case"%M":return t("mm");case"s":case"%S":return t("ss");case"u":return p(x.getMilliseconds(),3);case"I":return(x.isDaylightSavingTime())?1:0;case"O":return x.getUTCOffset();case"P":y=x.getUTCOffset();return y.substring(0,y.length-2)+":"+y.substring(y.length-2);case"e":case"T":case"%z":case"%Z":return x.getTimezone();case"Z":return x.getTimezoneOffset()*-60;case"B":var now=new Date();return Math.floor(((now.getHours()*3600)+(now.getMinutes()*60)+now.getSeconds()+(now.getTimezoneOffset()+60)*60)/86.4);case"c":return x.toISOString().replace(/\"/g,"");case"U":return $D.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(x.getFullYear()/100+1);case"%D":return t("MM/dd/yy");case"%n":return"\\n";case"%t":return"\\t";case"%r":return t("hh:mm tt");case"%R":return t("H:mm");case"%T":return t("H:mm:ss");case"%x":return t("d");case"%X":return t("t");default:$f.push(m);return m;}}):this._toString();};if(!$P.format){$P.format=$P.$format;}}());;(function(window,undefined){var
rootjQuery,readyList,document=window.document,location=window.location,navigator=window.navigator,_jQuery=window.jQuery,_$=window.$,core_push=Array.prototype.push,core_slice=Array.prototype.slice,core_indexOf=Array.prototype.indexOf,core_toString=Object.prototype.toString,core_hasOwn=Object.prototype.hasOwnProperty,core_trim=String.prototype.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery);},core_pnum=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,core_rnotwhite=/\S/,core_rspace=/\s+/,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return(letter+"").toUpperCase();},DOMContentLoaded=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready();}else if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready();}},class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this;}
if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}
if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context&&context.nodeType?context.ownerDocument||context:document);selector=jQuery.parseHTML(match[1],doc,true);if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){this.attr.call(selector,context,true);}
return jQuery.merge(this,selector);}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);}
this.length=1;this[0]=elem;}
this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||rootjQuery).find(selector);}else{return this.constructor(context).find(selector);}}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector);}
if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}
return jQuery.makeArray(selector,this);},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length;},toArray:function(){return core_slice.call(this);},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num]);},pushStack:function(elems,name,selector){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector;}else if(name){ret.selector=this.selector+"."+name+"("+selector+")";}
return ret;},each:function(callback,args){return jQuery.each(this,callback,args);},ready:function(fn){jQuery.ready.promise().done(fn);return this;},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1);},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},slice:function(){return this.pushStack(core_slice.apply(this,arguments),"slice",core_slice.call(arguments).join(","));},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},end:function(){return this.prevObject||this.constructor(null);},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(length===i){target=this;--i;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;}
if(!document.body){return setTimeout(jQuery.ready,1);}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready");}},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";},isWindow:function(obj){return obj!=null&&obj==obj.window;},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj);},type:function(obj){return obj==null?String(obj):class2type[core_toString.call(obj)]||"object";},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}
try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;}}catch(e){return false;}
var key;for(key in obj){}
return key===undefined||core_hasOwn.call(obj,key);},isEmptyObject:function(obj){var name;for(name in obj){return false;}
return true;},error:function(msg){throw new Error(msg);},parseHTML:function(data,context,scripts){var parsed;if(!data||typeof data!=="string"){return null;}
if(typeof context==="boolean"){scripts=context;context=0;}
context=context||document;if((parsed=rsingleTag.exec(data))){return[context.createElement(parsed[1])];}
parsed=jQuery.buildFragment([data],context,scripts?null:[]);return jQuery.merge([],(parsed.cacheable?jQuery.clone(parsed.fragment):parsed.fragment).childNodes);},parseJSON:function(data){if(!data||typeof data!=="string"){return null;}
data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data);}
if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))();}
jQuery.error("Invalid JSON: "+data);},parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null;}
try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml");}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data);}}catch(e){xml=undefined;}
if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;},noop:function(){},globalEval:function(data){if(data&&core_rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data);})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();},each:function(obj,callback,args){var name,i=0,length=obj.length,isObj=length===undefined||jQuery.isFunction(obj);if(args){if(isObj){for(name in obj){if(callback.apply(obj[name],args)===false){break;}}}else{for(;i<length;){if(callback.apply(obj[i++],args)===false){break;}}}}else{if(isObj){for(name in obj){if(callback.call(obj[name],name,obj[name])===false){break;}}}else{for(;i<length;){if(callback.call(obj[i],i,obj[i++])===false){break;}}}}
return obj;},trim:core_trim&&!core_trim.call("\uFEFF\xA0")?function(text){return text==null?"":core_trim.call(text);}:function(text){return text==null?"":(text+"").replace(rtrim,"");},makeArray:function(arr,results){var type,ret=results||[];if(arr!=null){type=jQuery.type(arr);if(arr.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(arr)){core_push.call(ret,arr);}else{jQuery.merge(ret,arr);}}
return ret;},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf){return core_indexOf.call(arr,elem,i);}
len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i;}}}
return-1;},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j];}}else{while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i]);}}
return ret;},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value;}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value;}}}
return ret.concat.apply([],ret);},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}
if(!jQuery.isFunction(fn)){return undefined;}
args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context,args.concat(core_slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key==="object"){for(i in key){jQuery.access(elems,fn,i,key[i],1,emptyGet,value);}
chainable=1;}else if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value);if(bulk){if(exec){exec=fn;fn=function(elem,key,value){return exec.call(jQuery(elem),value);};}else{fn.call(elems,value);fn=null;}}
if(fn){for(;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);}}
chainable=1;}
return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet;},now:function(){return(new Date()).getTime();}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready,1);}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false);}else{document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var top=false;try{top=window.frameElement==null&&document.documentElement;}catch(e){}
if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left");}catch(e){return setTimeout(doScrollCheck,50);}
jQuery.ready();}})();}}}
return readyList.promise(obj);};jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});rootjQuery=jQuery(document);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.split(core_rspace),function(_,flag){object[flag]=true;});return object;}
jQuery.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):jQuery.extend({},options);var
memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break;}}
firing=false;if(list){if(stack){if(stack.length){fire(stack.shift());}}else if(memory){list=[];}else{self.disable();}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg);}}else if(arg&&arg.length&&type!=="string"){add(arg);}});})(arguments);if(firing){firingLength=list.length;}else if(memory){firingStart=start;fire(memory);}}
return this;},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--;}
if(index<=firingIndex){firingIndex--;}}}});}
return this;},has:function(fn){return jQuery.inArray(fn,list)>-1;},empty:function(){list=[];return this;},disable:function(){list=stack=memory=undefined;return this;},disabled:function(){return!list;},lock:function(){stack=undefined;if(!memory){self.disable();}
return this;},locked:function(){return!stack;},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args);}else{fire(args);}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!fired;}};return self;};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state;},always:function(){deferred.done(arguments).fail(arguments);return this;},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=fns[i];deferred[tuple[1]](jQuery.isFunction(fn)?function(){var returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify);}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned]);}}:newDefer[action]);});fns=null;}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[i^1][2].disable,tuples[2][2].lock);}
deferred[tuple[0]]=list.fire;deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);}
return deferred;},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values);}else if(!(--remaining)){deferred.resolveWith(contexts,values);}};},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues));}else{--remaining;}}}
if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}
return deferred.promise();}});jQuery.support=(function(){var support,all,a,select,opt,input,fragment,eventName,i,isSupported,clickFn,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];if(!all||!a||!all.length){return{};}
select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];a.style.cssText="top:1px;float:left;opacity:.5";support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.5/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:(document.compatMode==="CSS1Compat"),submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test;}catch(e){support.deleteExpando=false;}
if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",clickFn=function(){support.noCloneEvent=false;});div.cloneNode(true).fireEvent("onclick");div.detachEvent("onclick",clickFn);}
input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);if(div.attachEvent){for(i in{submit:true,change:true,focusin:true}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function");}
support[i+"Bubbles"]=isSupported;}}
jQuery(function(){var container,div,tds,marginDiv,divReset="padding:0;margin:0;border:0;display:block;overflow:hidden;",body=document.getElementsByTagName("body")[0];if(!body){return;}
container=document.createElement("div");container.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";support.boxSizing=(div.offsetWidth===4);support.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==1);if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=document.createElement("div");marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";div.appendChild(marginDiv);support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight);}
if(typeof div.style.zoom!=="undefined"){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=(div.offsetWidth===3);div.style.display="block";div.style.overflow="visible";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=(div.offsetWidth!==3);container.style.zoom=1;}
body.removeChild(container);container=div=tds=marginDiv=null;});fragment.removeChild(div);all=a=select=opt=input=fragment=div=null;return support;})();var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{"embed":true,"object":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000","applet":true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||(!pvt&&!cache[id].data))&&getByName&&data===undefined){return;}
if(!id){if(isNode){elem[internalKey]=id=jQuery.deletedIds.pop()||jQuery.guid++;}else{id=internalKey;}}
if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop;}}
if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);}else{cache[id].data=jQuery.extend(cache[id].data,name);}}
thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};}
thisCache=thisCache.data;}
if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}
if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}
return ret;},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,i,l,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return;}
if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}
for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]];}
if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return;}}}
if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}
if(isNode){jQuery.cleanData([elem],true);}else if(jQuery.support.deleteExpando||cache!=cache.window){delete cache[id];}else{cache[id]=null;}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true);},acceptData:function(elem){var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==true&&elem.getAttribute("classid")===noData;}});jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++){name=attr[i].name;if(!name.indexOf("data-")){name=jQuery.camelCase(name.substring(5));dataAttr(elem,name,data[name]);}}
jQuery._data(elem,"parsedAttrs",true);}}
return data;}
if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);});}
parts=key.split(".",2);parts[1]=parts[1]?"."+parts[1]:"";part=parts[1]+"!";return jQuery.access(this,function(value){if(value===undefined){data=this.triggerHandler("getData"+part,[parts[0]]);if(data===undefined&&elem){data=jQuery.data(elem,key);data=dataAttr(elem,key,data);}
return data===undefined&&parts[1]?this.data(parts[0]):data;}
parts[1]=value;this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts);jQuery.data(this,key,value);self.triggerHandler("changeData"+part,parts);});},null,value,arguments.length>1,null,false);},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}
jQuery.data(elem,key,data);}else{data=undefined;}}
return data;}
function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}
if(name!=="toJSON"){return false;}}
return true;}
jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data));}else{queue.push(data);}}
return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);};if(fn==="inprogress"){fn=queue.shift();startLength--;}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
delete hooks.stop;fn.call(elem,next,hooks);}
if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery.removeData(elem,type+"queue",true);jQuery.removeData(elem,key,true);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--;}
if(arguments.length<setter){return jQuery.queue(this[0],type);}
return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout);};});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);}};if(typeof type!=="string"){obj=type;type=undefined;}
type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}
resolve();return defer.promise(obj);}});var nodeHook,boolHook,fixSpecified,rclass=/[\t\r\n]/g,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea|)$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1);},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name];}catch(e){}});},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className));});}
if(value&&typeof value==="string"){classNames=value.split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value;}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(setClass.indexOf(" "+classNames[c]+" ")<0){setClass+=classNames[c]+" ";}}
elem.className=jQuery.trim(setClass);}}}}
return this;},removeClass:function(value){var removes,className,elem,c,cl,i,l;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className));});}
if((value&&typeof value==="string")||value===undefined){removes=(value||"").split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=removes.length;c<cl;c++){while(className.indexOf(" "+removes[c]+" ")>=0){className=className.replace(" "+removes[c]+" "," ");}}
elem.className=value?jQuery.trim(className):"";}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal);});}
return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(core_rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className);}}else if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className);}
this.className=this.className||value===false?"":jQuery._data(this,"__className__")||"";}});},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true;}}
return false;},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}
return;}
isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1){return;}
if(isFunction){val=value.call(this,i,self.val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text;}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
return values;},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0;});if(!values.length){elem.selectedIndex=-1;}
return values;}}},attrFn:{},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
if(pass&&jQuery.isFunction(jQuery.fn[name])){return jQuery(elem)[name](value);}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}else if(hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{elem.setAttribute(name,value+"");return value;}}else if(hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret;}else{ret=elem.getAttribute(name);return ret===null?undefined:ret;}},removeAttr:function(elem,value){var propName,attrNames,name,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.split(core_rspace);for(;i<attrNames.length;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;isBool=rboolean.test(name);if(!isBool){jQuery.attr(elem,name,"");}
elem.removeAttribute(getSetAttribute?name:propName);if(isBool&&propName in elem){elem[propName]=false;}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed");}else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name);}
return name in elem?elem.value:null;},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name);}
elem.value=value;}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{return(elem[name]=value);}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}else{return elem[name];}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined;}}}});boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined;},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name);}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true;}
elem.setAttribute(name,name.toLowerCase());}
return name;}};if(!getSetAttribute){fixSpecified={name:true,id:true,coords:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.value!=="":ret.specified)?ret.value:undefined;},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret);}
return(ret.value=value+"");}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value;}}});});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false";}
nodeHook.set(elem,value,name);}};}
if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret;}});});}
if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined;},set:function(elem,value){return(elem.style.cssText=value+"");}};}
if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}
return null;}});}
if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding";}
if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value;}};});}
jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0);}}});});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*|)(?:\.(.+)|)$/,rhoverHack=/(?:^|\s)hover(\.\S+|)\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1");};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;}
if(!handler.guid){handler.guid=jQuery.guid++;}
events=elemData.events;if(!events){elemData.events=events={};}
eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;};eventHandle.elem=elem;}
types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}
elem=null;},global:{},remove:function(elem,types,handler,selector,mappedTypes){var t,tns,type,origType,namespaces,origCount,j,events,special,eventType,handleObj,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return;}
types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery.removeData(elem,"events",true);}},customEvent:{"getData":true,"setData":true,"changeData":true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return;}
var cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType,type=event.type||event,namespaces=[];if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true;}
if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return;}
event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true);}}
return;}
event.result=undefined;if(!event.target){event.target=elem;}
data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return;}
eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;for(old=elem;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur;}
if(old===(elem.ownerDocument||document)){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType]);}}
for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault();}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null;}
jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old;}}}}
return event.result;},dispatch:function(event){event=jQuery.event.fix(event||window.event);var i,j,cur,ret,selMatch,matched,matches,handleObj,sel,related,handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=core_slice.call(arguments),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[];args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;}
if(delegateCount&&!(event.button&&event.type==="click")){for(cur=event.target;cur!=this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){selMatch={};matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length;}
if(selMatch[sel]){matches.push(handleObj);}}
if(matches.length){handlerQueue.push({elem:cur,matches:matches});}}}}
if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});}
for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation();}}}}}
if(special.postDispatch){special.postDispatch.call(this,event);}
return event.result;},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}
return event;}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;}
if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}
return event;}},fix:function(event){if(event[jQuery.expando]){return event;}
var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop];}
if(!event.target){event.target=originalEvent.srcElement||document;}
if(event.target.nodeType===3){event.target=event.target.parentNode;}
event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event;},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle;}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null;}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem);}else{jQuery.event.dispatch.call(elem,e);}
if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false);}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null;}
elem.detachEvent(name,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};function returnFalse(){return false;}
function returnTrue(){return true;}
jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"_submit_attached")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true;});jQuery._data(form,"_submit_attached",true);}});},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true);}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.remove(this,"._submit");}};}
if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true;}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false;}
jQuery.event.simulate("change",this,event,true);});}
return false;}
jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"_change_attached")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true);}});jQuery._data(elem,"_change_attached",true);}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName);}};}
if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true);};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true);}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true);}}};});}
jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined;}
for(type in types){this.on(type,selector,data,types[type],one);}
return this;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return this;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return this.each(function(){jQuery.event.add(this,types,fn,data,selector);});},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this;},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this;},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true);}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false;};toggler.guid=guid;while(i<args.length){args[i++].guid=guid;}
return this.click(toggler);},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null;}
return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks;}
if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks;}});(function(window,undefined){var cachedruns,assertGetIdNotName,Expr,getText,isXML,contains,compile,sortOrder,hasDuplicate,outermostContext,baseHasDuplicate=true,strundefined="undefined",expando=("sizcache"+Math.random()).replace(".",""),Token=String,document=window.document,docElem=document.documentElement,dirruns=0,done=0,pop=[].pop,push=[].push,slice=[].slice,indexOf=[].indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i;}}
return-1;},markFunction=function(fn,value){fn[expando]=value==null||value;return fn;},createCache=function(){var cache={},keys=[];return markFunction(function(key,value){if(keys.push(key)>Expr.cacheLength){delete cache[keys.shift()];}
return(cache[key+" "]=value);},cache);},classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),operators="([*^$|!~]?=)",attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:"+operators+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+attributes+")|[^:]|\\\\.)*|.*))\\)|)",pos=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([\\x20\\t\\r\\n\\f>+~])"+whitespace+"*"),rpseudo=new RegExp(pseudos),rquickExpr=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,rnot=/^:not/,rsibling=/[\x20\t\r\n\f]*[+~]/,rendsWithNot=/:not\($/,rheader=/h\d/i,rinputs=/input|select|textarea|button/i,rbackslash=/\\(?!\\)/g,matchExpr={"ID":new RegExp("^#("+characterEncoding+")"),"CLASS":new RegExp("^\\.("+characterEncoding+")"),"NAME":new RegExp("^\\[name=['\"]?("+characterEncoding+")['\"]?\\]"),"TAG":new RegExp("^("+characterEncoding.replace("w","w*")+")"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"POS":new RegExp(pos,"i"),"CHILD":new RegExp("^:(only|nth|first|last)-child(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|"+pos,"i")},assert=function(fn){var div=document.createElement("div");try{return fn(div);}catch(e){return false;}finally{div=null;}},assertTagNameNoComments=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length;}),assertHrefNotNormalized=assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild&&typeof div.firstChild.getAttribute!==strundefined&&div.firstChild.getAttribute("href")==="#";}),assertAttributes=assert(function(div){div.innerHTML="<select></select>";var type=typeof div.lastChild.getAttribute("multiple");return type!=="boolean"&&type!=="string";}),assertUsableClassName=assert(function(div){div.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!div.getElementsByClassName||!div.getElementsByClassName("e").length){return false;}
div.lastChild.className="e";return div.getElementsByClassName("e").length===2;}),assertUsableName=assert(function(div){div.id=expando+0;div.innerHTML="<a name='"+expando+"'></a><div name='"+expando+"'></div>";docElem.insertBefore(div,docElem.firstChild);var pass=document.getElementsByName&&document.getElementsByName(expando).length===2+
document.getElementsByName(expando+0).length;assertGetIdNotName=!document.getElementById(expando);docElem.removeChild(div);return pass;});try{slice.call(docElem.childNodes,0)[0].nodeType;}catch(e){slice=function(i){var elem,results=[];for(;(elem=this[i]);i++){results.push(elem);}
return results;};}
function Sizzle(selector,context,results,seed){results=results||[];context=context||document;var match,elem,xml,m,nodeType=context.nodeType;if(!selector||typeof selector!=="string"){return results;}
if(nodeType!==1&&nodeType!==9){return[];}
xml=isXML(context);if(!xml&&!seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,slice.call(context.getElementsByTagName(selector),0));return results;}else if((m=match[3])&&assertUsableClassName&&context.getElementsByClassName){push.apply(results,slice.call(context.getElementsByClassName(m),0));return results;}}}
return select(selector.replace(rtrim,"$1"),context,results,seed,xml);}
Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){return Sizzle(expr,null,null,[elem]).length>0;};function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type;};}
function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type;};}
function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}
getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}}else{for(;(node=elem[i]);i++){ret+=getText(node);}}
return ret;};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};contains=Sizzle.contains=docElem.contains?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&adown.contains&&adown.contains(bup));}:docElem.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16);}:function(a,b){while((b=b.parentNode)){if(b===a){return true;}}
return false;};Sizzle.attr=function(elem,name){var val,xml=isXML(elem);if(!xml){name=name.toLowerCase();}
if((val=Expr.attrHandle[name])){return val(elem);}
if(xml||assertAttributes){return elem.getAttribute(name);}
val=elem.getAttributeNode(name);return val?typeof elem[name]==="boolean"?elem[name]?name:null:val.specified?val.value:null:null;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:assertHrefNotNormalized?{}:{"href":function(elem){return elem.getAttribute("href",2);},"type":function(elem){return elem.getAttribute("type");}},find:{"ID":assertGetIdNotName?function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m&&m.parentNode?[m]:[];}}:function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[];}},"TAG":assertTagNameNoComments?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag);}}:function(tag,context){var results=context.getElementsByTagName(tag);if(tag==="*"){var elem,tmp=[],i=0;for(;(elem=results[i]);i++){if(elem.nodeType===1){tmp.push(elem);}}
return tmp;}
return results;},"NAME":assertUsableName&&function(tag,context){if(typeof context.getElementsByName!==strundefined){return context.getElementsByName(name);}},"CLASS":assertUsableClassName&&function(className,context,xml){if(typeof context.getElementsByClassName!==strundefined&&!xml){return context.getElementsByClassName(className);}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(rbackslash,"");match[3]=(match[4]||match[5]||"").replace(rbackslash,"");if(match[2]==="~="){match[3]=" "+match[3]+" ";}
return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0]);}
match[3]=+(match[3]?match[4]+(match[5]||1):2*(match[2]==="even"||match[2]==="odd"));match[4]=+((match[6]+match[7])||match[2]==="odd");}else if(match[2]){Sizzle.error(match[0]);}
return match;},"PSEUDO":function(match){var unquoted,excess;if(matchExpr["CHILD"].test(match[0])){return null;}
if(match[3]){match[2]=match[3];}else if((unquoted=match[4])){if(rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){unquoted=unquoted.slice(0,excess);match[0]=match[0].slice(0,excess);}
match[2]=unquoted;}
return match.slice(0,3);}},filter:{"ID":assertGetIdNotName?function(id){id=id.replace(rbackslash,"");return function(elem){return elem.getAttribute("id")===id;};}:function(id){id=id.replace(rbackslash,"");return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===id;};},"TAG":function(nodeName){if(nodeName==="*"){return function(){return true;};}
nodeName=nodeName.replace(rbackslash,"").toLowerCase();return function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[expando][className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(elem.className||(typeof elem.getAttribute!==strundefined&&elem.getAttribute("class"))||"");});},"ATTR":function(name,operator,check){return function(elem,context){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}
if(!operator){return true;}
result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.substr(result.length-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.substr(0,check.length+1)===check+"-":false;};},"CHILD":function(type,argument,first,last){if(type==="nth"){return function(elem){var node,diff,parent=elem.parentNode;if(first===1&&last===0){return true;}
if(parent){diff=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){diff++;if(elem===node){break;}}}}
diff-=last;return diff===first||(diff%first===0&&diff/first>=0);};}
return function(elem){var node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false;}}
if(type==="first"){return true;}
node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false;}}
return true;}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}
if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}
return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),"enabled":function(elem){return elem.disabled===false;},"disabled":function(elem){return elem.disabled===true;},"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},"parent":function(elem){return!Expr.pseudos["empty"](elem);},"empty":function(elem){var nodeType;elem=elem.firstChild;while(elem){if(elem.nodeName>"@"||(nodeType=elem.nodeType)===3||nodeType===4){return false;}
elem=elem.nextSibling;}
return true;},"header":function(elem){return rheader.test(elem.nodeName);},"text":function(elem){var type,attr;return elem.nodeName.toLowerCase()==="input"&&(type=elem.type)==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===type);},"radio":createInputPseudo("radio"),"checkbox":createInputPseudo("checkbox"),"file":createInputPseudo("file"),"password":createInputPseudo("password"),"image":createInputPseudo("image"),"submit":createButtonPseudo("submit"),"reset":createButtonPseudo("reset"),"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button";},"input":function(elem){return rinputs.test(elem.nodeName);},"focus":function(elem){var doc=elem.ownerDocument;return elem===doc.activeElement&&(!doc.hasFocus||doc.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);},"active":function(elem){return elem===elem.ownerDocument.activeElement;},"first":createPositionalPseudo(function(){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),"even":createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;){matchIndexes.push(i);}
return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;){matchIndexes.push(i);}
return matchIndexes;})}};function siblingCheck(a,b,ret){if(a===b){return ret;}
var cur=a.nextSibling;while(cur){if(cur===b){return-1;}
cur=cur.nextSibling;}
return 1;}
sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0;}
return(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}else if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex;}
var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b);}else if(!aup){return-1;}else if(!bup){return 1;}
while(cur){ap.unshift(cur);cur=cur.parentNode;}
cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode;}
al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i]);}}
return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1);};[0,0].sort(sortOrder);baseHasDuplicate=!hasDuplicate;Sizzle.uniqueSort=function(results){var elem,duplicates=[],i=1,j=0;hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(;(elem=results[i]);i++){if(elem===results[i-1]){j=duplicates.push(i);}}
while(j--){results.splice(duplicates[j],1);}}
return results;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[expando][selector+" "];if(cached){return parseOnly?0:cached.slice(0);}
soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}
groups.push(tokens=[]);}
matched=false;if((match=rcombinators.exec(soFar))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=match[0].replace(rtrim," ");}
for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=type;matched.matches=match;}}
if(!matched){break;}}
return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);}
function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&combinator.dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){return matcher(elem,context,xml);}}}:function(elem,context,xml){if(!xml){var cache,dirkey=dirruns+" "+doneName+" ",cachedkey=dirkey+cachedruns;while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if((cache=elem[expando])===cachedkey){return elem.sizset;}else if(typeof cache==="string"&&cache.indexOf(dirkey)===0){if(elem.sizset){return elem;}}else{elem[expando]=cachedkey;if(matcher(elem,context,xml)){elem.sizset=true;return elem;}
elem.sizset=false;}}}}else{while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if(matcher(elem,context,xml)){return elem;}}}}};}
function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}
return true;}:matchers[0];}
function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}
return newUnmatched;}
function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}
if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}
return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}
if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}
if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));}}
postFinder(null,(matcherOut=[]),temp,xml);}
i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}
function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}
return setMatcher(i>1&&elementMatcher(matchers),i>1&&tokens.slice(0,i-1).join("").replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&tokens.join(""));}
matchers.push(matcher);}}
return elementMatcher(matchers);}
function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.E);if(outermost){outermostContext=context!==document&&context;cachedruns=superMatcher.el;}
for(;(elem=elems[i])!=null;i++){if(byElement&&elem){for(j=0;(matcher=elementMatchers[j]);j++){if(matcher(elem,context,xml)){results.push(elem);break;}}
if(outermost){dirruns=dirrunsUnique;cachedruns=++superMatcher.el;}}
if(bySet){if((elem=!matcher&&elem)){matchedCount--;}
if(seed){unmatched.push(elem);}}}
matchedCount+=i;if(bySet&&i!==matchedCount){for(j=0;(matcher=setMatchers[j]);j++){matcher(unmatched,setMatched,context,xml);}
if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}
setMatched=condense(setMatched);}
push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}
if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}
return unmatched;};superMatcher.el=0;return bySet?markFunction(superMatcher):superMatcher;}
compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[expando][selector+" "];if(!cached){if(!group){group=tokenize(selector);}
i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}
cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));}
return cached;};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}
return results;}
function select(selector,context,results,seed,xml){var i,tokens,token,type,find,match=tokenize(selector),j=match.length;if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&!xml&&Expr.relative[tokens[1].type]){context=Expr.find["ID"](token.matches[0].replace(rbackslash,""),context,xml)[0];if(!context){return results;}
selector=selector.slice(tokens.shift().length);}
for(i=matchExpr["POS"].test(selector)?-1:tokens.length-1;i>=0;i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}
if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(rbackslash,""),rsibling.test(tokens[0].type)&&context.parentNode||context,xml))){tokens.splice(i,1);selector=seed.length&&tokens.join("");if(!selector){push.apply(results,slice.call(seed,0));return results;}
break;}}}}}
compile(selector,match)(seed,context,xml,results,rsibling.test(selector));return results;}
if(document.querySelectorAll){(function(){var disconnectedMatch,oldSelect=select,rescape=/'|\\/g,rattributeQuotes=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,rbuggyQSA=[":focus"],rbuggyMatches=[":active"],matches=docElem.matchesSelector||docElem.mozMatchesSelector||docElem.webkitMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");}
if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");}});assert(function(div){div.innerHTML="<p test=''></p>";if(div.querySelectorAll("[test^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:\"\"|'')");}
div.innerHTML="<input type='hidden'/>";if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled");}});rbuggyQSA=new RegExp(rbuggyQSA.join("|"));select=function(selector,context,results,seed,xml){if(!seed&&!xml&&!rbuggyQSA.test(selector)){var groups,i,old=true,nid=expando,newContext=context,newSelector=context.nodeType===9&&selector;if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&");}else{context.setAttribute("id",nid);}
nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+groups[i].join("");}
newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",");}
if(newSelector){try{push.apply(results,slice.call(newContext.querySelectorAll(newSelector),0));return results;}catch(qsaError){}finally{if(!old){context.removeAttribute("id");}}}}
return oldSelect(selector,context,results,seed,xml);};if(matches){assert(function(div){disconnectedMatch=matches.call(div,"div");try{matches.call(div,"[test!='']:sizzle");rbuggyMatches.push("!=",pseudos);}catch(e){}});rbuggyMatches=new RegExp(rbuggyMatches.join("|"));Sizzle.matchesSelector=function(elem,expr){expr=expr.replace(rattributeQuotes,"='$1']");if(!isXML(elem)&&!rbuggyMatches.test(expr)&&!rbuggyQSA.test(expr)){try{var ret=matches.call(elem,expr);if(ret||disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}
return Sizzle(expr,null,null,[elem]).length>0;};}})();}
Expr.pseudos["nth"]=Expr.pseudos["eq"];function setFilters(){}
Expr.filters=setFilters.prototype=Expr.pseudos;Expr.setFilters=new setFilters();Sizzle.attr=jQuery.attr;jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;})(window);var runtil=/Until$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,l,length,n,r,ret,self=this;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true;}}});}
ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break;}}}}}
return ret;},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true;}}});},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector);},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector);},is:function(selector){return!!selector&&(typeof selector==="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0);},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){cur=this[i];while(cur&&cur.ownerDocument&&cur!==context&&cur.nodeType!==11){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break;}
cur=cur.parentNode;}}
ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1;}
if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}
return jQuery.inArray(elem.jquery?elem[0]:elem,this);},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all));},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));}});jQuery.fn.andSelf=jQuery.fn.addBack;function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11;}
function sibling(cur,dir){do{cur=cur[dir];}while(cur&&cur.nodeType!==1);return cur;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return jQuery.dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return jQuery.dir(elem,"nextSibling");},prevAll:function(elem){return jQuery.dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until);},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem);},children:function(elem){return jQuery.sibling(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until;}
if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}
ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if(this.length>1&&rparentsprev.test(name)){ret=ret.reverse();}
return this.pushStack(ret,name,core_slice.call(arguments).join(","));};});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")";}
return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems);},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur);}
cur=cur[dir];}
return matched;},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n);}}
return r;}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep;});}else if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep;});}else if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1;});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep);}else{qualifier=jQuery.filter(qualifier,filtered);}}
return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep;});}
function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}
return safeFrag;}
var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rcheckableType=/^(?:checkbox|radio)$/,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"X<div>","</div>"];}
jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value));},null,value,arguments.length);},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}
if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.appendChild(elem);}});},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.insertBefore(elem,this.firstChild);}});},before:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this);});}
if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(set,this),"before",this.selector);}},after:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling);});}
if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(this,set),"after",this.selector);}},remove:function(selector,keepData){var elem,i=0;for(;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem]);}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}}
return this;},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));}
while(elem.firstChild){elem.removeChild(elem.firstChild);}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined;}
if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));elem.innerHTML=value;}}
elem=0;}catch(e){}}
if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(value){if(!isDisconnected(this[0])){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old));});}
if(typeof value!=="string"){value=jQuery(value).detach();}
return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value);}else{jQuery(parent).append(value);}});}
return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this;},detach:function(selector){return this.remove(selector,true);},domManip:function(args,table,callback){args=[].concat.apply([],args);var results,first,fragment,iNoClone,i=0,value=args[0],scripts=[],l=this.length;if(!jQuery.support.checkClone&&l>1&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback);});}
if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback);});}
if(this[0]){results=jQuery.buildFragment(args,this,scripts);fragment=results.fragment;first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}
if(first){table=table&&jQuery.nodeName(first,"tr");for(iNoClone=results.cacheable||l-1;i<l;i++){callback.call(table&&jQuery.nodeName(this[i],"table")?findOrAppend(this[i],"tbody"):this[i],i===iNoClone?fragment:jQuery.clone(fragment,true,true));}}
fragment=first=null;if(scripts.length){jQuery.each(scripts,function(i,elem){if(elem.src){if(jQuery.ajax){jQuery.ajax({url:elem.src,type:"GET",dataType:"script",async:false,global:false,"throws":true});}else{jQuery.error("no ajax");}}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,""));}
if(elem.parentNode){elem.parentNode.removeChild(elem);}});}}
return this;}});function findOrAppend(elem,tag){return elem.getElementsByTagName(tag)[0]||elem.appendChild(elem.ownerDocument.createElement(tag));}
function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;}
var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);}}}
if(curData.data){curData.data=jQuery.extend({},curData.data);}}
function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return;}
if(dest.clearAttributes){dest.clearAttributes();}
if(dest.mergeAttributes){dest.mergeAttributes(src);}
nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML;}
if(jQuery.support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML;}}else if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value;}}else if(nodeName==="option"){dest.selected=src.defaultSelected;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}else if(nodeName==="script"&&dest.text!==src.text){dest.text=src.text;}
dest.removeAttribute(jQuery.expando);}
jQuery.buildFragment=function(args,context,scripts){var fragment,cacheable,cachehit,first=args[0];context=context||document;context=!context.nodeType&&context[0]||context;context=context.ownerDocument||context;if(args.length===1&&typeof first==="string"&&first.length<512&&context===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;fragment=jQuery.fragments[first];cachehit=fragment!==undefined;}
if(!fragment){fragment=context.createDocumentFragment();jQuery.clean(args,context,fragment,scripts);if(cacheable){jQuery.fragments[first]=cachehit&&fragment;}}
return{fragment:fragment,cacheable:cacheable};};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),l=insert.length,parent=this.length===1&&this[0].parentNode;if((parent==null||parent&&parent.nodeType===11&&parent.childNodes.length===1)&&l===1){insert[original](this[0]);return this;}else{for(;i<l;i++){elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems);}
return this.pushStack(ret,name,insert.selector);}};});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*");}else if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*");}else{return[];}}
function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked;}}
jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone;if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true);}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild);}
if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i]);}}}
if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i]);}}}
srcElements=destElements=null;return clone;},clean:function(elems,context,fragment,scripts){var i,j,elem,tag,wrap,depth,div,hasBody,tbody,len,handleScript,jsTags,safe=context===document&&safeFragment,ret=[];if(!context||typeof context.createDocumentFragment==="undefined"){context=document;}
for(i=0;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+="";}
if(!elem){continue;}
if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem);}else{safe=safe||createSafeFragment(context);div=context.createElement("div");safe.appendChild(div);elem=elem.replace(rxhtmlTag,"<$1></$2>");tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;depth=wrap[0];div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild;}
if(!jQuery.support.tbody){hasBody=rtbody.test(elem);tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j]);}}}
if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild);}
elem=div.childNodes;div.parentNode.removeChild(div);}}
if(elem.nodeType){ret.push(elem);}else{jQuery.merge(ret,elem);}}
if(div){elem=div=safe=null;}
if(!jQuery.support.appendChecked){for(i=0;(elem=ret[i])!=null;i++){if(jQuery.nodeName(elem,"input")){fixDefaultChecked(elem);}else if(typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked);}}}
if(fragment){handleScript=function(elem){if(!elem.type||rscriptType.test(elem.type)){return scripts?scripts.push(elem.parentNode?elem.parentNode.removeChild(elem):elem):fragment.appendChild(elem);}};for(i=0;(elem=ret[i])!=null;i++){if(!(jQuery.nodeName(elem,"script")&&handleScript(elem))){fragment.appendChild(elem);if(typeof elem.getElementsByTagName!=="undefined"){jsTags=jQuery.grep(jQuery.merge([],elem.getElementsByTagName("script")),handleScript);ret.splice.apply(ret,[i+1,0].concat(jsTags));i+=jsTags.length;}}}}
return ret;},cleanData:function(elems,acceptData){var data,id,elem,type,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}}
if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey];}else if(elem.removeAttribute){elem.removeAttribute(internalKey);}else{elem[internalKey]=null;}
jQuery.deletedIds.push(id);}}}}}});(function(){var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||(/(webkit)[ \/]([\w.]+)/.exec(ua))||(/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua))||(/(msie) ([\w.]+)/.exec(ua))||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version;}
if(browser.chrome){browser.webkit=true;}else if(browser.webkit){browser.safari=true;}
jQuery.browser=browser;jQuery.sub=function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context);}
jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context);}
return jQuery.fn.init.call(this,selector,context,rootjQuerySub);};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub;};})();var curCSS,iframe,iframeDoc,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([-+])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"],eventsToggle=jQuery.fn.toggle;function vendorPropName(style,name){if(name in style){return name;}
var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name;}}
return origName;}
function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem);}
function showHide(elements,show){var elem,display,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}
values[index]=jQuery._data(elem,"olddisplay");if(show){if(!values[index]&&elem.style.display==="none"){elem.style.display="";}
if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName));}}else{display=curCSS(elem,"display");if(!values[index]&&display!=="none"){jQuery._data(elem,"olddisplay",display);}}}
for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue;}
if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none";}}
return elements;}
jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);},show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state,fn2){var bool=typeof state==="boolean";if(jQuery.isFunction(state)&&jQuery.isFunction(fn2)){return eventsToggle.apply(this,arguments);}
return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret;}}}},cssNumber:{"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number";}
if(value==null||type==="number"&&isNaN(value)){return;}
if(type==="number"&&!jQuery.cssNumber[origName]){value+="px";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value;}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,numeric,extra){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra);}
if(val===undefined){val=curCSS(elem,name);}
if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}
if(numeric||extra!==undefined){num=parseFloat(val);return numeric||jQuery.isNumeric(num)?num||0:val;}
return val;},swap:function(elem,options,callback){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
ret=callback.call(elem);for(name in options){elem.style[name]=old[name];}
return ret;}});if(window.getComputedStyle){curCSS=function(elem,name){var ret,width,minWidth,maxWidth,computed=window.getComputedStyle(elem,null),style=elem.style;if(computed){ret=computed.getPropertyValue(name)||computed[name];if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name);}
if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}
return ret;};}else if(document.documentElement.currentStyle){curCSS=function(elem,name){var left,rsLeft,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret==null&&style&&style[name]){ret=style[name];}
if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left;}
style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft;}}
return ret===""?"auto":ret;};}
function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value;}
function augmentWidthOrHeight(elem,name,extra,isBorderBox){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true);}
if(isBorderBox){if(extra==="content"){val-=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;}
if(extra!=="margin"){val-=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0;}}else{val+=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;if(extra!=="padding"){val+=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0;}}}
return val;}
function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,valueIsBorderBox=true,isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box";if(val<=0||val==null){val=curCSS(elem,name);if(val<0||val==null){val=elem.style[name];}
if(rnumnonpx.test(val)){return val;}
valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0;}
return(val+
augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox))+"px";}
function css_defaultDisplay(nodeName){if(elemdisplay[nodeName]){return elemdisplay[nodeName];}
var elem=jQuery("<"+nodeName+">").appendTo(document.body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe=document.body.appendChild(iframe||jQuery.extend(document.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write("<!doctype html><html><body>");iframeDoc.close();}
elem=iframeDoc.body.appendChild(iframeDoc.createElement(nodeName));display=curCSS(elem,"display");document.body.removeChild(iframe);}
elemdisplay[nodeName]=display;return display;}
jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){if(elem.offsetWidth===0&&rdisplayswap.test(curCSS(elem,"display"))){return jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra);});}else{return getWidthOrHeight(elem,name,extra);}}},set:function(elem,value,extra){return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box"):0);}};});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":"";},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return;}}
style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;}};}
jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{"display":"inline-block"},function(){if(computed){return curCSS(elem,"marginRight");}});}};}
if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){var ret=curCSS(elem,prop);return rnumnonpx.test(ret)?jQuery(elem).position()[prop]+"px":ret;}}};});}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return(elem.offsetWidth===0&&elem.offsetHeight===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||curCSS(elem,"display"))==="none");};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem);};}
jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i,parts=typeof value==="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}
return expanded;}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rselectTextarea=/^(?:select|textarea)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;}
if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&").replace(r20,"+");};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add);}});}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
var
ajaxLocParts,ajaxLocation,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes=["*/"]+["*"];try{ajaxLocation=location.href;}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href;}
ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
var dataType,list,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(core_rspace),i=0,length=dataTypes.length;if(jQuery.isFunction(func)){for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*";}
list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func);}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters);for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined;}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected);}}}
if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected);}
return selection;}
function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}}
jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}
if(!this.length){return this;}
var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off);}
if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(params&&typeof params==="object"){type="POST";}
jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status){if(callback){self.each(callback,response||[jqXHR.responseText,status,jqXHR]);}}}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText);});return this;};jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f);};});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type});};});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings);}else{settings=target;target=jQuery.ajaxSettings;}
ajaxExtend(target,settings);return target;},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var
ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}
return this;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match===undefined?null:match;},overrideMimeType:function(type){if(!state){s.mimeType=type;}
return this;},abort:function(statusText){statusText=statusText||strAbort;if(transport){transport.abort(statusText);}
done(0,statusText);return this;}};function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return;}
state=2;if(timeoutTimer){clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}
if(status>=200&&status<300||status===304){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[ifModifiedKey]=modified;}
modified=jqXHR.getResponseHeader("Etag");if(modified){jQuery.etag[ifModifiedKey]=modified;}}
if(status===304){statusText="notmodified";isSuccess=true;}else{isSuccess=ajaxConvert(s,response);statusText=isSuccess.state;success=isSuccess.data;error=isSuccess.error;isSuccess=!error;}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]];}}else{tmp=map[jqXHR.status];jqXHR.always(tmp);}}
return this;};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(core_rspace);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR;}
fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data;}
ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"");}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]);}
if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey]);}}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort();}
strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}
transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}
return jqXHR;},active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type];}}
while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response){var conv,conv2,current,tmp,dataTypes=s.dataTypes.slice(),prev=dataTypes[0],converters={},i=0;if(s.dataFilter){response=s.dataFilter(response,s.dataType);}
if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}
for(;(current=dataTypes[++i]);){if(current!=="*"){if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.splice(i--,0,current);}
break;}}}}
if(conv!==true){if(conv&&s["throws"]){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}
prev=current;}}
return{state:"success",data:response};}
var oldCallbacks=[],rquestion=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,nonce=jQuery.now();jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,data=s.data,url=s.url,hasCallback=s.jsonp!==false,replaceInUrl=hasCallback&&rjsonp.test(url),replaceInData=hasCallback&&!replaceInUrl&&typeof data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(data);if(s.dataTypes[0]==="jsonp"||replaceInUrl||replaceInData){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;overwritten=window[callbackName];if(replaceInUrl){s.url=url.replace(rjsonp,"$1"+callbackName);}else if(replaceInData){s.data=data.replace(rjsonp,"$1"+callbackName);}else if(hasCallback){s.url+=(rquestion.test(url)?"&":"?")+s.jsonp+"="+callbackName;}
s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";window[callbackName]=function(){responseContainer=arguments;};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}
if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0]);}
responseContainer=overwritten=undefined;});return"script";}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset;}
script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}
script=undefined;if(!isAbort){callback(200,"success");}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(0,1);}}};}});var xhrCallbacks,xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1);}}:false,xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest();}catch(e){}}
function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}
jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR();}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials"in xhr)});})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password);}else{xhr.open(s.type,s.url,s.async);}
if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i];}}
if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType);}
if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
try{for(i in headers){xhr.setRequestHeader(i,headers[i]);}}catch(_){}
xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle];}}
if(isAbort){if(xhr.readyState!==4){xhr.abort();}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml;}
try{responses.text=xhr.responseText;}catch(e){}
try{statusText=xhr.statusText;}catch(e){statusText="";}
if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404;}else if(status===1223){status=204;}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException);}}
if(responses){complete(status,statusText,responses,responseHeaders);}};if(!s.async){callback();}else if(xhr.readyState===4){setTimeout(callback,0);}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort);}
xhrCallbacks[handle]=callback;}
xhr.onreadystatechange=callback;}},abort:function(){if(callback){callback(0,1);}}};}});}
var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([-+])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1,maxIterations=20;if(parts){end=+parts[2];unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,true)||end||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit);}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations);}
tween.unit=unit;tween.start=start;tween.end=parts[1]?start+(parts[1]+1)*end:end;}
return tween;}]};function createFxNow(){setTimeout(function(){fxNow=undefined;},0);return(fxNow=jQuery.now());}
function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(collection[index].call(animation,prop,value)){return;}}});}
function Animation(elem,properties,options){var result,index=0,tweenerIndex=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;}),tick=function(){var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent);}
deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining;}else{deferred.resolveWith(elem,[animation]);return false;}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end,easing){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;for(;index<length;index++){animation.tweens[index].run(1);}
if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}
return this;}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result;}}
createTweens(animation,props);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);}
jQuery.fx.timer(jQuery.extend(tick,{anim:animation,queue:animation.opts.queue,elem:elem}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);}
function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0];}
if(index!==name){props[name]=value;delete props[index];}
hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;}}}else{specialEasing[name]=easing;}}}
jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"];}else{props=props.split(" ");}
var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback);}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback);}else{animationPrefilters.push(callback);}}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,toggle,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}
hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}
if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block";}else{style.zoom=1;}}}
if(opts.overflow){style.overflow="hidden";if(!jQuery.support.shrinkWrapBlocks){anim.done(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}}
for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){continue;}
handled.push(index);}}
length=handled.length;if(length){dataShow=jQuery._data(elem,"fxshow")||jQuery._data(elem,"fxshow",{});if("hidden"in dataShow){hidden=dataShow.hidden;}
if(toggle){dataShow.hidden=!hidden;}
if(hidden){jQuery(elem).show();}else{anim.done(function(){jQuery(elem).hide();});}
anim.done(function(){var prop;jQuery.removeData(elem,"fxshow",true);for(prop in orig){jQuery.style(elem,prop,orig[prop]);}});for(index=0;index<length;index++){prop=handled[index];tween=anim.createTween(prop,hidden?dataShow[prop]:0);orig[prop]=dataShow[prop]||jQuery.style(elem,prop);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0;}}}}}
function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);}
jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);}else{this.pos=eased=percent;}
this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);}
if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}
return this;}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop];}
result=jQuery.css(tween.elem,tween.prop,false,"");return!result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);}else{tween.elem[tween.prop]=tween.now;}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"||(!i&&jQuery.isFunction(speed)&&jQuery.isFunction(easing))?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);};});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty){anim.stop(true);}};return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);}}}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1);}}
if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;}
if(includeWidth){attrs.opacity=attrs.width=type;}
return attrs;}
jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}
fxNow=undefined;};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)&&!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval);}};jQuery.fx.interval=13;jQuery.fx.stop=function(){clearInterval(timerId);timerId=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};}
var rroot=/^(?:body|html)$/i;jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
var docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return;}
if((body=doc.body)===elem){return jQuery.offset.bodyOffset(elem);}
docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box;}
if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect();}
win=getWindow(doc);clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=win.pageYOffset||docElem.scrollTop;scrollLeft=win.pageXOffset||docElem.scrollLeft;return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft};};jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0;}
return{top:top,left:left};},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative";}
var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset);}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({position:function(){if(!this[0]){return;}
var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;}
return offsetParent||document.body;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method];}
if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop());}else{elem[method]=val;}},method,val,arguments.length,null);};});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;}
jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name];}
if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);}
return value===undefined?jQuery.css(elem,type,value,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable,null);};});});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery;});}})(window);;(function($){'use strict';function safe_add(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF),msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);}
function bit_rol(num,cnt){return(num<<cnt)|(num>>>(32-cnt));}
function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b);}
function md5_ff(a,b,c,d,x,s,t){return md5_cmn((b&c)|((~b)&d),a,b,x,s,t);}
function md5_gg(a,b,c,d,x,s,t){return md5_cmn((b&d)|(c&(~d)),a,b,x,s,t);}
function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t);}
function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|(~d)),a,b,x,s,t);}
function binl_md5(x,len){x[len>>5]|=0x80<<((len)%32);x[(((len+64)>>>9)<<4)+14]=len;var i,olda,oldb,oldc,oldd,a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(i=0;i<x.length;i+=16){olda=a;oldb=b;oldc=c;oldd=d;a=md5_ff(a,b,c,d,x[i],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);}
return[a,b,c,d];}
function binl2rstr(input){var i,output='';for(i=0;i<input.length*32;i+=8){output+=String.fromCharCode((input[i>>5]>>>(i%32))&0xFF);}
return output;}
function rstr2binl(input){var i,output=[];output[(input.length>>2)-1]=undefined;for(i=0;i<output.length;i+=1){output[i]=0;}
for(i=0;i<input.length*8;i+=8){output[i>>5]|=(input.charCodeAt(i/8)&0xFF)<<(i%32);}
return output;}
function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),s.length*8));}
function rstr_hmac_md5(key,data){var i,bkey=rstr2binl(key),ipad=[],opad=[],hash;ipad[15]=opad[15]=undefined;if(bkey.length>16){bkey=binl_md5(bkey,key.length*8);}
for(i=0;i<16;i+=1){ipad[i]=bkey[i]^0x36363636;opad[i]=bkey[i]^0x5C5C5C5C;}
hash=binl_md5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_md5(opad.concat(hash),512+128));}
function rstr2hex(input){var hex_tab='0123456789abcdef',output='',x,i;for(i=0;i<input.length;i+=1){x=input.charCodeAt(i);output+=hex_tab.charAt((x>>>4)&0x0F)+
hex_tab.charAt(x&0x0F);}
return output;}
function str2rstr_utf8(input){return unescape(encodeURIComponent(input));}
function raw_md5(s){return rstr_md5(str2rstr_utf8(s));}
function hex_md5(s){return rstr2hex(raw_md5(s));}
function raw_hmac_md5(k,d){return rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d));}
function hex_hmac_md5(k,d){return rstr2hex(raw_hmac_md5(k,d));}
$.md5=function(string,key,raw){if(!key){if(!raw){return hex_md5(string);}else{return raw_md5(string);}}
if(!raw){return hex_hmac_md5(key,string);}else{return raw_hmac_md5(key,string);}};}(typeof jQuery==='function'?jQuery:this));;;(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this;}
var method,action,url,$form=this;if(typeof options=='function'){options={success:options};}
method=this.attr('method');action=this.attr('action');url=(typeof action==='string')?$.trim(action):'';url=url||window.location.href||'';if(url){url=(url.match(/^([^#]+)/)||[])[1];}
options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||'GET',iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options);var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}
if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}
var n,v,a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;for(n in options.data){if(options.data[n]instanceof Array){for(var k in options.data[n]){a.push({name:n,value:options.data[n][k]});}}
else{v=options.data[n];v=$.isFunction(v)?v():v;a.push({name:n,value:v});}}}
if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}
this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}
var q=$.param(a);if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null;}
else{options.data=q;}
var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm();});}
if(options.clearForm){callbacks.push(function(){$form.clearForm();});}
if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments);});}
else if(options.success){callbacks.push(options.success);}
options.success=function(data,status,xhr){var context=options.context||options;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form]);}};var fileInputs=$('input:file',this).length>0;var mp='multipart/form-data';var multipart=($form.attr('enctype')==mp||$form.attr('encoding')==mp);if(options.iframe!==false&&(fileInputs||options.iframe||multipart)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){fileUpload(a);});}
else{fileUpload(a);}}
else{if($.browser.msie&&method=='get'){var ieMeth=$form[0].getAttribute('method');if(typeof ieMeth==='string')
options.type=ieMeth;}
$.ajax(options);}
this.trigger('form-submit-notify',[this,options]);return this;function fileUpload(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;if(a){for(i=0;i<a.length;i++){el=$(form[a[i].name]);el[useProp?'prop':'attr']('disabled',false);}}
if($(':input[name=submit],:input[id=submit]',form).length){alert('Error: Form elements must not have name or id of "submit".');return;}
s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id='jqFormIO'+(new Date().getTime());if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr('name');if(n==null)
$io.attr('name',id);else
id=n;}
else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:'absolute',top:'-1000px',left:'-1000px'});}
io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=(status==='timeout'?'timeout':'aborted');log('aborting upload... '+e);this.aborted=1;$io.attr('src',s.iframeSrc);xhr.error=e;s.error&&s.error.call(s.context,xhr,e,status);g&&$.event.trigger("ajaxError",[xhr,s,e]);s.complete&&s.complete.call(s.context,xhr,e);}};g=s.global;if(g&&!$.active++){$.event.trigger("ajaxStart");}
if(g){$.event.trigger("ajaxSend",[xhr,s]);}
if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--;}
return;}
if(xhr.aborted){return;}
sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+'.x']=form.clk_x;s.extraData[n+'.y']=form.clk_y;}}}
var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc;}
function doSubmit(){var t=$form.attr('target'),a=$form.attr('action');form.setAttribute('target',id);if(!method){form.setAttribute('method','POST');}
if(a!=s.url){form.setAttribute('action',s.url);}
if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});}
if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT);},s.timeout);}
function checkState(){try{var state=getDoc(io).readyState;log('state = '+state);if(state.toLowerCase()=='uninitialized')
setTimeout(checkState,50);}
catch(e){log('Server abort: ',e,' (',e.name,')');cb(SERVER_ABORT);timeoutHandle&&clearTimeout(timeoutHandle);timeoutHandle=undefined;}}
var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){extraInputs.push($('<input type="hidden" name="'+n+'" />').attr('value',s.extraData[n]).appendTo(form)[0]);}}
if(!s.iframeTarget){$io.appendTo('body');io.attachEvent?io.attachEvent('onload',cb):io.addEventListener('load',cb,false);}
setTimeout(checkState,15);form.submit();}
finally{form.setAttribute('action',a);if(t){form.setAttribute('target',t);}else{$form.removeAttr('target');}
$(extraInputs).remove();}}
if(s.forceSync){doSubmit();}
else{setTimeout(doSubmit,10);}
var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return;}
try{doc=getDoc(io);}
catch(ex){log('cannot access response document: ',ex);e=SERVER_ABORT;}
if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort('timeout');return;}
else if(e==SERVER_ABORT&&xhr){xhr.abort('server abort');return;}
if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)
return;}
io.detachEvent?io.detachEvent('onload',cb):io.removeEventListener('load',cb,false);var status='success',errMsg;try{if(timedOut){throw'timeout';}
var isXml=s.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&window.opera&&(doc.body==null||doc.body.innerHTML=='')){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return;}}
var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)
s.dataType='xml';xhr.getResponseHeader=function(header){var headers={'content-type':s.dataType};return headers[header];};if(docRoot){xhr.status=Number(docRoot.getAttribute('status'))||xhr.status;xhr.statusText=docRoot.getAttribute('statusText')||xhr.statusText;}
var dt=s.dataType||'';var scr=/(json|script|text)/.test(dt.toLowerCase());if(scr||s.textarea){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute('status'))||xhr.status;xhr.statusText=ta.getAttribute('statusText')||xhr.statusText;}
else if(scr){var pre=doc.getElementsByTagName('pre')[0];var b=doc.getElementsByTagName('body')[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerHTML;}
else if(b){xhr.responseText=b.innerHTML;}}}
else if(s.dataType=='xml'&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText);}
try{data=httpData(xhr,s.dataType,s);}
catch(e){status='parsererror';xhr.error=errMsg=(e||status);}}
catch(e){log('error caught: ',e);status='error';xhr.error=errMsg=(e||status);}
if(xhr.aborted){log('upload aborted');status=null;}
if(xhr.status){status=(xhr.status>=200&&xhr.status<300||xhr.status===304)?'success':'error';}
if(status==='success'){s.success&&s.success.call(s.context,data,'success',xhr);g&&$.event.trigger("ajaxSuccess",[xhr,s]);}
else if(status){if(errMsg==undefined)
errMsg=xhr.statusText;s.error&&s.error.call(s.context,xhr,status,errMsg);g&&$.event.trigger("ajaxError",[xhr,s,errMsg]);}
g&&$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop");}
s.complete&&s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)
clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)
$io.remove();xhr.responseXML=null;},100);}
var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s);}
else{doc=(new DOMParser()).parseFromString(s,'text/xml');}
return(doc&&doc.documentElement&&doc.documentElement.nodeName!='parsererror')?doc:null;};var parseJSON=$.parseJSON||function(s){return window['eval']('('+s+')');};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader('content-type')||'',xml=type==='xml'||!type&&ct.indexOf('xml')>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){$.error&&$.error('parsererror');}
if(s&&s.dataFilter){data=s.dataFilter(data,type);}
if(typeof data==='string'){if(type==='json'||!type&&ct.indexOf('json')>=0){data=parseJSON(data);}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data);}}
return data;};}};$.fn.ajaxForm=function(options){if(this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log('DOM not ready, queuing ajaxForm');$(function(){$(o.s,o.c).ajaxForm(options);});return this;}
log('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this;}
return this.ajaxFormUnbind().bind('submit.form-plugin',function(e){if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options);}}).bind('click.form-plugin',function(e){var target=e.target;var $el=$(target);if(!($el.is(":submit,input:image"))){var t=$el.closest(':submit');if(t.length==0){return;}
target=t[0];}
var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top;}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop;}}
setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);});};$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(semantic){var a=[];if(this.length===0){return a;}
var form=this[0];var els=semantic?form.getElementsByTagName('*'):form.elements;if(!els){return a;}
var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue;}
if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}
continue;}
v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}
else if(v!==null&&typeof v!='undefined'){a.push({name:n,value:v});}}
if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}}
return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return;}
var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}
else if(v!==null&&typeof v!='undefined'){a.push({name:this.name,value:v});}});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length)){continue;}
v.constructor==Array?$.merge(val,v):val.push(v);}
return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true;}
if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1)){return null;}
if(tag=='select'){var index=el.selectedIndex;if(index<0){return null;}
var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes['value']&&!(op.attributes['value'].specified))?op.text:op.value;}
if(one){return v;}
a.push(v);}}
return a;}
return $(el).val();};$.fn.clearForm=function(){return this.each(function(){$('input,select,textarea',this).clearFields();});};$.fn.clearFields=$.fn.clearInputs=function(){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=='textarea'){this.value='';}
else if(t=='checkbox'||t=='radio'){this.checked=false;}
else if(tag=='select'){this.selectedIndex=-1;}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType)){this.reset();}});};$.fn.enable=function(b){if(b===undefined){b=true;}
return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select===undefined){select=true;}
return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select;}
else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false);}
this.selected=select;}});};function log(){var msg='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log){window.console.log(msg);}
else if(window.opera&&window.opera.postError){window.opera.postError(msg);}};})(jQuery);;(function($){$.extend($.fn,{validate:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return;}
var validator=$.data(this[0],'validator');if(validator){return validator;}
validator=new $.validator(options,this[0]);$.data(this[0],'validator',validator);if(validator.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){validator.cancelSubmit=true;});if(validator.settings.submitHandler){this.find("input, button").filter(":submit").click(function(){validator.submitButton=this;});}
this.submit(function(event){if(validator.settings.debug)
event.preventDefault();function handle(){if(validator.settings.submitHandler){if(validator.submitButton){var hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val(validator.submitButton.value).appendTo(validator.currentForm);}
validator.settings.submitHandler.call(validator,validator.currentForm);if(validator.submitButton){hidden.remove();}
return false;}
return true;}
if(validator.cancelSubmit){validator.cancelSubmit=false;return handle();}
if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false;}
return handle();}else{validator.focusInvalid();return false;}});}
return validator;},valid:function(){if($(this[0]).is('form')){return this.validate().form();}else{var valid=true;var validator=$(this[0].form).validate();this.each(function(){valid&=validator.element(this);});return valid;}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value);});return result;},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,'validator').settings;var staticRules=settings.rules;var existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));staticRules[element.name]=existingRules;if(argument.messages)
settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);break;case"remove":if(!argument){delete staticRules[element.name];return existingRules;}
var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method];});return filtered;}}
var data=$.validator.normalizeRules($.extend({},$.validator.metadataRules(element),$.validator.classRules(element),$.validator.attributeRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data);}
return data;}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+a.value);},filled:function(a){return!!$.trim(""+a.value);},unchecked:function(a){return!a.checked;}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init();};$.validator.format=function(source,params){if(arguments.length==1)
return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args);};if(arguments.length>2&&params.constructor!=Array){params=$.makeArray(arguments).slice(1);}
if(params.constructor!=Array){params=[params];}
$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),n);});return source;};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(element){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(element)).hide();}},onfocusout:function(element){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element);}},onkeyup:function(element){if(element.name in this.submitted||element==this.lastElement){this.element(element);}},onclick:function(element){if(element.name in this.submitted)
this.element(element);else if(element.parentNode.name in this.submitted)
this.element(element.parentNode);},highlight:function(element,errorClass,validClass){if(element.type==='radio'){this.findByName(element.name).addClass(errorClass).removeClass(validClass);}else{$(element).addClass(errorClass).removeClass(validClass);}},unhighlight:function(element,errorClass,validClass){if(element.type==='radio'){this.findByName(element.name).removeClass(errorClass).addClass(validClass);}else{$(element).removeClass(errorClass).addClass(validClass);}}},setDefaults:function(settings){$.extend($.validator.defaults,settings);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={});$.each(this.settings.groups,function(key,value){$.each(value.split(/\s/),function(index,name){groups[name]=key;});});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value);});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");validator.settings[eventType]&&validator.settings[eventType].call(validator,this[0]);}
$(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",delegate).validateDelegate(":radio, :checkbox, select, option","click",delegate);if(this.settings.invalidHandler)
$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid())
$(this.currentForm).triggerHandler("invalid-form",[this]);this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i]);}
return this.valid();},element:function(element){element=this.clean(element);this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element);if(result){delete this.invalid[element.name];}else{this.invalid[element.name]=true;}
if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}
this.showErrors();return result;},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]});}
this.successList=$.grep(this.successList,function(element){return!(element.name in errors);});}
this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors();},resetForm:function(){if($.fn.resetForm)
$(this.currentForm).resetForm();this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass);},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(obj){var count=0;for(var i in obj)
count++;return count;},hideErrors:function(){this.addWrapper(this.toHide).hide();},valid:function(){return this.size()==0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name==lastActive.name;}).length==1&&lastActive;},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&validator.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in rulesCache||!validator.objectLength($(this).rules()))
return false;rulesCache[this.name]=true;return true;});},clean:function(selector){return $(selector)[0];},errors:function(){return $(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element);},check:function(element){element=this.clean(element);if(this.checkable(element)){element=this.findByName(element.name).not(this.settings.ignore)[0];}
var rules=$(element).rules();var dependencyMismatch=false;for(var method in rules){var rule={method:method,parameters:rules[method]};try{var result=$.validator.methods[method].call(this,element.value.replace(/\r/g,""),element,rule.parameters);if(result=="dependency-mismatch"){dependencyMismatch=true;continue;}
dependencyMismatch=false;if(result=="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return;}
if(!result){this.formatAndAdd(element,rule);return false;}}catch(e){this.settings.debug&&window.console&&console.log("exception occured when checking element "+element.id
+", check the '"+rule.method+"' method",e);throw e;}}
if(dependencyMismatch)
return;if(this.objectLength(rules))
this.successList.push(element);return true;},customMetaMessage:function(element,method){if(!$.metadata)
return;var meta=this.settings.meta?$(element).metadata()[this.settings.meta]:$(element).metadata();return meta&&meta.messages&&meta.messages[method];},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor==String?m:m[method]);},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined)
return arguments[i];}
return undefined;},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customMetaMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>");},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message=="function"){message=message.call(this,rule.parameters,element);}else if(theregex.test(message)){message=jQuery.format(message.replace(theregex,'{$1}'),rule.parameters);}
this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message;},addWrapper:function(toToggle){if(this.settings.wrapper)
toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));return toToggle;},defaultShowErrors:function(){for(var i=0;this.errorList[i];i++){var error=this.errorList[i];this.settings.highlight&&this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);this.showLabel(error.element,error.message);}
if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}
if(this.settings.success){for(var i=0;this.successList[i];i++){this.showLabel(this.successList[i]);}}
if(this.settings.unhighlight){for(var i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);}}
this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return $(this.errorList).map(function(){return this.element;});},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass().addClass(this.settings.errorClass);label.attr("generated")&&label.html(message);}else{label=$("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(element),generated:true}).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper){label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}
if(!this.labelContainer.append(label).length)
this.settings.errorPlacement?this.settings.errorPlacement(label,$(element)):label.insertAfter(element);}
if(!message&&this.settings.success){label.text("");typeof this.settings.success=="string"?label.addClass(this.settings.success):this.settings.success(label);}
this.toShow=this.toShow.add(label);},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr('for')==name;});},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name);},checkable:function(element){return/radio|checkbox/i.test(element.type);},findByName:function(name){var form=this.currentForm;return $(document.getElementsByName(name)).map(function(index,element){return element.form==form&&element.name==name&&element||null;});},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case'select':return $("option:selected",element).length;case'input':if(this.checkable(element))
return this.findByName(element.name).filter(':checked').length;}
return value.length;},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true;},dependTypes:{"boolean":function(param,element){return param;},"string":function(param,element){return!!$(param,element.form).length;},"function":function(param,element){return param(element);}},optional:function(element){return!$.validator.methods.required.call(this,$.trim(element.value),element)&&"dependency-mismatch";},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true;}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0)
this.pendingRequest=0;delete this.pending[element.name];if(valid&&this.pendingRequest==0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false;}else if(!valid&&this.pendingRequest==0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false;}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){className.constructor==String?this.classRuleSettings[className]=rules:$.extend(this.classRuleSettings,className);},classRules:function(element){var rules={};var classes=$(element).attr('class');classes&&$.each(classes.split(' '),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this]);}});return rules;},attributeRules:function(element){var rules={};var $element=$(element);for(var method in $.validator.methods){var value=$element.attr(method);if(value){rules[method]=value;}}
if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength;}
return rules;},metadataRules:function(element){if(!$.metadata)return{};var meta=$.data(element.form,'validator').settings.meta;return meta?$(element).metadata()[meta]:$(element).metadata();},staticRules:function(element){var rules={};var validator=$.data(element.form,'validator');if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};}
return rules;},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return;}
if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break;}
if(keepRule){rules[prop]=val.param!==undefined?val.param:true;}else{delete rules[prop];}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter;});$.each(['minlength','maxlength','min','max'],function(){if(rules[this]){rules[this]=Number(rules[this]);}});$.each(['rangelength','range'],function(){if(rules[this]){rules[this]=[Number(rules[this][0]),Number(rules[this][1])];}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max;}
if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength;}}
if(rules.messages){delete rules.messages;}
return rules;},normalizeRule:function(data){if(typeof data=="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true;});data=transformed;}
return data;},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!=undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name));}},methods:{required:function(value,element,param){if(!this.depend(param,element))
return"dependency-mismatch";switch(element.nodeName.toLowerCase()){case'select':var val=$(element).val();return val&&val.length>0;case'input':if(this.checkable(element))
return this.getLength(value,element)>0;default:return $.trim(value).length>0;}},remote:function(value,element,param){if(this.optional(element))
return"dependency-mismatch";var previous=this.previousValue(element);if(!this.settings.messages[element.name])
this.settings.messages[element.name]={};previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param=="string"&&{url:param}||param;if(this.pending[element.name]){return"pending";}
if(previous.old===value){return previous.valid;}
previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===true;if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);validator.showErrors();}else{var errors={};var message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.showErrors(errors);}
previous.valid=valid;validator.stopRequest(element,valid);}},param));return"pending";},minlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)>=param;},maxlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)<=param;},rangelength:function(value,element,param){var length=this.getLength($.trim(value),element);return this.optional(element)||(length>=param[0]&&length<=param[1]);},min:function(value,element,param){return this.optional(element)||value>=param;},max:function(value,element,param){return this.optional(element)||value<=param;},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1]);},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value);},url:function(value,element){return this.optional(element)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value));},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(value);},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(value);},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value);},creditcard:function(value,element){if(this.optional(element))
return"dependency-mismatch";if(/[^0-9-]+/.test(value))
return false;var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);var nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9)
nDigit-=9;}
nCheck+=nDigit;bEven=!bEven;}
return(nCheck%10)==0;},accept:function(value,element,param){param=typeof param=="string"?param.replace(/,/g,'|'):"png|jpe?g|gif";return this.optional(element)||value.match(new RegExp(".("+param+")$","i"));},equalTo:function(value,element,param){var target=$(param).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid();});return value==target.val();}}});$.format=$.validator.format;})(jQuery);;(function($){var pendingRequests={};if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=xhr;}});}else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode=="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
return(pendingRequests[port]=ajax.apply(this,arguments));}
return ajax.apply(this,arguments);};}})(jQuery);;(function($){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){$.each({focus:'focusin',blur:'focusout'},function(original,fix){$.event.special[fix]={setup:function(){this.addEventListener(original,handler,true);},teardown:function(){this.removeEventListener(original,handler,true);},handler:function(e){arguments[0]=$.event.fix(e);arguments[0].type=fix;return $.event.handle.apply(this,arguments);}};function handler(e){e=$.event.fix(e);e.type=fix;return $.event.handle.call(this,e);}});};$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments);}});}});})(jQuery);;(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,jq_event_special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_location='location',str_href='href',str_src='src',re_trim_querystring=/^.*\?|#.*$/g,re_trim_fragment=/^.*\#/,re_no_escape,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(/^[^#]*#?(.*)$/,'$1');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_trim_fragment:re_trim_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?'#':qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:window[str_location][str_href]);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_trim_fragment:re_trim_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(window[str_location][str_href],has_args?params:{},has_args?merge_mode:2);window[str_location][str_href]=url+(/#/.test(url)?'':'#');};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};jq_event_special[str_hashchange]=$.extend(jq_event_special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var fake_onhashchange,jq_event_special=$.event.special,str_location='location',str_hashchange='hashchange',str_href='href',browser=$.browser,mode=document.documentMode,is_old_ie=browser.msie&&(mode===undefined||mode<8),supports_onhashchange='on'+str_hashchange in window&&!is_old_ie;function get_fragment(url){url=url||window[str_location][str_href];return url.replace(/^[^#]*#?(.*)$/,'$1');};$[str_hashchange+'Delay']=100;jq_event_special[str_hashchange]=$.extend(jq_event_special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,iframe,set_history,get_history;function init(){set_history=get_history=function(val){return val;};if(is_old_ie){iframe=$('<iframe src="javascript:0"/>').hide().insertAfter('body')[0].contentWindow;get_history=function(){return get_fragment(iframe.document[str_location][str_href]);};set_history=function(hash,history_hash){if(hash!==history_hash){var doc=iframe.document;doc.open().close();doc[str_location].hash='#'+hash;}};set_history(get_fragment());}};self.start=function(){if(timeout_id){return;}
var last_hash=get_fragment();set_history||init();(function loopy(){var hash=get_fragment(),history_hash=get_history(last_hash);if(hash!==last_hash){set_history(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){window[str_location][str_href]=window[str_location][str_href].replace(/#.*/,'')+'#'+history_hash;}
timeout_id=setTimeout(loopy,$[str_hashchange+'Delay']);})();};self.stop=function(){if(!iframe){timeout_id&&clearTimeout(timeout_id);timeout_id=0;}};return self;})();})(jQuery,this);;!function(window,document,undefined){var prefixes=['webkit','Moz','ms','O'],animations={},useCssAnimations
function createEl(tag,prop){var el=document.createElement(tag||'div'),n
for(n in prop)el[n]=prop[n]
return el}
function ins(parent){for(var i=1,n=arguments.length;i<n;i++)
parent.appendChild(arguments[i])
return parent}
var sheet=function(){var el=createEl('style',{type:'text/css'})
ins(document.getElementsByTagName('head')[0],el)
return el.sheet||el.styleSheet}()
function addAnimation(alpha,trail,i,lines){var name=['opacity',trail,~~(alpha*100),i,lines].join('-'),start=0.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf('Animation')).toLowerCase(),pre=prefix&&'-'+prefix+'-'||''
if(!animations[name]){sheet.insertRule('@'+pre+'keyframes '+name+'{'+'0%{opacity:'+z+'}'+
start+'%{opacity:'+alpha+'}'+
(start+0.01)+'%{opacity:1}'+
(start+trail)%100+'%{opacity:'+alpha+'}'+'100%{opacity:'+z+'}'+'}',sheet.cssRules.length)
animations[name]=1}
return name}
function vendor(el,prop){var s=el.style,pp,i
if(s[prop]!==undefined)return prop
prop=prop.charAt(0).toUpperCase()+prop.slice(1)
for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop
if(s[pp]!==undefined)return pp}}
function css(el,prop){for(var n in prop)
el.style[vendor(el,n)||n]=prop[n]
return el}
function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i]
for(var n in def)
if(obj[n]===undefined)obj[n]=def[n]}
return obj}
function pos(el){var o={x:el.offsetLeft,y:el.offsetTop}
while((el=el.offsetParent))
o.x+=el.offsetLeft,o.y+=el.offsetTop
return o}
var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:'#000',speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:'spinner',top:'auto',left:'auto',position:'relative'}
var Spinner=function Spinner(o){if(!this.spin)return new Spinner(o)
this.opts=merge(o||{},Spinner.defaults,defaults)}
Spinner.defaults={}
merge(Spinner.prototype,{spin:function(target){this.stop()
var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp
if(target){target.insertBefore(el,target.firstChild||null)
tp=pos(target)
ep=pos(el)
css(el,{left:(o.left=='auto'?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+'px',top:(o.top=='auto'?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+'px'})}
el.setAttribute('aria-role','progressbar')
self.lines(el,self.opts)
if(!useCssAnimations){var i=0,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var s=o.lines;s;s--){var alpha=Math.max(1-(i+s*astep)%f*ostep,o.opacity)
self.opacity(el,o.lines-s,alpha,o)}
self.timeout=self.el&&setTimeout(anim,~~(1000/fps))})()}
return self},stop:function(){var el=this.el
if(el){clearTimeout(this.timeout)
if(el.parentNode)el.parentNode.removeChild(el)
this.el=undefined}
return this},lines:function(el,o){var i=0,seg
function fill(color,shadow){return css(createEl(),{position:'absolute',width:(o.length+o.width)+'px',height:o.width+'px',background:color,boxShadow:shadow,transformOrigin:'left',transform:'rotate('+~~(360/o.lines*i+o.rotate)+'deg) translate('+o.radius+'px'+',0)',borderRadius:(o.corners*o.width>>1)+'px'})}
for(;i<o.lines;i++){seg=css(createEl(),{position:'absolute',top:1+~(o.width/2)+'px',transform:o.hwaccel?'translate3d(0,0,0)':'',opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,i,o.lines)+' '+1/o.speed+'s linear infinite'})
if(o.shadow)ins(seg,css(fill('#000','0 0 4px '+'#000'),{top:2+'px'}))
ins(el,ins(seg,fill(o.color,'0 0 1px rgba(0,0,0,.1)')))}
return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}});(function(){function vml(tag,attr){return createEl('<'+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}
var s=css(createEl('group'),{behavior:'url(#default#VML)'})
if(!vendor(s,'transform')&&s.adj){sheet.addRule('.spin-vml','behavior:url(#default#VML)')
Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r
function grp(){return css(vml('group',{coordsize:s+' '+s,coordorigin:-r+' '+-r}),{width:s,height:s})}
var margin=-(o.width+o.length)*2+'px',g=css(grp(),{position:'absolute',top:margin,left:margin}),i
function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+'deg',left:~~dx}),ins(css(vml('roundrect',{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml('fill',{color:o.color,opacity:o.opacity}),vml('stroke',{opacity:0}))))}
if(o.shadow)
for(i=1;i<=o.lines;i++)
seg(i,-2,'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)')
for(i=1;i<=o.lines;i++)seg(i)
return ins(el,g)}
Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild
o=o.shadow&&o.lines||0
if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild
if(c)c.opacity=val}}}
else
useCssAnimations=vendor(s,'animation')})()
if(typeof define=='function'&&define.amd)
define(function(){return Spinner})
else
window.Spinner=Spinner}(window,document);;(function($){var
hidden='hidden',borderBox='border-box',lineHeight='lineHeight',copy='<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden">',copyStyle=['fontFamily','fontSize','fontWeight','fontStyle','letterSpacing','textTransform','wordSpacing','textIndent'],oninput='oninput',onpropertychange='onpropertychange',test=$(copy)[0];test.setAttribute(oninput,"return");if($.isFunction(test[oninput])||onpropertychange in test){$(test).css(lineHeight,'99px');if($(test).css(lineHeight)==='99px'){copyStyle.push(lineHeight);}
$.fn.autosize=function(className){return this.each(function(){var
ta=this,$ta=$(ta),mirror,minHeight=$ta.height(),maxHeight=parseInt($ta.css('maxHeight'),10),active,i=copyStyle.length,resize,boxOffset=0;if($ta.css('box-sizing')===borderBox||$ta.css('-moz-box-sizing')===borderBox||$ta.css('-webkit-box-sizing')===borderBox){boxOffset=$ta.outerHeight()-$ta.height();}
if($ta.data('mirror')||$ta.data('ismirror')){return;}else{mirror=$(copy).data('ismirror',true).addClass(className||'autosizejs')[0];if($ta.attr('disabled')){$ta.css('resize','none');}
resize=$ta.css('resize')==='none'?'none':'vertical';$ta.data('mirror',$(mirror)).css({overflow:hidden,overflowY:hidden,wordWrap:'break-word',resize:resize});}
maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4;function adjust(){var height,overflow;if(!active){active=true;mirror.value=ta.value;mirror.style.overflowY=ta.style.overflowY;mirror.style.width=$ta.css('width');mirror.scrollTop=0;mirror.scrollTop=9e4;height=mirror.scrollTop;overflow=hidden;if(height>maxHeight){height=maxHeight;overflow='scroll';}else if(height<minHeight){height=minHeight;}
ta.style.overflowY=overflow;ta.style.height=height+boxOffset+'px';setTimeout(function(){active=false;},1);}}
while(i--){mirror.style[copyStyle[i]]=$ta.css(copyStyle[i]);}
$('body').append(mirror);if(onpropertychange in ta){if(oninput in ta){ta[oninput]=ta.onkeyup=adjust;}else{ta[onpropertychange]=adjust;}}else{ta[oninput]=adjust;}
$(window).resize(adjust);$ta.bind('autosize',adjust);adjust();});};}else{$.fn.autosize=function(){return this;};}}(jQuery));;;(function($){if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery)){alert('blockUI requires jQuery v1.2.3 or later!  You are using v'+$.fn.jquery);return;}
$.fn._fadeIn=$.fn.fadeIn;var noOp=function(){};var mode=document.documentMode||0;var setExpr=$.browser.msie&&(($.browser.version<8&&!mode)||mode<8);var ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!mode;$.blockUI=function(opts){install(window,opts);};$.unblockUI=function(opts){remove(window,opts);};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append('<h1>'+title+'</h1>');if(message)$m.append('<h2>'+message+'</h2>');if(timeout==undefined)timeout=3000;$.blockUI({message:$m,fadeIn:700,fadeOut:1000,centerY:false,timeout:timeout,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS});};$.fn.block=function(opts){return this.unblock({fadeOut:0}).each(function(){if($.css(this,'position')=='static')
this.style.position='relative';if($.browser.msie)
this.style.zoom=1;install(this,opts);});};$.fn.unblock=function(opts){return this.each(function(){remove(this,opts);});};$.blockUI.version=2.39;$.blockUI.defaults={message:'<h1>Please wait...</h1>',title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:'30%',top:'40%',left:'35%',textAlign:'center',color:'#000',border:'3px solid #aaa',backgroundColor:'#fff',cursor:'wait'},themedCSS:{width:'30%',top:'40%',left:'35%'},overlayCSS:{backgroundColor:'#000',opacity:0.6,cursor:'wait'},growlCSS:{width:'350px',top:'10px',left:'',right:'10px',border:'none',padding:'5px',opacity:0.6,cursor:'default',color:'#fff',backgroundColor:'#000','-webkit-border-radius':'10px','-moz-border-radius':'10px','border-radius':'10px'},iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank',forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,applyPlatformOpacityRules:true,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4,blockMsgClass:'blockMsg'};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var full=(el==window);var msg=opts&&opts.message!==undefined?opts.message:undefined;opts=$.extend({},$.blockUI.defaults,opts||{});opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});var css=$.extend({},$.blockUI.defaults.css,opts.css||{});var themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)
remove(window,{fadeOut:0});if(msg&&typeof msg!='string'&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data('blockUI.history',data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)
data.parent.removeChild(node);}
$(el).data('blockUI.onUnblock',opts.onUnblock);var z=opts.baseZ;var lyr1=($.browser.msie||opts.forceIframe)?$('<iframe class="blockUI" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>'):$('<div class="blockUI" style="display:none"></div>');var lyr2=opts.theme?$('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+(z++)+';display:none"></div>'):$('<div class="blockUI blockOverlay" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var lyr3,s;if(opts.theme&&full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">'+'<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';}
else if(opts.theme){s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">'+'<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';}
else if(full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>';}
else{s='<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>';}
lyr3=$(s);if(msg){if(opts.theme){lyr3.css(themedCSS);lyr3.addClass('ui-widget-content');}
else
lyr3.css(css);}
if(!opts.theme&&(!opts.applyPlatformOpacityRules||!($.browser.mozilla&&/Linux/.test(navigator.platform))))
lyr2.css(opts.overlayCSS);lyr2.css('position',full?'fixed':'absolute');if($.browser.msie||opts.forceIframe)
lyr1.css('opacity',0.0);var layers=[lyr1,lyr2,lyr3],$par=full?$('body'):$(el);$.each(layers,function(){this.appendTo($par);});if(opts.theme&&opts.draggable&&$.fn.draggable){lyr3.draggable({handle:'.ui-dialog-titlebar',cancel:'li'});}
var expr=setExpr&&(!$.boxModel||$('object,embed',full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.boxModel)
$('html,body').css('height','100%');if((ie6||!$.boxModel)&&!full){var t=sz(el,'borderTopWidth'),l=sz(el,'borderLeftWidth');var fixT=t?'(0 - '+t+')':0;var fixL=l?'(0 - '+l+')':0;}
$.each([lyr1,lyr2,lyr3],function(i,o){var s=o[0].style;s.position='absolute';if(i<2){full?s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression('height','this.parentNode.offsetHeight + "px"');full?s.setExpression('width','jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression('width','this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression('left',fixL);if(fixT)s.setExpression('top',fixT);}
else if(opts.centerY){if(full)s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0;}
else if(!opts.centerY&&full){var top=(opts.css&&opts.css.top)?parseInt(opts.css.top):0;var expression='((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';s.setExpression('top',expression);}});}
if(msg){if(opts.theme)
lyr3.find('.ui-widget-content').append(msg);else
lyr3.append(msg);if(msg.jquery||msg.nodeType)
$(msg).show();}
if(($.browser.msie||opts.forceIframe)&&opts.showOverlay)
lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=(opts.showOverlay&&!msg)?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)
lyr2._fadeIn(opts.fadeIn,cb1);if(msg)
lyr3._fadeIn(opts.fadeIn,cb2);}
else{if(opts.showOverlay)
lyr2.show();if(msg)
lyr3.show();if(opts.onBlock)
opts.onBlock();}
bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(':input:enabled:visible',pageBlock);if(opts.focusInput)
setTimeout(focus,20);}
else
center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts);},opts.timeout);$(el).data('blockUI.timeout',to);}};function remove(el,opts){var full=(el==window);var $el=$(el);var data=$el.data('blockUI.history');var to=$el.data('blockUI.timeout');if(to){clearTimeout(to);$el.removeData('blockUI.timeout');}
opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);if(opts.onUnblock===null){opts.onUnblock=$el.data('blockUI.onUnblock');$el.removeData('blockUI.onUnblock');}
var els;if(full)
els=$('body').children().filter('.blockUI').add('body > .blockUI');else
els=$('.blockUI',el);if(full)
pageBlock=pageBlockEls=null;if(opts.fadeOut){els.fadeOut(opts.fadeOut);setTimeout(function(){reset(els,data,opts,el);},opts.fadeOut);}
else
reset(els,data,opts,el);};function reset(els,data,opts,el){els.each(function(i,o){if(this.parentNode)
this.parentNode.removeChild(this);});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;if(data.parent)
data.parent.appendChild(data.el);$(el).removeData('blockUI.history');}
if(typeof opts.onUnblock=='function')
opts.onUnblock(el,opts);};function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data('blockUI.isBlocked')))
return;if(!full)
$el.data('blockUI.isBlocked',b);if(!opts.bindEvents||(b&&!opts.showOverlay))
return;var events='mousedown mouseup keydown keypress';b?$(document).bind(events,opts,handler):$(document).unbind(events,handler);};function handler(e){if(e.keyCode&&e.keyCode==9){if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target===els[els.length-1];var back=e.shiftKey&&e.target===els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false;}}}
var opts=e.data;if($(e.target).parents('div.'+opts.blockMsgClass).length>0)
return true;return $(e.target).parents().children().filter('div.blockUI').length==0;};function focus(back){if(!pageBlockEls)
return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)
e.focus();};function center(el,x,y){var p=el.parentNode,s=el.style;var l=((p.offsetWidth-el.offsetWidth)/2)-sz(p,'borderLeftWidth');var t=((p.offsetHeight-el.offsetHeight)/2)-sz(p,'borderTopWidth');if(x)s.left=l>0?(l+'px'):'0';if(y)s.top=t>0?(t+'px'):'0';};function sz(el,p){return parseInt($.css(el,p))||0;};})(jQuery);;;(function(window,document,$){var isInputSupported='placeholder'in document.createElement('input'),isTextareaSupported='placeholder'in document.createElement('textarea'),prototype=$.fn,valHooks=$.valHooks,hooks,placeholder;if(isInputSupported&&isTextareaSupported){placeholder=prototype.placeholder=function(){return this;};placeholder.input=placeholder.textarea=true;}else{placeholder=prototype.placeholder=function(){var $this=this;$this.filter((isInputSupported?'textarea':':input')+'[placeholder]').not('.placeholder').bind({'focus.placeholder':clearPlaceholder,'blur.placeholder':setPlaceholder}).data('placeholder-enabled',true).trigger('blur.placeholder');return $this;};placeholder.input=isInputSupported;placeholder.textarea=isTextareaSupported;hooks={'get':function(element){var $element=$(element);return $element.data('placeholder-enabled')&&$element.hasClass('placeholder')?'':element.value;},'set':function(element,value){var $element=$(element);if(!$element.data('placeholder-enabled')){return element.value=value;}
if(value==''){element.value=value;if(element!=document.activeElement){setPlaceholder.call(element);}}else if($element.hasClass('placeholder')){clearPlaceholder.call(element,true,value)||(element.value=value);}else{element.value=value;}
return $element;}};isInputSupported||(valHooks.input=hooks);isTextareaSupported||(valHooks.textarea=hooks);$(function(){$(document).delegate('form','submit.placeholder',function(){var $inputs=$('.placeholder',this).each(clearPlaceholder);setTimeout(function(){$inputs.each(setPlaceholder);},10);});});$(window).bind('beforeunload.placeholder',function(){$('.placeholder').each(function(){this.value='';});});}
function args(elem){var newAttrs={},rinlinejQuery=/^jQuery\d+$/;$.each(elem.attributes,function(i,attr){if(attr.specified&&!rinlinejQuery.test(attr.name)){newAttrs[attr.name]=attr.value;}});return newAttrs;}
function clearPlaceholder(event,value){var input=this,$input=$(input);if(input.value==$input.attr('placeholder')&&$input.hasClass('placeholder')){if($input.data('placeholder-password')){$input=$input.hide().next().show().attr('id',$input.removeAttr('id').data('placeholder-id'));if(event===true){return $input[0].value=value;}
$input.focus();}else{input.value='';$input.removeClass('placeholder');input==document.activeElement&&input.select();}}}
function setPlaceholder(){var $replacement,input=this,$input=$(input),$origInput=$input,id=this.id;if(input.value==''){if(input.type=='password'){if(!$input.data('placeholder-textinput')){try{$replacement=$input.clone().attr({'type':'text'});}catch(e){$replacement=$('<input>').attr($.extend(args(this),{'type':'text'}));}
$replacement.removeAttr('name').data({'placeholder-password':true,'placeholder-id':id}).bind('focus.placeholder',clearPlaceholder);$input.data({'placeholder-textinput':$replacement,'placeholder-id':id}).before($replacement);}
$input=$input.removeAttr('id').hide().prev().attr('id',id).show();}
$input.addClass('placeholder');$input[0].value=$input.attr('placeholder');}else{$input.removeClass('placeholder');}}}(this,document,jQuery));;(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};if($.ui.version){return;}
$.extend($.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):this._focus.apply(this,arguments);},scrollParent:function(){var scrollParent;if(($.ui.ie&&(/(static|relative)/).test(this.css('position')))||(/absolute/).test(this.css('position'))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.css(this,'position'))&&(/(auto|scroll)/).test($.css(this,'overflow')+$.css(this,'overflow-y')+$.css(this,'overflow-x'));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.css(this,'overflow')+$.css(this,'overflow-y')+$.css(this,'overflow-x'));}).eq(0);}
return(/fixed/).test(this.css('position'))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id");}});}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}
if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}
function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}
$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));div.offsetHeight;$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart"in div;body.removeChild(div).style.display="none";});(function(){var uaMatch=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];$.ui.ie=uaMatch.length?true:false;$.ui.ie6=parseFloat(uaMatch[1],10)===6;})();$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},contains:$.contains,hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},isOverAxis:function(x,reference,size){return(x>reference)&&(x<(reference+size));},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width);}});})(jQuery);(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove");}catch(e){}}
_cleanData(elems);};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if($.isFunction(value)){prototype[prop]=(function(){var _super=function(){return base.prototype[prop].apply(this,arguments);},_superApply=function(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();}});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:basePrototype.widgetEventPrefix||name},prototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetBaseClass:fullName,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init();}else{new object(options,this);}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetName,this);$.data(element,this.widgetFullName,this);this._on(this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this._create();this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(value===undefined){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(value===undefined){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}
return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_on:function(element,handlers){var delegateElement,instance=this;if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(instance.options.disabled===true||$(this).hasClass("ui-state-disabled")){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName);},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&($.effects.effect[effectName]||$.uiBackCompat!==false&&$.effects[effectName])){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});if($.uiBackCompat!==false){$.Widget.prototype._getCreateOptions=function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName];};}})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mouseup(function(e){mouseHandled=false;});$.widget("ui.mouse",{version:"1.9.1",options:{cancel:'input,textarea,button,select,option',distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind('mousedown.'+this.widgetName,function(event){return that._mouseDown(event);}).bind('click.'+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+'.preventClickEvent')){$.removeData(event.target,that.widgetName+'.preventClickEvent');event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind('.'+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+'.preventClickEvent')){$.removeData(event.target,this.widgetName+'.preventClickEvent');}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};$(document).bind('mousemove.'+this.widgetName,this._mouseMoveDelegate).bind('mouseup.'+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.ui.ie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+'.preventClickEvent',true);}
this._mouseStop(event);}
return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(event){return this.mouseDelayMet;},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return true;}});})(jQuery);(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseInt(offsets[0],10)*(rpercent.test(offsets[0])?width/100:1),parseInt(offsets[1],10)*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow?"":within.element.css("overflow-x"),overflowY=within.isWindow?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowX?$.position.scrollbarWidth():0,height:hasOverflowY?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]);return{element:withinElement,isWindow:isWindow,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),targetElem=target[0],collision=(options.collision||"flip").split(" "),offsets={};if(targetElem.nodeType===9){targetWidth=target.width();targetHeight=target.height();targetOffset={top:0,left:0};}else if($.isWindow(targetElem)){targetWidth=target.width();targetHeight=target.height();targetOffset={top:target.scrollTop(),left:target.scrollLeft()};}else if(targetElem.preventDefault){options.at="left top";targetWidth=targetHeight=0;targetOffset={top:targetElem.pageY,left:targetElem.pageX};}else{targetWidth=target.outerWidth();targetHeight=target.outerHeight();targetOffset=target.offset();}
basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top);}
collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if($.fn.bgiframe){elem.bgiframe();}
if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}
else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if((position.top+myOffset+atOffset+offset)>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset;}}
else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if((position.top+myOffset+atOffset+offset)>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}
for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}
testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();if($.uiBackCompat!==false){(function($){var _position=$.fn.position;$.fn.position=function(options){if(!options||!options.offset){return _position.call(this,options);}
var offset=options.offset.split(" "),at=options.at.split(" ");if(offset.length===1){offset[1]=offset[0];}
if(/^\d/.test(offset[0])){offset[0]="+"+offset[0];}
if(/^\d/.test(offset[1])){offset[1]="+"+offset[1];}
if(at.length===1){if(/left|center|right/.test(at[0])){at[1]="center";}else{at[1]=at[0];at[0]="center";}}
return _position.call(this,$.extend(options,{at:at[0]+offset[0]+" "+at[1]+offset[1],offset:undefined}));};}(jQuery));}}(jQuery));(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=='original'&&!(/^(?:r|a|f)/).test(this.element.css("position")))
this.element[0].style.position='relative';(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit();},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).is('.ui-resizable-handle'))
return false;this.handle=this._getHandle(event);if(!this.handle)
return false;$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body");});return true;},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager)
$.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));if(o.containment)
this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this._mouseDrag(event,true);if($.ui.ddmanager)$.ui.ddmanager.dragStart(this,event);return true;},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger('drag',event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);return false;},_mouseStop:function(event){var dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour)
dropped=$.ui.ddmanager.drop(this,event);if(this.dropped){dropped=this.dropped;this.dropped=false;}
var element=this.element[0],elementInDom=false;while(element&&(element=element.parentNode)){if(element==document){elementInDom=true;}}
if(!elementInDom&&this.options.helper==="original")
return false;if((this.options.revert=="invalid"&&!dropped)||(this.options.revert=="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){var that=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});if($.ui.ddmanager)$.ui.ddmanager.dragStop(this,event);return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?true:false;$(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==event.target)handle=true;});return handle;},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper=='clone'?this.element.clone().removeAttr('id'):this.element);if(!helper.parents('body').length)
helper.appendTo((o.appendTo=='parent'?this.element[0].parentNode:o.appendTo));if(helper[0]!=this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position")))
helper.css("position","absolute");return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.ui.ie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[o.containment=='document'?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=='document'?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=='document'?0:$(window).scrollLeft())+$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=='document'?0:$(window).scrollTop())+($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment);var ce=c[0];if(!ce)return;var co=c.offset();var over=($(ce).css("overflow")!='hidden');this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c;}else if(o.containment.constructor==Array){this.containment=o.containment;}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}
else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0])pageX=containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<containment[1])pageY=containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>containment[2])pageX=containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>containment[3])pageY=containment[3]+this.offset.click.top;}
if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?(!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:(!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?(!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:(!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type=="drag")this.positionAbs=this._convertPositionTo("absolute");return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,'sortable');if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper=='original')
this.instance.currentItem.css({top:'auto',left:'auto'});}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui){var inst=$(this).data("draggable"),that=this;var checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left;var itemHeight=o.height,itemWidth=o.width;var itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth);};$.each(inst.sortables,function(i){var innermostIntersecting=false;var thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=true;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this!=thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.ui.contains(thisSortable.instance.element[0],this.instance.element[0]))
innermostIntersecting=false;return innermostIntersecting;});}
if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(that).clone().removeAttr('id').appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0];};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst;}
if(this.instance.currentItem)this.instance._mouseDrag(event);}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger('out',event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();inst._trigger("fromSortable",event);inst.dropped=false;}};});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$('body'),o=$(this).data('draggable').options;if(t.css("cursor"))o._cursor=t.css("cursor");t.css("cursor",o.cursor);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._cursor)$('body').css("cursor",o._cursor);}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data('draggable').options;if(t.css("opacity"))o._opacity=t.css("opacity");t.css('opacity',o.opacity);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._opacity)$(ui.helper).css('opacity',o._opacity);}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML')i.overflowOffset=i.scrollParent.offset();},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML'){if(!o.axis||o.axis!='x'){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed;}
if(!o.axis||o.axis!='y'){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(!o.axis||o.axis!='x'){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}
if(!o.axis||o.axis!='y'){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(i,event);}});$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!=String?(o.snap.items||':data(draggable)'):o.snap).each(function(){var $t=$(this);var $o=$t.offset();if(this!=i.element[0])i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});});},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options;var d=o.snapTolerance;var x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!((l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d)||(l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d)||(l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d)||(l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d))){if(inst.snapElements[i].snapping)(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!='inner'){var ts=Math.abs(t-y2)<=d;var bs=Math.abs(b-y1)<=d;var ls=Math.abs(l-x2)<=d;var rs=Math.abs(r-x1)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left;}
var first=(ts||bs||ls||rs);if(o.snapMode!='outer'){var ts=Math.abs(t-y1)<=d;var bs=Math.abs(b-y2)<=d;var ls=Math.abs(l-x1)<=d;var rs=Math.abs(r-x2)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left;}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first))
(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=(ts||bs||ls||rs||first);};}});$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options;var group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i;});this[0].style.zIndex=min+group.length;}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("zIndex"))o._zIndex=t.css("zIndex");t.css('zIndex',o.zIndex);},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._zIndex)$(ui.helper).css('zIndex',o._zIndex);}});})(jQuery);(function($,undefined){$.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:'*',activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:'default',tolerance:'intersect'},_create:function(){var o=this.options,accept=o.accept;this.isover=0;this.isout=1;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);(o.addClasses&&this.element.addClass("ui-droppable"));},_destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];for(var i=0;i<drop.length;i++)
if(drop[i]==this)
drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled");},_setOption:function(key,value){if(key=='accept'){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}
$.Widget.prototype._setOption.apply(this,arguments);},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);(draggable&&this._trigger('activate',event,this.ui(draggable)));},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);(draggable&&this._trigger('deactivate',event,this.ui(draggable)));},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger('over',event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('out',event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return false;var childrenIntersection=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,'droppable');if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false;}});if(childrenIntersection)return false;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('drop',event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};}});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return false;var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height;var l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case'fit':return(l<=x1&&x2<=r&&t<=y1&&y2<=b);break;case'intersect':return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);break;case'pointer':var draggableLeft=((draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left),draggableTop=((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top),isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;break;case'touch':return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));break;default:return false;break;}};$.ui.ddmanager={current:null,droppables:{'default':[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[];var type=event?event.type:null;var list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element))))continue;for(var j=0;j<list.length;j++){if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop;}};m[i].visible=m[i].element.css("display")!="none";if(!m[i].visible)continue;if(type=="mousedown")m[i]._activate.call(m[i],event);m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight};}},drop:function(draggable,event){var dropped=false;$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance))
dropped=this._drop.call(this,event)||dropped;if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=1;this.isover=0;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);});},drag:function(draggable,event){if(draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var intersects=$.ui.intersect(draggable,this,this.options.tolerance);var c=!intersects&&this.isover==1?'isout':(intersects&&this.isover==0?'isover':null);if(!c)return;var parentInstance;if(this.options.greedy){var scope=this.options.scope;var parent=this.element.parents(':data(droppable)').filter(function(){return $.data(this,'droppable').options.scope===scope;});if(parent.length){parentInstance=$.data(parent[0],'droppable');parentInstance.greedyChild=(c=='isover'?1:0);}}
if(parentInstance&&c=='isover'){parentInstance['isover']=0;parentInstance['isout']=1;parentInstance._out.call(parentInstance,event);}
this[c]=1;this[c=='isout'?'isover':'isout']=0;this[c=="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c=='isout'){parentInstance['isout']=0;parentInstance['isover']=1;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);}};})(jQuery);(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var that=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data("resizable",this.element.data('resizable'));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css({margin:this.originalElement.css('margin')});this._proportionallyResize();}
this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?"e,s,se":{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});if(this.handles.constructor==String){if(this.handles=='all')this.handles='n,e,s,w,se,sw,ne,nw';var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname='ui-resizable-'+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');axis.css({zIndex:o.zIndex});if('se'==handle){axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');};this.handles[handle]='.ui-resizable-'+handle;this.element.append(axis);}}
this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)
this.handles[i]=$(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
if(!$(this.handles[i]).length)
continue;}};this._renderAxis(this.element);this._handles=$('.ui-resizable-handle',this.element).disableSelection();this._handles.mouseover(function(){if(!that.resizing){if(this.className)
var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);that.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(o.disabled)return;$(this).removeClass("ui-resizable-autohide");that._handles.show();}).mouseleave(function(){if(o.disabled)return;if(!that.resizing){$(this).addClass("ui-resizable-autohide");that._handles.hide();}});}
this._mouseInit();},_destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find('.ui-resizable-handle').remove();};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')}).insertAfter(wrapper);wrapper.remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true;}}
return!this.options.disabled&&handle;},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is('.ui-draggable')||(/absolute/).test(el.css('position'))){el.css({position:'absolute',top:iniPos.top,left:iniPos.left});}
this._renderProxy();var curleft=num(this.helper.css('left')),curtop=num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor=='auto'?this.axis+'-resize':cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},that=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger)return false;var data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey)
data=this._updateRatio(data,event);data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)
this._proportionallyResize();this._updateCache(data);this._trigger('resize',event,this.ui());return false;},_mouseStop:function(event){this.resizing=false;var o=this.options,that=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width;var s={width:(that.helper.width()-soffsetw),height:(that.helper.height()-soffseth)},left=(parseInt(that.element.css('left'),10)+(that.position.left-that.originalPosition.left))||null,top=(parseInt(that.element.css('top'),10)+(that.position.top-that.originalPosition.top))||null;if(!o.animate)
this.element.css($.extend(s,{top:top,left:left}));that.helper.height(that.size.height);that.helper.width(that.size.width);if(this._helper&&!o.animate)this._proportionallyResize();}
$('body').css('cursor','auto');this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper)this.helper.remove();return false;},_updateVirtualBoundaries:function(forceAspectRatio){var o=this.options,pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth)b.minWidth=pMinWidth;if(pMinHeight>b.minHeight)b.minHeight=pMinHeight;if(pMaxWidth<b.maxWidth)b.maxWidth=pMaxWidth;if(pMaxHeight<b.maxHeight)b.maxHeight=pMaxHeight;}
this._vBoundaries=b;},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left))this.position.left=data.left;if(isNumber(data.top))this.position.top=data.top;if(isNumber(data.height))this.size.height=data.height;if(isNumber(data.width))this.size.width=data.width;},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(isNumber(data.height))data.width=(data.height*this.aspectRatio);else if(isNumber(data.width))data.height=(data.width/this.aspectRatio);if(a=='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a=='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data,event){var el=this.helper,o=this._vBoundaries,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw)data.width=o.minWidth;if(isminh)data.height=o.minHeight;if(ismaxw)data.width=o.maxWidth;if(ismaxh)data.height=o.maxHeight;var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw)data.left=dw-o.minWidth;if(ismaxw&&cw)data.left=dw-o.maxWidth;if(isminh&&ch)data.top=dh-o.minHeight;if(ismaxh&&ch)data.top=dh-o.maxHeight;var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top)data.top=null;else if(isNotwh&&!data.top&&data.left)data.left=null;return data;},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length)return;var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css('borderTopWidth'),prel.css('borderRightWidth'),prel.css('borderBottomWidth'),prel.css('borderLeftWidth')],p=[prel.css('paddingTop'),prel.css('paddingRight'),prel.css('paddingBottom'),prel.css('paddingLeft')];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding;});}
prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0});};},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6offset=($.ui.ie6?1:0),pxyoffset=($.ui.ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:'absolute',left:this.elementOffset.left-ie6offset+'px',top:this.elementOffset.top-ie6offset+'px',zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx};},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var that=$(this).data("resizable"),o=that.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css('left'),10),top:parseInt(el.css('top'),10)});});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize);}
else{$.each(o.alsoResize,function(exp){_store(exp);});}}else{_store(o.alsoResize);}},resize:function(event,ui){var that=$(this).data("resizable"),o=that.options,os=that.originalSize,op=that.originalPosition;var delta={height:(that.size.height-os.height)||0,width:(that.size.width-os.width)||0,top:(that.position.top-op.top)||0,left:(that.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0)
style[prop]=sum||null;});el.css(style);});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c);});}else{_alsoResize(o.alsoResize);}},stop:function(event,ui){$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var that=$(this).data("resizable"),o=that.options;var pr=that._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width;var style={width:(that.size.width-soffsetw),height:(that.size.height-soffseth)},left=(parseInt(that.element.css('left'),10)+(that.position.left-that.originalPosition.left))||null,top=(parseInt(that.element.css('top'),10)+(that.position.top-that.originalPosition.top))||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(that.element.css('width'),10),height:parseInt(that.element.css('height'),10),top:parseInt(that.element.css('top'),10),left:parseInt(that.element.css('left'),10)};if(pr&&pr.length)$(pr[0]).css({width:data.width,height:data.height});that._updateCache(data);that._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var that=$(this).data("resizable"),o=that.options,el=that.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce)return;that.containerElement=$(ce);if(/document/.test(oc)||oc==document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}
else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name));});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=that.containerOffset,ch=that.containerSize.height,cw=that.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event,ui){var that=$(this).data("resizable"),o=that.options,ps=that.containerSize,co=that.containerOffset,cs=that.size,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement;if(ce[0]!=document&&(/static/).test(ce.css('position')))cop=co;if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+(that._helper?(that.position.left-co.left):(that.position.left-cop.left));if(pRatio)that.size.height=that.size.width/that.aspectRatio;that.position.left=o.helper?co.left:0;}
if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+(that._helper?(that.position.top-co.top):that.position.top);if(pRatio)that.size.width=that.size.height*that.aspectRatio;that.position.top=that._helper?co.top:0;}
that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;var woset=Math.abs((that._helper?that.offset.left-cop.left:(that.offset.left-cop.left))+that.sizeDiff.width),hoset=Math.abs((that._helper?that.offset.top-cop.top:(that.offset.top-co.top))+that.sizeDiff.height);var isParent=that.containerElement.get(0)==that.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(that.containerElement.css('position'));if(isParent&&isOffsetRelative)woset-=that.parentData.left;if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;if(pRatio)that.size.height=that.size.width/that.aspectRatio;}
if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;if(pRatio)that.size.width=that.size.height*that.aspectRatio;}},stop:function(event,ui){var that=$(this).data("resizable"),o=that.options,cp=that.position,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement;var helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;if(that._helper&&!o.animate&&(/relative/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});if(that._helper&&!o.animate&&(/static/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var that=$(this).data("resizable"),o=that.options,cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass('ui-resizable-ghost').addClass(typeof o.ghost=='string'?o.ghost:'');that.ghost.appendTo(that.helper);},resize:function(event,ui){var that=$(this).data("resizable"),o=that.options;if(that.ghost)that.ghost.css({position:'relative',height:that.size.height,width:that.size.width});},stop:function(event,ui){var that=$(this).data("resizable"),o=that.options;if(that.ghost&&that.helper)that.helper.get(0).removeChild(that.ghost.get(0));}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var that=$(this).data("resizable"),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){that.size.width=os.width+ox;that.size.height=os.height+oy;}
else if(/^(ne)$/.test(a)){that.size.width=os.width+ox;that.size.height=os.height+oy;that.position.top=op.top-oy;}
else if(/^(sw)$/.test(a)){that.size.width=os.width+ox;that.size.height=os.height+oy;that.position.left=op.left-ox;}
else{that.size.width=os.width+ox;that.size.height=os.height+oy;that.position.top=op.top-oy;that.position.left=op.left-ox;}}});var num=function(v){return parseInt(v,10)||0;};var isNumber=function(value){return!isNaN(parseInt(value,10));};})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{version:"1.9.1",options:{appendTo:'body',autoRefresh:true,distance:0,filter:'*',tolerance:'touch'},_create:function(){var that=this;this.element.addClass("ui-selectable");this.dragged=false;var selectees;this.refresh=function(){selectees=$(that.options.filter,that.element[0]);selectees.addClass("ui-selectee");selectees.each(function(){var $this=$(this);var pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass('ui-selected'),selecting:$this.hasClass('ui-selecting'),unselecting:$this.hasClass('ui-unselecting')});});};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>");},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled");this._mouseDestroy();},_mouseStart:function(event){var that=this;this.opos=[event.pageX,event.pageY];if(this.options.disabled)
return;var options=this.options;this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.clientX,"top":event.clientY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter('.ui-selected').each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey&&!event.ctrlKey){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().andSelf().each(function(){var selectee=$.data(this,"selectable-item");if(selectee){var doSelect=(!event.metaKey&&!event.ctrlKey)||!selectee.$element.hasClass('ui-selected');selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){that._trigger("selecting",event,{selecting:selectee.element});}else{that._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){var that=this;this.dragged=true;if(this.options.disabled)
return;var options=this.options;var x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){var tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){var tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item");if(!selectee||selectee.element==that.element[0])
return;var hit=false;if(options.tolerance=='touch'){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1));}else if(options.tolerance=='fit'){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2);}
if(hit){if(selectee.selected){selectee.$element.removeClass('ui-selected');selectee.selected=false;}
if(selectee.unselecting){selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;}
if(!selectee.selecting){selectee.$element.addClass('ui-selecting');selectee.selecting=true;that._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if((event.metaKey||event.ctrlKey)&&selectee.startselected){selectee.$element.removeClass('ui-selecting');selectee.selecting=false;selectee.$element.addClass('ui-selected');selectee.selected=true;}else{selectee.$element.removeClass('ui-selecting');selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;}
that._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!event.ctrlKey&&!selectee.startselected){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var that=this;this.dragged=false;var options=this.options;$('.ui-unselecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;selectee.startselected=false;that._trigger("unselected",event,{unselected:selectee.element});});$('.ui-selecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-selecting').addClass('ui-selected');selectee.selecting=false;selectee.selected=true;selectee.startselected=true;that._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==='x'||(/left|right/).test(this.items[0].item.css('float'))||(/inline|table-cell/).test(this.items[0].item.css('display')):false;this.offset=this.element.offset();this._mouseInit();this.ready=true},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)
this.items[i].item.removeData(this.widgetName+"-item");return this;},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget().toggleClass("ui-sortable-disabled",!!value);}else{$.Widget.prototype._setOption.apply(this,arguments);}},_mouseCapture:function(event,overrideHandle){var that=this;if(this.reverting){return false;}
if(this.options.disabled||this.options.type=='static')return false;this._refreshItems(event);var currentItem=null,nodes=$(event.target).parents().each(function(){if($.data(this,that.widgetName+'-item')==that){currentItem=$(this);return false;}});if($.data(event.target,that.widgetName+'-item')==that)currentItem=$(event.target);if(!currentItem)return false;if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target)validHandle=true;});if(!validHandle)return false;}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment)
this._setContainment();if(o.cursor){if($('body').css("cursor"))this._storedCursor=$('body').css("cursor");$('body').css("cursor",o.cursor);}
if(o.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML')
this.overflowOffset=this.scrollParent.offset();this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions)
this._cacheHelperProportions();if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this));}}
if($.ui.ddmanager)
$.ui.ddmanager.current=this;if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection)continue;if(item.instance!==this.currentContainer)continue;if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type=='semi-dynamic'?!$.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event)return;if($.ui.ddmanager&&!this.options.dropBehaviour)
$.ui.ddmanager.drop(this,event);if(this.options.revert){var that=this;var cur=this.placeholder.offset();this.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){that._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else
this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[-=_](.+)/));if(res)str.push((o.key||res[1]+'[]')+'='+(o.key&&o.expression?res[1]:res[2]));});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=(this.options.axis==='x')||$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=(this.options.axis==='y')||$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement)
return false;return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],this.widgetName);if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),inst]);}};};}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this);});};return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]==item.item[0])
return false;};return true;});},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith&&this.ready){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],this.widgetName);if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}};};}
for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data(this.widgetName+'-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});};};},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance!=this.currentContainer&&this.currentContainer&&item.item[0]!=this.currentItem[0])
continue;var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
var p=t.offset();item.left=p.left;item.top=p.top;};if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();};}
return this;},_createPlaceholder:function(that){that=that||this;var o=that.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(that.currentItem[0].nodeName)).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className)
el.style.visibility="hidden";return el;},update:function(container,p){if(className&&!o.forcePlaceholderSize)return;if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css('paddingTop')||0,10)-parseInt(that.currentItem.css('paddingBottom')||0,10));};if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css('paddingLeft')||0,10)-parseInt(that.currentItem.css('paddingRight')||0,10));};}};}
that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder);},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0]))
continue;if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))
continue;innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer)return;if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}else{var dist=10000;var itemWithLeastDistance=null;var posProperty=this.containers[innermostIndex].floating?'left':'top';var sizeProperty=this.containers[innermostIndex].floating?'width':'height';var base=this.positionAbs[posProperty]+this.offset.click[posProperty];for(var j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0]))continue;if(this.items[j].item[0]==this.currentItem[0])continue;var cur=this.items[j].item.offset()[posProperty];var nearBottom=false;if(Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)){nearBottom=true;cur+=this.items[j][sizeProperty];}
if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down";}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty)
return;this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length)
$(o.appendTo!='parent'?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);if(helper[0]==this.currentItem[0])
this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(helper[0].style.width==''||o.forceHelperSize)helper.width(this.currentItem.width());if(helper[0].style.height==''||o.forceHelperSize)helper.height(this.currentItem.height());return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.ui.ie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!='hidden');this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=='relative'&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0])pageX=this.containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<this.containment[1])pageY=this.containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>this.containment[2])pageX=this.containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>this.containment[3])pageY=this.containment[3]+this.offset.click.top;}
if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+((this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+((this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=='down'?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter==this.counter)this.refreshPositions(!hardRefresh);});},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=='auto'||this._storedCSS[i]=='static')this._storedCSS[i]='';}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation)delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation)delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.currentContainer));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.currentContainer));}}
for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation)delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this));};}).call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this));};}).call(this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this._storedCursor)$('body').css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=='auto'?'':this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return false;}
if(!noPropagation)this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null};}});})(jQuery);(function($,undefined){var uid=0,hideProps={},showProps={};hideProps.height=hideProps.paddingTop=hideProps.paddingBottom=hideProps.borderTopWidth=hideProps.borderBottomWidth="hide";showProps.height=showProps.paddingTop=showProps.paddingBottom=showProps.borderTopWidth=showProps.borderBottomWidth="show";$.widget("ui.accordion",{version:"1.9.1",options:{active:0,animate:{},collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var accordionId=this.accordionId="ui-accordion-"+
(this.element.attr("id")||++uid),options=this.options;this.prevShow=this.prevHide=$();this.element.addClass("ui-accordion ui-widget ui-helper-reset");this.headers=this.element.find(options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");this._hoverable(this.headers);this._focusable(this.headers);this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").hide();if(!options.collapsible&&(options.active===false||options.active==null)){options.active=0;}
if(options.active<0){options.active+=this.headers.length;}
this.active=this._findActive(options.active).addClass("ui-accordion-header-active ui-state-active").toggleClass("ui-corner-all ui-corner-top");this.active.next().addClass("ui-accordion-content-active").show();this._createIcons();this.refresh();this.element.attr("role","tablist");this.headers.attr("role","tab").each(function(i){var header=$(this),headerId=header.attr("id"),panel=header.next(),panelId=panel.attr("id");if(!headerId){headerId=accordionId+"-header-"+i;header.attr("id",headerId);}
if(!panelId){panelId=accordionId+"-panel-"+i;panel.attr("id",panelId);}
header.attr("aria-controls",panelId);panel.attr("aria-labelledby",headerId);}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0);}else{this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"});}
this._on(this.headers,{keydown:"_keydown"});this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._setupEvents(options.event);},_getCreateEventData:function(){return{header:this.active,content:!this.active.length?$():this.active.next()};},_createIcons:function(){var icons=this.options.icons;if(icons){$("<span>").addClass("ui-accordion-header-icon ui-icon "+icons.header).prependTo(this.headers);this.active.children(".ui-accordion-header-icon").removeClass(icons.header).addClass(icons.activeHeader);this.headers.addClass("ui-accordion-icons");}},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove();},_destroy:function(){var contents;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){if(/^ui-accordion/.test(this.id)){this.removeAttribute("id");}});this._destroyIcons();contents=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){if(/^ui-accordion/.test(this.id)){this.removeAttribute("id");}});if(this.options.heightStyle!=="content"){contents.css("height","");}},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="event"){if(this.options.event){this._off(this.headers,this.options.event);}
this._setupEvents(value);}
this._super(key,value);if(key==="collapsible"&&!value&&this.options.active===false){this._activate(0);}
if(key==="icons"){this._destroyIcons();if(value){this._createIcons();}}
if(key==="disabled"){this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!value);}},_keydown:function(event){if(event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._eventHandler(event);break;case keyCode.HOME:toFocus=this.headers[0];break;case keyCode.END:toFocus=this.headers[length-1];break;}
if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);toFocus.focus();event.preventDefault();}},_panelKeyDown:function(event){if(event.keyCode===$.ui.keyCode.UP&&event.ctrlKey){$(event.currentTarget).prev().focus();}},refresh:function(){var maxHeight,overflow,heightStyle=this.options.heightStyle,parent=this.element.parent();if(heightStyle==="fill"){if(!$.support.minHeight){overflow=parent.css("overflow");parent.css("overflow","hidden");}
maxHeight=parent.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});if(overflow){parent.css("overflow",overflow);}
this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.headers.next().each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}},_activate:function(index){var active=this._findActive(index)[0];if(active===this.active[0]){return;}
active=active||this.active[0];this._eventHandler({target:active,currentTarget:active,preventDefault:$.noop});},_findActive:function(selector){return typeof selector==="number"?this.headers.eq(selector):$();},_setupEvents:function(event){var events={};if(!event){return;}
$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});this._on(this.headers,events);},_eventHandler:function(event){var options=this.options,active=this.active,clicked=$(event.currentTarget),clickedIsActive=clicked[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():clicked.next(),toHide=active.next(),eventData={oldHeader:active,oldPanel:toHide,newHeader:collapsing?$():clicked,newPanel:toShow};event.preventDefault();if((clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.headers.index(clicked);this.active=clickedIsActive?$():clicked;this._toggle(eventData);active.removeClass("ui-accordion-header-active ui-state-active");if(options.icons){active.children(".ui-accordion-header-icon").removeClass(options.icons.activeHeader).addClass(options.icons.header);}
if(!clickedIsActive){clicked.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top");if(options.icons){clicked.children(".ui-accordion-header-icon").removeClass(options.icons.header).addClass(options.icons.activeHeader);}
clicked.next().addClass("ui-accordion-content-active");}},_toggle:function(data){var toShow=data.newPanel,toHide=this.prevShow.length?this.prevShow:data.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=toShow;this.prevHide=toHide;if(this.options.animate){this._animate(toShow,toHide,data);}else{toHide.hide();toShow.show();this._toggleComplete(data);}
toHide.attr({"aria-expanded":"false","aria-hidden":"true"});toHide.prev().attr("aria-selected","false");if(toShow.length&&toHide.length){toHide.prev().attr("tabIndex",-1);}else if(toShow.length){this.headers.filter(function(){return $(this).attr("tabIndex")===0;}).attr("tabIndex",-1);}
toShow.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0});},_animate:function(toShow,toHide,data){var total,easing,duration,that=this,adjust=0,down=toShow.length&&(!toHide.length||(toShow.index()<toHide.index())),animate=this.options.animate||{},options=down&&animate.down||animate,complete=function(){that._toggleComplete(data);};if(typeof options==="number"){duration=options;}
if(typeof options==="string"){easing=options;}
easing=easing||options.easing||animate.easing;duration=duration||options.duration||animate.duration;if(!toHide.length){return toShow.animate(showProps,duration,easing,complete);}
if(!toShow.length){return toHide.animate(hideProps,duration,easing,complete);}
total=toShow.show().outerHeight();toHide.animate(hideProps,{duration:duration,easing:easing,step:function(now,fx){fx.now=Math.round(now);}});toShow.hide().animate(showProps,{duration:duration,easing:easing,complete:complete,step:function(now,fx){fx.now=Math.round(now);if(fx.prop!=="height"){adjust+=fx.now;}else if(that.options.heightStyle!=="content"){fx.now=Math.round(total-toHide.outerHeight()-adjust);adjust=0;}}});},_toggleComplete:function(data){var toHide=data.oldPanel;toHide.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all");if(toHide.length){toHide.parent()[0].className=toHide.parent()[0].className;}
this._trigger("activate",null,data);}});if($.uiBackCompat!==false){(function($,prototype){$.extend(prototype.options,{navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase();}});var _create=prototype._create;prototype._create=function(){if(this.options.navigation){var that=this,headers=this.element.find(this.options.header),content=headers.next(),current=headers.add(content).find("a").filter(this.options.navigationFilter)
[0];if(current){headers.add(content).each(function(index){if($.contains(this,current)){that.options.active=Math.floor(index/2);return false;}});}}
_create.call(this);};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options,{heightStyle:null,autoHeight:true,clearStyle:false,fillSpace:false});var _create=prototype._create,_setOption=prototype._setOption;$.extend(prototype,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle();_create.call(this);},_setOption:function(key){if(key==="autoHeight"||key==="clearStyle"||key==="fillSpace"){this.options.heightStyle=this._mergeHeightStyle();}
_setOption.apply(this,arguments);},_mergeHeightStyle:function(){var options=this.options;if(options.fillSpace){return"fill";}
if(options.clearStyle){return"content";}
if(options.autoHeight){return"auto";}}});}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var _createIcons=prototype._createIcons;prototype._createIcons=function(){if(this.options.icons){this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected;}
_createIcons.call(this);};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){prototype.activate=prototype._activate;var _findActive=prototype._findActive;prototype._findActive=function(index){if(index===-1){index=false;}
if(index&&typeof index!=="number"){index=this.headers.index(this.headers.filter(index));if(index===-1){index=false;}}
return _findActive.call(this,index);};}(jQuery,jQuery.ui.accordion.prototype));jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh;(function($,prototype){$.extend(prototype.options,{change:null,changestart:null});var _trigger=prototype._trigger;prototype._trigger=function(type,event,data){var ret=_trigger.apply(this,arguments);if(!ret){return false;}
if(type==="beforeActivate"){ret=_trigger.call(this,"changestart",event,{oldHeader:data.oldHeader,oldContent:data.oldPanel,newHeader:data.newHeader,newContent:data.newPanel});}else if(type==="activate"){ret=_trigger.call(this,"change",event,{oldHeader:data.oldHeader,oldContent:data.oldPanel,newHeader:data.newHeader,newContent:data.newPanel});}
return ret;};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options,{animate:null,animated:"slide"});var _create=prototype._create;prototype._create=function(){var options=this.options;if(options.animate===null){if(!options.animated){options.animate=false;}else if(options.animated==="slide"){options.animate=300;}else if(options.animated==="bounceslide"){options.animate={duration:200,down:{easing:"easeOutBounce",duration:1000}};}else{options.animate=options.animated;}}
_create.call(this);};}(jQuery,jQuery.ui.accordion.prototype));}})(jQuery);(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{version:"1.9.1",defaultElement:"<input>",options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput;this.isMultiLine=this._isMultiLine();this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"];this.isNewMenu=true;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off");this._on(this.element,{keydown:function(event){if(this.element.prop("readOnly")){suppressKeyPress=true;suppressInput=true;suppressKeyPressRepeat=true;return;}
suppressKeyPress=false;suppressInput=false;suppressKeyPressRepeat=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=true;this._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=true;this._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=true;this._keyEvent("previous",event);break;case keyCode.DOWN:suppressKeyPress=true;this._keyEvent("next",event);break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(this.menu.active){suppressKeyPress=true;event.preventDefault();this.menu.select(event);}
break;case keyCode.TAB:if(this.menu.active){this.menu.select(event);}
break;case keyCode.ESCAPE:if(this.menu.element.is(":visible")){this._value(this.term);this.close(event);event.preventDefault();}
break;default:suppressKeyPressRepeat=true;this._searchTimeout(event);break;}},keypress:function(event){if(suppressKeyPress){suppressKeyPress=false;event.preventDefault();return;}
if(suppressKeyPressRepeat){return;}
var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move("previousPage",event);break;case keyCode.PAGE_DOWN:this._move("nextPage",event);break;case keyCode.UP:this._keyEvent("previous",event);break;case keyCode.DOWN:this._keyEvent("next",event);break;}},input:function(event){if(suppressInput){suppressInput=false;event.preventDefault();return;}
this._searchTimeout(event);},focus:function(){this.selectedItem=null;this.previous=this._value();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
clearTimeout(this.searching);this.close(event);this._change(event);}});this._initSource();this.menu=$("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:$(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu");this._on(this.menu.element,{mousedown:function(event){event.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;});var menuElement=this.menu.element[0];if(!$(event.target).closest(".ui-menu-item").length){this._delay(function(){var that=this;this.document.one("mousedown",function(event){if(event.target!==that.element[0]&&event.target!==menuElement&&!$.contains(menuElement,event.target)){that.close();}});});}},menufocus:function(event,ui){if(this.isNewMenu){this.isNewMenu=false;if(event.originalEvent&&/^mouse/.test(event.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){$(event.target).trigger(event.originalEvent);});return;}}
var item=ui.item.data("ui-autocomplete-item")||ui.item.data("item.autocomplete");if(false!==this._trigger("focus",event,{item:item})){if(event.originalEvent&&/^key/.test(event.originalEvent.type)){this._value(item.value);}}else{this.liveRegion.text(item.value);}},menuselect:function(event,ui){var item=ui.item.data("ui-autocomplete-item")||ui.item.data("item.autocomplete"),previous=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=previous;this._delay(function(){this.previous=previous;this.selectedItem=item;});}
if(false!==this._trigger("select",event,{item:item})){this._value(item.value);}
this.term=this._value();this.close(event);this.selectedItem=item;}});this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element);if($.fn.bgiframe){this.menu.element.bgiframe();}
this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove();},_setOption:function(key,value){this._super(key,value);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo(this.document.find(value||"body")[0]);}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_isMultiLine:function(){if(this.element.is("textarea")){return true;}
if(this.element.is("input")){return false;}
return this.element.prop("isContentEditable");},_initSource:function(){var array,url,that=this;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(that.xhr){that.xhr.abort();}
that.xhr=$.ajax({url:url,data:request,dataType:"json",success:function(data){response(data);},error:function(){response([]);}});};}else{this.source=this.options.source;}},_searchTimeout:function(event){clearTimeout(this.searching);this.searching=this._delay(function(){if(this.term!==this._value()){this.selectedItem=null;this.search(null,event);}},this.options.delay);},search:function(value,event){value=value!=null?value:this._value();this.term=this._value();if(value.length<this.options.minLength){return this.close(event);}
if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.cancelSearch=false;this.source({term:value},this._response());},_response:function(){var that=this,index=++requestIndex;return function(content){if(index===requestIndex){that.__response(content);}
that.pending--;if(!that.pending){that.element.removeClass("ui-autocomplete-loading");}};},__response:function(content){if(content){content=this._normalize(content);}
this._trigger("response",null,{content:content});if(!this.options.disabled&&content&&content.length&&!this.cancelSearch){this._suggest(content);this._trigger("open");}else{this._close();}},close:function(event){this.cancelSearch=true;this._close(event);},_close:function(event){if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",event);}},_change:function(event){if(this.previous!==this._value()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({label:item.label||item.value,value:item.value||item.label},item);});},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next();}},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth()+1,this.element.outerWidth()));},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-autocomplete-item",item);},_renderItem:function(ul,item){return $("<li>").append($("<a>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)){this._value(this.term);this.menu.blur();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);},_keyEvent:function(keyEvent,event){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(keyEvent,event);event.preventDefault();}}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(amount){return amount+(amount>1?" results are":" result is")+" available, use up and down arrow keys to navigate.";}}},__response:function(content){var message;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return;}
if(content&&content.length){message=this.options.messages.results(content.length);}else{message=this.options.messages.noResults;}
this.liveRegion.text(message);}});}(jQuery));(function($,undefined){var lastActive,startXPos,startYPos,clickDragged,baseClasses="ui-button ui-widget ui-state-default ui-corner-all",stateClasses="ui-state-hover ui-state-active ",typeClasses="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",formResetHandler=function(){var buttons=$(this).find(":ui-button");setTimeout(function(){buttons.button("refresh");},1);},radioGroup=function(radio){var name=radio.name,form=radio.form,radios=$([]);if(name){if(form){radios=$(form).find("[name='"+name+"']");}else{radios=$("[name='"+name+"']",radio.ownerDocument).filter(function(){return!this.form;});}}
return radios;};$.widget("ui.button",{version:"1.9.1",defaultElement:"<button>",options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,formResetHandler);if(typeof this.options.disabled!=="boolean"){this.options.disabled=!!this.element.prop("disabled");}else{this.element.prop("disabled",this.options.disabled);}
this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var that=this,options=this.options,toggleButton=this.type==="checkbox"||this.type==="radio",hoverClass="ui-state-hover"+(!toggleButton?" ui-state-active":""),focusClass="ui-state-focus";if(options.label===null){options.label=(this.type==="input"?this.buttonElement.val():this.buttonElement.html());}
this.buttonElement.addClass(baseClasses).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");if(this===lastActive){$(this).addClass("ui-state-active");}}).bind("mouseleave"+this.eventNamespace,function(){if(options.disabled){return;}
$(this).removeClass(hoverClass);}).bind("click"+this.eventNamespace,function(event){if(options.disabled){event.preventDefault();event.stopImmediatePropagation();}});this.element.bind("focus"+this.eventNamespace,function(){that.buttonElement.addClass(focusClass);}).bind("blur"+this.eventNamespace,function(){that.buttonElement.removeClass(focusClass);});if(toggleButton){this.element.bind("change"+this.eventNamespace,function(){if(clickDragged){return;}
that.refresh();});this.buttonElement.bind("mousedown"+this.eventNamespace,function(event){if(options.disabled){return;}
clickDragged=false;startXPos=event.pageX;startYPos=event.pageY;}).bind("mouseup"+this.eventNamespace,function(event){if(options.disabled){return;}
if(startXPos!==event.pageX||startYPos!==event.pageY){clickDragged=true;}});}
if(this.type==="checkbox"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(options.disabled||clickDragged){return false;}
$(this).toggleClass("ui-state-active");that.buttonElement.attr("aria-pressed",that.element[0].checked);});}else if(this.type==="radio"){this.buttonElement.bind("click"+this.eventNamespace,function(){if(options.disabled||clickDragged){return false;}
$(this).addClass("ui-state-active");that.buttonElement.attr("aria-pressed","true");var radio=that.element[0];radioGroup(radio).not(radio).map(function(){return $(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed","false");});}else{this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(options.disabled){return false;}
$(this).addClass("ui-state-active");lastActive=this;that.document.one("mouseup",function(){lastActive=null;});}).bind("mouseup"+this.eventNamespace,function(){if(options.disabled){return false;}
$(this).removeClass("ui-state-active");}).bind("keydown"+this.eventNamespace,function(event){if(options.disabled){return false;}
if(event.keyCode===$.ui.keyCode.SPACE||event.keyCode===$.ui.keyCode.ENTER){$(this).addClass("ui-state-active");}}).bind("keyup"+this.eventNamespace,function(){$(this).removeClass("ui-state-active");});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(event){if(event.keyCode===$.ui.keyCode.SPACE){$(this).click();}});}}
this._setOption("disabled",options.disabled);this._resetButton();},_determineButtonType:function(){var ancestor,labelSelector,checked;if(this.element.is("[type=checkbox]")){this.type="checkbox";}else if(this.element.is("[type=radio]")){this.type="radio";}else if(this.element.is("input")){this.type="input";}else{this.type="button";}
if(this.type==="checkbox"||this.type==="radio"){ancestor=this.element.parents().last();labelSelector="label[for='"+this.element.attr("id")+"']";this.buttonElement=ancestor.find(labelSelector);if(!this.buttonElement.length){ancestor=ancestor.length?ancestor.siblings():this.element.siblings();this.buttonElement=ancestor.filter(labelSelector);if(!this.buttonElement.length){this.buttonElement=ancestor.find(labelSelector);}}
this.element.addClass("ui-helper-hidden-accessible");checked=this.element.is(":checked");if(checked){this.buttonElement.addClass("ui-state-active");}
this.buttonElement.prop("aria-pressed",checked);}else{this.buttonElement=this.element;}},widget:function(){return this.buttonElement;},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(baseClasses+" "+stateClasses+" "+typeClasses).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title");}},_setOption:function(key,value){this._super(key,value);if(key==="disabled"){if(value){this.element.prop("disabled",true);}else{this.element.prop("disabled",false);}
return;}
this._resetButton();},refresh:function(){var isDisabled=this.element.is(":disabled")||this.element.hasClass("ui-button-disabled");if(isDisabled!==this.options.disabled){this._setOption("disabled",isDisabled);}
if(this.type==="radio"){radioGroup(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true");}else{$(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false");}});}else if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true");}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false");}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label);}
return;}
var buttonElement=this.buttonElement.removeClass(typeClasses),buttonText=$("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(buttonElement.empty()).text(),icons=this.options.icons,multipleIcons=icons.primary&&icons.secondary,buttonClasses=[];if(icons.primary||icons.secondary){if(this.options.text){buttonClasses.push("ui-button-text-icon"+(multipleIcons?"s":(icons.primary?"-primary":"-secondary")));}
if(icons.primary){buttonElement.prepend("<span class='ui-button-icon-primary ui-icon "+icons.primary+"'></span>");}
if(icons.secondary){buttonElement.append("<span class='ui-button-icon-secondary ui-icon "+icons.secondary+"'></span>");}
if(!this.options.text){buttonClasses.push(multipleIcons?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){buttonElement.attr("title",$.trim(buttonText));}}}else{buttonClasses.push("ui-button-text-only");}
buttonElement.addClass(buttonClasses.join(" "));}});$.widget("ui.buttonset",{version:"1.9.1",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset");},_init:function(){this.refresh();},_setOption:function(key,value){if(key==="disabled"){this.buttons.button("option",key,value);}
this._super(key,value);},refresh:function(){var rtl=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(rtl?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(rtl?"ui-corner-left":"ui-corner-right").end().end();},_destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");}});}(jQuery));(function($,undefined){$.extend($.ui,{datepicker:{version:"1.9.1"}});var PROP_NAME='datepicker';var dpuuid=new Date().getTime();var instActive;function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId='ui-datepicker-div';this._inlineClass='ui-datepicker-inline';this._appendClass='ui-datepicker-append';this._triggerClass='ui-datepicker-trigger';this._dialogClass='ui-datepicker-dialog';this._disableClass='ui-datepicker-disabled';this._unselectableClass='ui-datepicker-unselectable';this._currentClass='ui-datepicker-current-day';this._dayOverClass='ui-datepicker-days-cell-over';this.regional=[];this.regional['']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'mm/dd/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};this._defaults={showOn:'focus',showAnim:'fadeIn',showOptions:{},defaultDate:null,appendText:'',buttonText:'...',buttonImage:'',buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:'c-10:c+10',showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:'+10',minDate:null,maxDate:null,duration:'fast',beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:'',altFormat:'',constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional['']);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'));}
$.extend(Datepicker.prototype,{markerClassName:'hasDatepicker',maxRows:4,log:function(){if(this.debug)
console.log.apply('',arguments);},_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute('date:'+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=='div'||nodeName=='span');if(!target.id){this.uuid+=1;target.id='dp'+this.uuid;}
var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=='input'){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,'\\\\$1');return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName))
return;this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});this._autoSize(inst);$.data(target,PROP_NAME,inst);if(inst.settings.disabled){this._disableDatepicker(target);}},_attachments:function(input,inst){var appendText=this._get(inst,'appendText');var isRTL=this._get(inst,'isRTL');if(inst.append)
inst.append.remove();if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+'</span>');input[isRTL?'before':'after'](inst.append);}
input.unbind('focus',this._showDatepicker);if(inst.trigger)
inst.trigger.remove();var showOn=this._get(inst,'showOn');if(showOn=='focus'||showOn=='both')
input.focus(this._showDatepicker);if(showOn=='button'||showOn=='both'){var buttonText=this._get(inst,'buttonText');var buttonImage=this._get(inst,'buttonImage');inst.trigger=$(this._get(inst,'buttonImageOnly')?$('<img/>').addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==''?buttonText:$('<img/>').attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?'before':'after'](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0])
$.datepicker._hideDatepicker();else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!=input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0]);}else
$.datepicker._showDatepicker(input[0]);return false;});}},_autoSize:function(inst){if(this._get(inst,'autoSize')&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,'dateFormat');if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?'monthNames':'monthNamesShort'))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?'dayNames':'dayNamesShort')))+20-date.getDay());}
inst.input.attr('size',this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName))
return;divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target);}
inst.dpDiv.css("display","block");},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id='dp'+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px;"/>');this._dialogInput.keydown(this._doKeyDown);$('body').append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}
extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css('left',(this._pos[0]+20)+'px').css('top',this._pos[1]+'px');inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI)
$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=='input'){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind('focus',this._showDatepicker).unbind('keydown',this._doKeyDown).unbind('keypress',this._doKeyPress).unbind('keyup',this._doKeyUp);}else if(nodeName=='div'||nodeName=='span')
$target.removeClass(this.markerClassName).empty();},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=false;inst.trigger.filter('button').each(function(){this.disabled=false;}).end().filter('img').css({opacity:'1.0',cursor:''});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().removeClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=true;inst.trigger.filter('button').each(function(){this.disabled=true;}).end().filter('img').css({opacity:'0.5',cursor:'default'});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().addClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target)
return true;}
return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}
catch(err){throw'Missing instance data for this datepicker';}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=='string'){return(name=='defaults'?$.extend({},$.datepicker._defaults):(inst?(name=='all'?$.extend({},inst.settings):this._get(inst,name)):null));}
var settings=name||{};if(typeof name=='string'){settings={};settings[name]=value;}
if(inst){if(this._curInst==inst){this._hideDatepicker();}
var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');extendRemove(inst.settings,settings);if(minDate!==null&&settings['dateFormat']!==undefined&&settings['minDate']===undefined)
inst.settings.minDate=this._formatDate(inst,minDate);if(maxDate!==null&&settings['dateFormat']!==undefined&&settings['maxDate']===undefined)
inst.settings.maxDate=this._formatDate(inst,maxDate);this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline)
this._setDateFromField(inst,noDefault);return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is('.ui-datepicker-rtl');inst._keyEvent=true;if($.datepicker._datepickerShowing)
switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$('td.'+$.datepicker._dayOverClass+':not(.'+
$.datepicker._currentClass+')',inst.dpDiv);if(sel[0])
$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);var onSelect=$.datepicker._get(inst,'onSelect');if(onSelect){var dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}
else
$.datepicker._hideDatepicker();return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 35:if(event.ctrlKey||event.metaKey)$.datepicker._clearDate(event.target);handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey)$.datepicker._gotoToday(event.target);handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?+1:-1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 38:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,-7,'D');handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?-1:+1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 40:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,+7,'D');handled=event.ctrlKey||event.metaKey;break;default:handled=false;}
else if(event.keyCode==36&&event.ctrlKey)
$.datepicker._showDatepicker(this);else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,'constrainInput')){var chars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat'));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<' '||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(err){$.datepicker.log(err);}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!='input')
input=$('input',input.parentNode)[0];if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input)
return;var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){$.datepicker._curInst.dpDiv.stop(true,true);if(inst&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0]);}}
var beforeShow=$.datepicker._get(inst,'beforeShow');var beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return;}
extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog)
input.value='';if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css('position')=='fixed';return!isFixed;});var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:'absolute',display:'block',top:'-1000px'});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?'static':(isFixed?'fixed':'absolute')),display:'none',left:offset.left+'px',top:offset.top+'px'});if(!inst.inline){var showAnim=$.datepicker._get(inst,'showAnim');var duration=$.datepicker._get(inst,'duration');var postProcess=function(){var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()});}};inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim]))
inst.dpDiv.show(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[showAnim||'show']((showAnim?duration:null),postProcess);if(!showAnim||!duration)
postProcess();if(inst.input.is(':visible')&&!inst.input.is(':disabled'))
inst.input.focus();$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){this.maxRows=4;var borders=$.datepicker._getBorders(inst.dpDiv);instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}
inst.dpDiv.find('.'+this._dayOverClass+' a').mouseover();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');if(cols>1)
inst.dpDiv.addClass('ui-datepicker-multi-'+cols).css('width',(width*cols)+'em');inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?'add':'remove')+'Class']('ui-datepicker-multi');inst.dpDiv[(this._get(inst,'isRTL')?'add':'remove')+'Class']('ui-datepicker-rtl');if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(':visible')&&!inst.input.is(':disabled')&&inst.input[0]!=document.activeElement)
inst.input.focus();if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value;};return[parseFloat(convert(elem.css('border-left-width'))),parseFloat(convert(elem.css('border-top-width')))];},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft());var viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());offset.left-=(this._get(inst,'isRTL')?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,'isRTL');while(obj&&(obj.type=='hidden'||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?'previousSibling':'nextSibling'];}
var position=$(obj).offset();return[position.left,position.top];},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME)))
return;if(this._datepickerShowing){var showAnim=this._get(inst,'showAnim');var duration=this._get(inst,'duration');var postProcess=function(){$.datepicker._tidyDialog(inst);};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim]))
inst.dpDiv.hide(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[(showAnim=='slideDown'?'slideUp':(showAnim=='fadeIn'?'fadeOut':'hide'))]((showAnim?duration:null),postProcess);if(!showAnim)
postProcess();this._datepickerShowing=false;var onClose=this._get(inst,'onClose');if(onClose)
onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():''),inst]);this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:'absolute',left:'0',top:'-100px'});if($.blockUI){$.unblockUI();$('body').append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind('.ui-datepicker-calendar');},_checkExternalClick:function(event){if(!$.datepicker._curInst)
return;var $target=$(event.target),inst=$.datepicker._getInst($target[0]);if((($target[0].id!=$.datepicker._mainDivId&&$target.parents('#'+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)))||($target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=inst))
$.datepicker._hideDatepicker();},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period=='M'?this._get(inst,'showCurrentAtPos'):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,'gotoCurrent')&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}
else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst['selected'+(period=='M'?'Month':'Year')]=inst['draw'+(period=='M'?'Month':'Year')]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$('a',td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,'');},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input)
inst.input.val(dateStr);this._updateAlternate(inst);var onSelect=this._get(inst,'onSelect');if(onSelect)
onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);else if(inst.input)
inst.input.trigger('change');if(inst.inline)
this._updateDatepicker(inst);else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!='object')
inst.input.focus();this._lastInput=null;}},_updateAlternate:function(inst){var altField=this._get(inst,'altField');if(altField){var altFormat=this._get(inst,'altFormat')||this._get(inst,'dateFormat');var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),''];},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null)
throw'Invalid arguments';value=(typeof value=='object'?value.toString():value+'');if(value=='')
return null;var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=='@'?14:(match=='!'?20:(match=='y'&&isDoubled?4:(match=='o'?3:2))));var digits=new RegExp('^\\d{1,'+size+'}');var num=value.substring(iValue).match(digits);if(!num)
throw'Missing number at position '+iValue;iValue+=num[0].length;return parseInt(num[0],10);};var getName=function(match,shortNames,longNames){var names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});var index=-1;$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()==name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!=-1)
return index+1;else
throw'Unknown name at position '+iValue;};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat))
throw'Unexpected literal at position '+iValue;iValue++;};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
checkLiteral();else
switch(format.charAt(iFormat)){case'd':day=getNumber('d');break;case'D':getName('D',dayNamesShort,dayNames);break;case'o':doy=getNumber('o');break;case'm':month=getNumber('m');break;case'M':month=getName('M',monthNamesShort,monthNames);break;case'y':year=getNumber('y');break;case'@':var date=new Date(getNumber('@'));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'!':var date=new Date((getNumber('!')-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'"))
checkLiteral();else
literal=true;break;default:checkLiteral();}}
if(iValue<value.length){var extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw"Extra/unparsed characters found in date: "+extra;}}
if(year==-1)
year=new Date().getFullYear();else if(year<100)
year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim)
break;month++;day-=dim;}while(true);}
var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day)
throw'Invalid date';return date;},ATOM:'yy-mm-dd',COOKIE:'D, dd M yy',ISO_8601:'yy-mm-dd',RFC_822:'D, d M y',RFC_850:'DD, dd-M-y',RFC_1036:'D, d M y',RFC_1123:'D, d M yy',RFC_2822:'D, d M yy',RSS:'D, d M y',TICKS:'!',TIMESTAMP:'@',W3C:'yy-mm-dd',_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date)
return'';var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var formatNumber=function(match,value,len){var num=''+value;if(lookAhead(match))
while(num.length<len)
num='0'+num;return num;};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);};var output='';var literal=false;if(date)
for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
output+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':output+=formatNumber('d',date.getDate(),2);break;case'D':output+=formatName('D',date.getDay(),dayNamesShort,dayNames);break;case'o':output+=formatNumber('o',Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case'm':output+=formatNumber('m',date.getMonth()+1,2);break;case'M':output+=formatName('M',date.getMonth(),monthNamesShort,monthNames);break;case'y':output+=(lookAhead('y')?date.getFullYear():(date.getYear()%100<10?'0':'')+date.getYear()%100);break;case'@':output+=date.getTime();break;case'!':output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'"))
output+="'";else
literal=true;break;default:output+=format.charAt(iFormat);}}
return output;},_possibleChars:function(format){var chars='';var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};for(var iFormat=0;iFormat<format.length;iFormat++)
if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
chars+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':case'm':case'y':case'@':chars+='0123456789';break;case'D':case'M':return null;case"'":if(lookAhead("'"))
chars+="'";else
literal=true;break;default:chars+=format.charAt(iFormat);}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return;}
var dateFormat=this._get(inst,'dateFormat');var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){this.log(event);dates=(noDefault?'':dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,'defaultDate'),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||'d'){case'd':case'D':day+=parseInt(matches[1],10);break;case'w':case'W':day+=parseInt(matches[1],10)*7;break;case'm':case'M':month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case'y':case'Y':year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);};var newDate=(date==null||date===''?defaultDate:(typeof date=='string'?offsetString(date):(typeof date=='number'?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=='Invalid Date'?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date)return null;date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange)
this._notifyChange(inst);this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?'':this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=='')?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_attachHandlers:function(inst){var stepMonths=this._get(inst,'stepMonths');var id='#'+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find('[data-handler]').map(function(){var handler={prev:function(){window['DP_jQuery_'+dpuuid].datepicker._adjustDate(id,-stepMonths,'M');},next:function(){window['DP_jQuery_'+dpuuid].datepicker._adjustDate(id,+stepMonths,'M');},hide:function(){window['DP_jQuery_'+dpuuid].datepicker._hideDatepicker();},today:function(){window['DP_jQuery_'+dpuuid].datepicker._gotoToday(id);},selectDay:function(){window['DP_jQuery_'+dpuuid].datepicker._selectDay(id,+this.getAttribute('data-month'),+this.getAttribute('data-year'),this);return false;},selectMonth:function(){window['DP_jQuery_'+dpuuid].datepicker._selectMonthYear(id,this,'M');return false;},selectYear:function(){window['DP_jQuery_'+dpuuid].datepicker._selectMonthYear(id,this,'Y');return false;}};$(this).bind(this.getAttribute('data-event'),handler[this.getAttribute('data-handler')]);});},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,'isRTL');var showButtonPanel=this._get(inst,'showButtonPanel');var hideIfNoPrevNext=this._get(inst,'hideIfNoPrevNext');var navigationAsDateFormat=this._get(inst,'navigationAsDateFormat');var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,'showCurrentAtPos');var stepMonths=this._get(inst,'stepMonths');var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,'prevText');prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click"'+' title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>'));var nextText=this._get(inst,'nextText');nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click"'+' title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>'));var currentText=this._get(inst,'currentText');var gotoDate=(this._get(inst,'gotoCurrent')&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+
this._get(inst,'closeText')+'</button>':'');var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:'')+
(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click"'+'>'+currentText+'</button>':'')+(isRTL?'':controls)+'</div>':'';var firstDay=parseInt(this._get(inst,'firstDay'),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,'showWeek');var dayNames=this._get(inst,'dayNames');var dayNamesShort=this._get(inst,'dayNamesShort');var dayNamesMin=this._get(inst,'dayNamesMin');var monthNames=this._get(inst,'monthNames');var monthNamesShort=this._get(inst,'monthNamesShort');var beforeShowDay=this._get(inst,'beforeShowDay');var showOtherMonths=this._get(inst,'showOtherMonths');var selectOtherMonths=this._get(inst,'selectOtherMonths');var calculateWeek=this._get(inst,'calculateWeek')||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html='';for(var row=0;row<numMonths[0];row++){var group='';this.maxRows=4;for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=' ui-corner-all';var calender='';if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1)
switch(col){case 0:calender+=' ui-datepicker-group-first';cornerClass=' ui-corner-'+(isRTL?'right':'left');break;case numMonths[1]-1:calender+=' ui-datepicker-group-last';cornerClass=' ui-corner-'+(isRTL?'left':'right');break;default:calender+=' ui-datepicker-group-middle';cornerClass='';break;}
calender+='">';}
calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+
(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):'')+
(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):'')+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead>'+'<tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,'weekHeader')+'</th>':'');for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+='<th'+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':'')+'>'+'<span title="'+dayNames[day]+'">'+dayNamesMin[day]+'</span></th>';}
calender+=thead+'</tr></thead><tbody>';var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth)
inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var curRows=Math.ceil((leadDays+daysInMonth)/7);var numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+='<tr>';var tbody=(!showWeek?'':'<td class="ui-datepicker-week-col">'+
this._get(inst,'calculateWeek')(printDate)+'</td>');for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,'']);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+
((dow+firstDay+6)%7>=5?' ui-datepicker-week-end':'')+
(otherMonth?' ui-datepicker-other-month':'')+
((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?' '+this._dayOverClass:'')+
(unselectable?' '+this._unselectableClass+' ui-state-disabled':'')+
(otherMonth&&!showOtherMonths?'':' '+daySettings[1]+
(printDate.getTime()==currentDate.getTime()?' '+this._currentClass:'')+
(printDate.getTime()==today.getTime()?' ui-datepicker-today':''))+'"'+
((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':'')+
(unselectable?'':' data-handler="selectDay" data-event="click" data-month="'+printDate.getMonth()+'" data-year="'+printDate.getFullYear()+'"')+'>'+
(otherMonth&&!showOtherMonths?'&#xa0;':(unselectable?'<span class="ui-state-default">'+printDate.getDate()+'</span>':'<a class="ui-state-default'+
(printDate.getTime()==today.getTime()?' ui-state-highlight':'')+
(printDate.getTime()==currentDate.getTime()?' ui-state-active':'')+
(otherMonth?' ui-priority-secondary':'')+'" href="#">'+printDate.getDate()+'</a>'))+'</td>';printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+'</tr>';}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+='</tbody></table>'+(isMultiMonth?'</div>'+
((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':''):'');group+=calender;}
html+=group;}
html+=buttonPanel+($.ui.ie6&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':'');inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,'changeMonth');var changeYear=this._get(inst,'changeYear');var showMonthAfterYear=this._get(inst,'showMonthAfterYear');var html='<div class="ui-datepicker-title">';var monthHtml='';if(secondary||!changeMonth)
monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+'</span>';else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth()))
monthHtml+='<option value="'+month+'"'+
(month==drawMonth?' selected="selected"':'')+'>'+monthNamesShort[month]+'</option>';}
monthHtml+='</select>';}
if(!showMonthAfterYear)
html+=monthHtml+(secondary||!(changeMonth&&changeYear)?'&#xa0;':'');if(!inst.yearshtml){inst.yearshtml='';if(secondary||!changeYear)
html+='<span class="ui-datepicker-year">'+drawYear+'</span>';else{var years=this._get(inst,'yearRange').split(':');var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||''));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+
(year==drawYear?' selected="selected"':'')+'>'+year+'</option>';}
inst.yearshtml+='</select>';html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,'yearSuffix');if(showMonthAfterYear)
html+=(secondary||!(changeMonth&&changeYear)?'&#xa0;':'')+monthHtml;html+='</div>';return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=='Y'?offset:0);var month=inst.drawMonth+(period=='M'?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+
(period=='D'?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=='M'||period=='Y')
this._notifyChange(inst);},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate;},_notifyChange:function(inst){var onChange=this._get(inst,'onChangeMonthYear');if(onChange)
onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,'numberOfMonths');return(numMonths==null?[1,1]:(typeof numMonths=='number'?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+'Date'),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0)
date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));return this._isInRange(inst,date);},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,'shortYearCutoff');shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,'dayNamesShort'),dayNames:this._get(inst,'dayNames'),monthNamesShort:this._get(inst,'monthNamesShort'),monthNames:this._get(inst,'monthNames')};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day=='object'?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,'dateFormat'),date,this._getFormatConfig(inst));}});function bindHover(dpDiv){var selector='button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';return dpDiv.delegate(selector,'mouseout',function(){$(this).removeClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!=-1)$(this).removeClass('ui-datepicker-prev-hover');if(this.className.indexOf('ui-datepicker-next')!=-1)$(this).removeClass('ui-datepicker-next-hover');}).delegate(selector,'mouseover',function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])){$(this).parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');$(this).addClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!=-1)$(this).addClass('ui-datepicker-prev-hover');if(this.className.indexOf('ui-datepicker-next')!=-1)$(this).addClass('ui-datepicker-next-hover');}});}
function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]==null||props[name]==undefined)
target[name]=props[name];return target;};$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv);$.datepicker.initialized=true;}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=='string'&&(options=='isDisabled'||options=='getDate'||options=='widget'))
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));if(options=='option'&&arguments.length==2&&typeof arguments[1]=='string')
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));return this.each(function(){typeof options=='string'?$.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.9.1";window['DP_jQuery_'+dpuuid]=$;})(jQuery);(function($,undefined){var uiDialogClasses="ui-dialog ui-widget ui-widget-content ui-corner-all ",sizeRelatedOptions={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true};$.widget("ui.dialog",{version:"1.9.1",options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",of:window,collision:"fit",using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css("top",pos.top-topOffset);}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle="";}
this.oldPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)};this.options.title=this.options.title||this.originalTitle;var that=this,options=this.options,title=options.title||"&#160;",uiDialog,uiDialogTitlebar,uiDialogTitlebarClose,uiDialogTitle,uiDialogButtonPane;uiDialog=(this.uiDialog=$("<div>")).addClass(uiDialogClasses+options.dialogClass).css({display:"none",outline:0,zIndex:options.zIndex}).attr("tabIndex",-1).keydown(function(event){if(options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){that.close(event);event.preventDefault();}}).mousedown(function(event){that.moveToTop(false,event);}).appendTo("body");this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(uiDialog);uiDialogTitlebar=(this.uiDialogTitlebar=$("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  "+"ui-corner-all  ui-helper-clearfix").bind("mousedown",function(){uiDialog.focus();}).prependTo(uiDialog);uiDialogTitlebarClose=$("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(event){event.preventDefault();that.close(event);}).appendTo(uiDialogTitlebar);(this.uiDialogTitlebarCloseText=$("<span>")).addClass("ui-icon ui-icon-closethick").text(options.closeText).appendTo(uiDialogTitlebarClose);uiDialogTitle=$("<span>").uniqueId().addClass("ui-dialog-title").html(title).prependTo(uiDialogTitlebar);uiDialogButtonPane=(this.uiDialogButtonPane=$("<div>")).addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");(this.uiButtonSet=$("<div>")).addClass("ui-dialog-buttonset").appendTo(uiDialogButtonPane);uiDialog.attr({role:"dialog","aria-labelledby":uiDialogTitle.attr("id")});uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();this._hoverable(uiDialogTitlebarClose);this._focusable(uiDialogTitlebarClose);if(options.draggable&&$.fn.draggable){this._makeDraggable();}
if(options.resizable&&$.fn.resizable){this._makeResizable();}
this._createButtons(options.buttons);this._isOpen=false;if($.fn.bgiframe){uiDialog.bgiframe();}
this._on(uiDialog,{keydown:function(event){if(!options.modal||event.keyCode!==$.ui.keyCode.TAB){return;}
var tabbables=$(":tabbable",uiDialog),first=tabbables.filter(":first"),last=tabbables.filter(":last");if(event.target===last[0]&&!event.shiftKey){first.focus(1);return false;}else if(event.target===first[0]&&event.shiftKey){last.focus(1);return false;}}});},_init:function(){if(this.options.autoOpen){this.open();}},_destroy:function(){var next,oldPosition=this.oldPosition;if(this.overlay){this.overlay.destroy();}
this.uiDialog.hide();this.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();if(this.originalTitle){this.element.attr("title",this.originalTitle);}
next=oldPosition.parent.children().eq(oldPosition.index);if(next.length&&next[0]!==this.element[0]){next.before(this.element);}else{oldPosition.parent.append(this.element);}},widget:function(){return this.uiDialog;},close:function(event){var that=this,maxZ,thisZ;if(!this._isOpen){return;}
if(false===this._trigger("beforeClose",event)){return;}
this._isOpen=false;if(this.overlay){this.overlay.destroy();}
if(this.options.hide){this._hide(this.uiDialog,this.options.hide,function(){that._trigger("close",event);});}else{this.uiDialog.hide();this._trigger("close",event);}
$.ui.dialog.overlay.resize();if(this.options.modal){maxZ=0;$(".ui-dialog").each(function(){if(this!==that.uiDialog[0]){thisZ=$(this).css("z-index");if(!isNaN(thisZ)){maxZ=Math.max(maxZ,thisZ);}}});$.ui.dialog.maxZ=maxZ;}
return this;},isOpen:function(){return this._isOpen;},moveToTop:function(force,event){var options=this.options,saveScroll;if((options.modal&&!force)||(!options.stack&&!options.modal)){return this._trigger("focus",event);}
if(options.zIndex>$.ui.dialog.maxZ){$.ui.dialog.maxZ=options.zIndex;}
if(this.overlay){$.ui.dialog.maxZ+=1;$.ui.dialog.overlay.maxZ=$.ui.dialog.maxZ;this.overlay.$el.css("z-index",$.ui.dialog.overlay.maxZ);}
saveScroll={scrollTop:this.element.scrollTop(),scrollLeft:this.element.scrollLeft()};$.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",$.ui.dialog.maxZ);this.element.attr(saveScroll);this._trigger("focus",event);return this;},open:function(){if(this._isOpen){return;}
var hasFocus,options=this.options,uiDialog=this.uiDialog;this._size();this._position(options.position);uiDialog.show(options.show);this.overlay=options.modal?new $.ui.dialog.overlay(this):null;this.moveToTop(true);hasFocus=this.element.find(":tabbable");if(!hasFocus.length){hasFocus=this.uiDialogButtonPane.find(":tabbable");if(!hasFocus.length){hasFocus=uiDialog;}}
hasFocus.eq(0).focus();this._isOpen=true;this._trigger("open");return this;},_createButtons:function(buttons){var that=this,hasButtons=false;this.uiDialogButtonPane.remove();this.uiButtonSet.empty();if(typeof buttons==="object"&&buttons!==null){$.each(buttons,function(){return!(hasButtons=true);});}
if(hasButtons){$.each(buttons,function(name,props){props=$.isFunction(props)?{click:props,text:name}:props;var button=$("<button type='button'></button>").attr(props,true).unbind("click").click(function(){props.click.apply(that.element[0],arguments);}).appendTo(that.uiButtonSet);if($.fn.button){button.button();}});this.uiDialog.addClass("ui-dialog-buttons");this.uiDialogButtonPane.appendTo(this.uiDialog);}else{this.uiDialog.removeClass("ui-dialog-buttons");}},_makeDraggable:function(){var that=this,options=this.options;function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(event,ui){$(this).addClass("ui-dialog-dragging");that._trigger("dragStart",event,filteredUi(ui));},drag:function(event,ui){that._trigger("drag",event,filteredUi(ui));},stop:function(event,ui){options.position=[ui.position.left-that.document.scrollLeft(),ui.position.top-that.document.scrollTop()];$(this).removeClass("ui-dialog-dragging");that._trigger("dragStop",event,filteredUi(ui));$.ui.dialog.overlay.resize();}});},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var that=this,options=this.options,position=this.uiDialog.css("position"),resizeHandles=typeof handles==='string'?handles:"n,e,s,w,se,sw,ne,nw";function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:this._minHeight(),handles:resizeHandles,start:function(event,ui){$(this).addClass("ui-dialog-resizing");that._trigger("resizeStart",event,filteredUi(ui));},resize:function(event,ui){that._trigger("resize",event,filteredUi(ui));},stop:function(event,ui){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();that._trigger("resizeStop",event,filteredUi(ui));$.ui.dialog.overlay.resize();}}).css("position",position).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");},_minHeight:function(){var options=this.options;if(options.height==="auto"){return options.minHeight;}else{return Math.min(options.minHeight,options.height);}},_position:function(position){var myAt=[],offset=[0,0],isVisible;if(position){if(typeof position==="string"||(typeof position==="object"&&"0"in position)){myAt=position.split?position.split(" "):[position[0],position[1]];if(myAt.length===1){myAt[1]=myAt[0];}
$.each(["left","top"],function(i,offsetPosition){if(+myAt[i]===myAt[i]){offset[i]=myAt[i];myAt[i]=offsetPosition;}});position={my:myAt[0]+(offset[0]<0?offset[0]:"+"+offset[0])+" "+
myAt[1]+(offset[1]<0?offset[1]:"+"+offset[1]),at:myAt.join(" ")};}
position=$.extend({},$.ui.dialog.prototype.options.position,position);}else{position=$.ui.dialog.prototype.options.position;}
isVisible=this.uiDialog.is(":visible");if(!isVisible){this.uiDialog.show();}
this.uiDialog.position(position);if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var that=this,resizableOptions={},resize=false;$.each(options,function(key,value){that._setOption(key,value);if(key in sizeRelatedOptions){resize=true;}
if(key in resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",resizableOptions);}},_setOption:function(key,value){var isDraggable,isResizable,uiDialog=this.uiDialog;switch(key){case"buttons":this._createButtons(value);break;case"closeText":this.uiDialogTitlebarCloseText.text(""+value);break;case"dialogClass":uiDialog.removeClass(this.options.dialogClass).addClass(uiDialogClasses+value);break;case"disabled":if(value){uiDialog.addClass("ui-dialog-disabled");}else{uiDialog.removeClass("ui-dialog-disabled");}
break;case"draggable":isDraggable=uiDialog.is(":data(draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy");}
if(!isDraggable&&value){this._makeDraggable();}
break;case"position":this._position(value);break;case"resizable":isResizable=uiDialog.is(":data(resizable)");if(isResizable&&!value){uiDialog.resizable("destroy");}
if(isResizable&&typeof value==="string"){uiDialog.resizable("option","handles",value);}
if(!isResizable&&value!==false){this._makeResizable(value);}
break;case"title":$(".ui-dialog-title",this.uiDialogTitlebar).html(""+(value||"&#160;"));break;}
this._super(key,value);},_size:function(){var nonContentHeight,minContentHeight,autoHeight,options=this.options,isVisible=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:"auto",width:options.width}).outerHeight();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);if(options.height==="auto"){if($.support.minHeight){this.element.css({minHeight:minContentHeight,height:"auto"});}else{this.uiDialog.show();autoHeight=this.element.css("height","auto").height();if(!isVisible){this.uiDialog.hide();}
this.element.height(Math.max(autoHeight,minContentHeight));}}else{this.element.height(Math.max(options.height-nonContentHeight,0));}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight());}}});$.extend($.ui.dialog,{uuid:0,maxZ:0,getTitleId:function($el){var id=$el.attr("id");if(!id){this.uuid+=1;id=this.uuid;}
return"ui-dialog-title-"+id;},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog);}});$.extend($.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:$.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(event){return event+".dialog-overlay";}).join(" "),create:function(dialog){if(this.instances.length===0){setTimeout(function(){if($.ui.dialog.overlay.instances.length){$(document).bind($.ui.dialog.overlay.events,function(event){if($(event.target).zIndex()<$.ui.dialog.overlay.maxZ&&$(event.target).closest('.ui-dialog').zIndex()<$.ui.dialog.overlay.maxZ){return false;}});}},1);$(window).bind("resize.dialog-overlay",$.ui.dialog.overlay.resize);}
var $el=(this.oldInstances.pop()||$("<div>").addClass("ui-widget-overlay"));$(document).bind("keydown.dialog-overlay",function(event){var instances=$.ui.dialog.overlay.instances;if(instances.length!==0&&instances[instances.length-1]===$el&&dialog.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){dialog.close(event);event.preventDefault();}});$el.appendTo(document.body).css({width:this.width(),height:this.height()});if($.fn.bgiframe){$el.bgiframe();}
this.instances.push($el);return $el;},destroy:function($el){var indexOf=$.inArray($el,this.instances),maxZ=0;if(indexOf!==-1){this.oldInstances.push(this.instances.splice(indexOf,1)[0]);}
if(this.instances.length===0){$([document,window]).unbind(".dialog-overlay");}
$el.height(0).width(0).remove();$.each(this.instances,function(){maxZ=Math.max(maxZ,this.css("z-index"));});this.maxZ=maxZ;},height:function(){var scrollHeight,offsetHeight;if($.ui.ie){scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height()+"px";}else{return scrollHeight+"px";}}else{return $(document).height()+"px";}},width:function(){var scrollWidth,offsetWidth;if($.ui.ie){scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width()+"px";}else{return scrollWidth+"px";}}else{return $(document).width()+"px";}},resize:function(){var $overlays=$([]);$.each($.ui.dialog.overlay.instances,function(){$overlays=$overlays.add(this);});$overlays.css({width:0,height:0}).css({width:$.ui.dialog.overlay.width(),height:$.ui.dialog.overlay.height()});}});$.extend($.ui.dialog.overlay.prototype,{destroy:function(){$.ui.dialog.overlay.destroy(this.$el);}});}(jQuery));(function($,undefined){var mouseHandled=false;$.widget("ui.menu",{version:"1.9.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,$.proxy(function(event){if(this.options.disabled){event.preventDefault();}},this));if(this.options.disabled){this.element.addClass("ui-state-disabled").attr("aria-disabled","true");}
this._on({"mousedown .ui-menu-item > a":function(event){event.preventDefault();},"click .ui-state-disabled > a":function(event){event.preventDefault();},"click .ui-menu-item:has(a)":function(event){var target=$(event.target).closest(".ui-menu-item");if(!mouseHandled&&target.not(".ui-state-disabled").length){mouseHandled=true;this.select(event);if(target.has(".ui-menu").length){this.expand(event);}else if(!this.element.is(":focus")){this.element.trigger("focus",[true]);if(this.active&&this.active.parents(".ui-menu").length===1){clearTimeout(this.timer);}}}},"mouseenter .ui-menu-item":function(event){var target=$(event.currentTarget);target.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(event,target);},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(event,keepActiveItem){var item=this.active||this.element.children(".ui-menu-item").eq(0);if(!keepActiveItem){this.focus(event,item);}},blur:function(event){this._delay(function(){if(!$.contains(this.element[0],this.document[0].activeElement)){this.collapseAll(event);}});},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(event){if(!$(event.target).closest(".ui-menu").length){this.collapseAll(event);}
mouseHandled=false;}});},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var elem=$(this);if(elem.data("ui-menu-submenu-carat")){elem.remove();}});this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content");},_keydown:function(event){var match,prev,character,skip,regex,preventDefault=true;function escape(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}
switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move("first","first",event);break;case $.ui.keyCode.END:this._move("last","last",event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:if(this.active&&!this.active.is(".ui-state-disabled")){this.expand(event);}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=false;prev=this.previousFilter||"";character=String.fromCharCode(event.keyCode);skip=false;clearTimeout(this.filterTimer);if(character===prev){skip=true;}else{character=prev+character;}
regex=new RegExp("^"+escape(character),"i");match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text());});match=skip&&match.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):match;if(!match.length){character=String.fromCharCode(event.keyCode);regex=new RegExp("^"+escape(character),"i");match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text());});}
if(match.length){this.focus(event,match);if(match.length>1){this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter;},1000);}else{delete this.previousFilter;}}else{delete this.previousFilter;}}
if(preventDefault){event.preventDefault();}},_activate:function(event){if(!this.active.is(".ui-state-disabled")){if(this.active.children("a[aria-haspopup='true']").length){this.expand(event);}else{this.select(event);}}},refresh:function(){var menus,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});menus=submenus.add(this.element);menus.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()});menus.children(":not(.ui-menu-item)").each(function(){var item=$(this);if(!/[^\-—–\s]/.test(item.text())){item.addClass("ui-widget-content ui-menu-divider");}});menus.children(".ui-state-disabled").attr("aria-disabled","true");submenus.each(function(){var menu=$(this),item=menu.prev("a"),submenuCarat=$("<span>").addClass("ui-menu-icon ui-icon "+icon).data("ui-menu-submenu-carat",true);item.attr("aria-haspopup","true").prepend(submenuCarat);menu.attr("aria-labelledby",item.attr("id"));});if(this.active&&!$.contains(this.element[0],this.active[0])){this.blur();}},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role];},focus:function(event,item){var nested,focused;this.blur(event,event&&event.type==="focus");this._scrollIntoView(item);this.active=item.first();focused=this.active.children("a").addClass("ui-state-focus");if(this.options.role){this.element.attr("aria-activedescendant",focused.attr("id"));}
this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");if(event&&event.type==="keydown"){this._close();}else{this.timer=this._delay(function(){this._close();},this.delay);}
nested=item.children(".ui-menu");if(nested.length&&(/^mouse/.test(event.type))){this._startOpening(nested);}
this.activeMenu=item.parent();this._trigger("focus",event,{item:item});},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;if(this._hasScroll()){borderTop=parseFloat($.css(this.activeMenu[0],"borderTopWidth"))||0;paddingTop=parseFloat($.css(this.activeMenu[0],"paddingTop"))||0;offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop;scroll=this.activeMenu.scrollTop();elementHeight=this.activeMenu.height();itemHeight=item.height();if(offset<0){this.activeMenu.scrollTop(scroll+offset);}else if(offset+itemHeight>elementHeight){this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight);}}},blur:function(event,fromFocus){if(!fromFocus){clearTimeout(this.timer);}
if(!this.active){return;}
this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",event,{item:this.active});},_startOpening:function(submenu){clearTimeout(this.timer);if(submenu.attr("aria-hidden")!=="true"){return;}
this.timer=this._delay(function(){this._close();this._open(submenu);},this.delay);},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(submenu.parents(".ui-menu")).hide().attr("aria-hidden","true");submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position);},collapseAll:function(event,all){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find(".ui-menu"));if(!currentMenu.length){currentMenu=this.element;}
this._close(currentMenu);this.blur(event);this.activeMenu=currentMenu;},this.delay);},_close:function(startMenu){if(!startMenu){startMenu=this.active?this.active.parent():this.element;}
startMenu.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active");},collapse:function(event){var newItem=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(newItem&&newItem.length){this._close();this.focus(event,newItem);}},expand:function(event){var newItem=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem);});}},next:function(event){this._move("next","first",event);},previous:function(event){this._move("prev","last",event);},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(direction,filter,event){var next;if(this.active){if(direction==="first"||direction==="last"){next=this.active
[direction==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1);}else{next=this.active
[direction+"All"](".ui-menu-item").eq(0);}}
if(!next||!next.length||!this.active){next=this.activeMenu.children(".ui-menu-item")[filter]();}
this.focus(event,next);},nextPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isLastItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base-height<0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.children(".ui-menu-item")
[!this.active?"first":"last"]());}},previousPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isFirstItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base+height>0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.children(".ui-menu-item").first());}},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight");},select:function(event){this.active=this.active||$(event.target).closest(".ui-menu-item");var ui={item:this.active};if(!this.active.has(".ui-menu").length){this.collapseAll(event,true);}
this._trigger("select",event,ui);}});}(jQuery));(function($,undefined){$.widget("ui.progressbar",{version:"1.9.1",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue();},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();},value:function(newValue){if(newValue===undefined){return this._value();}
this._setOption("value",newValue);return this;},_setOption:function(key,value){if(key==="value"){this.options.value=value;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete");}}
this._super(key,value);},_value:function(){var val=this.options.value;if(typeof val!=="number"){val=0;}
return Math.min(this.options.max,Math.max(this.min,val));},_percentage:function(){return 100*this._value()/this.options.max;},_refreshValue:function(){var value=this.value(),percentage=this._percentage();if(this.oldValue!==value){this.oldValue=value;this._trigger("change");}
this.valueDiv.toggle(value>this.min).toggleClass("ui-corner-right",value===this.options.max).width(percentage.toFixed(0)+"%");this.element.attr("aria-valuenow",value);}});})(jQuery);(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var i,handleCount,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+
(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()];}
if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]];}}
this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+
((o.range==="min"||o.range==="max")?" ui-slider-range-"+o.range:""));}
handleCount=(o.values&&o.values.length)||1;for(i=existingHandles.length;i<handleCount;i++){handles.push(handle);}
this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault();}).mouseenter(function(){if(!o.disabled){$(this).addClass("ui-state-hover");}}).mouseleave(function(){$(this).removeClass("ui-state-hover");}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus");}else{$(this).blur();}}).blur(function(){$(this).removeClass("ui-state-focus");});this.handles.each(function(i){$(this).data("ui-slider-handle-index",i);});this._on(this.handles,{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;$(event.target).addClass("ui-state-active");allowed=this._start(event,index);if(allowed===false){return;}}
break;}
step=this.options.step;if(this.options.values&&this.options.values.length){curVal=newVal=this.values(index);}else{curVal=newVal=this.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return;}
newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return;}
newVal=this._trimAlignValue(curVal-step);break;}
this._slide(event,index,newVal);},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);$(event.target).removeClass("ui-state-active");}}});this._refreshValue();this._animateOff=false;},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy();},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i;}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index]);}
allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;this._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-
(closestHandle.height()/2)-
(parseInt(closestHandle.css("borderTopWidth"),10)||0)-
(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+
(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==="vertical"){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}
if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length;}
$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.prop("disabled",true);this.element.addClass("ui-disabled");}else{this.handles.prop("disabled",false);this.element.removeClass("ui-disabled");}
break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}
this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=(!this._animateOff)?o.animate:false,_set={};if(this.options.values&&this.options.values.length){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}
if(i===1){that.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}
if(i===1){that.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}
if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}}});}(jQuery));(function($){function modifier(fn){return function(){var previous=this.element.val();fn.apply(this,arguments);this._refresh();if(previous!==this.element.val()){this._trigger("change");}};}
$.widget("ui.spinner",{version:"1.9.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:true,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max);this._setOption("min",this.options.min);this._setOption("step",this.options.step);this._value(this.element.val(),true);this._draw();this._on(this._events);this._refresh();this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_getCreateOptions:function(){var options={},element=this.element;$.each(["min","max","step"],function(i,option){var value=element.attr(option);if(value!==undefined&&value.length){options[option]=value;}});return options;},_events:{keydown:function(event){if(this._start(event)&&this._keydown(event)){event.preventDefault();}},keyup:"_stop",focus:function(){this.previous=this.element.val();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
this._refresh();if(this.previous!==this.element.val()){this._trigger("change",event);}},mousewheel:function(event,delta){if(!delta){return;}
if(!this.spinning&&!this._start(event)){return false;}
this._spin((delta>0?1:-1)*this.options.step,event);clearTimeout(this.mousewheelTimer);this.mousewheelTimer=this._delay(function(){if(this.spinning){this._stop(event);}},100);event.preventDefault();},"mousedown .ui-spinner-button":function(event){var previous;previous=this.element[0]===this.document[0].activeElement?this.previous:this.element.val();function checkFocus(){var isActive=this.element[0]===this.document[0].activeElement;if(!isActive){this.element.focus();this.previous=previous;this._delay(function(){this.previous=previous;});}}
event.preventDefault();checkFocus.call(this);this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;checkFocus.call(this);});if(this._start(event)===false){return;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(event){if(!$(event.currentTarget).hasClass("ui-state-active")){return;}
if(this._start(event)===false){return false;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var uiSpinner=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton");this.buttons=uiSpinner.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all");if(this.buttons.height()>Math.ceil(uiSpinner.height()*0.5)&&uiSpinner.height()>0){uiSpinner.height(uiSpinner.height());}
if(this.options.disabled){this.disable();}},_keydown:function(event){var options=this.options,keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.UP:this._repeat(null,1,event);return true;case keyCode.DOWN:this._repeat(null,-1,event);return true;case keyCode.PAGE_UP:this._repeat(null,options.page,event);return true;case keyCode.PAGE_DOWN:this._repeat(null,-options.page,event);return true;}
return false;},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>";},_buttonHtml:function(){return""+"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'>"+"<span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>";},_start:function(event){if(!this.spinning&&this._trigger("start",event)===false){return false;}
if(!this.counter){this.counter=1;}
this.spinning=true;return true;},_repeat:function(i,steps,event){i=i||500;clearTimeout(this.timer);this.timer=this._delay(function(){this._repeat(40,steps,event);},i);this._spin(steps*this.options.step,event);},_spin:function(step,event){var value=this.value()||0;if(!this.counter){this.counter=1;}
value=this._adjustValue(value+step*this._increment(this.counter));if(!this.spinning||this._trigger("spin",event,{value:value})!==false){this._value(value);this.counter++;}},_increment:function(i){var incremental=this.options.incremental;if(incremental){return $.isFunction(incremental)?incremental(i):Math.floor(i*i*i/50000-i*i/500+17*i/200+1);}
return 1;},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf(".");return decimal===-1?0:str.length-decimal-1;},_adjustValue:function(value){var base,aboveMin,options=this.options;base=options.min!==null?options.min:0;aboveMin=value-base;aboveMin=Math.round(aboveMin/options.step)*options.step;value=base+aboveMin;value=parseFloat(value.toFixed(this._precision()));if(options.max!==null&&value>options.max){return options.max;}
if(options.min!==null&&value<options.min){return options.min;}
return value;},_stop:function(event){if(!this.spinning){return;}
clearTimeout(this.timer);clearTimeout(this.mousewheelTimer);this.counter=0;this.spinning=false;this._trigger("stop",event);},_setOption:function(key,value){if(key==="culture"||key==="numberFormat"){var prevValue=this._parse(this.element.val());this.options[key]=value;this.element.val(this._format(prevValue));return;}
if(key==="max"||key==="min"||key==="step"){if(typeof value==="string"){value=this._parse(value);}}
this._super(key,value);if(key==="disabled"){if(value){this.element.prop("disabled",true);this.buttons.button("disable");}else{this.element.prop("disabled",false);this.buttons.button("enable");}}},_setOptions:modifier(function(options){this._super(options);this._value(this.element.val());}),_parse:function(val){if(typeof val==="string"&&val!==""){val=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(val,10,this.options.culture):+val;}
return val===""||isNaN(val)?null:val;},_format:function(value){if(value===""){return"";}
return window.Globalize&&this.options.numberFormat?Globalize.format(value,this.options.numberFormat,this.options.culture):value;},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())});},_value:function(value,allowAny){var parsed;if(value!==""){parsed=this._parse(value);if(parsed!==null){if(!allowAny){parsed=this._adjustValue(parsed);}
value=this._format(parsed);}}
this.element.val(value);this._refresh();},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",false).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.uiSpinner.replaceWith(this.element);},stepUp:modifier(function(steps){this._stepUp(steps);}),_stepUp:function(steps){this._spin((steps||1)*this.options.step);},stepDown:modifier(function(steps){this._stepDown(steps);}),_stepDown:function(steps){this._spin((steps||1)*-this.options.step);},pageUp:modifier(function(pages){this._stepUp((pages||1)*this.options.page);}),pageDown:modifier(function(pages){this._stepDown((pages||1)*this.options.page);}),value:function(newVal){if(!arguments.length){return this._parse(this.element.val());}
modifier(this._value).call(this,newVal);},widget:function(){return this.uiSpinner;}});}(jQuery));(function($,undefined){var tabId=0,rhash=/#.*$/;function getNextTabId(){return++tabId;}
function isLocal(anchor){return anchor.hash.length>1&&anchor.href.replace(rhash,"")===location.href.replace(rhash,"");}
$.widget("ui.tabs",{version:"1.9.1",delay:300,options:{active:null,collapsible:false,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var that=this,options=this.options,active=options.active,locationHash=location.hash.substring(1);this.running=false;this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",options.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(event){if($(this).is(".ui-state-disabled")){event.preventDefault();}}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){if($(this).closest("li").is(".ui-state-disabled")){this.blur();}});this._processTabs();if(active===null){if(locationHash){this.tabs.each(function(i,tab){if($(tab).attr("aria-controls")===locationHash){active=i;return false;}});}
if(active===null){active=this.tabs.index(this.tabs.filter(".ui-tabs-active"));}
if(active===null||active===-1){active=this.tabs.length?0:false;}}
if(active!==false){active=this.tabs.index(this.tabs.eq(active));if(active===-1){active=options.collapsible?false:0;}}
options.active=active;if(!options.collapsible&&options.active===false&&this.anchors.length){options.active=0;}
if($.isArray(options.disabled)){options.disabled=$.unique(options.disabled.concat($.map(this.tabs.filter(".ui-state-disabled"),function(li){return that.tabs.index(li);}))).sort();}
if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(this.options.active);}else{this.active=$();}
this._refresh();if(this.active.length){this.load(options.active);}},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?$():this._getPanelForTab(this.active)};},_tabKeydown:function(event){var focusedTab=$(this.document[0].activeElement).closest("li"),selectedIndex=this.tabs.index(focusedTab),goingForward=true;if(this._handlePageNav(event)){return;}
switch(event.keyCode){case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:selectedIndex++;break;case $.ui.keyCode.UP:case $.ui.keyCode.LEFT:goingForward=false;selectedIndex--;break;case $.ui.keyCode.END:selectedIndex=this.anchors.length-1;break;case $.ui.keyCode.HOME:selectedIndex=0;break;case $.ui.keyCode.SPACE:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex);return;case $.ui.keyCode.ENTER:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex===this.options.active?false:selectedIndex);return;default:return;}
event.preventDefault();clearTimeout(this.activating);selectedIndex=this._focusNextTab(selectedIndex,goingForward);if(!event.ctrlKey){focusedTab.attr("aria-selected","false");this.tabs.eq(selectedIndex).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",selectedIndex);},this.delay);}},_panelKeydown:function(event){if(this._handlePageNav(event)){return;}
if(event.ctrlKey&&event.keyCode===$.ui.keyCode.UP){event.preventDefault();this.active.focus();}},_handlePageNav:function(event){if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true;}
if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true;}},_findNextTab:function(index,goingForward){var lastTabIndex=this.tabs.length-1;function constrain(){if(index>lastTabIndex){index=0;}
if(index<0){index=lastTabIndex;}
return index;}
while($.inArray(constrain(),this.options.disabled)!==-1){index=goingForward?index+1:index-1;}
return index;},_focusNextTab:function(index,goingForward){index=this._findNextTab(index,goingForward);this.tabs.eq(index).focus();return index;},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="disabled"){this._setupDisabled(value);return;}
this._super(key,value);if(key==="collapsible"){this.element.toggleClass("ui-tabs-collapsible",value);if(!value&&this.options.active===false){this._activate(0);}}
if(key==="event"){this._setupEvents(value);}
if(key==="heightStyle"){this._setupHeightStyle(value);}},_tabId:function(tab){return tab.attr("aria-controls")||"ui-tabs-"+getNextTabId();},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):"";},refresh:function(){var options=this.options,lis=this.tablist.children(":has(a[href])");options.disabled=$.map(lis.filter(".ui-state-disabled"),function(tab){return lis.index(tab);});this._processTabs();if(options.active===false||!this.anchors.length){options.active=false;this.active=$();}else if(this.active.length&&!$.contains(this.tablist[0],this.active[0])){if(this.tabs.length===options.disabled.length){options.active=false;this.active=$();}else{this._activate(this._findNextTab(Math.max(0,options.active-1),false));}}else{options.active=this.tabs.index(this.active);}
this._refresh();},_refresh:function(){this._setupDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0);}else{this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0});this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"});}},_processTabs:function(){var that=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist");this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1});this.anchors=this.tabs.map(function(){return $("a",this)[0];}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1});this.panels=$();this.anchors.each(function(i,anchor){var selector,panel,panelId,anchorId=$(anchor).uniqueId().attr("id"),tab=$(anchor).closest("li"),originalAriaControls=tab.attr("aria-controls");if(isLocal(anchor)){selector=anchor.hash;panel=that.element.find(that._sanitizeSelector(selector));}else{panelId=that._tabId(tab);selector="#"+panelId;panel=that.element.find(selector);if(!panel.length){panel=that._createPanel(panelId);panel.insertAfter(that.panels[i-1]||that.tablist);}
panel.attr("aria-live","polite");}
if(panel.length){that.panels=that.panels.add(panel);}
if(originalAriaControls){tab.data("ui-tabs-aria-controls",originalAriaControls);}
tab.attr({"aria-controls":selector.substring(1),"aria-labelledby":anchorId});panel.attr("aria-labelledby",anchorId);});this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel");},_getList:function(){return this.element.find("ol,ul").eq(0);},_createPanel:function(id){return $("<div>").attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true);},_setupDisabled:function(disabled){if($.isArray(disabled)){if(!disabled.length){disabled=false;}else if(disabled.length===this.anchors.length){disabled=true;}}
for(var i=0,li;(li=this.tabs[i]);i++){if(disabled===true||$.inArray(i,disabled)!==-1){$(li).addClass("ui-state-disabled").attr("aria-disabled","true");}else{$(li).removeClass("ui-state-disabled").removeAttr("aria-disabled");}}
this.options.disabled=disabled;},_setupEvents:function(event){var events={click:function(event){event.preventDefault();}};if(event){$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});}
this._off(this.anchors.add(this.tabs).add(this.panels));this._on(this.anchors,events);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs);},_setupHeightStyle:function(heightStyle){var maxHeight,overflow,parent=this.element.parent();if(heightStyle==="fill"){if(!$.support.minHeight){overflow=parent.css("overflow");parent.css("overflow","hidden");}
maxHeight=parent.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});if(overflow){parent.css("overflow",overflow);}
this.element.children().not(this.panels).each(function(){maxHeight-=$(this).outerHeight(true);});this.panels.each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.panels.each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}},_eventHandler:function(event){var options=this.options,active=this.active,anchor=$(event.currentTarget),tab=anchor.closest("li"),clickedIsActive=tab[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():this._getPanelForTab(tab),toHide=!active.length?$():this._getPanelForTab(active),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():tab,newPanel:toShow};event.preventDefault();if(tab.hasClass("ui-state-disabled")||tab.hasClass("ui-tabs-loading")||this.running||(clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.tabs.index(tab);this.active=clickedIsActive?$():tab;if(this.xhr){this.xhr.abort();}
if(!toHide.length&&!toShow.length){$.error("jQuery UI Tabs: Mismatching fragment identifier.");}
if(toShow.length){this.load(this.tabs.index(tab),event);}
this._toggle(event,eventData);},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel;this.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){eventData.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(toShow.length&&that.options.show){that._show(toShow,that.options.show,complete);}else{toShow.show();complete();}}
if(toHide.length&&this.options.hide){this._hide(toHide,this.options.hide,function(){eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");show();});}else{eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");toHide.hide();show();}
toHide.attr({"aria-expanded":"false","aria-hidden":"true"});eventData.oldTab.attr("aria-selected","false");if(toShow.length&&toHide.length){eventData.oldTab.attr("tabIndex",-1);}else if(toShow.length){this.tabs.filter(function(){return $(this).attr("tabIndex")===0;}).attr("tabIndex",-1);}
toShow.attr({"aria-expanded":"true","aria-hidden":"false"});eventData.newTab.attr({"aria-selected":"true",tabIndex:0});},_activate:function(index){var anchor,active=this._findActive(index);if(active[0]===this.active[0]){return;}
if(!active.length){active=this.active;}
anchor=active.find(".ui-tabs-anchor")[0];this._eventHandler({target:anchor,currentTarget:anchor,preventDefault:$.noop});},_findActive:function(index){return index===false?$():this.tabs.eq(index);},_getIndex:function(index){if(typeof index==="string"){index=this.anchors.index(this.anchors.filter("[href$='"+index+"']"));}
return index;},_destroy:function(){if(this.xhr){this.xhr.abort();}
this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible");this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role");this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeData("href.tabs").removeData("load.tabs").removeUniqueId();this.tabs.add(this.panels).each(function(){if($.data(this,"ui-tabs-destroy")){$(this).remove();}else{$(this).removeClass("ui-state-default ui-state-active ui-state-disabled "+"ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");}});this.tabs.each(function(){var li=$(this),prev=li.data("ui-tabs-aria-controls");if(prev){li.attr("aria-controls",prev);}else{li.removeAttr("aria-controls");}});if(this.options.heightStyle!=="content"){this.panels.css("height","");}},enable:function(index){var disabled=this.options.disabled;if(disabled===false){return;}
if(index===undefined){disabled=false;}else{index=this._getIndex(index);if($.isArray(disabled)){disabled=$.map(disabled,function(num){return num!==index?num:null;});}else{disabled=$.map(this.tabs,function(li,num){return num!==index?num:null;});}}
this._setupDisabled(disabled);},disable:function(index){var disabled=this.options.disabled;if(disabled===true){return;}
if(index===undefined){disabled=true;}else{index=this._getIndex(index);if($.inArray(index,disabled)!==-1){return;}
if($.isArray(disabled)){disabled=$.merge([index],disabled).sort();}else{disabled=[index];}}
this._setupDisabled(disabled);},load:function(index,event){index=this._getIndex(index);var that=this,tab=this.tabs.eq(index),anchor=tab.find(".ui-tabs-anchor"),panel=this._getPanelForTab(tab),eventData={tab:tab,panel:panel};if(isLocal(anchor[0])){return;}
this.xhr=$.ajax(this._ajaxSettings(anchor,event,eventData));if(this.xhr&&this.xhr.statusText!=="canceled"){tab.addClass("ui-tabs-loading");panel.attr("aria-busy","true");this.xhr.success(function(response){setTimeout(function(){panel.html(response);that._trigger("load",event,eventData);},1);}).complete(function(jqXHR,status){setTimeout(function(){if(status==="abort"){that.panels.stop(false,true);}
tab.removeClass("ui-tabs-loading");panel.removeAttr("aria-busy");if(jqXHR===that.xhr){delete that.xhr;}},1);});}},_ajaxSettings:function(anchor,event,eventData){var that=this;return{url:anchor.attr("href"),beforeSend:function(jqXHR,settings){return that._trigger("beforeLoad",event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData));}};},_getPanelForTab:function(tab){var id=$(tab).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+id));}});if($.uiBackCompat!==false){$.ui.tabs.prototype._ui=function(tab,panel){return{tab:tab,panel:panel,index:this.anchors.index(tab)};};$.widget("ui.tabs",$.ui.tabs,{url:function(index,url){this.anchors.eq(index).attr("href",url);}});$.widget("ui.tabs",$.ui.tabs,{options:{ajaxOptions:null,cache:false},_create:function(){this._super();var that=this;this._on({tabsbeforeload:function(event,ui){if($.data(ui.tab[0],"cache.tabs")){event.preventDefault();return;}
ui.jqXHR.success(function(){if(that.options.cache){$.data(ui.tab[0],"cache.tabs",true);}});}});},_ajaxSettings:function(anchor,event,ui){var ajaxOptions=this.options.ajaxOptions;return $.extend({},ajaxOptions,{error:function(xhr,status){try{ajaxOptions.error(xhr,status,ui.tab.closest("li").index(),ui.tab[0]);}
catch(error){}}},this._superApply(arguments));},_setOption:function(key,value){if(key==="cache"&&value===false){this.anchors.removeData("cache.tabs");}
this._super(key,value);},_destroy:function(){this.anchors.removeData("cache.tabs");this._super();},url:function(index){this.anchors.eq(index).removeData("cache.tabs");this._superApply(arguments);}});$.widget("ui.tabs",$.ui.tabs,{abort:function(){if(this.xhr){this.xhr.abort();}}});$.widget("ui.tabs",$.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super();this._on({tabsbeforeload:function(event,ui){if(event.target!==this.element[0]||!this.options.spinner){return;}
var span=ui.tab.find("span"),html=span.html();span.html(this.options.spinner);ui.jqXHR.complete(function(){span.html(html);});}});}});$.widget("ui.tabs",$.ui.tabs,{options:{enable:null,disable:null},enable:function(index){var options=this.options,trigger;if(index&&options.disabled===true||($.isArray(options.disabled)&&$.inArray(index,options.disabled)!==-1)){trigger=true;}
this._superApply(arguments);if(trigger){this._trigger("enable",null,this._ui(this.anchors[index],this.panels[index]));}},disable:function(index){var options=this.options,trigger;if(index&&options.disabled===false||($.isArray(options.disabled)&&$.inArray(index,options.disabled)===-1)){trigger=true;}
this._superApply(arguments);if(trigger){this._trigger("disable",null,this._ui(this.anchors[index],this.panels[index]));}}});$.widget("ui.tabs",$.ui.tabs,{options:{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},add:function(url,label,index){if(index===undefined){index=this.anchors.length;}
var doInsertAfter,panel,options=this.options,li=$(options.tabTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label)),id=!url.indexOf("#")?url.replace("#",""):this._tabId(li);li.addClass("ui-state-default ui-corner-top").data("ui-tabs-destroy",true);li.attr("aria-controls",id);doInsertAfter=index>=this.tabs.length;panel=this.element.find("#"+id);if(!panel.length){panel=this._createPanel(id);if(doInsertAfter){if(index>0){panel.insertAfter(this.panels.eq(-1));}else{panel.appendTo(this.element);}}else{panel.insertBefore(this.panels[index]);}}
panel.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide();if(doInsertAfter){li.appendTo(this.tablist);}else{li.insertBefore(this.tabs[index]);}
options.disabled=$.map(options.disabled,function(n){return n>=index?++n:n;});this.refresh();if(this.tabs.length===1&&options.active===false){this.option("active",0);}
this._trigger("add",null,this._ui(this.anchors[index],this.panels[index]));return this;},remove:function(index){index=this._getIndex(index);var options=this.options,tab=this.tabs.eq(index).remove(),panel=this._getPanelForTab(tab).remove();if(tab.hasClass("ui-tabs-active")&&this.anchors.length>2){this._activate(index+(index+1<this.anchors.length?1:-1));}
options.disabled=$.map($.grep(options.disabled,function(n){return n!==index;}),function(n){return n>=index?--n:n;});this.refresh();this._trigger("remove",null,this._ui(tab.find("a")[0],panel[0]));return this;}});$.widget("ui.tabs",$.ui.tabs,{length:function(){return this.anchors.length;}});$.widget("ui.tabs",$.ui.tabs,{options:{idPrefix:"ui-tabs-"},_tabId:function(tab){var a=tab.is("li")?tab.find("a[href]"):tab;a=a[0];return $(a).closest("li").attr("aria-controls")||a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF\-]/g,"")||this.options.idPrefix+getNextTabId();}});$.widget("ui.tabs",$.ui.tabs,{options:{panelTemplate:"<div></div>"},_createPanel:function(id){return $(this.options.panelTemplate).attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",true);}});$.widget("ui.tabs",$.ui.tabs,{_create:function(){var options=this.options;if(options.active===null&&options.selected!==undefined){options.active=options.selected===-1?false:options.selected;}
this._super();options.selected=options.active;if(options.selected===false){options.selected=-1;}},_setOption:function(key,value){if(key!=="selected"){return this._super(key,value);}
var options=this.options;this._super("active",value===-1?false:value);options.selected=options.active;if(options.selected===false){options.selected=-1;}},_eventHandler:function(){this._superApply(arguments);this.options.selected=this.options.active;if(this.options.selected===false){this.options.selected=-1;}}});$.widget("ui.tabs",$.ui.tabs,{options:{show:null,select:null},_create:function(){this._super();if(this.options.active!==false){this._trigger("show",null,this._ui(this.active.find(".ui-tabs-anchor")[0],this._getPanelForTab(this.active)[0]));}},_trigger:function(type,event,data){var ret=this._superApply(arguments);if(!ret){return false;}
if(type==="beforeActivate"&&data.newTab.length){ret=this._super("select",event,{tab:data.newTab.find(".ui-tabs-anchor")[0],panel:data.newPanel[0],index:data.newTab.closest("li").index()});}else if(type==="activate"&&data.newTab.length){ret=this._super("show",event,{tab:data.newTab.find(".ui-tabs-anchor")[0],panel:data.newPanel[0],index:data.newTab.closest("li").index()});}
return ret;}});$.widget("ui.tabs",$.ui.tabs,{select:function(index){index=this._getIndex(index);if(index===-1){if(this.options.collapsible&&this.options.selected!==-1){index=this.options.selected;}else{return;}}
this.anchors.eq(index).trigger(this.options.event+this.eventNamespace);}});(function(){var listId=0;$.widget("ui.tabs",$.ui.tabs,{options:{cookie:null},_create:function(){var options=this.options,active;if(options.active==null&&options.cookie){active=parseInt(this._cookie(),10);if(active===-1){active=false;}
options.active=active;}
this._super();},_cookie:function(active){var cookie=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+(++listId))];if(arguments.length){cookie.push(active===false?-1:active);cookie.push(this.options.cookie);}
return $.cookie.apply(null,cookie);},_refresh:function(){this._super();if(this.options.cookie){this._cookie(this.options.active,this.options.cookie);}},_eventHandler:function(){this._superApply(arguments);if(this.options.cookie){this._cookie(this.options.active,this.options.cookie);}},_destroy:function(){this._super();if(this.options.cookie){this._cookie(null,this.options.cookie);}}});})();$.widget("ui.tabs",$.ui.tabs,{_trigger:function(type,event,data){var _data=$.extend({},data);if(type==="load"){_data.panel=_data.panel[0];_data.tab=_data.tab.find(".ui-tabs-anchor")[0];}
return this._super(type,event,_data);}});$.widget("ui.tabs",$.ui.tabs,{options:{fx:null},_getFx:function(){var hide,show,fx=this.options.fx;if(fx){if($.isArray(fx)){hide=fx[0];show=fx[1];}else{hide=show=fx;}}
return fx?{show:show,hide:hide}:null;},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel,fx=this._getFx();if(!fx){return this._super(event,eventData);}
that.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){eventData.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(toShow.length&&fx.show){toShow.animate(fx.show,fx.show.duration,function(){complete();});}else{toShow.show();complete();}}
if(toHide.length&&fx.hide){toHide.animate(fx.hide,fx.hide.duration,function(){eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");show();});}else{eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");toHide.hide();show();}}});}})(jQuery);(function($){var increments=0;function addDescribedBy(elem,id){var describedby=(elem.attr("aria-describedby")||"").split(/\s+/);describedby.push(id);elem.data("ui-tooltip-id",id).attr("aria-describedby",$.trim(describedby.join(" ")));}
function removeDescribedBy(elem){var id=elem.data("ui-tooltip-id"),describedby=(elem.attr("aria-describedby")||"").split(/\s+/),index=$.inArray(id,describedby);if(index!==-1){describedby.splice(index,1);}
elem.removeData("ui-tooltip-id");describedby=$.trim(describedby.join(" "));if(describedby){elem.attr("aria-describedby",describedby);}else{elem.removeAttr("aria-describedby");}}
$.widget("ui.tooltip",{version:"1.9.1",options:{content:function(){return $(this).attr("title");},hide:true,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flipfit"},show:true,tooltipClass:null,track:false,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};if(this.options.disabled){this._disable();}},_setOption:function(key,value){var that=this;if(key==="disabled"){this[value?"_disable":"_enable"]();this.options[key]=value;return;}
this._super(key,value);if(key==="content"){$.each(this.tooltips,function(id,element){that._updateContent(element);});}},_disable:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);});this.element.find(this.options.items).andSelf().each(function(){var element=$(this);if(element.is("[title]")){element.data("ui-tooltip-title",element.attr("title")).attr("title","");}});},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var element=$(this);if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));}});},open:function(event){var that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length){return;}
if(this.options.track&&target.data("ui-tooltip-id")){this._find(target).position($.extend({of:target},this.options.position));this._off(this.document,"mousemove");return;}
if(target.attr("title")){target.data("ui-tooltip-title",target.attr("title"));}
target.data("tooltip-open",true);if(event&&event.type==="mouseover"){target.parents().each(function(){var blurEvent;if($(this).data("tooltip-open")){blurEvent=$.Event("blur");blurEvent.target=blurEvent.currentTarget=this;that.close(blurEvent,true);}
if(this.title){$(this).uniqueId();that.parents[this.id]={element:this,title:this.title};this.title="";}});}
this._updateContent(target,event);},_updateContent:function(target,event){var content,contentOption=this.options.content,that=this;if(typeof contentOption==="string"){return this._open(event,target,contentOption);}
content=contentOption.call(target[0],function(response){if(!target.data("tooltip-open")){return;}
that._delay(function(){this._open(event,target,response);});});if(content){this._open(event,target,content);}},_open:function(event,target,content){var tooltip,events,delayedShow,positionOption=$.extend({},this.options.position);if(!content){return;}
tooltip=this._find(target);if(tooltip.length){tooltip.find(".ui-tooltip-content").html(content);return;}
if(target.is("[title]")){if(event&&event.type==="mouseover"){target.attr("title","");}else{target.removeAttr("title");}}
tooltip=this._tooltip(target);addDescribedBy(target,tooltip.attr("id"));tooltip.find(".ui-tooltip-content").html(content);function position(event){positionOption.of=event;if(tooltip.is(":hidden")){return;}
tooltip.position(positionOption);}
if(this.options.track&&event&&/^mouse/.test(event.originalEvent.type)){this._on(this.document,{mousemove:position});position(event);}else{tooltip.position($.extend({of:target},this.options.position));}
tooltip.hide();this._show(tooltip,this.options.show);if(this.options.show&&this.options.show.delay){delayedShow=setInterval(function(){if(tooltip.is(":visible")){position(positionOption.of);clearInterval(delayedShow);}},$.fx.interval);}
this._trigger("open",event,{tooltip:tooltip});events={keyup:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}},remove:function(){this._removeTooltip(tooltip);}};if(!event||event.type==="mouseover"){events.mouseleave="close";}
if(!event||event.type==="focusin"){events.focusout="close";}
this._on(target,events);},close:function(event){var that=this,target=$(event?event.currentTarget:this.element),tooltip=this._find(target);if(this.closing){return;}
if(target.data("ui-tooltip-title")){target.attr("title",target.data("ui-tooltip-title"));}
removeDescribedBy(target);tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){that._removeTooltip($(this));});target.removeData("tooltip-open");this._off(target,"mouseleave focusout keyup");if(target[0]!==this.element[0]){this._off(target,"remove");}
this._off(this.document,"mousemove");if(event&&event.type==="mouseleave"){$.each(this.parents,function(id,parent){parent.element.title=parent.title;delete that.parents[id];});}
this.closing=true;this._trigger("close",event,{tooltip:tooltip});this.closing=false;},_tooltip:function(element){var id="ui-tooltip-"+increments++,tooltip=$("<div>").attr({id:id,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+
(this.options.tooltipClass||""));$("<div>").addClass("ui-tooltip-content").appendTo(tooltip);tooltip.appendTo(this.document[0].body);if($.fn.bgiframe){tooltip.bgiframe();}
this.tooltips[id]=element;return tooltip;},_find:function(target){var id=target.data("ui-tooltip-id");return id?$("#"+id):$();},_removeTooltip:function(tooltip){tooltip.remove();delete this.tooltips[tooltip.attr("id")];},_destroy:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);$("#"+id).remove();if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));element.removeData("ui-tooltip-title");}});}});}(jQuery));;(jQuery.effects||(function($,undefined){var backCompat=$.uiBackCompat!==false,dataSpace="ui-effects-";$.effects={effect:{}};(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor".split(" "),rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}
value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}
if(type.mod){return(value+type.mod)%type.mod;}
return 0>value?0:type.max<value?type.max:value;}
function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}
return inst;}
return colors[string];}
color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}
if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}
var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}
if(type==="string"){return this.parse(stringParse(red)||colors._default);}
if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}
if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}
inst[cache]=space.to(inst._rgba);}
inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&$.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}
return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}
return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}
if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}
result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}
var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}
return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}
if(i&&i<3){v=Math.round(v*100)+"%";}
return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}
return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}
return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}
if(h*2<1){return q;}
if(h*3<2){return p+(q-p)*((2/3)-h)*6;}
return p;}
spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}
var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}
if(l===0||l===1){s=l;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}
return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}
var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}
if(value===undefined){return this[cache].slice();}
var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}
local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}
color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}
if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}
if(value==null&&prop.empty){return this;}
if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}
local[prop.idx]=value;return this[fn](local);};});});each(stepHooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(jQuery.type(value)!=="string"||(parsed=stringParse(value))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}
value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}
value=value.toRgbaString();}
try{elem.style[hook]=value;}catch(error){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}
jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};})(jQuery);(function(){var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};$.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=="none"&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function getElementStyles(){var style=this.ownerDocument.defaultView?this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,newStyle={},key,len;if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==="string"){newStyle[$.camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==="string"){newStyle[key]=style[key];}}}
return newStyle;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!==value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr("class")||"",applyClassChange,allAnimations=o.children?animated.find("*").andSelf():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,start:getElementStyles.call(this)};});applyClassChange=function(){$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+"Class"](value[action]);}});};applyClassChange();allAnimations=allAnimations.map(function(){this.end=getElementStyles.call(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr("class",baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred(),opts=jQuery.extend({},o,{queue:false,complete:function(){dfd.resolve(styleInfo);}});this.el.animate(this.diff,opts);return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){applyClassChange();$.each(arguments,function(){var el=this.el;$.each(this.diff,function(key){el.css(key,'');});});o.complete.call(animated[0]);});});};$.fn.extend({_addClass:$.fn.addClass,addClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{add:classNames},speed,easing,callback):this._addClass(classNames);},_removeClass:$.fn.removeClass,removeClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{remove:classNames},speed,easing,callback):this._removeClass(classNames);},_toggleClass:$.fn.toggleClass,toggleClass:function(classNames,force,speed,easing,callback){if(typeof force==="boolean"||force===undefined){if(!speed){return this._toggleClass(classNames,force);}else{return $.effects.animateClass.call(this,(force?{add:classNames}:{remove:classNames}),speed,easing,callback);}}else{return $.effects.animateClass.call(this,{toggle:classNames},force,speed,easing);}},switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.call(this,{add:add,remove:remove},speed,easing,callback);}});})();(function(){$.extend($.effects,{version:"1.9.1",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){var val,i;for(i=0;i<set.length;i++){if(set[i]!==null){val=element.data(dataSpace+set[i]);if(val===undefined){val="";}
element.css(set[i],val);}}},setMode:function(el,mode){if(mode==="toggle"){mode=el.is(":hidden")?"show":"hide";}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/original.height;}
switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/original.width;}
return{x:x,y:y};},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;try{active.id;}catch(e){active=document.body;}
element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}
wrapper=element.parent();if(element.css("position")==="static"){wrapper.css({position:"relative"});element.css({position:"relative"});}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto";}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}}
return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1];}});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){options=effect;effect=effect.effect;}
effect={effect:effect};if(options==null){options={};}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options==="number"||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardSpeed(speed){if(!speed||typeof speed==="number"||$.fx.speeds[speed]){return true;}
if(typeof speed==="string"&&!$.effects.effect[speed]){if(backCompat&&$.effects[speed]){return false;}
return true;}
return false;}
$.fn.extend({effect:function(){var args=_normalizeArguments.apply(this,arguments),mode=args.mode,queue=args.queue,effectMethod=$.effects.effect[args.effect],oldEffectMethod=!effectMethod&&backCompat&&$.effects[args.effect];if($.fx.off||!(effectMethod||oldEffectMethod)){if(mode){return this[mode](args.duration,args.complete);}else{return this.each(function(){if(args.complete){args.complete.call(this);}});}}
function run(next){var elem=$(this),complete=args.complete,mode=args.mode;function done(){if($.isFunction(complete)){complete.call(elem[0]);}
if($.isFunction(next)){next();}}
if(elem.is(":hidden")?mode==="hide":mode==="show"){done();}else{effectMethod.call(elem[0],args,done);}}
if(effectMethod){return queue===false?this.each(run):this.queue(queue||"fx",run);}else{return oldEffectMethod.call(this,{options:args,duration:args.duration,callback:args.complete,mode:args.mode});}},_show:$.fn.show,show:function(speed){if(standardSpeed(speed)){return this._show.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="show";return this.effect.call(this,args);}},_hide:$.fn.hide,hide:function(speed){if(standardSpeed(speed)){return this._hide.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="hide";return this.effect.call(this,args);}},__toggle:$.fn.toggle,toggle:function(speed){if(standardSpeed(speed)||typeof speed==="boolean"||$.isFunction(speed)){return this.__toggle.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="toggle";return this.effect.call(this,args);}},cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit];}});return val;}});})();(function(){var baseEasings={};$.each(["Quad","Cubic","Quart","Quint","Expo"],function(i,name){baseEasings[name]=function(p){return Math.pow(p,i+2);};});$.extend(baseEasings,{Sine:function(p){return 1-Math.cos(p*Math.PI/2);},Circ:function(p){return 1-Math.sqrt(1-p*p);},Elastic:function(p){return p===0||p===1?p:-Math.pow(2,8*(p-1))*Math.sin(((p-1)*80-7.5)*Math.PI/15);},Back:function(p){return p*p*(3*p-2);},Bounce:function(p){var pow2,bounce=4;while(p<((pow2=Math.pow(2,--bounce))-1)/11){}
return 1/Math.pow(4,3-bounce)-7.5625*Math.pow((pow2*3-2)/22-p,2);}});$.each(baseEasings,function(name,easeIn){$.easing["easeIn"+name]=easeIn;$.easing["easeOut"+name]=function(p){return 1-easeIn(1-p);};$.easing["easeInOut"+name]=function(p){return p<0.5?easeIn(p*2)/2:1-easeIn(p*-2+2)/2;};});})();})(jQuery));(function($,undefined){var rvertical=/up|down|vertical/,rpositivemotion=/up|left|vertical|horizontal/;$.effects.effect.blind=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),direction=o.direction||"up",vertical=rvertical.test(direction),ref=vertical?"height":"width",ref2=vertical?"top":"left",motion=rpositivemotion.test(direction),animation={},show=mode==="show",wrapper,distance,margin;if(el.parent().is(".ui-effects-wrapper")){$.effects.save(el.parent(),props);}else{$.effects.save(el,props);}
el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=wrapper[ref]();margin=parseFloat(wrapper.css(ref2))||0;animation[ref]=show?distance:0;if(!motion){el.css(vertical?"bottom":"right",0).css(vertical?"top":"left","auto").css({position:"absolute"});animation[ref2]=show?margin:distance+margin;}
if(show){wrapper.css(ref,0);if(!motion){wrapper.css(ref2,margin+distance);}}
wrapper.animate(animation,{duration:o.duration,easing:o.easing,queue:false,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.bounce=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),hide=mode==="hide",show=mode==="show",direction=o.direction||"up",distance=o.distance,times=o.times||5,anims=times*2+(show||hide?1:0),speed=o.duration/anims,easing=o.easing,ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left"),i,upAnim,downAnim,queue=el.queue(),queuelen=queue.length;if(show||hide){props.push("opacity");}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);if(!distance){distance=el[ref==="top"?"outerHeight":"outerWidth"]()/3;}
if(show){downAnim={opacity:1};downAnim[ref]=0;el.css("opacity",0).css(ref,motion?-distance*2:distance*2).animate(downAnim,speed,easing);}
if(hide){distance=distance/Math.pow(2,times-1);}
downAnim={};downAnim[ref]=0;for(i=0;i<times;i++){upAnim={};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing).animate(downAnim,speed,easing);distance=hide?distance*2:distance/2;}
if(hide){upAnim={opacity:0};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing);}
el.queue(function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.clip=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"vertical",vert=direction==="vertical",size=vert?"height":"width",position=vert?"top":"left",animation={},wrapper,animate,distance;$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});animate=(el[0].tagName==="IMG")?wrapper:el;distance=animate[size]();if(show){animate.css(size,0);animate.css(position,distance/2);}
animation[size]=show?distance:0;animation[position]=show?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(!show){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.drop=function(o,done){var el=$(this),props=["position","top","bottom","left","right","opacity","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left")?"pos":"neg",animation={opacity:show?1:0},distance;$.effects.save(el,props);el.show();$.effects.createWrapper(el);distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"](true)/2;if(show){el.css("opacity",0).css(ref,motion==="pos"?-distance:distance);}
animation[ref]=(show?(motion==="pos"?"+=":"-="):(motion==="pos"?"-=":"+="))+
distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.explode=function(o,done){var rows=o.pieces?Math.round(Math.sqrt(o.pieces)):3,cells=rows,el=$(this),mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",offset=el.show().css("visibility","hidden").offset(),width=Math.ceil(el.outerWidth()/cells),height=Math.ceil(el.outerHeight()/rows),pieces=[],i,j,left,top,mx,my;function childComplete(){pieces.push(this);if(pieces.length===rows*cells){animComplete();}}
for(i=0;i<rows;i++){top=offset.top+i*height;my=i-(rows-1)/2;for(j=0;j<cells;j++){left=offset.left+j*width;mx=j-(cells-1)/2;el.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*width,top:-i*height}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:width,height:height,left:left+(show?mx*width:0),top:top+(show?my*height:0),opacity:show?0:1}).animate({left:left+(show?0:mx*width),top:top+(show?0:my*height),opacity:show?1:0},o.duration||500,o.easing,childComplete);}}
function animComplete(){el.css({visibility:"visible"});$(pieces).remove();if(!show){el.hide();}
done();}};})(jQuery);(function($,undefined){$.effects.effect.fade=function(o,done){var el=$(this),mode=$.effects.setMode(el,o.mode||"toggle");el.animate({opacity:mode},{queue:false,duration:o.duration,easing:o.easing,complete:done});};})(jQuery);(function($,undefined){$.effects.effect.fold=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",hide=mode==="hide",size=o.size||15,percent=/([0-9]+)%/.exec(size),horizFirst=!!o.horizFirst,widthFirst=show!==horizFirst,ref=widthFirst?["width","height"]:["height","width"],duration=o.duration/2,wrapper,distance,animation1={},animation2={};$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];if(percent){size=parseInt(percent[1],10)/100*distance[hide?0:1];}
if(show){wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0});}
animation1[ref[0]]=show?distance[0]:size;animation2[ref[1]]=show?distance[1]:0;wrapper.animate(animation1,duration,o.easing).animate(animation2,duration,o.easing,function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});};})(jQuery);(function($,undefined){$.effects.effect.highlight=function(o,done){var elem=$(this),props=["backgroundImage","backgroundColor","opacity"],mode=$.effects.setMode(elem,o.mode||"show"),animation={backgroundColor:elem.css("backgroundColor")};if(mode==="hide"){animation.opacity=0;}
$.effects.save(elem,props);elem.show().css({backgroundImage:"none",backgroundColor:o.color||"#ffff99"}).animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){elem.hide();}
$.effects.restore(elem,props);done();}});};})(jQuery);(function($,undefined){$.effects.effect.pulsate=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"show"),show=mode==="show",hide=mode==="hide",showhide=(show||mode==="hide"),anims=((o.times||5)*2)+(showhide?1:0),duration=o.duration/anims,animateTo=0,queue=elem.queue(),queuelen=queue.length,i;if(show||!elem.is(":visible")){elem.css("opacity",0).show();animateTo=1;}
for(i=1;i<anims;i++){elem.animate({opacity:animateTo},duration,o.easing);animateTo=1-animateTo;}
elem.animate({opacity:animateTo},duration,o.easing);elem.queue(function(){if(hide){elem.hide();}
done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
elem.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.puff=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"hide"),hide=mode==="hide",percent=parseInt(o.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width()};$.extend(o,{effect:"scale",queue:false,fade:true,mode:mode,complete:done,percent:hide?percent:100,from:hide?original:{height:original.height*factor,width:original.width*factor}});elem.effect(o);};$.effects.effect.scale=function(o,done){var el=$(this),options=$.extend(true,{},o),mode=$.effects.setMode(el,o.mode||"effect"),percent=parseInt(o.percent,10)||(parseInt(o.percent,10)===0?0:(mode==="hide"?0:100)),direction=o.direction||"both",origin=o.origin,original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()},factor={y:direction!=="horizontal"?(percent/100):1,x:direction!=="vertical"?(percent/100):1};options.effect="size";options.queue=false;options.complete=done;if(mode!=="effect"){options.origin=origin||["middle","center"];options.restore=true;}
options.from=o.from||(mode==="show"?{height:0,width:0}:original);options.to={height:original.height*factor.y,width:original.width*factor.x,outerHeight:original.outerHeight*factor.y,outerWidth:original.outerWidth*factor.x};if(options.fade){if(mode==="show"){options.from.opacity=0;options.to.opacity=1;}
if(mode==="hide"){options.from.opacity=1;options.to.opacity=0;}}
el.effect(options);};$.effects.effect.size=function(o,done){var original,baseline,factor,el=$(this),props0=["position","top","bottom","left","right","width","height","overflow","opacity"],props1=["position","top","bottom","left","right","overflow","opacity"],props2=["width","height","overflow"],cProps=["fontSize"],vProps=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],hProps=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],mode=$.effects.setMode(el,o.mode||"effect"),restore=o.restore||mode!=="effect",scale=o.scale||"both",origin=o.origin||["middle","center"],position=el.css("position"),props=restore?props0:props1,zero={height:0,width:0};if(mode==="show"){el.show();}
original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()};if(o.mode==="toggle"&&mode==="show"){el.from=o.to||zero;el.to=o.from||original;}else{el.from=o.from||(mode==="show"?zero:original);el.to=o.to||(mode==="hide"?zero:original);}
factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale==="box"||scale==="both"){if(factor.from.y!==factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to);}
if(factor.from.x!==factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to);}}
if(scale==="content"||scale==="both"){if(factor.from.y!==factor.to.y){props=props.concat(cProps).concat(props2);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to);}}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);el.css("overflow","hidden").css(el.from);if(origin){baseline=$.effects.getBaseline(origin,original);el.from.top=(original.outerHeight-el.outerHeight())*baseline.y;el.from.left=(original.outerWidth-el.outerWidth())*baseline.x;el.to.top=(original.outerHeight-el.to.outerHeight)*baseline.y;el.to.left=(original.outerWidth-el.to.outerWidth)*baseline.x;}
el.css(el.from);if(scale==="content"||scale==="both"){vProps=vProps.concat(["marginTop","marginBottom"]).concat(cProps);hProps=hProps.concat(["marginLeft","marginRight"]);props2=props0.concat(vProps).concat(hProps);el.find("*[width]").each(function(){var child=$(this),c_original={height:child.height(),width:child.width()};if(restore){$.effects.save(child,props2);}
child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x};if(factor.from.y!==factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to);}
if(factor.from.x!==factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to);}
child.css(child.from);child.animate(child.to,o.duration,o.easing,function(){if(restore){$.effects.restore(child,props2);}});});}
el.animate(el.to,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(el.to.opacity===0){el.css("opacity",el.from.opacity);}
if(mode==="hide"){el.hide();}
$.effects.restore(el,props);if(!restore){if(position==="static"){el.css({position:"relative",top:el.to.top,left:el.to.left});}else{$.each(["top","left"],function(idx,pos){el.css(pos,function(_,str){var val=parseInt(str,10),toRef=idx?el.to.left:el.to.top;if(str==="auto"){return toRef+"px";}
return val+toRef+"px";});});}}
$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.shake=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),direction=o.direction||"left",distance=o.distance||20,times=o.times||3,anims=times*2+1,speed=Math.round(o.duration/anims),ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),animation={},animation1={},animation2={},i,queue=el.queue(),queuelen=queue.length;$.effects.save(el,props);el.show();$.effects.createWrapper(el);animation[ref]=(positiveMotion?"-=":"+=")+distance;animation1[ref]=(positiveMotion?"+=":"-=")+distance*2;animation2[ref]=(positiveMotion?"-=":"+=")+distance*2;el.animate(animation,speed,o.easing);for(i=1;i<times;i++){el.animate(animation1,speed,o.easing).animate(animation2,speed,o.easing);}
el.animate(animation1,speed,o.easing).animate(animation,speed/2,o.easing).queue(function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.slide=function(o,done){var el=$(this),props=["position","top","bottom","left","right","width","height"],mode=$.effects.setMode(el,o.mode||"show"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),distance,animation={};$.effects.save(el,props);el.show();distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"](true);$.effects.createWrapper(el).css({overflow:"hidden"});if(show){el.css(ref,positiveMotion?(isNaN(distance)?"-"+distance:-distance):distance);}
animation[ref]=(show?(positiveMotion?"+=":"-="):(positiveMotion?"-=":"+="))+
distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.transfer=function(o,done){var elem=$(this),target=$(o.to),targetFixed=target.css("position")==="fixed",body=$("body"),fixTop=targetFixed?body.scrollTop():0,fixLeft=targetFixed?body.scrollLeft():0,endPosition=target.offset(),animation={top:endPosition.top-fixTop,left:endPosition.left-fixLeft,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(o.className).css({top:startPosition.top-fixTop,left:startPosition.left-fixLeft,height:elem.innerHeight(),width:elem.innerWidth(),position:targetFixed?"fixed":"absolute"}).animate(animation,o.duration,o.easing,function(){transfer.remove();done();});};})(jQuery);;(function($){$.extend($.ui,{timepicker:{version:"0.9.9"}});function Timepicker(){this.regional=[];this.regional['']={currentText:'Now',closeText:'Done',ampm:false,amNames:['AM','A'],pmNames:['PM','P'],timeFormat:'hh:mm tt',timeSuffix:'',timeOnlyTitle:'Choose Time',timeText:'Time',hourText:'Hour',minuteText:'Minute',secondText:'Second',millisecText:'Millisecond',timezoneText:'Time Zone'};this._defaults={showButtonPanel:true,timeOnly:false,showHour:true,showMinute:true,showSecond:false,showMillisec:false,showTimezone:false,showTime:true,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:'+0000',hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:true,separator:' ',altFieldTimeOnly:true,showTimepicker:true,timezoneIso8609:false,timezoneList:null,addSliderAccess:false,sliderAccessArgs:null};$.extend(this._defaults,this.regional['']);};$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:'+0000',hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:'',formattedDate:'',formattedTime:'',formattedDateTime:'',timezoneList:null,setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_newInst:function($input,o){var tp_inst=new Timepicker(),inlineSettings={};for(var attrName in this._defaults){var attrValue=$input.attr('time:'+attrName);if(attrValue){try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,{beforeShow:function(input,dp_inst){if($.isFunction(o.beforeShow))
return o.beforeShow(input,dp_inst,tp_inst);},onChangeMonthYear:function(year,month,dp_inst){tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onChangeMonthYear))
o.onChangeMonthYear.call($input[0],year,month,dp_inst,tp_inst);},onClose:function(dateText,dp_inst){if(tp_inst.timeDefined===true&&$input.val()!='')
tp_inst._updateDateTime(dp_inst);if($.isFunction(o.onClose))
o.onClose.call($input[0],dateText,dp_inst,tp_inst);},timepicker:tp_inst});tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(val){return val.toUpperCase()});tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(val){return val.toUpperCase()});if(tp_inst._defaults.timezoneList===null){var timezoneList=[];for(var i=-11;i<=12;i++)
timezoneList.push((i>=0?'+':'-')+('0'+Math.abs(i).toString()).slice(-2)+'00');if(tp_inst._defaults.timezoneIso8609)
timezoneList=$.map(timezoneList,function(val){return val=='+0000'?'Z':(val.substring(0,3)+':'+val.substring(3));});tp_inst._defaults.timezoneList=timezoneList;}
tp_inst.hour=tp_inst._defaults.hour;tp_inst.minute=tp_inst._defaults.minute;tp_inst.second=tp_inst._defaults.second;tp_inst.millisec=tp_inst._defaults.millisec;tp_inst.ampm='';tp_inst.$input=$input;if(o.altField)
tp_inst.$altInput=$(o.altField).css({cursor:'pointer'}).focus(function(){$input.trigger("focus");});if(tp_inst._defaults.minDate==0||tp_inst._defaults.minDateTime==0)
{tp_inst._defaults.minDate=new Date();}
if(tp_inst._defaults.maxDate==0||tp_inst._defaults.maxDateTime==0)
{tp_inst._defaults.maxDate=new Date();}
if(tp_inst._defaults.minDate!==undefined&&tp_inst._defaults.minDate instanceof Date)
tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime());if(tp_inst._defaults.minDateTime!==undefined&&tp_inst._defaults.minDateTime instanceof Date)
tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime());if(tp_inst._defaults.maxDate!==undefined&&tp_inst._defaults.maxDate instanceof Date)
tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime());if(tp_inst._defaults.maxDateTime!==undefined&&tp_inst._defaults.maxDateTime instanceof Date)
tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime());return tp_inst;},_addTimePicker:function(dp_inst){var currDT=(this.$altInput&&this._defaults.altFieldTimeOnly)?this.$input.val()+' '+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(currDT);this._limitMinMaxDateTime(dp_inst,false);this._injectTimePicker();},_parseTime:function(timeString,withDate){var regstr=this._defaults.timeFormat.toString().replace(/h{1,2}/ig,'(\\d?\\d)').replace(/m{1,2}/ig,'(\\d?\\d)').replace(/s{1,2}/ig,'(\\d?\\d)').replace(/l{1}/ig,'(\\d?\\d?\\d)').replace(/t{1,2}/ig,this._getPatternAmpm()).replace(/z{1}/ig,'(z|[-+]\\d\\d:?\\d\\d)?').replace(/\s/g,'\\s?')+this._defaults.timeSuffix+'$',order=this._getFormatPositions(),ampm='',treg;if(!this.inst)this.inst=$.datepicker._getInst(this.$input[0]);if(withDate||!this._defaults.timeOnly){var dp_dateFormat=$.datepicker._get(this.inst,'dateFormat');var specials=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");regstr='^.{'+dp_dateFormat.length+',}?'+this._defaults.separator.replace(specials,"\\$&")+regstr;}
treg=timeString.match(new RegExp(regstr,'i'));if(treg){if(order.t!==-1){if(treg[order.t]===undefined||treg[order.t].length===0){ampm='';this.ampm='';}else{ampm=$.inArray(treg[order.t].toUpperCase(),this.amNames)!==-1?'AM':'PM';this.ampm=this._defaults[ampm=='AM'?'amNames':'pmNames'][0];}}
if(order.h!==-1){if(ampm=='AM'&&treg[order.h]=='12')
this.hour=0;else if(ampm=='PM'&&treg[order.h]!='12')
this.hour=(parseFloat(treg[order.h])+12).toFixed(0);else this.hour=Number(treg[order.h]);}
if(order.m!==-1)this.minute=Number(treg[order.m]);if(order.s!==-1)this.second=Number(treg[order.s]);if(order.l!==-1)this.millisec=Number(treg[order.l]);if(order.z!==-1&&treg[order.z]!==undefined){var tz=treg[order.z].toUpperCase();switch(tz.length){case 1:tz=this._defaults.timezoneIso8609?'Z':'+0000';break;case 5:if(this._defaults.timezoneIso8609)
tz=tz.substring(1)=='0000'?'Z':tz.substring(0,3)+':'+tz.substring(3);break;case 6:if(!this._defaults.timezoneIso8609)
tz=tz=='Z'||tz.substring(1)=='00:00'?'+0000':tz.replace(/:/,'');else if(tz.substring(1)=='00:00')
tz='Z';break;}
this.timezone=tz;}
return true;}
return false;},_getPatternAmpm:function(){var markers=[];o=this._defaults;if(o.amNames)
$.merge(markers,o.amNames);if(o.pmNames)
$.merge(markers,o.pmNames);markers=$.map(markers,function(val){return val.replace(/[.*+?|()\[\]{}\\]/g,'\\$&')});return'('+markers.join('|')+')?';},_getFormatPositions:function(){var finds=this._defaults.timeFormat.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z)/g),orders={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(finds)
for(var i=0;i<finds.length;i++)
if(orders[finds[i].toString().charAt(0)]==-1)
orders[finds[i].toString().charAt(0)]=i+1;return orders;},_injectTimePicker:function(){var $dp=this.inst.dpDiv,o=this._defaults,tp_inst=this,hourMax=parseInt((o.hourMax-((o.hourMax-o.hourMin)%o.stepHour)),10),minMax=parseInt((o.minuteMax-((o.minuteMax-o.minuteMin)%o.stepMinute)),10),secMax=parseInt((o.secondMax-((o.secondMax-o.secondMin)%o.stepSecond)),10),millisecMax=parseInt((o.millisecMax-((o.millisecMax-o.millisecMin)%o.stepMillisec)),10),dp_id=this.inst.id.toString().replace(/([^A-Za-z0-9_])/g,'');if($dp.find("div#ui-timepicker-div-"+dp_id).length===0&&o.showTimepicker){var noDisplay=' style="display:none;"',html='<div class="ui-timepicker-div" id="ui-timepicker-div-'+dp_id+'"><dl>'+'<dt class="ui_tpicker_time_label" id="ui_tpicker_time_label_'+dp_id+'"'+
((o.showTime)?'':noDisplay)+'>'+o.timeText+'</dt>'+'<dd class="ui_tpicker_time" id="ui_tpicker_time_'+dp_id+'"'+
((o.showTime)?'':noDisplay)+'></dd>'+'<dt class="ui_tpicker_hour_label" id="ui_tpicker_hour_label_'+dp_id+'"'+
((o.showHour)?'':noDisplay)+'>'+o.hourText+'</dt>',hourGridSize=0,minuteGridSize=0,secondGridSize=0,millisecGridSize=0,size;html+='<dd class="ui_tpicker_hour"><div id="ui_tpicker_hour_'+dp_id+'"'+
((o.showHour)?'':noDisplay)+'></div>';if(o.showHour&&o.hourGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var h=o.hourMin;h<=hourMax;h+=parseInt(o.hourGrid,10)){hourGridSize++;var tmph=(o.ampm&&h>12)?h-12:h;if(tmph<10)tmph='0'+tmph;if(o.ampm){if(h==0)tmph=12+'a';else if(h<12)tmph+='a';else tmph+='p';}
html+='<td>'+tmph+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_minute_label" id="ui_tpicker_minute_label_'+dp_id+'"'+
((o.showMinute)?'':noDisplay)+'>'+o.minuteText+'</dt>'+'<dd class="ui_tpicker_minute"><div id="ui_tpicker_minute_'+dp_id+'"'+
((o.showMinute)?'':noDisplay)+'></div>';if(o.showMinute&&o.minuteGrid>0){html+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>';for(var m=o.minuteMin;m<=minMax;m+=parseInt(o.minuteGrid,10)){minuteGridSize++;html+='<td>'+((m<10)?'0':'')+m+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_second_label" id="ui_tpicker_second_label_'+dp_id+'"'+
((o.showSecond)?'':noDisplay)+'>'+o.secondText+'</dt>'+'<dd class="ui_tpicker_second"><div id="ui_tpicker_second_'+dp_id+'"'+
((o.showSecond)?'':noDisplay)+'></div>';if(o.showSecond&&o.secondGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var s=o.secondMin;s<=secMax;s+=parseInt(o.secondGrid,10)){secondGridSize++;html+='<td>'+((s<10)?'0':'')+s+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_millisec_label" id="ui_tpicker_millisec_label_'+dp_id+'"'+
((o.showMillisec)?'':noDisplay)+'>'+o.millisecText+'</dt>'+'<dd class="ui_tpicker_millisec"><div id="ui_tpicker_millisec_'+dp_id+'"'+
((o.showMillisec)?'':noDisplay)+'></div>';if(o.showMillisec&&o.millisecGrid>0){html+='<div style="padding-left: 1px"><table><tr>';for(var l=o.millisecMin;l<=millisecMax;l+=parseInt(o.millisecGrid,10)){millisecGridSize++;html+='<td>'+((l<10)?'0':'')+l+'</td>';}
html+='</tr></table></div>';}
html+='</dd>';html+='<dt class="ui_tpicker_timezone_label" id="ui_tpicker_timezone_label_'+dp_id+'"'+
((o.showTimezone)?'':noDisplay)+'>'+o.timezoneText+'</dt>';html+='<dd class="ui_tpicker_timezone" id="ui_tpicker_timezone_'+dp_id+'"'+
((o.showTimezone)?'':noDisplay)+'></dd>';html+='</dl></div>';$tp=$(html);if(o.timeOnly===true){$tp.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all">'+'<div class="ui-datepicker-title">'+o.timeOnlyTitle+'</div>'+'</div>');$dp.find('.ui-datepicker-header, .ui-datepicker-calendar').hide();}
this.hour_slider=$tp.find('#ui_tpicker_hour_'+dp_id).slider({orientation:"horizontal",value:this.hour,min:o.hourMin,max:hourMax,step:o.stepHour,slide:function(event,ui){tp_inst.hour_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.minute_slider=$tp.find('#ui_tpicker_minute_'+dp_id).slider({orientation:"horizontal",value:this.minute,min:o.minuteMin,max:minMax,step:o.stepMinute,slide:function(event,ui){tp_inst.minute_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.second_slider=$tp.find('#ui_tpicker_second_'+dp_id).slider({orientation:"horizontal",value:this.second,min:o.secondMin,max:secMax,step:o.stepSecond,slide:function(event,ui){tp_inst.second_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.millisec_slider=$tp.find('#ui_tpicker_millisec_'+dp_id).slider({orientation:"horizontal",value:this.millisec,min:o.millisecMin,max:millisecMax,step:o.stepMillisec,slide:function(event,ui){tp_inst.millisec_slider.slider("option","value",ui.value);tp_inst._onTimeChange();}});this.timezone_select=$tp.find('#ui_tpicker_timezone_'+dp_id).append('<select></select>').find("select");$.fn.append.apply(this.timezone_select,$.map(o.timezoneList,function(val,idx){return $("<option />").val(typeof val=="object"?val.value:val).text(typeof val=="object"?val.label:val);}));this.timezone_select.val((typeof this.timezone!="undefined"&&this.timezone!=null&&this.timezone!="")?this.timezone:o.timezone);this.timezone_select.change(function(){tp_inst._onTimeChange();});if(o.showHour&&o.hourGrid>0){size=100*hourGridSize*o.hourGrid/(hourMax-o.hourMin);$tp.find(".ui_tpicker_hour table").css({width:size+"%",marginLeft:(size/(-2*hourGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){var h=$(this).html();if(o.ampm){var ap=h.substring(2).toLowerCase(),aph=parseInt(h.substring(0,2),10);if(ap=='a'){if(aph==12)h=0;else h=aph;}else if(aph==12)h=12;else h=aph+12;}
tp_inst.hour_slider.slider("option","value",h);tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/hourGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showMinute&&o.minuteGrid>0){size=100*minuteGridSize*o.minuteGrid/(minMax-o.minuteMin);$tp.find(".ui_tpicker_minute table").css({width:size+"%",marginLeft:(size/(-2*minuteGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.minute_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/minuteGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showSecond&&o.secondGrid>0){$tp.find(".ui_tpicker_second table").css({width:size+"%",marginLeft:(size/(-2*secondGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.second_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/secondGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
if(o.showMillisec&&o.millisecGrid>0){$tp.find(".ui_tpicker_millisec table").css({width:size+"%",marginLeft:(size/(-2*millisecGridSize))+"%",borderCollapse:'collapse'}).find("td").each(function(index){$(this).click(function(){tp_inst.millisec_slider.slider("option","value",$(this).html());tp_inst._onTimeChange();tp_inst._onSelectHandler();}).css({cursor:'pointer',width:(100/millisecGridSize)+'%',textAlign:'center',overflow:'hidden'});});}
var $buttonPanel=$dp.find('.ui-datepicker-buttonpane');if($buttonPanel.length)$buttonPanel.before($tp);else $dp.append($tp);this.$timeObj=$tp.find('#ui_tpicker_time_'+dp_id);if(this.inst!==null){var timeDefined=this.timeDefined;this._onTimeChange();this.timeDefined=timeDefined;}
var onSelectDelegate=function(){tp_inst._onSelectHandler();};this.hour_slider.bind('slidestop',onSelectDelegate);this.minute_slider.bind('slidestop',onSelectDelegate);this.second_slider.bind('slidestop',onSelectDelegate);this.millisec_slider.bind('slidestop',onSelectDelegate);if(this._defaults.addSliderAccess){var sliderAccessArgs=this._defaults.sliderAccessArgs;setTimeout(function(){if($tp.find('.ui-slider-access').length==0){$tp.find('.ui-slider:visible').sliderAccess(sliderAccessArgs);var sliderAccessWidth=$tp.find('.ui-slider-access:eq(0)').outerWidth(true);if(sliderAccessWidth){$tp.find('table:visible').each(function(){var $g=$(this),oldWidth=$g.outerWidth(),oldMarginLeft=$g.css('marginLeft').toString().replace('%',''),newWidth=oldWidth-sliderAccessWidth,newMarginLeft=((oldMarginLeft*newWidth)/oldWidth)+'%';$g.css({width:newWidth,marginLeft:newMarginLeft});});}}},0);}}},_limitMinMaxDateTime:function(dp_inst,adjustSliders){var o=this._defaults,dp_date=new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay);if(!this._defaults.showTimepicker)return;if($.datepicker._get(dp_inst,'minDateTime')!==null&&$.datepicker._get(dp_inst,'minDateTime')!==undefined&&dp_date){var minDateTime=$.datepicker._get(dp_inst,'minDateTime'),minDateTimeDate=new Date(minDateTime.getFullYear(),minDateTime.getMonth(),minDateTime.getDate(),0,0,0,0);if(this.hourMinOriginal===null||this.minuteMinOriginal===null||this.secondMinOriginal===null||this.millisecMinOriginal===null){this.hourMinOriginal=o.hourMin;this.minuteMinOriginal=o.minuteMin;this.secondMinOriginal=o.secondMin;this.millisecMinOriginal=o.millisecMin;}
if(dp_inst.settings.timeOnly||minDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMin=minDateTime.getHours();if(this.hour<=this._defaults.hourMin){this.hour=this._defaults.hourMin;this._defaults.minuteMin=minDateTime.getMinutes();if(this.minute<=this._defaults.minuteMin){this.minute=this._defaults.minuteMin;this._defaults.secondMin=minDateTime.getSeconds();}else if(this.second<=this._defaults.secondMin){this.second=this._defaults.secondMin;this._defaults.millisecMin=minDateTime.getMilliseconds();}else{if(this.millisec<this._defaults.millisecMin)
this.millisec=this._defaults.millisecMin;this._defaults.millisecMin=this.millisecMinOriginal;}}else{this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal;}}else{this._defaults.hourMin=this.hourMinOriginal;this._defaults.minuteMin=this.minuteMinOriginal;this._defaults.secondMin=this.secondMinOriginal;this._defaults.millisecMin=this.millisecMinOriginal;}}
if($.datepicker._get(dp_inst,'maxDateTime')!==null&&$.datepicker._get(dp_inst,'maxDateTime')!==undefined&&dp_date){var maxDateTime=$.datepicker._get(dp_inst,'maxDateTime'),maxDateTimeDate=new Date(maxDateTime.getFullYear(),maxDateTime.getMonth(),maxDateTime.getDate(),0,0,0,0);if(this.hourMaxOriginal===null||this.minuteMaxOriginal===null||this.secondMaxOriginal===null){this.hourMaxOriginal=o.hourMax;this.minuteMaxOriginal=o.minuteMax;this.secondMaxOriginal=o.secondMax;this.millisecMaxOriginal=o.millisecMax;}
if(dp_inst.settings.timeOnly||maxDateTimeDate.getTime()==dp_date.getTime()){this._defaults.hourMax=maxDateTime.getHours();if(this.hour>=this._defaults.hourMax){this.hour=this._defaults.hourMax;this._defaults.minuteMax=maxDateTime.getMinutes();if(this.minute>=this._defaults.minuteMax){this.minute=this._defaults.minuteMax;this._defaults.secondMax=maxDateTime.getSeconds();}else if(this.second>=this._defaults.secondMax){this.second=this._defaults.secondMax;this._defaults.millisecMax=maxDateTime.getMilliseconds();}else{if(this.millisec>this._defaults.millisecMax)this.millisec=this._defaults.millisecMax;this._defaults.millisecMax=this.millisecMaxOriginal;}}else{this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal;}}else{this._defaults.hourMax=this.hourMaxOriginal;this._defaults.minuteMax=this.minuteMaxOriginal;this._defaults.secondMax=this.secondMaxOriginal;this._defaults.millisecMax=this.millisecMaxOriginal;}}
if(adjustSliders!==undefined&&adjustSliders===true){var hourMax=parseInt((this._defaults.hourMax-((this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour)),10),minMax=parseInt((this._defaults.minuteMax-((this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute)),10),secMax=parseInt((this._defaults.secondMax-((this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond)),10),millisecMax=parseInt((this._defaults.millisecMax-((this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec)),10);if(this.hour_slider)
this.hour_slider.slider("option",{min:this._defaults.hourMin,max:hourMax}).slider('value',this.hour);if(this.minute_slider)
this.minute_slider.slider("option",{min:this._defaults.minuteMin,max:minMax}).slider('value',this.minute);if(this.second_slider)
this.second_slider.slider("option",{min:this._defaults.secondMin,max:secMax}).slider('value',this.second);if(this.millisec_slider)
this.millisec_slider.slider("option",{min:this._defaults.millisecMin,max:millisecMax}).slider('value',this.millisec);}},_onTimeChange:function(){var hour=(this.hour_slider)?this.hour_slider.slider('value'):false,minute=(this.minute_slider)?this.minute_slider.slider('value'):false,second=(this.second_slider)?this.second_slider.slider('value'):false,millisec=(this.millisec_slider)?this.millisec_slider.slider('value'):false,timezone=(this.timezone_select)?this.timezone_select.val():false,o=this._defaults;if(typeof(hour)=='object')hour=false;if(typeof(minute)=='object')minute=false;if(typeof(second)=='object')second=false;if(typeof(millisec)=='object')millisec=false;if(typeof(timezone)=='object')timezone=false;if(hour!==false)hour=parseInt(hour,10);if(minute!==false)minute=parseInt(minute,10);if(second!==false)second=parseInt(second,10);if(millisec!==false)millisec=parseInt(millisec,10);var ampm=o[hour<12?'amNames':'pmNames'][0];var hasChanged=(hour!=this.hour||minute!=this.minute||second!=this.second||millisec!=this.millisec||(this.ampm.length>0&&(hour<12)!=($.inArray(this.ampm.toUpperCase(),this.amNames)!==-1))||timezone!=this.timezone);if(hasChanged){if(hour!==false)this.hour=hour;if(minute!==false)this.minute=minute;if(second!==false)this.second=second;if(millisec!==false)this.millisec=millisec;if(timezone!==false)this.timezone=timezone;if(!this.inst)this.inst=$.datepicker._getInst(this.$input[0]);this._limitMinMaxDateTime(this.inst,true);}
if(o.ampm)this.ampm=ampm;this.formattedTime=$.datepicker.formatTime(this._defaults.timeFormat,this,this._defaults);if(this.$timeObj)this.$timeObj.text(this.formattedTime+o.timeSuffix);this.timeDefined=true;if(hasChanged)this._updateDateTime();},_onSelectHandler:function(){var onSelect=this._defaults.onSelect;var inputEl=this.$input?this.$input[0]:null;if(onSelect&&inputEl){onSelect.apply(inputEl,[this.formattedDateTime,this]);}},_formatTime:function(time,format){time=time||{hour:this.hour,minute:this.minute,second:this.second,millisec:this.millisec,ampm:this.ampm,timezone:this.timezone};var tmptime=(format||this._defaults.timeFormat).toString();tmptime=$.datepicker.formatTime(tmptime,time,this._defaults);if(arguments.length)return tmptime;else this.formattedTime=tmptime;},_updateDateTime:function(dp_inst){dp_inst=this.inst||dp_inst;var dt=$.datepicker._daylightSavingAdjust(new Date(dp_inst.selectedYear,dp_inst.selectedMonth,dp_inst.selectedDay)),dateFmt=$.datepicker._get(dp_inst,'dateFormat'),formatCfg=$.datepicker._getFormatConfig(dp_inst),timeAvailable=dt!==null&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(dateFmt,(dt===null?new Date():dt),formatCfg);var formattedDateTime=this.formattedDate;if(dp_inst.lastVal!==undefined&&(dp_inst.lastVal.length>0&&this.$input.val().length===0))
return;if(this._defaults.timeOnly===true){formattedDateTime=this.formattedTime;}else if(this._defaults.timeOnly!==true&&(this._defaults.alwaysSetTime||timeAvailable)){formattedDateTime+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix;}
this.formattedDateTime=formattedDateTime;if(!this._defaults.showTimepicker){this.$input.val(this.formattedDate);}else if(this.$altInput&&this._defaults.altFieldTimeOnly===true){this.$altInput.val(this.formattedTime);this.$input.val(this.formattedDate);}else if(this.$altInput){this.$altInput.val(formattedDateTime);this.$input.val(formattedDateTime);}else{this.$input.val(formattedDateTime);}
this.$input.trigger("change");}});$.fn.extend({timepicker:function(o){o=o||{};var tmp_args=arguments;if(typeof o=='object')tmp_args[0]=$.extend(o,{timeOnly:true});return $(this).each(function(){$.fn.datetimepicker.apply($(this),tmp_args);});},datetimepicker:function(o){o=o||{};var $input=this,tmp_args=arguments;if(typeof(o)=='string'){if(o=='getDate'||o=='widget')
return $.fn.datepicker.apply($(this[0]),tmp_args);else
return this.each(function(){var $t=$(this);$t.datepicker.apply($t,tmp_args);});}
else
return this.each(function(){var $t=$(this);$t.datepicker($.timepicker._newInst($t,o)._defaults);});}});$.datepicker.formatTime=function(format,time,options){options=options||{};options=$.extend($.timepicker._defaults,options);time=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:'+0000'},time);var tmptime=format;var ampmName=options['amNames'][0];var hour=parseInt(time.hour,10);if(options.ampm){if(hour>11){ampmName=options['pmNames'][0];if(hour>12)
hour=hour%12;}
if(hour===0)
hour=12;}
tmptime=tmptime.replace(/(?:hh?|mm?|ss?|[tT]{1,2}|[lz])/g,function(match){switch(match.toLowerCase()){case'hh':return('0'+hour).slice(-2);case'h':return hour;case'mm':return('0'+time.minute).slice(-2);case'm':return time.minute;case'ss':return('0'+time.second).slice(-2);case's':return time.second;case'l':return('00'+time.millisec).slice(-3);case'z':return time.timezone;case't':case'tt':if(options.ampm){if(match.length==1)
ampmName=ampmName.charAt(0);return match.charAt(0)=='T'?ampmName.toUpperCase():ampmName.toLowerCase();}
return'';}});tmptime=$.trim(tmptime);return tmptime;}
$.datepicker._base_selectDate=$.datepicker._selectDate;$.datepicker._selectDate=function(id,dateStr){var inst=this._getInst($(id)[0]),tp_inst=this._get(inst,'timepicker');if(tp_inst){tp_inst._limitMinMaxDateTime(inst,true);inst.inline=inst.stay_open=true;this._base_selectDate(id,dateStr);inst.inline=inst.stay_open=false;this._notifyChange(inst);this._updateDatepicker(inst);}
else this._base_selectDate(id,dateStr);};$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker;$.datepicker._updateDatepicker=function(inst){var input=inst.input[0];if($.datepicker._curInst&&$.datepicker._curInst!=inst&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=input){return;}
if(typeof(inst.stay_open)!=='boolean'||inst.stay_open===false){this._base_updateDatepicker(inst);var tp_inst=this._get(inst,'timepicker');if(tp_inst)tp_inst._addTimePicker(inst);}};$.datepicker._base_doKeyPress=$.datepicker._doKeyPress;$.datepicker._doKeyPress=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,'timepicker');if(tp_inst){if($.datepicker._get(inst,'constrainInput')){var ampm=tp_inst._defaults.ampm,dateChars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat')),datetimeChars=tp_inst._defaults.timeFormat.toString().replace(/[hms]/g,'').replace(/TT/g,ampm?'APM':'').replace(/Tt/g,ampm?'AaPpMm':'').replace(/tT/g,ampm?'AaPpMm':'').replace(/T/g,ampm?'AP':'').replace(/tt/g,ampm?'apm':'').replace(/t/g,ampm?'ap':'')+" "+
tp_inst._defaults.separator+
tp_inst._defaults.timeSuffix+
(tp_inst._defaults.showTimezone?tp_inst._defaults.timezoneList.join(''):'')+
(tp_inst._defaults.amNames.join(''))+
(tp_inst._defaults.pmNames.join(''))+
dateChars,chr=String.fromCharCode(event.charCode===undefined?event.keyCode:event.charCode);return event.ctrlKey||(chr<' '||!dateChars||datetimeChars.indexOf(chr)>-1);}}
return $.datepicker._base_doKeyPress(event);};$.datepicker._base_doKeyUp=$.datepicker._doKeyUp;$.datepicker._doKeyUp=function(event){var inst=$.datepicker._getInst(event.target),tp_inst=$.datepicker._get(inst,'timepicker');if(tp_inst){if(tp_inst._defaults.timeOnly&&(inst.input.val()!=inst.lastVal)){try{$.datepicker._updateDatepicker(inst);}
catch(err){$.datepicker.log(err);}}}
return $.datepicker._base_doKeyUp(event);};$.datepicker._base_gotoToday=$.datepicker._gotoToday;$.datepicker._gotoToday=function(id){var inst=this._getInst($(id)[0]),$dp=inst.dpDiv;this._base_gotoToday(id);var now=new Date();var tp_inst=this._get(inst,'timepicker');if(tp_inst&&tp_inst._defaults.showTimezone&&tp_inst.timezone_select){var tzoffset=now.getTimezoneOffset();var tzsign=tzoffset>0?'-':'+';tzoffset=Math.abs(tzoffset);var tzmin=tzoffset%60;tzoffset=tzsign+('0'+(tzoffset-tzmin)/60).slice(-2)+('0'+tzmin).slice(-2);if(tp_inst._defaults.timezoneIso8609)
tzoffset=tzoffset.substring(0,3)+':'+tzoffset.substring(3);tp_inst.timezone_select.val(tzoffset);}
this._setTime(inst,now);$('.ui-datepicker-today',$dp).click();};$.datepicker._disableTimepickerDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');$(target).datepicker('getDate');if(tp_inst){tp_inst._defaults.showTimepicker=false;tp_inst._updateDateTime(inst);}};$.datepicker._enableTimepickerDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');$(target).datepicker('getDate');if(tp_inst){tp_inst._defaults.showTimepicker=true;tp_inst._addTimePicker(inst);tp_inst._updateDateTime(inst);}};$.datepicker._setTime=function(inst,date){var tp_inst=this._get(inst,'timepicker');if(tp_inst){var defaults=tp_inst._defaults,hour=date?date.getHours():defaults.hour,minute=date?date.getMinutes():defaults.minute,second=date?date.getSeconds():defaults.second,millisec=date?date.getMilliseconds():defaults.millisec;if((hour<defaults.hourMin||hour>defaults.hourMax)||(minute<defaults.minuteMin||minute>defaults.minuteMax)||(second<defaults.secondMin||second>defaults.secondMax)||(millisec<defaults.millisecMin||millisec>defaults.millisecMax)){hour=defaults.hourMin;minute=defaults.minuteMin;second=defaults.secondMin;millisec=defaults.millisecMin;}
tp_inst.hour=hour;tp_inst.minute=minute;tp_inst.second=second;tp_inst.millisec=millisec;if(tp_inst.hour_slider)tp_inst.hour_slider.slider('value',hour);if(tp_inst.minute_slider)tp_inst.minute_slider.slider('value',minute);if(tp_inst.second_slider)tp_inst.second_slider.slider('value',second);if(tp_inst.millisec_slider)tp_inst.millisec_slider.slider('value',millisec);tp_inst._onTimeChange();tp_inst._updateDateTime(inst);}};$.datepicker._setTimeDatepicker=function(target,date,withDate){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');if(tp_inst){this._setDateFromField(inst);var tp_date;if(date){if(typeof date=="string"){tp_inst._parseTime(date,withDate);tp_date=new Date();tp_date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec);}
else tp_date=new Date(date.getTime());if(tp_date.toString()=='Invalid Date')tp_date=undefined;this._setTime(inst,tp_date);}}};$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker;$.datepicker._setDateDatepicker=function(target,date){var inst=this._getInst(target),tp_date=(date instanceof Date)?new Date(date.getTime()):date;this._updateDatepicker(inst);this._base_setDateDatepicker.apply(this,arguments);this._setTimeDatepicker(target,tp_date,true);};$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker;$.datepicker._getDateDatepicker=function(target,noDefault){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');if(tp_inst){this._setDateFromField(inst,noDefault);var date=this._getDate(inst);if(date&&tp_inst._parseTime($(target).val(),tp_inst.timeOnly))date.setHours(tp_inst.hour,tp_inst.minute,tp_inst.second,tp_inst.millisec);return date;}
return this._base_getDateDatepicker(target,noDefault);};$.datepicker._base_parseDate=$.datepicker.parseDate;$.datepicker.parseDate=function(format,value,settings){var date;try{date=this._base_parseDate(format,value,settings);}catch(err){if(err.indexOf(":")>=0){date=this._base_parseDate(format,value.substring(0,value.length-(err.length-err.indexOf(':')-2)),settings);}else{throw err;}}
return date;};$.datepicker._base_formatDate=$.datepicker._formatDate;$.datepicker._formatDate=function(inst,day,month,year){var tp_inst=this._get(inst,'timepicker');if(tp_inst)
{if(day)
var b=this._base_formatDate(inst,day,month,year);tp_inst._updateDateTime(inst);return tp_inst.$input.val();}
return this._base_formatDate(inst);};$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker;$.datepicker._optionDatepicker=function(target,name,value){var inst=this._getInst(target),tp_inst=this._get(inst,'timepicker');if(tp_inst){var min,max,onselect;if(typeof name=='string'){if(name==='minDate'||name==='minDateTime')
min=value;else if(name==='maxDate'||name==='maxDateTime')
max=value;else if(name==='onSelect')
onselect=value;}else if(typeof name=='object'){if(name.minDate)
min=name.minDate;else if(name.minDateTime)
min=name.minDateTime;else if(name.maxDate)
max=name.maxDate;else if(name.maxDateTime)
max=name.maxDateTime;}
if(min){if(min==0)
min=new Date();else
min=new Date(min);tp_inst._defaults.minDate=min;tp_inst._defaults.minDateTime=min;}else if(max){if(max==0)
max=new Date();else
max=new Date(max);tp_inst._defaults.maxDate=max;tp_inst._defaults.maxDateTime=max;}
else if(onselect)
tp_inst._defaults.onSelect=onselect;}
if(value===undefined)
return this._base_optionDatepicker(target,name);return this._base_optionDatepicker(target,name,value);};function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]===null||props[name]===undefined)
target[name]=props[name];return target;};$.timepicker=new Timepicker();$.timepicker.version="0.9.9";})(jQuery);;(function($){$.widget("ech.notify",{options:{speed:500,expires:5000,stack:'below',custom:false},_create:function(){var self=this;this.templates={};this.keys=[];this.element.addClass("ui-notify").children().addClass("ui-notify-message ui-notify-message-style").each(function(i){var key=this.id||i;self.keys.push(key);self.templates[key]=$(this).removeAttr("id").wrap("<div></div>").parent().html();}).end().empty().show();},create:function(template,msg,opts){if(typeof template==="object"){opts=msg;msg=template;template=null;}
var tpl=this.templates[template||this.keys[0]];if(opts&&opts.custom){tpl=$(tpl).removeClass("ui-notify-message-style").wrap("<div></div>").parent().html();}
return new $.ech.notify.instance(this)._create(msg,$.extend({},this.options,opts),tpl);}});$.extend($.ech.notify,{instance:function(widget){this.parent=widget;this.isOpen=false;}});$.extend($.ech.notify.instance.prototype,{_create:function(params,options,template){this.options=options;var self=this,html=template.replace(/#(?:\{|%7B)(.*?)(?:\}|%7D)/g,function($1,$2){return($2 in params)?params[$2]:'';}),m=(this.element=$(html)),closelink=m.find(".ui-notify-close");if(typeof this.options.click==="function"){m.addClass("ui-notify-click").bind("click",function(e){self._trigger("click",e,self);});}
if(closelink.length){closelink.bind("click",function(){self.close();return false;});}
this.open();if(typeof options.expires==="number"){window.setTimeout(function(){self.close();},options.expires);}
return this;},close:function(){var self=this,speed=this.options.speed;this.element.fadeTo(speed,0).slideUp(speed,function(){self._trigger("close");self.isOpen=false;});return this;},open:function(){if(this.isOpen||this._trigger("beforeopen")===false){return this;}
var self=this;this.element[this.options.stack==='above'?'prependTo':'appendTo'](this.parent.element).css({display:"none",opacity:""}).fadeIn(this.options.speed,function(){self._trigger("open");self.isOpen=true;});return this;},widget:function(){return this.element;},_trigger:function(type,e,instance){return this.parent._trigger.call(this,type,e,instance);}});})(jQuery);;;(function(d){var k=d.scrollTo=function(a,i,e){d(window).scrollTo(a,i,e)};k.defaults={axis:'xy',duration:parseFloat(d.fn.jquery)>=1.3?0:1};k.window=function(a){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var a=this,i=!a.nodeName||d.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!i)return a;var e=(a.contentWindow||a).document||a.ownerDocument||a;return d.browser.safari||e.compatMode=='BackCompat'?e.body:e.documentElement})};d.fn.scrollTo=function(n,j,b){if(typeof j=='object'){b=j;j=0}if(typeof b=='function')b={onAfter:b};if(n=='max')n=9e9;b=d.extend({},k.defaults,b);j=j||b.speed||b.duration;b.queue=b.queue&&b.axis.length>1;if(b.queue)j/=2;b.offset=p(b.offset);b.over=p(b.over);return this._scrollable().each(function(){var q=this,r=d(q),f=n,s,g={},u=r.is('html,body');switch(typeof f){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(f)){f=p(f);break}f=d(f,this);case'object':if(f.is||f.style)s=(f=d(f)).offset()}d.each(b.axis.split(''),function(a,i){var e=i=='x'?'Left':'Top',h=e.toLowerCase(),c='scroll'+e,l=q[c],m=k.max(q,i);if(s){g[c]=s[h]+(u?0:l-r.offset()[h]);if(b.margin){g[c]-=parseInt(f.css('margin'+e))||0;g[c]-=parseInt(f.css('border'+e+'Width'))||0}g[c]+=b.offset[h]||0;if(b.over[h])g[c]+=f[i=='x'?'width':'height']()*b.over[h]}else{var o=f[h];g[c]=o.slice&&o.slice(-1)=='%'?parseFloat(o)/100*m:o}if(/^\d+$/.test(g[c]))g[c]=g[c]<=0?0:Math.min(g[c],m);if(!a&&b.queue){if(l!=g[c])t(b.onAfterFirst);delete g[c]}});t(b.onAfter);function t(a){r.animate(g,j,b.easing,a&&function(){a.call(this,n,b)})}}).end()};k.max=function(a,i){var e=i=='x'?'Width':'Height',h='scroll'+e;if(!d(a).is('html,body'))return a[h]-d(a)[e.toLowerCase()]();var c='client'+e,l=a.ownerDocument.documentElement,m=a.ownerDocument.body;return Math.max(l[h],m[h])-Math.min(l[c],m[c])};function p(a){return typeof a=='object'?a:{top:a,left:a}}})(jQuery);;(function($){function maybeCall(thing,ctx){return(typeof thing=='function')?(thing.call(ctx)):thing;};function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;this.fixTitle();};Tipsy.prototype={show:function(){$.fn.tipsy.clear();if(!this.$element.parent().length){return;}
var title=this.getTitle();if(title&&this.enabled){var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy ';$tip.openerpClass('oe_tooltip');$tip.remove().css({top:0,left:0,visibility:'hidden',display:'block'}).prependTo(document.body);var pos=$.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight,gravity=maybeCall(this.options.gravity,this.$element[0]);var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-this.options.offset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-this.options.offset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+this.options.offset};break;}
if(gravity.length==2){if(gravity.charAt(1)=='w'){tp.left=pos.left+pos.width/2-15;}else{tp.left=pos.left+pos.width/2-actualWidth+15;}}
$tip.css(tp).addClass('tipsy-'+gravity);$tip.find('.tipsy-arrow')[0].className='tipsy-arrow tipsy-arrow-'+gravity.charAt(0);if(this.options.className){$tip.addClass(maybeCall(this.options.className,this.$element[0]));}
if(this.options.fade){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else{this.tip().remove();}},fixTitle:function(){var $e=this.$element;if($e.attr('title')||typeof($e.attr('original-title'))!='string'){$e.attr('original-title',$e.attr('title')||'').removeAttr('title');}},getTitle:function(){var title,$e=this.$element,o=this.options;this.fixTitle();var title,o=this.options;if(typeof o.title=='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title=='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');}
return this.$tip;},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options){if(options===true){return this.data('tipsy');}else if(typeof options=='string'){var tipsy=this.data('tipsy');if(tipsy)tipsy[options]();return this;}
options=$.extend({},$.fn.tipsy.defaults,options);function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){var tipsy=get(this);tipsy.hoverState='in';if(options.delayIn==0){tipsy.show();}else{tipsy.fixTitle();setTimeout(function(){if(tipsy.hoverState=='in')tipsy.show();},options.delayIn);}};function leave(){var tipsy=get(this);tipsy.hoverState='out';if(options.delayOut==0){tipsy.hide();}else{setTimeout(function(){if(tipsy.hoverState=='out')tipsy.hide();},options.delayOut);}};if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.clear=function(){$('div.tipsy').stop().remove();}
$.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:0.8,title:'title',trigger:'hover'};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};$.fn.tipsy.autoBounds=function(margin,prefer){return function(){var dir={ns:prefer[0],ew:(prefer.length>1?prefer[1]:false)},boundTop=$(document).scrollTop()+margin,boundLeft=$(document).scrollLeft()+margin,$this=$(this);if($this.offset().top<boundTop)dir.ns='n';if($this.offset().left<boundLeft)dir.ew='w';if($(window).width()+$(document).scrollLeft()-$this.offset().left<margin)dir.ew='e';if($(window).height()+$(document).scrollTop()-$this.offset().top<margin)dir.ns='s';return dir.ns+(dir.ew?dir.ew:'');}};})(jQuery);;;(function($,undefined)
{function TextExt(){};function ItemManager(){};function TextExtPlugin(){};var stringify=(JSON||{}).stringify,slice=Array.prototype.slice,UNDEFINED='undefined',OPT_ITEM_MANAGER='item.manager',OPT_PLUGINS='plugins',OPT_EXT='ext',OPT_HTML_WRAP='html.wrap',OPT_HTML_HIDDEN='html.hidden',OPT_KEYS='keys',EVENT_PRE_INVALIDATE='preInvalidate',EVENT_POST_INVALIDATE='postInvalidate',EVENT_GET_FORM_DATA='getFormData',EVENT_SET_FORM_DATA='setFormData',EVENT_SET_INPUT_DATA='setInputData',EVENT_POST_INIT='postInit',EVENT_READY='ready',DEFAULT_OPTS={itemManager:ItemManager,plugins:[],ext:{},html:{wrap:'<div class="text-core"><div class="text-wrap"/></div>',hidden:'<input type="hidden" />'},keys:{8:'backspace',9:'tab',13:'enter!',27:'escape!',37:'left',38:'up!',39:'right',40:'down!',46:'delete',108:'numpadEnter'}};if(!stringify)
throw new Error('JSON.stringify() not found');function getProperty(source,name)
{if(typeof(name)==='string')
name=name.split('.');var fullCamelCaseName=name.join('.').replace(/\.(\w)/g,function(match,letter){return letter.toUpperCase()}),nestedName=name.shift(),result;if(typeof(result=source[fullCamelCaseName])!=UNDEFINED)
result=result;else if(typeof(result=source[nestedName])!=UNDEFINED&&name.length>0)
result=getProperty(result,name);return result;};function hookupEvents()
{var args=slice.apply(arguments),self=this,target=args.length===1?self:args.shift(),event;args=args[0]||{};function bind(event,handler)
{target.bind(event,function()
{return handler.apply(self,arguments);});}
for(event in args)
bind(event,args[event]);};function formDataObject(input,form)
{return{'input':input,'form':form};};p=ItemManager.prototype;p.init=function(core)
{};p.filter=function(list,query)
{var result=[],i,item;for(i=0;i<list.length;i++)
{item=list[i];if(this.itemContains(item,query))
result.push(item);}
return result;};p.itemContains=function(item,needle)
{return this.itemToString(item).toLowerCase().indexOf(needle.toLowerCase())==0;};p.stringToItem=function(str)
{return str;};p.itemToString=function(item)
{return item;};p.compareItems=function(item1,item2)
{return item1==item2;};p=TextExt.prototype;p.init=function(input,opts)
{var self=this,hiddenInput,itemManager,container;self._defaults=$.extend({},DEFAULT_OPTS);self._opts=opts||{};self._plugins={};self._itemManager=itemManager=new(self.opts(OPT_ITEM_MANAGER))();input=$(input);container=$(self.opts(OPT_HTML_WRAP));hiddenInput=$(self.opts(OPT_HTML_HIDDEN));input.wrap(container).keydown(function(e){return self.onKeyDown(e)}).keyup(function(e){return self.onKeyUp(e)}).data('textext',self);$(self).data({'hiddenInput':hiddenInput,'wrapElement':input.parents('.text-wrap').first(),'input':input});hiddenInput.attr('name',input.attr('name'));input.attr('name',null);hiddenInput.insertAfter(input);$.extend(true,itemManager,self.opts(OPT_EXT+'.item.manager'));$.extend(true,self,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.core'));self.originalWidth=input.outerWidth();self.invalidateBounds();itemManager.init(self);self.initPatches();self.initPlugins(self.opts(OPT_PLUGINS),$.fn.textext.plugins);self.on({setFormData:self.onSetFormData,getFormData:self.onGetFormData,setInputData:self.onSetInputData,anyKeyUp:self.onAnyKeyUp});self.trigger(EVENT_POST_INIT);self.trigger(EVENT_READY);self.getFormData(0);};p.initPatches=function()
{var list=[],source=$.fn.textext.patches,name;for(name in source)
list.push(name);this.initPlugins(list,source);};p.initPlugins=function(plugins,source)
{var self=this,ext,name,plugin,initList=[],i;if(typeof(plugins)=='string')
plugins=plugins.split(/\s*,\s*|\s+/g);for(i=0;i<plugins.length;i++)
{name=plugins[i];plugin=source[name];if(plugin)
{self._plugins[name]=plugin=new plugin();self[name]=(function(plugin){return function(){return plugin;}})(plugin);initList.push(plugin);$.extend(true,plugin,self.opts(OPT_EXT+'.*'),self.opts(OPT_EXT+'.'+name));}}
initList.sort(function(p1,p2)
{p1=p1.initPriority();p2=p2.initPriority();return p1===p2?0:p1<p2?1:-1;});for(i=0;i<initList.length;i++)
initList[i].init(self);};p.hasPlugin=function(name)
{return!!this._plugins[name];};p.on=hookupEvents;p.bind=function(event,handler)
{this.input().bind(event,handler);};p.trigger=function()
{var args=arguments;this.input().trigger(args[0],slice.call(args,1));};p.itemManager=function()
{return this._itemManager;};p.input=function()
{return $(this).data('input');};p.opts=function(name)
{var result=getProperty(this._opts,name);return typeof(result)=='undefined'?getProperty(this._defaults,name):result;};p.wrapElement=function()
{return $(this).data('wrapElement');};p.invalidateBounds=function()
{var self=this,input=self.input(),wrap=self.wrapElement(),container=wrap.parent(),width=self.originalWidth,height;self.trigger(EVENT_PRE_INVALIDATE);height=input.outerHeight();input.width(width);wrap.width(width).height(height);container.height(height);self.trigger(EVENT_POST_INVALIDATE);};p.focusInput=function()
{this.input()[0].focus();};p.serializeData=stringify;p.hiddenInput=function(value)
{return $(this).data('hiddenInput');};p.getWeightedEventResponse=function(event,args)
{var self=this,data={},maxWeight=0;self.trigger(event,data,args);for(var weight in data)
maxWeight=Math.max(maxWeight,weight);return data[maxWeight];};p.getFormData=function(keyCode)
{var self=this,data=self.getWeightedEventResponse(EVENT_GET_FORM_DATA,keyCode||0);self.trigger(EVENT_SET_FORM_DATA,data['form']);self.trigger(EVENT_SET_INPUT_DATA,data['input']);};p.onAnyKeyUp=function(e,keyCode)
{this.getFormData(keyCode);};p.onSetInputData=function(e,data)
{this.input().val(data);};p.onSetFormData=function(e,data)
{var self=this;self.hiddenInput().val(self.serializeData(data));};p.onGetFormData=function(e,data)
{var val=this.input().val();data[0]=formDataObject(val,val);};$(['Down','Up']).each(function()
{var type=this.toString();p['onKey'+type]=function(e)
{var self=this,keyName=self.opts(OPT_KEYS)[e.keyCode],defaultResult=true;if(keyName)
{defaultResult=keyName.substr(-1)!='!';keyName=keyName.replace('!','');self.trigger(keyName+'Key'+type);if(type=='Up'&&self._lastKeyDown==e.keyCode)
{self._lastKeyDown=null;self.trigger(keyName+'KeyPress');}
if(type=='Down')
self._lastKeyDown=e.keyCode;}
self.trigger('anyKey'+type,e.keyCode);return defaultResult;};});p=TextExtPlugin.prototype;p.on=hookupEvents;p.formDataObject=formDataObject;p.init=function(core){throw new Error('Not implemented')};p.baseInit=function(core,defaults)
{var self=this;core._defaults=$.extend(true,core._defaults,defaults);self._core=core;self._timers={};};p.startTimer=function(name,delay,callback)
{var self=this;self.stopTimer(name);self._timers[name]=setTimeout(function()
{delete self._timers[name];callback.apply(self);},delay*1000);};p.stopTimer=function(name)
{clearTimeout(this._timers[name]);};p.core=function()
{return this._core;};p.opts=function(name)
{return this.core().opts(name);};p.itemManager=function()
{return this.core().itemManager();};p.input=function()
{return this.core().input();};p.val=function(value)
{var input=this.input();if(typeof(value)===UNDEFINED)
return input.val();else
input.val(value);};p.trigger=function()
{var core=this.core();core.trigger.apply(core,arguments);};p.bind=function(event,handler)
{this.core().bind(event,handler);};p.initPriority=function()
{return 0;};var cssInjected=false;var textext=$.fn.textext=function(opts)
{var css;if(!cssInjected&&(css=$.fn.textext.css)!=null)
{$('head').append('<style>'+css+'</style>');cssInjected=true;}
return this.map(function()
{var self=$(this);if(opts==null)
return self.data('textext');var instance=new TextExt();instance.init(self,opts);self.data('textext',instance);return instance.input()[0];});};textext.addPlugin=function(name,constructor)
{textext.plugins[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.addPatch=function(name,constructor)
{textext.patches[name]=constructor;constructor.prototype=new textext.TextExtPlugin();};textext.TextExt=TextExt;textext.TextExtPlugin=TextExtPlugin;textext.ItemManager=ItemManager;textext.plugins={};textext.patches={};})(jQuery);(function($)
{function TextExtIE9Patches(){};$.fn.textext.TextExtIE9Patches=TextExtIE9Patches;$.fn.textext.addPatch('ie9',TextExtIE9Patches);var p=TextExtIE9Patches.prototype;p.init=function(core)
{if(navigator.userAgent.indexOf('MSIE 9')==-1)
return;var self=this;core.on({postInvalidate:self.onPostInvalidate});};p.onPostInvalidate=function()
{var self=this,input=self.input(),val=input.val();input.val(Math.random());input.val(val);};})(jQuery);;(function($)
{function TextExtAjax(){};$.fn.textext.TextExtAjax=TextExtAjax;$.fn.textext.addPlugin('ajax',TextExtAjax);var p=TextExtAjax.prototype,OPT_DATA_CALLBACK='ajax.data.callback',OPT_CACHE_RESULTS='ajax.cache.results',OPT_LOADING_DELAY='ajax.loading.delay',OPT_LOADING_MESSAGE='ajax.loading.message',OPT_TYPE_DELAY='ajax.type.delay',EVENT_SET_SUGGESTION='setSuggestions',EVENT_SHOW_DROPDOWN='showDropdown',TIMER_LOADING='loading',DEFAULT_OPTS={ajax:{typeDelay:0.5,loadingMessage:'Loading...',loadingDelay:0.5,cacheResults:false,dataCallback:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions});self._suggestions=null;};p.load=function(query)
{var self=this,dataCallback=self.opts(OPT_DATA_CALLBACK)||function(query){return{q:query}},opts;opts=$.extend(true,{data:dataCallback(query),success:function(data){self.onComplete(data,query)},error:function(jqXHR,message){console.error(message,query)}},self.opts('ajax'));$.ajax(opts);};p.onComplete=function(data,query)
{var self=this,result=data;self.dontShowLoading();if(self.opts(OPT_CACHE_RESULTS)==true)
{self._suggestions=data;result=self.itemManager().filter(data,query);}
self.trigger(EVENT_SET_SUGGESTION,{result:result});};p.dontShowLoading=function()
{this.stopTimer(TIMER_LOADING);};p.showLoading=function()
{var self=this;self.dontShowLoading();self.startTimer(TIMER_LOADING,self.opts(OPT_LOADING_DELAY),function()
{self.trigger(EVENT_SHOW_DROPDOWN,function(autocomplete)
{autocomplete.clearItems();var node=autocomplete.addDropdownItem(self.opts(OPT_LOADING_MESSAGE));node.addClass('text-loading');});});};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions,query=(data||{}).query||'';if(suggestions&&self.opts(OPT_CACHE_RESULTS)===true)
return self.onComplete(suggestions,query);self.startTimer('ajax',self.opts(OPT_TYPE_DELAY),function()
{self.showLoading();self.load(query);});};})(jQuery);;(function($)
{function TextExtArrow(){};$.fn.textext.TextExtArrow=TextExtArrow;$.fn.textext.addPlugin('arrow',TextExtArrow);var p=TextExtArrow.prototype,OPT_HTML_ARROW='html.arrow',DEFAULT_OPTS={html:{arrow:'<div class="text-arrow"/>'}};p.init=function(core)
{var self=this,arrow;self.baseInit(core,DEFAULT_OPTS);self._arrow=arrow=$(self.opts(OPT_HTML_ARROW));self.core().wrapElement().append(arrow);arrow.bind('click',function(e){self.onArrowClick(e);});};p.onArrowClick=function(e)
{this.trigger('toggleDropdown');this.core().focusInput();};})(jQuery);;(function($)
{function TextExtAutocomplete(){};$.fn.textext.TextExtAutocomplete=TextExtAutocomplete;$.fn.textext.addPlugin('autocomplete',TextExtAutocomplete);var p=TextExtAutocomplete.prototype,CSS_DOT='.',CSS_SELECTED='text-selected',CSS_DOT_SELECTED=CSS_DOT+CSS_SELECTED,CSS_SUGGESTION='text-suggestion',CSS_DOT_SUGGESTION=CSS_DOT+CSS_SUGGESTION,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,OPT_ENABLED='autocomplete.enabled',OPT_POSITION='autocomplete.dropdown.position',OPT_MAX_HEIGHT='autocomplete.dropdown.maxHeight',OPT_RENDER='autocomplete.render',OPT_HTML_DROPDOWN='html.dropdown',OPT_HTML_SUGGESTION='html.suggestion',EVENT_HIDE_DROPDOWN='hideDropdown',EVENT_SHOW_DROPDOWN='showDropdown',EVENT_GET_SUGGESTIONS='getSuggestions',EVENT_GET_FORM_DATA='getFormData',EVENT_TOGGLE_DROPDOWN='toggleDropdown',POSITION_ABOVE='above',POSITION_BELOW='below',DATA_MOUSEDOWN_ON_AUTOCOMPLETE='mousedownOnAutocomplete',DEFAULT_OPTS={autocomplete:{enabled:true,dropdown:{position:POSITION_BELOW,maxHeight:'100px'}},html:{dropdown:'<div class="text-dropdown"><div class="text-list"/></div>',suggestion:'<div class="text-suggestion"><span class="text-label"/></div>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);var input=self.input(),container;if(self.opts(OPT_ENABLED)===true)
{self.on({blur:self.onBlur,anyKeyUp:self.onAnyKeyUp,deleteKeyUp:self.onAnyKeyUp,backspaceKeyPress:self.onBackspaceKeyPress,enterKeyPress:self.onEnterKeyPress,escapeKeyPress:self.onEscapeKeyPress,setSuggestions:self.onSetSuggestions,showDropdown:self.onShowDropdown,hideDropdown:self.onHideDropdown,toggleDropdown:self.onToggleDropdown,postInvalidate:self.positionDropdown,getFormData:self.onGetFormData,downKeyDown:self.onDownKeyDown,upKeyDown:self.onUpKeyDown});container=$(self.opts(OPT_HTML_DROPDOWN));container.insertAfter(input);self.on(container,{mouseover:self.onMouseOver,mousedown:self.onMouseDown,click:self.onClick});container.css('maxHeight',self.opts(OPT_MAX_HEIGHT)).addClass('text-position-'+self.opts(OPT_POSITION));$(self).data('container',container);$(document.body).click(function(e)
{if(self.isDropdownVisible()&&!self.withinWrapElement(e.target))
self.trigger(EVENT_HIDE_DROPDOWN);});self.positionDropdown();}};p.containerElement=function()
{return $(this).data('container');};p.onMouseOver=function(e)
{var self=this,target=$(e.target);if(target.is(CSS_DOT_SUGGESTION))
{self.clearSelected();target.addClass(CSS_SELECTED);}};p.onMouseDown=function(e)
{this.containerElement().data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE,true);};p.onClick=function(e)
{var self=this,target=$(e.target);if($(CSS_DOT_SUGGESTION).has(target[0])||$(CSS_DOT_LABEL).has(target[0]))
self.trigger('enterKeyPress');if(self.core().hasPlugin('tags'))
self.val('');};p.onBlur=function(e)
{var self=this,container=self.containerElement(),isBlurByMousedown=container.data(DATA_MOUSEDOWN_ON_AUTOCOMPLETE)===true;if(self.isDropdownVisible())
isBlurByMousedown?self.core().focusInput():self.trigger(EVENT_HIDE_DROPDOWN);container.removeData(DATA_MOUSEDOWN_ON_AUTOCOMPLETE);};p.onBackspaceKeyPress=function(e)
{var self=this,isEmpty=self.val().length>0;if(isEmpty||self.isDropdownVisible())
self.getSuggestions();};p.onAnyKeyUp=function(e,keyCode)
{var self=this,isFunctionKey=self.opts('keys.'+keyCode)!=null;if(self.val().length>0&&!isFunctionKey)
self.getSuggestions();};p.onDownKeyDown=function(e)
{var self=this;self.isDropdownVisible()?self.toggleNextSuggestion():self.getSuggestions();};p.onUpKeyDown=function(e)
{this.togglePreviousSuggestion();};p.onEnterKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.selectFromDropdown();};p.onEscapeKeyPress=function(e)
{var self=this;if(self.isDropdownVisible())
self.trigger(EVENT_HIDE_DROPDOWN);};p.positionDropdown=function()
{var self=this,container=self.containerElement(),direction=self.opts(OPT_POSITION),height=self.core().wrapElement().outerHeight(),css={};css[direction===POSITION_ABOVE?'bottom':'top']=height+'px';container.css(css);};p.suggestionElements=function()
{return this.containerElement().find(CSS_DOT_SUGGESTION);};p.setSelectedSuggestion=function(suggestion)
{if(!suggestion)
return;var self=this,all=self.suggestionElements(),target=all.first(),item,i;self.clearSelected();for(i=0;i<all.length;i++)
{item=$(all[i]);if(self.itemManager().compareItems(item.data(CSS_SUGGESTION),suggestion))
{target=item.addClass(CSS_SELECTED);break;}}
target.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(target);};p.selectedSuggestionElement=function()
{return this.suggestionElements().filter(CSS_DOT_SELECTED).first();};p.isDropdownVisible=function()
{return this.containerElement().is(':visible')===true;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue=val;data[100]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 200;};p.onHideDropdown=function(e)
{this.hideDropdown();};p.onToggleDropdown=function(e)
{var self=this;self.trigger(self.containerElement().is(':visible')?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.onShowDropdown=function(e,renderCallback)
{var self=this,current=self.selectedSuggestionElement().data(CSS_SUGGESTION),suggestions=self._suggestions;if(!suggestions)
return self.trigger(EVENT_GET_SUGGESTIONS);if($.isFunction(renderCallback))
{renderCallback(self);}
else
{self.renderSuggestions(self._suggestions);self.toggleNextSuggestion();}
self.showDropdown(self.containerElement());self.setSelectedSuggestion(current);};p.onSetSuggestions=function(e,data)
{var self=this,suggestions=self._suggestions=data.result;if(data.showHideDropdown!==false)
self.trigger(suggestions===null||suggestions.length===0?EVENT_HIDE_DROPDOWN:EVENT_SHOW_DROPDOWN);};p.getSuggestions=function()
{var self=this,val=self.val();if(self._previousInputValue==val)
return;if(val=='')
current=null;self._previousInputValue=val;self.trigger(EVENT_GET_SUGGESTIONS,{query:val});};p.clearItems=function()
{this.containerElement().find('.text-list').children().remove();};p.renderSuggestions=function(suggestions)
{var self=this;self.clearItems();$.each(suggestions||[],function(index,item)
{self.addSuggestion(item);});};p.showDropdown=function()
{this.containerElement().show();};p.hideDropdown=function()
{var self=this,dropdown=self.containerElement();self._previousInputValue=null;dropdown.hide();};p.addSuggestion=function(suggestion)
{var self=this,renderer=self.opts(OPT_RENDER),node=self.addDropdownItem(renderer?renderer.call(self,suggestion):self.itemManager().itemToString(suggestion));node.data(CSS_SUGGESTION,suggestion);};p.addDropdownItem=function(html)
{var self=this,container=self.containerElement().find('.text-list'),node=$(self.opts(OPT_HTML_SUGGESTION));node.find('.text-label').html(html);container.append(node);return node;};p.clearSelected=function()
{this.suggestionElements().removeClass(CSS_SELECTED);};p.toggleNextSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),next;if(selected.length>0)
{next=selected.next();if(next.length>0)
selected.removeClass(CSS_SELECTED);}
else
{next=self.suggestionElements().first();}
next.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(next);};p.togglePreviousSuggestion=function()
{var self=this,selected=self.selectedSuggestionElement(),prev=selected.prev();if(prev.length==0)
return;self.clearSelected();prev.addClass(CSS_SELECTED);self.scrollSuggestionIntoView(prev);};p.scrollSuggestionIntoView=function(item)
{var itemHeight=item.outerHeight(),dropdown=this.containerElement(),dropdownHeight=dropdown.innerHeight(),scrollPos=dropdown.scrollTop(),itemTop=(item.position()||{}).top,scrollTo=null,paddingTop=parseInt(dropdown.css('paddingTop'));if(itemTop==null)
return;if(itemTop+itemHeight>dropdownHeight)
scrollTo=itemTop+scrollPos+itemHeight-dropdownHeight+paddingTop;if(itemTop<0)
scrollTo=itemTop+scrollPos-paddingTop;if(scrollTo!=null)
dropdown.scrollTop(scrollTo);};p.selectFromDropdown=function()
{var self=this,suggestion=self.selectedSuggestionElement().data(CSS_SUGGESTION);if(suggestion)
{self.val(self.itemManager().itemToString(suggestion));self.core().getFormData();}
self.trigger(EVENT_HIDE_DROPDOWN);};p.withinWrapElement=function(element)
{return this.core().wrapElement().find(element).size()>0;}})(jQuery);;(function($)
{function TextExtFilter(){};$.fn.textext.TextExtFilter=TextExtFilter;$.fn.textext.addPlugin('filter',TextExtFilter);var p=TextExtFilter.prototype,OPT_ENABLED='filter.enabled',OPT_ITEMS='filter.items',DEFAULT_OPTS={filter:{enabled:true,items:null}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getFormData:self.onGetFormData,isTagAllowed:self.onIsTagAllowed,setSuggestions:self.onSetSuggestions});self._suggestions=null;};p.onGetFormData=function(e,data,keyCode)
{var self=this,val=self.val(),inputValue=val,formValue='';if(!self.core().hasPlugin('tags'))
{if(self.isValueAllowed(inputValue))
formValue=val;data[300]=self.formDataObject(inputValue,formValue);}};p.isValueAllowed=function(value)
{var self=this,list=self.opts('filterItems')||self._suggestions||[],itemManager=self.itemManager(),result=!self.opts(OPT_ENABLED),i;for(i=0;i<list.length&&!result;i++)
if(itemManager.compareItems(value,list[i]))
result=true;return result;};p.onIsTagAllowed=function(e,data)
{data.result=this.isValueAllowed(data.tag);};p.onSetSuggestions=function(e,data)
{this._suggestions=data.result;};})(jQuery);;(function($)
{function TextExtFocus(){};$.fn.textext.TextExtFocus=TextExtFocus;$.fn.textext.addPlugin('focus',TextExtFocus);var p=TextExtFocus.prototype,OPT_HTML_FOCUS='html.focus',DEFAULT_OPTS={html:{focus:'<div class="text-focus"/>'}};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.core().wrapElement().append(self.opts(OPT_HTML_FOCUS));self.on({blur:self.onBlur,focus:self.onFocus});self._timeoutId=0;};p.onBlur=function(e)
{var self=this;clearTimeout(self._timeoutId);self._timeoutId=setTimeout(function()
{self.getFocus().hide();},100);};p.onFocus=function(e)
{var self=this;clearTimeout(self._timeoutId);self.getFocus().show();};p.getFocus=function()
{return this.core().wrapElement().find('.text-focus');};})(jQuery);;(function($)
{function TextExtPrompt(){};$.fn.textext.TextExtPrompt=TextExtPrompt;$.fn.textext.addPlugin('prompt',TextExtPrompt);var p=TextExtPrompt.prototype,CSS_HIDE_PROMPT='text-hide-prompt',OPT_PROMPT='prompt',OPT_HTML_PROMPT='html.prompt',DEFAULT_OPTS={prompt:'Awaiting input...',html:{prompt:'<div class="text-prompt"/>'}};p.init=function(core)
{var self=this,placeholderKey='placeholder',container,prompt;self.baseInit(core,DEFAULT_OPTS);container=$(self.opts(OPT_HTML_PROMPT));$(self).data('container',container);self.core().wrapElement().append(container);self.setPrompt(self.opts(OPT_PROMPT));prompt=core.input().attr(placeholderKey);if(!prompt)
prompt=self.opts(OPT_PROMPT);core.input().attr(placeholderKey,'');if(prompt)
self.setPrompt(prompt);if($.trim(self.val()).length>0)
self.hidePrompt();self.on({blur:self.onBlur,focus:self.onFocus,postInvalidate:self.onPostInvalidate,postInit:self.onPostInit});};p.onPostInit=function(e)
{this.invalidateBounds();};p.onPostInvalidate=function(e)
{this.invalidateBounds();};p.invalidateBounds=function()
{var self=this,input=self.input();self.containerElement().css({paddingLeft:input.css('paddingLeft'),paddingTop:input.css('paddingTop')});};p.onBlur=function(e)
{var self=this;self.startTimer('prompt',0.1,function()
{self.showPrompt();});};p.showPrompt=function()
{var self=this,input=self.input();if($.trim(self.val()).length===0&&!input.is(':focus'))
self.containerElement().removeClass(CSS_HIDE_PROMPT);};p.hidePrompt=function()
{this.stopTimer('prompt');this.containerElement().addClass(CSS_HIDE_PROMPT);};p.onFocus=function(e)
{this.hidePrompt();};p.setPrompt=function(str)
{this.containerElement().text(str);};p.containerElement=function()
{return $(this).data('container');};})(jQuery);;(function($)
{function TextExtSuggestions(){};$.fn.textext.TextExtSuggestions=TextExtSuggestions;$.fn.textext.addPlugin('suggestions',TextExtSuggestions);var p=TextExtSuggestions.prototype,OPT_SUGGESTIONS='suggestions',DEFAULT_OPTS={suggestions:null};p.init=function(core)
{var self=this;self.baseInit(core,DEFAULT_OPTS);self.on({getSuggestions:self.onGetSuggestions,postInit:self.onPostInit});};p.setSuggestions=function(suggestions,showHideDropdown)
{this.trigger('setSuggestions',{result:suggestions,showHideDropdown:showHideDropdown!=false});};p.onPostInit=function(e)
{var self=this;self.setSuggestions(self.opts(OPT_SUGGESTIONS),false);};p.onGetSuggestions=function(e,data)
{var self=this,suggestions=self.opts(OPT_SUGGESTIONS);suggestions.sort();self.setSuggestions(self.itemManager().filter(suggestions,data.query));};})(jQuery);;(function($)
{function TextExtTags(){};$.fn.textext.TextExtTags=TextExtTags;$.fn.textext.addPlugin('tags',TextExtTags);var p=TextExtTags.prototype,CSS_DOT='.',CSS_TAGS_ON_TOP='text-tags-on-top',CSS_DOT_TAGS_ON_TOP=CSS_DOT+CSS_TAGS_ON_TOP,CSS_TAG='text-tag',CSS_DOT_TAG=CSS_DOT+CSS_TAG,CSS_TAGS='text-tags',CSS_DOT_TAGS=CSS_DOT+CSS_TAGS,CSS_LABEL='text-label',CSS_DOT_LABEL=CSS_DOT+CSS_LABEL,CSS_REMOVE='text-remove',CSS_DOT_REMOVE=CSS_DOT+CSS_REMOVE,OPT_ENABLED='tags.enabled',OPT_ITEMS='tags.items',OPT_HTML_TAG='html.tag',OPT_HTML_TAGS='html.tags',EVENT_IS_TAG_ALLOWED='isTagAllowed',EVENT_TAG_CLICK='tagClick',DEFAULT_OPTS={tags:{enabled:true,items:null},html:{tags:'<div class="text-tags"/>',tag:'<div class="text-tag"><div class="text-button"><span class="text-label"/><a class="text-remove"/></div></div>'}};p.init=function(core)
{this.baseInit(core,DEFAULT_OPTS);var self=this,input=self.input(),container;if(self.opts(OPT_ENABLED))
{container=$(self.opts(OPT_HTML_TAGS));input.after(container);$(self).data('container',container);self.on({enterKeyPress:self.onEnterKeyPress,backspaceKeyDown:self.onBackspaceKeyDown,preInvalidate:self.onPreInvalidate,postInit:self.onPostInit,getFormData:self.onGetFormData});self.on(container,{click:self.onClick,mousemove:self.onContainerMouseMove});self.on(input,{mousemove:self.onInputMouseMove});}
self._originalPadding={left:parseInt(input.css('paddingLeft')||0),top:parseInt(input.css('paddingTop')||0)};self._paddingBox={left:0,top:0};self.updateFormCache();};p.containerElement=function()
{return $(this).data('container');};p.onPostInit=function(e)
{var self=this;self.addTags(self.opts(OPT_ITEMS));};p.onGetFormData=function(e,data,keyCode)
{var self=this,inputValue=keyCode===13?'':self.val(),formValue=self._formData;data[200]=self.formDataObject(inputValue,formValue);};p.initPriority=function()
{return 100;};p.onInputMouseMove=function(e)
{this.toggleZIndex(e);};p.onContainerMouseMove=function(e)
{this.toggleZIndex(e);};p.onBackspaceKeyDown=function(e)
{var self=this,lastTag=self.tagElements().last();if(self.val().length==0)
self.removeTag(lastTag);};p.onPreInvalidate=function(e)
{var self=this,lastTag=self.tagElements().last(),pos=lastTag.position();if(lastTag.length>0)
pos.left+=lastTag.innerWidth();else
pos=self._originalPadding;self._paddingBox=pos;self.input().css({paddingLeft:pos.left,paddingTop:pos.top});};p.onClick=function(e)
{var self=this,core=self.core(),source=$(e.target),focus=0,tag;if(source.is(CSS_DOT_TAGS))
{focus=1;}
else if(source.is(CSS_DOT_REMOVE))
{self.removeTag(source.parents(CSS_DOT_TAG+':first'));focus=1;}
else if(source.is(CSS_DOT_LABEL))
{tag=source.parents(CSS_DOT_TAG+':first');self.trigger(EVENT_TAG_CLICK,tag,tag.data(CSS_TAG),tagClickCallback);}
function tagClickCallback(newValue,refocus)
{tag.data(CSS_TAG,newValue);tag.find(CSS_DOT_LABEL).text(self.itemManager().itemToString(newValue));self.updateFormCache();core.getFormData();core.invalidateBounds();if(refocus)
core.focusInput();}
if(focus)
core.focusInput();};p.onEnterKeyPress=function(e)
{var self=this,val=self.val(),tag=self.itemManager().stringToItem(val);if(self.isTagAllowed(tag))
{self.addTags([tag]);self.core().focusInput();}};p.updateFormCache=function()
{var self=this,result=[];self.tagElements().each(function()
{result.push($(this).data(CSS_TAG));});self._formData=result;};p.toggleZIndex=function(e)
{var self=this,offset=self.input().offset(),mouseX=e.clientX-offset.left,mouseY=e.clientY-offset.top,box=self._paddingBox,container=self.containerElement(),isOnTop=container.is(CSS_DOT_TAGS_ON_TOP),isMouseOverText=mouseX>box.left&&mouseY>box.top;if(!isOnTop&&!isMouseOverText||isOnTop&&isMouseOverText)
container[(!isOnTop?'add':'remove')+'Class'](CSS_TAGS_ON_TOP);};p.tagElements=function()
{return this.containerElement().find(CSS_DOT_TAG);};p.isTagAllowed=function(tag)
{var opts={tag:tag,result:true};this.trigger(EVENT_IS_TAG_ALLOWED,opts);return opts.result===true;};p.addTags=function(tags)
{if(!tags||tags.length==0)
return;var self=this,core=self.core(),container=self.containerElement(),i,tag;for(i=0;i<tags.length;i++)
{tag=tags[i];if(tag&&self.isTagAllowed(tag))
container.append(self.renderTag(tag));}
self.updateFormCache();core.getFormData();core.invalidateBounds();};p.getTagElement=function(tag)
{var self=this,list=self.tagElements(),i,item;for(i=0;i<list.length,item=$(list[i]);i++)
if(self.itemManager().compareItems(item.data(CSS_TAG),tag))
return item;};p.removeTag=function(tag)
{var self=this,core=self.core(),element;if(tag instanceof $)
{element=tag;tag=tag.data(CSS_TAG);}
else
{element=self.getTagElement(tag);}
element.remove();self.updateFormCache();core.getFormData();core.invalidateBounds();};p.renderTag=function(tag)
{var self=this,node=$(self.opts(OPT_HTML_TAG));node.find('.text-label').text(self.itemManager().itemToString(tag));node.data(CSS_TAG,tag);return node;};})(jQuery);;(function($){$.timeago=function(timestamp){if(timestamp instanceof Date){return inWords(timestamp);}else if(typeof timestamp==="string"){return inWords($.timeago.parse(timestamp));}else if(typeof timestamp==="number"){return inWords(new Date(timestamp));}else{return inWords($.timeago.datetime(timestamp));}};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:60000,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]},translator:null},inWords:function(distanceMillis){var $l=this.settings.strings;var prefix=$l.prefixAgo;var suffix=$l.suffixAgo;if(this.settings.allowFuture){if(distanceMillis<0){prefix=$l.prefixFromNow;suffix=$l.suffixFromNow;}}
var seconds=Math.abs(distanceMillis)/1000;var minutes=seconds/60;var hours=minutes/60;var days=hours/24;var years=days/365;function convert(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction;return{'string':string,'value':($l.numbers&&$l.numbers[number])||number};}
var stringAndNumber=seconds<45&&convert($l.seconds,Math.round(seconds))||seconds<90&&convert($l.minute,1)||minutes<45&&convert($l.minutes,Math.round(minutes))||minutes<90&&convert($l.hour,1)||hours<24&&convert($l.hours,Math.round(hours))||hours<42&&convert($l.day,1)||days<30&&convert($l.days,Math.round(days))||days<45&&convert($l.month,1)||days<365&&convert($l.months,Math.round(days/30))||years<1.5&&convert($l.year,1)||convert($l.years,Math.round(years));var string=stringAndNumber.string;var value=stringAndNumber.value;var separator=$l.wordSeparator===undefined?" ":$l.wordSeparator;var fullString=$.trim([prefix,string,suffix].join(separator));var translatedString=$t.settings.translator?$t.settings.translator(fullString):fullString;return translatedString.replace(/%d/i,value);},parse:function(iso8601){var s=$.trim(iso8601);s=s.replace(/\.\d\d\d+/,"");s=s.replace(/-/,"/").replace(/-/,"/");s=s.replace(/T/," ").replace(/Z/," UTC");s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(s);},datetime:function(elem){var iso8601=$t.isTime(elem)?$(elem).attr("datetime"):$(elem).attr("title");return $t.parse(iso8601);},isTime:function(elem){return $(elem).get(0).tagName.toLowerCase()==="time";}});$.fn.timeago=function(){var self=this;self.each(refresh);var $s=$t.settings;if($s.refreshMillis>0){setInterval(function(){self.each(refresh);},$s.refreshMillis);}
return self;};function refresh(){var data=prepareData(this);if(!isNaN(data.datetime)){$(this).text(inWords(data.datetime));}
return this;}
function prepareData(element){element=$(element);if(!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());if(text.length>0&&!($t.isTime(element)&&element.attr("title"))){element.attr("title",text);}}
return element.data("timeago");}
function inWords(date){return $t.inWords(distance(date));}
function distance(date){return(new Date().getTime()-date.getTime());}
document.createElement("abbr");document.createElement("time");}(jQuery));;var QWeb2={expressions_cache:{},RESERVED_WORDS:'true,false,NaN,null,undefined,debugger,console,window,in,instanceof,new,function,return,this,typeof,eval,void,Math,RegExp,Array,Object,Date'.split(','),ACTIONS_PRECEDENCE:'foreach,if,call,set,esc,escf,raw,rawf,js,debug,log'.split(','),WORD_REPLACEMENT:{'and':'&&','or':'||','gt':'>','gte':'>=','lt':'<','lte':'<='},tools:{exception:function(message,context){context=context||{};var prefix='QWeb2';if(context.template){prefix+=" - template['"+context.template+"']";}
throw new Error(prefix+": "+message);},warning:function(message){if(typeof(window)!=='undefined'&&window.console){window.console.warn(message);}},trim:function(s,mode){switch(mode){case"left":return s.replace(/^\s*/,"");case"right":return s.replace(/\s*$/,"");default:return s.replace(/^\s*|\s*$/g,"");}},js_escape:function(s,noquotes){return(noquotes?'':"'")+s.replace(/\r?\n/g,"\\n").replace(/'/g,"\\'")+(noquotes?'':"'");},html_escape:function(s,attribute){if(s==null){return'';}
s=String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');if(attribute){s=s.replace(/"/g,'&quot;');}
return s;},gen_attribute:function(o){if(o!==null&&o!==undefined){if(o.constructor===Array){if(o[1]!==null&&o[1]!==undefined){return this.format_attribute(o[0],o[1]);}}else if(typeof o==='object'){var r='';for(var k in o){if(o.hasOwnProperty(k)){r+=this.gen_attribute([k,o[k]]);}}
return r;}}
return'';},format_attribute:function(name,value){return' '+name+'="'+this.html_escape(value,true)+'"';},extend:function(dst,src,exclude){for(var p in src){if(src.hasOwnProperty(p)&&!(exclude&&this.arrayIndexOf(exclude,p)!==-1)){dst[p]=src[p];}}
return dst;},arrayIndexOf:function(array,item){for(var i=0,ilen=array.length;i<ilen;i++){if(array[i]===item){return i;}}
return-1;},xml_node_to_string:function(node,childs_only){if(childs_only){var childs=node.childNodes,r=[];for(var i=0,ilen=childs.length;i<ilen;i++){r.push(this.xml_node_to_string(childs[i]));}
return r.join('');}else{if(typeof XMLSerializer!=='undefined'){return(new XMLSerializer()).serializeToString(node);}else{switch(node.nodeType){case 1:return node.outerHTML;case 3:return node.data;case 4:return'<![CDATA['+node.data+']]>';case 8:return'<!-- '+node.data+'-->';}
throw new Error('Unknown node type '+node.nodeType);}}},call:function(context,template,old_dict,_import,callback){var new_dict=this.extend({},old_dict);new_dict['__caller__']=old_dict['__template__'];if(callback){new_dict['__content__']=callback(context,new_dict);}
var r=context.engine._render(template,new_dict);if(_import){if(_import==='*'){this.extend(old_dict,new_dict,['__caller__','__template__']);}else{_import=_import.split(',');for(var i=0,ilen=_import.length;i<ilen;i++){var v=_import[i];old_dict[v]=new_dict[v];}}}
return r;},foreach:function(context,enu,as,old_dict,callback){if(enu!=null){var size,new_dict=this.extend({},old_dict);new_dict[as+"_all"]=enu;var as_value=as+"_value",as_index=as+"_index",as_first=as+"_first",as_last=as+"_last",as_parity=as+"_parity";if(size=enu.length){new_dict[as+"_size"]=size;for(var j=0,jlen=enu.length;j<jlen;j++){var cur=enu[j];new_dict[as_value]=cur;new_dict[as_index]=j;new_dict[as_first]=j===0;new_dict[as_last]=j+1===size;new_dict[as_parity]=(j%2==1?'odd':'even');if(cur.constructor===Object){this.extend(new_dict,cur);}
new_dict[as]=cur;callback(context,new_dict);}}else if(enu.constructor==Number){var _enu=[];for(var i=0;i<enu;i++){_enu.push(i);}
this.foreach(context,_enu,as,old_dict,callback);}else{var index=0;for(var k in enu){if(enu.hasOwnProperty(k)){var v=enu[k];new_dict[as_value]=v;new_dict[as_index]=index;new_dict[as_first]=index===0;new_dict[as_parity]=(j%2==1?'odd':'even');new_dict[as]=k;callback(context,new_dict);index+=1;}}}}else{this.exception("No enumerator given to foreach",context);}}}};QWeb2.Engine=(function(){function Engine(){this.prefix='t';this.debug=false;this.templates_resources=[];this.templates={};this.compiled_templates={};this.extend_templates={};this.default_dict={};this.tools=QWeb2.tools;this.jQuery=window.jQuery;this.reserved_words=QWeb2.RESERVED_WORDS.slice(0);this.actions_precedence=QWeb2.ACTIONS_PRECEDENCE.slice(0);this.word_replacement=QWeb2.tools.extend({},QWeb2.WORD_REPLACEMENT);this.preprocess_node=null;for(var i=0;i<arguments.length;i++){this.add_template(arguments[i]);}}
QWeb2.tools.extend(Engine.prototype,{add_template:function(template){this.templates_resources.push(template);if(template.constructor===String){template=this.load_xml(template);}
var ec=(template.documentElement&&template.documentElement.childNodes)||template.childNodes||[];for(var i=0;i<ec.length;i++){var node=ec[i];if(node.nodeType===1){if(node.nodeName=='parsererror'){return this.tools.exception(node.innerText);}
var name=node.getAttribute(this.prefix+'-name');var extend=node.getAttribute(this.prefix+'-extend');if(name&&extend){if(!this.templates[extend]){return this.tools.exception("Can't clone undefined template "+extend);}
this.templates[name]=this.templates[extend].cloneNode(true);extend=name;name=undefined;}
if(name){this.templates[name]=node;this.compiled_templates[name]=null;}else if(extend){delete(this.compiled_templates[extend]);if(this.extend_templates[extend]){this.extend_templates[extend].push(node);}else{this.extend_templates[extend]=[node];}}}}
return true;},load_xml:function(s){s=this.tools.trim(s);if(s.charAt(0)==='<'){return this.load_xml_string(s);}else{var req=this.get_xhr();if(req){if(this.debug){s+='?debug='+(new Date()).getTime();}
req.open('GET',s,false);req.send(null);var xDoc=req.responseXML;if(xDoc){if(!xDoc.documentElement){throw new Error("QWeb2: This xml document has no root document : "+xDoc.responseText);}
if(xDoc.documentElement.nodeName=="parsererror"){return this.tools.exception(xDoc.documentElement.childNodes[0].nodeValue);}
return xDoc;}else{return this.load_xml_string(req.responseText);}}}},load_xml_string:function(s){if(window.DOMParser){var dp=new DOMParser();var r=dp.parseFromString(s,"text/xml");if(r.body&&r.body.firstChild&&r.body.firstChild.nodeName=='parsererror'){return this.tools.exception(r.body.innerText);}
return r;}
var xDoc;try{xDoc=new ActiveXObject("MSXML2.DOMDocument");}catch(e){return this.tools.exception("Could not find a DOM Parser: "+e.message);}
xDoc.async=false;xDoc.preserveWhiteSpace=true;xDoc.loadXML(s);return xDoc;},has_template:function(template){return!!this.templates[template];},get_xhr:function(){if(window.XMLHttpRequest){return new window.XMLHttpRequest();}
try{return new ActiveXObject('MSXML2.XMLHTTP.3.0');}catch(e){return null;}},compile:function(node){var e=new QWeb2.Element(this,node);var template=node.getAttribute(this.prefix+'-name');return"   /* 'this' refers to Qweb2.Engine instance */\n"+"   var context = { engine : this, template : "+(this.tools.js_escape(template))+" };\n"+"   dict = dict || {};\n"+"   dict['__template__'] = '"+template+"';\n"+"   var r = [];\n"+"   /* START TEMPLATE */"+
(this.debug?"":" try {\n")+
(e.compile())+"\n"+"   /* END OF TEMPLATE */"+
(this.debug?"":" } catch(error) {\n"+"       if (console && console.exception) console.exception(error);\n"+"       context.engine.tools.exception('Runtime Error: ' + error, context);\n")+
(this.debug?"":"   }\n")+"   return r.join('');";},render:function(template,dict){dict=dict||{};QWeb2.tools.extend(dict,this.default_dict);var r=this._render(template,dict);return r;},_render:function(template,dict){if(this.compiled_templates[template]){return this.compiled_templates[template].apply(this,[dict||{}]);}else if(this.templates[template]){var ext;if(ext=this.extend_templates[template]){var extend_node;while(extend_node=ext.shift()){this.extend(template,extend_node);}}
var code=this.compile(this.templates[template]),tcompiled;try{tcompiled=new Function(['dict'],code);}catch(error){if(this.debug&&window.console){console.log(code);}
this.tools.exception("Error evaluating template: "+error,{template:name});}
if(!tcompiled){this.tools.exception("Error evaluating template: (IE?)"+error,{template:name});}
this.compiled_templates[template]=tcompiled;return this.render(template,dict);}else{return this.tools.exception("Template '"+template+"' not found");}},extend:function(template,extend_node){if(!this.jQuery){return this.tools.exception("Can't extend template "+template+" without jQuery");}
var template_dest=this.templates[template];for(var i=0,ilen=extend_node.childNodes.length;i<ilen;i++){var child=extend_node.childNodes[i];if(child.nodeType===1){var jquery=child.getAttribute(this.prefix+'-jquery'),operation=child.getAttribute(this.prefix+'-operation'),target,error_msg="Error while extending template '"+template;if(jquery){target=this.jQuery(jquery,template_dest);}else{this.tools.exception(error_msg+"No expression given");}
error_msg+="' (expression='"+jquery+"') : ";if(operation){var allowed_operations="append,prepend,before,after,replace,inner".split(',');if(this.tools.arrayIndexOf(allowed_operations,operation)==-1){this.tools.exception(error_msg+"Invalid operation : '"+operation+"'");}
operation={'replace':'replaceWith','inner':'html'}[operation]||operation;target[operation](child.cloneNode(true).childNodes);}else{try{var f=new Function(['$','document'],this.tools.xml_node_to_string(child,true));}catch(error){return this.tools.exception("Parse "+error_msg+error);}
try{f.apply(target,[this.jQuery,template_dest.ownerDocument]);}catch(error){return this.tools.exception("Runtime "+error_msg+error);}}}}}});return Engine;})();QWeb2.Element=(function(){function Element(engine,node){this.engine=engine;this.node=node;this.tag=node.tagName;this.actions={};this.actions_done=[];this.attributes={};this.children=[];this._top=[];this._bottom=[];this._indent=1;this.process_children=true;var childs=this.node.childNodes;if(childs){for(var i=0,ilen=childs.length;i<ilen;i++){this.children.push(new QWeb2.Element(this.engine,childs[i]));}}
var attrs=this.node.attributes;if(attrs){for(var j=0,jlen=attrs.length;j<jlen;j++){var attr=attrs[j];var name=attr.name;var m=name.match(new RegExp("^"+this.engine.prefix+"-(.+)"));if(m){name=m[1];if(name==='name'){continue;}
this.actions[name]=attr.value;}else{this.attributes[name]=attr.value;}}}
if(this.engine.preprocess_node){this.engine.preprocess_node.call(this);}}
QWeb2.tools.extend(Element.prototype,{compile:function(){var r=[],instring=false,lines=this._compile().split('\n');for(var i=0,ilen=lines.length;i<ilen;i++){var m,line=lines[i];if(m=line.match(/^(\s*)\/\/@string=(.*)/)){if(instring){if(this.engine.debug){r.push((m[2].indexOf("\\n")!=-1?"',\n\t"+m[1]+"'":'')+m[2]);}else{r.push(m[2]);}}else{r.push(m[1]+"r.push('"+m[2]);instring=true;}}else{if(instring){r.push("');\n");}
instring=false;r.push(line+'\n');}}
return r.join('');},_compile:function(){switch(this.node.nodeType){case 3:case 4:this.top_string(this.node.data);break;case 1:this.compile_element();}
var r=this._top.join('');if(this.process_children){for(var i=0,ilen=this.children.length;i<ilen;i++){var child=this.children[i];child._indent=this._indent;r+=child._compile();}}
r+=this._bottom.join('');return r;},format_expression:function(e){if(QWeb2.expressions_cache[e]){return QWeb2.expressions_cache[e];}
var chars=e.split(''),instring='',invar='',invar_pos=0,r='';chars.push(' ');for(var i=0,ilen=chars.length;i<ilen;i++){var c=chars[i];if(instring.length){if(c===instring&&chars[i-1]!=="\\"){instring='';}}else if(c==='"'||c==="'"){instring=c;}else if(c.match(/[a-zA-Z_\$]/)&&!invar.length){invar=c;invar_pos=i;continue;}else if(c.match(/\W/)&&invar.length){if(chars[invar_pos-1]!=='.'&&QWeb2.tools.arrayIndexOf(this.engine.reserved_words,invar)<0){invar=this.engine.word_replacement[invar]||("dict['"+invar+"']");}
r+=invar;invar='';}else if(invar.length){invar+=c;continue;}
r+=c;}
r=r.slice(0,-1);QWeb2.expressions_cache[e]=r;return r;},string_interpolation:function(s){if(!s){return"''";}
var regex=/^{(.*)}(.*)/,src=s.split(/#/),r=[];for(var i=0,ilen=src.length;i<ilen;i++){var val=src[i],m=val.match(regex);if(m){r.push("("+this.format_expression(m[1])+")");if(m[2]){r.push(this.engine.tools.js_escape(m[2]));}}else if(!(i===0&&val==='')){r.push(this.engine.tools.js_escape((i===0?'':'#')+val));}}
return r.join(' + ');},indent:function(){return this._indent++;},dedent:function(){if(this._indent!==0){return this._indent--;}},get_indent:function(){return new Array(this._indent+1).join("\t");},top:function(s){return this._top.push(this.get_indent()+s+'\n');},top_string:function(s){return this._top.push(this.get_indent()+"//@string="+this.engine.tools.js_escape(s,true)+'\n');},bottom:function(s){return this._bottom.unshift(this.get_indent()+s+'\n');},bottom_string:function(s){return this._bottom.unshift(this.get_indent()+"//@string="+this.engine.tools.js_escape(s,true)+'\n');},compile_element:function(){for(var i=0,ilen=this.engine.actions_precedence.length;i<ilen;i++){var a=this.engine.actions_precedence[i];if(a in this.actions){var value=this.actions[a];var key='compile_action_'+a;if(this[key]){this[key](value);}else if(this.engine[key]){this.engine[key].call(this,value);}else{this.engine.tools.exception("No handler method for action '"+a+"'");}}}
if(this.tag.toLowerCase()!==this.engine.prefix){var tag="<"+this.tag;for(var a in this.attributes){tag+=this.engine.tools.gen_attribute([a,this.attributes[a]]);}
this.top_string(tag);if(this.actions.att){this.top("r.push(context.engine.tools.gen_attribute("+(this.format_expression(this.actions.att))+"));");}
for(var a in this.actions){var v=this.actions[a];var m=a.match(/att-(.+)/);if(m){this.top("r.push(context.engine.tools.gen_attribute(['"+m[1]+"', ("+(this.format_expression(v))+")]));");}
var m=a.match(/attf-(.+)/);if(m){this.top("r.push(context.engine.tools.gen_attribute(['"+m[1]+"', ("+(this.string_interpolation(v))+")]));");}}
if(this.children.length||this.actions.opentag==='true'){this.top_string(">");this.bottom_string("</"+this.tag+">");}else{this.top_string("/>");}}},compile_action_if:function(value){this.top("if ("+(this.format_expression(value))+") {");this.bottom("}");this.indent();},compile_action_foreach:function(value){var as=this.actions['as']||value.replace(/[^a-zA-Z0-9]/g,'_');this.top("context.engine.tools.foreach(context, "+(this.format_expression(value))+", "+(this.engine.tools.js_escape(as))+", dict, function(context, dict) {");this.bottom("});");this.indent();},compile_action_call:function(value){var _import=this.actions['import']||'';if(this.children.length===0){return this.top("r.push(context.engine.tools.call(context, "+(this.engine.tools.js_escape(value))+", dict, "+(this.engine.tools.js_escape(_import))+"));");}else{this.top("r.push(context.engine.tools.call(context, "+(this.engine.tools.js_escape(value))+", dict, "+(this.engine.tools.js_escape(_import))+", function(context, dict) {");this.bottom("}));");this.indent();this.top("var r = [];");return this.bottom("return r.join('');");}},compile_action_set:function(value){var variable=this.format_expression(value);if(this.actions['value']){if(this.children.length){this.engine.tools.warning("@set with @value plus node chidren found. Children are ignored.");}
this.top(variable+" = ("+(this.format_expression(this.actions['value']))+");");this.process_children=false;}else{if(this.children.length===0){this.top(variable+" = '';");}else if(this.children.length===1&&this.children[0].node.nodeType===3){this.top(variable+" = "+(this.engine.tools.js_escape(this.children[0].node.data))+";");this.process_children=false;}else{this.top(variable+" = (function(dict) {");this.bottom("})(dict);");this.indent();this.top("var r = [];");this.bottom("return r.join('');");}}},compile_action_esc:function(value){this.top("r.push(context.engine.tools.html_escape("+(this.format_expression(value))+"));");},compile_action_escf:function(value){this.top("r.push(context.engine.tools.html_escape("+(this.string_interpolation(value))+"));");},compile_action_raw:function(value){this.top("r.push("+(this.format_expression(value))+");");},compile_action_rawf:function(value){this.top("r.push("+(this.string_interpolation(value))+");");},compile_action_js:function(value){this.top("(function("+value+") {");this.bottom("})(dict);");this.indent();var lines=this.engine.tools.xml_node_to_string(this.node,true).split(/\r?\n/);for(var i=0,ilen=lines.length;i<ilen;i++){this.top(lines[i]);}
this.process_children=false;},compile_action_debug:function(value){this.top("debugger;");},compile_action_log:function(value){this.top("console.log("+this.format_expression(value)+");");}});return Element;})();;(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){return new wrapper(obj);};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root['_']=_;}
_.VERSION='1.3.1';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});if(obj.length===+obj.length)results.length=obj.length;return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError('Reduce of empty array with no initial value');return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var reversed=_.toArray(obj).reverse();if(context&&!initial)iterator=_.bind(iterator,context);return initial?_.reduce(reversed,iterator,memo,context):_.reduce(reversed,iterator);};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return!!result;};_.include=_.contains=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;found=any(obj,function(value){return value===target;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method||value:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var shuffled=[],rand;each(obj,function(value,index,list){if(index==0){shuffled[0]=value;}else{rand=Math.floor(Math.random()*(index+1));shuffled[index]=shuffled[rand];shuffled[rand]=value;}});return shuffled;};_.sortBy=function(obj,iterator,context){return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}),'value');};_.groupBy=function(obj,val){var result={};var iterator=_.isFunction(val)?val:function(obj){return obj[val];};each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value);});return result;};_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=(low+high)>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid;}
return low;};_.toArray=function(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();if(_.isArray(iterable))return slice.call(iterable);if(_.isArguments(iterable))return slice.call(iterable);return _.values(iterable);};_.size=function(obj){return _.toArray(obj).length;};_.first=_.head=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if((n!=null)&&!guard){return slice.call(array,Math.max(array.length-n,0));}else{return array[array.length-1];}};_.rest=_.tail=function(array,index,guard){return slice.call(array,(index==null)||guard?1:index);};_.compact=function(array){return _.filter(array,function(value){return!!value;});};_.flatten=function(array,shallow){return _.reduce(array,function(memo,value){if(_.isArray(value))return memo.concat(shallow?value:_.flatten(value));memo[memo.length]=value;return memo;},[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array;var result=[];_.reduce(initial,function(memo,el,i){if(0==i||(isSorted===true?_.last(memo)!=el:!_.include(memo,el))){memo[memo.length]=el;result[result.length]=array[i];}
return memo;},[]);return result;};_.union=function(){return _.uniq(_.flatten(arguments,true));};_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=_.flatten(slice.call(arguments,1));return _.filter(array,function(value){return!_.include(rest,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted){i=_.sortedIndex(array,item);return array[i]===item?i:-1;}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(i in array&&array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(i in array&&array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};var ctor=function(){};_.bind=function bind(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(func,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait){var context,args,timeout,throttling,more;var whenDone=_.debounce(function(){more=throttling=false;},wait);return function(){context=this;args=arguments;var later=function(){timeout=null;if(more)func.apply(context,args);whenDone();};if(!timeout)timeout=setTimeout(later,wait);if(throttling){more=true;}else{func.apply(context,args);}
whenDone();throttling=true;};};_.debounce=function(func,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;func.apply(context,args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;return memo=func.apply(this,arguments);};};_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments,0));return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){return _.map(obj,_.identity);};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){obj[prop]=source[prop];}});return obj;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual&&_.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&_.isFunction(b.isEqual))return b.isEqual(a);var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=stack.length;while(length--){if(stack[length]==a)return true;}
stack.push(a);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break;}}}else{if('constructor'in a!='constructor'in b||a.constructor!=b.constructor)return false;for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],stack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
stack.pop();return result;}
_.isEqual=function(a,b){return eq(a,b,[]);};_.isEmpty=function(obj){if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType==1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};_.isArguments=function(obj){return toString.call(obj)=='[object Arguments]';};if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
_.isFunction=function(obj){return toString.call(obj)=='[object Function]';};_.isString=function(obj){return toString.call(obj)=='[object String]';};_.isNumber=function(obj){return toString.call(obj)=='[object Number]';};_.isNaN=function(obj){return obj!==obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isDate=function(obj){return toString.call(obj)=='[object Date]';};_.isRegExp=function(obj){return toString.call(obj)=='[object RegExp]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.escape=function(string){return(''+string).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;');};_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name]);});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/.^/;var unescape=function(code){return code.replace(/\\\\/g,'\\').replace(/\\'/g,"'");};_.template=function(str,data){var c=_.templateSettings;var tmpl='var __p=[],print=function(){__p.push.apply(__p,arguments);};'+'with(obj||{}){__p.push(\''+
str.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(c.escape||noMatch,function(match,code){return"',_.escape("+unescape(code)+"),'";}).replace(c.interpolate||noMatch,function(match,code){return"',"+unescape(code)+",'";}).replace(c.evaluate||noMatch,function(match,code){return"');"+unescape(code).replace(/[\r\n\t]/g,' ')+";__p.push('";}).replace(/\r/g,'\\r').replace(/\n/g,'\\n').replace(/\t/g,'\\t')
+"');}return __p.join('');";var func=new Function('obj','_',tmpl);if(data)return func(data,_);return function(data){return func.call(this,data,_);};};_.chain=function(obj){return _(obj).chain();};var wrapper=function(obj){this._wrapped=obj;};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj;};var addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);unshift.call(args,this._wrapped);return result(func.apply(_,args),this._chain);};};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){var wrapped=this._wrapped;method.apply(wrapped,arguments);var length=wrapped.length;if((name=='shift'||name=='splice')&&length===0)delete wrapped[0];return result(wrapped,this._chain);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain);};});wrapper.prototype.chain=function(){this._chain=true;return this;};wrapper.prototype.value=function(){return this._wrapped;};}).call(this);;(function(root){'use strict';var nativeTrim=String.prototype.trim;var parseNumber=function(source){return source*1||0;};var strRepeat=function(i,m){for(var o=[];m>0;o[--m]=i){}
return o.join('');};var slice=function(a){return Array.prototype.slice.call(a);};var defaultToWhiteSpace=function(characters){if(characters){return _s.escapeRegExp(characters);}
return'\\s';};var sArgs=function(method){return function(){var args=slice(arguments);for(var i=0;i<args.length;i++)
args[i]=args[i]==null?'':''+args[i];return method.apply(null,args);};};var sprintf=(function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase();}
var str_repeat=strRepeat;var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0]);}
return str_format.format.call(null,str_format.cache[arguments[0]],arguments);};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type='',arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==='string'){output.push(parse_tree[i]);}
else if(node_type==='array'){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw new Error(sprintf('[_.sprintf] property "%s" does not exist',match[2][k]));}
arg=arg[match[2][k]];}}else if(match[1]){arg=argv[match[1]];}
else{arg=argv[cursor++];}
if(/[^s]/.test(match[8])&&(get_type(arg)!='number')){throw new Error(sprintf('[_.sprintf] expecting number but found %s',get_type(arg)));}
switch(match[8]){case'b':arg=arg.toString(2);break;case'c':arg=String.fromCharCode(arg);break;case'd':arg=parseInt(arg,10);break;case'e':arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case'f':arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case'o':arg=arg.toString(8);break;case's':arg=((arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg);break;case'u':arg=Math.abs(arg);break;case'x':arg=arg.toString(16);break;case'X':arg=arg.toString(16).toUpperCase();break;}
arg=(/[def]/.test(match[8])&&match[3]&&arg>=0?'+'+arg:arg);pad_character=match[4]?match[4]=='0'?'0':match[4].charAt(1):' ';pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):'';output.push(match[5]?arg+pad:pad+arg);}}
return output.join('');};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0]);}
else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push('%');}
else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==''){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else{throw new Error('[_.sprintf] huh?');}}}
else{throw new Error('[_.sprintf] huh?');}
match[2]=field_list;}
else{arg_names|=2;}
if(arg_names===3){throw new Error('[_.sprintf] mixing positional and named placeholders is not (yet) supported');}
parse_tree.push(match);}
else{throw new Error('[_.sprintf] huh?');}
_fmt=_fmt.substring(match[0].length);}
return parse_tree;};return str_format;})();var _s={VERSION:'1.2.0',isBlank:sArgs(function(str){return(/^\s*$/).test(str);}),stripTags:sArgs(function(str){return str.replace(/<\/?[^>]+>/ig,'');}),capitalize:sArgs(function(str){return str.charAt(0).toUpperCase()+str.substring(1).toLowerCase();}),chop:sArgs(function(str,step){step=parseNumber(step)||str.length;var arr=[];for(var i=0;i<str.length;){arr.push(str.slice(i,i+step));i=i+step;}
return arr;}),clean:sArgs(function(str){return _s.strip(str.replace(/\s+/g,' '));}),count:sArgs(function(str,substr){var count=0,index;for(var i=0;i<str.length;){index=str.indexOf(substr,i);index>=0&&count++;i=i+(index>=0?index:0)+substr.length;}
return count;}),chars:sArgs(function(str){return str.split('');}),escapeHTML:sArgs(function(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,"&apos;");}),unescapeHTML:sArgs(function(str){return str.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,'&');}),escapeRegExp:sArgs(function(str){return str.replace(/([-.*+?^${}()|[\]\/\\])/g,'\\$1');}),insert:sArgs(function(str,i,substr){var arr=str.split('');arr.splice(parseNumber(i),0,substr);return arr.join('');}),include:sArgs(function(str,needle){return str.indexOf(needle)!==-1;}),join:sArgs(function(sep){var args=slice(arguments);return args.join(args.shift());}),lines:sArgs(function(str){return str.split("\n");}),reverse:sArgs(function(str){return Array.prototype.reverse.apply(String(str).split('')).join('');}),splice:sArgs(function(str,i,howmany,substr){var arr=str.split('');arr.splice(parseNumber(i),parseNumber(howmany),substr);return arr.join('');}),startsWith:sArgs(function(str,starts){return str.length>=starts.length&&str.substring(0,starts.length)===starts;}),endsWith:sArgs(function(str,ends){return str.length>=ends.length&&str.substring(str.length-ends.length)===ends;}),succ:sArgs(function(str){var arr=str.split('');arr.splice(str.length-1,1,String.fromCharCode(str.charCodeAt(str.length-1)+1));return arr.join('');}),titleize:sArgs(function(str){var arr=str.split(' '),word;for(var i=0;i<arr.length;i++){word=arr[i].split('');if(typeof word[0]!=='undefined')word[0]=word[0].toUpperCase();i+1===arr.length?arr[i]=word.join(''):arr[i]=word.join('')+' ';}
return arr.join('');}),camelize:sArgs(function(str){return _s.trim(str).replace(/(\-|_|\s)+(.)?/g,function(match,separator,chr){return chr?chr.toUpperCase():'';});}),underscored:function(str){return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g,'$1_$2').replace(/\-|\s+/g,'_').toLowerCase();},dasherize:function(str){return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g,'$1-$2').replace(/^([A-Z]+)/,'-$1').replace(/\_|\s+/g,'-').toLowerCase();},humanize:function(str){return _s.capitalize(this.underscored(str).replace(/_id$/,'').replace(/_/g,' '));},trim:sArgs(function(str,characters){if(!characters&&nativeTrim){return nativeTrim.call(str);}
characters=defaultToWhiteSpace(characters);return str.replace(new RegExp('\^['+characters+']+|['+characters+']+$','g'),'');}),ltrim:sArgs(function(str,characters){characters=defaultToWhiteSpace(characters);return str.replace(new RegExp('\^['+characters+']+','g'),'');}),rtrim:sArgs(function(str,characters){characters=defaultToWhiteSpace(characters);return str.replace(new RegExp('['+characters+']+$','g'),'');}),truncate:sArgs(function(str,length,truncateStr){truncateStr=truncateStr||'...';length=parseNumber(length);return str.length>length?str.slice(0,length)+truncateStr:str;}),prune:sArgs(function(str,length,pruneStr){pruneStr=pruneStr||'...';length=parseNumber(length);var pruned='';if(str.substring(length-1,length+1).search(/^\w\w$/)===0)
pruned=_s.rtrim(str.slice(0,length).replace(/([\W][\w]*)$/,''));else
pruned=_s.rtrim(str.slice(0,length));pruned=pruned.replace(/\W+$/,'');return(pruned.length+pruneStr.length>str.length)?str:pruned+pruneStr;}),words:function(str,delimiter){return String(str).split(delimiter||" ");},pad:sArgs(function(str,length,padStr,type){var padding='',padlen=0;length=parseNumber(length);if(!padStr){padStr=' ';}
else if(padStr.length>1){padStr=padStr.charAt(0);}
switch(type){case'right':padlen=(length-str.length);padding=strRepeat(padStr,padlen);str=str+padding;break;case'both':padlen=(length-str.length);padding={'left':strRepeat(padStr,Math.ceil(padlen/2)),'right':strRepeat(padStr,Math.floor(padlen/2))};str=padding.left+str+padding.right;break;default:padlen=(length-str.length);padding=strRepeat(padStr,padlen);;str=padding+str;}
return str;}),lpad:function(str,length,padStr){return _s.pad(str,length,padStr);},rpad:function(str,length,padStr){return _s.pad(str,length,padStr,'right');},lrpad:function(str,length,padStr){return _s.pad(str,length,padStr,'both');},sprintf:sprintf,vsprintf:function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv);},toNumber:function(str,decimals){var num=parseNumber(parseNumber(str).toFixed(parseNumber(decimals)));return(!(num===0&&(str!=="0"&&str!==0)))?num:Number.NaN;},strRight:sArgs(function(sourceStr,sep){var pos=(!sep)?-1:sourceStr.indexOf(sep);return(pos!=-1)?sourceStr.slice(pos+sep.length,sourceStr.length):sourceStr;}),strRightBack:sArgs(function(sourceStr,sep){var pos=(!sep)?-1:sourceStr.lastIndexOf(sep);return(pos!=-1)?sourceStr.slice(pos+sep.length,sourceStr.length):sourceStr;}),strLeft:sArgs(function(sourceStr,sep){var pos=(!sep)?-1:sourceStr.indexOf(sep);return(pos!=-1)?sourceStr.slice(0,pos):sourceStr;}),strLeftBack:sArgs(function(sourceStr,sep){var pos=sourceStr.lastIndexOf(sep);return(pos!=-1)?sourceStr.slice(0,pos):sourceStr;}),exports:function(){var result={};for(var prop in this){if(!this.hasOwnProperty(prop)||prop=='include'||prop=='contains'||prop=='reverse')continue;result[prop]=this[prop];}
return result;}};_s.strip=_s.trim;_s.lstrip=_s.ltrim;_s.rstrip=_s.rtrim;_s.center=_s.lrpad;_s.ljust=_s.lpad;_s.rjust=_s.rpad;_s.contains=_s.include;if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){module.exports=_s;}
exports._s=_s;}else if(typeof root._!=='undefined'){root._.string=_s;root._.str=root._.string;}else{root._={string:_s,str:_s};}}(this||window));;(function(){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='0.9.2';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');var $=root.jQuery||root.Zepto||root.ender;Backbone.setDomLibrary=function(lib){$=lib;};Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node};}
return this;},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this;}
events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if((callback&&cb!==callback)||(context&&ctx!==context)){this.on(event,cb,ctx);}}}
return this;},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest);}}
if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args);}}}
return this;}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,'defaults')){attributes=_.extend({},defaults,attributes);}
if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId('c');this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},get:function(attr){return this.attributes[attr];},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?'':''+val);},has:function(attr){return this.get(attr)!=null;},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||(options.unset&&_.has(now,attr))){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true;}
options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||(_.has(now,attr)!=_.has(prev,attr))){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true;}else{delete this.changed[attr];delete this._pending[attr];}}
if(!options.silent)this.change(options);return this;},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options);},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options);},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp);};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes);}
var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false;}
var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs);}
if(!model.set(serverAttrs,options))return false;if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?'create':'update';var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger('destroy',model,model.collection,options);};if(this.isNew()){triggerDestroy();return false;}
options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,'delete',this,options);if(!options.wait)triggerDestroy();return xhr;},url:function(){var base=getValue(this,'urlRoot')||getValue(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,xhr){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger('change:'+attr,this,this.get(attr),options);}
if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger('change',this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr];}
this._previousAttributes=_.clone(this.attributes);}
this._changing=false;return this;},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},isValid:function(){return!this.validate(this.attributes);},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options);}else{this.trigger('error',this,error,options);}
return false;}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse});};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection");}
cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||((id!=null)&&(ids[id]||this._byId[id]))){dups.push(i);continue;}
cids[cid]=ids[id]=model;}
i=dups.length;while(i--){models.splice(dups[i],1);}
for(i=0,length=models.length;i<length;i++){(model=models[i]).on('all',this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger('add',model,this,options);}
return this;},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return this;},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model;},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model;},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id];},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid];},at:function(index){return this.models[index];},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},sort:function(options){options||(options={});if(!this.comparator)throw new Error('Cannot sort a set without a comparator');var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator);}else{this.models.sort(boundComparator);}
if(!options.silent)this.trigger('reset',this,options);return this;},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr);});},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return this;},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?'add':'reset'](collection.parse(resp,xhr),options);if(success)success(collection,resp);};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp);}else{nextModel.trigger('sync',model,resp,options);}};model.save(null,options);return model;},parse:function(resp,xhr){return resp;},chain:function(){return _(this.models).chain();},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={};},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false;}else if(!model.collection){model.collection=this;}
return model;},_removeReference:function(model){if(this==model.collection){delete model.collection;}
model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event=='add'||event=='remove')&&collection!=this)return;if(event=='destroy'){this.remove(model,options);}
if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','reduce','reduceRight','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','sortBy','sortedIndex','toArray','size','first','initial','rest','last','without','indexOf','shuffle','lastIndexOf','isEmpty','groupBy'];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)));};});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,['route:'+name].concat(args));Backbone.history.trigger('route',this,name,args);},this));return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]]);}
for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(namedParam,'([^\/]+)').replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1);}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search;}else{fragment=this.getHash();}}
if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:'/'},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){$(window).bind('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){$(window).bind('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+'#'+this.fragment);return true;}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');window.history.replaceState({},document.title,loc.protocol+'//'+loc.host+this.options.root+this.fragment);}
if(!this.options.silent){return this.loadUrl();}},stop:function(){$(window).unbind('popstate',this.checkUrl).unbind('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash());},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});return matched;},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||'').replace(routeStripper,'');if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?'replaceState':'pushState']({},document.title,frag);}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&(frag!=this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace);}}else{window.location.assign(this.options.root+fragment);}
if(options.trigger)this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,'')+'#'+fragment);}else{location.hash=fragment;}}});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();return this;},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content)$(el).html(content);return el;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=(element instanceof $)?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=getValue(this,'events'))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.bind(eventName,method);}else{this.$el.delegate(selector,eventName,method);}}},undelegateEvents:function(){this.$el.unbind('.delegateEvents'+this.cid);},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr];}
this.options=options;},_ensureElement:function(){if(!this.el){var attrs=getValue(this,'attributes')||{};if(this.id)attrs.id=this.id;if(this.className)attrs['class']=this.className;this.setElement(this.make(this.tagName,attrs),false);}else{this.setElement(this.el,false);}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child;};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={'create':'POST','update':'PUT','delete':'DELETE','read':'GET'};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:'json'};if(!options.url){params.url=getValue(model,'url')||urlError();}
if(!options.data&&model&&(method=='create'||method=='update')){params.contentType='application/json';params.data=JSON.stringify(model.toJSON());}
if(Backbone.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(Backbone.emulateHTTP){if(type==='PUT'||type==='DELETE'){if(Backbone.emulateJSON)params.data._method=type;params.type='POST';params.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);};}}
if(params.type!=='GET'&&!Backbone.emulateJSON){params.processData=false;}
return $.ajax(_.extend(params,options));};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options);}else{originalModel.trigger('error',originalModel,resp,options);}};};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty('constructor')){child=protoProps.constructor;}else{child=function(){parent.apply(this,arguments);};}
_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor();if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child;};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop];};var urlError=function(){throw new Error('A "url" property or function must be specified');};}).call(this);;﻿
(function($){$.cleditor={defaultOptions:{width:500,height:250,controls:"bold italic underline strikethrough subscript superscript | font size "+"style | color highlight removeformat | bullets numbering | outdent "+"indent | alignleft center alignright justify | undo redo | "+"rule image link unlink | cut copy paste pastetext | print source",colors:"FFF FCC FC9 FF9 FFC 9F9 9FF CFF CCF FCF "+"CCC F66 F96 FF6 FF3 6F9 3FF 6FF 99F F9F "+"BBB F00 F90 FC6 FF0 3F3 6CC 3CF 66C C6C "+"999 C00 F60 FC3 FC0 3C0 0CC 36F 63F C3C "+"666 900 C60 C93 990 090 399 33F 60C 939 "+"333 600 930 963 660 060 366 009 339 636 "+"000 300 630 633 330 030 033 006 309 303",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Narrow,Garamond,"+"Georgia,Impact,Sans Serif,Serif,Tahoma,Trebuchet MS,Verdana",sizes:"1,2,3,4,5,6,7",styles:[["Paragraph","<p>"],["Header 1","<h1>"],["Header 2","<h2>"],["Header 3","<h3>"],["Header 4","<h4>"],["Header 5","<h5>"],["Header 6","<h6>"]],useCSS:false,docType:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',docCSSFile:"",bodyStyle:"margin:4px; color:#4c4c4c; font-size:13px; font-family:\"Lucida Grande\",Helvetica,Verdana,Arial,sans-serif; cursor:text"},buttons:{init:"bold,,|"+"italic,,|"+"underline,,|"+"strikethrough,,|"+"subscript,,|"+"superscript,,|"+"font,,fontname,|"+"size,Font Size,fontsize,|"+"style,,formatblock,|"+"color,Font Color,forecolor,|"+"highlight,Text Highlight Color,hilitecolor,color|"+"removeformat,Remove Formatting,|"+"bullets,,insertunorderedlist|"+"numbering,,insertorderedlist|"+"outdent,,|"+"indent,,|"+"alignleft,Align Text Left,justifyleft|"+"center,,justifycenter|"+"alignright,Align Text Right,justifyright|"+"justify,,justifyfull|"+"undo,,|"+"redo,,|"+"rule,Insert Horizontal Rule,inserthorizontalrule|"+"image,Insert Image,insertimage,url|"+"link,Insert Hyperlink,createlink,url|"+"unlink,Remove Hyperlink,|"+"cut,,|"+"copy,,|"+"paste,,|"+"pastetext,Paste as Text,inserthtml,|"+"print,,|"+"source,Show Source"},imagesPath:function(){return imagesPath();}};$.fn.cleditor=function(options){var $result=$([]);this.each(function(idx,elem){if(elem.tagName=="TEXTAREA"){var data=$.data(elem,CLEDITOR);if(!data)data=new cleditor(elem,options);$result=$result.add(data);}});return $result;};var
BACKGROUND_COLOR="backgroundColor",BUTTON="button",BUTTON_NAME="buttonName",CHANGE="change",CLEDITOR="cleditor",CLICK="click",DISABLED="disabled",DIV_TAG="<div>",TRANSPARENT="transparent",UNSELECTABLE="unselectable",MAIN_CLASS="cleditorMain",TOOLBAR_CLASS="cleditorToolbar",GROUP_CLASS="cleditorGroup",BUTTON_CLASS="cleditorButton",DISABLED_CLASS="cleditorDisabled",DIVIDER_CLASS="cleditorDivider",POPUP_CLASS="cleditorPopup",LIST_CLASS="cleditorList",COLOR_CLASS="cleditorColor",PROMPT_CLASS="cleditorPrompt",MSG_CLASS="cleditorMsg",ie=$.browser.msie,ie6=/msie\s6/i.test(navigator.userAgent),iOS=/iphone|ipad|ipod/i.test(navigator.userAgent),popups={},documentClickAssigned,buttons=$.cleditor.buttons;$.each(buttons.init.split("|"),function(idx,button){var items=button.split(","),name=items[0];buttons[name]={stripIndex:idx,name:name,title:items[1]===""?name.charAt(0).toUpperCase()+name.substr(1):items[1],command:items[2]===""?name:items[2],popupName:items[3]===""?name:items[3]};});delete buttons.init;cleditor=function(area,options){var editor=this;editor.options=options=$.extend({},$.cleditor.defaultOptions,options);var $area=editor.$area=$(area).hide().data(CLEDITOR,editor).blur(function(){updateFrame(editor,true);});var $main=editor.$main=$(DIV_TAG).addClass(MAIN_CLASS).width(options.width).height(options.height);var $toolbar=editor.$toolbar=$(DIV_TAG).addClass(TOOLBAR_CLASS).appendTo($main);var $group=$(DIV_TAG).addClass(GROUP_CLASS).appendTo($toolbar);$.each(options.controls.split(" "),function(idx,buttonName){if(buttonName==="")return true;if(buttonName=="|"){var $div=$(DIV_TAG).addClass(DIVIDER_CLASS).appendTo($group);$group=$(DIV_TAG).addClass(GROUP_CLASS).appendTo($toolbar);}
else{var button=buttons[buttonName];var $buttonDiv=$(DIV_TAG).data(BUTTON_NAME,button.name).addClass(BUTTON_CLASS).attr("title",button.title).bind(CLICK,$.proxy(buttonClick,editor)).appendTo($group).hover(hoverEnter,hoverLeave);var map={};if(button.css)map=button.css;else if(button.image)map.backgroundImage=imageUrl(button.image);if(button.stripIndex)map.backgroundPosition=button.stripIndex*-24;$buttonDiv.css(map);if(ie)
$buttonDiv.attr(UNSELECTABLE,"on");if(button.popupName)
createPopup(button.popupName,options,button.popupClass,button.popupContent,button.popupHover);}});$main.insertBefore($area).append($area);if(!documentClickAssigned){$(document).click(function(e){var $target=$(e.target);if(!$target.add($target.parents()).is("."+PROMPT_CLASS))
hidePopups();});documentClickAssigned=true;}
if(/auto|%/.test(""+options.width+options.height))
$(window).resize(function(){if(editor.$main.parent().parent().size()){refresh(editor);}});refresh(editor);};var fn=cleditor.prototype,methods=[["clear",clear],["disable",disable],["execCommand",execCommand],["focus",focus],["hidePopups",hidePopups],["sourceMode",sourceMode,true],["refresh",refresh],["select",select],["selectedHTML",selectedHTML,true],["selectedText",selectedText,true],["showMessage",showMessage],["updateFrame",updateFrame],["updateTextArea",updateTextArea]];$.each(methods,function(idx,method){fn[method[0]]=function(){var editor=this,args=[editor];for(var x=0;x<arguments.length;x++){args.push(arguments[x]);}
var result=method[1].apply(editor,args);if(method[2])return result;return editor;};});fn.change=function(handler){var $this=$(this);return handler?$this.bind(CHANGE,handler):$this.trigger(CHANGE);};function buttonClick(e){var editor=this,buttonDiv=e.target,buttonName=$.data(buttonDiv,BUTTON_NAME),button=buttons[buttonName],popupName=button.popupName,popup=popups[popupName];if(editor.disabled||$(buttonDiv).attr(DISABLED)==DISABLED)
return;var data={editor:editor,button:buttonDiv,buttonName:buttonName,popup:popup,popupName:popupName,command:button.command,useCSS:editor.options.useCSS};if(button.buttonClick&&button.buttonClick(e,data)===false)
return false;if(buttonName=="source"){if(sourceMode(editor)){delete editor.range;editor.$area.hide();editor.$frame.show();buttonDiv.title=button.title;}
else{editor.$frame.hide();editor.$area.show();buttonDiv.title="Show Rich Text";}
setTimeout(function(){refreshButtons(editor);},100);}
else if(!sourceMode(editor)){if(popupName){var $popup=$(popup);if(popupName=="url"){if(buttonName=="link"&&selectedText(editor)===""){showMessage(editor,"A selection is required when inserting a link.",buttonDiv);return false;}
$popup.children(":button").unbind(CLICK).bind(CLICK,function(){var $text=$popup.find(":text"),url=$.trim($text.val());if(url!=="")
execCommand(editor,data.command,url,null,data.button);$text.val("http://");hidePopups();focus(editor);});}
else if(popupName=="pastetext"){$popup.children(":button").unbind(CLICK).bind(CLICK,function(){var $textarea=$popup.find("textarea"),text=$textarea.val().replace(/\n/g,"<br />");if(text!=="")
execCommand(editor,data.command,text,null,data.button);$textarea.val("");hidePopups();focus(editor);});}
if(buttonDiv!==$.data(popup,BUTTON)){showPopup(editor,popup,buttonDiv);return false;}
return;}
else if(buttonName=="print")
editor.$frame[0].contentWindow.print();else if(!execCommand(editor,data.command,data.value,data.useCSS,buttonDiv))
return false;}
focus(editor);}
function hoverEnter(e){var $div=$(e.target).closest("div");$div.css(BACKGROUND_COLOR,$div.data(BUTTON_NAME)?"#FFF":"#FFC");}
function hoverLeave(e){$(e.target).closest("div").css(BACKGROUND_COLOR,"transparent");}
function popupClick(e){var editor=this,popup=e.data.popup,target=e.target;if(popup===popups.msg||$(popup).hasClass(PROMPT_CLASS))
return;var buttonDiv=$.data(popup,BUTTON),buttonName=$.data(buttonDiv,BUTTON_NAME),button=buttons[buttonName],command=button.command,value,useCSS=editor.options.useCSS;if(buttonName=="font")
value=target.style.fontFamily.replace(/"/g,"");else if(buttonName=="size"){if(target.tagName=="DIV")
target=target.children[0];value=target.innerHTML;}
else if(buttonName=="style")
value="<"+target.tagName+">";else if(buttonName=="color")
value=hex(target.style.backgroundColor);else if(buttonName=="highlight"){value=hex(target.style.backgroundColor);if(ie)command='backcolor';else useCSS=true;}
var data={editor:editor,button:buttonDiv,buttonName:buttonName,popup:popup,popupName:button.popupName,command:command,value:value,useCSS:useCSS};if(button.popupClick&&button.popupClick(e,data)===false)
return;if(data.command&&!execCommand(editor,data.command,data.value,data.useCSS,buttonDiv))
return false;hidePopups();focus(editor);}
function checksum(text)
{var a=1,b=0;for(var index=0;index<text.length;++index){a=(a+text.charCodeAt(index))%65521;b=(b+a)%65521;}
return(b<<16)|a;}
function clear(editor){editor.$area.val("");updateFrame(editor);}
function createPopup(popupName,options,popupTypeClass,popupContent,popupHover){if(popups[popupName])
return popups[popupName];var $popup=$(DIV_TAG).hide().addClass(POPUP_CLASS).appendTo("body");if(popupContent)
$popup.html(popupContent);else if(popupName=="color"){var colors=options.colors.split(" ");if(colors.length<10)
$popup.width("auto");$.each(colors,function(idx,color){$(DIV_TAG).appendTo($popup).css(BACKGROUND_COLOR,"#"+color);});popupTypeClass=COLOR_CLASS;}
else if(popupName=="font")
$.each(options.fonts.split(","),function(idx,font){$(DIV_TAG).appendTo($popup).css("fontFamily",font).html(font);});else if(popupName=="size")
$.each(options.sizes.split(","),function(idx,size){$(DIV_TAG).appendTo($popup).html("<font size="+size+">"+size+"</font>");});else if(popupName=="style")
$.each(options.styles,function(idx,style){$(DIV_TAG).appendTo($popup).html(style[1]+style[0]+style[1].replace("<","</"));});else if(popupName=="url"){$popup.html('Enter URL:<br><input type=text value="http://" size=35><br><input type=button value="Submit">');popupTypeClass=PROMPT_CLASS;}
else if(popupName=="pastetext"){$popup.html('Paste your content here and click submit.<br /><textarea cols=40 rows=3></textarea><br /><input type=button value=Submit>');popupTypeClass=PROMPT_CLASS;}
if(!popupTypeClass&&!popupContent)
popupTypeClass=LIST_CLASS;$popup.addClass(popupTypeClass);if(ie){$popup.attr(UNSELECTABLE,"on").find("div,font,p,h1,h2,h3,h4,h5,h6").attr(UNSELECTABLE,"on");}
if($popup.hasClass(LIST_CLASS)||popupHover===true)
$popup.children().hover(hoverEnter,hoverLeave);popups[popupName]=$popup[0];return $popup[0];}
function disable(editor,disabled){if(disabled){editor.$area.attr(DISABLED,DISABLED);editor.disabled=true;}
else{editor.$area.removeAttr(DISABLED);delete editor.disabled;}
try{if(ie)editor.doc.body.contentEditable=!disabled;else editor.doc.designMode=!disabled?"on":"off";}
catch(err){}
refreshButtons(editor);}
function execCommand(editor,command,value,useCSS,button){restoreRange(editor);if(!ie){if(useCSS===undefined||useCSS===null)
useCSS=editor.options.useCSS;editor.doc.execCommand("styleWithCSS",0,useCSS.toString());}
var success=true,description;if(ie&&command.toLowerCase()=="inserthtml")
getRange(editor).pasteHTML(value);else{try{success=editor.doc.execCommand(command,0,value||null);}
catch(err){description=err.description;success=false;}
if(!success){if("cutcopypaste".indexOf(command)>-1)
showMessage(editor,"For security reasons, your browser does not support the "+
command+" command. Try using the keyboard shortcut or context menu instead.",button);else
showMessage(editor,(description?description:"Error executing the "+command+" command."),button);}}
refreshButtons(editor);return success;}
function focus(editor){setTimeout(function(){if(sourceMode(editor))editor.$area.focus();else editor.$frame[0].contentWindow.focus();refreshButtons(editor);},0);}
function getRange(editor){if(ie)return getSelection(editor).createRange();return getSelection(editor).getRangeAt(0);}
function getSelection(editor){if(ie)return editor.doc.selection;return editor.$frame[0].contentWindow.getSelection();}
function hex(s){var m=/rgba?\((\d+), (\d+), (\d+)/.exec(s),c=s.split("");if(m){s=(m[1]<<16|m[2]<<8|m[3]).toString(16);while(s.length<6)
s="0"+s;}
return"#"+(s.length==6?s:c[1]+c[1]+c[2]+c[2]+c[3]+c[3]);}
function hidePopups(){$.each(popups,function(idx,popup){$(popup).hide().unbind(CLICK).removeData(BUTTON);});}
function imagesPath(){var cssFile="jquery.cleditor.css",href=$("link[href$='"+cssFile+"']").attr("href");return href.substr(0,href.length-cssFile.length)+"images/";}
function imageUrl(filename){return"url("+imagesPath()+filename+")";}
function refresh(editor){var $main=editor.$main,options=editor.options;if(editor.$frame)
editor.$frame.remove();var $frame=editor.$frame=$('<iframe frameborder="0" src="javascript:true;">').hide().appendTo($main);var contentWindow=$frame[0].contentWindow,doc=editor.doc=contentWindow.document,$doc=$(doc);doc.open();doc.write(options.docType+'<html>'+
((options.docCSSFile==='')?'':'<head><link rel="stylesheet" type="text/css" href="'+options.docCSSFile+'" /></head>')+'<body style="'+options.bodyStyle+'"></body></html>');doc.close();if(ie)
$doc.click(function(){focus(editor);});updateFrame(editor);if(ie){$doc.bind("beforedeactivate beforeactivate selectionchange keypress",function(e){if(e.type=="beforedeactivate")
editor.inactive=true;else if(e.type=="beforeactivate"){if(!editor.inactive&&editor.range&&editor.range.length>1)
editor.range.shift();delete editor.inactive;}
else if(!editor.inactive){if(!editor.range)
editor.range=[];editor.range.unshift(getRange(editor));while(editor.range.length>2)
editor.range.pop();}});$frame.focus(function(){restoreRange(editor);});}
($.browser.mozilla?$doc:$(contentWindow)).blur(function(){updateTextArea(editor,true);});$doc.click(hidePopups).bind("keyup mouseup",function(){refreshButtons(editor);});if(iOS)editor.$area.show();else $frame.show();$(function(){var $toolbar=editor.$toolbar,$group=$toolbar.children("div:last"),wid=/%/.test(""+options.width)?options.width:$main.width();var hgt=$group.offset().top+$group.outerHeight()-$toolbar.offset().top+1;$toolbar.height(hgt);hgt=(/%/.test(""+options.height)?$main.height():parseInt(options.height))-hgt;$frame.width(wid).height(hgt);editor.$area.width(wid).height(ie6?hgt-2:hgt);disable(editor,editor.disabled);refreshButtons(editor);});}
function refreshButtons(editor){if(!iOS&&$.browser.webkit&&!editor.focused){editor.$frame[0].contentWindow.focus();window.focus();editor.focused=true;}
var queryObj=editor.doc;if(ie)queryObj=getRange(editor);var inSourceMode=sourceMode(editor);$.each(editor.$toolbar.find("."+BUTTON_CLASS),function(idx,elem){var $elem=$(elem),button=$.cleditor.buttons[$.data(elem,BUTTON_NAME)],command=button.command,enabled=true;if(editor.disabled)
enabled=false;else if(button.getEnabled){var data={editor:editor,button:elem,buttonName:button.name,popup:popups[button.popupName],popupName:button.popupName,command:button.command,useCSS:editor.options.useCSS};enabled=button.getEnabled(data);if(enabled===undefined)
enabled=true;}
else if(((inSourceMode||iOS)&&button.name!="source")||(ie&&(command=="undo"||command=="redo")))
enabled=false;else if(command&&command!="print"){if(ie&&command=="hilitecolor")
command="backcolor";if(!ie||command!="inserthtml"){try{enabled=queryObj.queryCommandEnabled(command);}
catch(err){enabled=false;}}}
if(enabled){$elem.removeClass(DISABLED_CLASS);$elem.removeAttr(DISABLED);}
else{$elem.addClass(DISABLED_CLASS);$elem.attr(DISABLED,DISABLED);}});}
function restoreRange(editor){if(ie&&editor.range)
editor.range[0].select();}
function select(editor){setTimeout(function(){if(sourceMode(editor))editor.$area.select();else execCommand(editor,"selectall");},0);}
function selectedHTML(editor){restoreRange(editor);var range=getRange(editor);if(ie)
return range.htmlText;var layer=$("<layer>")[0];layer.appendChild(range.cloneContents());var html=layer.innerHTML;layer=null;return html;}
function selectedText(editor){restoreRange(editor);if(ie)return getRange(editor).text;return getSelection(editor).toString();}
function showMessage(editor,message,button){var popup=createPopup("msg",editor.options,MSG_CLASS);popup.innerHTML=message;showPopup(editor,popup,button);}
function showPopup(editor,popup,button){var offset,left,top,$popup=$(popup);if(button){var $button=$(button);offset=$button.offset();left=--offset.left;top=offset.top+$button.height();}
else{var $toolbar=editor.$toolbar;offset=$toolbar.offset();left=Math.floor(($toolbar.width()-$popup.width())/2)+offset.left;top=offset.top+$toolbar.height()-2;}
hidePopups();$popup.css({left:left,top:top}).show();if(button){$.data(popup,BUTTON,button);$popup.bind(CLICK,{popup:popup},$.proxy(popupClick,editor));}
setTimeout(function(){$popup.find(":text,textarea").eq(0).focus().select();},100);}
function sourceMode(editor){return editor.$area.is(":visible");}
function updateFrame(editor,checkForChange){var code=editor.$area.val(),options=editor.options,updateFrameCallback=options.updateFrame,$body=$(editor.doc.body);if(updateFrameCallback){var sum=checksum(code);if(checkForChange&&editor.areaChecksum==sum)
return;editor.areaChecksum=sum;}
var html=updateFrameCallback?updateFrameCallback(code):code;html=html.replace(/<(?=\/?script)/ig,"&lt;");if(options.updateTextArea)
editor.frameChecksum=checksum(html);if(html!=$body.html()){$body.html(html);$(editor).triggerHandler(CHANGE);}}
function updateTextArea(editor,checkForChange){var html=$(editor.doc.body).html(),options=editor.options,updateTextAreaCallback=options.updateTextArea,$area=editor.$area;if(updateTextAreaCallback){var sum=checksum(html);if(checkForChange&&editor.frameChecksum==sum)
return;editor.frameChecksum=sum;}
var code=updateTextAreaCallback?updateTextAreaCallback(html):html;if(options.updateFrame)
editor.areaChecksum=checksum(code);if(code!=$area.val()){$area.val(code);$(editor).triggerHandler(CHANGE);}}})(jQuery);;var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.first=left;this.second=expression();advance('else');this.third=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("[uU]?'([^']*)'",'[uU]?"([^"]*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end=undefined;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');var initial=token[0];if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{value:(m[2]!==undefined?m[2]:m[3])}));}else if(token in symbols){var symbol;if(token==='in'&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var out=py.PY_call(py.object);for(var k in val){if(val.hasOwnProperty(k)){out[k]=val[k];}}
return out;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name),attr_name);};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];kwargs={};}else if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}else if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){var out={};for(var k in this){if(this.hasOwnProperty(k)&&!/^__/.test(k)){var val=this[k];out[k]=val.toJSON?val.toJSON():val;}}
return out;}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i],i));}
return t;}});py.list=py.tuple;py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k],k));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(expr.value);case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;(function(){if(this.openerp)
return;var session_counter=0;var openerp=this.openerp={instances:{},init:function(modules){if(modules===null){modules=[];}else{modules=_.union(['web'],modules||[]);}
var new_instance={_openerp:openerp,_session_id:"instance"+session_counter++,_modules:modules,web:{},web_mobile:{}};openerp.instances[new_instance._session_id]=new_instance;for(var i=0;i<modules.length;i++){new_instance[modules[i]]={};if(openerp[modules[i]]){openerp[modules[i]](new_instance,new_instance[modules[i]]);}}
return new_instance;}};})();openerp.web=function(session){var files=["pyeval","corelib","coresetup","dates","formats","chrome","data","views","search","list","form","list_editable","web_mobile","view_tree","data_export","data_import"];for(var i=0;i<files.length;i++){if(openerp.web[files[i]]){openerp.web[files[i]](session);}}};;openerp.testing={};(function(testing){var dependencies={pyeval:[],corelib:['pyeval'],coresetup:['corelib'],data:['corelib','coresetup'],dates:[],formats:['coresetup','dates'],chrome:['corelib','coresetup'],views:['corelib','coresetup','data','chrome'],search:['views','formats'],list:['views','data'],form:['data','views','list','formats'],list_editable:['list','form','data'],};testing.dependencies=window['oe_all_dependencies']||[];testing.current_module=null;testing.templates={};testing.add_template=function(name){var xhr=QWeb2.Engine.prototype.get_xhr();xhr.open('GET',name,false);xhr.send(null);(testing.templates[testing.current_module]=testing.templates[testing.current_module]||[]).push(xhr.responseXML);};testing.noop=function(){};testing.mockifyRPC=function(instance,responses){var session=instance.session;session.responses=responses||{};session.rpc_function=function(url,payload){var fn,params;var needle=payload.params.model+':'+payload.params.method;if(url.url==='/web/dataset/call_kw'&&needle in this.responses){fn=this.responses[needle];params=[payload.params.args||[],payload.params.kwargs||{}];}else{fn=this.responses[url.url];params=[payload];}
if(!fn){return $.Deferred().reject({},'failed',_.str.sprintf("Url %s not found in mock responses, with arguments %s",url.url,JSON.stringify(payload.params))).promise();}
try{return $.when(fn.apply(null,params)).then(function(result){return{result:result};});}catch(e){return $.Deferred().reject({},'failed',String(e));}};};var StackProto={execute:function(fn){var args=[].slice.call(arguments,1);var i=0,setups=this.setups,teardowns=this.teardowns;var d=$.Deferred();var succeeded,failed;var success=function(){succeeded=_.toArray(arguments);return teardown();};var failure=function(){if(!failed){failed=_.toArray(arguments);}
return teardown();};var setup=function(){if(i<setups.length){var f=setups[i]||testing.noop;$.when(f.apply(null,args)).then(function(){++i;setup();},failure);}else{$.when(fn.apply(null,args)).then(success,failure);}};var teardown=function(){if(i>0){var f=teardowns[--i]||testing.noop;$.when(f.apply(null,args)).then(teardown,failure);}else{if(failed){d.reject.apply(d,failed);}else if(succeeded){d.resolve.apply(d,succeeded);}else{throw new Error("Didn't succeed or fail?");}}};setup();return d;},push:function(setup,teardown){return _.extend(Object.create(StackProto),{setups:this.setups.concat([setup]),teardowns:this.teardowns.concat([teardown])});},unshift:function(setup,teardown){return _.extend(Object.create(StackProto),{setups:[setup].concat(this.setups),teardowns:[teardown].concat(this.teardowns)});}};testing.Stack=function(setup,teardown){return _.extend(Object.create(StackProto),{setups:setup?[setup]:[],teardowns:teardown?[teardown]:[]});};var db=window['oe_db_info'];testing.section=function(name,options,body){if(_.isFunction(options)){body=options;options={};}
_.defaults(options,{setup:testing.noop,teardown:testing.noop});QUnit.module(testing.current_module+'.'+name,{_oe:options});body(testing.case);};testing.case=function(name,options,callback){if(_.isFunction(options)){callback=options;options={};}
var module=testing.current_module;var module_index=_.indexOf(testing.dependencies,module);var module_deps=testing.dependencies.slice(0,module_index+1||undefined);var env=QUnit.config.currentModuleTestEnviroment;var case_stack=testing.Stack().push(env._oe.setup,env._oe.teardown).push(options.setup,options.teardown);var opts=_.defaults({},options,env._oe);if(opts.rpc==='rpc'&&!db){QUnit.config.autostart=false;db={source:null,supadmin:null,password:null};var $msg=$('<form style="margin: 0 1em 1em;">').append('<h3>A test needs to clone a database</h3>').append('<h4>Please provide the source clone information</h4>').append('     Source DB: ').append('<input name="source">').append('<br>').append('   DB Password: ').append('<input name="supadmin">').append('<br>').append('Admin Password: ').append('<input name="password">').append('<br>').append('<input type="submit" value="OK"/>').submit(function(e){e.preventDefault();e.stopPropagation();db.source=$msg.find('input[name=source]').val();db.supadmin=$msg.find('input[name=supadmin]').val();db.password=$msg.find('input[name=password]').val();QUnit.start();$.unblockUI();});$.blockUI({message:$msg,css:{fontFamily:'monospace',textAlign:'left',whiteSpace:'pre-wrap',cursor:'default'}});}
QUnit.test(name,function(){var instance;if(!opts.dependencies){instance=openerp.init(module_deps);}else{var d=opts.dependencies.slice();d.reverse();var di=0;while(di<d.length){var m=/^web\.(\w+)$/.exec(d[di]);if(m){d[di]=m[1];}
d.splice.apply(d,[di+1,0].concat(_(dependencies[d[di]]).reverse()));++di;}
instance=openerp.init(null);_(d).chain().reverse().uniq().each(function(module){openerp.web[module](instance);});}
if(instance.session){instance.session.uid=42;}
if(_.isNumber(opts.asserts)){expect(opts.asserts);}
if(opts.templates){for(var i=0;i<module_deps.length;++i){var dep=module_deps[i];var templates=testing.templates[dep];if(_.isEmpty(templates)){continue;}
for(var j=0;j<templates.length;++j){instance.web.qweb.add_template(templates[j]);}}}
var $fixture=$('#qunit-fixture');var mock,async=false;switch(opts.rpc){case'mock':async=true;testing.mockifyRPC(instance);mock=function(spec,handler){instance.session.responses[spec]=handler;};break;case'rpc':async=true;(function(){var dbname='test_'+Math.random().toString(36).slice(2);case_stack=case_stack.unshift(function(instance){instance.session.session_init=testing.noop;instance.session.load_modules=testing.noop;instance.session.session_bind();return instance.session.rpc('/web/database/duplicate',{fields:[{name:'super_admin_pwd',value:db.supadmin},{name:'db_original_name',value:db.source},{name:'db_name',value:dbname}]}).then(function(result){if(result.error){return $.Deferred().reject(result.error).promise();}
return instance.session.session_authenticate(dbname,'admin',db.password,true);});},function(instance){return instance.session.rpc('/web/database/drop',{fields:[{name:'drop_pwd',value:db.supadmin},{name:'drop_db',value:dbname}]}).then(function(result){if(result.error){return $.Deferred().reject(result.error).promise();}
return result;});});})();}
stop();var timeout;case_stack.execute(function(){var result=callback.apply(null,arguments);if(!(result&&_.isFunction(result.then))){if(async){ok(false,"asynchronous test cases must return a promise");}}else{if(!_.isNumber(opts.asserts)){ok(false,"asynchronous test cases must specify the "
+"number of assertions they expect");}}
return $.Deferred(function(d){$.when(result).then(function(){d.resolve.apply(d,arguments)},function(){d.reject.apply(d,arguments);});if(async||(result&&result.then)){timeout=setTimeout(function(){QUnit.config.semaphore=1;d.reject({message:"Test timed out"});},2000);}});},instance,$fixture,mock).always(function(){if(timeout){clearTimeout(timeout);}
start();}).fail(function(error){if(options.fail_on_rejection===false){return;}
var message;if(typeof error!=='object'||typeof error.message!=='string'){message=JSON.stringify([].slice.apply(arguments));}else{message=error.message;if(error.data&&error.data.debug){message+='\n\n'+error.data.debug;}}
ok(false,message);});});};})(openerp.testing);;openerp.web.pyeval=function(instance){instance.web.pyeval={};var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var divmod=function(a,b,fn){var mod=a%b;if(mod>0&&b<0||mod<0&&b>0){mod+=b;}
return fn(Math.floor(a/b),mod);};var modf=function(x,fn){var mod=x%1;if(mod<0){mod+=1;}
return fn(mod,Math.floor(x));};var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
var is_leap=function(year){return year%4===0&&(year%100!==0||year%400===0);};var days_before_year=function(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);};var days_in_month=function(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];};var days_before_month=function(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]
+(post_leap_feb?1:0);};var ymd2ord=function(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)
+days_before_month(year,month)
+day;};var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);var assert=function(bool){if(!bool){throw new Error("AssertionError");}};var ord2ymd=function(n){--n;var n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;})});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};};var tmxxx=function(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;})}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;})}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;})}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};};datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=modf(days,function(dayfrac,days){d=days;if(dayfrac){return modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,function(seconds,microseconds){divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;divmod(this.seconds,60,function(m,s){divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000)},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);})});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return this.__add__(other.__neg__());}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day])}});var context_today=function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);};datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'now'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,'* year month day hour minute second microsecond '
+'years months weeks days hours minutes secondes microseconds '
+'weekday leakdays yearday nlyearday');},__add__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=asJS(this.ops.year)||asJS(other.year);if(asJS(this.ops.years)){year+=asJS(this.ops.years);}
var month=asJS(this.ops.month)||asJS(other.month);if(asJS(this.ops.months)){month+=asJS(this.ops.months);while(month<1){year-=1;month+=12;}
while(month>12){year+=1;month-=12;}}
var lastMonthDay=new Date(year,month,0).getDate();var day=asJS(this.ops.day)||asJS(other.day);if(day>lastMonthDay){day=lastMonthDay;}
var days_offset=((asJS(this.ops.weeks)||0)*7)+(asJS(this.ops.days)||0);if(days_offset){day=new Date(year,month-1,day+days_offset).getDate();}
return py.PY_call(datetime.date,[py.float.fromJSON(year),py.float.fromJSON(month),py.float.fromJSON(day)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.date)){return py.NotImplemented;}
var year=asJS(this.ops.year)||asJS(other.year);if(asJS(this.ops.years)){year-=asJS(this.ops.years);}
var month=asJS(this.ops.month)||asJS(other.month);if(asJS(this.ops.months)){month-=asJS(this.ops.months);while(month<1){year-=1;month+=12;}
while(month>12){year+=1;month-=12;}}
var lastMonthDay=new Date(year,month,0).getDate();var day=asJS(this.ops.day)||asJS(other.day);if(day>lastMonthDay){day=lastMonthDay;}
var days_offset=((asJS(this.ops.weeks)||0)*7)+(asJS(this.ops.days)||0);if(days_offset){day=new Date(year,month-1,day-days_offset).getDate();}
return py.PY_call(datetime.date,[py.float.fromJSON(year),py.float.fromJSON(month),py.float.fromJSON(day)]);},__rsub__:function(other){return this.__sub__(other);}});var eval_contexts=function(contexts,evaluation_context){evaluation_context=evaluation_context||{};return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=py.dict.fromJSON(evaluation_context);evaluated=py.eval(ctx.__debug,evaluation_context);break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},_.extend({},instance.session.user_context));};var eval_domains=function(domains,evaluation_context){var result_domain=[];_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
switch(domain.__ref){case'domain':evaluation_context.context=py.dict.fromJSON(evaluation_context);result_domain.push.apply(result_domain,py.eval(domain.__debug,evaluation_context));break;case'compound_domain':var eval_context=eval_contexts([domain.__eval_context]);result_domain.push.apply(result_domain,eval_domains(domain.__domains,_.extend({},evaluation_context,eval_context)));break;default:result_domain.push.apply(result_domain,domain);}});return result_domain;};var eval_groupbys=function(contexts,evaluation_context){var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=py.dict.fromJSON(evaluation_context);evaluated=py.eval(ctx.__debug,evaluation_context);break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;};instance.web.pyeval.context=function(){return _.extend({datetime:datetime,context_today:context_today,time:time,relativedelta:relativedelta,current_date:py.PY_call(time.strftime,[py.str.fromJSON('%Y-%m-%d')]),},instance.session.user_context);};instance.web.pyeval.eval=function(type,object,context){context=_.extend(instance.web.pyeval.context(),context||{});context['context']=py.dict.fromJSON(context);switch(type){case'context':object=[object];case'contexts':return eval_contexts(object,context);case'domain':object=[object];case'domains':return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type)};var eval_arg=function(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':case'compound_domain':return instance.web.pyeval.eval('domains',[arg]);case'context':case'compound_context':return instance.web.pyeval.eval('contexts',[arg]);default:throw new Error(instance.web._t("Unknown nonliteral type "+arg.__ref));}};instance.web.pyeval.ensure_evaluated=function(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}};instance.web.pyeval.eval_domains_and_contexts=function(source){return new $.Deferred(function(d){setTimeout(function(){try{var contexts=([instance.session.user_context]||[]).concat(source.contexts);d.resolve({context:instance.web.pyeval.eval('contexts',contexts),domain:instance.web.pyeval.eval('domains',source.domains),group_by:instance.web.pyeval.eval('groupbys',source.group_by_seq||[])});}catch(e){d.resolve({error:{code:400,message:instance.web._t("Evaluation Error"),data:{type:'local_exception',debug:_.str.sprintf(instance.web._t("Local evaluation failure\n%s\n\n%s"),e.message,JSON.stringify(source))}}});}},0);});}};;openerp.web.corelib=function(instance){(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;instance.web.Class=function(){};instance.web.Class.extend=function(){var _super=this.prototype;var args=_.toArray(arguments);args.unshift({});var prop=_.extend.apply(_,args);initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}
function Class(){if(this.constructor!==instance.web.Class){throw new Error("You can only instanciate objects with the 'new' operator");return null;}
if(!initializing&&this.init){var ret=this.init.apply(this,arguments);if(ret){return ret;}}
return this;}
Class.include=function(properties){for(var name in properties){if(typeof properties[name]!=='function'||!fnTest.test(properties[name])){prototype[name]=properties[name];}else if(typeof prototype[name]==='function'&&prototype.hasOwnProperty(name)){prototype[name]=(function(name,fn,previous){return function(){var tmp=this._super;this._super=previous;var ret=fn.apply(this,arguments);this._super=tmp;return ret;}})(name,properties[name],prototype[name]);}else if(typeof _super[name]==='function'){prototype[name]=(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;}})(name,properties[name]);}}};Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class;};})();instance.web.ParentedMixin={__parentedMixin:true,init:function(){this.__parentedDestroyed=false;this.__parentedChildren=[];this.__parentedParent=null;},setParent:function(parent){if(this.getParent()){if(this.getParent().__parentedMixin){this.getParent().__parentedChildren=_.without(this.getParent().getChildren(),this);}}
this.__parentedParent=parent;if(parent&&parent.__parentedMixin){parent.__parentedChildren.push(this);}},getParent:function(){return this.__parentedParent;},getChildren:function(){return _.clone(this.__parentedChildren);},isDestroyed:function(){return this.__parentedDestroyed;},alive:function(promise,reject){var def=$.Deferred();var self=this;promise.done(function(){if(!self.isDestroyed()){if(!reject)
def.resolve.apply(def,arguments);else
def.reject();}}).fail(function(){if(!self.isDestroyed()){if(!reject)
def.reject.apply(def,arguments);else
def.reject();}});return def.promise();},destroy:function(){_.each(this.getChildren(),function(el){el.destroy();});this.setParent(undefined);this.__parentedDestroyed=true;}};var Events=instance.web.Class.extend({on:function(events,callback,context){var ev;events=events.split(/\s+/);var calls=this._callbacks||(this._callbacks={});while(ev=events.shift()){var list=calls[ev]||(calls[ev]={});var tail=list.tail||(list.tail=list.next={});tail.callback=callback;tail.context=context;list.tail=tail.next={};}
return this;},off:function(events,callback,context){var ev,calls,node;if(!events){delete this._callbacks;}else if(calls=this._callbacks){events=events.split(/\s+/);while(ev=events.shift()){node=calls[ev];delete calls[ev];if(!callback||!node)
continue;while((node=node.next)&&node.next){if(node.callback===callback&&(!context||node.context===context))
continue;this.on(ev,node.callback,node.context);}}}
return this;},callbackList:function(){var lst=[];_.each(this._callbacks||{},function(el,eventName){var node=el;while((node=node.next)&&node.next){lst.push([eventName,node.callback,node.context]);}});return lst;},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))
return this;all=calls['all'];(events=events.split(/\s+/)).push(null);while(event=events.shift()){if(all)
events.push({next:all.next,tail:all.tail,event:event});if(!(node=calls[event]))
continue;events.push({next:node.next,tail:node.tail});}
rest=Array.prototype.slice.call(arguments,1);while(node=events.pop()){tail=node.tail;args=node.event?[node.event].concat(rest):rest;while((node=node.next)!==tail){node.callback.apply(node.context||this,args);}}
return this;}});instance.web.EventDispatcherMixin=_.extend({},instance.web.ParentedMixin,{__eventDispatcherMixin:true,init:function(){instance.web.ParentedMixin.init.call(this);this.__edispatcherEvents=new Events();this.__edispatcherRegisteredEvents=[];},on:function(events,dest,func){var self=this;if(!(func instanceof Function)){throw new Error("Event handler must be a function.");}
events=events.split(/\s+/);_.each(events,function(eventName){self.__edispatcherEvents.on(eventName,func,dest);if(dest&&dest.__eventDispatcherMixin){dest.__edispatcherRegisteredEvents.push({name:eventName,func:func,source:self});}});return this;},off:function(events,dest,func){var self=this;events=events.split(/\s+/);_.each(events,function(eventName){self.__edispatcherEvents.off(eventName,func,dest);if(dest&&dest.__eventDispatcherMixin){dest.__edispatcherRegisteredEvents=_.filter(dest.__edispatcherRegisteredEvents,function(el){return!(el.name===eventName&&el.func===func&&el.source===self);});}});return this;},trigger:function(events){this.__edispatcherEvents.trigger.apply(this.__edispatcherEvents,arguments);return this;},destroy:function(){var self=this;_.each(this.__edispatcherRegisteredEvents,function(event){event.source.__edispatcherEvents.off(event.name,event.func,self);});this.__edispatcherRegisteredEvents=[];_.each(this.__edispatcherEvents.callbackList(),function(cal){this.off(cal[0],cal[2],cal[1]);},this);this.__edispatcherEvents.off();instance.web.ParentedMixin.destroy.call(this);}});instance.web.PropertiesMixin=_.extend({},instance.web.EventDispatcherMixin,{init:function(){instance.web.EventDispatcherMixin.init.call(this);this.__getterSetterInternalMap={};},set:function(arg1,arg2,arg3){var map;var options;if(typeof arg1==="string"){map={};map[arg1]=arg2;options=arg3||{};}else{map=arg1;options=arg2||{};}
var self=this;var changed=false;_.each(map,function(val,key){var tmp=self.__getterSetterInternalMap[key];if(tmp===val)
return;changed=true;self.__getterSetterInternalMap[key]=val;if(!options.silent)
self.trigger("change:"+key,self,{oldValue:tmp,newValue:val});});if(changed)
self.trigger("change",self);},get:function(key){return this.__getterSetterInternalMap[key];}});instance.web.Controller=instance.web.Class.extend(instance.web.PropertiesMixin,{init:function(parent){instance.web.PropertiesMixin.init.call(this);this.setParent(parent);},proxy:function(method){var self=this;return function(){var fn=(typeof method==='string')?self[method]:method;return fn.apply(self,arguments);}},do_action:function(){var parent=this.getParent();if(parent){return parent.do_action.apply(parent,arguments);}
return false;},do_notify:function(){if(this.getParent()){return this.getParent().do_notify.apply(this,arguments);}
return false;},do_warn:function(){if(this.getParent()){return this.getParent().do_warn.apply(this,arguments);}
return false;},rpc:function(url,data,options){return this.alive(instance.session.rpc(url,data,options));}});instance.web.Widget=instance.web.Controller.extend({tagName:'div',id:null,className:null,attributes:{},events:{},template:null,init:function(parent){this._super(parent);for(var name in this){if(typeof(this[name])=="function"){if((/^on_|^do_/).test(name)){this[name]=this[name].bind(this);}}}
this.setElement(this._make_descriptive());this.session=instance.session;},destroy:function(){_.each(this.getChildren(),function(el){el.destroy();});if(this.$el){this.$el.remove();}
instance.web.PropertiesMixin.destroy.call(this);},appendTo:function(target){var self=this;return this.__widgetRenderAndInsert(function(t){self.$el.appendTo(t);},target);},prependTo:function(target){var self=this;return this.__widgetRenderAndInsert(function(t){self.$el.prependTo(t);},target);},insertAfter:function(target){var self=this;return this.__widgetRenderAndInsert(function(t){self.$el.insertAfter(t);},target);},insertBefore:function(target){var self=this;return this.__widgetRenderAndInsert(function(t){self.$el.insertBefore(t);},target);},replace:function(target){return this.__widgetRenderAndInsert(_.bind(function(t){this.$el.replaceAll(t);},this),target);},__widgetRenderAndInsert:function(insertion,target){this.renderElement();insertion(target);return this.start();},renderElement:function(){},start:function(){return $.when();},renderElement:function(){var $el;if(this.template){$el=$(_.str.trim(instance.web.qweb.render(this.template,{widget:this})));}else{$el=this._make_descriptive();}
this.replaceElement($el);},replaceElement:function($el){var $oldel=this.$el;this.setElement($el);if($oldel&&!$oldel.is(this.$el)){$oldel.replaceWith(this.$el);}
return this;},setElement:function(element){if(this.$el){this.undelegateEvents();}
this.$el=(element instanceof $)?element:$(element);this.el=this.$el[0];this.delegateEvents();return this;},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(!_.isEmpty(attributes)){$(el).attr(attributes);}
if(content){$(el).html(content);}
return el;},_make_descriptive:function(){var attrs=_.extend({},this.attributes||{});if(this.id){attrs.id=this.id;}
if(this.className){attrs['class']=this.className;}
return $(this.make(this.tagName,attrs));},delegateEvents:function(){var events=this.events;if(_.isEmpty(events)){return;}
for(var key in events){if(!events.hasOwnProperty(key)){continue;}
var method=this.proxy(events[key]);var match=/^(\S+)(\s+(.*))?$/.exec(key);var event=match[1];var selector=match[3];event+='.widget_events';if(!selector){this.$el.on(event,method);}else{this.$el.on(event,selector,method);}}},undelegateEvents:function(){this.$el.off('.widget_events');},$:function(selector){return this.$el.find(selector);}});instance.web.Registry=instance.web.Class.extend({init:function(mapping){this.parent=null;this.map=mapping||{};},get_object:function(key,silent_error){var path_string=this.map[key];if(path_string===undefined){if(this.parent){return this.parent.get_object(key,silent_error);}
if(silent_error){return void'nooo';}
return null;}
var object_match=instance;var path=path_string.split('.');for(var i=1;i<path.length;++i){object_match=object_match[path[i]];if(object_match===undefined){if(silent_error){return void'noooooo';}
return null;}}
return object_match;},contains:function(key){if(key===undefined){return false;}
if(key in this.map){return true}
if(this.parent){return this.parent.contains(key);}
return false;},get_any:function(keys){for(var i=0;i<keys.length;++i){var key=keys[i];if(!this.contains(key)){continue;}
return this.get_object(key);}
return null;},add:function(key,object_path){this.map[key]=object_path;return this;},extend:function(mapping){var child=new instance.web.Registry(mapping);child.parent=this;return child;},clone:function(mapping){console.warn('Registry#clone is deprecated, use Registry#extend');return this.extend(mapping);}});instance.web.JsonRPC=instance.web.Class.extend(instance.web.PropertiesMixin,{triggers:{'request':'Request sent','response':'Response received','response_failed':'HTTP Error response or timeout received','error':'The received response is an JSON-RPC error',},init:function(){instance.web.PropertiesMixin.init.call(this);this.server=null;this.debug=($.deparam($.param.querystring()).debug!=undefined);},setup:function(origin){var window_origin=location.protocol+"//"+location.host,self=this;this.origin=origin?_.str.rtrim(origin,'/'):window_origin;this.prefix=this.origin;this.server=this.origin;this.rpc_function=(this.origin==window_origin)?this.rpc_json:this.rpc_jsonp;},rpc:function(url,params,options){var self=this;options=options||{};if(_.isString(url)){url={url:url};}
_.defaults(params,{context:this.user_context||{}});if(this.debug)
params.debug=1;var payload={jsonrpc:'2.0',method:'call',params:params,id:_.uniqueId('r')};var deferred=$.Deferred();if(!options.shadow)
this.trigger('request',url,payload);this.rpc_function(url,payload).then(function(response,textStatus,jqXHR){if(!options.shadow)
self.trigger('response',response);if(!response.error){deferred.resolve(response["result"],textStatus,jqXHR);}else if(response.error.code===100){self.uid=false;}else{deferred.reject(response.error,$.Event());}},function(jqXHR,textStatus,errorThrown){if(!options.shadow)
self.trigger('response_failed',jqXHR);var error={code:-32098,message:"XmlHttpRequestError "+errorThrown,data:{type:"xhr"+textStatus,debug:jqXHR.responseText,objects:[jqXHR,errorThrown]}};deferred.reject(error,$.Event());});deferred.fail(function(){deferred.fail(function(error,event){if(!event.isDefaultPrevented()){self.trigger('error',error,event);}});});return deferred;},rpc_json:function(url,payload){var self=this;var ajax=_.extend({type:"POST",dataType:'json',contentType:'application/json',data:JSON.stringify(payload),processData:false},url);if(this.synch)
ajax.async=false;return $.ajax(ajax);},rpc_jsonp:function(url,payload){var self=this;var data={session_id:this.session_id,id:payload.id,sid:this.httpsessionid,};var set_sid=function(response,textStatus,jqXHR){if(response.httpsessionid){self.httpsessionid=response.httpsessionid;}};url.url=this.url(url.url,null);var ajax=_.extend({type:"GET",dataType:'jsonp',jsonp:'jsonp',cache:false,data:data},url);if(this.synch)
ajax.async=false;var payload_str=JSON.stringify(payload);var payload_url=$.param({r:payload_str});if(payload_url.length<2000){ajax.data.r=payload_str;return $.ajax(ajax).done(set_sid);}else{var ifid=_.uniqueId('oe_rpc_iframe');var display=self.debug?'block':'none';var $iframe=$(_.str.sprintf("<iframe src='javascript:false;' name='%s' id='%s' style='display:%s'></iframe>",ifid,ifid,display));var $form=$('<form>').attr('method','POST').attr('target',ifid).attr('enctype',"multipart/form-data").attr('action',ajax.url+'?jsonp=1&'+$.param(data)).append($('<input type="hidden" name="r" />').attr('value',payload_str)).hide().appendTo($('body'));var cleanUp=function(){if($iframe){$iframe.unbind("load").remove();}
$form.remove();};var deferred=$.Deferred();$iframe.bind('load',function(){$iframe.unbind('load').bind('load',function(){$.ajax(ajax).always(function(){cleanUp();}).done(function(){deferred.resolve.apply(deferred,arguments);}).fail(function(){deferred.reject.apply(deferred,arguments);});});$form.submit();});$form.after($iframe);return deferred.done(set_sid);}},url:function(path,params){var qs='';if(!_.isNull(params)){params=_.extend(params||{},{session_id:this.session_id});if(this.httpsessionid){params.sid=this.httpsessionid;}
qs='?'+$.param(params);}
return this.prefix+path+qs;},});instance.web.py_eval=function(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));};};var console;if(!console){console={};('log error debug info warn assert clear dir dirxml trace group'
+' groupCollapsed groupEnd time timeEnd profile profileEnd count'
+' exception').split(/\s+/).forEach(function(property){console[property]=_.identity;});}
openerp.web.coresetup=function(instance){instance.web.Session=instance.web.JsonRPC.extend({init:function(){this._super.apply(this,arguments);this.name=instance._session_id;this.qweb_mutex=new $.Mutex();},rpc:function(url,params,options){params.session_id=this.session_id;return this._super(url,params,options);},session_bind:function(origin){if(!_.isUndefined(this.origin)){if(this.origin===origin){return $.when();}
throw new Error('Session already bound to '+this.origin);}
var self=this;this.setup(origin);instance.web.qweb.default_dict['_s']=this.origin;this.session_id=false;this.uid=false;this.username=false;this.user_context={};this.db=false;this.module_list=instance._modules.slice();this.module_loaded={};_(this.module_list).each(function(mod){self.module_loaded[mod]=true;});this.active_id=null;return this.session_init();},session_init:function(){var self=this;this.session_id=this.get_cookie('session_id');return this.session_reload().then(function(result){var modules=instance._modules.join(',');var deferred=self.rpc('/web/webclient/qweblist',{mods:modules}).then(self.load_qweb.bind(self));if(self.session_is_valid()){return deferred.then(function(){return self.load_modules();});}
return $.when(deferred,self.rpc('/web/webclient/bootstrap_translations',{mods:instance._modules}).then(function(trans){instance.web._t.database.set_bundle(trans);}));});},session_reload:function(){var self=this;return this.rpc("/web/session/get_session_info",{}).done(function(result){_.extend(self,result);});},session_is_valid:function(){var db=$.deparam.querystring().db;if(db&&this.db!==db){return false;}
return!!this.uid;},session_authenticate:function(db,login,password,_volatile){var self=this;var base_location=document.location.protocol+'//'+document.location.host;var params={db:db,login:login,password:password,base_location:base_location};return this.rpc("/web/session/authenticate",params).then(function(result){if(!result.uid){return $.Deferred().reject();}
_.extend(self,result);if(!_volatile){self.set_cookie('session_id',self.session_id);}
return self.load_modules();});},session_logout:function(){this.set_cookie('session_id','');$.bbq.removeState();return this.rpc("/web/session/destroy",{});},get_cookie:function(name){if(!this.name){return null;}
var nameEQ=this.name+'|'+name+'=';var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;++i){var cookie=cookies[i].replace(/^\s*/,'');if(cookie.indexOf(nameEQ)===0){return JSON.parse(decodeURIComponent(cookie.substring(nameEQ.length)));}}
return null;},set_cookie:function(name,value,ttl){if(!this.name){return;}
ttl=ttl||24*60*60*365;document.cookie=[this.name+'|'+name+'='+encodeURIComponent(JSON.stringify(value)),'path=/','max-age='+ttl,'expires='+new Date(new Date().getTime()+ttl*1000).toGMTString()].join(';');},load_modules:function(){var self=this;return this.rpc('/web/session/modules',{}).then(function(result){var all_modules=_.uniq(self.module_list.concat(result));var to_load=_.difference(result,self.module_list).join(',');self.module_list=all_modules;var loaded=self.load_translations();var datejs_locale="/web/static/lib/datejs/globalization/"+self.user_context.lang.replace("_","-")+".js";var file_list=[datejs_locale];if(to_load.length){loaded=$.when(loaded,self.rpc('/web/webclient/csslist',{mods:to_load}).done(self.load_css.bind(self)),self.rpc('/web/webclient/qweblist',{mods:to_load}).then(self.load_qweb.bind(self)),self.rpc('/web/webclient/jslist',{mods:to_load}).done(function(files){file_list=file_list.concat(files);}));}
return loaded.then(function(){return self.load_js(file_list);}).done(function(){self.on_modules_loaded();self.trigger('module_loaded');if(!Date.CultureInfo.pmDesignator){Date.CultureInfo.amDesignator='AM';Date.CultureInfo.pmDesignator='PM';}});});},load_translations:function(){var params={mods:this.module_list,lang:this.user_context.lang};return this.rpc('/web/webclient/translations',params).done(function(trans){instance.web._t.database.set_bundle(trans);});},load_css:function(files){var self=this;_.each(files,function(file){$('head').append($('<link>',{'href':self.url(file,null),'rel':'stylesheet','type':'text/css'}));});},load_js:function(files){var self=this;var d=$.Deferred();if(files.length!==0){var file=files.shift();var tag=document.createElement('script');tag.type='text/javascript';tag.src=self.url(file,null);tag.onload=tag.onreadystatechange=function(){if((tag.readyState&&tag.readyState!="loaded"&&tag.readyState!="complete")||tag.onload_done)
return;tag.onload_done=true;self.load_js(files).done(function(){d.resolve();});};var head=document.head||document.getElementsByTagName('head')[0];head.appendChild(tag);}else{d.resolve();}
return d;},load_qweb:function(files){var self=this;_.each(files,function(file){self.qweb_mutex.exec(function(){return self.rpc('/web/proxy/load',{path:file}).then(function(xml){if(!xml){return;}
instance.web.qweb.add_template(_.str.trim(xml));});});});return self.qweb_mutex.def;},on_modules_loaded:function(){for(var j=0;j<this.module_list.length;j++){var mod=this.module_list[j];if(this.module_loaded[mod])
continue;instance[mod]={};if(instance._openerp[mod]!=undefined){instance._openerp[mod](instance,instance[mod]);this.module_loaded[mod]=true;}}},get_file:function(options){var timer,token=new Date().getTime(),cookie_name='fileToken',cookie_length=cookie_name.length,CHECK_INTERVAL=1000,id=_.uniqueId('get_file_frame'),remove_form=false;var $form,$form_data=$('<div>');var complete=function(){if(options.complete){options.complete();}
clearTimeout(timer);$form_data.remove();$target.remove();if(remove_form&&$form){$form.remove();}};var $target=$('<iframe style="display: none;">').attr({id:id,name:id}).appendTo(document.body).load(function(){try{if(options.error){if(!this.contentDocument.body.childNodes[1]){options.error(this.contentDocument.body.childNodes);}
else{options.error(JSON.parse(this.contentDocument.body.childNodes[1].textContent));}}}finally{complete();}});if(options.form){$form=$(options.form);}else{remove_form=true;$form=$('<form>',{action:options.url,method:'POST'}).appendTo(document.body);}
_(_.extend({},options.data||{},{session_id:this.session_id,token:token})).each(function(value,key){var $input=$form.find('[name='+key+']');if(!$input.length){$input=$('<input type="hidden" name="'+key+'">').appendTo($form_data);}
$input.val(value)});$form.append($form_data).attr('target',id).get(0).submit();var waitLoop=function(){var cookies=document.cookie.split(';');timer=setTimeout(waitLoop,CHECK_INTERVAL);for(var i=0;i<cookies.length;++i){var cookie=cookies[i].replace(/^\s*/,'');if(!cookie.indexOf(cookie_name===0)){continue;}
var cookie_val=cookie.substring(cookie_length+1);if(parseInt(cookie_val,10)!==token){continue;}
document.cookie=_.str.sprintf("%s=;expires=%s;path=/",cookie_name,new Date().toGMTString());if(options.success){options.success();}
complete();return;}};timer=setTimeout(waitLoop,CHECK_INTERVAL);},synchronized_mode:function(to_execute){var synch=this.synch;this.synch=true;try{return to_execute();}finally{this.synch=synch;}}});instance.web.Bus=instance.web.Class.extend(instance.web.EventDispatcherMixin,{init:function(){instance.web.EventDispatcherMixin.init.call(this,parent);var self=this;_.each('click,dblclick,keydown,keypress,keyup'.split(','),function(evtype){$('html').on(evtype,function(ev){self.trigger(evtype,ev);});});_.each('resize,scroll'.split(','),function(evtype){$(window).on(evtype,function(ev){self.trigger(evtype,ev);});});}})
instance.web.bus=new instance.web.Bus();instance.web.TranslationDataBase=instance.web.Class.extend({init:function(){this.db={};this.parameters={"direction":'ltr',"date_format":'%m/%d/%Y',"time_format":'%H:%M:%S',"grouping":[],"decimal_point":".","thousands_sep":","};},set_bundle:function(translation_bundle){var self=this;this.db={};var modules=_.keys(translation_bundle.modules);modules.sort();if(_.include(modules,"web")){modules=["web"].concat(_.without(modules,"web"));}
_.each(modules,function(name){self.add_module_translation(translation_bundle.modules[name]);});if(translation_bundle.lang_parameters){this.parameters=translation_bundle.lang_parameters;this.parameters.grouping=py.eval(this.parameters.grouping);}},add_module_translation:function(mod){var self=this;_.each(mod.messages,function(message){self.db[message.id]=message.string;});},build_translation_function:function(){var self=this;var fcnt=function(str){var tmp=self.get(str);return tmp===undefined?str:tmp;};fcnt.database=this;return fcnt;},get:function(key){if(this.db[key])
return this.db[key];return undefined;}});$.fn.getAttributes=function(){var o={};if(this.length){for(var attr,i=0,attrs=this[0].attributes,l=attrs.length;i<l;i++){attr=attrs.item(i)
o[attr.nodeName]=attr.nodeValue;}}
return o;}
$.fn.openerpClass=function(additionalClass){additionalClass=additionalClass||'';if(!!$.browser.msie){additionalClass+=' openerp_ie';}
return this.each(function(){$(this).addClass('openerp '+additionalClass);});};$.fn.openerpBounce=function(){return this.each(function(){$(this).css('box-sizing','content-box').effect('bounce',{distance:18,times:5},250);});};$.Mutex=(function(){function Mutex(){this.def=$.Deferred().resolve();}
Mutex.prototype.exec=function(action){var current=this.def;var next=this.def=$.Deferred();return current.then(function(){return $.when(action()).always(function(){next.resolve();});});};return Mutex;})();$.async_when=function(){var async=false;var def=$.Deferred();$.when.apply($,arguments).done(function(){var args=arguments;var action=function(){def.resolve.apply(def,args);};if(async)
action();else
setTimeout(action,0);}).fail(function(){var args=arguments;var action=function(){def.reject.apply(def,args);};if(async)
action();else
setTimeout(action,0);});async=true;return def;};var old_async_when=$.async_when;$.async_when=function(){if(instance.session.synch)
return $.when.apply(this,arguments);else
return old_async_when.apply(this,arguments);};instance.session=new instance.web.Session();instance.web._t=new instance.web.TranslationDataBase().build_translation_function();instance.web._lt=function(s){return{toString:function(){return instance.web._t(s);}}};instance.web.qweb=new QWeb2.Engine();instance.web.qweb.debug=instance.session.debug;instance.web.qweb.default_dict={'_':_,'_t':instance.web._t,'JSON':JSON,'__debug__':instance.session.debug,};instance.web.qweb.preprocess_node=function(){switch(this.node.nodeType){case 3:case 4:var translation=this.node.parentNode.attributes['t-translation'];if(translation&&translation.value==='off'){return;}
var match=/^(\s*)(.+?)(\s*)$/.exec(this.node.data);if(match){this.node.data=match[1]+instance.web._t(match[2])+match[3];}
break;case 1:var attr,attrs=['label','title','alt','placeholder'];while(attr=attrs.pop()){if(this.attributes[attr]){this.attributes[attr]=instance.web._t(this.attributes[attr]);}}}};var _t=instance.web._t;{_t('less than a minute ago');_t('about a minute ago');_t('%d minutes ago');_t('about an hour ago');_t('%d hours ago');_t('a day ago');_t('%d days ago');_t('about a month ago');_t('%d months ago');_t('about a year ago');_t('%d years ago');}
instance.session.on('module_loaded',this,function(){$.timeago.settings.translator=instance.web._t;});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};instance.web.Throbber=instance.web.Widget.extend({template:"Throbber",start:function(){var opts={lines:13,length:7,width:4,radius:10,rotate:0,color:'#FFF',speed:1,trail:60,shadow:false,hwaccel:false,className:'spinner',zIndex:2e9,top:'auto',left:'auto'};this.spin=new Spinner(opts).spin(this.$el[0]);this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},destroy:function(){if(this.spin)
this.spin.stop();this._super();},});instance.web.Throbber.throbbers=[];instance.web.blockUI=function(){var tmp=$.blockUI.apply($,arguments);var throbber=new instance.web.Throbber();instance.web.Throbber.throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));return tmp;}
instance.web.unblockUI=function(){_.each(instance.web.Throbber.throbbers,function(el){el.destroy();});return $.unblockUI.apply($,arguments);}
instance.web.client_actions=new instance.web.Registry();};;openerp.web.dates=function(instance){var _t=instance.web._t;instance.web.str_to_datetime=function(str){if(!str){return str;}
var regex=/^(\d\d\d\d-\d\d-\d\d \d\d:\d\d:\d\d)(?:\.\d+)?$/;var res=regex.exec(str);if(!res){throw new Error(_.str.sprintf(_t("'%s' is not a valid datetime"),str));}
var obj=Date.parseExact(res[1]+" UTC",'yyyy-MM-dd HH:mm:ss zzz');if(!obj){throw new Error(_.str.sprintf(_t("'%s' is not a valid datetime"),str));}
return obj;};instance.web.str_to_date=function(str){if(!str){return str;}
var regex=/^\d\d\d\d-\d\d-\d\d$/;var res=regex.exec(str);if(!res){throw new Error(_.str.sprintf(_t("'%s' is not a valid date"),str));}
var obj=Date.parseExact(str,'yyyy-MM-dd');if(!obj){throw new Error(_.str.sprintf(_t("'%s' is not a valid date"),str));}
return obj;};instance.web.str_to_time=function(str){if(!str){return str;}
var regex=/^(\d\d:\d\d:\d\d)(?:\.\d+)?$/;var res=regex.exec(str);if(!res){throw new Error(_.str.sprintf(_t("'%s' is not a valid time"),str));}
var obj=Date.parseExact("1970-01-01 "+res[1],'yyyy-MM-dd HH:mm:ss');if(!obj){throw new Error(_.str.sprintf(_t("'%s' is not a valid time"),str));}
return obj;};var zpad=function(str,size){str=""+str;return new Array(size-str.length+1).join('0')+str;};instance.web.datetime_to_str=function(obj){if(!obj){return false;}
return zpad(obj.getUTCFullYear(),4)+"-"+zpad(obj.getUTCMonth()+1,2)+"-"
+zpad(obj.getUTCDate(),2)+" "+zpad(obj.getUTCHours(),2)+":"
+zpad(obj.getUTCMinutes(),2)+":"+zpad(obj.getUTCSeconds(),2);};instance.web.date_to_str=function(obj){if(!obj){return false;}
return zpad(obj.getFullYear(),4)+"-"+zpad(obj.getMonth()+1,2)+"-"
+zpad(obj.getDate(),2);};instance.web.time_to_str=function(obj){if(!obj){return false;}
return zpad(obj.getHours(),2)+":"+zpad(obj.getMinutes(),2)+":"
+zpad(obj.getSeconds(),2);};};;openerp.web.formats=function(instance){var _t=instance.web._t;instance.web.intersperse=function(str,indices,separator){separator=separator||'';var result=[],last=str.length;for(var i=0;i<indices.length;++i){var section=indices[i];if(section===-1||last<=0){break;}else if(section===0&&i===0){break;}else if(section===0){section=indices[--i];}
result.push(str.substring(last-section,last));last-=section;}
var s=str.substring(0,last);if(s){result.push(s);}
return result.reverse().join(separator);};instance.web.insert_thousand_seps=function(num){var negative=num[0]==='-';num=(negative?num.slice(1):num);return(negative?'-':'')+instance.web.intersperse(num,_t.database.parameters.grouping,_t.database.parameters.thousands_sep);};instance.web.strip_raw_chars=function(value){var isletter=/[a-zA-Z]/,output=[];for(var index=0;index<value.length;++index){var character=value[index];if(isletter.test(character)&&(index===0||value[index-1]!=='%')){continue;}
output.push(character);}
return output.join('');};var normalize_format=function(format){return Date.normalizeFormat(instance.web.strip_raw_chars(format));};instance.web.binary_to_binsize=function(value){if(!value){return instance.web.human_size(0);}
if(value.substr(0,10).indexOf(' ')==-1){return instance.web.human_size(value.length/1.37);}else{return value;}};instance.web.human_size=function(size){var units=_t("Bytes,Kb,Mb,Gb,Tb,Pb,Eb,Zb,Yb").split(',');var i=0;while(size>=1024){size/=1024;++i;}
return size.toFixed(2)+' '+units[i];};instance.web.format_value=function(value,descriptor,value_if_empty){if(typeof value==='number'&&isNaN(value)){value=false;}
switch(value){case'':if(descriptor.type==='char'){return'';}
console.warn('Field',descriptor,'had an empty string as value, treating as false...');case false:case Infinity:case-Infinity:return value_if_empty===undefined?'':value_if_empty;}
var l10n=_t.database.parameters;switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'id':return value.toString();case'integer':return instance.web.insert_thousand_seps(_.str.sprintf('%d',value));case'float':var digits=descriptor.digits?descriptor.digits:[69,2];digits=typeof digits==="string"?py.eval(digits):digits;var precision=digits[1];var formatted=_.str.sprintf('%.'+precision+'f',value).split('.');formatted[0]=instance.web.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);case'float_time':var pattern='%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min==60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);case'many2one':return value[1]?value[1].split("\n")[0]:value[1];case'one2many':case'many2many':if(typeof value==='string'){return value;}
return _.str.sprintf(_t("(%d records)"),value.length);case'datetime':if(typeof(value)=="string")
value=instance.web.auto_str_to_date(value);return value.toString(normalize_format(l10n.date_format)
+' '+normalize_format(l10n.time_format));case'date':if(typeof(value)=="string")
value=instance.web.auto_str_to_date(value);return value.toString(normalize_format(l10n.date_format));case'time':if(typeof(value)=="string")
value=instance.web.auto_str_to_date(value);return value.toString(normalize_format(l10n.time_format));case'selection':case'statusbar':if(_.isArray(value)){value=value[0]}
var result=_(descriptor.selection).detect(function(choice){return choice[0]===value;});if(result){return result[1];}
return;default:return value;}};instance.web.parse_value=function(value,descriptor,value_if_empty){var date_pattern=normalize_format(_t.database.parameters.date_format),time_pattern=normalize_format(_t.database.parameters.time_format);switch(value){case false:case"":return value_if_empty===undefined?false:value_if_empty;}
switch(descriptor.widget||descriptor.type||(descriptor.field&&descriptor.field.type)){case'integer':var tmp;do{tmp=value;value=value.replace(instance.web._t.database.parameters.thousands_sep,"");}while(tmp!==value);tmp=Number(value);if(isNaN(tmp))
throw new Error(_.str.sprintf(_t("'%s' is not a correct integer"),value));return tmp;case'float':var tmp=Number(value);if(!isNaN(tmp))
return tmp;var tmp2=value;do{tmp=tmp2;tmp2=tmp.replace(instance.web._t.database.parameters.thousands_sep,"");}while(tmp!==tmp2);var reformatted_value=tmp.replace(instance.web._t.database.parameters.decimal_point,".");var parsed=Number(reformatted_value);if(isNaN(parsed))
throw new Error(_.str.sprintf(_t("'%s' is not a correct float"),value));return parsed;case'float_time':var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!=2)
return factor*instance.web.parse_value(value,{type:"float"});var hours=instance.web.parse_value(float_time_pair[0],{type:"integer"});var minutes=instance.web.parse_value(float_time_pair[1],{type:"integer"});return factor*(hours+(minutes/60));case'progressbar':return instance.web.parse_value(value,{type:"float"});case'datetime':var datetime=Date.parseExact(value,(date_pattern+' '+time_pattern));if(datetime!==null)
return instance.web.datetime_to_str(datetime);datetime=Date.parse(value);if(datetime!==null)
return instance.web.datetime_to_str(datetime);throw new Error(_.str.sprintf(_t("'%s' is not a correct datetime"),value));case'date':var date=Date.parseExact(value,date_pattern);if(date!==null)
return instance.web.date_to_str(date);date=Date.parse(value);if(date!==null)
return instance.web.date_to_str(date);throw new Error(_.str.sprintf(_t("'%s' is not a correct date"),value));case'time':var time=Date.parseExact(value,time_pattern);if(time!==null)
return instance.web.time_to_str(time);time=Date.parse(value);if(time!==null)
return instance.web.time_to_str(time);throw new Error(_.str.sprintf(_t("'%s' is not a correct time"),value));}
return value;};instance.web.auto_str_to_date=function(value,type){try{return instance.web.str_to_datetime(value);}catch(e){}
try{return instance.web.str_to_date(value);}catch(e){}
try{return instance.web.str_to_time(value);}catch(e){}
throw new Error(_.str.sprintf(_t("'%s' is not a correct date, datetime nor time"),value));};instance.web.auto_date_to_str=function(value,type){switch(type){case'datetime':return instance.web.datetime_to_str(value);case'date':return instance.web.date_to_str(value);case'time':return instance.web.time_to_str(value);default:throw new Error(_.str.sprintf(_t("'%s' is not convertible to date, datetime nor time"),type));}};};;openerp.web.chrome=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.Notification=instance.web.Widget.extend({template:'Notification',init:function(){this._super.apply(this,arguments);instance.web.notification=this;},start:function(){this._super.apply(this,arguments);this.$el.notify({speed:500,expires:2500});},notify:function(title,text,sticky){sticky=!!sticky;var opts={};if(sticky){opts.expires=false;}
return this.$el.notify('create',{title:title,text:text},opts);},warn:function(title,text,sticky){sticky=!!sticky;var opts={};if(sticky){opts.expires=false;}
return this.$el.notify('create','oe_notification_alert',{title:title,text:text},opts);}});instance.web.action_notify=function(element,action){element.do_notify(action.params.title,action.params.text,action.params.sticky);};instance.web.client_actions.add("action_notify","instance.web.action_notify");instance.web.action_warn=function(element,action){element.do_warn(action.params.title,action.params.text,action.params.sticky);};instance.web.client_actions.add("action_warn","instance.web.action_warn");instance.web.dialog=function(element){var result=element.dialog.apply(element,_.rest(_.toArray(arguments)));result.dialog("widget").openerpClass();return result;};instance.web.Dialog=instance.web.Widget.extend({dialog_title:"",init:function(parent,options,content){var self=this;this._super(parent);this.content_to_set=content;this.dialog_options={modal:true,destroy_on_close:true,width:900,min_width:0,max_width:'95%',height:'auto',min_height:0,max_height:$(window.top).height()-200,autoOpen:false,position:[false,40],buttons:null,beforeClose:function(){self.trigger("closing");},resizeStop:function(){self.trigger("resized");},};if(options){_.extend(this.dialog_options,options);}
this.on("closing",this,this._closing);this.$buttons=$('<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><span class="oe_dialog_custom_buttons"/></div>');},_get_options:function(){var self=this;var o=_.extend({},this.dialog_options);var sizes={width:$(window.top).width(),height:$(window.top).height(),};_.each(sizes,function(available_size,unit){o[unit]=self._get_size(o[unit],available_size);o['min_'+unit]=self._get_size(o['min_'+unit]||0,available_size);o['max_'+unit]=self._get_size(o['max_'+unit]||0,available_size);if(o[unit]!=='auto'&&o['min_'+unit]&&o[unit]<o['min_'+unit]){o[unit]=o['min_'+unit];}
if(o[unit]!=='auto'&&o['max_'+unit]&&o[unit]>o['max_'+unit]){o[unit]=o['max_'+unit];}});o.title=o.title||this.dialog_title;return o;},_get_size:function(val,available_size){val=val.toString();if(val==='auto'){return val;}else if(val.slice(-1)==="%"){return Math.round(available_size/100*parseInt(val.slice(0,-1),10));}else{return parseInt(val,10);}},renderElement:function(){if(this.content_to_set){this.setElement(this.content_to_set);}else if(this.template){this._super();}},open:function(){if(!this.dialog_inited){this.init_dialog();}
this.$el.dialog('open');this.$el.dialog("widget").append(this.$buttons);return this;},_add_buttons:function(buttons){var self=this;var $customButons=this.$buttons.find('.oe_dialog_custom_buttons').empty();_.each(buttons,function(fn,text){if(!_.isFunction(fn)){text=fn.text;fn=fn.click;}
var $but=$(QWeb.render('WidgetButton',{widget:{string:text,node:{attrs:{}}}}));$customButons.append($but);$but.on('click',function(ev){fn.call(self.$el,ev);});});},init_dialog:function(){var options=this._get_options();if(options.buttons){this._add_buttons(options.buttons);delete(options.buttons);}
this.renderElement();instance.web.dialog(this.$el,options);if(options.height==='auto'&&options.max_height){this.$el.css({'max-height':options.max_height,'overflow-y':'auto'});}
this.dialog_inited=true;var res=this.start();return res;},close:function(){if(this.dialog_inited&&this.$el.is(":data(dialog)")){this.$el.dialog('close');}},_closing:function(){if(this.__tmp_dialog_destroying)
return;if(this.dialog_options.destroy_on_close){this.__tmp_dialog_closing=true;this.destroy();this.__tmp_dialog_closing=undefined;}},destroy:function(){this.$buttons.remove();_.each(this.getChildren(),function(el){el.destroy();});if(!this.__tmp_dialog_closing){this.__tmp_dialog_destroying=true;this.close();this.__tmp_dialog_destroying=undefined;}
if(this.dialog_inited&&!this.isDestroyed()&&this.$el.is(":data(dialog)")){this.$el.dialog('destroy');}
this._super();}});instance.web.CrashManager=instance.web.Class.extend({init:function(){this.active=true;},rpc_error:function(error){if(!this.active){return;}
var handler=instance.web.crash_manager_registry.get_object(error.data.name,true);if(handler){new(handler)(this,error).display();return;};if(error.data.name==="openerp.addons.web.session SessionExpiredException"){this.show_warning({type:"Session Expired",data:{message:"Your OpenERP session expired. Please refresh the current web page."}});return;}
if(error.data.exception_type==="except_osv"||error.data.exception_type==="warning"||error.data.exception_type==="access_error"){this.show_warning(error);}else{this.show_error(error);}},show_warning:function(error){if(!this.active){return;}
if(error.data.exception_type==="except_osv"){error=_.extend({},error,{data:_.extend({},error.data,{message:error.data.arguments[0]+"\n\n"+error.data.arguments[1]})});}
instance.web.dialog($('<div>'+QWeb.render('CrashManager.warning',{error:error})+'</div>'),{title:"OpenERP "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:_t("Ok"),click:function(){$(this).dialog("close");}}]});},show_error:function(error){if(!this.active){return;}
var buttons={};buttons[_t("Ok")]=function(){$(this).dialog("close");};var dialog=new instance.web.Dialog(this,{title:"OpenERP "+_.str.capitalize(error.type),width:'80%',height:'50%',min_width:'800px',min_height:'600px',buttons:buttons}).open();dialog.$el.html(QWeb.render('CrashManager.error',{session:instance.session,error:error}));},show_message:function(exception){this.show_error({type:_t("Client Error"),message:exception,data:{debug:""}});},});instance.web.ExceptionHandler={init:function(parent,error){},display:function(){},};instance.web.crash_manager_registry=new instance.web.Registry();instance.web.RedirectWarningHandler=instance.web.Dialog.extend(instance.web.ExceptionHandler,{init:function(parent,error){this._super(parent);this.error=error;},display:function(){error=this.error;error.data.message=error.data.arguments[0];instance.web.dialog($('<div>'+QWeb.render('CrashManager.warning',{error:error})+'</div>'),{title:"OpenERP "+(_.str.capitalize(error.type)||"Warning"),buttons:[{text:_t("Ok"),click:function(){$(this).dialog("close");}},{text:error.data.arguments[2],click:function(){window.location.href='#action='+error.data.arguments[1];$(this).dialog("close");}}]});this.destroy();}});instance.web.crash_manager_registry.add('openerp.exceptions.RedirectWarning','instance.web.RedirectWarningHandler');instance.web.Loading=instance.web.Widget.extend({template:_t("Loading"),init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;this.session.on("request",this,this.request_call);this.session.on("response",this,this.response_call);this.session.on("response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;instance.web.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(instance.session.debug){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;instance.web.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});instance.web.DatabaseManager=instance.web.Widget.extend({init:function(parent){this._super(parent);this.unblockUIFunction=instance.web.unblockUI;$.validator.addMethod('matches',function(s,_,re){return new RegExp(re).test(s);},_t("Invalid database name"));},start:function(){var self=this;$('.oe_secondary_menus_container,.oe_user_menu_placeholder').empty();var fetch_db=this.rpc("/web/database/get_list",{}).then(function(result){self.db_list=result;},function(_,ev){ev.preventDefault();self.db_list=null;});var fetch_langs=this.rpc("/web/session/get_lang_list",{}).done(function(result){self.lang_list=result;});return $.when(fetch_db,fetch_langs).done(self.do_render);},do_render:function(){var self=this;instance.webclient.toggle_bars(true);self.$el.html(QWeb.render("DatabaseManager",{widget:self}));$('.oe_user_menu_placeholder').append(QWeb.render("DatabaseManager.user_menu",{widget:self}));$('.oe_secondary_menus_container').append(QWeb.render("DatabaseManager.menu",{widget:self}));$('ul.oe_secondary_submenu > li:first').addClass('oe_active')
$('ul.oe_secondary_submenu > li').bind('click',function(event){var menuitem=$(this);menuitem.addClass('oe_active').siblings().removeClass('oe_active');var form_id=menuitem.find('a').attr('href');$(form_id).show().siblings().hide();event.preventDefault();});$('#back-to-login').click(self.do_exit);self.$el.find("td").addClass("oe_form_group_cell");self.$el.find("tr td:first-child").addClass("oe_form_group_cell_label");self.$el.find("label").addClass("oe_form_label");self.$el.find("form[name=create_db_form]").validate({submitHandler:self.do_create});self.$el.find("form[name=duplicate_db_form]").validate({submitHandler:self.do_duplicate});self.$el.find("form[name=drop_db_form]").validate({submitHandler:self.do_drop});self.$el.find("form[name=backup_db_form]").validate({submitHandler:self.do_backup});self.$el.find("form[name=restore_db_form]").validate({submitHandler:self.do_restore});self.$el.find("form[name=change_pwd_form]").validate({messages:{old_pwd:_t("Please enter your previous password"),new_pwd:_t("Please enter your new password"),confirm_pwd:{required:_t("Please confirm your new password"),equalTo:_t("The confirmation does not match the password")}},submitHandler:self.do_change_password});},destroy:function(){this.$el.find('#db-create, #db-drop, #db-backup, #db-restore, #db-change-password, #back-to-login').unbind('click').end().empty();this._super();},to_object:function(array){var result={};_(array).each(function(record){result[record.name]=record.value;});return result;},blockUI:function(){instance.web.blockUI();instance.web.unblockUI=function(){};},unblockUI:function(){instance.web.unblockUI=this.unblockUIFunction;instance.web.unblockUI();},display_error:function(error){return instance.web.dialog($('<div>'),{modal:true,title:error.title,buttons:[{text:_t("Ok"),click:function(){$(this).dialog("close");}}]}).html(error.error);},do_create:function(form){var self=this;var fields=$(form).serializeArray();self.rpc("/web/database/create",{'fields':fields}).done(function(result){var form_obj=self.to_object(fields);var client_action={type:'ir.actions.client',tag:'login',params:{'db':form_obj['db_name'],'login':'admin','password':form_obj['create_admin_pwd'],'login_successful':function(){var action={type:"ir.actions.client",tag:'reload',params:{url_search:{db:form_obj['db_name'],},}};self.do_action(action);},},_push_me:false,};self.do_action(client_action);});},do_duplicate:function(form){var self=this;var fields=$(form).serializeArray();self.rpc("/web/database/duplicate",{'fields':fields}).then(function(result){if(result.error){self.display_error(result);return;}
self.do_notify(_t("Duplicating database"),_t("The database has been duplicated."));self.start();});},do_drop:function(form){var self=this;var $form=$(form),fields=$form.serializeArray(),$db_list=$form.find('[name=drop_db]'),db=$db_list.val();if(!db||!confirm(_.str.sprintf(_t("Do you really want to delete the database: %s ?"),db))){return;}
self.rpc("/web/database/drop",{'fields':fields}).done(function(result){if(result.error){self.display_error(result);return;}
self.do_notify(_t("Dropping database"),_.str.sprintf(_t("The database %s has been dropped"),db));self.start();});},do_backup:function(form){var self=this;self.blockUI();self.session.get_file({form:form,success:function(){self.do_notify(_t("Backed"),_t("Database backed up successfully"));},error:function(error){if(error){self.display_error({title:_t("Backup Database"),error:'AccessDenied'});}},complete:function(){self.unblockUI();}});},do_restore:function(form){var self=this;self.blockUI();$(form).ajaxSubmit({url:'/web/database/restore',type:'POST',resetForm:true,success:function(body){if(!body){return;}
if(body.indexOf('403 Forbidden')!==-1){self.display_error({title:_t("Access Denied"),error:_t("Incorrect super-administrator password")});}else{self.display_error({title:_t("Restore Database"),error:_t("Could not restore the database")});}},complete:function(){self.unblockUI();self.do_notify(_t("Restored"),_t("Database restored successfully"));}});},do_change_password:function(form){var self=this;self.rpc("/web/database/change_password",{'fields':$(form).serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}
self.unblockUI();self.do_notify(_t("Changed Password"),_t("Password has been changed successfully"));});},do_exit:function(){this.$el.remove();instance.webclient.show_login();}});instance.web.client_actions.add("database_manager","instance.web.DatabaseManager");instance.web.Login=instance.web.Widget.extend({template:"Login",remember_credentials:true,events:{'change input[name=db],select[name=db]':function(ev){this.set('database_selector',$(ev.currentTarget).val());},},init:function(parent,action){this._super(parent);this.has_local_storage=typeof(localStorage)!='undefined';this.db_list=null;this.selected_db=null;this.selected_login=null;this.params=action.params||{};if(_.isEmpty(this.params)){this.params=$.bbq.getState(true);}
if(action&&action.params&&action.params.db){this.params.db=action.params.db;}else if($.deparam.querystring().db){this.params.db=$.deparam.querystring().db;}
if(this.params.db){this.selected_db=this.params.db;}
if(this.params.login_successful){this.on('login_successful',this,this.params.login_successful);}},start:function(){var self=this;self.$el.find("form").submit(self.on_submit);self.$el.find('.oe_login_manage_db').click(function(){self.do_action("database_manager");});self.on('change:database_selector',this,function(){this.database_selected(this.get('database_selector'));});var d=$.when();if($.param.fragment().token){self.params.token=$.param.fragment().token;}
if(self.params.db&&self.params.login&&self.params.password){d=self.do_login(self.params.db,self.params.login,self.params.password);}else{d=self.rpc("/web/database/get_list",{}).done(self.on_db_loaded).fail(self.on_db_failed).always(function(){if(self.selected_db&&self.has_local_storage&&self.remember_credentials){self.$("[name=login]").val(localStorage.getItem(self.selected_db+'|last_login')||'');if(self.session.debug){self.$("[name=password]").val(localStorage.getItem(self.selected_db+'|last_password')||'');}}});}
return d;},remember_last_used_database:function(db){var ttl=24*60*60*365;document.cookie=['last_used_database='+db,'path=/','max-age='+ttl,'expires='+new Date(new Date().getTime()+ttl*1000).toGMTString()].join(';');},database_selected:function(db){var params=$.deparam.querystring();params.db=db;this.remember_last_used_database(db);this.$('.oe_login_dbpane').empty().text(_t('Loading...'));this.$('[name=login], [name=password]').prop('readonly',true);instance.web.redirect('/?'+$.param(params));},on_db_loaded:function(result){var self=this;this.db_list=result;if(!this.selected_db){this.selected_db=result[0];}
this.$("[name=db]").replaceWith(QWeb.render('Login.dblist',{db_list:this.db_list,selected_db:this.selected_db}));if(this.db_list.length===0){this.do_action("database_manager");}else if(this.db_list.length===1){this.$('div.oe_login_dbpane').hide();}else{this.$('div.oe_login_dbpane').show();}},on_db_failed:function(error,event){if(error.data.name==='openerp.exceptions.AccessDenied'){event.preventDefault();}},on_submit:function(ev){if(ev){ev.preventDefault();}
var db=this.$("form [name=db]").val();if(!db){this.do_warn(_t("Login"),_t("No database selected !"));return false;}
var login=this.$("form input[name=login]").val();var password=this.$("form input[name=password]").val();this.do_login(db,login,password);},do_login:function(db,login,password){var self=this;self.hide_error();self.$(".oe_login_pane").fadeOut("slow");return this.session.session_authenticate(db,login,password).then(function(){self.remember_last_used_database(db);if(self.has_local_storage&&self.remember_credentials){localStorage.setItem(db+'|last_login',login);if(self.session.debug){localStorage.setItem(db+'|last_password',password);}}
self.trigger('login_successful');},function(){self.$(".oe_login_pane").fadeIn("fast",function(){self.show_error(_t("Invalid username or password"));});});},show_error:function(message){this.$el.addClass("oe_login_invalid");this.$(".oe_login_error_message").text(message);},hide_error:function(){this.$el.removeClass('oe_login_invalid');},});instance.web.client_actions.add("login","instance.web.Login");instance.web.redirect=function(url,wait){if(instance.client&&instance.client.crashmanager){instance.client.crashmanager.active=false;}
var wait_server=function(){instance.session.rpc("/web/webclient/version_info",{}).done(function(){window.location=url;}).fail(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{window.location=url;}};instance.web.Reload=function(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));sobj.ts=new Date().getTime();if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;instance.web.redirect(url,params.wait);};instance.web.client_actions.add("reload","instance.web.Reload");instance.web.HistoryBack=function(parent){if(!parent.history_back()){instance.web.Home(parent);}};instance.web.client_actions.add("history_back","instance.web.HistoryBack");instance.web.Home=function(parent,action){var url='/'+(window.location.search||'');instance.web.redirect(url,action.params&&action.params.wait);};instance.web.client_actions.add("home","instance.web.Home");instance.web.ChangePassword=instance.web.Widget.extend({template:"ChangePassword",start:function(){var self=this;this.getParent().dialog_title=_t("Change Password");var $button=self.$el.find('.oe_form_button');$button.appendTo(this.getParent().$buttons);$button.eq(2).click(function(){self.getParent().close();})
$button.eq(0).click(function(){self.rpc("/web/session/change_password",{'fields':$("form[name=change_password_form]").serializeArray()}).done(function(result){if(result.error){self.display_error(result);return;}else{instance.webclient.on_logout();}});})},display_error:function(error){return instance.web.dialog($('<div>'),{modal:true,title:error.title,buttons:[{text:_t("Ok"),click:function(){$(this).dialog("close");}}]}).html(error.error);},})
instance.web.client_actions.add("change_password","instance.web.ChangePassword");instance.web.Menu=instance.web.Widget.extend({template:'Menu',init:function(){var self=this;this._super.apply(this,arguments);this.has_been_loaded=$.Deferred();this.maximum_visible_links='auto';this.data={data:{children:[]}};this.on("menu_loaded",this,function(menu_data){self.reflow();if(!_.isEmpty(menu_data.all_menu_ids)){this.rpc("/web/menu/load_needaction",{menu_ids:menu_data.all_menu_ids}).done(function(r){self.on_needaction_loaded(r);});}});var lazyreflow=_.debounce(this.reflow.bind(this),200);instance.web.bus.on('resize',this,function(){self.$el.height(0);lazyreflow();});},start:function(){this._super.apply(this,arguments);this.$secondary_menus=this.getParent().$el.find('.oe_secondary_menus_container');this.$secondary_menus.on('click','a[data-menu]',this.on_menu_click);return this.do_reload();},do_reload:function(){var self=this;return this.rpc("/web/menu/load",{}).done(function(r){self.menu_loaded(r);});},menu_loaded:function(data){var self=this;this.data={data:data};this.renderElement();this.$secondary_menus.html(QWeb.render("Menu.secondary",{widget:this}));this.$el.on('click','a[data-menu]',this.on_menu_click);this.$secondary_menus.find('.oe_menu_toggler').siblings('.oe_secondary_submenu').hide();if(self.current_menu){self.open_menu(self.current_menu);}
this.trigger('menu_loaded',data);this.has_been_loaded.resolve();},on_needaction_loaded:function(data){var self=this;this.needaction_data=data;_.each(this.needaction_data,function(item,menu_id){var $item=self.$secondary_menus.find('a[data-menu="'+menu_id+'"]');$item.find('.oe_menu_counter').remove();if(item.needaction_counter&&item.needaction_counter>0){$item.append(QWeb.render("Menu.needaction_counter",{widget:item}));}});},reflow:function(){var self=this;this.$el.height('auto').show();var $more_container=this.$('.oe_menu_more_container').hide();var $more=this.$('.oe_menu_more');$more.children('li').insertBefore($more_container);var $toplevel_items=this.$el.children('li').not($more_container).hide();$toplevel_items.each(function(){var remaining_space=self.$el.parent().width()-$more_container.outerWidth();self.$el.parent().children(':visible').each(function(){remaining_space-=$(this).outerWidth();});if($(this).width()>remaining_space){return false;}
$(this).show();});$more.append($toplevel_items.filter(':hidden').show());$more_container.toggle(!!$more.children().length);var $toplevel=this.$el.children("li:visible");if($toplevel.length===1){$toplevel.hide();}},open_menu:function(id){this.current_menu=id;this.session.active_id=id;var $clicked_menu,$sub_menu,$main_menu;$clicked_menu=this.$el.add(this.$secondary_menus).find('a[data-menu='+id+']');this.trigger('open_menu',id,$clicked_menu);if(this.$secondary_menus.has($clicked_menu).length){$sub_menu=$clicked_menu.parents('.oe_secondary_menu');$main_menu=this.$el.find('a[data-menu='+$sub_menu.data('menu-parent')+']');}else{$sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+$clicked_menu.attr('data-menu')+']');$main_menu=$clicked_menu;}
this.$el.find('.oe_active').removeClass('oe_active');$main_menu.addClass('oe_active');this.$secondary_menus.find('.oe_secondary_menu').hide();$sub_menu.show();this.$secondary_menus.parent('.oe_leftbar').toggle(!!$sub_menu.children().length);this.$secondary_menus.find('.oe_active').removeClass('oe_active');if($main_menu!==$clicked_menu){$clicked_menu.parents().show();if($clicked_menu.is('.oe_menu_toggler')){$clicked_menu.toggleClass('oe_menu_opened').siblings('.oe_secondary_submenu:first').toggle();}else{$clicked_menu.parent().addClass('oe_active');}}},open_action:function(id){var $menu=this.$el.add(this.$secondary_menus).find('a[data-action-id="'+id+'"]');var menu_id=$menu.data('menu');if(menu_id){this.open_menu(menu_id);}},menu_click:function(id,needaction){if(!id){return;}
var $item=this.$el.find('a[data-menu='+id+']');if(!$item.length){$item=this.$secondary_menus.find('a[data-menu='+id+']');}
var action_id=$item.data('action-id');if(!action_id){if(this.$el.has($item).length){var $sub_menu=this.$secondary_menus.find('.oe_secondary_menu[data-menu-parent='+id+']');var $items=$sub_menu.find('a[data-action-id]').filter('[data-action-id!=""]');if($items.length){action_id=$items.data('action-id');id=$items.data('menu');}}}
if(action_id){this.trigger('menu_click',{action_id:action_id,needaction:needaction,id:id,previous_menu_id:this.current_menu},$item);}
this.open_menu(id);},on_menu_click:function(ev){ev.preventDefault();var needaction=$(ev.target).is('div.oe_menu_counter');this.menu_click($(ev.currentTarget).data('menu'),needaction);},});instance.web.UserMenu=instance.web.Widget.extend({template:"UserMenu",init:function(parent){this._super(parent);this.update_promise=$.Deferred().resolve();},start:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','.oe_dropdown_menu li a[data-menu]',function(ev){ev.preventDefault();var f=self['on_menu_'+$(this).data('menu')];if(f){f($(this));}});},do_update:function(){var self=this;var fct=function(){var $avatar=self.$el.find('.oe_topbar_avatar');$avatar.attr('src',$avatar.data('default-src'));if(!self.session.uid)
return;var func=new instance.web.Model("res.users").get_func("read");return self.alive(func(self.session.uid,["name","company_id"])).then(function(res){var topbar_name=res.name;if(instance.session.debug)
topbar_name=_.str.sprintf("%s (%s)",topbar_name,instance.session.db);if(res.company_id[0]>1)
topbar_name=_.str.sprintf("%s (%s)",topbar_name,res.company_id[1]);self.$el.find('.oe_topbar_name').text(topbar_name);if(!instance.session.debug){topbar_name=_.str.sprintf("%s (%s)",topbar_name,instance.session.db);}
var avatar_src=self.session.url('/web/binary/image',{model:'res.users',field:'image_small',id:self.session.uid});$avatar.attr('src',avatar_src);});};this.update_promise=this.update_promise.then(fct,fct);},on_menu_help:function(){window.open('http://help.openerp.com','_blank');},on_menu_logout:function(){this.trigger('user_logout');},on_menu_settings:function(){var self=this;if(!this.getParent().has_uncommitted_changes()){self.rpc("/web/action/load",{action_id:"base.action_res_users_my"}).done(function(result){result.res_id=instance.session.uid;self.getParent().action_manager.do_action(result);});}},on_menu_about:function(){var self=this;self.rpc("/web/webclient/version_info",{}).done(function(res){var $help=$(QWeb.render("UserMenu.about",{version_info:res}));$help.find('a.oe_activate_debug_mode').click(function(e){e.preventDefault();window.location=$.param.querystring(window.location.href,'debug');});instance.web.dialog($help,{autoOpen:true,modal:true,width:507,height:290,resizable:false,title:_t("About")});});},});instance.web.Client=instance.web.Widget.extend({init:function(parent,origin){instance.client=instance.webclient=this;this._super(parent);this.origin=origin;},start:function(){var self=this;return instance.session.session_bind(this.origin).then(function(){var $e=$(QWeb.render(self._template,{widget:self}));self.replaceElement($e);$e.openerpClass();self.bind_events();return self.show_common();});},bind_events:function(){var self=this;this.$el.on('mouseenter','.oe_systray > div:not([data-tipsy=true])',function(){$(this).attr('data-tipsy','true').tipsy().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.size()>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var doc_width=$(document).width();var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});instance.web.bus.on('click',this,function(ev){$.fn.tipsy.clear();if(!$(ev.target).is('input[type=file]')){self.$el.find('.oe_dropdown_menu.oe_opened, .oe_dropdown_toggle.oe_opened').removeClass('oe_opened');}});},show_common:function(){var self=this;this.crashmanager=new instance.web.CrashManager();instance.session.on('error',this.crashmanager,this.crashmanager.rpc_error);self.notification=new instance.web.Notification(this);self.notification.appendTo(self.$el);self.loading=new instance.web.Loading(self);self.loading.appendTo(self.$el);self.action_manager=new instance.web.ActionManager(self);self.action_manager.appendTo(self.$('.oe_application'));},toggle_bars:function(value){this.$('tr:has(td.oe_topbar),.oe_leftbar').toggle(value);},has_uncommitted_changes:function(){return false;},});instance.web.WebClient=instance.web.Client.extend({_template:'WebClient',events:{'click .oe_logo_edit_admin':'logo_edit'},init:function(parent){this._super(parent);this._current_state=null;this.menu_dm=new instance.web.DropMisordered();this.action_mutex=new $.Mutex();this.set('title_part',{"zopenerp":"OpenERP"});},start:function(){var self=this;this.on("change:title_part",this,this._title_changed);this._title_changed();return $.when(this._super()).then(function(){if(jQuery.param!==undefined&&jQuery.deparam(jQuery.param.querystring()).kitten!==undefined){$("body").addClass("kitten-mode-activated");$("body").css("background-image","url("+instance.session.origin+"/web/static/src/img/back-enable.jpg"+")");if($.blockUI){$.blockUI.defaults.message='<img src="http://www.amigrave.com/kitten.gif">';}}
if(!self.session.session_is_valid()){self.show_login();}else{self.show_application();}});},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},show_common:function(){var self=this;this._super();window.onerror=function(message,file,line){self.crashmanager.show_error({type:_t("Client Error"),message:message,data:{debug:file+':'+line}});};},show_login:function(){this.toggle_bars(false);var state=$.bbq.getState(true);var action={type:'ir.actions.client',tag:'login',_push_me:false,};this.action_manager.do_action(action);this.action_manager.inner_widget.on('login_successful',this,function(){this.show_application();});},show_application:function(){var self=this;self.toggle_bars(true);self.update_logo();self.menu=new instance.web.Menu(self);self.menu.replace(this.$el.find('.oe_menu_placeholder'));self.menu.on('menu_click',this,this.on_menu_action);self.user_menu=new instance.web.UserMenu(self);self.user_menu.replace(this.$el.find('.oe_user_menu_placeholder'));self.user_menu.on('user_logout',self,self.on_logout);self.user_menu.do_update();self.bind_hashchange();self.set_title();self.check_timezone();},update_logo:function(){var img=this.session.url('/web/binary/company_logo');this.$('.oe_logo img').attr('src','').attr('src',img);this.$('.oe_logo_edit').toggleClass('oe_logo_edit_admin',this.session.uid===1);},logo_edit:function(ev){var self=this;self.alive(new instance.web.Model("res.users").get_func("read")(this.session.uid,["company_id"])).then(function(res){self.rpc("/web/action/load",{action_id:"base.action_res_company_form"}).done(function(result){result.res_id=res['company_id'][0];result.target="new";result.views=[[false,'form']];result.flags={action_buttons:true,};self.action_manager.do_action(result);var form=self.action_manager.dialog_widget.views.form.controller;form.on("on_button_cancel",self.action_manager.dialog,self.action_manager.dialog.close);form.on('record_saved',self,function(){self.action_manager.dialog.close();self.update_logo();});});});return false;},check_timezone:function(){var self=this;return self.alive(new instance.web.Model('res.users').call('read',[[this.session.uid],['tz_offset']])).then(function(result){var user_offset=result[0]['tz_offset'];var offset=-(new Date().getTimezoneOffset());var browser_offset=(offset<0)?"-":"+";browser_offset+=_.str.sprintf("%02d",Math.abs(offset/60));browser_offset+=_.str.sprintf("%02d",Math.abs(offset%60));if(browser_offset!==user_offset){var $icon=$(QWeb.render('WebClient.timezone_systray'));$icon.on('click',function(){var notification=self.do_warn(_t("Timezone mismatch"),QWeb.render('WebClient.timezone_notification',{user_timezone:instance.session.user_context.tz||'UTC',user_offset:user_offset,browser_offset:browser_offset,}),true);notification.element.find('.oe_webclient_timezone_notification').on('click',function(){notification.close();}).find('a').on('click',function(){notification.close();self.user_menu.on_menu_settings();return false;});});$icon.appendTo(self.$('.oe_systray'));}});},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},do_reload:function(){var self=this;return this.session.session_reload().then(function(){instance.session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_notify:function(){var n=this.notification;return n.notify.apply(n,arguments);},do_warn:function(){var n=this.notification;return n.warn.apply(n,arguments);},on_logout:function(){var self=this;if(!this.has_uncommitted_changes()){this.session.session_logout().done(function(){$(window).unbind('hashchange',self.on_hashchange);self.do_push_state({});window.location.reload();});}},bind_hashchange:function(){var self=this;$(window).bind('hashchange',this.on_hashchange);var state=$.bbq.getState(true);if(_.isEmpty(state)||state.action=="login"){self.menu.has_been_loaded.done(function(){var first_menu_id=self.menu.$el.find("a:first").data("menu");if(first_menu_id){self.menu.menu_click(first_menu_id);}});}else{$(window).trigger('hashchange');}},on_hashchange:function(event){var self=this;var stringstate=event.getState(false);if(!_.isEqual(this._current_state,stringstate)){var state=event.getState(true);if(!state.action&&state.menu_id){self.menu.has_been_loaded.done(function(){self.menu.do_reload().done(function(){self.menu.menu_click(state.menu_id);});});}else{state._push_me=false;this.action_manager.do_load_state(state,!!this._current_state);}}
this._current_state=stringstate;},do_push_state:function(state){this.set_title(state.title);delete state.title;var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},on_menu_action:function(options){var self=this;return this.menu_dm.add(this.rpc("/web/action/load",{action_id:options.action_id})).then(function(result){return self.action_mutex.exec(function(){if(options.needaction){result.context=new instance.web.CompoundContext(result.context,{search_default_message_unread:true,search_disable_custom_filters:true,});}
var completed=$.Deferred();$.when(self.action_manager.do_action(result,{clear_breadcrumbs:true,action_menu_id:self.menu.current_menu,})).fail(function(){self.menu.open_menu(options.previous_menu_id);}).always(function(){completed.resolve();});setTimeout(function(){completed.resolve();},2000);return completed;});});},set_content_full_screen:function(fullscreen){$(document.body).css('overflow-y',fullscreen?'hidden':'scroll');this.$('.oe_webclient').toggleClass('oe_content_full_screen',fullscreen);},has_uncommitted_changes:function(){var $e=$.Event('clear_uncommitted_changes');instance.web.bus.trigger('clear_uncommitted_changes',$e);if($e.isDefaultPrevented()){return true;}else{return this._super.apply(this,arguments);}},});instance.web.EmbeddedClient=instance.web.Client.extend({_template:'EmbedClient',init:function(parent,origin,dbname,login,key,action_id,options){this._super(parent,origin);this.bind_credentials(dbname,login,key);this.action_id=action_id;this.options=options||{};},start:function(){var self=this;return $.when(this._super()).then(function(){return self.authenticate().then(function(){if(!self.action_id){return;}
return self.rpc("/web/action/load",{action_id:self.action_id}).done(function(result){var action=result;action.flags=_.extend({search_view:false,action_buttons:false,sidebar:false},self.options,action.flags||{});self.do_action(action);});});});},do_action:function(action){return this.action_manager.do_action(action);},authenticate:function(){var s=instance.session;if(s.session_is_valid()&&s.db===this.dbname&&s.login===this.login){return $.when();}
return instance.session.session_authenticate(this.dbname,this.login,this.key,true);},bind_credentials:function(dbname,login,key){this.dbname=dbname;this.login=login;this.key=key;},});instance.web.embed=function(origin,dbname,login,key,action,options){$('head').append($('<link>',{'rel':'stylesheet','type':'text/css','href':origin+'/web/webclient/css'}));var currentScript=document.currentScript;if(!currentScript){var sc=document.getElementsByTagName('script');currentScript=sc[sc.length-1];}
var client=new instance.web.EmbeddedClient(null,origin,dbname,login,key,action,options);client.insertAfter(currentScript);};};;openerp.web.views=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.ActionManager=instance.web.Widget.extend({init:function(parent){this._super(parent);this.inner_action=null;this.inner_widget=null;this.dialog=null;this.dialog_widget=null;this.breadcrumbs=[];this.on('history_back',this,function(){return this.history_back();});},start:function(){this._super.apply(this,arguments);this.$el.on('click','a.oe_breadcrumb_item',this.on_breadcrumb_clicked);},dialog_stop:function(){if(this.dialog){this.dialog.destroy();}
this.dialog=null;},push_breadcrumb:function(item){var last=this.breadcrumbs.slice(-1)[0];if(last){last.hide();}
var item=_.extend({show:function(index){this.widget.$el.show();},hide:function(){this.widget.$el.hide();},destroy:function(){this.widget.destroy();},get_title:function(){return this.title||this.widget.get('title');}},item);item.id=_.uniqueId('breadcrumb_');this.breadcrumbs.push(item);},history_back:function(){var last=this.breadcrumbs.slice(-1)[0];if(!last){return false;}
var title=last.get_title();if(_.isArray(title)&&title.length>1){return this.select_breadcrumb(this.breadcrumbs.length-1,title.length-2);}else if(this.breadcrumbs.length===1){return false;}else{var prev=this.breadcrumbs[this.breadcrumbs.length-2];title=prev.get_title();return this.select_breadcrumb(this.breadcrumbs.length-2,_.isArray(title)?title.length-1:undefined);}},on_breadcrumb_clicked:function(ev){var $e=$(ev.target);var id=$e.data('id');var index;for(var i=this.breadcrumbs.length-1;i>=0;i--){if(this.breadcrumbs[i].id==id){index=i;break;}}
var subindex=$e.parent().find('a.oe_breadcrumb_item[data-id='+$e.data('id')+']').index($e);this.select_breadcrumb(index,subindex);},select_breadcrumb:function(index,subindex){var next_item=this.breadcrumbs[index+1];if(next_item&&next_item.on_reverse_breadcrumb){next_item.on_reverse_breadcrumb(this.breadcrumbs[index].widget);}
for(var i=this.breadcrumbs.length-1;i>=0;i--){if(i>index){if(this.remove_breadcrumb(i)===false){return false;}}}
var item=this.breadcrumbs[index];item.show(subindex);this.inner_widget=item.widget;this.inner_action=item.action;return true;},clear_breadcrumbs:function(){for(var i=this.breadcrumbs.length-1;i>=0;i--){if(this.remove_breadcrumb(0)===false){break;}}},remove_breadcrumb:function(index){var item=this.breadcrumbs.splice(index,1)[0];if(item){var dups=_.filter(this.breadcrumbs,function(it){return item.widget===it.widget;});if(!dups.length){if(this.getParent().has_uncommitted_changes()){this.inner_widget=item.widget;this.inner_action=item.action;this.breadcrumbs.splice(index,0,item);return false;}else{item.destroy();}}}
var last_widget=this.breadcrumbs.slice(-1)[0];if(last_widget){this.inner_widget=last_widget.widget;this.inner_action=last_widget.action;}},get_title:function(){var titles=[];for(var i=0;i<this.breadcrumbs.length;i+=1){var item=this.breadcrumbs[i];var tit=item.get_title();if(!_.isArray(tit)){tit=[tit];}
for(var j=0;j<tit.length;j+=1){var label=_.escape(tit[j]);if(i===this.breadcrumbs.length-1&&j===tit.length-1){titles.push(_.str.sprintf('<span class="oe_breadcrumb_item">%s</span>',label));}else{titles.push(_.str.sprintf('<a href="#" class="oe_breadcrumb_item" data-id="%s">%s</a>',item.id,label));}}}
return titles.join(' <span class="oe_fade">/</span> ');},do_push_state:function(state){state=state||{};if(this.getParent()&&this.getParent().do_push_state){if(this.inner_action){if(this.inner_action._push_me===false){return;}
state['title']=this.inner_action.name;if(this.inner_action.type=='ir.actions.act_window'){state['model']=this.inner_action.res_model;}
if(this.inner_action.menu_id){state['menu_id']=this.inner_action.menu_id;}
if(this.inner_action.id){state['action']=this.inner_action.id;}else if(this.inner_action.type=='ir.actions.client'){state['action']=this.inner_action.tag;var params={};_.each(this.inner_action.params,function(v,k){if(_.isString(v)||_.isNumber(v)){params[k]=v;}});state=_.extend(params||{},state);}
if(this.inner_action.context){var active_id=this.inner_action.context.active_id;if(active_id){state["active_id"]=active_id;}
var active_ids=this.inner_action.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state["active_ids"]=this.inner_action.context.active_ids.join(',');}}}
if(!this.dialog){this.getParent().do_push_state(state);}}},do_load_state:function(state,warm){var self=this,action_loaded;if(state.action){if(_.isString(state.action)&&instance.web.client_actions.contains(state.action)){var action_client={type:"ir.actions.client",tag:state.action,params:state,_push_me:state._push_me,};this.null_action();action_loaded=this.do_action(action_client);}else{var run_action=(!this.inner_widget||!this.inner_widget.action)||this.inner_widget.action.id!==state.action;if(run_action){var add_context={};if(state.active_id){add_context.active_id=state.active_id;}
if(state.active_ids){add_context.active_ids=state.active_ids.toString().split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){add_context.active_ids=[state.active_id];}
this.null_action();action_loaded=this.do_action(state.action,{additional_context:add_context});$.when(action_loaded||null).done(function(){instance.webclient.menu.has_been_loaded.done(function(){if(self.inner_action&&self.inner_action.id){instance.webclient.menu.open_action(self.inner_action.id);}});});}}}else if(state.model&&state.id){this.null_action();var action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[false,'form']]};action_loaded=this.do_action(action);}else if(state.sa){this.null_action();action_loaded=this.rpc('/web/session/get_session_action',{key:state.sa}).then(function(action){if(action){return self.do_action(action);}});}
$.when(action_loaded||null).done(function(){if(self.inner_widget&&self.inner_widget.do_load_state){self.inner_widget.do_load_state(state,warm);}});},do_action:function(action,options){options=_.defaults(options||{},{clear_breadcrumbs:false,on_reverse_breadcrumb:function(){},on_close:function(){},action_menu_id:null,additional_context:{},});if(action===false){action={type:'ir.actions.act_window_close'};}else if(_.isString(action)&&instance.web.client_actions.contains(action)){var action_client={type:"ir.actions.client",tag:action,params:{}};return this.do_action(action_client,options);}else if(_.isNumber(action)||_.isString(action)){var self=this;return self.rpc("/web/action/load",{action_id:action}).then(function(result){return self.do_action(result,options);});}
var ncontext=new instance.web.CompoundContext(options.additional_context,action.context||{});action.context=instance.web.pyeval.eval('context',ncontext);if(action.context.active_id||action.context.active_ids){action.context.search_disable_custom_filters=true;}
if(action.domain){action.domain=instance.web.pyeval.eval('domain',action.domain,action.context||{});}
if(!action.type){console.error("No type for action",action);return $.Deferred().reject();}
var type=action.type.replace(/\./g,'_');var popup=action.target==='new';var inline=action.target==='inline'||action.target==='inlineview';action.flags=_.defaults(action.flags||{},{views_switcher:!popup&&!inline,search_view:!popup&&!inline,action_buttons:!popup&&!inline,sidebar:!popup&&!inline,pager:!popup&&!inline,display_title:!popup,search_disable_custom_filters:action.context&&action.context.search_disable_custom_filters});action.menu_id=options.action_menu_id;if(!(type in this)){console.error("Action manager can't handle action of type "+action.type,action);return $.Deferred().reject();}
return this[type](action,options);},null_action:function(){this.dialog_stop();this.clear_breadcrumbs();},ir_actions_common:function(executor,options){if(this.inner_widget&&executor.action.target!=='new'){if(this.getParent().has_uncommitted_changes()){return $.Deferred().reject();}else if(options.clear_breadcrumbs){this.clear_breadcrumbs();}}
var widget=executor.widget();if(executor.action.target==='new'){if(this.dialog_widget&&!this.dialog_widget.isDestroyed()){this.dialog_widget.destroy();}
this.dialog_stop();this.dialog=new instance.web.Dialog(this,{dialogClass:executor.klass,});this.dialog.on("closing",null,options.on_close);this.dialog.dialog_title=executor.action.name;if(widget instanceof instance.web.ViewManager){_.extend(widget.flags,{$buttons:this.dialog.$buttons,footer_to_buttons:true,});}
this.dialog_widget=widget;this.dialog_widget.setParent(this.dialog);var initialized=this.dialog_widget.appendTo(this.dialog.$el);this.dialog.open();return initialized;}else{this.dialog_stop();this.inner_action=executor.action;this.inner_widget=widget;executor.post_process(widget);return this.inner_widget.appendTo(this.$el);}},ir_actions_act_window:function(action,options){var self=this;return this.ir_actions_common({widget:function(){return new instance.web.ViewManagerAction(self,action);},action:action,klass:'oe_act_window',post_process:function(widget){widget.add_breadcrumb(options.on_reverse_breadcrumb);}},options);},ir_actions_client:function(action,options){var self=this;var ClientWidget=instance.web.client_actions.get_object(action.tag);if(!(ClientWidget.prototype instanceof instance.web.Widget)){var next;if(next=ClientWidget(this,action)){return this.do_action(next,options);}
return $.when();}
return this.ir_actions_common({widget:function(){return new ClientWidget(self,action);},action:action,klass:'oe_act_client',post_process:function(widget){self.push_breadcrumb({widget:widget,title:action.name,on_reverse_breadcrumb:options.on_reverse_breadcrumb,});if(action.tag!=='reload'){self.do_push_state({});}}},options);},ir_actions_act_window_close:function(action,options){if(!this.dialog){options.on_close();}
this.dialog_stop();return $.when();},ir_actions_server:function(action,options){var self=this;this.rpc('/web/action/run',{action_id:action.id,context:action.context||{}}).done(function(action){self.do_action(action,options)});},ir_actions_report_xml:function(action,options){var self=this;instance.web.blockUI();return instance.web.pyeval.eval_domains_and_contexts({contexts:[action.context],domains:[]}).then(function(res){action=_.clone(action);action.context=res.context;var c=instance.webclient.crashmanager;return $.Deferred(function(d){self.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:instance.web.unblockUI,success:function(){if(!self.dialog){options.on_close();}
self.dialog_stop();d.resolve();},error:function(){c.rpc_error.apply(c,arguments);d.reject();}})});});},ir_actions_act_url:function(action){window.open(action.url,action.target==='self'?'_self':'_blank');return $.when();},});instance.web.ViewManager=instance.web.Widget.extend({template:"ViewManager",init:function(parent,dataset,views,flags){this._super(parent);this.url_states={};this.model=dataset?dataset.model:undefined;this.dataset=dataset;this.searchview=null;this.active_view=null;this.views_src=_.map(views,function(x){if(x instanceof Array){var view_type=x[1];var View=instance.web.views.get_object(view_type,true);var view_label=View?View.prototype.display_name:(void'nope');return{view_id:x[0],view_type:view_type,label:view_label,button_label:View?_.str.sprintf(_t('%(view_type)s view'),{'view_type':(view_label||view_type)}):(void'nope'),};}else{return x;}});this.views={};this.flags=flags||{};this.registry=instance.web.views;this.views_history=[];this.view_completely_inited=$.Deferred();},start:function(){this._super();var self=this;this.$el.find('.oe_view_manager_switch a').click(function(){self.switch_mode($(this).data('view-type'));}).tipsy();var views_ids={};_.each(this.views_src,function(view){self.views[view.view_type]=$.extend({},view,{deferred:$.Deferred(),controller:null,options:_.extend({$buttons:self.$el.find('.oe_view_manager_buttons'),$sidebar:self.flags.sidebar?self.$el.find('.oe_view_manager_sidebar'):undefined,$pager:self.$el.find('.oe_view_manager_pager'),action:self.action,action_views_ids:views_ids},self.flags,self.flags[view.view_type]||{},view.options||{})});views_ids[view.view_type]=view.view_id;});if(this.flags.views_switcher===false){this.$el.find('.oe_view_manager_switch').hide();}
var default_view=this.flags.default_view||this.views_src[0].view_type;return this.switch_mode(default_view);},switch_mode:function(view_type,no_store,view_options){var self=this;var view=this.views[view_type];var view_promise;var form=this.views['form'];if(!view||(form&&form.controller&&!form.controller.can_be_discarded())){self.trigger('switch_mode',view_type,no_store,view_options);return $.Deferred().reject();}
if(!no_store){this.views_history.push(view_type);}
this.active_view=view_type;if(!view.controller){view_promise=this.do_create_view(view_type);}else if(this.searchview&&self.flags.auto_search&&view.controller.searchable!==false){this.searchview.ready.done(this.searchview.do_search);}
if(this.searchview){this.searchview[(view.controller.searchable===false||this.searchview.options.hidden)?'hide':'show']();}
this.$el.find('.oe_view_manager_switch a').parent().removeClass('active');this.$el.find('.oe_view_manager_switch a').filter('[data-view-type="'+view_type+'"]').parent().addClass('active');return $.when(view_promise).done(function(){_.each(_.keys(self.views),function(view_name){var controller=self.views[view_name].controller;if(controller){var container=self.$el.find("> .oe_view_manager_body > .oe_view_manager_view_"+view_name);if(view_name===view_type){container.show();controller.do_show(view_options||{});}else{container.hide();controller.do_hide();}}});self.trigger('switch_mode',view_type,no_store,view_options);});},do_create_view:function(view_type){var self=this;var view=this.views[view_type];var viewclass=this.registry.get_object(view_type);var options=_.clone(view.options);if(view_type==="form"&&this.action&&(this.action.target=='new'||this.action.target=='inline')){options.initial_mode='edit';}
var controller=new viewclass(this,this.dataset,view.view_id,options);controller.on('history_back',this,function(){var am=self.getParent();if(am&&am.trigger){return am.trigger('history_back');}});controller.on("change:title",this,function(){if(self.active_view===view_type){self.set_title(controller.get('title'));}});if(view.embedded_view){controller.set_embedded_view(view.embedded_view);}
controller.on('switch_mode',self,this.switch_mode);controller.on('previous_view',self,this.prev_view);var container=this.$el.find("> .oe_view_manager_body > .oe_view_manager_view_"+view_type);var view_promise=controller.appendTo(container);this.views[view_type].controller=controller;this.views[view_type].deferred.resolve(view_type);return $.when(view_promise).done(function(){if(self.searchview&&self.flags.auto_search&&view.controller.searchable!==false){self.searchview.ready.done(self.searchview.do_search);}else{self.view_completely_inited.resolve();}
self.trigger("controller_inited",view_type,controller);});},get_view_id:function(view_type){return this.views[view_type]&&this.views[view_type].view_id||false;},set_title:function(title){this.$el.find('.oe_view_title_text:first').text(title);},add_breadcrumb:function(on_reverse_breadcrumb){var self=this;var views=[this.active_view||this.views_src[0].view_type];this.on('switch_mode',self,function(mode){var last=views.slice(-1)[0];if(mode!==last){if(mode!=='form'){views.length=0;}
views.push(mode);}});this.getParent().push_breadcrumb({widget:this,action:this.action,show:function(index){var view_to_select=views[index];var state=self.url_states[view_to_select];self.do_push_state(state||{});$.when(self.switch_mode(view_to_select)).done(function(){self.$el.show();});},get_title:function(){var id;var currentIndex;_.each(self.getParent().breadcrumbs,function(bc,i){if(bc.widget===self){currentIndex=i;}});var next=self.getParent().breadcrumbs.slice(currentIndex+1)[0];var titles=_.map(views,function(v){var controller=self.views[v].controller;if(v==='form'){id=controller.datarecord.id;}
return controller.get('title');});if(next&&next.action&&next.action.res_id&&self.dataset&&self.active_view==='form'&&self.dataset.model===next.action.res_model&&id===next.action.res_id){titles.pop();}
return titles;},on_reverse_breadcrumb:on_reverse_breadcrumb,});},prev_view:function(options){options=options||{};var current_view=this.views_history.pop();var previous_view=this.views_history[this.views_history.length-1]||options['default'];if(options.created&&current_view==='form'&&previous_view==='list'){return this.switch_mode('form');}else if(options.created&&!previous_view&&this.action&&this.action.flags.default_view==='form'){return this.switch_mode('form');}
return this.switch_mode(previous_view,true);},setup_search_view:function(view_id,search_defaults){var self=this;if(this.searchview){this.searchview.destroy();}
var options={hidden:this.flags.search_view===false,disable_custom_filters:this.flags.search_disable_custom_filters,};this.searchview=new instance.web.SearchView(this,this.dataset,view_id,search_defaults,options);this.searchview.on('search_data',self,this.do_searchview_search);return this.searchview.appendTo(this.$el.find(".oe_view_manager_view_search"));},do_searchview_search:function(domains,contexts,groupbys){var self=this,controller=this.views[this.active_view].controller,action_context=this.action.context||{};instance.web.pyeval.eval_domains_and_contexts({domains:[this.action.domain||[]].concat(domains||[]),contexts:[action_context].concat(contexts||[]),group_by_seq:groupbys||[]}).done(function(results){self.dataset._model=new instance.web.Model(self.dataset.model,results.context,results.domain);var groupby=results.group_by.length?results.group_by:action_context.group_by;if(_.isString(groupby)){groupby=[groupby];}
$.when(controller.do_search(results.domain,results.context,groupby||[])).then(function(){self.view_completely_inited.resolve();});});},on_action:function(action){},on_create:function(){},on_remove:function(){},on_edit:function(){},on_action_executed:function(){},});instance.web.ViewManagerAction=instance.web.ViewManager.extend({template:"ViewManagerAction",init:function(parent,action){var flags=action.flags||{};if(!('auto_search'in flags)){flags.auto_search=action.auto_search!==false;}
if(action.res_model=='board.board'&&action.view_mode==='form'){_.extend(flags,{views_switcher:false,display_title:false,search_view:false,pager:false,sidebar:false,action_buttons:false});}
this._super(parent,null,action.views,flags);this.session=parent.session;this.action=action;var dataset=new instance.web.DataSetSearch(this,action.res_model,action.context,action.domain);if(action.res_id){dataset.ids.push(action.res_id);dataset.index=0;}
this.dataset=dataset;},start:function(){var self=this,searchview_loaded,search_defaults={};_.each(this.action.context,function(value,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value;}});var searchview_id=this.action['search_view_id']&&this.action['search_view_id'][0];searchview_loaded=this.setup_search_view(searchview_id||false,search_defaults);var main_view_loaded=this._super();var manager_ready=$.when(searchview_loaded,main_view_loaded,this.view_completely_inited);this.$el.find('.oe_debug_view').change(this.on_debug_changed);this.$el.addClass("oe_view_manager_"+(this.action.target||'current'));return manager_ready;},on_debug_changed:function(evt){var self=this,$sel=$(evt.currentTarget),$option=$sel.find('option:selected'),val=$sel.val(),current_view=this.views[this.active_view].controller;switch(val){case'fvg':var dialog=new instance.web.Dialog(this,{title:_t("Fields View Get"),width:'95%'}).open();$('<pre>').text(instance.web.json_node_to_xml(current_view.fields_view.arch,true)).appendTo(dialog.$el);break;case'tests':this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});break;case'perm_read':var ids=current_view.get_selected_ids();if(ids.length===1){this.dataset.call('perm_read',[ids]).done(function(result){var dialog=new instance.web.Dialog(this,{title:_.str.sprintf(_t("View Log (%s)"),self.dataset.model),width:400},QWeb.render('ViewManagerDebugViewLog',{perm:result[0],format:instance.web.format_value})).open();});}
break;case'toggle_layout_outline':current_view.rendering_engine.toggle_layout_debugging();break;case'set_defaults':current_view.open_defaults_dialog();break;case'translate':this.do_action({name:_t("Technical Translation"),res_model:'ir.translation',domain:[['type','!=','object'],'|',['name','=',this.dataset.model],['name','ilike',this.dataset.model+',']],views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_type:"list",view_mode:"list"});break;case'fields':this.dataset.call('fields_get',[false,{}]).done(function(fields){var $root=$('<dl>');_(fields).each(function(attributes,name){$root.append($('<dt>').append($('<h4>').text(name)));var $attrs=$('<dl>').appendTo($('<dd>').appendTo($root));_(attributes).each(function(def,name){if(def instanceof Object){def=JSON.stringify(def);}
$attrs.append($('<dt>').text(name)).append($('<dd style="white-space: pre-wrap;">').text(def));});});new instance.web.Dialog(self,{title:_.str.sprintf(_t("Model %s fields"),self.dataset.model),width:'95%'},$root).open();});break;case'edit_workflow':return this.do_action({res_model:'workflow',domain:[['osv','=',this.dataset.model]],views:[[false,'list'],[false,'form'],[false,'diagram']],type:'ir.actions.act_window',view_type:'list',view_mode:'list'});break;case'edit':this.do_edit_resource($option.data('model'),$option.data('id'),{name:$option.text()});break;case'manage_filters':this.do_action({res_model:'ir.filters',views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this.dataset.model}});break;case'print_workflow':if(current_view.get_selected_ids&&current_view.get_selected_ids().length==1){instance.web.blockUI();var action={context:{active_ids:current_view.get_selected_ids()},report_name:"workflow.instance.graph",datas:{model:this.dataset.model,id:current_view.get_selected_ids()[0],nested:true,}};this.session.get_file({url:'/web/report',data:{action:JSON.stringify(action)},complete:instance.web.unblockUI});}
break;default:if(val){console.log("No debug handler for ",val);}}
evt.currentTarget.selectedIndex=0;},do_edit_resource:function(model,id,action){var action=_.extend({res_model:model,res_id:id,type:'ir.actions.act_window',view_type:'form',view_mode:'form',views:[[false,'form']],target:'new',flags:{action_buttons:true,form:{resize_textareas:true}}},action||{});this.do_action(action);},switch_mode:function(view_type,no_store,options){var self=this;return $.when(this._super.apply(this,arguments)).done(function(){var controller=self.views[self.active_view].controller;self.$el.find('.oe_debug_view').html(QWeb.render('ViewManagerDebug',{view:controller,view_manager:self}));self.set_title();});},do_create_view:function(view_type){var self=this;return this._super.apply(this,arguments).then(function(){var view=self.views[view_type].controller;view.set({'title':self.action.name});});},get_action_manager:function(){var cur=this;while(cur=cur.getParent()){if(cur instanceof instance.web.ActionManager){return cur;}}
return undefined;},set_title:function(title){this.$el.find('.oe_breadcrumb_title:first').html(this.get_action_manager().get_title());},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){state["view_type"]=this.active_view;this.url_states[this.active_view]=state;this.getParent().do_push_state(state);}},do_load_state:function(state,warm){var self=this,defs=[];if(state.view_type&&state.view_type!==this.active_view){defs.push(this.views[this.active_view].deferred.then(function(){return self.switch_mode(state.view_type,true);}));}
$.when(defs).done(function(){self.views[self.active_view].controller.do_load_state(state,warm);});},});instance.web.Sidebar=instance.web.Widget.extend({init:function(parent){var self=this;this._super(parent);var view=this.getParent();this.sections=[{'name':'print','label':_t('Print'),},{'name':'other','label':_t('More'),}];this.items={'print':[],'other':[]};this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.do_attachement_update(self.dataset,self.model_id,args);instance.web.unblockUI();});},start:function(){var self=this;this._super(this);this.redraw();this.$el.on('click','.oe_dropdown_menu li a',function(event){var section=$(this).data('section');var index=$(this).data('index');var item=self.items[section][index];if(item.callback){item.callback.apply(self,[item]);}else if(item.action){self.on_item_action_clicked(item);}else if(item.url){return true;}
event.preventDefault();});},redraw:function(){var self=this;self.$el.html(QWeb.render('Sidebar',{widget:self}));this.$('.oe_form_dropdown_section').each(function(){$(this).toggle(!!$(this).find('li').length);});self.$("[title]").tipsy({'html':true,'delayIn':500,})},add_items:function(section_code,items){var self=this;if(items){this.items[section_code].push.apply(this.items[section_code],items);this.redraw();}},add_toolbar:function(toolbar){var self=this;_.each(['print','action','relate'],function(type){var items=toolbar[type];if(items){for(var i=0;i<items.length;i++){items[i]={label:items[i]['name'],action:items[i],classname:'oe_sidebar_'+type}}
self.add_items(type=='print'?'print':'other',items);}});},on_item_action_clicked:function(item){var self=this;self.getParent().sidebar_eval_context().done(function(sidebar_eval_context){var ids=self.getParent().get_selected_ids();if(ids.length==0){instance.web.dialog($("<div />").text(_t("You must choose at least one record.")),{title:_t("Warning"),modal:true});return false;}
var active_ids_context={active_id:ids[0],active_ids:ids,active_model:self.getParent().dataset.model};var c=instance.web.pyeval.eval('context',new instance.web.CompoundContext(sidebar_eval_context,active_ids_context));self.rpc("/web/action/load",{action_id:item.action.id,context:c}).done(function(result){result.context=new instance.web.CompoundContext(result.context||{},active_ids_context).set_eval_context(c);result.flags=result.flags||{};result.flags.new_window=true;self.do_action(result,{on_close:function(){self.getParent().reload();},});});});},do_attachement_update:function(dataset,model_id,args){var self=this;this.dataset=dataset;this.model_id=model_id;if(args&&args[0].error){this.do_warn(instance.web.qweb.render('message_error_uploading'),args[0].error);}
if(!model_id){this.on_attachments_loaded([]);}else{var dom=[['res_model','=',dataset.model],['res_id','=',model_id],['type','in',['binary','url']]];var ds=new instance.web.DataSetSearch(this,'ir.attachment',dataset.get_context(),dom);ds.read_slice(['name','url','type','create_uid','create_date','write_uid','write_date'],{}).done(this.on_attachments_loaded);}},on_attachments_loaded:function(attachments){var self=this;var items=[];var prefix=this.session.url('/web/binary/saveas',{model:'ir.attachment',field:'datas',filename_field:'name'});_.each(attachments,function(a){a.label=a.name;if(a.type==="binary"){a.url=prefix+'&id='+a.id+'&t='+(new Date().getTime());}});self.items['files']=attachments;self.redraw();this.$('.oe_sidebar_add_attachment .oe_form_binary_file').change(this.on_attachment_changed);this.$el.find('.oe_sidebar_delete_item').click(this.on_attachment_delete);},on_attachment_changed:function(e){var $e=$(e.target);if($e.val()!==''){this.$el.find('form.oe_form_binary_form').submit();$e.parent().find('input[type=file]').prop('disabled',true);$e.parent().find('button').prop('disabled',true).find('img, span').toggle();this.$('.oe_sidebar_add_attachment span').text(_t('Uploading...'));instance.web.blockUI();}},on_attachment_delete:function(e){e.preventDefault();e.stopPropagation();var self=this;var $e=$(e.currentTarget);if(confirm(_t("Do you really want to delete this attachment ?"))){(new instance.web.DataSet(this,'ir.attachment')).unlink([parseInt($e.attr('data-id'),10)]).done(function(){self.do_attachement_update(self.dataset,self.model_id);});}}});instance.web.View=instance.web.Widget.extend({display_name:'',view_type:undefined,init:function(parent,dataset,view_id,options){this._super(parent);this.dataset=dataset;this.view_id=view_id;this.set_default_options(options);},start:function(){return this.load_view();},load_view:function(context){var self=this;var view_loaded_def;if(this.embedded_view){view_loaded_def=$.Deferred();$.async_when().done(function(){view_loaded_def.resolve(self.embedded_view);});}else{if(!this.view_type)
console.warn("view_type is not defined",this);view_loaded_def=instance.web.fields_view_get({"model":this.dataset._model,"view_id":this.view_id,"view_type":this.view_type,"toolbar":!!this.options.$sidebar,});}
return view_loaded_def.then(function(r){self.fields_view=r;self.$el.addClass('oe_view').toggleClass('oe_cannot_create',!self.is_action_enabled('create')).toggleClass('oe_cannot_edit',!self.is_action_enabled('edit')).toggleClass('oe_cannot_delete',!self.is_action_enabled('delete'));return $.when(self.view_loading(r)).then(function(){self.trigger('view_loaded',r);});});},view_loading:function(r){},set_default_options:function(options){this.options=options||{};_.defaults(this.options,{$sidebar:null,sidebar_id:null,action:null,action_views_ids:{}});},do_execute_action:function(action_data,dataset,record_id,on_closed){var self=this;var result_handler=function(){if(on_closed){on_closed.apply(null,arguments);}
if(self.getParent()&&self.getParent().on_action_executed){return self.getParent().on_action_executed.apply(null,arguments);}};var context=new instance.web.CompoundContext(dataset.get_context(),action_data.context||{});var handler=function(action){if(action&&action.constructor==Object){var ncontext=new instance.web.CompoundContext(context);if(record_id){ncontext.add({active_id:record_id,active_ids:[record_id],active_model:dataset.model});}
ncontext.add(action.context||{});action.context=ncontext;return self.do_action(action,{on_close:result_handler,});}else{self.do_action({"type":"ir.actions.act_window_close"});return result_handler();}};if(action_data.special==='cancel'){return handler({"type":"ir.actions.act_window_close"});}else if(action_data.type=="object"){var args=[[record_id]],additional_args=[];if(action_data.args){try{additional_args=JSON.parse(action_data.args.replace(/'/g,'"'));args=args.concat(additional_args);}catch(e){console.error("Could not JSON.parse arguments",action_data.args);}}
args.push(context);return dataset.call_button(action_data.name,args).then(handler);}else if(action_data.type=="action"){return this.rpc('/web/action/load',{action_id:action_data.name,context:instance.web.pyeval.eval('context',context),do_not_eval:true}).then(handler);}else{return dataset.exec_workflow(record_id,action_data.name).then(handler);}},set_embedded_view:function(embedded_view){this.embedded_view=embedded_view;},do_show:function(){this.$el.show();},do_hide:function(){this.$el.hide();},is_active:function(){var manager=this.getParent();return!manager||!manager.active_view||manager.views[manager.active_view].controller===this;},guard_active:function(fn){var self=this;return function(){if(self.is_active()){fn.apply(self,arguments);}}},do_push_state:function(state){if(this.getParent()&&this.getParent().do_push_state){this.getParent().do_push_state(state);}},do_load_state:function(state,warm){},do_switch_view:function(){this.trigger.apply(this,['switch_mode'].concat(_.toArray(arguments)));},do_search:function(view){},on_sidebar_export:function(){new instance.web.DataExport(this,this.dataset).open();},sidebar_eval_context:function(){return $.when({});},reload:function(){return $.when();},is_action_enabled:function(action){var attrs=this.fields_view.arch.attrs;return(action in attrs)?JSON.parse(attrs[action]):true;}});instance.web.fields_view_get=function(args){function postprocess(fvg){var doc=$.parseXML(fvg.arch).documentElement;fvg.arch=instance.web.xml_to_json(doc,(doc.nodeName.toLowerCase()!=='kanban'));if('id'in fvg.fields){var id_field=fvg.fields['id'];id_field.original_type=id_field.type;id_field.type='id';}
_.each(fvg.fields,function(field){_.each(field.views||{},function(view){postprocess(view);});});return fvg;}
args=_.defaults(args,{toolbar:false,});var model=args.model;if(typeof model==='string'){model=new instance.web.Model(args.model,args.context);}
return args.model.call('fields_view_get',[args.view_id,args.view_type,model.context(),args.toolbar]).then(function(fvg){return postprocess(fvg);});};instance.web.xml_to_json=function(node,strip_whitespace){switch(node.nodeType){case 9:return instance.web.xml_to_json(node.documentElement,strip_whitespace);case 3:case 4:return(strip_whitespace&&node.data.trim()==='')?undefined:node.data;case 1:var attrs=$(node).getAttributes();_.each(['domain','filter_domain','context','default_get'],function(key){if(attrs[key]){try{attrs[key]=JSON.parse(attrs[key]);}catch(e){}}});return{tag:node.tagName.toLowerCase(),attrs:attrs,children:_.compact(_.map(node.childNodes,function(node){return instance.web.xml_to_json(node,strip_whitespace);})),}}}
instance.web.json_node_to_xml=function(node,human_readable,indent){indent=indent||0;var sindent=(human_readable?(new Array(indent+1).join('\t')):''),r=sindent+'<'+node.tag,cr=human_readable?'\n':'';if(typeof(node)==='string'){return sindent+node;}else if(typeof(node.tag)!=='string'||!node.children instanceof Array||!node.attrs instanceof Object){throw new Error(_.str.sprintf(_t("Node [%s] is not a JSONified XML node"),JSON.stringify(node)));}
for(var attr in node.attrs){var vattr=node.attrs[attr];if(typeof(vattr)!=='string'){vattr=JSON.stringify(vattr);}
vattr=vattr.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');if(human_readable){vattr=vattr.replace(/&quot;/g,"'");}
r+=' '+attr+'="'+vattr+'"';}
if(node.children&&node.children.length){r+='>'+cr;var childs=[];for(var i=0,ii=node.children.length;i<ii;i++){childs.push(instance.web.json_node_to_xml(node.children[i],human_readable,indent+1));}
r+=childs.join(cr);r+=cr+sindent+'</'+node.tag+'>';return r;}else{return r+'/>';}};instance.web.xml_to_str=function(node){var str="";if(window.XMLSerializer){str=(new XMLSerializer()).serializeToString(node);}else if(window.ActiveXObject){str=node.xml;}else{throw new Error(_t("Could not serialize XML"));}
var void_elements='area base br col command embed hr img input keygen link meta param source track wbr'.split(' ');str=str.replace(/<([a-z]+)([^<>]*)\s*\/\s*>/g,function(match,tag,attrs){if(void_elements.indexOf(tag)<0){return"<"+tag+attrs+"></"+tag+">";}else{return match;}});return str;};instance.web.views=new instance.web.Registry();};;openerp.web.data=function(instance){instance.web.serialize_sort=function(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');};instance.web.Query=instance.web.Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new instance.web.Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=new instance.web.CompoundDomain(q._filter,to_set.filter);break;case'context':q._context=new instance.web.CompoundContext(q._context,to_set.context);break;case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(){var self=this;return instance.session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:instance.web.pyeval.eval('domains',[this._model.domain(this._filter)]),context:instance.web.pyeval.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:instance.web.serialize_sort(this._order_by)}).then(function(results){self._count=results.length;return results.records;},null);},first:function(){var self=this;return this.clone({limit:1})._execute().then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(){return this._execute();},count:function(){if(this._count!=undefined){return $.when(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){if(grouping===undefined){return null;}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)){return null;}
var self=this;var ctx=instance.web.pyeval.eval('context',this._model.context(this._context));return this._model.call('read_group',{groupby:grouping,fields:_.uniq(grouping.concat(this._fields||[])),domain:this._model.domain(this._filter),context:this._model.context(this._context),offset:this._offset,limit:this._limit,orderby:instance.web.serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);return new instance.web.QueryGroup(self._model.name,grouping[0],result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});instance.web.QueryGroup=instance.web.Class.extend({init:function(model,grouping_field,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var aggregates={};_(fixed_group).each(function(value,key){if(key.indexOf('__')===0||key===grouping_field||key===grouping_field+'_count'){return;}
aggregates[key]=value||0;});this.model=new instance.web.Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[grouping_field+'_count']||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouping_field,length:group_size,value:fixed_group[grouping_field],has_children:!(leaf_group&&fixed_group.__context['group_by_no_leaf']),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});instance.web.Model=instance.web.Class.extend({init:function(model_name,context,domain){this.name=model_name;this._context=context||{};this._domain=domain||[];},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
instance.web.pyeval.ensure_evaluated(args,kwargs);var debug=instance.session.debug?'/'+this.name+':'+method:'';return instance.session.rpc('/web/dataset/call_kw'+debug,{model:this.name,method:method,args:args,kwargs:kwargs},options);},query:function(fields){return new instance.web.Query(this,fields);},exec_workflow:function(id,signal){return instance.session.rpc('/web/dataset/exec_workflow',{model:this.name,id:id,signal:signal});},domain:function(domain){if(!domain){return this._domain;}
return new instance.web.CompoundDomain(this._domain,domain);},context:function(context){return new instance.web.CompoundContext(instance.session.user_context,this._context,context||{});},call_button:function(method,args){instance.web.pyeval.ensure_evaluated(args,{});return instance.session.rpc('/web/dataset/call_button',{model:this.name,method:method,domain_id:null,context_id:args.length-1,args:args||[]});},});instance.web.DataSet=instance.web.Class.extend(instance.web.PropertiesMixin,{init:function(parent,model,context){instance.web.PropertiesMixin.init.call(this);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new instance.web.Model(model,context);},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){options=options||{};return this._model.call('read',[ids,fields||false],{context:this._model.context(options.context)});},read_slice:function(fields,options){var self=this;options=options||{};return this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all().done(function(records){self.ids=_(records).pluck('id');});},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return $.Deferred().reject().promise();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){return this._model.call('create',[data],{context:this.get_context()});},write:function(id,data,options){options=options||{};return this._model.call('write',[[id],data],{context:this.get_context(options.context)}).done(this.trigger('dataset_changed',id,data,options));},unlink:function(ids){return this._model.call('unlink',[ids],{context:this.get_context()}).done(this.trigger('dataset_changed',ids));},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name){return this._model.call('name_create',[name],{context:this.get_context()});},exec_workflow:function(id,signal){return this._model.exec_workflow(id,signal);},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return instance.web.serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},resequence:function(ids,options){options=options||{};return instance.session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:instance.web.pyeval.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});instance.web.DataSetStatic=instance.web.DataSet.extend({init:function(parent,model,context,ids){var self=this;this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return $.Deferred().resolve({result:true});},});instance.web.DataSetSearch=instance.web.DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new instance.web.Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);return q.all().done(function(records){q.count().done(function(count){self._length=count;});self.ids=_(records).pluck('id');});},get_domain:function(other_domain){this._model.domain(other_domain);},unlink:function(ids,callback,error_callback){var self=this;return this._super(ids).done(function(result){self.ids=_(self.ids).difference(ids);if(self._length){self._length-=1;}
if(self.index!==null){self.index=self.index<=self.ids.length-1?self.index:(self.ids.length>0?self.ids.length-1:0);}
self.trigger("dataset_changed",ids,callback,error_callback);});},size:function(){if(this._length!==undefined){return this._length;}
return this._super();}});instance.web.BufferedDataSet=instance.web.DataSetStatic.extend({virtual_id_prefix:"one2many_v_id_",debug_mode:true,init:function(){this._super.apply(this,arguments);this.reset_ids([]);this.last_default_get={};},default_get:function(fields,options){var self=this;return this._super(fields,options).done(function(res){self.last_default_get=res;});},create:function(data,options){var cached={id:_.uniqueId(this.virtual_id_prefix),values:_.extend({},data,(options||{}).readonly_fields||{}),defaults:this.last_default_get};this.to_create.push(_.extend(_.clone(cached),{values:_.clone(data)}));this.cache.push(cached);return $.Deferred().resolve(cached.id).promise();},write:function(id,data,options){var self=this;var record=_.detect(this.to_create,function(x){return x.id===id;});record=record||_.detect(this.to_write,function(x){return x.id===id;});var dirty=false;if(record){for(var k in data){if(record.values[k]===undefined||record.values[k]!==data[k]){dirty=true;break;}}
$.extend(record.values,data);}else{dirty=true;record={id:id,values:data};self.to_write.push(record);}
var cached=_.detect(this.cache,function(x){return x.id===id;});if(!cached){cached={id:id,values:{}};this.cache.push(cached);}
$.extend(cached.values,_.extend({},record.values,(options||{}).readonly_fields||{}));if(dirty)
this.trigger("dataset_changed",id,data,options);return $.Deferred().resolve(true).promise();},unlink:function(ids,callback,error_callback){var self=this;_.each(ids,function(id){if(!_.detect(self.to_create,function(x){return x.id===id;})){self.to_delete.push({id:id})}});this.to_create=_.reject(this.to_create,function(x){return _.include(ids,x.id);});this.to_write=_.reject(this.to_write,function(x){return _.include(ids,x.id);});this.cache=_.reject(this.cache,function(x){return _.include(ids,x.id);});this.set_ids(_.without.apply(_,[this.ids].concat(ids)));this.trigger("dataset_changed",ids,callback,error_callback);return $.async_when({result:true}).done(callback);},reset_ids:function(ids){this.set_ids(ids);this.to_delete=[];this.to_create=[];this.to_write=[];this.cache=[];this.delete_all=false;},read_ids:function(ids,fields,options){var self=this;var to_get=[];_.each(ids,function(id){var cached=_.detect(self.cache,function(x){return x.id===id;});var created=_.detect(self.to_create,function(x){return x.id===id;});if(created){_.each(fields,function(x){if(cached.values[x]===undefined)
cached.values[x]=created.defaults[x]||false;});}else{if(!cached||!_.all(fields,function(x){return cached.values[x]!==undefined}))
to_get.push(id);}});var completion=$.Deferred();var return_records=function(){var records=_.map(ids,function(id){return _.extend({},_.detect(self.cache,function(c){return c.id===id;}).values,{"id":id});});if(self.debug_mode){if(_.include(records,undefined)){throw"Record not correctly loaded";}}
var sort_fields=self._sort,compare=function(v1,v2){return(v1<v2)?-1:(v1>v2)?1:0;};if(sort_fields.length){records.sort(function(a,b){return _.reduce(sort_fields,function(acc,field){if(acc){return acc;}
var sign=1;if(field[0]==='-'){sign=-1;field=field.slice(1);}
return sign*compare(a[field],b[field]);},0);});}
completion.resolve(records);};if(to_get.length>0){var rpc_promise=this._super(to_get,fields,options).done(function(records){_.each(records,function(record,index){var id=to_get[index];var cached=_.detect(self.cache,function(x){return x.id===id;});if(!cached){self.cache.push({id:id,values:record});}else{cached.values=_.defaults(_.clone(cached.values),record);}});return_records();});$.when(rpc_promise).fail(function(){completion.reject();});}else{return_records();}
return completion.promise();},evict_record:function(id){for(var i=0,len=this.cache.length;i<len;++i){var record=this.cache[i];if(record.id===id){this.cache.splice(i,1);break;}}},call_button:function(method,args){this.evict_record(args[0][0]);return this._super(method,args);},exec_workflow:function(id,signal){this.evict_record(id);return this._super(id,signal);},alter_ids:function(n_ids){this._super(n_ids);this.trigger("dataset_changed",n_ids);},});instance.web.BufferedDataSet.virtual_id_regex=/^one2many_v_id_.*$/;instance.web.ProxyDataSet=instance.web.DataSetSearch.extend({init:function(){this._super.apply(this,arguments);this.create_function=null;this.write_function=null;this.read_function=null;this.default_get_function=null;this.unlink_function=null;},read_ids:function(ids,fields,options){if(this.read_function){return this.read_function(ids,fields,options,this._super);}else{return this._super.apply(this,arguments);}},default_get:function(fields,options){if(this.default_get_function){return this.default_get_function(fields,options,this._super);}else{return this._super.apply(this,arguments);}},create:function(data,options){if(this.create_function){return this.create_function(data,options,this._super);}else{return this._super.apply(this,arguments);}},write:function(id,data,options){if(this.write_function){return this.write_function(id,data,options,this._super);}else{return this._super.apply(this,arguments);}},unlink:function(ids){if(this.unlink_function){return this.unlink_function(ids,this._super);}else{return this._super.apply(this,arguments);}},});instance.web.CompoundContext=instance.web.Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;}});instance.web.CompoundDomain=instance.web.Class.extend({init:function(){this.__ref="compound_domain";this.__domains=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(domain){this.__domains.push(domain);return this;},set_eval_context:function(eval_context){this.__eval_context=eval_context;return this;},get_eval_context:function(){return this.__eval_context;}});instance.web.DropMisordered=instance.web.Class.extend({init:function(failMisordered){this.lsn=0;this.rsn=-1;this.failMisordered=failMisordered||false;},add:function(deferred){var res=$.Deferred();var self=this,seq=this.lsn++;deferred.done(function(){if(seq>self.rsn){self.rsn=seq;res.resolve.apply(res,arguments);}else if(self.failMisordered){res.reject();}}).fail(function(){res.reject.apply(res,arguments);});return res.promise();}});};;openerp.web.data_export=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.DataExport=instance.web.Dialog.extend({template:'ExportTreeView',dialog_title:{toString:function(){return _t("Export Data");}},init:function(parent,dataset){var self=this;options={buttons:[{text:_t("Close"),click:function(){self.close();}},{text:_t("Export To File"),click:function(){self.on_click_export_data();}}],close:function(event,ui){self.close();}}
this._super(parent,options);this.records={};this.dataset=dataset;this.exports=new instance.web.DataSetSearch(this,'ir.exports',this.dataset.get_context());},start:function(){var self=this;this._super.apply(this,arguments);self.$el.removeClass('ui-dialog-content ui-widget-content');self.$el.find('#add_field').click(function(){if($('#field-tree-structure tr.ui-selected')){var fld=self.$el.find('#field-tree-structure tr.ui-selected').find('a');for(var i=0;i<fld.length;i++){var id=$(fld[i]).attr('id').split('-')[1];var string=$(fld[i]).attr('string');self.add_field(id,string);}
self.$el.find('#field-tree-structure tr').removeClass('ui-selected');}});self.$el.find('#remove_field').click(function(){self.$el.find('#fields_list option:selected').remove();});self.$el.find('#remove_all_field').click(function(){self.$el.find('#fields_list').empty();});this.$el.find('#export_new_list').click(this.on_show_save_list);var got_fields=new $.Deferred();this.$el.find('#import_compat').change(function(){self.$el.find('#fields_list').empty();self.$el.find('#field-tree-structure').remove();var import_comp=self.$el.find("#import_compat").val();self.rpc("/web/export/get_fields",{model:self.dataset.model,import_compat:Boolean(import_comp)}).done(function(records){got_fields.resolve();self.on_show_data(records);});}).change();return $.when(got_fields,this.rpc('/web/export/formats',{}).done(this.do_setup_export_formats),this.show_exports_list());},do_setup_export_formats:function(formats){var $fmts=this.$el.find('#export_format');_(formats).each(function(format){var opt=new Option(format.label,format.tag);if(format.error){opt.disabled=true;opt.replaceChild(document.createTextNode(_.str.sprintf("%s — %s",format.label,format.error)),opt.childNodes[0])}
$fmts.append(opt);});},show_exports_list:function(){var self=this;if(self.$el.find('#saved_export_list').is(':hidden')){self.$el.find('#ExistsExportList').show();return;}
return this.exports.read_slice(['name'],{domain:[['resource','=',this.dataset.model]]}).done(function(export_list){if(!export_list.length){return;}
self.$el.find('#ExistsExportList').append(QWeb.render('Exists.ExportList',{'existing_exports':export_list}));self.$el.find('#saved_export_list').change(function(){self.$el.find('#fields_list option').remove();var export_id=self.$el.find('#saved_export_list option:selected').val();if(export_id){self.rpc('/web/export/namelist',{'model':self.dataset.model,export_id:parseInt(export_id)}).done(self.do_load_export_field);}});self.$el.find('#delete_export_list').click(function(){var select_exp=self.$el.find('#saved_export_list option:selected');if(select_exp.val()){self.exports.unlink([parseInt(select_exp.val(),10)]);select_exp.remove();if(self.$el.find('#saved_export_list option').length<=1){self.$el.find('#ExistsExportList').hide();}}});});},do_load_export_field:function(field_list){var export_node=this.$el.find("#fields_list");_(field_list).each(function(field){export_node.append(new Option(field.label,field.name));});},on_show_save_list:function(){var self=this;var current_node=self.$el.find("#savenewlist");if(!(current_node.find("label")).length){current_node.append(QWeb.render('ExportNewList'));current_node.find("#add_export_list").click(function(){var value=current_node.find("#savelist_name").val();if(value){self.do_save_export_list(value);}else{alert(_t("Please enter save field list name"));}});}else{if(current_node.is(':hidden')){current_node.show();current_node.find("#savelist_name").val("");}else{current_node.hide();}}},do_save_export_list:function(value){var self=this;var fields=self.get_fields();if(!fields.length){return;}
this.exports.create({name:value,resource:this.dataset.model,export_fields:_(fields).map(function(field){return[0,0,{name:field}];})},function(export_list_id){if(!export_list_id.result){return;}
self.$el.find("#saved_export_list").append(new Option(value,export_list_id.result));if(self.$el.find("#saved_export_list").is(":hidden")){self.show_exports_list();}});this.on_show_save_list();this.$el.find("#fields_list option").remove();},on_click:function(id,record){var self=this;if(!record['children']){return;}
var model=record['params']['model'],prefix=record['params']['prefix'],name=record['params']['name'],exclude_fields=[];if(record['relation_field']){exclude_fields.push(record['relation_field']);}
if(!record.loaded){var import_comp=self.$el.find("#import_compat").val();self.rpc("/web/export/get_fields",{model:model,prefix:prefix,parent_name:name,import_compat:Boolean(import_comp),parent_field_type:record['field_type'],exclude:exclude_fields}).done(function(results){record.loaded=true;self.on_show_data(results,record.id);});}else{self.showcontent(record.id);}},on_show_data:function(result,after){var self=this;var imp_cmpt=Boolean(self.$el.find("#import_compat").val());if(after){var current_tr=self.$el.find("tr[id='treerow-"+after+"']");current_tr.addClass('open');current_tr.find('img').attr('src','/web/static/src/img/collapse.gif');current_tr.after(QWeb.render('ExportTreeView-Secondary.children',{'fields':result}));}else{self.$el.find('#left_field_panel').append(QWeb.render('ExportTreeView-Secondary',{'fields':result}));}
_.each(result,function(record){self.records[record.id]=record.value;if(record.required){var required_fld=self.$el.find("tr[id='treerow-"+record.id+"']").find('#tree-column');required_fld.addClass("oe_export_requiredfield");}
self.$el.find("img[id='parentimg-"+record.id+"']").click(function(){self.on_click(this.id,record);});self.$el.find("tr[id='treerow-"+record.id+"']").click(function(e){if(e.shiftKey){var frst_click,scnd_click='';if(self.row_index==0){self.row_index=this.rowIndex;frst_click=self.$el.find("tr[id^='treerow-']")[self.row_index-1];$(frst_click).addClass("ui-selected");}else{if(this.rowIndex>=self.row_index){for(var i=(self.row_index-1);i<this.rowIndex;i++){scnd_click=self.$el.find("tr[id^='treerow-']")[i];if(!$(scnd_click).find('#tree-column').hasClass("oe_export_readonlyfield")){$(scnd_click).addClass("ui-selected");}}}else{for(var i=(self.row_index-1);i>=(this.rowIndex-1);i--){scnd_click=self.$el.find("tr[id^='treerow-']")[i];if(!$(scnd_click).find('#tree-column').hasClass("oe_export_readonlyfield")){$(scnd_click).addClass("ui-selected");}}}}}
self.row_index=this.rowIndex;self.$el.find("tr[id='treerow-"+record.id+"']").keyup(function(){self.row_index=0;});var o2m_selection=self.$el.find("tr[id='treerow-"+record.id+"']").find('#tree-column');if($(o2m_selection).hasClass("oe_export_readonlyfield")){return false;}
if(e.ctrlKey){if($(this).hasClass('ui-selected')){$(this).removeClass('ui-selected').find('a').blur();}else{$(this).addClass('ui-selected').find('a').focus();}}else if(!e.shiftKey){self.$el.find("tr.ui-selected").removeClass("ui-selected").find('a').blur();$(this).addClass("ui-selected").find('a').focus();}
return false;});self.$el.find("tr[id='treerow-"+record.id+"']").keydown(function(e){var keyCode=e.keyCode||e.which;var arrow={left:37,up:38,right:39,down:40};switch(keyCode){case arrow.left:if($(this).hasClass('open')){self.on_click(this.id,record);}
break;case arrow.right:if(!$(this).hasClass('open')){self.on_click(this.id,record);}
break;case arrow.up:var elem=this;$(elem).removeClass("ui-selected");while(!$(elem).prev().is(":visible")){elem=$(elem).prev();}
if(!$(elem).prev().find('#tree-column').hasClass("oe_export_readonlyfield")){$(elem).prev().addClass("ui-selected");}
$(elem).prev().find('a').focus();break;case arrow.down:var elem=this;$(elem).removeClass("ui-selected");while(!$(elem).next().is(":visible")){elem=$(elem).next();}
if(!$(elem).next().find('#tree-column').hasClass("oe_export_readonlyfield")){$(elem).next().addClass("ui-selected");}
$(elem).next().find('a').focus();break;}});self.$el.find("tr[id='treerow-"+record.id+"']").dblclick(function(){var $o2m_selection=self.$el.find("tr[id^='treerow-"+record.id+"']").find('#tree-column');if(!$o2m_selection.hasClass("oe_export_readonlyfield")){self.add_field(record.id,$(this).find("a").attr("string"));}});});self.$el.find('#fields_list').mouseover(function(event){if(event.relatedTarget){if(event.relatedTarget.attributes['id']&&event.relatedTarget.attributes['string']){var field_id=event.relatedTarget.attributes["id"]["value"];if(field_id&&field_id.split("-")[0]==='export'){if(!self.$el.find("tr[id='treerow-"+field_id.split("-")[1]+"']").find('#tree-column').hasClass("oe_export_readonlyfield")){self.add_field(field_id.split("-")[1],event.relatedTarget.attributes["string"]["value"]);}}}}});},showcontent:function(id){var $this=this.$el.find("tr[id='treerow-"+id+"']");var is_open=$this.hasClass('open');$this.toggleClass('open');var first_child=$this.find('img');if(is_open){first_child.attr('src','/web/static/src/img/expand.gif');}else{first_child.attr('src','/web/static/src/img/collapse.gif');}
var child_field=this.$el.find("tr[id^='treerow-"+id+"/']");var child_len=(id.split("/")).length+1;for(var i=0;i<child_field.length;i++){var $child=$(child_field[i]);if(is_open){$child.hide();}else if(child_len==(child_field[i].id.split("/")).length){if($child.hasClass('open')){$child.removeClass('open');$child.find('img').attr('src','/web/static/src/img/expand.gif');}
$child.show();}}},add_field:function(field_id,string){var field_list=this.$el.find('#fields_list');if(this.$el.find("#fields_list option[value='"+field_id+"']")&&!this.$el.find("#fields_list option[value='"+field_id+"']").length){field_list.append(new Option(string,field_id));}},get_fields:function(){var export_field=[];this.$el.find("#fields_list option").each(function(){export_field.push($(this).val());});if(!export_field.length){alert(_t("Please select fields to save export list..."));}
return export_field;},on_click_export_data:function(){var self=this;var exported_fields=this.$el.find('#fields_list option').map(function(){return{name:self.records[this.value]||this.value,label:this.textContent||this.innerText};}).get();if(_.isEmpty(exported_fields)){alert(_t("Please select fields to export..."));return;}
exported_fields.unshift({name:'id',label:'External ID'});var export_format=this.$el.find("#export_format").val();instance.web.blockUI();this.session.get_file({url:'/web/export/'+export_format,data:{data:JSON.stringify({model:this.dataset.model,fields:exported_fields,ids:this.dataset.ids,domain:this.dataset.domain,import_compat:Boolean(this.$el.find("#import_compat").val())})},complete:instance.web.unblockUI});},close:function(){this.$el.remove();this._super();}});};;openerp.web.search=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t,_lt=instance.web._lt;_.mixin({sum:function(obj){return _.reduce(obj,function(a,b){return a+b;},0);}});var my=instance.web.search={};var B=Backbone;my.FacetValue=B.Model.extend({});my.FacetValues=B.Collection.extend({model:my.FacetValue});my.Facet=B.Model.extend({initialize:function(attrs){var values=attrs.values;delete attrs.values;B.Model.prototype.initialize.apply(this,arguments);this.values=new my.FacetValues(values||[]);this.values.on('add remove change reset',function(){this.trigger('change',this);},this);},get:function(key){if(key!=='values'){return B.Model.prototype.get.call(this,key);}
return this.values.toJSON();},set:function(key,value){if(key!=='values'){return B.Model.prototype.set.call(this,key,value);}
this.values.reset(value);},toJSON:function(){var out={};var attrs=this.attributes;for(var att in attrs){if(!attrs.hasOwnProperty(att)||att==='field'){continue;}
out[att]=attrs[att];}
out.values=this.values.toJSON();return out;}});my.SearchQuery=B.Collection.extend({model:my.Facet,initialize:function(){B.Collection.prototype.initialize.apply(this,arguments);this.on('change',function(facet){if(!facet.values.isEmpty()){return;}
this.remove(facet,{silent:true});},this);},add:function(values,options){options||(options={});if(!(values instanceof Array)){values=[values];}
_(values).each(function(value){var model=this._prepareModel(value,options);var previous=this.detect(function(facet){return facet.get('category')===model.get('category')&&facet.get('field')===model.get('field');});if(previous){previous.values.add(model.get('values'));return;}
B.Collection.prototype.add.call(this,model,options);},this);return this;},toggle:function(value,options){options||(options={});var facet=this.detect(function(facet){return facet.get('category')===value.category&&facet.get('field')===value.field;});if(!facet){return this.add(value,options);}
var changed=false;_(value.values).each(function(val){var already_value=facet.values.detect(function(v){return v.get('value')===val.value&&v.get('label')===val.label;});if(already_value){facet.values.remove(already_value,{silent:true});}else{facet.values.add(val,{silent:true});}
changed=true;});facet.trigger('change',facet);return this;}});function assert(condition,message){if(!condition){throw new Error(message);}}
my.InputView=instance.web.Widget.extend({template:'SearchView.InputView',events:{focus:function(){this.trigger('focused',this);},blur:function(){this.$el.text('');this.trigger('blurred',this);},keydown:'onKeydown',paste:'onPaste',},getSelection:function(){var root=this.el.childNodes[0];if(!root||!root.textContent){return{start:0,end:0};}
var range=window.getSelection().getRangeAt(0);assert(range.startContainer===root,"selection should be in the input view");assert(range.endContainer===root,"selection should be in the input view");return{start:range.startOffset,end:range.endOffset}},onKeydown:function(e){var sel;switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();break;case $.ui.keyCode.BACKSPACE:sel=this.getSelection();if(sel.start===0&&sel.start===sel.end){e.preventDefault();var preceding=this.getParent().siblingSubview(this,-1);if(preceding&&(preceding instanceof my.FacetView)){preceding.model.destroy();}}
break;case $.ui.keyCode.LEFT:sel=this.getSelection();if(sel.start!==0||sel.start!==sel.end){e.stopPropagation();}
break;case $.ui.keyCode.RIGHT:sel=this.getSelection();var len=this.$el.text().length;if(sel.start!==len||sel.start!==sel.end){e.stopPropagation();}
break;}},setCursorAtEnd:function(){var sel=window.getSelection();sel.removeAllRanges();var range=document.createRange();range.selectNode(this.el.childNodes[0]);range.collapse(false);sel.addRange(range);},onPaste:function(){setTimeout(function(){var data=this.$el.text();this.$el.empty().text(data);this.setCursorAtEnd();}.bind(this),0);}});my.FacetView=instance.web.Widget.extend({template:'SearchView.FacetView',events:{'focus':function(){this.trigger('focused',this);},'blur':function(){this.trigger('blurred',this);},'click':function(e){if($(e.target).is('.oe_facet_remove')){this.model.destroy();return false;}
this.$el.focus();e.stopPropagation();},'keydown':function(e){var keys=$.ui.keyCode;switch(e.which){case keys.BACKSPACE:case keys.DELETE:this.model.destroy();return false;}}},init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},start:function(){var self=this;var $e=this.$('> span:last-child');return $.when(this._super()).then(function(){return $.when.apply(null,self.model.values.map(function(value){return new my.FacetValueView(self,value).appendTo($e);}));});},model_changed:function(){this.$el.text(this.$el.text()+'*');}});my.FacetValueView=instance.web.Widget.extend({template:'SearchView.FacetView.Value',init:function(parent,model){this._super(parent);this.model=model;this.model.on('change',this.model_changed,this);},destroy:function(){this.model.off('change',this.model_changed,this);this._super();},model_changed:function(){this.$el.text(this.$el.text()+'*');}});instance.web.SearchView=instance.web.Widget.extend({template:"SearchView",events:{'click':function(e){if(e.target===this.$('.oe_searchview_facets')[0]){this.$('.oe_searchview_input:last').focus();}},'click button.oe_searchview_search':function(e){e.stopImmediatePropagation();this.do_search();},'click .oe_searchview_clear':function(e){e.stopImmediatePropagation();this.query.reset();},'click .oe_searchview_unfold_drawer':function(e){e.stopImmediatePropagation();this.$el.toggleClass('oe_searchview_open_drawer');},'keydown .oe_searchview_input, .oe_searchview_facet':function(e){switch(e.which){case $.ui.keyCode.LEFT:this.focusPreceding(this);e.preventDefault();break;case $.ui.keyCode.RIGHT:this.focusFollowing(this);e.preventDefault();break;}},'autocompleteopen':function(){this.$el.autocomplete('widget').css('z-index',3);},},init:function(parent,dataset,view_id,defaults,options){this.options=_.defaults(options||{},{hidden:false,disable_custom_filters:false,});this._super(parent);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.defaults=defaults||{};this.has_defaults=!_.isEmpty(this.defaults);this.inputs=[];this.controls=[];this.headless=this.options.hidden&&!this.has_defaults;this.input_subviews=[];this.ready=$.Deferred();},start:function(){var self=this;var p=this._super();this.setup_global_completion();this.query=new my.SearchQuery().on('add change reset remove',this.proxy('do_search')).on('add change reset remove',this.proxy('renderFacets'));if(this.options.hidden){this.$el.hide();}
if(this.headless){this.ready.resolve();}else{var load_view=instance.web.fields_view_get({model:this.dataset._model,view_id:this.view_id,view_type:'search',});$.when(load_view).then(function(r){return self.search_view_loaded(r)}).fail(function(){self.ready.reject.apply(null,arguments);});}
instance.web.bus.on('click',this,function(ev){if($(ev.target).parents('.oe_searchview').length===0){self.$el.removeClass('oe_searchview_open_drawer');}});return $.when(p,this.ready);},show:function(){this.$el.show();},hide:function(){this.$el.hide();},subviewForRoot:function(subview_root){return _(this.input_subviews).detect(function(subview){return subview.$el[0]===subview_root;});},siblingSubview:function(subview,direction,wrap_around){var index=_(this.input_subviews).indexOf(subview)+direction;if(wrap_around&&index<0){index=this.input_subviews.length-1;}else if(wrap_around&&index>=this.input_subviews.length){index=0;}
return this.input_subviews[index];},focusPreceding:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),-1,true).$el.focus();},focusFollowing:function(subview_root){return this.siblingSubview(this.subviewForRoot(subview_root),+1,true).$el.focus();},select_for_drawer:function(){return _(this.inputs).filter(function(input){return input.in_drawer();});},setup_global_completion:function(){var self=this;var autocomplete=this.$el.autocomplete({source:this.proxy('complete_global_search'),select:this.proxy('select_completion'),focus:function(e){e.preventDefault();},html:true,autoFocus:true,minLength:1,delay:0}).data('autocomplete');_.extend(autocomplete,{_renderItem:function(ul,item){var $item=$("<li></li>").data("item.autocomplete",item).appendTo(ul);if(item.facet!==undefined){return $item.append((item.label)?$('<a>').html(item.label):$('<a>').text(item.value));}
return $item.text(item.label).css({borderTop:'1px solid #cccccc',margin:0,padding:0,zoom:1,'float':'left',clear:'left',width:'100%'});},_value:function(){return self.$('div.oe_searchview_input').text();},});},complete_global_search:function(req,resp){$.when.apply(null,_(this.inputs).chain().filter(function(input){return input.visible();}).invoke('complete',req.term).value()).then(function(){resp(_(_(arguments).compact()).flatten(true));});},select_completion:function(e,ui){e.preventDefault();var input_index=_(this.input_subviews).indexOf(this.subviewForRoot(this.$('div.oe_searchview_input:focus')[0]));this.query.add(ui.item.facet,{at:input_index/2});},childFocused:function(){this.$el.addClass('oe_focused');},childBlurred:function(){var val=this.$el.val();this.$el.val('');var complete=this.$el.data('autocomplete');if((val&&complete.term===undefined)||complete.previous!==undefined){throw new Error("new jquery.ui version altering implementation"+" details relied on");}
delete complete.term;this.$el.removeClass('oe_focused').trigger('blur');},renderFacets:function(_1,_2,options){var self=this;var started=[];var $e=this.$('div.oe_searchview_facets');_.invoke(this.input_subviews,'destroy');this.input_subviews=[];var i=new my.InputView(this);started.push(i.appendTo($e));this.input_subviews.push(i);this.query.each(function(facet){var f=new my.FacetView(this,facet);started.push(f.appendTo($e));self.input_subviews.push(f);var i=new my.InputView(this);started.push(i.appendTo($e));self.input_subviews.push(i);},this);_.each(this.input_subviews,function(childView){childView.on('focused',self,self.proxy('childFocused'));childView.on('blurred',self,self.proxy('childBlurred'));});$.when.apply(null,started).then(function(){var input_to_focus;if(!options||typeof options.at!=='number'){input_to_focus=_.last(self.input_subviews);}else{input_to_focus=self.input_subviews[(options.at+1)*2];}
input_to_focus.$el.focus();});},make_widgets:function(items,fields,group){if(!group){group=new instance.web.search.Group(this,'q',{attrs:{string:_t("Filters")}});}
var self=this;var filters=[];_.each(items,function(item){if(filters.length&&item.tag!=='filter'){group.push(new instance.web.search.FilterGroup(filters,group));filters=[];}
switch(item.tag){case'separator':case'newline':break;case'filter':filters.push(new instance.web.search.Filter(item,group));break;case'group':self.make_widgets(item.children,fields,new instance.web.search.Group(group,'w',item));break;case'field':var field=this.make_field(item,fields[item['attrs'].name],group);group.push(field);self.make_widgets(item.children,fields,group);break;}},this);if(filters.length){group.push(new instance.web.search.FilterGroup(filters,this));}},make_field:function(item,field,parent){var obj=instance.web.search.fields.get_any([item.attrs.widget,field.type]);if(obj){return new(obj)(item,field,parent||this);}else{console.group('Unknown field type '+field.type);console.error('View node',item);console.info('View field',field);console.info('In view',this);console.groupEnd();return null;}},add_common_inputs:function(){(new instance.web.search.Filters(this));this.custom_filters=new instance.web.search.CustomFilters(this);(new instance.web.search.Advanced(this));},search_view_loaded:function(data){var self=this;this.fields_view=data;if(data.type!=='search'||data.arch.tag!=='search'){throw new Error(_.str.sprintf("Got non-search view after asking for a search view: type %s, arch root %s",data.type,data.arch.tag));}
this.make_widgets(data['arch'].children,data.fields);this.add_common_inputs();var drawer_started=$.when.apply(null,_(this.select_for_drawer()).invoke('appendTo',this.$('.oe_searchview_drawer')));var defaults_fetched=$.when.apply(null,_(this.inputs).invoke('facet_for_defaults',this.defaults)).then(this.proxy('setup_default_query'));return $.when(drawer_started,defaults_fetched).then(function(){self.trigger("search_view_loaded",data);self.ready.resolve();});},setup_default_query:function(){var custom_filters=this.custom_filters.filters;if(!this.options.disable_custom_filters&&!_(custom_filters).isEmpty()){var personal_filter=_(custom_filters).find(function(filter){return filter.user_id&&filter.is_default;});if(personal_filter){this.custom_filters.toggle_filter(personal_filter,true);return;}
var global_filter=_(custom_filters).find(function(filter){return!filter.user_id&&filter.is_default;});if(global_filter){this.custom_filters.toggle_filter(global_filter,true);return;}}
this.query.reset(_(arguments).compact(),{preventSearch:true});},build_search_data:function(){var domains=[],contexts=[],groupbys=[],errors=[];this.query.each(function(facet){var field=facet.get('field');try{var domain=field.get_domain(facet);if(domain){domains.push(domain);}
var context=field.get_context(facet);if(context){contexts.push(context);}
var group_by=field.get_groupby(facet);if(group_by){groupbys.push.apply(groupbys,group_by);}}catch(e){if(e instanceof instance.web.search.Invalid){errors.push(e);}else{throw e;}}});return{domains:domains,contexts:contexts,groupbys:groupbys,errors:errors};},do_search:function(_query,options){if(options&&options.preventSearch){return;}
var search=this.build_search_data();if(!_.isEmpty(search.errors)){this.on_invalid(search.errors);return;}
this.trigger('search_data',search.domains,search.contexts,search.groupbys);},on_invalid:function(errors){this.do_notify(_t("Invalid Search"),_t("triggered from search view"));this.trigger('invalid_search',errors);}});instance.web.search.fields=new instance.web.Registry({'char':'instance.web.search.CharField','text':'instance.web.search.CharField','html':'instance.web.search.CharField','boolean':'instance.web.search.BooleanField','integer':'instance.web.search.IntegerField','id':'instance.web.search.IntegerField','float':'instance.web.search.FloatField','selection':'instance.web.search.SelectionField','datetime':'instance.web.search.DateTimeField','date':'instance.web.search.DateField','many2one':'instance.web.search.ManyToOneField','many2many':'instance.web.search.CharField','one2many':'instance.web.search.CharField'});instance.web.search.Invalid=instance.web.Class.extend({init:function(field,value,message){this.field=field;this.value=value;this.message=message;},toString:function(){return _.str.sprintf(_t("Incorrect value for field %(fieldname)s: [%(value)s] is %(message)s"),{fieldname:this.field,value:this.value,message:this.message});}});instance.web.search.Widget=instance.web.Widget.extend({template:null,init:function(parent){this._super(parent);var ancestor=parent;do{this.view=ancestor;}while(!(ancestor instanceof instance.web.SearchView)&&(ancestor=(ancestor.getParent&&ancestor.getParent())));}});instance.web.search.add_expand_listener=function($root){$root.find('a.searchview_group_string').click(function(e){$root.toggleClass('folded expanded');e.stopPropagation();e.preventDefault();});};instance.web.search.Group=instance.web.search.Widget.extend({init:function(parent,icon,node){this._super(parent);var attrs=node.attrs;this.modifiers=attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};this.attrs=attrs;this.icon=icon;this.name=attrs.string;this.children=[];this.view.controls.push(this);},push:function(input){this.children.push(input);},visible:function(){return!this.modifiers.invisible;},});instance.web.search.Input=instance.web.search.Widget.extend({_in_drawer:false,init:function(parent){this._super(parent);this.load_attrs({});this.view.inputs.push(this);},complete:function(value){return $.when(null)},facet_for_defaults:function(defaults){if(!this.attrs||!(this.attrs.name in defaults&&defaults[this.attrs.name])){return $.when(null);}
return this.facet_for(defaults[this.attrs.name]);},in_drawer:function(){return!!this._in_drawer;},get_context:function(){throw new Error("get_context not implemented for widget "+this.attrs.type);},get_groupby:function(){throw new Error("get_groupby not implemented for widget "+this.attrs.type);},get_domain:function(){throw new Error("get_domain not implemented for widget "+this.attrs.type);},load_attrs:function(attrs){attrs.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};this.attrs=attrs;},visible:function(){if(this.attrs.modifiers.invisible){return false;}
var parent=this;while((parent=parent.getParent())&&((parent instanceof instance.web.search.Group)||(parent instanceof instance.web.search.Input))){if(!parent.visible()){return false;}}
return true;},});instance.web.search.FilterGroup=instance.web.search.Input.extend({template:'SearchView.filters',icon:'q',completion_label:_lt("Filter on: %s"),init:function(filters,parent){if(!(this instanceof instance.web.search.GroupbyGroup)&&_(filters).all(function(f){if(!f.attrs.context){return false;}
var c=instance.web.pyeval.eval('context',f.attrs.context);return!_.isEmpty(c.group_by);})){return new instance.web.search.GroupbyGroup(filters,parent);}
this._super(parent);this.filters=filters;this.view.query.on('add remove change reset',this.proxy('search_change'));},start:function(){this.$el.on('click','li',this.proxy('toggle_filter'));return $.when(null);},search_change:function(){var self=this;var $filters=this.$('> li').removeClass('oe_selected');var facet=this.view.query.find(_.bind(this.match_facet,this));if(!facet){return;}
facet.values.each(function(v){var i=_(self.filters).indexOf(v.get('value'));if(i===-1){return;}
$filters.eq(i).addClass('oe_selected');});},match_facet:function(facet){return facet.get('field')===this;},make_facet:function(values){return{category:_t("Filter"),icon:this.icon,values:values,field:this}},make_value:function(filter){return{label:filter.attrs.string||filter.attrs.help||filter.attrs.name,value:filter};},facet_for_defaults:function(defaults){var self=this;var fs=_(this.filters).chain().filter(function(f){return f.attrs&&f.attrs.name&&!!defaults[f.attrs.name];}).map(function(f){return self.make_value(f);}).value();if(_.isEmpty(fs)){return $.when(null);}
return $.when(this.make_facet(fs));},get_context:function(facet){var contexts=facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();if(!contexts.length){return;}
if(contexts.length===1){return contexts[0];}
return _.extend(new instance.web.CompoundContext,{__contexts:contexts});},get_groupby:function(facet){return facet.values.chain().map(function(f){return f.get('value').attrs.context;}).without('{}').reject(_.isEmpty).value();},get_domain:function(facet){var domains=facet.values.chain().map(function(f){return f.get('value').attrs.domain;}).without('[]').reject(_.isEmpty).value();if(!domains.length){return;}
if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new instance.web.CompoundDomain(),{__domains:domains});},toggle_filter:function(e){this.toggle(this.filters[$(e.target).index()]);},toggle:function(filter){this.view.query.toggle(this.make_facet([this.make_value(filter)]));},complete:function(item){var self=this;item=item.toLowerCase();var facet_values=_(this.filters).chain().filter(function(filter){return filter.visible();}).filter(function(filter){var at={string:filter.attrs.string||'',help:filter.attrs.help||'',name:filter.attrs.name||''};var include=_.str.include;return include(at.string.toLowerCase(),item)||include(at.help.toLowerCase(),item)||include(at.name.toLowerCase(),item);}).map(this.make_value).value();if(_(facet_values).isEmpty()){return $.when(null);}
return $.when(_.map(facet_values,function(facet_value){return{label:_.str.sprintf(self.completion_label.toString(),facet_value.label),facet:self.make_facet([facet_value])}}));}});instance.web.search.GroupbyGroup=instance.web.search.FilterGroup.extend({icon:'w',completion_label:_lt("Group by: %s"),init:function(filters,parent){this._super(filters,parent);if(!this.view._s_groupby){this.view._s_groupby={help:"See GroupbyGroup#init",get_context:this.proxy('get_context'),get_domain:this.proxy('get_domain'),get_groupby:this.proxy('get_groupby')}}},match_facet:function(facet){return facet.get('field')===this.view._s_groupby;},make_facet:function(values){return{category:_t("GroupBy"),icon:this.icon,values:values,field:this.view._s_groupby};}});instance.web.search.Filter=instance.web.search.Input.extend({template:'SearchView.filter',init:function(node,parent){this._super(parent);this.load_attrs(node.attrs);},facet_for:function(){return $.when(null);},get_context:function(){},get_domain:function(){},});instance.web.search.Field=instance.web.search.Input.extend({template:'SearchView.field',default_operator:'=',init:function(view_section,field,parent){this._super(parent);this.load_attrs(_.extend({},field,view_section.attrs));},facet_for:function(value){return $.when({field:this,category:this.attrs.string||this.attrs.name,values:[{label:String(value),value:value}]});},value_from:function(facetValue){return facetValue.get('value');},get_context:function(facet){var self=this;var context=this.attrs.context;if(_.isEmpty(context)||!facet.values.length){return;}
var contexts=facet.values.map(function(facetValue){return new instance.web.CompoundContext(context).set_eval_context({self:self.value_from(facetValue)});});if(contexts.length===1){return contexts[0];}
return _.extend(new instance.web.CompoundContext,{__contexts:contexts});},get_groupby:function(){},make_domain:function(name,operator,facet){return[[name,operator,this.value_from(facet)]];},get_domain:function(facet){if(!facet.values.length){return;}
var value_to_domain;var self=this;var domain=this.attrs['filter_domain'];if(domain){value_to_domain=function(facetValue){return new instance.web.CompoundDomain(domain).set_eval_context({self:self.value_from(facetValue)});};}else{value_to_domain=function(facetValue){return self.make_domain(self.attrs.name,self.attrs.operator||self.default_operator,facetValue);};}
var domains=facet.values.map(value_to_domain);if(domains.length===1){return domains[0];}
for(var i=domains.length;--i;){domains.unshift(['|']);}
return _.extend(new instance.web.CompoundDomain,{__domains:domains});}});instance.web.search.CharField=instance.web.search.Field.extend({default_operator:'ilike',complete:function(value){if(_.isEmpty(value)){return $.when(null);}
var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s for: %(value)s")),{field:'<em>'+this.attrs.string+'</em>',value:'<strong>'+_.str.escapeHTML(value)+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:value,value:value}]}}]);}});instance.web.search.NumberField=instance.web.search.Field.extend({value_from:function(){if(!this.$el.val()){return null;}
var val=this.parse(this.$el.val()),check=Number(this.$el.val());if(isNaN(val)||val!==check){this.$el.addClass('error');throw new instance.web.search.Invalid(this.attrs.name,this.$el.val(),this.error_message);}
this.$el.removeClass('error');return val;}});instance.web.search.IntegerField=instance.web.search.NumberField.extend({error_message:_t("not a valid integer"),parse:function(value){try{return instance.web.parse_value(value,{'widget':'integer'});}catch(e){return NaN;}}});instance.web.search.FloatField=instance.web.search.NumberField.extend({error_message:_t("not a valid number"),parse:function(value){try{return instance.web.parse_value(value,{'widget':'float'});}catch(e){return NaN;}}});function facet_from(field,pair){return{field:field,category:field['attrs'].string,values:[{label:pair[1],value:pair[0]}]};}
instance.web.search.SelectionField=instance.web.search.Field.extend({template:'SearchView.field.selection',init:function(){this._super.apply(this,arguments);this.prepend_empty=!_(this.attrs.selection).detect(function(item){return!item[1];});},complete:function(needle){var self=this;var results=_(this.attrs.selection).chain().filter(function(sel){var value=sel[0],label=sel[1];if(!value){return false;}
return label.toLowerCase().indexOf(needle.toLowerCase())!==-1;}).map(function(sel){return{label:sel[1],facet:facet_from(self,sel)};}).value();if(_.isEmpty(results)){return $.when(null);}
return $.when.call(null,[{label:this.attrs.string}].concat(results));},facet_for:function(value){var match=_(this.attrs.selection).detect(function(sel){return sel[0]===value;});if(!match){return $.when(null);}
return $.when(facet_from(this,match));}});instance.web.search.BooleanField=instance.web.search.SelectionField.extend({init:function(){this._super.apply(this,arguments);this.attrs.selection=[[true,_t("Yes")],[false,_t("No")]];}});instance.web.search.DateField=instance.web.search.Field.extend({value_from:function(facetValue){return instance.web.date_to_str(facetValue.get('value'));},complete:function(needle){var d=Date.parse(needle);if(!d){return $.when(null);}
var date_string=instance.web.format_value(d,this.attrs);var label=_.str.sprintf(_.str.escapeHTML(_t("Search %(field)s at: %(value)s")),{field:'<em>'+this.attrs.string+'</em>',value:'<strong>'+date_string+'</strong>'});return $.when([{label:label,facet:{category:this.attrs.string,field:this,values:[{label:date_string,value:d}]}}]);}});instance.web.search.DateTimeField=instance.web.search.DateField.extend({value_from:function(facetValue){return instance.web.datetime_to_str(facetValue.get('value'));}});instance.web.search.ManyToOneField=instance.web.search.CharField.extend({default_operator:{},init:function(view_section,field,parent){this._super(view_section,field,parent);this.model=new instance.web.Model(this.attrs.relation);},complete:function(needle){var self=this;var context=instance.web.pyeval.eval('contexts',[this.view.dataset.get_context()]);return this.model.call('name_search',[],{name:needle,args:instance.web.pyeval.eval('domains',this.attrs.domain?[this.attrs.domain]:[],context),limit:8,context:context}).then(function(results){if(_.isEmpty(results)){return null;}
return[{label:self.attrs.string}].concat(_(results).map(function(result){return{label:result[1],facet:facet_from(self,result)};}));});},facet_for:function(value){var self=this;if(value instanceof Array){if(value.length===2&&_.isString(value[1])){return $.when(facet_from(this,value));}
assert(value.length<=1,_t("M2O search fields do not currently handle multiple default values"));value=value[0];}
return this.model.call('name_get',[value]).then(function(names){if(_(names).isEmpty()){return null;}
return facet_from(self,names[0]);})},value_from:function(facetValue){return facetValue.get('label');},make_domain:function(name,operator,facetValue){if(operator===this.default_operator){return[[name,'=',facetValue.get('value')]];}
return this._super(name,operator,facetValue);},get_context:function(facet){var values=facet.values;if(_.isEmpty(this.attrs.context)&&values.length===1){var c={};c['default_'+this.attrs.name]=values.at(0).get('value');return c;}
return this._super(facet);}});instance.web.search.CustomFilters=instance.web.search.Input.extend({template:'SearchView.CustomFilters',_in_drawer:true,init:function(){this.is_ready=$.Deferred();this._super.apply(this,arguments);},start:function(){var self=this;this.model=new instance.web.Model('ir.filters');this.filters={};this.$filters={};this.view.query.on('remove',function(facet){if(!facet.get('is_custom_filter')){return;}
self.clear_selection();}).on('reset',this.proxy('clear_selection'));this.$el.on('submit','form',this.proxy('save_current'));this.$el.on('click','input[type=checkbox]',function(){$(this).siblings('input[type=checkbox]').prop('checked',false);});this.$el.on('click','h4',function(){self.$el.toggleClass('oe_opened');});return this.model.call('get_filters',[this.view.model]).then(this.proxy('set_filters')).done(function(){self.is_ready.resolve();}).fail(function(){self.is_ready.reject.apply(self.is_ready,arguments);});},facet_for_defaults:function(){return this.is_ready;},key_for:function(filter){var user_id=filter.user_id;var uid=(user_id instanceof Array)?user_id[0]:user_id;return _.str.sprintf('(%s)%s',uid,filter.name);},facet_for:function(filter){return{category:_t("Custom Filter"),icon:'M',field:{get_context:function(){return filter.context;},get_groupby:function(){return[filter.context];},get_domain:function(){return filter.domain;}},_id:filter['id'],is_custom_filter:true,values:[{label:filter.name,value:null}]};},clear_selection:function(){this.$('li.oe_selected').removeClass('oe_selected');},append_filter:function(filter){var self=this;var key=this.key_for(filter);var warning=_t("This filter is global and will be removed for everybody if you continue.");var $filter;if(key in this.$filters){$filter=this.$filters[key];}else{var id=filter.id;this.filters[key]=filter;$filter=this.$filters[key]=$('<li></li>').appendTo(this.$('.oe_searchview_custom_list')).addClass(filter.user_id?'oe_searchview_custom_private':'oe_searchview_custom_public').toggleClass('oe_searchview_custom_default',filter.is_default).text(filter.name);$('<a class="oe_searchview_custom_delete">x</a>').click(function(e){e.stopPropagation();if(!(filter.user_id||confirm(warning))){return;}
self.model.call('unlink',[id]).done(function(){$filter.remove();delete self.$filters[key];delete self.filters[key];});}).appendTo($filter);}
$filter.unbind('click').click(function(){self.toggle_filter(filter);});},toggle_filter:function(filter,preventSearch){var current=this.view.query.find(function(facet){return facet.get('_id')===filter.id;});if(current){this.view.query.remove(current);this.$filters[this.key_for(filter)].removeClass('oe_selected');return;}
this.view.query.reset([this.facet_for(filter)],{preventSearch:preventSearch||false});this.$filters[this.key_for(filter)].addClass('oe_selected');},set_filters:function(filters){_(filters).map(_.bind(this.append_filter,this));},save_current:function(){var self=this;var $name=this.$('input:first');var private_filter=!this.$('#oe_searchview_custom_public').prop('checked');var set_as_default=this.$('#oe_searchview_custom_default').prop('checked');var search=this.view.build_search_data();instance.web.pyeval.eval_domains_and_contexts({domains:search.domains,contexts:search.contexts,group_by_seq:search.groupbys||[]}).done(function(results){if(!_.isEmpty(results.group_by)){results.context.group_by=results.group_by;}
var ctx=results.context;_(_.keys(instance.session.user_context)).each(function(key){delete ctx[key];});var filter={name:$name.val(),user_id:private_filter?instance.session.uid:false,model_id:self.view.model,context:results.context,domain:results.domain,is_default:set_as_default};return self.model.call('create_or_replace',[filter]).done(function(id){filter.id=id;self.append_filter(filter);self.$el.removeClass('oe_opened').find('form')[0].reset();});});return false;}});instance.web.search.Filters=instance.web.search.Input.extend({template:'SearchView.Filters',_in_drawer:true,start:function(){var self=this;var running_count=0;var is_group=function(i){return i instanceof instance.web.search.FilterGroup;};var visible_filters=_(this.view.controls).chain().reject(function(group){return _(_(group.children).filter(is_group)).isEmpty()||group.modifiers.invisible;});var filters_count=visible_filters.pluck('children').flatten().filter(is_group).map(function(i){return i.filters.length;}).sum().value();var col1=[],col2=visible_filters.map(function(group){var filters=_(group.children).filter(is_group);return{name:_.str.sprintf("<span class='oe_i'>%s</span> %s",group.icon,group.name),filters:filters,length:_(filters).chain().map(function(i){return i.filters.length;}).sum().value()};}).value();while(col2.length){if((running_count+col2[0].length)<=(filters_count-running_count)){running_count+=col2[0].length;col1.push(col2.shift());}else{break;}}
return $.when(this.render_column(col1,$('<div>').appendTo(this.$el)),this.render_column(col2,$('<div>').appendTo(this.$el)));},render_column:function(column,$el){return $.when.apply(null,_(column).map(function(group){$('<h3>').html(group.name).appendTo($el);return $.when.apply(null,_(group.filters).invoke('appendTo',$el));}));}});instance.web.search.Advanced=instance.web.search.Input.extend({template:'SearchView.advanced',_in_drawer:true,start:function(){var self=this;this.$el.on('keypress keydown keyup',function(e){e.stopPropagation();}).on('click','h4',function(){self.$el.toggleClass('oe_opened');}).on('click','button.oe_add_condition',function(){self.append_proposition();}).on('submit','form',function(e){e.preventDefault();self.commit_search();});return $.when(this._super(),new instance.web.Model(this.view.model).call('fields_get',{context:this.view.dataset.context}).done(function(data){self.fields=_.extend({id:{string:'ID',type:'id'}},data);})).done(function(){self.append_proposition();});},append_proposition:function(){var self=this;return(new instance.web.search.ExtendedSearchProposition(this,this.fields)).appendTo(this.$('ul')).done(function(){self.$('button.oe_apply').prop('disabled',false);});},remove_proposition:function(prop){if(this.getChildren().length<=1){this.$('button.oe_apply').prop('disabled',true);}
prop.destroy();},commit_search:function(){var children=this.getChildren();var propositions=_.invoke(children,'get_proposition');var domain=_(propositions).pluck('value');for(var i=domain.length;--i;){domain.unshift('|');}
this.view.query.add({category:_t("Advanced"),values:propositions,field:{get_context:function(){},get_domain:function(){return domain;},get_groupby:function(){}}});_.invoke(children,'destroy');this.append_proposition();this.view.$el.removeClass('oe_searchview_open_drawer');}});instance.web.search.ExtendedSearchProposition=instance.web.Widget.extend({template:'SearchView.extended_search.proposition',events:{'change .searchview_extended_prop_field':'changed','change .searchview_extended_prop_op':'operator_changed','click .searchview_extended_delete_prop':function(e){e.stopPropagation();this.getParent().remove_proposition(this);}},init:function(parent,fields){this._super(parent);this.fields=_(fields).chain().map(function(val,key){return _.extend({},val,{'name':key});}).filter(function(field){return!field.deprecated;}).sortBy(function(field){return field.string;}).value();this.attrs={_:_,fields:this.fields,selected:null};this.value=null;},start:function(){return this._super().done(this.proxy('changed'));},changed:function(){var nval=this.$(".searchview_extended_prop_field").val();if(this.attrs.selected==null||nval!=this.attrs.selected.name){this.select_field(_.detect(this.fields,function(x){return x.name==nval;}));}},operator_changed:function(e){var $value=this.$('.searchview_extended_prop_value');switch($(e.target).val()){case'∃':case'∄':$value.hide();break;default:$value.show();}},select_field:function(field){var self=this;if(this.attrs.selected!=null){this.value.destroy();this.value=null;this.$('.searchview_extended_prop_op').html('');}
this.attrs.selected=field;if(field==null){return;}
var type=field.type;var Field=instance.web.search.custom_filters.get_object(type);if(!Field){Field=instance.web.search.custom_filters.get_object("char");}
this.value=new Field(this,field);_.each(this.value.operators,function(operator){$('<option>',{value:operator.value}).text(String(operator.text)).appendTo(self.$('.searchview_extended_prop_op'));});var $value_loc=this.$('.searchview_extended_prop_value').show().empty();this.value.appendTo($value_loc);},get_proposition:function(){if(this.attrs.selected==null)
return null;var field=this.attrs.selected;var op_select=this.$('.searchview_extended_prop_op')[0];var operator=op_select.options[op_select.selectedIndex];return{label:this.value.get_label(field,operator),value:this.value.get_domain(field,operator),};}});instance.web.search.ExtendedSearchProposition.Field=instance.web.Widget.extend({init:function(parent,field){this._super(parent);this.field=field;},get_label:function(field,operator){var format;switch(operator.value){case'∃':case'∄':format=_t('%(field)s %(operator)s');break;default:format=_t('%(field)s %(operator)s "%(value)s"');break;}
return this.format_label(format,field,operator);},format_label:function(format,field,operator){return _.str.sprintf(format,{field:field.string,operator:operator.label||operator.text,value:this});},get_domain:function(field,operator){switch(operator.value){case'∃':return this.make_domain(field.name,'!=',false);case'∄':return this.make_domain(field.name,'=',false);default:return this.make_domain(field.name,operator.value,this.get_value());}},make_domain:function(field,operator,value){return[field,operator,value];},toString:function(){return this.get_value();}});instance.web.search.ExtendedSearchProposition.Char=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.char',operators:[{value:"ilike",text:_lt("contains")},{value:"not ilike",text:_lt("doesn't contain")},{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],get_value:function(){return this.$el.val();}});instance.web.search.ExtendedSearchProposition.DateTime=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.empty',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater or equal than")},{value:"<=",text:_lt("less or equal than")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],widget:function(){return instance.web.DateTimeWidget;},get_value:function(){return this.datewidget.get_value();},toString:function(){return instance.web.format_value(this.get_value(),{type:"datetime"});},start:function(){var ready=this._super();this.datewidget=new(this.widget())(this);this.datewidget.appendTo(this.$el);return ready;}});instance.web.search.ExtendedSearchProposition.Date=instance.web.search.ExtendedSearchProposition.DateTime.extend({widget:function(){return instance.web.DateWidget;},toString:function(){return instance.web.format_value(this.get_value(),{type:"date"});}});instance.web.search.ExtendedSearchProposition.Integer=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.integer',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater or equal than")},{value:"<=",text:_lt("less or equal than")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return instance.web.parse_value(val==""?0:val,{'widget':'integer'});}catch(e){return"";}}});instance.web.search.ExtendedSearchProposition.Id=instance.web.search.ExtendedSearchProposition.Integer.extend({operators:[{value:"=",text:_lt("is")}]});instance.web.search.ExtendedSearchProposition.Float=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.float',operators:[{value:"=",text:_lt("is equal to")},{value:"!=",text:_lt("is not equal to")},{value:">",text:_lt("greater than")},{value:"<",text:_lt("less than")},{value:">=",text:_lt("greater or equal than")},{value:"<=",text:_lt("less or equal than")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){return this.$el.val();},get_value:function(){try{var val=this.$el.val();return instance.web.parse_value(val==""?0.0:val,{'widget':'float'});}catch(e){return"";}}});instance.web.search.ExtendedSearchProposition.Selection=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.selection',operators:[{value:"=",text:_lt("is")},{value:"!=",text:_lt("is not")},{value:"∃",text:_lt("is set")},{value:"∄",text:_lt("is not set")}],toString:function(){var select=this.$el[0];var option=select.options[select.selectedIndex];return option.label||option.text;},get_value:function(){return this.$el.val();}});instance.web.search.ExtendedSearchProposition.Boolean=instance.web.search.ExtendedSearchProposition.Field.extend({template:'SearchView.extended_search.proposition.empty',operators:[{value:"=",text:_lt("is true")},{value:"!=",text:_lt("is false")}],get_label:function(field,operator){return this.format_label(_t('%(field)s %(operator)s'),field,operator);},get_value:function(){return true;}});instance.web.search.custom_filters=new instance.web.Registry({'char':'instance.web.search.ExtendedSearchProposition.Char','text':'instance.web.search.ExtendedSearchProposition.Char','one2many':'instance.web.search.ExtendedSearchProposition.Char','many2one':'instance.web.search.ExtendedSearchProposition.Char','many2many':'instance.web.search.ExtendedSearchProposition.Char','datetime':'instance.web.search.ExtendedSearchProposition.DateTime','date':'instance.web.search.ExtendedSearchProposition.Date','integer':'instance.web.search.ExtendedSearchProposition.Integer','float':'instance.web.search.ExtendedSearchProposition.Float','boolean':'instance.web.search.ExtendedSearchProposition.Boolean','selection':'instance.web.search.ExtendedSearchProposition.Selection','id':'instance.web.search.ExtendedSearchProposition.Id'});};;openerp.web.form=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.form={};instance.web.form.FieldManagerMixin={get_field_desc:function(field_name){},get_field_value:function(field_name){},set_values:function(values){},compute_domain:function(expression){},build_eval_context:function(){},};instance.web.views.add('form','instance.web.FormView');instance.web.FormView=instance.web.View.extend(instance.web.form.FieldManagerMixin,{searchable:false,template:"FormView",display_name:_lt('Form'),view_type:"form",init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id||false;this.fields_view={};this.fields={};this.fields_order=[];this.datarecord={};this.default_focus_field=null;this.default_focus_button=null;this.fields_registry=instance.web.form.widgets;this.tags_registry=instance.web.form.tags;this.widgets_registry=instance.web.form.custom_widgets;this.has_been_loaded=$.Deferred();this.translatable_fields=[];_.defaults(this.options,{"not_interactible_on_create":false,"initial_mode":"view","disable_autofocus":false,"footer_to_buttons":false,});this.is_initialized=$.Deferred();this.mutating_mutex=new $.Mutex();this.on_change_list=[];this.save_list=[];this.reload_mutex=new $.Mutex();this.__clicked_inside=false;this.__blur_timeout=null;this.rendering_engine=new instance.web.form.FormRenderingEngine(this);self.set({actual_mode:self.options.initial_mode});this.has_been_loaded.done(function(){self.on("change:actual_mode",self,self.check_actual_mode);self.check_actual_mode();self.on("change:actual_mode",self,self.init_pager);self.init_pager();});self.on("load_record",self,self.load_record);instance.web.bus.on('clear_uncommitted_changes',this,function(e){if(!this.can_be_discarded()){e.preventDefault();}});},view_loading:function(r){return this.load_form(r);},destroy:function(){_.each(this.get_widgets(),function(w){w.off('focused blurred');w.destroy();});if(this.$el){this.$el.off('.formBlur');}
this._super();},load_form:function(data){var self=this;if(!data){throw new Error(_t("No data provided."));}
if(this.arch){throw"Form view does not support multiple calls to load_form";}
this.fields_order=[];this.fields_view=data;this.rendering_engine.set_fields_registry(this.fields_registry);this.rendering_engine.set_tags_registry(this.tags_registry);this.rendering_engine.set_widgets_registry(this.widgets_registry);this.rendering_engine.set_fields_view(data);var $dest=this.$el.hasClass("oe_form_container")?this.$el:this.$el.find('.oe_form_container');this.rendering_engine.render_to($dest);this.$el.on('mousedown.formBlur',function(){self.__clicked_inside=true;});this.$buttons=$(QWeb.render("FormView.buttons",{'widget':self}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_form_buttons').replaceWith(this.$buttons);}
this.$buttons.on('click','.oe_form_button_create',this.guard_active(this.on_button_create));this.$buttons.on('click','.oe_form_button_edit',this.guard_active(this.on_button_edit));this.$buttons.on('click','.oe_form_button_save',this.guard_active(this.on_button_save));this.$buttons.on('click','.oe_form_button_cancel',this.guard_active(this.on_button_cancel));if(this.options.footer_to_buttons){this.$el.find('footer').appendTo(this.$buttons);}
this.$sidebar=this.options.$sidebar||this.$el.find('.oe_form_sidebar');if(!this.sidebar&&this.options.$sidebar){this.sidebar=new instance.web.Sidebar(this);this.sidebar.appendTo(this.$sidebar);if(this.fields_view.toolbar){this.sidebar.add_toolbar(this.fields_view.toolbar);}
this.sidebar.add_items('other',_.compact([self.is_action_enabled('delete')&&{label:_t('Delete'),callback:self.on_button_delete},self.is_action_enabled('create')&&{label:_t('Duplicate'),callback:self.on_button_duplicate}]));}
this.has_been_loaded.resolve();this.$el.find(".oe_form_group_row,.oe_form_field,label").on('click',function(e){if(self.get("actual_mode")=="view"){var $button=self.options.$buttons.find(".oe_form_button_edit");$button.openerpBounce();e.stopPropagation();instance.web.bus.trigger('click',e);}});this.$el.find(".oe_form_field_status:not(.oe_form_status_clickable)").on('click',function(e){if((self.get("actual_mode")=="view")){var $button=self.$el.find(".oe_highlight:not(.oe_form_invisible)").css({'float':'left','clear':'none'});$button.openerpBounce();e.stopPropagation();}});this.trigger('form_view_loaded',data);return $.when();},widgetFocused:function(){this.__clicked_inside=false;if(this.__blur_timeout){clearTimeout(this.__blur_timeout);this.__blur_timeout=null;}},widgetBlurred:function(){if(this.__clicked_inside){this.__clicked_inside=false;return;}
var self=this;this.widgetFocused();this.__blur_timeout=setTimeout(function(){self.trigger('blurred');},0);},do_load_state:function(state,warm){if(state.id&&this.datarecord.id!=state.id){if(this.dataset.get_id_index(state.id)===null){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);this.do_show({reload:warm});}},do_show:function(options){var self=this;options=options||{};if(this.sidebar){this.sidebar.$el.show();}
if(this.$buttons){this.$buttons.show();}
this.$el.show().css({opacity:'0',filter:'alpha(opacity = 0)'});this.$el.add(this.$buttons).removeClass('oe_form_dirty');var shown=this.has_been_loaded;if(options.reload!==false){shown=shown.then(function(){if(self.dataset.index===null){return self.on_button_new();}
var fields=_.keys(self.fields_view.fields);fields.push('display_name');return self.dataset.read_index(fields,{context:{'bin_size':true,'future_display_name':true}}).then(function(r){self.trigger('load_record',r);});});}
return shown.then(function(){self._actualize_mode(options.mode||self.options.initial_mode);self.$el.css({opacity:'1',filter:'alpha(opacity = 100)'});});},do_hide:function(){if(this.sidebar){this.sidebar.$el.hide();}
if(this.$buttons){this.$buttons.hide();}
if(this.$pager){this.$pager.hide();}
this._super();},load_record:function(record){var self=this,set_values=[];if(!record){this.set({'title':undefined});this.do_warn(_t("Form"),_t("The record could not be found in the database."),true);return $.Deferred().reject();}
this.datarecord=record;this._actualize_mode();this.set({'title':record.id?record.display_name:_t("New")});_(this.fields).each(function(field,f){field._dirty_flag=false;field._inhibit_on_change_flag=true;var result=field.set_value(self.datarecord[f]||false);field._inhibit_on_change_flag=false;set_values.push(result);});return $.when.apply(null,set_values).then(function(){if(!record.id){_.each(self.fields_order,function(field_name){if(record[field_name]!==undefined){var field=self.fields[field_name];field._dirty_flag=true;self.do_onchange(field);}});}
self.on_form_changed();self.rendering_engine.init_fields();self.is_initialized.resolve();self.do_update_pager(record.id==null);if(self.sidebar){self.sidebar.do_attachement_update(self.dataset,self.datarecord.id);}
if(record.id){self.do_push_state({id:record.id});}else{self.do_push_state({});}
self.$el.add(self.$buttons).removeClass('oe_form_dirty');self.autofocus();});},load_defaults:function(){var self=this;var keys=_.keys(this.fields_view.fields);if(keys.length){return this.dataset.default_get(keys).then(function(r){self.trigger('load_record',r);});}
return self.trigger('load_record',{});},on_form_changed:function(){this.trigger("view_content_has_changed");},do_notify_change:function(){this.$el.add(this.$buttons).addClass('oe_form_dirty');},execute_pager_action:function(action){if(this.can_be_discarded()){switch(action){case'first':this.dataset.index=0;break;case'previous':this.dataset.previous();break;case'next':this.dataset.next();break;case'last':this.dataset.index=this.dataset.ids.length-1;break;}
this.reload();this.trigger('pager_action_executed');}},init_pager:function(){var self=this;if(this.$pager)
this.$pager.remove();if(this.get("actual_mode")==="create")
return;this.$pager=$(QWeb.render("FormView.pager",{'widget':self})).hide();if(this.options.$pager){this.$pager.appendTo(this.options.$pager);}else{this.$el.find('.oe_form_pager').replaceWith(this.$pager);}
this.$pager.on('click','a[data-pager-action]',function(){var action=$(this).data('pager-action');self.execute_pager_action(action);});this.do_update_pager();},do_update_pager:function(hide_index){this.$pager.toggle(this.dataset.ids.length>1);if(hide_index){$(".oe_form_pager_state",this.$pager).html("");}else{$(".oe_form_pager_state",this.$pager).html(_.str.sprintf(_t("%d / %d"),this.dataset.index+1,this.dataset.ids.length));}},parse_on_change:function(on_change,widget){var self=this;var onchange=_.str.trim(on_change);var call=onchange.match(/^\s?(.*?)\((.*?)\)\s?$/);if(!call){throw new Error(_.str.sprintf(_t("Wrong on change format: %s"),onchange));}
var method=call[1];if(!_.str.trim(call[2])){return{method:method,args:[]}}
var argument_replacement={'False':function(){return false;},'True':function(){return true;},'None':function(){return null;},'context':function(){return new instance.web.CompoundContext(self.dataset.get_context(),widget.build_context()?widget.build_context():{});}};var parent_fields=null;var args=_.map(call[2].split(','),function(a,i){var field=_.str.trim(a);if(field in argument_replacement){return argument_replacement[field]();}
if(/^-?\d+(\.\d+)?$/.test(field)){return Number(field);}
if(self.fields[field]){var value_=self.fields[field].get_value();return value_==null?false:value_;}
var splitted=field.split('.');if(splitted.length>1&&_.str.trim(splitted[0])==="parent"&&self.dataset.parent_view){if(parent_fields===null){parent_fields=self.dataset.parent_view.get_fields_values();}
var p_val=parent_fields[_.str.trim(splitted[1])];if(p_val!==undefined){return p_val==null?false:p_val;}}
var first_char=field[0],last_char=field[field.length-1];if((first_char==='"'&&last_char==='"')||(first_char==="'"&&last_char==="'")){return field.slice(1,-1);}
throw new Error("Could not get field with name '"+field+"' for onchange '"+onchange+"'");});return{method:method,args:args};},do_onchange:function(widget,processed){var self=this;this.on_change_list=[{widget:widget,processed:processed}].concat(this.on_change_list);return this._process_operations();},_process_onchange:function(on_change_obj){var self=this;var widget=on_change_obj.widget;var processed=on_change_obj.processed;try{var def;processed=processed||[];processed.push(widget.name);var on_change=widget.node.attrs.on_change;if(on_change){var change_spec=self.parse_on_change(on_change,widget);var ids=[];if(self.datarecord.id&&!instance.web.BufferedDataSet.virtual_id_regex.test(self.datarecord.id)){ids.push(self.datarecord.id);}
def=self.alive(new instance.web.Model(self.dataset.model).call(change_spec.method,[ids].concat(change_spec.args)));}else{def=$.when({});}
return def.then(function(response){if(widget.field['change_default']){var fieldname=widget.name;var value_;if(response.value&&(fieldname in response.value)){value_=response.value[fieldname];}else{value_=self.fields[fieldname].get_value();}
var condition=fieldname+'='+value_;if(value_){return self.alive(new instance.web.Model('ir.values').call('get_defaults',[self.model,condition])).then(function(results){if(!results.length){return response;}
if(!response.value){response.value={};}
for(var i=0;i<results.length;++i){var triplet=results[i];response.value[triplet[1]]=triplet[2];}
return response;});}}
return response;}).then(function(response){return self.on_processed_onchange(response,processed);});}catch(e){console.error(e);instance.webclient.crashmanager.show_message(e);return $.Deferred().reject();}},on_processed_onchange:function(result,processed){try{if(result.value){this._internal_set_values(result.value,processed);}
if(!_.isEmpty(result.warning)){instance.web.dialog($(QWeb.render("CrashManager.warning",result.warning)),{title:result.warning.title,modal:true,buttons:[{text:_t("Ok"),click:function(){$(this).dialog("close");}}]});}
var fields=this.fields;_(result.domain).each(function(domain,fieldname){var field=fields[fieldname];if(!field){return;}
field.node.attrs.domain=domain;});return $.Deferred().resolve();}catch(e){console.error(e);instance.webclient.crashmanager.show_message(e);return $.Deferred().reject();}},_process_operations:function(){var self=this;return this.mutating_mutex.exec(function(){function iterate(){var on_change_obj=self.on_change_list.shift();if(on_change_obj){return self._process_onchange(on_change_obj).then(function(){return iterate();});}
var defs=[];_.each(self.fields,function(field){defs.push(field.commit_value());});var args=_.toArray(arguments);return $.when.apply($,defs).then(function(){if(self.on_change_list.length!==0){return iterate();}
var save_obj=self.save_list.pop();if(save_obj){return self._process_save(save_obj).then(function(){save_obj.ret=_.toArray(arguments);return iterate();},function(){save_obj.error=true;});}
return $.when();});};return iterate();});},_internal_set_values:function(values,exclude){exclude=exclude||[];for(var f in values){if(!values.hasOwnProperty(f)){continue;}
var field=this.fields[f];if(field){var value_=values[f];if(field.get_value()!=value_){field._inhibit_on_change_flag=true;field.set_value(value_);field._inhibit_on_change_flag=false;field._dirty_flag=true;if(!_.contains(exclude,field.name)){this.do_onchange(field,exclude);}}}}
this.on_form_changed();},set_values:function(values){var self=this;return this.mutating_mutex.exec(function(){self._internal_set_values(values);});},to_view_mode:function(){this._actualize_mode("view");},to_edit_mode:function(){this._actualize_mode("edit");},_actualize_mode:function(switch_to){var mode=switch_to||this.get("actual_mode");if(!this.datarecord.id){mode="create";}else if(mode==="create"){mode="edit";}
this.set({actual_mode:mode});},check_actual_mode:function(source,options){var self=this;if(this.get("actual_mode")==="view"){self.$el.removeClass('oe_form_editable').addClass('oe_form_readonly');self.$buttons.find('.oe_form_buttons_edit').hide();self.$buttons.find('.oe_form_buttons_view').show();self.$sidebar.show();}else{self.$el.removeClass('oe_form_readonly').addClass('oe_form_editable');self.$buttons.find('.oe_form_buttons_edit').show();self.$buttons.find('.oe_form_buttons_view').hide();self.$sidebar.hide();this.autofocus();}},autofocus:function(){if(this.get("actual_mode")!=="view"&&!this.options.disable_autofocus){var fields_order=this.fields_order.slice(0);if(this.default_focus_field){fields_order.unshift(this.default_focus_field.name);}
for(var i=0;i<fields_order.length;i+=1){var field=this.fields[fields_order[i]];if(!field.get('effective_invisible')&&!field.get('effective_readonly')&&field.$label){if(field.focus()!==false){break;}}}}},on_button_save:function(){var self=this;return this.save().done(function(result){self.trigger("save",result);self.to_view_mode();});},on_button_cancel:function(event){if(this.can_be_discarded()){if(this.get('actual_mode')==='create'){this.trigger('history_back');}else{this.to_view_mode();this.trigger('load_record',this.datarecord);}}
this.trigger('on_button_cancel');return false;},on_button_new:function(){var self=this;this.to_edit_mode();return $.when(this.has_been_loaded).then(function(){if(self.can_be_discarded()){return self.load_defaults();}});},on_button_edit:function(){return this.to_edit_mode();},on_button_create:function(){this.dataset.index=null;this.do_show();},on_button_duplicate:function(){var self=this;return this.has_been_loaded.then(function(){return self.dataset.call('copy',[self.datarecord.id,{},self.dataset.context]).then(function(new_id){self.record_created(new_id);self.to_edit_mode();});});},on_button_delete:function(){var self=this;var def=$.Deferred();this.has_been_loaded.done(function(){if(self.datarecord.id&&confirm(_t("Do you really want to delete this record?"))){self.dataset.unlink([self.datarecord.id]).done(function(){self.execute_pager_action('next');def.resolve();});}else{$.async_when().done(function(){def.reject();})}});return def.promise();},can_be_discarded:function(){if(this.$el.is('.oe_form_dirty')){if(!confirm(_t("Warning, the record has been modified, your changes will be discarded.\n\nAre you sure you want to leave this page ?"))){return false;}
this.$el.removeClass('oe_form_dirty');}
return true;},save:function(prepend_on_create){var self=this;var save_obj={prepend_on_create:prepend_on_create,ret:null};this.save_list.push(save_obj);return this._process_operations().then(function(){if(save_obj.error)
return $.Deferred().reject();return $.when.apply($,save_obj.ret);});},_process_save:function(save_obj){var self=this;var prepend_on_create=save_obj.prepend_on_create;try{var form_invalid=false,values={},first_invalid_field=null,readonly_values={};for(var f in self.fields){if(!self.fields.hasOwnProperty(f)){continue;}
f=self.fields[f];if(!f.is_valid()){form_invalid=true;if(!first_invalid_field){first_invalid_field=f;}}else if(f.name!=='id'&&(!self.datarecord.id||f._dirty_flag)){if(!f.get("readonly")){values[f.name]=f.get_value();}else{readonly_values[f.name]=f.get_value();}}}
if(form_invalid){self.set({'display_invalid_fields':true});first_invalid_field.focus();self.on_invalid();return $.Deferred().reject();}else{self.set({'display_invalid_fields':false});var save_deferral;if(!self.datarecord.id){save_deferral=self.dataset.create(values,{readonly_fields:readonly_values}).then(function(r){return self.record_created(r,prepend_on_create);},null);}else if(_.isEmpty(values)){save_deferral=$.Deferred().resolve({}).promise();}else{save_deferral=self.dataset.write(self.datarecord.id,values,{readonly_fields:readonly_values}).then(function(r){return self.record_saved(r);},null);}
return save_deferral;}}catch(e){console.error(e);return $.Deferred().reject();}},on_invalid:function(){var warnings=_(this.fields).chain().filter(function(f){return!f.is_valid();}).map(function(f){return _.str.sprintf('<li>%s</li>',_.escape(f.string));}).value();warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("The following fields are invalid:"),warnings.join(''));},record_saved:function(r){var self=this;if(!r){this.trigger('record_saved',r);return $.Deferred().reject();}else{return $.when(this.reload()).then(function(){self.trigger('record_saved',r);return r;});}},record_created:function(r,prepend_on_create){var self=this;if(!r){this.trigger('record_created',r);return $.Deferred().reject();}else{this.datarecord.id=r;if(!prepend_on_create){this.dataset.alter_ids(this.dataset.ids.concat([this.datarecord.id]));this.dataset.index=this.dataset.ids.length-1;}else{this.dataset.alter_ids([this.datarecord.id].concat(this.dataset.ids));this.dataset.index=0;}
this.do_update_pager();if(this.sidebar){this.sidebar.do_attachement_update(this.dataset,this.datarecord.id);}
return $.when(this.reload()).then(function(){self.trigger('record_created',r);return _.extend(r,{created:true});});}},on_action:function(action){console.debug('Executing action',action);},reload:function(){var self=this;return this.reload_mutex.exec(function(){if(self.dataset.index==null){self.trigger("previous_view");return $.Deferred().reject().promise();}
if(self.dataset.index==null||self.dataset.index<0){return $.when(self.on_button_new());}else{var fields=_.keys(self.fields_view.fields);fields.push('display_name');return self.dataset.read_index(fields,{context:{'bin_size':true,'future_display_name':true}}).then(function(r){self.trigger('load_record',r);});}});},get_widgets:function(){return _.filter(this.getChildren(),function(obj){return obj instanceof instance.web.form.FormWidget;});},get_fields_values:function(){var values={};var ids=this.get_selected_ids();values["id"]=ids.length>0?ids[0]:false;_.each(this.fields,function(value_,key){values[key]=value_.get_value();});return values;},get_selected_ids:function(){var id=this.dataset.ids[this.dataset.index];return id?[id]:[];},recursive_save:function(){var self=this;return $.when(this.save()).then(function(res){if(self.dataset.parent_view)
return self.dataset.parent_view.recursive_save();});},recursive_reload:function(){var self=this;var pre=$.when();if(self.dataset.parent_view)
pre=self.dataset.parent_view.recursive_reload();return pre.then(function(){return self.reload();});},is_dirty:function(){return _.any(this.fields,function(value_){return value_._dirty_flag;});},is_interactible_record:function(){var id=this.datarecord.id;if(!id){if(this.options.not_interactible_on_create)
return false;}else if(typeof(id)==="string"){if(instance.web.BufferedDataSet.virtual_id_regex.test(id))
return false;}
return true;},sidebar_eval_context:function(){return $.when(this.build_eval_context());},open_defaults_dialog:function(){var self=this;var display=function(field,value){if(field instanceof instance.web.form.FieldSelection){return _(field.values).find(function(option){return option[0]===value;})[1];}else if(field instanceof instance.web.form.FieldMany2One){return field.get_displayed();}
return value;}
var fields=_.chain(this.fields).map(function(field,name){var value=field.get_value();if(!value||field.get('invisible')||field.get("readonly")||field.field.type==='one2many'||field.field.type==='many2many'||field.field.type==='binary'||field.password){return false;}
return{name:name,string:field.string,value:value,displayed:display(field,value),}}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(self.fields).filter(function(field){return field.field.change_default;}).map(function(field,name){var value=field.get_value();return{name:name,string:field.string,value:value,displayed:display(field,value),}}).value();var d=new instance.web.Dialog(this,{title:_t("Set Default"),args:{fields:fields,conditions:conditions},buttons:[{text:_t("Close"),click:function(){d.close();}},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var field_to_set=$defaults.val();if(!field_to_set){$defaults.parent().addClass('oe_form_invalid');return;}
var condition=d.$el.find('#formview_default_conditions').val(),all_users=d.$el.find('#formview_default_all').is(':checked');new instance.web.DataSet(self,'ir.values').call('set_default',[self.dataset.model,field_to_set,self.fields[field_to_set].get_value(),all_users,true,condition||false]).done(function(){d.close();});}}]});d.template='FormView.set_default';d.open();},register_field:function(field,name){this.fields[name]=field;this.fields_order.push(name);if(JSON.parse(field.node.attrs.default_focus||"0")){this.default_focus_field=field;}
field.on('focused',null,this.proxy('widgetFocused')).on('blurred',null,this.proxy('widgetBlurred'));if(this.get_field_desc(name).translate){this.translatable_fields.push(field);}
field.on('changed_value',this,function(){if(field.is_syntax_valid()){this.trigger('field_changed:'+name);}
if(field._inhibit_on_change_flag){return;}
field._dirty_flag=true;if(field.is_syntax_valid()){this.do_onchange(field);this.on_form_changed(true);this.do_notify_change();}});},get_field_desc:function(field_name){return this.fields_view.fields[field_name];},get_field_value:function(field_name){return this.fields[field_name].get_value();},compute_domain:function(expression){return instance.web.form.compute_domain(expression,this.fields);},_build_view_fields_values:function(){var a_dataset=this.dataset;var fields_values=this.get_fields_values();var active_id=a_dataset.ids[a_dataset.index];_.extend(fields_values,{active_id:active_id||false,active_ids:active_id?[active_id]:[],active_model:a_dataset.model,parent:{}});if(a_dataset.parent_view){fields_values.parent=a_dataset.parent_view.get_fields_values();}
return fields_values;},build_eval_context:function(){var a_dataset=this.dataset;return new instance.web.CompoundContext(a_dataset.get_context(),this._build_view_fields_values());},});instance.web.form.FormRenderingEngineInterface=instance.web.Class.extend({set_fields_view:function(fields_view){},set_fields_registry:function(fields_registry){},render_to:function($el){},});instance.web.form.FormRenderingEngine=instance.web.form.FormRenderingEngineInterface.extend({init:function(view){this.view=view;},set_fields_view:function(fvg){this.fvg=fvg;this.version=parseFloat(this.fvg.arch.attrs.version);if(isNaN(this.version)){this.version=6.1;}},set_tags_registry:function(tags_registry){this.tags_registry=tags_registry;},set_fields_registry:function(fields_registry){this.fields_registry=fields_registry;},set_widgets_registry:function(widgets_registry){this.widgets_registry=widgets_registry;},process_version:function(){if(this.version<7.0){this.$form.find('form:first').wrapInner('<group col="4"/>');this.$form.find('page').each(function(){if(!$(this).parents('field').length){$(this).wrapInner('<group col="4"/>');}});}},get_arch_fragment:function(){var doc=$.parseXML(instance.web.json_node_to_xml(this.fvg.arch)).documentElement;$('button',doc).each(function(){$(this).attr('data-button-type',$(this).attr('type')).attr('type','button');});$('board',doc).each(function(){$(this).attr('layout',$(this).attr('style'));});return $('<div class="oe_form"/>').append(instance.web.xml_to_str(doc));},render_to:function($target){var self=this;this.$target=$target;this.$form=this.get_arch_fragment();this.process_version();this.fields_to_init=[];this.tags_to_init=[];this.widgets_to_init=[];this.labels={};this.process(this.$form);this.$form.appendTo(this.$target);this.to_replace=[];_.each(this.fields_to_init,function($elem){var name=$elem.attr("name");if(!self.fvg.fields[name]){throw new Error(_.str.sprintf(_t("Field '%s' specified in view could not be found."),name));}
var obj=self.fields_registry.get_any([$elem.attr('widget'),self.fvg.fields[name].type]);if(!obj){throw new Error(_.str.sprintf(_t("Widget type '%s' is not implemented"),$elem.attr('widget')));}
var w=new(obj)(self.view,instance.web.xml_to_json($elem[0]));var $label=self.labels[$elem.attr("name")];if($label){w.set_input_id($label.attr("for"));}
self.alter_field(w);self.view.register_field(w,$elem.attr("name"));self.to_replace.push([w,$elem]);});_.each(this.tags_to_init,function($elem){var tag_name=$elem[0].tagName.toLowerCase();var obj=self.tags_registry.get_object(tag_name);var w=new(obj)(self.view,instance.web.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});_.each(this.widgets_to_init,function($elem){var widget_type=$elem.attr("type");var obj=self.widgets_registry.get_object(widget_type);var w=new(obj)(self.view,instance.web.xml_to_json($elem[0]));self.to_replace.push([w,$elem]);});},init_fields:function(){var defs=[];_.each(this.to_replace,function(el){defs.push(el[0].replace(el[1]));});this.to_replace=[];return $.when.apply($,defs);},render_element:function(template){var dicts=[].slice.call(arguments).slice(1);var dict=_.extend.apply(_,dicts);dict['classnames']=dict['class']||'';return $(QWeb.render(template,dict));},alter_field:function(field){},toggle_layout_debugging:function(){if(!this.$target.has('.oe_layout_debug_cell:first').length){this.$target.find('[title]').removeAttr('title');this.$target.find('.oe_form_group_cell').each(function(){var text='W:'+($(this).attr('width')||'')+' - C:'+$(this).attr('colspan');$(this).attr('title',text);});}
this.$target.toggleClass('oe_layout_debugging');},process:function($tag){var self=this;var tagname=$tag[0].nodeName.toLowerCase();if(this.tags_registry.contains(tagname)){this.tags_to_init.push($tag);return $tag;}
var fn=self['process_'+tagname];if(fn){var args=[].slice.call(arguments);args[0]=$tag;return fn.apply(self,args);}else{$tag.children().each(function(){self.process($(this));});self.handle_common_properties($tag,$tag);$tag.removeAttr("modifiers");return $tag;}},process_widget:function($widget){this.widgets_to_init.push($widget);return $widget;},process_sheet:function($sheet){var $new_sheet=this.render_element('FormRenderingSheet',$sheet.getAttributes());this.handle_common_properties($new_sheet,$sheet);var $dst=$new_sheet.find('.oe_form_sheet');$sheet.contents().appendTo($dst);$sheet.before($new_sheet).remove();this.process($new_sheet);},process_form:function($form){if($form.find('> sheet').length===0){$form.addClass('oe_form_nosheet');}
var $new_form=this.render_element('FormRenderingForm',$form.getAttributes());this.handle_common_properties($new_form,$form);$form.contents().appendTo($new_form);if($form[0]===this.$form[0]){this.$form=$new_form;}else{$form.before($new_form).remove();}
this.process($new_form);},preprocess_field:function($field){var self=this;var name=$field.attr('name'),field_colspan=parseInt($field.attr('colspan'),10),field_modifiers=JSON.parse($field.attr('modifiers')||'{}');if($field.attr('nolabel')==='1')
return;$field.attr('nolabel','1');var found=false;this.$form.find('label[for="'+name+'"]').each(function(i,el){$(el).parents().each(function(unused,tag){var name=tag.tagName.toLowerCase();if(name==="field"||name in self.tags_registry.map)
found=true;});});if(found)
return;var $label=$('<label/>').attr({'for':name,"modifiers":JSON.stringify({invisible:field_modifiers.invisible}),"string":$field.attr('string'),"help":$field.attr('help'),"class":$field.attr('class'),});$label.insertBefore($field);if(field_colspan>1){$field.attr('colspan',field_colspan-1);}
return $label;},process_field:function($field){if($field.parent().is('group')){var $label=this.preprocess_field($field);if($label){this.process($label);}}
this.fields_to_init.push($field);return $field;},process_group:function($group){var self=this;$group.children('field').each(function(){self.preprocess_field($(this));});var $new_group=this.render_element('FormRenderingGroup',$group.getAttributes());var $table;if($new_group.first().is('table.oe_form_group')){$table=$new_group;}else if($new_group.filter('table.oe_form_group').length){$table=$new_group.filter('table.oe_form_group').first();}else{$table=$new_group.find('table.oe_form_group').first();}
var $tr,$td,cols=parseInt($group.attr('col')||2,10),row_cols=cols;var children=[];$group.children().each(function(a,b,c){var $child=$(this);var colspan=parseInt($child.attr('colspan')||1,10);var tagName=$child[0].tagName.toLowerCase();var $td=$('<td/>').addClass('oe_form_group_cell').attr('colspan',colspan);var newline=tagName==='newline';if($tr&&row_cols>0&&(newline||row_cols<colspan)){$tr.addClass('oe_form_group_row_incomplete');if(newline){$tr.addClass('oe_form_group_row_newline');}}
if(newline){$tr=null;return;}
if(!$tr||row_cols<colspan){$tr=$('<tr/>').addClass('oe_form_group_row').appendTo($table);row_cols=cols;}else if(tagName==='group'){$td.addClass('oe_group_right')}
row_cols-=colspan;var field_modifiers=JSON.parse($child.attr('modifiers')||'{}');var invisible=field_modifiers.invisible;self.handle_common_properties($td,$("<dummy>").attr("modifiers",JSON.stringify({invisible:invisible})));$tr.append($td.append($child));children.push($child[0]);});if(row_cols&&$td){$td.attr('colspan',parseInt($td.attr('colspan'),10)+row_cols);}
$group.before($new_group).remove();$table.find('> tbody > tr').each(function(){var to_compute=[],row_cols=cols,total=100;$(this).children().each(function(){var $td=$(this),$child=$td.children(':first');switch($child[0].tagName.toLowerCase()){case'separator':break;case'label':if($child.attr('for')){$td.attr('width','1%').addClass('oe_form_group_cell_label');row_cols-=$td.attr('colspan')||1;total--;}
break;default:var width=_.str.trim($child.attr('width')||''),iwidth=parseInt(width,10);if(iwidth){if(width.substr(-1)==='%'){total-=iwidth;width=iwidth+'%';}else{$td.css('min-width',width+'px');}
$td.attr('width',width);$child.removeAttr('width');row_cols-=$td.attr('colspan')||1;}else{to_compute.push($td);}}});if(row_cols){var unit=Math.floor(total/row_cols);if(!$(this).is('.oe_form_group_row_incomplete')){_.each(to_compute,function($td,i){var width=parseInt($td.attr('colspan'),10)*unit;$td.attr('width',width+'%');total-=width;});}}});_.each(children,function(el){self.process($(el));});this.handle_common_properties($new_group,$group);return $new_group;},process_notebook:function($notebook){var self=this;var pages=[];$notebook.find('> page').each(function(){var $page=$(this);var page_attrs=$page.getAttributes();page_attrs.id=_.uniqueId('notebook_page_');var $new_page=self.render_element('FormRenderingNotebookPage',page_attrs);$page.contents().appendTo($new_page);$page.before($new_page).remove();var ic=self.handle_common_properties($new_page,$page).invisibility_changer;page_attrs.__page=$new_page;page_attrs.__ic=ic;pages.push(page_attrs);$new_page.children().each(function(){self.process($(this));});});var $new_notebook=this.render_element('FormRenderingNotebook',{pages:pages});$notebook.contents().appendTo($new_notebook);$notebook.before($new_notebook).remove();self.process($($new_notebook.children()[0]));$new_notebook.tabs();_.each(pages,function(page,i){if(!page.__ic)
return;page.__ic.on("change:effective_invisible",null,function(){if(!page.__ic.get('effective_invisible')){$new_notebook.tabs('select',i);return;}
var current=$new_notebook.tabs("option","selected");if(!pages[current].__ic||!pages[current].__ic.get("effective_invisible"))
return;var first_visible=_.find(_.range(pages.length),function(i2){return(!pages[i2].__ic)||(!pages[i2].__ic.get("effective_invisible"));});if(first_visible!==undefined){$new_notebook.tabs('select',first_visible);}});});this.handle_common_properties($new_notebook,$notebook);return $new_notebook;},process_separator:function($separator){var $new_separator=this.render_element('FormRenderingSeparator',$separator.getAttributes());$separator.before($new_separator).remove();this.handle_common_properties($new_separator,$separator);return $new_separator;},process_label:function($label){var name=$label.attr("for"),field_orm=this.fvg.fields[name];var dict={string:$label.attr('string')||(field_orm||{}).string||'',help:$label.attr('help')||(field_orm||{}).help||'',_for:name?_.uniqueId('oe-field-input-'):undefined,};var align=parseFloat(dict.align);if(isNaN(align)||align===1){align='right';}else if(align===0){align='left';}else{align='center';}
dict.align=align;var $new_label=this.render_element('FormRenderingLabel',dict);$label.before($new_label).remove();this.handle_common_properties($new_label,$label);if(name){this.labels[name]=$new_label;}
return $new_label;},handle_common_properties:function($new_element,$node){var str_modifiers=$node.attr("modifiers")||"{}";var modifiers=JSON.parse(str_modifiers);var ic=null;if(modifiers.invisible!==undefined)
ic=new instance.web.form.InvisibilityChanger(this.view,this.view,modifiers.invisible,$new_element);$new_element.addClass($node.attr("class")||"");$new_element.attr('style',$node.attr('style'));return{invisibility_changer:ic,};},});instance.web.form.DefaultFieldManager=instance.web.Widget.extend({init:function(parent,eval_context){this._super(parent);this.field_descs={};this.eval_context=eval_context||{};this.set({display_invalid_fields:false,actual_mode:'create',});},get_field_desc:function(field_name){if(this.field_descs[field_name]===undefined){this.field_descs[field_name]={string:field_name,};}
return this.field_descs[field_name];},extend_field_desc:function(fields){var self=this;_.each(fields,function(v,k){_.extend(self.get_field_desc(k),v);});},get_field_value:function(field_name){return false;},set_values:function(values){},compute_domain:function(expression){return instance.web.form.compute_domain(expression,{});},build_eval_context:function(){return new instance.web.CompoundContext(this.eval_context);},});instance.web.form.compute_domain=function(expr,fields){if(!(expr instanceof Array))
return!!expr;var stack=[];for(var i=expr.length-1;i>=0;i--){var ex=expr[i];if(ex.length==1){var top=stack.pop();switch(ex){case'|':stack.push(stack.pop()||top);continue;case'&':stack.push(stack.pop()&&top);continue;case'!':stack.push(!top);continue;default:throw new Error(_.str.sprintf(_t("Unknown operator %s in domain %s"),ex,JSON.stringify(expr)));}}
var field=fields[ex[0]];if(!field){throw new Error(_.str.sprintf(_t("Unknown field %s in domain %s"),ex[0],JSON.stringify(expr)));}
var field_value=field.get_value?field.get_value():field.value;var op=ex[1];var val=ex[2];switch(op.toLowerCase()){case'=':case'==':stack.push(_.isEqual(field_value,val));break;case'!=':case'<>':stack.push(!_.isEqual(field_value,val));break;case'<':stack.push(field_value<val);break;case'>':stack.push(field_value>val);break;case'<=':stack.push(field_value<=val);break;case'>=':stack.push(field_value>=val);break;case'in':if(!_.isArray(val))val=[val];stack.push(_(val).contains(field_value));break;case'not in':if(!_.isArray(val))val=[val];stack.push(!_(val).contains(field_value));break;default:console.warn(_t("Unsupported operator %s in domain %s"),op,JSON.stringify(expr));}}
return _.all(stack,_.identity);};instance.web.form.is_bin_size=function(v){return/^\d+(\.\d*)? \w+$/.test(v);};instance.web.form.InvisibilityChangerMixin={init:function(field_manager,invisible_domain){var self=this;this._ic_field_manager=field_manager;this._ic_invisible_modifier=invisible_domain;this._ic_field_manager.on("view_content_has_changed",this,function(){var result=self._ic_invisible_modifier===undefined?false:self._ic_field_manager.compute_domain(self._ic_invisible_modifier);self.set({"invisible":result});});this.set({invisible:this._ic_invisible_modifier===true,force_invisible:false});var check=function(){if(self.get("invisible")||self.get('force_invisible')){self.set({"effective_invisible":true});}else{self.set({"effective_invisible":false});}};this.on('change:invisible',this,check);this.on('change:force_invisible',this,check);check.call(this);},start:function(){this.on("change:effective_invisible",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggleClass('oe_form_invisible',this.get("effective_invisible"));},};instance.web.form.InvisibilityChanger=instance.web.Class.extend(instance.web.PropertiesMixin,instance.web.form.InvisibilityChangerMixin,{init:function(parent,field_manager,invisible_domain,$el){this.setParent(parent);instance.web.PropertiesMixin.init.call(this);instance.web.form.InvisibilityChangerMixin.init.call(this,field_manager,invisible_domain);this.$el=$el;this.start();},});instance.web.form.FormWidget=instance.web.Widget.extend(instance.web.form.InvisibilityChangerMixin,{init:function(field_manager,node){this._super(field_manager);this.field_manager=field_manager;if(this.field_manager instanceof instance.web.FormView)
this.view=this.field_manager;this.node=node;this.modifiers=JSON.parse(this.node.attrs.modifiers||'{}');instance.web.form.InvisibilityChangerMixin.init.call(this,this.field_manager,this.modifiers.invisible);this.field_manager.on("view_content_has_changed",this,this.process_modifiers);this.set({required:false,readonly:false,});var self=this;var test_effective_readonly=function(){self.set({"effective_readonly":self.get("readonly")||self.field_manager.get("actual_mode")==="view"});};this.on("change:readonly",this,test_effective_readonly);this.field_manager.on("change:actual_mode",this,test_effective_readonly);test_effective_readonly.call(this);},renderElement:function(){this.process_modifiers();this._super();this.$el.addClass(this.node.attrs["class"]||"");},destroy:function(){$.fn.tipsy.clear();this._super.apply(this,arguments);},setupFocus:function($e){var self=this;$e.on({focus:function(){self.trigger('focused');},blur:function(){self.trigger('blurred');}});},process_modifiers:function(){var to_set={};for(var a in this.modifiers){if(!this.modifiers.hasOwnProperty(a)){continue;}
if(!_.include(["invisible"],a)){var val=this.field_manager.compute_domain(this.modifiers[a]);to_set[a]=val;}}
this.set(to_set);},do_attach_tooltip:function(widget,trigger,options){widget=widget||this;trigger=trigger||this.$el;options=_.extend({delayIn:500,delayOut:0,fade:true,title:function(){var template=widget.template+'.tooltip';if(!QWeb.has_template(template)){template='WidgetLabel.tooltip';}
return QWeb.render(template,{debug:instance.session.debug,widget:widget})},gravity:$.fn.tipsy.autoBounds(50,'nw'),html:true,opacity:0.85,trigger:'hover'},options||{});$(trigger).tipsy(options);},build_context:function(){var v_context=this.node.attrs.context;if(!v_context){v_context=(this.field||{}).context||{};}
if(v_context.__ref||true){var fields_values=this.field_manager.build_eval_context();v_context=new instance.web.CompoundContext(v_context).set_eval_context(fields_values);}
return v_context;},build_domain:function(){var f_domain=this.field.domain||[];var n_domain=this.node.attrs.domain||null;var final_domain=n_domain!==null?n_domain:f_domain;if(!(final_domain instanceof Array)||true){var fields_values=this.field_manager.build_eval_context();final_domain=new instance.web.CompoundDomain(final_domain).set_eval_context(fields_values);}
return final_domain;}});instance.web.form.WidgetButton=instance.web.form.FormWidget.extend({template:'WidgetButton',init:function(field_manager,node){node.attrs.type=node.attrs['data-button-type'];this._super(field_manager,node);this.force_disabled=false;this.string=(this.node.attrs.string||'').replace(/_/g,'');if(JSON.parse(this.node.attrs.default_focus||"0")){this.view.default_focus_button=this;}
if(this.node.attrs.icon&&(!/\//.test(this.node.attrs.icon))){this.node.attrs.icon='/web/static/src/img/icons/'+this.node.attrs.icon+'.png';}},start:function(){this._super.apply(this,arguments);this.view.on('view_content_has_changed',this,this.check_disable);this.check_disable();this.$el.click(this.on_click);if(this.node.attrs.help||instance.session.debug){this.do_attach_tooltip();}
this.setupFocus(this.$el);},on_click:function(){var self=this;this.force_disabled=true;this.check_disable();this.execute_action().always(function(){self.force_disabled=false;self.check_disable();});},execute_action:function(){var self=this;var exec_action=function(){if(self.node.attrs.confirm){var def=$.Deferred();var dialog=instance.web.dialog($('<div/>').text(self.node.attrs.confirm),{title:_t('Confirm'),modal:true,buttons:[{text:_t("Cancel"),click:function(){$(this).dialog("close");}},{text:_t("Ok"),click:function(){var self2=this;self.on_confirmed().always(function(){$(self2).dialog("close");});}}],beforeClose:function(){def.resolve();},});return def.promise();}else{return self.on_confirmed();}};if(!this.node.attrs.special){return this.view.recursive_save().then(exec_action);}else{return exec_action();}},on_confirmed:function(){var self=this;var context=this.build_context();return this.view.do_execute_action(_.extend({},this.node.attrs,{context:context}),this.view.dataset,this.view.datarecord.id,function(){self.view.recursive_reload();});},check_disable:function(){var disabled=(this.force_disabled||!this.view.is_interactible_record());this.$el.prop('disabled',disabled);this.$el.css('color',disabled?'grey':'');}});instance.web.form.FieldInterface={init:function(field_manager,node){},set_value:function(value_){},get_value:function(){},set_input_id:function(id){},is_valid:function(){},is_syntax_valid:function(){},focus:function(){},on_translate:function(){},commit_value:function(){},};instance.web.form.AbstractField=instance.web.form.FormWidget.extend(instance.web.form.FieldInterface,{init:function(field_manager,node){var self=this
this._super(field_manager,node);this.name=this.node.attrs.name;this.field=this.field_manager.get_field_desc(this.name);this.widget=this.node.attrs.widget;this.string=this.node.attrs.string||this.field.string||this.name;this.options=instance.web.py_eval(this.node.attrs.options||'{}');this.set({'value':false});this.on("change:value",this,function(){this.trigger('changed_value');this._check_css_flags();});},renderElement:function(){var self=this;this._super();if(this.field.translate&&this.view){this.$el.addClass('oe_form_field_translatable');this.$el.find('.oe_field_translate').click(this.on_translate);}
this.$label=this.view?this.view.$el.find('label[for='+this.id_for_label+']'):$();if(instance.session.debug){this.do_attach_tooltip(this,this.$label[0]||this.$el);this.$label.off('dblclick').on('dblclick',function(){console.log("Field '%s' of type '%s' in View: %o",self.name,(self.node.attrs.widget||self.field.type),self.view);window.w=self;console.log("window.w =",window.w);});}
if(!this.disable_utility_classes){this.off("change:required",this,this._set_required);this.on("change:required",this,this._set_required);this._set_required();}
this._check_visibility();this.field_manager.off("change:display_invalid_fields",this,this._check_css_flags);this.field_manager.on("change:display_invalid_fields",this,this._check_css_flags);this._check_css_flags();},start:function(){var tmp=this._super();this.on("change:value",this,function(){if(!this.no_rerender)
this.render_value();});this.render_value();},_set_required:function(){this.$el.toggleClass('oe_form_required',this.get("required"));},set_value:function(value_){this.set({'value':value_});},get_value:function(){return this.get('value');},internal_set_value:function(value_){var tmp=this.no_render;this.no_rerender=true;this.set({'value':value_});this.no_rerender=tmp;},render_value:function(){},is_valid:function(){return this.is_syntax_valid()&&!(this.get('required')&&this.is_false());},is_syntax_valid:function(){return true;},is_false:function(){return this.get('value')===false;},_check_css_flags:function(){if(this.field.translate){this.$el.find('.oe_field_translate').toggle(this.field_manager.get('actual_mode')!=="create");}
if(!this.disable_utility_classes){if(this.field_manager.get('display_invalid_fields')){this.$el.toggleClass('oe_form_invalid',!this.is_valid());}}},focus:function(){return false;},set_input_id:function(id){this.id_for_label=id;},on_translate:function(){var self=this;var trans=new instance.web.DataSet(this,'ir.translation');return trans.call_button('translate_fields',[this.view.dataset.model,this.view.datarecord.id,this.name,this.view.dataset.get_context()]).done(function(r){self.do_action(r);});},set_dimensions:function(height,width){this.$el.css({width:width,minHeight:height});},commit_value:function(){return $.when();},});instance.web.form.ReinitializeWidgetMixin={start:function(){this.initialize_field();this._super();},initialize_field:function(){this.on("change:effective_readonly",this,this.reinitialize);this.initialize_content();},reinitialize:function(){this.destroy_content();this.renderElement();this.initialize_content();},destroy_content:function(){},initialize_content:function(){},};instance.web.form.ReinitializeFieldMixin=_.extend({},instance.web.form.ReinitializeWidgetMixin,{reinitialize:function(){instance.web.form.ReinitializeWidgetMixin.reinitialize.call(this);this.render_value();},});if($.browser.msie&&$.browser.version==="9.0"){document.addEventListener("DOMNodeInserted",function(event){var nodename=event.target.nodeName.toLowerCase();if(nodename==="input"||nodename=="textarea"){$(event.target).placeholder();}});}
instance.web.form.FieldChar=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldChar',widget_class:'oe_form_field_char',events:{'change input':'store_dom_value',},init:function(field_manager,node){this._super(field_manager,node);this.password=this.node.attrs.password==='True'||this.node.attrs.password==='1';},initialize_content:function(){this.setupFocus(this.$('input'));},store_dom_value:function(){if(!this.get('effective_readonly')&&this.$('input').length&&this.is_syntax_valid()){this.internal_set_value(this.parse_value(this.$('input').val()));}},commit_value:function(){this.store_dom_value();return this._super();},render_value:function(){var show_value=this.format_value(this.get('value'),'');if(!this.get("effective_readonly")){this.$el.find('input').val(show_value);}else{if(this.password){show_value=new Array(show_value.length+1).join('*');}
this.$(".oe_form_char_content").text(show_value);}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.$("input").size()>0){try{this.parse_value(this.$('input').val(),'');return true;}catch(e){return false;}}
return true;},parse_value:function(val,def){return instance.web.parse_value(val,this,def);},format_value:function(val,def){return instance.web.format_value(val,this,def);},is_false:function(){return this.get('value')===''||this._super();},focus:function(){this.$('input:first')[0].focus();},set_dimensions:function(height,width){this._super(height,width);this.$('input').css({height:height,width:width});}});instance.web.form.FieldID=instance.web.form.FieldChar.extend({process_modifiers:function(){this._super();this.set({readonly:true});},});instance.web.form.FieldEmail=instance.web.form.FieldChar.extend({template:'FieldEmail',initialize_content:function(){this._super();var $button=this.$el.find('button');$button.click(this.on_button_clicked);this.setupFocus($button);},render_value:function(){if(!this.get("effective_readonly")){this._super();}else{this.$el.find('a').attr('href','mailto:'+this.get('value')).text(this.get('value')||'');}},on_button_clicked:function(){if(!this.get('value')||!this.is_syntax_valid()){this.do_warn(_t("E-mail error"),_t("Can't send email to invalid e-mail address"));}else{location.href='mailto:'+this.get('value');}}});instance.web.form.FieldUrl=instance.web.form.FieldChar.extend({template:'FieldUrl',initialize_content:function(){this._super();var $button=this.$el.find('button');$button.click(this.on_button_clicked);this.setupFocus($button);},render_value:function(){if(!this.get("effective_readonly")){this._super();}else{var tmp=this.get('value');var s=/(\w+):(.+)|^\.{0,2}\//.exec(tmp);if(!s){tmp="http://"+this.get('value');}
this.$el.find('a').attr('href',tmp).text(this.get('value')?tmp:'');}},on_button_clicked:function(){if(!this.get('value')){this.do_warn(_t("Resource error"),_t("This resource is empty"));}else{var url=$.trim(this.get('value'));if(/^www\./i.test(url))
url='http://'+url;window.open(url);}}});instance.web.form.FieldFloat=instance.web.form.FieldChar.extend({is_field_number:true,widget_class:'oe_form_field_float',init:function(field_manager,node){this._super(field_manager,node);this.internal_set_value(0);if(this.node.attrs.digits){this.digits=this.node.attrs.digits;}else{this.digits=this.field.digits;}},set_value:function(value_){if(value_===false||value_===undefined){value_=0;}
this._super.apply(this,[value_]);},focus:function(){this.$('input:first').select();}});instance.web.DateTimeWidget=instance.web.Widget.extend({template:"web.datepicker",jqueryui_object:'datetimepicker',type_of_date:"datetime",events:{'change .oe_datepicker_master':'change_datetime',},init:function(parent){this._super(parent);this.name=parent.name;},start:function(){var self=this;this.$input=this.$el.find('input.oe_datepicker_master');this.$input_picker=this.$el.find('input.oe_datepicker_container');this.picker({onClose:this.on_picker_select,onSelect:this.on_picker_select,changeMonth:true,changeYear:true,showWeek:true,showButtonPanel:true,firstDay:Date.CultureInfo.firstDayOfWeek});this.picker('widget').click(function(e){e.stopPropagation();});this.$el.find('img.oe_datepicker_trigger').click(function(){if(self.get("effective_readonly")||self.picker('widget').is(':visible')){self.$input.focus();return;}
self.picker('setDate',self.get('value')?instance.web.auto_str_to_date(self.get('value')):new Date());self.$input_picker.show();self.picker('show');self.$input_picker.hide();});this.set_readonly(false);this.set({'value':false});},picker:function(){return $.fn[this.jqueryui_object].apply(this.$input_picker,arguments);},on_picker_select:function(text,instance_){var date=this.picker('getDate');this.$input.val(date?this.format_client(date):'').change().focus();},set_value:function(value_){this.set({'value':value_});this.$input.val(value_?this.format_client(value_):'');},get_value:function(){return this.get('value');},set_value_from_ui_:function(){var value_=this.$input.val()||false;this.set({'value':this.parse_client(value_)});},set_readonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);this.$el.find('img.oe_datepicker_trigger').toggleClass('oe_input_icon_disabled',readonly);},is_valid_:function(){var value_=this.$input.val();if(value_===""){return true;}else{try{this.parse_client(value_);return true;}catch(e){return false;}}},parse_client:function(v){return instance.web.parse_value(v,{"widget":this.type_of_date});},format_client:function(v){return instance.web.format_value(v,{"widget":this.type_of_date});},change_datetime:function(){if(this.is_valid_()){this.set_value_from_ui_();this.trigger("datetime_changed");}},commit_value:function(){this.change_datetime();},});instance.web.DateWidget=instance.web.DateTimeWidget.extend({jqueryui_object:'datepicker',type_of_date:"date"});instance.web.form.FieldDatetime=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:"FieldDatetime",build_widget:function(){return new instance.web.DateTimeWidget(this);},destroy_content:function(){if(this.datewidget){this.datewidget.destroy();this.datewidget=undefined;}},initialize_content:function(){if(!this.get("effective_readonly")){this.datewidget=this.build_widget();this.datewidget.on('datetime_changed',this,_.bind(function(){this.internal_set_value(this.datewidget.get_value());},this));this.datewidget.appendTo(this.$el);this.setupFocus(this.datewidget.$input);}},render_value:function(){if(!this.get("effective_readonly")){this.datewidget.set_value(this.get('value'));}else{this.$el.text(instance.web.format_value(this.get('value'),this,''));}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.datewidget){return this.datewidget.is_valid_();}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function(){if(this.datewidget&&this.datewidget.$input){this.datewidget.$input[0].focus();}},set_dimensions:function(height,width){this._super(height,width);this.datewidget.$input.css('height',height);}});instance.web.form.FieldDate=instance.web.form.FieldDatetime.extend({template:"FieldDate",build_widget:function(){return new instance.web.DateWidget(this);}});instance.web.form.FieldText=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldText',events:{'keyup':function(e){if(e.which===$.ui.keyCode.ENTER){e.stopPropagation();}},'change textarea':'store_dom_value',},initialize_content:function(){var self=this;if(!this.get("effective_readonly")){this.$textarea=this.$el.find('textarea');this.auto_sized=false;this.default_height=this.$textarea.css('height');if(this.get("effective_readonly")){this.$textarea.attr('disabled','disabled');}
this.setupFocus(this.$textarea);}else{this.$textarea=undefined;}},commit_value:function(){if(!this.get("effective_readonly")&&this.$textarea){this.store_dom_value();}
return this._super();},store_dom_value:function(){this.internal_set_value(instance.web.parse_value(this.$textarea.val(),this));},render_value:function(){if(!this.get("effective_readonly")){var show_value=instance.web.format_value(this.get('value'),this,'');if(show_value===''){this.$textarea.css('height',parseInt(this.default_height)+"px");}
this.$textarea.val(show_value);if(!this.auto_sized){this.auto_sized=true;this.$textarea.autosize();}else{this.$textarea.trigger("autosize");}}else{var txt=this.get("value");this.$(".oe_form_text_content").text(txt);}},is_syntax_valid:function(){if(!this.get("effective_readonly")&&this.$textarea){try{instance.web.parse_value(this.$textarea.val(),this,'');return true;}catch(e){return false;}}
return true;},is_false:function(){return this.get('value')===''||this._super();},focus:function($el){if(!this.get("effective_readonly")&&this.$textarea){this.$textarea[0].focus();}},set_dimensions:function(height,width){this._super(height,width);if(!this.get("effective_readonly")&&this.$textarea){this.$textarea.css({width:width,minHeight:height});}},});instance.web.form.FieldTextHtml=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldTextHtml',init:function(){this._super.apply(this,arguments);},initialize_content:function(){var self=this;if(!this.get("effective_readonly")){self._updating_editor=false;this.$textarea=this.$el.find('textarea');var width=((this.node.attrs||{}).editor_width||'100%');var height=((this.node.attrs||{}).editor_height||250);this.$textarea.cleditor({width:width,height:height,controls:"bold italic underline strikethrough "+"| removeformat | bullets numbering | outdent "+"indent | link unlink | source",bodyStyle:"margin:4px; color:#4c4c4c; font-size:13px; font-family:\"Lucida Grande\",Helvetica,Verdana,Arial,sans-serif; cursor:text"});this.$cleditor=this.$textarea.cleditor()[0];this.$cleditor.change(function(){if(!self._updating_editor){self.$cleditor.updateTextArea();self.internal_set_value(self.$textarea.val());}});}},render_value:function(){if(!this.get("effective_readonly")){this.$textarea.val(this.get('value')||'');this._updating_editor=true;this.$cleditor.updateFrame();this._updating_editor=false;}else{this.$el.html(this.get('value'));}},});instance.web.form.FieldBoolean=instance.web.form.AbstractField.extend({template:'FieldBoolean',start:function(){var self=this;this.$checkbox=$("input",this.$el);this.setupFocus(this.$checkbox);this.$el.click(_.bind(function(){this.internal_set_value(this.$checkbox.is(':checked'));},this));var check_readonly=function(){self.$checkbox.prop('disabled',self.get("effective_readonly"));};this.on("change:effective_readonly",this,check_readonly);check_readonly.call(this);this._super.apply(this,arguments);},render_value:function(){this.$checkbox[0].checked=this.get('value');},focus:function(){this.$checkbox[0].focus();}});instance.web.form.FieldProgressBar=instance.web.form.AbstractField.extend({template:'FieldProgressBar',render_value:function(){this.$el.progressbar({value:this.get('value')||0,disabled:this.get("effective_readonly")});var formatted_value=instance.web.format_value(this.get('value')||0,{type:'float'});this.$('span').html(formatted_value+'%');}});instance.web.form.FieldSelection=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldSelection',events:{'change select':'store_dom_value',},init:function(field_manager,node){var self=this;this._super(field_manager,node);this.values=_(this.field.selection).chain().reject(function(v){return v[0]===false&&v[1]==='';}).unshift([false,'']).value();},initialize_content:function(){var ischanging=false;var $select=this.$el.find('select').change(function(){ischanging=true;}).click(function(){ischanging=false;}).keyup(function(e){if(e.which!==13||!ischanging){return;}
e.stopPropagation();ischanging=false;});this.setupFocus($select);},commit_value:function(){this.store_dom_value();return this._super();},store_dom_value:function(){if(!this.get('effective_readonly')&&this.$('select').length){this.internal_set_value(this.values[this.$('select')[0].selectedIndex][0]);}},set_value:function(value_){value_=value_===null?false:value_;value_=value_ instanceof Array?value_[0]:value_;this._super(value_);},render_value:function(){if(!this.get("effective_readonly")){var index=0;for(var i=0,ii=this.values.length;i<ii;i++){if(this.values[i][0]===this.get('value'))index=i;}
this.$el.find('select')[0].selectedIndex=index;}else{var self=this;var option=_(this.values).detect(function(record){return record[0]===self.get('value');});this.$el.text(option?option[1]:this.values[0][1]);}},focus:function(){this.$('select:first')[0].focus();},set_dimensions:function(height,width){this._super(height,width);this.$('select').css({height:height,width:width});}});(function(){var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value_){return matcher.test($("<div>").html(value_.label||value_.value||value_).text());});}
$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term));};}else{initSource.call(this);}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul).addClass(item.classname);}});})();instance.web.form.CompletionFieldMixin={init:function(){this.limit=7;this.orderer=new instance.web.DropMisordered();},get_search_result:function(search_val){var self=this;var dataset=new instance.web.DataSet(this,this.field.relation,self.build_context());var blacklist=this.get_search_blacklist();this.last_query=search_val;return this.orderer.add(dataset.name_search(search_val,new instance.web.CompoundDomain(self.build_domain(),[["id","not in",blacklist]]),'ilike',this.limit+1,self.build_context())).then(function(data){self.last_search=data;var values=_.map(data,function(x){x[1]=x[1].split("\n")[0];return{label:_.str.escapeHTML(x[1]),value:x[1],name:x[1],id:x[0],};});if(values.length>self.limit){values=values.slice(0,self.limit);values.push({label:_t("Search More..."),action:function(){dataset.name_search(search_val,self.build_domain(),'ilike',false).done(function(data){self._search_create_popup("search",data);});},classname:'oe_m2o_dropdown_option'});}
var raw_result=_(data.result).map(function(x){return x[1];});if(search_val.length>0&&!_.include(raw_result,search_val)){values.push({label:_.str.sprintf(_t('Create "<strong>%s</strong>"'),$('<span />').text(search_val).html()),action:function(){self._quick_create(search_val);},classname:'oe_m2o_dropdown_option'});}
values.push({label:_t("Create and Edit..."),action:function(){self._search_create_popup("form",undefined,self._create_context(search_val));},classname:'oe_m2o_dropdown_option'});return values;});},get_search_blacklist:function(){return[];},_quick_create:function(name){var self=this;var slow_create=function(){self._search_create_popup("form",undefined,self._create_context(name));};if(self.options.quick_create===undefined||self.options.quick_create){new instance.web.DataSet(this,this.field.relation,self.build_context()).name_create(name).done(function(data){self.add_id(data[0]);}).fail(function(error,event){event.preventDefault();slow_create();});}else
slow_create();},_search_create_popup:function(view,ids,context){var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(self.field.relation,{title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids?_.map(ids,function(x){return x[0]}):undefined,initial_view:view,disable_multiple_selection:true},self.build_domain(),new instance.web.CompoundContext(self.build_context(),context||{}));pop.on("elements_selected",self,function(element_ids){self.add_id(element_ids[0]);self.focus();});},add_id:function(id){},_create_context:function(name){var tmp={};var field=(this.options||{}).create_name_field;if(field===undefined)
field="name";if(field!==false&&name&&(this.options||{}).quick_create!==false)
tmp["default_"+field]=name;return tmp;},};instance.web.form.M2ODialog=instance.web.Dialog.extend({template:"M2ODialog",init:function(parent){this._super(parent,{title:_.str.sprintf(_t("Add %s"),parent.string),width:312,});},start:function(){var self=this;this.$buttons.html(QWeb.render("M2ODialog.buttons"));this.$("input").val(this.getParent().last_query);this.$buttons.find(".oe_form_m2o_qc_button").click(function(){self.getParent()._quick_create(self.$("input").val());self.destroy();});this.$buttons.find(".oe_form_m2o_sc_button").click(function(){self.getParent()._search_create_popup("form",undefined,self.getParent()._create_context(self.$("input").val()));self.destroy();});this.$buttons.find(".oe_form_m2o_cancel_button").click(function(){self.destroy();});},});instance.web.form.FieldMany2One=instance.web.form.AbstractField.extend(instance.web.form.CompletionFieldMixin,instance.web.form.ReinitializeFieldMixin,{template:"FieldMany2One",events:{'keydown input':function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.stopPropagation();}},},init:function(field_manager,node){this._super(field_manager,node);instance.web.form.CompletionFieldMixin.init.call(this);this.set({'value':false});this.display_value={};this.last_search=[];this.floating=false;this.current_display=null;this.is_started=false;},reinit_value:function(val){this.internal_set_value(val);this.floating=false;if(this.is_started)
this.render_value();},initialize_field:function(){this.is_started=true;instance.web.bus.on('click',this,function(){if(!this.get("effective_readonly")&&this.$input&&this.$input.autocomplete('widget').is(':visible')){this.$input.autocomplete("close");}});instance.web.form.ReinitializeFieldMixin.initialize_field.call(this);},initialize_content:function(){if(!this.get("effective_readonly"))
this.render_editable();},destroy_content:function(){if(this.$drop_down){this.$drop_down.off('click');delete this.$drop_down;}
if(this.$input){this.$input.closest(".ui-dialog .ui-dialog-content").off('scroll');this.$input.off('keyup blur autocompleteclose autocompleteopen '+'focus focusout change keydown');delete this.$input;}
if(this.$follow_button){this.$follow_button.off('blur focus click');delete this.$follow_button;}},destroy:function(){this.destroy_content();return this._super();},init_error_displayer:function(){},hide_error_displayer:function(){},show_error_displayer:function(){new instance.web.form.M2ODialog(this).open();},render_editable:function(){var self=this;this.$input=this.$el.find("input");this.init_error_displayer();self.$input.on('focus',function(){self.hide_error_displayer();});this.$drop_down=this.$el.find(".oe_m2o_drop_down_button");this.$follow_button=$(".oe_m2o_cm_button",this.$el);this.$follow_button.click(function(ev){ev.preventDefault();if(!self.get('value')){self.focus();return;}
var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.field.relation,self.get("value"),self.build_context(),{title:_t("Open: ")+self.string});pop.on('write_completed',self,function(){self.display_value={};self.render_value();self.focus();});});var input_changed=function(){if(self.current_display!==self.$input.val()){self.current_display=self.$input.val();if(self.$input.val()===""){self.internal_set_value(false);self.floating=false;}else{self.floating=true;}}};this.$input.keydown(input_changed);this.$input.change(input_changed);this.$drop_down.click(function(){self.$input.focus();if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}else{if(self.get("value")&&!self.floating){self.$input.autocomplete("search","");}else{self.$input.autocomplete("search");}}});var close_autocomplete=_.debounce(function(){if(self.$input.autocomplete("widget").is(":visible")){self.$input.autocomplete("close");}},50);this.$input.closest(".ui-dialog .ui-dialog-content").on('scroll',this,close_autocomplete);self.ed_def=$.Deferred();self.uned_def=$.Deferred();var ed_delay=200;var ed_duration=15000;var anyoneLoosesFocus=function(e){var used=false;if(self.floating){if(self.last_search.length>0){if(self.last_search[0][0]!=self.get("value")){self.display_value={};self.display_value[""+self.last_search[0][0]]=self.last_search[0][1];self.reinit_value(self.last_search[0][0]);}else{used=true;self.render_value();}}else{used=true;self.reinit_value(false);}
self.floating=false;}
if(used&&self.get("value")===false&&!self.no_ed){self.ed_def.reject();self.uned_def.reject();self.ed_def=$.Deferred();self.ed_def.done(function(){self.show_error_displayer();ignore_blur=false;self.trigger('focused');});ignore_blur=true;setTimeout(function(){self.ed_def.resolve();self.uned_def.reject();self.uned_def=$.Deferred();self.uned_def.done(function(){self.hide_error_displayer();});setTimeout(function(){self.uned_def.resolve();},ed_duration);},ed_delay);}else{self.no_ed=false;self.ed_def.reject();}};var ignore_blur=false;this.$input.on({focusout:anyoneLoosesFocus,focus:function(){self.trigger('focused');},autocompleteopen:function(){ignore_blur=true;},autocompleteclose:function(){ignore_blur=false;},blur:function(){if(ignore_blur){return;}
if(_(self.getChildren()).any(function(child){return child instanceof instance.web.form.AbstractFormPopup;})){return;}
self.trigger('blurred');}});var isSelecting=false;this.$input.autocomplete({source:function(req,resp){self.get_search_result(req.term).done(function(result){resp(result);});},select:function(event,ui){isSelecting=true;var item=ui.item;if(item.id){self.display_value={};self.display_value[""+item.id]=item.name;self.reinit_value(item.id);}else if(item.action){item.action();self.trigger('focused');return false;}},focus:function(e,ui){e.preventDefault();},html:true,minLength:0,delay:0});this.$input.autocomplete("widget").openerpClass();this.$input.keyup(function(e){if(e.which===13){if(isSelecting)
e.stopPropagation();}
isSelecting=false;});this.setupFocus(this.$follow_button);},render_value:function(no_recurse){var self=this;if(!this.get("value")){this.display_string("");return;}
var display=this.display_value[""+this.get("value")];if(display){this.display_string(display);return;}
if(!no_recurse){var dataset=new instance.web.DataSetStatic(this,this.field.relation,self.build_context());dataset.name_get([self.get("value")]).done(function(data){self.display_value[""+self.get("value")]=data[0][1];self.render_value(true);});}},display_string:function(str){var self=this;if(!this.get("effective_readonly")){this.$input.val(str.split("\n")[0]);this.current_display=this.$input.val();if(this.is_false()){this.$('.oe_m2o_cm_button').css({'display':'none'});}else{this.$('.oe_m2o_cm_button').css({'display':'inline'});}}else{var lines=_.escape(str).split("\n");var link="";var follow="";link=lines[0];follow=_.rest(lines).join("<br />");if(follow)
link+="<br />";var $link=this.$el.find('.oe_form_uri').unbind('click').html(link);if(!this.options.no_open)
$link.click(function(){self.do_action({type:'ir.actions.act_window',res_model:self.field.relation,res_id:self.get("value"),views:[[false,'form']],target:'current'});return false;});$(".oe_form_m2o_follow",this.$el).html(follow);}},set_value:function(value_){var self=this;if(value_ instanceof Array){this.display_value={};if(!this.options.always_reload){this.display_value[""+value_[0]]=value_[1];}
value_=value_[0];}
value_=value_||false;this.reinit_value(value_);},get_displayed:function(){return this.display_value[""+this.get("value")];},add_id:function(id){this.display_value={};this.reinit_value(id);},is_false:function(){return!this.get("value");},focus:function(){if(!this.get('effective_readonly')){this.$input&&this.$input[0].focus();}},_quick_create:function(){this.no_ed=true;this.ed_def.reject();return instance.web.form.CompletionFieldMixin._quick_create.apply(this,arguments);},_search_create_popup:function(){this.no_ed=true;this.ed_def.reject();return instance.web.form.CompletionFieldMixin._search_create_popup.apply(this,arguments);},set_dimensions:function(height,width){this._super(height,width);this.$input.css('height',height);}});instance.web.form.Many2OneButton=instance.web.form.AbstractField.extend({template:'Many2OneButton',init:function(field_manager,node){this._super.apply(this,arguments);},start:function(){this._super.apply(this,arguments);this.set_button();},set_button:function(){var self=this;if(this.$button){this.$button.remove();}
this.string='';this.node.attrs.icon=this.get('value')?'/web/static/src/img/icons/gtk-yes.png':'/web/static/src/img/icons/gtk-no.png';this.$button=$(QWeb.render('WidgetButton',{'widget':this}));this.$button.addClass('oe_link').css({'padding':'4px'});this.$el.append(this.$button);this.$button.on('click',self.on_click);},on_click:function(ev){var self=this;this.popup=new instance.web.form.FormOpenPopup(this);this.popup.show_element(this.field.relation,this.get('value'),this.build_context(),{title:this.string});this.popup.on('create_completed',self,function(r){self.set_value(r);});},set_value:function(value_){var self=this;if(value_ instanceof Array){value_=value_[0];}
value_=value_||false;this.set('value',value_);this.set_button();},});var commands={CREATE:0,'create':function(values){return[commands.CREATE,false,values];},UPDATE:1,'update':function(id,values){return[commands.UPDATE,id,values];},DELETE:2,'delete':function(id){return[commands.DELETE,id,false];},FORGET:3,'forget':function(id){return[commands.FORGET,id,false];},LINK_TO:4,'link_to':function(id){return[commands.LINK_TO,id,false];},DELETE_ALL:5,'delete_all':function(){return[5,false,false];},REPLACE_WITH:6,'replace_with':function(ids){return[6,false,ids];}};instance.web.form.FieldOne2Many=instance.web.form.AbstractField.extend({multi_selection:false,disable_utility_classes:true,init:function(field_manager,node){this._super(field_manager,node);lazy_build_o2m_kanban_view();this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;this.form_last_update=$.Deferred();this.init_form_last_update=this.form_last_update;this.is_started=false;this.dataset=new instance.web.form.One2ManyDataSet(this,this.field.relation);this.dataset.o2m=this;this.dataset.parent_view=this.view;this.dataset.child_name=this.name;var self=this;this.dataset.on('dataset_changed',this,function(){self.trigger_on_change();});this.set_value([]);},start:function(){this._super.apply(this,arguments);this.$el.addClass('oe_form_field oe_form_field_one2many');var self=this;self.load_views();this.is_loaded.done(function(){self.on("change:effective_readonly",self,function(){self.is_loaded=self.is_loaded.then(function(){self.viewmanager.destroy();return $.when(self.load_views()).done(function(){self.reload_current_view();});});});});this.is_started=true;this.reload_current_view();},trigger_on_change:function(){this.trigger('changed_value');},load_views:function(){var self=this;var modes=this.node.attrs.mode;modes=!!modes?modes.split(","):["tree"];var views=[];_.each(modes,function(mode){if(!_.include(["list","tree","graph","kanban"],mode)){throw new Error(_.str.sprintf(_t("View type '%s' is not supported in One2Many."),mode));}
var view={view_id:false,view_type:mode=="tree"?"list":mode,options:{}};if(self.field.views&&self.field.views[mode]){view.embedded_view=self.field.views[mode];}
if(view.view_type==="list"){_.extend(view.options,{addable:null,selectable:self.multi_selection,sortable:false,import_enabled:false,deletable:true});if(self.get("effective_readonly")){_.extend(view.options,{deletable:null,reorderable:false,});}}else if(view.view_type==="form"){if(self.get("effective_readonly")){view.view_type='form';}
_.extend(view.options,{not_interactible_on_create:true,});}else if(view.view_type==="kanban"){_.extend(view.options,{confirm_on_delete:false,});if(self.get("effective_readonly")){_.extend(view.options,{action_buttons:false,quick_creatable:false,creatable:false,read_only_mode:true,});}}
views.push(view);});this.views=views;this.viewmanager=new instance.web.form.One2ManyViewManager(this,this.dataset,views,{});this.viewmanager.o2m=self;var once=$.Deferred().done(function(){self.init_form_last_update.resolve();});var def=$.Deferred().done(function(){self.initial_is_loaded.resolve();});this.viewmanager.on("controller_inited",self,function(view_type,controller){controller.o2m=self;if(view_type=="list"){if(self.get("effective_readonly")){controller.on('edit:before',self,function(e){e.cancel=true;});_(controller.columns).find(function(column){if(!(column instanceof instance.web.list.Handle)){return false;}
column.modifiers.invisible=true;return true;});}}else if(view_type==="form"){if(self.get("effective_readonly")){$(".oe_form_buttons",controller.$el).children().remove();}
controller.on("load_record",self,function(){once.resolve();});controller.on('pager_action_executed',self,self.save_any_view);}else if(view_type=="graph"){self.reload_current_view()}
def.resolve();});this.viewmanager.on("switch_mode",self,function(n_mode,b,c,d,e){$.when(self.save_any_view()).done(function(){if(n_mode==="list"){$.async_when().done(function(){self.reload_current_view();});}});});$.async_when().done(function(){self.viewmanager.appendTo(self.$el);});return def;},reload_current_view:function(){var self=this;return self.is_loaded=self.is_loaded.then(function(){var active_view=self.viewmanager.active_view;var view=self.viewmanager.views[active_view].controller;if(active_view==="list"){return view.reload_content();}else if(active_view==="form"){if(self.dataset.index===null&&self.dataset.ids.length>=1){self.dataset.index=0;}
var act=function(){return view.do_show();};self.form_last_update=self.form_last_update.then(act,act);return self.form_last_update;}else if(view.do_search){return view.do_search(self.build_domain(),self.dataset.get_context(),[]);}},undefined);},set_value:function(value_){value_=value_||[];var self=this;this.dataset.reset_ids([]);if(value_.length>=1&&value_[0]instanceof Array){var ids=[];_.each(value_,function(command){var obj={values:command[2]};switch(command[0]){case commands.CREATE:obj['id']=_.uniqueId(self.dataset.virtual_id_prefix);obj.defaults={};self.dataset.to_create.push(obj);self.dataset.cache.push(_.extend(_.clone(obj),{values:_.clone(command[2])}));ids.push(obj.id);return;case commands.UPDATE:obj['id']=command[1];self.dataset.to_write.push(obj);self.dataset.cache.push(_.extend(_.clone(obj),{values:_.clone(command[2])}));ids.push(obj.id);return;case commands.DELETE:self.dataset.to_delete.push({id:command[1]});return;case commands.LINK_TO:ids.push(command[1]);return;case commands.DELETE_ALL:self.dataset.delete_all=true;return;}});this._super(ids);this.dataset.set_ids(ids);}else if(value_.length>=1&&typeof(value_[0])==="object"){var ids=[];this.dataset.delete_all=true;_.each(value_,function(command){var obj={values:command};obj['id']=_.uniqueId(self.dataset.virtual_id_prefix);obj.defaults={};self.dataset.to_create.push(obj);self.dataset.cache.push(_.clone(obj));ids.push(obj.id);});this._super(ids);this.dataset.set_ids(ids);}else{this._super(value_);this.dataset.reset_ids(value_);}
if(this.dataset.index===null&&this.dataset.ids.length>0){this.dataset.index=0;}
this.trigger_on_change();if(this.is_started){return self.reload_current_view();}else{return $.when();}},get_value:function(){var self=this;if(!this.dataset)
return[];var val=this.dataset.delete_all?[commands.delete_all()]:[];val=val.concat(_.map(this.dataset.ids,function(id){var alter_order=_.detect(self.dataset.to_create,function(x){return x.id===id;});if(alter_order){return commands.create(alter_order.values);}
alter_order=_.detect(self.dataset.to_write,function(x){return x.id===id;});if(alter_order){return commands.update(alter_order.id,alter_order.values);}
return commands.link_to(id);}));return val.concat(_.map(this.dataset.to_delete,function(x){return commands['delete'](x.id);}));},commit_value:function(){return this.save_any_view();},save_any_view:function(){if(this.viewmanager&&this.viewmanager.views&&this.viewmanager.active_view&&this.viewmanager.views[this.viewmanager.active_view]&&this.viewmanager.views[this.viewmanager.active_view].controller){var view=this.viewmanager.views[this.viewmanager.active_view].controller;if(this.viewmanager.active_view==="form"){if(!view.is_initialized.state()==='resolved'){return $.when(false);}
return $.when(view.save());}else if(this.viewmanager.active_view==="list"){return $.when(view.ensure_saved());}}
return $.when(false);},is_syntax_valid:function(){if(!this.viewmanager||!this.viewmanager.views[this.viewmanager.active_view])
return true;var view=this.viewmanager.views[this.viewmanager.active_view].controller;switch(this.viewmanager.active_view){case'form':return _(view.fields).chain().invoke('is_valid').all(_.identity).value();break;case'list':return view.is_valid();}
return true;},});instance.web.form.One2ManyViewManager=instance.web.ViewManager.extend({template:'One2Many.viewmanager',init:function(parent,dataset,views,flags){this._super(parent,dataset,views,_.extend({},flags,{$sidebar:false}));this.registry=this.registry.extend({list:'instance.web.form.One2ManyListView',form:'instance.web.form.One2ManyFormView',kanban:'instance.web.form.One2ManyKanbanView',});this.__ignore_blur=false;},switch_mode:function(mode,unused){if(mode!=='form'){return this._super(mode,unused);}
var self=this;var id=self.o2m.dataset.index!==null?self.o2m.dataset.ids[self.o2m.dataset.index]:null;var pop=new instance.web.form.FormOpenPopup(this);pop.show_element(self.o2m.field.relation,id,self.o2m.build_context(),{title:_t("Open: ")+self.o2m.string,create_function:function(data,options){return self.o2m.dataset.create(data,options).done(function(r){self.o2m.dataset.set_ids(self.o2m.dataset.ids.concat([r]));self.o2m.dataset.trigger("dataset_changed",r);});},write_function:function(id,data,options){return self.o2m.dataset.write(id,data,{}).done(function(){self.o2m.reload_current_view();});},alternative_form_view:self.o2m.field.views?self.o2m.field.views["form"]:undefined,parent_view:self.o2m.view,child_name:self.o2m.name,read_function:function(){return self.o2m.dataset.read_ids.apply(self.o2m.dataset,arguments);},form_view_options:{'not_interactible_on_create':true},readonly:self.o2m.get("effective_readonly")});pop.on("elements_selected",self,function(){self.o2m.reload_current_view();});},});instance.web.form.One2ManyDataSet=instance.web.BufferedDataSet.extend({get_context:function(){this.context=this.o2m.build_context();return this.context;}});instance.web.form.One2ManyListView=instance.web.ListView.extend({_template:'One2Many.listview',init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,_.extend(options||{},{GroupsType:instance.web.form.One2ManyGroups,ListType:instance.web.form.One2ManyList}));this.on('edit:before',this,this.proxy('_before_edit'));this.on('edit:after',this,this.proxy('_after_edit'));this.on('save:before cancel:before',this,this.proxy('_before_unedit'));this.records.bind('add',this.proxy("changed_records")).bind('edit',this.proxy("changed_records")).bind('remove',this.proxy("changed_records"));},start:function(){var ret=this._super();this.$el.off('mousedown.handleButtons').on('mousedown.handleButtons','table button',this.proxy('_button_down'));return ret;},changed_records:function(){this.o2m.trigger_on_change();},is_valid:function(){var editor=this.editor;var form=editor.form;if(!editor.record){return true}
if(!form.$el.is('.oe_form_dirty')){return true;}
this.o2m._dirty_flag=true;return _(form.fields).chain().invoke(function(){this._check_css_flags();return this.is_valid();}).all(_.identity).value();},do_add_record:function(){if(this.editable()){this._super.apply(this,arguments);}else{var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(self.o2m.field.relation,{title:_t("Create: ")+self.o2m.string,initial_view:"form",alternative_form_view:self.o2m.field.views?self.o2m.field.views["form"]:undefined,create_function:function(data,options){return self.o2m.dataset.create(data,options).done(function(r){self.o2m.dataset.set_ids(self.o2m.dataset.ids.concat([r]));self.o2m.dataset.trigger("dataset_changed",r);});},read_function:function(){return self.o2m.dataset.read_ids.apply(self.o2m.dataset,arguments);},parent_view:self.o2m.view,child_name:self.o2m.name,form_view_options:{'not_interactible_on_create':true}},self.o2m.build_domain(),self.o2m.build_context());pop.on("elements_selected",self,function(){self.o2m.reload_current_view();});}},do_activate_record:function(index,id){var self=this;var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.o2m.field.relation,id,self.o2m.build_context(),{title:_t("Open: ")+self.o2m.string,write_function:function(id,data){return self.o2m.dataset.write(id,data,{}).done(function(){self.o2m.reload_current_view();});},alternative_form_view:self.o2m.field.views?self.o2m.field.views["form"]:undefined,parent_view:self.o2m.view,child_name:self.o2m.name,read_function:function(){return self.o2m.dataset.read_ids.apply(self.o2m.dataset,arguments);},form_view_options:{'not_interactible_on_create':true},readonly:!this.is_action_enabled('edit')||self.o2m.get("effective_readonly")});},do_button_action:function(name,id,callback){if(!_.isNumber(id)){instance.webclient.notification.warn(_t("Action Button"),_t("The o2m record must be saved before an action can be used"));return;}
var parent_form=this.o2m.view;var self=this;this.ensure_saved().then(function(){if(parent_form)
return parent_form.save();else
return $.when();}).done(function(){self.handle_button(name,id,callback);});},_before_edit:function(){this.__ignore_blur=false;this.editor.form.on('blurred',this,this._on_form_blur);},_after_edit:function(){this.editor.form.widgetFocused();},_before_unedit:function(){this.editor.form.off('blurred',this,this._on_form_blur);},_button_down:function(){this.__ignore_blur=true;},_on_form_blur:function(){if(this.__ignore_blur){this.__ignore_blur=false;return;}
if(this.editor.form.$el.hasClass('oe_form_dirty')){this.ensure_saved();return;}
this.cancel_edition();},keyup_ENTER:function(){this.__ignore_blur=true;this._super.apply(this,arguments);},do_delete:function(ids){var confirm=window.confirm;window.confirm=function(){return true;};try{return this._super(ids);}finally{window.confirm=confirm;}}});instance.web.form.One2ManyGroups=instance.web.ListView.Groups.extend({setup_resequence_rows:function(){if(!this.view.o2m.get('effective_readonly')){this._super.apply(this,arguments);}}});instance.web.form.One2ManyList=instance.web.ListView.List.extend({pad_table_to:function(count){if(!this.view.is_action_enabled('create')){this._super(count);}else{this._super(count>0?count-1:0);}
if(this.view.o2m.get('effective_readonly')){return;}
var self=this;var columns=_(this.columns).filter(function(column){return column.invisible!=='1';}).length;if(this.options.selectable){columns++;}
if(this.options.deletable){columns++;}
if(!this.view.is_action_enabled('create')){return;}
var $cell=$('<td>',{colspan:columns,'class':'oe_form_field_one2many_list_row_add'}).append($('<a>',{href:'#'}).text(_t("Add an item")).mousedown(function(){if(self.view.editor.is_editing()){self.view.__ignore_blur=true;}}).click(function(e){e.preventDefault();e.stopPropagation();if(self.view.editor.form.__blur_timeout){clearTimeout(self.view.editor.form.__blur_timeout);self.view.editor.form.__blur_timeout=false;}
self.view.ensure_saved().done(function(){self.view.do_add_record();});}));var $padding=this.$current.find('tr:not([data-id]):first');var $newrow=$('<tr>').append($cell);if($padding.length){$padding.before($newrow);}else{this.$current.append($newrow)}}});instance.web.form.One2ManyFormView=instance.web.FormView.extend({form_template:'One2Many.formview',load_form:function(data){this._super(data);var self=this;this.$buttons.find('button.oe_form_button_create').click(function(){self.save().done(self.on_button_new);});},do_notify_change:function(){if(this.dataset.parent_view){this.dataset.parent_view.do_notify_change();}else{this._super.apply(this,arguments);}}});var lazy_build_o2m_kanban_view=function(){if(!instance.web_kanban||instance.web.form.One2ManyKanbanView)
return;instance.web.form.One2ManyKanbanView=instance.web_kanban.KanbanView.extend({});};instance.web.form.FieldMany2ManyTags=instance.web.form.AbstractField.extend(instance.web.form.CompletionFieldMixin,instance.web.form.ReinitializeFieldMixin,{template:"FieldMany2ManyTags",init:function(){this._super.apply(this,arguments);instance.web.form.CompletionFieldMixin.init.call(this);this.set({"value":[]});this._display_orderer=new instance.web.DropMisordered();this._drop_shown=false;},initialize_content:function(){if(this.get("effective_readonly"))
return;var self=this;var ignore_blur=false;self.$text=this.$("textarea");self.$text.textext({plugins:'tags arrow autocomplete',autocomplete:{render:function(suggestion){return $('<span class="text-label"/>').data('index',suggestion['index']).html(suggestion['label']);}},ext:{autocomplete:{selectFromDropdown:function(){$(this).trigger('hideDropdown');var index=Number(this.selectedSuggestionElement().children().children().data('index'));var data=self.search_result[index];if(data.id){self.add_id(data.id);}else{ignore_blur=true;data.action();}},},tags:{isTagAllowed:function(tag){return!!tag.name;},removeTag:function(tag){var id=tag.data("id");self.set({"value":_.without(self.get("value"),id)});},renderTag:function(stuff){return $.fn.textext.TextExtTags.prototype.renderTag.call(this,stuff).data("id",stuff.id);},},itemManager:{itemToString:function(item){return item.name;},},core:{onSetInputData:function(e,data){if(data==''){this._plugins.autocomplete._suggestions=null;}
this.input().val(data);},},},}).bind('getSuggestions',function(e,data){var _this=this;var str=!!data?data.query||'':'';self.get_search_result(str).done(function(result){self.search_result=result;$(_this).trigger('setSuggestions',{result:_.map(result,function(el,i){return _.extend(el,{index:i});})});});}).bind('hideDropdown',function(){self._drop_shown=false;}).bind('showDropdown',function(){self._drop_shown=true;});self.tags=self.$text.textext()[0].tags();self.$text.focusin(function(){self.trigger('focused');ignore_blur=false;}).focusout(function(){self.$text.trigger("setInputData","");if(!ignore_blur){self.trigger('blurred');}}).keydown(function(e){if(e.which===$.ui.keyCode.TAB&&self._drop_shown){self.$text.textext()[0].autocomplete().selectFromDropdown();}});},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){value_=value_[0][2];}
this._super(value_);},is_false:function(){return _(this.get("value")).isEmpty();},get_value:function(){var tmp=[commands.replace_with(this.get("value"))];return tmp;},get_search_blacklist:function(){return this.get("value");},render_value:function(){var self=this;var dataset=new instance.web.DataSetStatic(this,this.field.relation,self.build_context());var values=self.get("value");var handle_names=function(data){if(self.isDestroyed())
return;var indexed={};_.each(data,function(el){indexed[el[0]]=el;});data=_.map(values,function(el){return indexed[el];});if(!self.get("effective_readonly")){self.tags.containerElement().children().remove();self.$('textarea').css("padding-left","3px");self.tags.addTags(_.map(data,function(el){return{name:el[1],id:el[0]};}));}else{self.$el.html(QWeb.render("FieldMany2ManyTag",{elements:data}));}};if(!values||values.length>0){this._display_orderer.add(dataset.name_get(values)).done(handle_names);}else{handle_names([]);}},add_id:function(id){this.set({'value':_.uniq(this.get('value').concat([id]))});},focus:function(){this.$text[0].focus();},set_dimensions:function(height,width){this._super(height,width);this.$("textarea").css({width:width,minHeight:height});},});instance.web.form.FieldMany2Many=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{multi_selection:false,disable_utility_classes:true,init:function(field_manager,node){this._super(field_manager,node);this.is_loaded=$.Deferred();this.dataset=new instance.web.form.Many2ManyDataSet(this,this.field.relation);this.dataset.m2m=this;var self=this;this.dataset.on('unlink',self,function(ids){self.dataset_changed();});this.set_value([]);this.list_dm=new instance.web.DropMisordered();this.render_value_dm=new instance.web.DropMisordered();},initialize_content:function(){var self=this;this.$el.addClass('oe_form_field oe_form_field_many2many');this.list_view=new instance.web.form.Many2ManyListView(this,this.dataset,false,{'addable':this.get("effective_readonly")?null:_t("Add"),'deletable':this.get("effective_readonly")?false:true,'selectable':this.multi_selection,'sortable':false,'reorderable':false,'import_enabled':false,});var embedded=(this.field.views||{}).tree;if(embedded){this.list_view.set_embedded_view(embedded);}
this.list_view.m2m_field=this;var loaded=$.Deferred();this.list_view.on("list_view_loaded",this,function(){loaded.resolve();});this.list_view.appendTo(this.$el);var old_def=self.is_loaded;self.is_loaded=$.Deferred().done(function(){old_def.resolve();});this.list_dm.add(loaded).then(function(){self.is_loaded.resolve();});},destroy_content:function(){this.list_view.destroy();this.list_view=undefined;},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){value_=value_[0][2];}
this._super(value_);},get_value:function(){return[commands.replace_with(this.get('value'))];},is_false:function(){return _(this.get("value")).isEmpty();},render_value:function(){var self=this;this.dataset.set_ids(this.get("value"));this.render_value_dm.add(this.is_loaded).then(function(){return self.list_view.reload_content();});},dataset_changed:function(){this.internal_set_value(this.dataset.ids);},});instance.web.form.Many2ManyDataSet=instance.web.DataSetStatic.extend({get_context:function(){this.context=this.m2m.build_context();return this.context;}});instance.web.form.Many2ManyListView=instance.web.ListView.extend({do_add_record:function(){var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(this.model,{title:_t("Add: ")+this.m2m_field.string},new instance.web.CompoundDomain(this.m2m_field.build_domain(),["!",["id","in",this.m2m_field.dataset.ids]]),this.m2m_field.build_context());var self=this;pop.on("elements_selected",self,function(element_ids){var reload=false;_(element_ids).each(function(id){if(!_.detect(self.dataset.ids,function(x){return x==id;})){self.dataset.set_ids(self.dataset.ids.concat([id]));self.m2m_field.dataset_changed();reload=true;}});if(reload){self.reload_content();}});},do_activate_record:function(index,id){var self=this;var pop=new instance.web.form.FormOpenPopup(this);pop.show_element(this.dataset.model,id,this.m2m_field.build_context(),{title:_t("Open: ")+this.m2m_field.string,readonly:this.getParent().get("effective_readonly")});pop.on('write_completed',self,self.reload_content);},do_button_action:function(name,id,callback){var self=this;var _sup=_.bind(this._super,this);if(!this.m2m_field.options.reload_on_button){return _sup(name,id,callback);}else{return this.m2m_field.view.save().then(function(){return _sup(name,id,function(){self.m2m_field.view.reload();});});}},is_action_enabled:function(){return true;},});instance.web.form.FieldMany2ManyKanban=instance.web.form.AbstractField.extend(instance.web.form.CompletionFieldMixin,{disable_utility_classes:true,init:function(field_manager,node){this._super(field_manager,node);instance.web.form.CompletionFieldMixin.init.call(this);m2m_kanban_lazy_init();this.is_loaded=$.Deferred();this.initial_is_loaded=this.is_loaded;var self=this;this.dataset=new instance.web.form.Many2ManyDataSet(this,this.field.relation);this.dataset.m2m=this;this.dataset.on('unlink',self,function(ids){self.dataset_changed();});},start:function(){this._super.apply(this,arguments);var self=this;self.load_view();self.on("change:effective_readonly",self,function(){self.is_loaded=self.is_loaded.then(function(){self.kanban_view.destroy();return $.when(self.load_view()).done(function(){self.render_value();});});});},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){value_=value_[0][2];}
this._super(value_);},get_value:function(){return[commands.replace_with(this.get('value'))];},load_view:function(){var self=this;this.kanban_view=new instance.web.form.Many2ManyKanbanView(this,this.dataset,false,{'create_text':_t("Add"),'creatable':self.get("effective_readonly")?false:true,'quick_creatable':self.get("effective_readonly")?false:true,'read_only_mode':self.get("effective_readonly")?true:false,'confirm_on_delete':false,});var embedded=(this.field.views||{}).kanban;if(embedded){this.kanban_view.set_embedded_view(embedded);}
this.kanban_view.m2m=this;var loaded=$.Deferred();this.kanban_view.on("kanban_view_loaded",self,function(){self.initial_is_loaded.resolve();loaded.resolve();});this.kanban_view.on('switch_mode',this,this.open_popup);$.async_when().done(function(){self.kanban_view.appendTo(self.$el);});return loaded;},render_value:function(){var self=this;this.dataset.set_ids(this.get("value"));this.is_loaded=this.is_loaded.then(function(){return self.kanban_view.do_search(self.build_domain(),self.dataset.get_context(),[]);});},dataset_changed:function(){this.set({'value':this.dataset.ids});},open_popup:function(type,unused){if(type!=="form")
return;var self=this;if(this.dataset.index===null){var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(this.field.relation,{title:_t("Add: ")+this.string},new instance.web.CompoundDomain(this.build_domain(),["!",["id","in",this.dataset.ids]]),this.build_context());pop.on("elements_selected",self,function(element_ids){_.each(element_ids,function(one_id){if(!_.detect(self.dataset.ids,function(x){return x==one_id;})){self.dataset.set_ids([].concat(self.dataset.ids,[one_id]));self.dataset_changed();self.render_value();}});});}else{var id=self.dataset.ids[self.dataset.index];var pop=new instance.web.form.FormOpenPopup(this);pop.show_element(self.field.relation,id,self.build_context(),{title:_t("Open: ")+self.string,write_function:function(id,data,options){return self.dataset.write(id,data,{}).done(function(){self.render_value();});},alternative_form_view:self.field.views?self.field.views["form"]:undefined,parent_view:self.view,child_name:self.name,readonly:self.get("effective_readonly")});}},add_id:function(id){this.quick_create.add_id(id);},});function m2m_kanban_lazy_init(){if(instance.web.form.Many2ManyKanbanView)
return;instance.web.form.Many2ManyKanbanView=instance.web_kanban.KanbanView.extend({quick_create_class:'instance.web.form.Many2ManyQuickCreate',_is_quick_create_enabled:function(){return this._super()&&!this.group_by;},});instance.web.form.Many2ManyQuickCreate=instance.web.Widget.extend({template:'Many2ManyKanban.quick_create',init:function(parent,dataset,context,buttons){this._super(parent);this.m2m=this.getParent().view.m2m;this.m2m.quick_create=this;this._dataset=dataset;this._buttons=buttons||false;this._context=context||{};},start:function(){var self=this;self.$text=this.$el.find('input').css("width","200px");self.$text.textext({plugins:'arrow autocomplete',autocomplete:{render:function(suggestion){return $('<span class="text-label"/>').data('index',suggestion['index']).html(suggestion['label']);}},ext:{autocomplete:{selectFromDropdown:function(){$(this).trigger('hideDropdown');var index=Number(this.selectedSuggestionElement().children().children().data('index'));var data=self.search_result[index];if(data.id){self.add_id(data.id);}else{data.action();}},},itemManager:{itemToString:function(item){return item.name;},},},}).bind('getSuggestions',function(e,data){var _this=this;var str=!!data?data.query||'':'';self.m2m.get_search_result(str).done(function(result){self.search_result=result;$(_this).trigger('setSuggestions',{result:_.map(result,function(el,i){return _.extend(el,{index:i});})});});});self.$text.focusout(function(){self.$text.val("");});},focus:function(){this.$text[0].focus();},add_id:function(id){var self=this;self.$text.val("");self.trigger('added',id);this.m2m.dataset_changed();},});}
instance.web.form.AbstractFormPopup=instance.web.Widget.extend({template:"AbstractFormPopup.render",init_popup:function(model,row_id,domain,context,options){this.row_id=row_id;this.model=model;this.domain=domain||[];this.context=context||{};this.options=options;_.defaults(this.options,{});},init_dataset:function(){var self=this;this.created_elements=[];this.dataset=new instance.web.ProxyDataSet(this,this.model,this.context);this.dataset.read_function=this.options.read_function;this.dataset.create_function=function(data,options,sup){var fct=self.options.create_function||sup;return fct.call(this,data,options).done(function(r){self.trigger('create_completed saved',r);self.created_elements.push(r);});};this.dataset.write_function=function(id,data,options,sup){var fct=self.options.write_function||sup;return fct.call(this,id,data,options).done(function(r){self.trigger('write_completed saved',r);});};this.dataset.parent_view=this.options.parent_view;this.dataset.child_name=this.options.child_name;},display_popup:function(){var self=this;this.renderElement();var dialog=new instance.web.Dialog(this,{min_width:'800px',dialogClass:'oe_act_window',close:function(){self.check_exit(true);},title:this.options.title||"",},this.$el).open();this.$buttonpane=dialog.$buttons;this.start();},setup_form_view:function(){var self=this;if(this.row_id){this.dataset.ids=[this.row_id];this.dataset.index=0;}else{this.dataset.index=null;}
var options=_.clone(self.options.form_view_options)||{};if(this.row_id!==null){options.initial_mode=this.options.readonly?"view":"edit";}
_.extend(options,{$buttons:this.$buttonpane,});this.view_form=new instance.web.FormView(this,this.dataset,this.options.view_id||false,options);if(this.options.alternative_form_view){this.view_form.set_embedded_view(this.options.alternative_form_view);}
this.view_form.appendTo(this.$el.find(".oe_popup_form"));this.view_form.on("form_view_loaded",self,function(){var multi_select=self.row_id===null&&!self.options.disable_multiple_selection;self.$buttonpane.html(QWeb.render("AbstractFormPopup.buttons",{multi_select:multi_select,readonly:self.row_id!==null&&self.options.readonly,}));var $snbutton=self.$buttonpane.find(".oe_abstractformpopup-form-save-new");$snbutton.click(function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.view_form.on_button_new();});});});var $sbutton=self.$buttonpane.find(".oe_abstractformpopup-form-save");$sbutton.click(function(){$.when(self.view_form.save()).done(function(){self.view_form.reload_mutex.exec(function(){self.check_exit();});});});var $cbutton=self.$buttonpane.find(".oe_abstractformpopup-form-close");$cbutton.click(function(){self.view_form.trigger('on_button_cancel');self.check_exit();});self.view_form.do_show();});},select_elements:function(element_ids){this.trigger("elements_selected",element_ids);},check_exit:function(no_destroy){if(this.created_elements.length>0){this.select_elements(this.created_elements);this.created_elements=[];}
this.trigger('closed');this.destroy();},destroy:function(){this.trigger('closed');if(this.$el.is(":data(dialog)")){this.$el.dialog('close');}
this._super();},});instance.web.form.FormOpenPopup=instance.web.form.AbstractFormPopup.extend({show_element:function(model,row_id,context,options){this.init_popup(model,row_id,[],context,options);_.defaults(this.options,{});this.display_popup();},start:function(){this._super();this.init_dataset();this.setup_form_view();},});instance.web.form.SelectCreatePopup=instance.web.form.AbstractFormPopup.extend({select_element:function(model,options,domain,context){this.init_popup(model,null,domain,context,options);var self=this;_.defaults(this.options,{initial_view:"search",});this.initial_ids=this.options.initial_ids;this.display_popup();},start:function(){var self=this;this.init_dataset();if(this.options.initial_view=="search"){instance.web.pyeval.eval_domains_and_contexts({domains:[],contexts:[this.context]}).done(function(results){var search_defaults={};_.each(results.context,function(value_,key){var match=/^search_default_(.*)$/.exec(key);if(match){search_defaults[match[1]]=value_;}});self.setup_search_view(search_defaults);});}else{this.new_object();}},setup_search_view:function(search_defaults){var self=this;if(this.searchview){this.searchview.destroy();}
this.searchview=new instance.web.SearchView(this,this.dataset,false,search_defaults);this.searchview.on('search_data',self,function(domains,contexts,groupbys){if(self.initial_ids){self.do_search(domains.concat([[["id","in",self.initial_ids]],self.domain]),contexts,groupbys);self.initial_ids=undefined;}else{self.do_search(domains.concat([self.domain]),contexts.concat(self.context),groupbys);}});this.searchview.on("search_view_loaded",self,function(){self.view_list=new instance.web.form.SelectCreateListView(self,self.dataset,false,_.extend({'deletable':false,'selectable':!self.options.disable_multiple_selection,'import_enabled':false,'$buttons':self.$buttonpane,'disable_editable_mode':true,'$pager':self.$('.oe_popup_list_pager'),},self.options.list_view_options||{}));self.view_list.on('edit:before',self,function(e){e.cancel=true;});self.view_list.popup=self;self.view_list.appendTo($(".oe_popup_list",self.$el)).then(function(){self.view_list.do_show();}).then(function(){self.searchview.do_search();});self.view_list.on("list_view_loaded",self,function(){self.$buttonpane.html(QWeb.render("SelectCreatePopup.search.buttons",{widget:self}));var $cbutton=self.$buttonpane.find(".oe_selectcreatepopup-search-close");$cbutton.click(function(){self.destroy();});var $sbutton=self.$buttonpane.find(".oe_selectcreatepopup-search-select");$sbutton.click(function(){self.select_elements(self.selected_ids);self.destroy();});var $cbutton=self.$buttonpane.find(".oe_selectcreatepopup-search-create");$cbutton.click(function(){self.new_object();});});});this.searchview.appendTo($(".oe_popup_search",self.$el));},do_search:function(domains,contexts,groupbys){var self=this;instance.web.pyeval.eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]}).done(function(results){self.view_list.do_search(results.domain,results.context,results.group_by);});},on_click_element:function(ids){var self=this;this.selected_ids=ids||[];if(this.selected_ids.length>0){self.$buttonpane.find(".oe_selectcreatepopup-search-select").removeAttr('disabled');}else{self.$buttonpane.find(".oe_selectcreatepopup-search-select").attr('disabled',"disabled");}},new_object:function(){if(this.searchview){this.searchview.hide();}
if(this.view_list){this.view_list.$el.hide();}
this.setup_form_view();},});instance.web.form.SelectCreateListView=instance.web.ListView.extend({do_add_record:function(){this.popup.new_object();},select_record:function(index){this.popup.select_elements([this.dataset.ids[index]]);this.popup.destroy();},do_select:function(ids,records){this._super(ids,records);this.popup.on_click_element(ids);}});instance.web.form.FieldReference=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{template:'FieldReference',init:function(field_manager,node){this._super(field_manager,node);this.reference_ready=true;},destroy_content:function(){if(this.fm){this.fm.destroy();this.fm=undefined;}},initialize_content:function(){var self=this;var fm=new instance.web.form.DefaultFieldManager(this);this.fm=fm;fm.extend_field_desc({"selection":{selection:this.field_manager.get_field_desc(this.name).selection,type:"selection",},"m2o":{relation:null,type:"many2one",},});this.selection=new instance.web.form.FieldSelection(fm,{attrs:{name:'selection',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.selection.on("change:value",this,this.on_selection_changed);this.selection.appendTo(this.$(".oe_form_view_reference_selection"));this.selection.on('focused',null,function(){self.trigger('focused')}).on('blurred',null,function(){self.trigger('blurred')});this.m2o=new instance.web.form.FieldMany2One(fm,{attrs:{name:'m2o',modifiers:JSON.stringify({readonly:this.get('effective_readonly')}),}});this.m2o.on("change:value",this,this.data_changed);this.m2o.appendTo(this.$(".oe_form_view_reference_m2o"));this.m2o.on('focused',null,function(){self.trigger('focused')}).on('blurred',null,function(){self.trigger('blurred')});},on_selection_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),false]);this.render_value();}},data_changed:function(){if(this.reference_ready){this.internal_set_value([this.selection.get_value(),this.m2o.get_value()]);}},set_value:function(val){if(val){val=val.split(',');val[0]=val[0]||false;val[1]=val[0]?(val[1]?parseInt(val[1],10):val[1]):false;}
this._super(val||[false,false]);},get_value:function(){return this.get('value')[0]&&this.get('value')[1]?(this.get('value')[0]+','+this.get('value')[1]):false;},render_value:function(){this.reference_ready=false;if(!this.get("effective_readonly")){this.selection.set_value(this.get('value')[0]);}
this.m2o.field.relation=this.get('value')[0];this.m2o.set_value(this.get('value')[1]);this.m2o.$el.toggle(!!this.get('value')[0]);this.reference_ready=true;},});instance.web.form.FieldBinary=instance.web.form.AbstractField.extend(instance.web.form.ReinitializeFieldMixin,{init:function(field_manager,node){var self=this;this._super(field_manager,node);this.binary_value=false;this.useFileAPI=!!window.FileReader;this.max_upload_size=25*1024*1024;if(!this.useFileAPI){this.fileupload_id=_.uniqueId('oe_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},stop:function(){if(!this.useFileAPI){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},initialize_content:function(){this.$el.find('input.oe_form_binary_file').change(this.on_file_change);this.$el.find('button.oe_form_binary_file_save').click(this.on_save_as);this.$el.find('.oe_form_binary_file_clear').click(this.on_clear);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");instance.webclient.notification.warn(_t("File upload"),_.str.sprintf(msg,instance.web.human_size(this.max_upload_size)));return false;}
var filereader=new FileReader();filereader.readAsDataURL(file);filereader.onloadend=function(upload){var data=upload.target.result;data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);};}else{this.$el.find('form.oe_form_binary_form input[name=session_id]').val(this.session.session_id);this.$el.find('form.oe_form_binary_form').submit();}
this.$el.find('.oe_form_binary_progress').show();this.$el.find('.oe_form_binary').hide();}},on_file_uploaded:function(size,name,content_type,file_base64){if(size===false){this.do_warn(_t("File Upload"),_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.filename=name;this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$el.find('.oe_form_binary_progress').hide();this.$el.find('.oe_form_binary').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){},on_save_as:function(ev){var value=this.get('value');if(!value){this.do_warn(_t("Save As..."),_t("The field is empty, there's nothing to save !"));ev.stopPropagation();}else{instance.web.blockUI();var c=instance.webclient.crashmanager;this.session.get_file({url:'/web/binary/saveas_ajax',data:{data:JSON.stringify({model:this.view.dataset.model,id:(this.view.datarecord.id||''),field:this.name,filename_field:(this.node.attrs.filename||''),data:instance.web.form.is_bin_size(value)?null:value,context:this.view.dataset.get_context()})},complete:instance.web.unblockUI,error:c.rpc_error.bind(c)});ev.stopPropagation();return false;}},set_filename:function(value){var filename=this.node.attrs.filename;if(filename){var tmp={};tmp[filename]=value;this.field_manager.set_values(tmp);}},on_clear:function(){if(this.get('value')!==false){this.binary_value=false;this.internal_set_value(false);}
return false;}});instance.web.form.FieldBinaryFile=instance.web.form.FieldBinary.extend({template:'FieldBinaryFile',initialize_content:function(){this._super();if(this.get("effective_readonly")){var self=this;this.$el.find('a').click(function(ev){if(self.get('value')){self.on_save_as(ev);}
return false;});}},render_value:function(){if(!this.get("effective_readonly")){var show_value;if(this.node.attrs.filename){show_value=this.view.datarecord[this.node.attrs.filename]||'';}else{show_value=(this.get('value')!=null&&this.get('value')!==false)?this.get('value'):'';}
this.$el.find('input').eq(0).val(show_value);}else{this.$el.find('a').toggle(!!this.get('value'));if(this.get('value')){var show_value=_t("Download")
if(this.view)
show_value+=" "+(this.view.datarecord[this.node.attrs.filename]||'');this.$el.find('a').text(show_value);}}},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.binary_value=true;this.internal_set_value(file_base64);var show_value=name+" ("+instance.web.human_size(size)+")";this.$el.find('input').eq(0).val(show_value);this.set_filename(name);},on_clear:function(){this._super.apply(this,arguments);this.$el.find('input').eq(0).val('');this.set_filename('');}});instance.web.form.FieldBinaryImage=instance.web.form.FieldBinary.extend({template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",render_value:function(){var self=this;var url;if(this.get('value')&&!instance.web.form.is_bin_size(this.get('value'))){url='data:image/png;base64,'+this.get('value');}else if(this.get('value')){var id=JSON.stringify(this.view.datarecord.id||null);var field=this.name;if(this.options.preview_image)
field=this.options.preview_image;url=this.session.url('/web/binary/image',{model:this.view.dataset.model,id:id,field:field,t:(new Date().getTime()),});}else{url=this.placeholder;}
var $img=$(QWeb.render("FieldBinaryImage-img",{widget:this,url:url}));this.$el.find('> img').remove();this.$el.prepend($img);$img.load(function(){if(!self.options.size)
return;$img.css("max-width",""+self.options.size[0]+"px");$img.css("max-height",""+self.options.size[1]+"px");$img.css("margin-left",""+(self.options.size[0]-$img.width())/2+"px");$img.css("margin-top",""+(self.options.size[1]-$img.height())/2+"px");});$img.on('error',function(){$img.attr('src',self.placeholder);instance.webclient.notification.warn(_t("Image"),_t("Could not display the selected image."));});},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.internal_set_value(file_base64);this.binary_value=true;this.render_value();this.set_filename(name);},on_clear:function(){this._super.apply(this,arguments);this.render_value();this.set_filename('');}});instance.web.form.FieldMany2ManyBinaryMultiFiles=instance.web.form.AbstractField.extend({template:"FieldBinaryFileUploader",init:function(field_manager,node){this._super(field_manager,node);this.field_manager=field_manager;this.node=node;if(this.field.type!="many2many"||this.field.relation!='ir.attachment'){throw _.str.sprintf(_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model."),this.field.string);}
this.data={};this.set_value([]);this.ds_file=new instance.web.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,_.bind(this.on_file_loaded,this));},start:function(){this._super(this);this.$el.on('change','input.oe_form_binary_file',this.on_file_change);},set_value:function(value_){value_=value_||[];if(value_.length>=1&&value_[0]instanceof Array){value_=value_[0][2];}
this._super(value_);},get_value:function(){var tmp=[commands.replace_with(this.get("value"))];return tmp;},get_file_url:function(attachment){return this.session.url('/web/binary/saveas',{model:'ir.attachment',field:'datas',filename_field:'datas_fname',id:attachment['id']});},read_name_values:function(){var self=this;var _value=_.filter(this.get('value'),function(id){return typeof self.data[id]=='undefined';});if(_value.length){return this.ds_file.call('read',[_value,['id','name','datas_fname']]).done(function(datas){_.each(datas,function(data){data.no_unlink=true;data.url=self.session.url('/web/binary/saveas',{model:'ir.attachment',field:'datas',filename_field:'datas_fname',id:data.id});self.data[data.id]=data;});});}else{return $.when();}},render_value:function(){var self=this;this.read_name_values().then(function(){var render=$(instance.web.qweb.render('FieldBinaryFileUploader.files',{'widget':self}));render.on('click','.oe_delete',_.bind(self.on_file_delete,self));self.$('.oe_placeholder_files, .oe_attachments').replaceWith(render);var $input=self.$('input.oe_form_binary_file');$input.after($input.clone(true)).remove();self.$(".oe_fileupload").show();});},on_file_change:function(event){event.stopPropagation();var self=this;var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');if(self.data[0]&&self.data[0].upload){return false;}
for(var id in this.get('value')){if(self.data[id]&&(self.data[id].filename||self.data[id].name)==filename&&!self.data[id].no_unlink){self.ds_file.unlink([id]);}}
if(this.node.attrs.blockui>0){instance.web.blockUI();}
this.$('form.oe_form_binary_form').submit();this.$(".oe_fileupload").hide();this.data[0]={'id':0,'name':filename,'filename':filename,'url':'','upload':true};}},on_file_loaded:function(event,result){var files=this.get('value');if(this.node.attrs.blockui>0){instance.web.unblockUI();}
if(result.error||!result.id){this.do_warn(_t('Uploading error'),result.error);delete this.data[0];}else{if(this.data[0]&&this.data[0].filename==result.filename&&this.data[0].upload){delete this.data[0];this.data[result.id]={'id':result.id,'name':result.name,'filename':result.filename,'url':this.get_file_url(result)};}else{this.data[result.id]={'id':result.id,'name':result.name,'filename':result.filename,'url':this.get_file_url(result)};}
var values=_.clone(this.get('value'));values.push(result.id);this.set({'value':values});}
this.render_value()},on_file_delete:function(event){event.stopPropagation();var file_id=$(event.target).data("id");if(file_id){var files=_.filter(this.get('value'),function(id){return id!=file_id;});if(!this.data[file_id].no_unlink){this.ds_file.unlink([file_id]);}
this.set({'value':files});}},});instance.web.form.FieldStatus=instance.web.form.AbstractField.extend({template:"FieldStatus",init:function(field_manager,node){this._super(field_manager,node);this.options.clickable=this.options.clickable||(this.node.attrs||{}).clickable||false;this.options.visible=this.options.visible||(this.node.attrs||{}).statusbar_visible||false;this.set({value:false});this.selection=[];this.set("selection",[]);this.selection_dm=new instance.web.DropMisordered();},start:function(){this.field_manager.on("view_content_has_changed",this,this.calc_domain);this.calc_domain();this.on("change:value",this,this.get_selection);this.on("change:evaluated_selection_domain",this,this.get_selection);this.on("change:selection",this,function(){this.selection=this.get("selection");this.render_value();});this.get_selection();if(this.options.clickable){this.$el.on('click','li',this.on_click_stage);}
if(this.$el.parent().is('header')){this.$el.after('<div class="oe_clear"/>');}
this._super();},set_value:function(value_){if(value_ instanceof Array){value_=value_[0];}
this._super(value_);},render_value:function(){var self=this;var content=QWeb.render("FieldStatus.content",{widget:self});self.$el.html(content);var colors=JSON.parse((self.node.attrs||{}).statusbar_colors||"{}");var color=colors[self.get('value')];if(color){self.$("oe_active").css("color",color);}},calc_domain:function(){var d=instance.web.pyeval.eval('domain',this.build_domain());domain=['|',['id','=',this.get('value')]].concat(d);if(!_.isEqual(domain,this.get("evaluated_selection_domain"))){this.set("evaluated_selection_domain",domain);}},get_selection:function(){var self=this;var selection=[];var calculation=_.bind(function(){if(this.field.type=="many2one"){var domain=[];var ds=new instance.web.DataSetSearch(this,this.field.relation,self.build_context(),this.get("evaluated_selection_domain"));return ds.read_slice(['name'],{}).then(function(records){for(var i=0;i<records.length;i++){selection.push([records[i].id,records[i].name]);}});}else{var select=this.field.selection;for(var i=0;i<select.length;i++){var key=select[i][0];if(key==this.get('value')||!this.options.visible||this.options.visible.indexOf(key)!=-1){selection.push(select[i]);}}
return $.when();}},this);this.selection_dm.add(calculation()).then(function(){if(!_.isEqual(selection,self.get("selection"))){self.set("selection",selection);}});},on_click_stage:function(ev){var self=this;var $li=$(ev.currentTarget);var val=parseInt($li.data("id"));if(val!=self.get('value')){this.view.recursive_save().done(function(){var change={};change[self.name]=val;self.view.dataset.write(self.view.datarecord.id,change).done(function(){self.view.reload();});});}},});instance.web.form.FieldMonetary=instance.web.form.FieldFloat.extend({template:"FieldMonetary",widget_class:'oe_form_field_float oe_form_field_monetary',init:function(){this._super.apply(this,arguments);this.set({"currency":false});if(this.options.currency_field){this.field_manager.on("field_changed:"+this.options.currency_field,this,function(){this.set({"currency":this.field_manager.get_field_value(this.options.currency_field)});});}
this.on("change:currency",this,this.get_currency_info);this.get_currency_info();this.ci_dm=new instance.web.DropMisordered();},start:function(){var tmp=this._super();this.on("change:currency_info",this,this.reinitialize);return tmp;},get_currency_info:function(){var self=this;if(this.get("currency")===false){this.set({"currency_info":null});return;}
return this.ci_dm.add(self.alive(new instance.web.Model("res.currency").query(["symbol","position"]).filter([["id","=",self.get("currency")]]).first())).then(function(res){self.set({"currency_info":res});});},parse_value:function(val,def){return instance.web.parse_value(val,{type:"float",digits:(this.node.attrs||{}).digits||this.field.digits},def);},format_value:function(val,def){return instance.web.format_value(val,{type:"float",digits:(this.node.attrs||{}).digits||this.field.digits},def);},});instance.web.form.widgets=new instance.web.Registry({'char':'instance.web.form.FieldChar','id':'instance.web.form.FieldID','email':'instance.web.form.FieldEmail','url':'instance.web.form.FieldUrl','text':'instance.web.form.FieldText','html':'instance.web.form.FieldTextHtml','date':'instance.web.form.FieldDate','datetime':'instance.web.form.FieldDatetime','selection':'instance.web.form.FieldSelection','many2one':'instance.web.form.FieldMany2One','many2onebutton':'instance.web.form.Many2OneButton','many2many':'instance.web.form.FieldMany2Many','many2many_tags':'instance.web.form.FieldMany2ManyTags','many2many_kanban':'instance.web.form.FieldMany2ManyKanban','one2many':'instance.web.form.FieldOne2Many','one2many_list':'instance.web.form.FieldOne2Many','reference':'instance.web.form.FieldReference','boolean':'instance.web.form.FieldBoolean','float':'instance.web.form.FieldFloat','integer':'instance.web.form.FieldFloat','float_time':'instance.web.form.FieldFloat','progressbar':'instance.web.form.FieldProgressBar','image':'instance.web.form.FieldBinaryImage','binary':'instance.web.form.FieldBinaryFile','many2many_binary':'instance.web.form.FieldMany2ManyBinaryMultiFiles','statusbar':'instance.web.form.FieldStatus','monetary':'instance.web.form.FieldMonetary',});instance.web.form.tags=new instance.web.Registry({'button':'instance.web.form.WidgetButton',});instance.web.form.custom_widgets=new instance.web.Registry({});};;openerp.web.list=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('list','instance.web.ListView');instance.web.ListView=instance.web.View.extend({_template:'ListView',display_name:_lt('List'),defaults:{'selectable':true,'deletable':false,'header':true,'addable':_lt("Create"),'sortable':true,'reorderable':true,'action_buttons':true,'disable_editable_mode':false,},view_type:'tree',events:{'click thead th.oe_sortable[data-id]':'sort_by_column'},init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(_.extend({},this.defaults,options||{}));this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.previous_colspan=null;this.colors=null;this.fonts=null;this.columns=[];this.records=new Collection();this.set_groups(new(this.options.GroupsType)(this));if(this.dataset instanceof instance.web.DataSetStatic){this.groups.datagroup=new StaticDataGroup(this.dataset);}else{this.groups.datagroup=new DataGroup(this,this.model,dataset.get_domain(),dataset.get_context());this.groups.datagroup.sort=this.dataset._sort;}
this.page=0;this.records.bind('change',function(event,record,key){if(!_(self.aggregate_columns).chain().pluck('name').contains(key).value()){return;}
self.compute_aggregates();});this.no_leaf=false;this.grouped=false;},view_loading:function(r){return this.load_list(r);},set_default_options:function(options){this._super(options);_.defaults(this.options,{GroupsType:instance.web.ListView.Groups,ListType:instance.web.ListView.List});},limit:function(){if(this._limit===undefined){this._limit=(this.options.limit||this.defaults.limit||(this.getParent().action||{}).limit||80);}
return this._limit;},set_groups:function(groups){var self=this;if(this.groups){$(this.groups).unbind("selected deleted action row_link");delete this.groups;}
this.groups=groups;$(this.groups).bind({'selected':function(e,ids,records){self.do_select(ids,records);},'deleted':function(e,ids){self.do_delete(ids);},'action':function(e,action_name,id,callback){self.do_button_action(action_name,id,callback);},'row_link':function(e,id,dataset,view){self.do_activate_record(dataset.index,id,dataset,view);}});},start:function(){this.$el.addClass('oe_list');return this._super();},style_for:function(record){var style='';var context=_.extend({},record.attributes,{uid:this.session.uid,current_date:new Date().toString('yyyy-MM-dd')});if(this.fonts){for(var i=0,len=this.fonts.length;i<len;++i){var pair=this.fonts[i],font=pair[0],expression=pair[1];if(py.evaluate(expression,context).toJSON()){switch(font){case'bold':style+='font-weight: bold;';break;case'italic':style+='font-style: italic;';break;case'underline':style+='text-decoration: underline;';break;}}}}
if(!this.colors){return style;}
for(var i=0,len=this.colors.length;i<len;++i){var pair=this.colors[i],color=pair[0],expression=pair[1];if(py.evaluate(expression,context).toJSON()){return style+='color: '+color+';';}}
return style;},load_list:function(data){var self=this;this.fields_view=data;this.name=""+this.fields_view.arch.attrs.string;if(this.fields_view.arch.attrs.colors){this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();}
if(this.fields_view.arch.attrs.fonts){this.fonts=_(this.fields_view.arch.attrs.fonts.split(';')).chain().compact().map(function(font_pair){var pair=font_pair.split(':'),font=pair[0],expr=pair[1];return[font,py.parse(py.tokenize(expr)),expr];}).value();}
this.setup_columns(this.fields_view.fields,this.grouped);this.$el.html(QWeb.render(this._template,this));this.$el.addClass(this.fields_view.arch.attrs['class']);this.$el.find('.oe_list_record_selector').click(function(){self.$el.find('.oe_list_record_selector input').prop('checked',self.$el.find('.oe_list_record_selector').prop('checked')||false);var selection=self.groups.get_selection();$(self.groups).trigger('selected',[selection.ids,selection.records]);});if(!this.$buttons){this.$buttons=$(QWeb.render("ListView.buttons",{'widget':self}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_list_buttons').replaceWith(this.$buttons);}
this.$buttons.find('.oe_list_add').click(this.proxy('do_add_record')).prop('disabled',this.grouped);}
if(!this.$pager){this.$pager=$(QWeb.render("ListView.pager",{'widget':self}));if(this.options.$buttons){this.$pager.appendTo(this.options.$pager);}else{this.$el.find('.oe_list_pager').replaceWith(this.$pager);}
this.$pager.on('click','a[data-pager-action]',function(){var $this=$(this);var max_page=Math.floor(self.dataset.size()/self.limit());switch($this.data('pager-action')){case'first':self.page=0;break;case'last':self.page=max_page-1;break;case'next':self.page+=1;break;case'previous':self.page-=1;break;}
if(self.page<0){self.page=max_page;}else if(self.page>max_page){self.page=0;}
self.reload_content();}).find('.oe_list_pager_state').click(function(e){e.stopPropagation();var $this=$(this);var $select=$('<select>').appendTo($this.empty()).click(function(e){e.stopPropagation();}).append('<option value="80">80</option>'+'<option value="200">200</option>'+'<option value="500">500</option>'+'<option value="2000">2000</option>'+'<option value="NaN">'+_t("Unlimited")+'</option>').change(function(){var val=parseInt($select.val(),10);self._limit=(isNaN(val)?null:val);self.page=0;self.reload_content();}).blur(function(){$(this).trigger('change');}).val(self._limit||'NaN');});}
if(!this.sidebar&&this.options.$sidebar){this.sidebar=new instance.web.Sidebar(this);this.sidebar.appendTo(this.options.$sidebar);this.sidebar.add_items('other',_.compact([{label:_t("Export"),callback:this.on_sidebar_export},self.is_action_enabled('delete')&&{label:_t('Delete'),callback:this.do_delete_selected}]));this.sidebar.add_toolbar(this.fields_view.toolbar);this.sidebar.$el.hide();}
if(this.dataset._sort.length){if(this.dataset._sort[0].indexOf('-')==-1){this.$el.find('th[data-id='+this.dataset._sort[0]+']').addClass("sortdown");}else{this.$el.find('th[data-id='+this.dataset._sort[0].split('-')[1]+']').addClass("sortup");}}
this.trigger('list_view_loaded',data,this.grouped);},sort_by_column:function(e){e.stopPropagation();var $column=$(e.currentTarget);var col_name=$column.data('id')
var field=this.fields_view.fields[col_name];if(field&&field.store===false){return false;}
this.dataset.sort(col_name);if($column.hasClass("sortdown")||$column.hasClass("sortup")){$column.toggleClass("sortup sortdown");}else{$column.addClass("sortdown");}
$column.siblings('.oe_sortable').removeClass("sortup sortdown");this.reload_content();},configure_pager:function(dataset){this.dataset.ids=dataset.ids;if(dataset._length){this.dataset._length=dataset._length;}
var total=dataset.size();var limit=this.limit()||total;if(total==0)
this.$pager.hide();else
this.$pager.css("display","");this.$pager.toggleClass('oe_list_pager_single_page',(total<=limit));var spager='-';if(total){var range_start=this.page*limit+1;var range_stop=range_start-1+limit;if(range_stop>total){range_stop=total;}
spager=_.str.sprintf(_t("%d-%d of %d"),range_start,range_stop,total);}
this.$pager.find('.oe_list_pager_state').text(spager);},setup_columns:function(fields,grouped){var registry=instance.web.list.columns;this.columns.splice(0,this.columns.length);this.columns.push.apply(this.columns,_(this.fields_view.arch.children).map(function(field){var id=field.attrs.name;return registry.for_(id,fields[id],field);}));if(grouped){this.columns.unshift(new instance.web.list.MetaColumn('_group',_t("Group")));}
this.visible_columns=_.filter(this.columns,function(column){return column.invisible!=='1';});this.aggregate_columns=_(this.visible_columns).invoke('to_aggregate');},select_record:function(index,view){view=view||index==null?'form':'form';this.dataset.index=index;_.delay(_.bind(function(){this.do_switch_view(view);},this));},do_show:function(){this._super();if(this.$buttons){this.$buttons.show();}
if(this.$pager){this.$pager.show();}},do_hide:function(){if(this.sidebar){this.sidebar.$el.hide();}
if(this.$buttons){this.$buttons.hide();}
if(this.$pager){this.$pager.hide();}
this._super();},reload_view:function(grouped,context,initial){return this.load_view(context);},reload_content:function(){var self=this;self.$el.find('.oe_list_record_selector').prop('checked',false);this.records.reset();var reloaded=$.Deferred();this.$el.find('.oe_list_content').append(this.groups.render(function(){if(self.dataset.index==null){var has_one=false;self.records.each(function(){has_one=true;});if(has_one){self.dataset.index=0;}}
self.compute_aggregates();reloaded.resolve();}));this.do_push_state({page:this.page,limit:this._limit});return reloaded.promise();},reload:function(){return this.reload_content();},reload_record:function(record){var self=this;return this.dataset.read_ids([record.get('id')],_.pluck(_(this.columns).filter(function(r){return r.tag==='field';}),'name')).done(function(records){if(!records[0]){self.records.remove(record);return;}
_(records[0]).each(function(value,key){record.set(key,value,{silent:true});});record.trigger('change',record);});},do_load_state:function(state,warm){var reload=false;if(state.page&&this.page!==state.page){this.page=state.page;reload=true;}
if(state.limit){if(_.isString(state.limit)){state.limit=null;}
if(state.limit!==this._limit){this._limit=state.limit;reload=true;}}
if(reload){this.reload_content();}},do_search:function(domain,context,group_by){this.page=0;this.groups.datagroup=new DataGroup(this,this.model,domain,context,group_by);this.groups.datagroup.sort=this.dataset._sort;if(_.isEmpty(group_by)&&!context['group_by_no_leaf']){group_by=null;}
this.no_leaf=!!context['group_by_no_leaf'];this.grouped=!!group_by;return this.load_view(context).then(this.proxy('reload_content'));},do_delete:function(ids){if(!(ids.length&&confirm(_t("Do you really want to remove these records?")))){return;}
var self=this;return $.when(this.dataset.unlink(ids)).done(function(){_(ids).each(function(id){self.records.remove(self.records.get(id));});self.configure_pager(self.dataset);self.compute_aggregates();});},do_select:function(ids,records){if(!ids.length){this.dataset.index=0;if(this.sidebar){this.sidebar.$el.hide();}
this.compute_aggregates();return;}
this.dataset.index=_(this.dataset.ids).indexOf(ids[0]);if(this.sidebar){this.options.$sidebar.show();this.sidebar.$el.show();}
this.compute_aggregates(_(records).map(function(record){return{count:1,values:record};}));},do_button_action:function(name,id,callback){this.handle_button(name,id,callback);},handle_button:function(name,id,callback){var action=_.detect(this.columns,function(field){return field.name===name;});if(!action){return;}
if('confirm'in action&&!window.confirm(action.confirm)){return;}
var c=new instance.web.CompoundContext();c.set_eval_context(_.extend({active_id:id,active_ids:[id],active_model:this.dataset.model},this.records.get(id).toContext()));if(action.context){c.add(action.context);}
action.context=c;this.do_execute_action(action,this.dataset,id,_.bind(callback,null,id));},do_activate_record:function(index,id,dataset,view){this.dataset.ids=dataset.ids;this.select_record(index,view);},do_add_record:function(){this.select_record(null);},do_delete_selected:function(){var ids=this.groups.get_selection().ids;if(ids.length){this.do_delete(this.groups.get_selection().ids);}else{this.do_warn(_t("Warning"),_t("You must select at least one record."));}},compute_aggregates:function(records){var columns=_(this.aggregate_columns).filter(function(column){return column['function'];});if(_.isEmpty(columns)){return;}
if(_.isEmpty(records)){records=this.groups.get_records();}
records=_(records).compact();var count=0,sums={};_(columns).each(function(column){switch(column['function']){case'max':sums[column.id]=-Infinity;break;case'min':sums[column.id]=Infinity;break;default:sums[column.id]=0;}});_(records).each(function(record){count+=record.count||1;_(columns).each(function(column){var field=column.id,value=record.values[field];switch(column['function']){case'sum':sums[field]+=value;break;case'avg':sums[field]+=record.count*value;break;case'min':if(sums[field]>value){sums[field]=value;}
break;case'max':if(sums[field]<value){sums[field]=value;}
break;}});});var aggregates={};_(columns).each(function(column){var field=column.id;switch(column['function']){case'avg':aggregates[field]={value:sums[field]/count};break;default:aggregates[field]={value:sums[field]};}});this.display_aggregates(aggregates);},display_aggregates:function(aggregation){var self=this;var $footer_cells=this.$el.find('.oe_list_footer');_(this.aggregate_columns).each(function(column){if(!column['function']){return;}
$footer_cells.filter(_.str.sprintf('[data-field=%s]',column.id)).html(column.format(aggregation,{process_modifiers:false}));});},get_selected_ids:function(){var ids=this.groups.get_selection().ids;return ids;},pad_columns:function(count,options){options=options||{};var $first_header=this.$el.find('thead tr:first th');var colspan=$first_header.attr('colspan');if(colspan){if(!this.previous_colspan){this.previous_colspan=colspan;}
$first_header.attr('colspan',parseInt(colspan,10)+count);}
var $rows=this.$el.find('.oe_list_header_columns, tr:not(thead tr)').not(options['except']);var newcols=new Array(count+1).join('<td class="oe_list_padding"></td>');if(options.position==='before'){$rows.prepend(newcols);}else{$rows.append(newcols);}},unpad_columns:function(){this.$el.find('.oe_list_padding').remove();if(this.previous_colspan){this.$el.find('thead tr:first th').attr('colspan',this.previous_colspan);this.previous_colspan=null;}},no_result:function(){this.$el.find('.oe_view_nocontent').remove();if(this.groups.group_by||!this.options.action||!this.options.action.help){return;}
this.$el.find('table:first').hide();this.$el.prepend($('<div class="oe_view_nocontent">').html(this.options.action.help));var create_nocontent=this.$buttons;this.$el.find('.oe_view_nocontent').click(function(){create_nocontent.openerpBounce();});}});instance.web.ListView.List=instance.web.Class.extend({init:function(group,opts){var self=this;this.group=group;this.view=group.view;this.session=this.view.session;this.options=opts.options;this.columns=opts.columns;this.dataset=opts.dataset;this.records=opts.records;this.record_callbacks={'remove':function(event,record){var $row=self.$current.children('[data-id='+record.get('id')+']');var index=$row.data('index');$row.remove();},'reset':function(){return self.on_records_reset();},'change':function(event,record,attribute,value,old_value){var $row;if(attribute==='id'){if(old_value){throw new Error(_.str.sprintf(_t("Setting 'id' attribute on existing record %s"),JSON.stringify(record.attributes)));}
if(!_.contains(self.dataset.ids,value)){self.dataset.ids.splice(self.records.indexOf(record),0,value);}
$row=self.$current.children('[data-id=false]');}else{$row=self.$current.children('[data-id='+record.get('id')+']');}
$row.replaceWith(self.render_record(record));},'add':function(ev,records,record,index){var $new_row=$(self.render_record(record));if(index===0){$new_row.prependTo(self.$current);}else{var previous_record=records.at(index-1),$previous_sibling=self.$current.children('[data-id='+previous_record.get('id')+']');$new_row.insertAfter($previous_sibling);}}};_(this.record_callbacks).each(function(callback,event){this.records.bind(event,callback);},this);this.$current=$('<tbody>').delegate('input[readonly=readonly]','click',function(e){e.preventDefault();}).delegate('th.oe_list_record_selector','click',function(e){e.stopPropagation();var selection=self.get_selection();$(self).trigger('selected',[selection.ids,selection.records]);}).delegate('td.oe_list_record_delete button','click',function(e){e.stopPropagation();var $row=$(e.target).closest('tr');$(self).trigger('deleted',[[self.row_id($row)]]);}).delegate('td.oe_list_field_cell button','click',function(e){e.stopPropagation();var $target=$(e.currentTarget),field=$target.closest('td').data('field'),$row=$target.closest('tr'),record_id=self.row_id($row);if($target.attr('disabled')){return;}
$target.attr('disabled','disabled');$(self).trigger('action',[field.toString(),record_id,function(id){$target.removeAttr('disabled');return self.reload_record(self.records.get(id));}]);}).delegate('a','click',function(e){e.stopPropagation();}).delegate('tr','click',function(e){var row_id=self.row_id(e.currentTarget);if(row_id){e.stopPropagation();if(!self.dataset.select_id(row_id)){throw new Error(_t("Could not find id in dataset"));}
self.row_clicked(e);}});},row_clicked:function(e,view){$(this).trigger('row_link',[this.dataset.ids[this.dataset.index],this.dataset,view]);},render_cell:function(record,column){var value;if(column.type==='reference'){value=record.get(column.id);var ref_match;if(value&&(ref_match=/^([\w\.]+),(\d+)$/.exec(value))){var model=ref_match[1],id=parseInt(ref_match[2],10);new instance.web.DataSet(this.view,model).name_get([id]).done(function(names){if(!names.length){return;}
record.set(column.id,names[0][1]);});}}else if(column.type==='many2one'){value=record.get(column.id);if(typeof value==='number'||value instanceof Number){new instance.web.DataSet(this.view,column.relation).name_get([value]).done(function(names){if(!names.length){return;}
record.set(column.id,names[0]);});}}else if(column.type==='many2many'){value=record.get(column.id);if(value instanceof Array&&!_.isEmpty(value)&&!record.get(column.id+'__display')){var ids;if(value[0]instanceof Array){var command=value[0];if(command[0]!==6){throw new Error(_.str.sprintf(_t("Unknown m2m command %s"),command[0]));}
ids=command[2];}else{ids=value;}
new instance.web.Model(column.relation).call('name_get',[ids]).done(function(names){record.set(column.id+'__display',_(names).pluck(1).join(', '));record.set(column.id,ids);});record.set(column.id,false);}}
return column.format(record.toForm().data,{model:this.dataset.model,id:record.get('id')});},render:function(){this.$current.empty().append(QWeb.render('ListView.rows',_.extend({render_cell:function(){return self.render_cell.apply(self,arguments);}},this)));this.pad_table_to(4);},pad_table_to:function(count){if(this.records.length>=count||_(this.columns).any(function(column){return column.meta;})){return;}
var cells=[];if(this.options.selectable){cells.push('<th class="oe_list_record_selector"></td>');}
_(this.columns).each(function(column){if(column.invisible==='1'){return;}
if(column.tag==='button'){cells.push('<td class="oe_button" title="'+column.string+'">&nbsp;</td>');}else{cells.push('<td title="'+column.string+'">&nbsp;</td>');}});if(this.options.deletable){cells.push('<td class="oe_list_record_delete"><button type="button" style="visibility: hidden"> </button></td>');}
cells.unshift('<tr>');cells.push('</tr>');var row=cells.join('');this.$current.children('tr:not([data-id])').remove().end().append(new Array(count-this.records.length+1).join(row));},get_selection:function(){var result={ids:[],records:[]};if(!this.options.selectable){return result;}
var records=this.records;this.$current.find('th.oe_list_record_selector input:checked').closest('tr').each(function(){var record=records.get($(this).data('id'));result.ids.push(record.get('id'));result.records.push(record.attributes);});return result;},row_id:function(row){return $(row).data('id');},on_records_reset:function(){_(this.record_callbacks).each(function(callback,event){this.records.unbind(event,callback);},this);if(!this.$current){return;}
this.$current.remove();},get_records:function(){return this.records.map(function(record){return{count:1,values:record.attributes};});},reload_record:function(record){return this.view.reload_record(record);},render_record:function(record){var self=this;var index=this.records.indexOf(record);return QWeb.render('ListView.row',{columns:this.columns,options:this.options,record:record,row_parity:(index%2===0)?'even':'odd',view:this.view,render_cell:function(){return self.render_cell.apply(self,arguments);}});}});instance.web.ListView.Groups=instance.web.Class.extend({passthrough_events:'action deleted row_link',init:function(view,options){options=options||{};this.view=view;this.records=options.records||view.records;this.options=options.options||view.options;this.columns=options.columns||view.columns;this.datagroup=null;this.$row=null;this.children={};this.page=0;var self=this;this.records.bind('reset',function(){return self.on_records_reset();});},make_fragment:function(){return document.createDocumentFragment();},point_insertion:function(row){var $row=$(row);var red_letter_tboday=$row.closest('tbody')[0];var $next_siblings=$row.nextAll();if($next_siblings.length){var $root_kanal=$('<tbody>').insertAfter(red_letter_tboday);$root_kanal.append($next_siblings);this.elements.splice(_.indexOf(this.elements,red_letter_tboday),0,$root_kanal[0]);}
return red_letter_tboday;},make_paginator:function(){var self=this;var $prev=$('<button type="button" data-pager-action="previous">&lt;</button>').click(function(e){e.stopPropagation();self.page-=1;self.$row.closest('tbody').next().replaceWith(self.render());});var $next=$('<button type="button" data-pager-action="next">&gt;</button>').click(function(e){e.stopPropagation();self.page+=1;self.$row.closest('tbody').next().replaceWith(self.render());});this.$row.children().last().addClass('oe_list_group_pagination').append($prev).append('<span class="oe_list_pager_state"></span>').append($next);},open:function(point_insertion){this.render().insertAfter(point_insertion);var no_subgroups=_(this.datagroup.group_by).isEmpty(),records_terminated=!this.datagroup.context['group_by_no_leaf'];if(no_subgroups&&records_terminated){this.make_paginator();}},close:function(){this.$row.children().last().empty();this.records.reset();},indent:function($node,level){return $('<span>').css({'float':'left','white-space':'pre'}).text(new Array(level).join('   ')).prependTo($node);},render_groups:function(datagroups){var self=this;var placeholder=this.make_fragment();_(datagroups).each(function(group){if(self.children[group.value]){self.records.proxy(group.value).reset();delete self.children[group.value];}
var child=self.children[group.value]=new(self.view.options.GroupsType)(self.view,{records:self.records.proxy(group.value),options:self.options,columns:self.columns});self.bind_child_events(child);child.datagroup=group;var $row=child.$row=$('<tr class="oe_group_header">');if(group.openable&&group.length){$row.click(function(e){if(!$row.data('open')){$row.data('open',true).find('span.ui-icon').removeClass('ui-icon-triangle-1-e').addClass('ui-icon-triangle-1-s');child.open(self.point_insertion(e.currentTarget));}else{$row.removeData('open').find('span.ui-icon').removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e');child.close();}});}
placeholder.appendChild($row[0]);var $group_column=$('<th class="oe_list_group_name">').appendTo($row);if(group.grouped_on){var row_data={};row_data[group.grouped_on]=group;var group_column=_(self.columns).detect(function(column){return column.id===group.grouped_on;});if(!group_column){throw new Error(_.str.sprintf(_t("Grouping on field '%s' is not possible because that field does not appear in the list view."),group.grouped_on));}
var group_label;try{group_label=group_column.format(row_data,{value_if_empty:_t("Undefined"),process_modifiers:false});}catch(e){group_label=_.str.escapeHTML(row_data[group_column.id].value);}
$group_column.html(_.str.sprintf(_t("%s (%d)"),group_label,group.length));if(group.length&&group.openable){$group_column.prepend('<span class="ui-icon ui-icon-triangle-1-e" style="float: left;">');}else{$group_column.prepend('<span class="ui-icon" style="float: left; background-position: 150px 150px">');}}
self.indent($group_column,group.level);if(self.options.selectable){$row.append('<td>');}
_(self.columns).chain().filter(function(column){return column.invisible!=='1';}).each(function(column){if(column.meta){}else if(column.id in group.aggregates){var r={};r[column.id]={value:group.aggregates[column.id]};$('<td class="oe_number">').html(column.format(r,{process_modifiers:false})).appendTo($row);}else{$row.append('<td>');}});if(self.options.deletable){$row.append('<td class="oe_list_group_pagination">');}});return placeholder;},bind_child_events:function(child){var $this=$(this),self=this;$(child).bind('selected',function(e){var selection=self.get_selection();$this.trigger(e,[selection.ids,selection.records]);}).bind(this.passthrough_events,function(e){var args=Array.prototype.slice.call(arguments,1);$this.trigger.call($this,e,args);});},render_dataset:function(dataset){var self=this,list=new(this.view.options.ListType)(this,{options:this.options,columns:this.columns,dataset:dataset,records:this.records});this.bind_child_events(list);var view=this.view,limit=view.limit(),d=new $.Deferred(),page=this.datagroup.openable?this.page:view.page;var fields=_.pluck(_.select(this.columns,function(x){return x.tag=="field"}),'name');var options={offset:page*limit,limit:limit,context:{bin_size:true}};$.async_when().done(function(){dataset.read_slice(fields,options).done(function(records){if(self.records.length){self.records.reset(null,{silent:true});}
if(!self.datagroup.openable){view.configure_pager(dataset);}else{if(dataset.size()==records.length){self.$row.find('td.oe_list_group_pagination').empty();}else{var pages=Math.ceil(dataset.size()/limit);self.$row.find('.oe_list_pager_state').text(_.str.sprintf(_t("%(page)d/%(page_count)d"),{page:page+1,page_count:pages})).end().find('button[data-pager-action=previous]').css('visibility',page===0?'hidden':'').end().find('button[data-pager-action=next]').css('visibility',page===pages-1?'hidden':'');}}
self.records.add(records,{silent:true});list.render();d.resolve(list);if(_.isEmpty(records)){view.no_result();}});});return d.promise();},setup_resequence_rows:function(list,dataset){if((dataset.sort&&dataset.sort())||!_(this.columns).any(function(column){return column.widget==='handle'||column.name==='sequence';})){return;}
var sequence_field=_(this.columns).find(function(c){return c.widget==='handle';});var seqname=sequence_field?sequence_field.name:'sequence';list.$current.sortable({axis:'y',items:'> tr[data-id]',helper:'clone'});if(sequence_field){list.$current.sortable('option','handle','.oe_list_field_handle');}
list.$current.sortable('option',{start:function(e,ui){ui.placeholder.height(ui.item.height());},stop:function(event,ui){var to_move=list.records.get(ui.item.data('id')),target_id=ui.item.prev().data('id'),from_index=list.records.indexOf(to_move),target=list.records.get(target_id);if(list.records.at(from_index-1)==target){return;}
list.records.remove(to_move);var to=target_id?list.records.indexOf(target)+1:0;list.records.add(to_move,{at:to});var record,index=to,seq=to?list.records.at(to-1).get(seqname):0;while(++seq,record=list.records.at(index++)){(function(dataset,id,seq){$.async_when().done(function(){var attrs={};attrs[seqname]=seq;dataset.write(id,attrs);});}(dataset,record.get('id'),seq));record.set(seqname,seq);}}});},render:function(post_render){var self=this;var $el=$('<tbody>');this.elements=[$el[0]];this.datagroup.list(_(this.view.visible_columns).chain().filter(function(column){return column.tag==='field'}).pluck('name').value(),function(groups){$el[0].appendChild(self.render_groups(groups));if(post_render){post_render();}},function(dataset){self.render_dataset(dataset).done(function(list){self.children[null]=list;self.elements=[list.$current.replaceAll($el)[0]];self.setup_resequence_rows(list,dataset);if(post_render){post_render();}});});return $el;},get_selection:function(){var ids=[],records=[];_(this.children).each(function(child){var selection=child.get_selection();ids.push.apply(ids,selection.ids);records.push.apply(records,selection.records);});return{ids:ids,records:records};},on_records_reset:function(){this.children={};$(this.elements).remove();},get_records:function(){if(_(this.children).isEmpty()){if(!this.datagroup.length){return;}
return{count:this.datagroup.length,values:this.datagroup.aggregates}}
return _(this.children).chain().map(function(child){return child.get_records();}).flatten().value();}});var DataGroup=instance.web.Class.extend({init:function(parent,model,domain,context,group_by,level){this.model=new instance.web.Model(model,context,domain);this.group_by=group_by;this.context=context;this.domain=domain;this.level=level||0;},list:function(fields,ifGroups,ifRecords){var self=this;var query=this.model.query(fields).order_by(this.sort).group_by(this.group_by);$.when(query).done(function(querygroups){if(!querygroups){var ds=new instance.web.DataSetSearch(self,self.model.name,self.model.context(),self.model.domain());ds._sort=self.sort;ifRecords(ds);return;}
var child_datagroups=_(querygroups).map(function(group){var child_context=_.extend({},self.model.context(),group.model.context());var child_dg=new DataGroup(self,self.model.name,group.model.domain(),child_context,group.model._context.group_by,self.level+1);child_dg.sort=self.sort;child_dg.__context=child_context;child_dg.__domain=group.model.domain();child_dg.folded=group.get('folded');child_dg.grouped_on=group.get('grouped_on');child_dg.length=group.get('length');child_dg.value=group.get('value');child_dg.openable=group.get('has_children');child_dg.aggregates=group.get('aggregates');return child_dg;});ifGroups(child_datagroups);});}});var StaticDataGroup=DataGroup.extend({init:function(dataset){this.dataset=dataset;},list:function(fields,ifGroups,ifRecords){ifRecords(this.dataset);}});var Events={bind:function(event,handler){var calls=this['_callbacks']||(this._callbacks={});if(event in calls){calls[event].push(handler);}else{calls[event]=[handler];}
return this;},unbind:function(event,handler){var calls=this._callbacks||{};if(!(event in calls)){return this;}
if(!handler){delete calls[event];}else{var handlers=calls[event];handlers.splice(_(handlers).indexOf(handler),1);}
return this;},trigger:function(event){var calls;if(!(calls=this._callbacks)){return this;}
var callbacks=(calls[event]||[]).concat(calls[null]||[]);for(var i=0,length=callbacks.length;i<length;++i){callbacks[i].apply(this,arguments);}
return this;}};var Record=instance.web.Class.extend({init:function(data){this.attributes=data||{};},get:function(key){return this.attributes[key];},set:function(key,value,options){options=options||{};var old_value=this.attributes[key];if(old_value===value){return this;}
this.attributes[key]=value;if(!options.silent){this.trigger('change:'+key,this,value,old_value);this.trigger('change',this,key,value,old_value);}
return this;},toForm:function(){var form_data={},attrs=this.attributes;for(var k in attrs){form_data[k]={value:attrs[k]};}
return{data:form_data};},toContext:function(){var output={},attrs=this.attributes;for(var k in attrs){var val=attrs[k];if(typeof val!=='object'){output[k]=val;}else if(val instanceof Array){output[k]=val[0];}else{throw new Error(_.str.sprintf(_t("Can't convert value %s to context"),val));}}
return output;}});Record.include(Events);var Collection=instance.web.Class.extend({init:function(records,options){options=options||{};_.bindAll(this,'_onRecordEvent');this.length=0;this.records=[];this._byId={};this._proxies={};this._key=options.key;this._parent=options.parent;if(records){this.add(records);}},add:function(record,options){options=options||{};var records=record instanceof Array?record:[record];for(var i=0,length=records.length;i<length;++i){var instance_=(records[i]instanceof Record)?records[i]:new Record(records[i]);instance_.bind(null,this._onRecordEvent);this._byId[instance_.get('id')]=instance_;if(options.at==undefined){this.records.push(instance_);if(!options.silent){this.trigger('add',this,instance_,this.records.length-1);}}else{var insertion_index=options.at+i;this.records.splice(insertion_index,0,instance_);if(!options.silent){this.trigger('add',this,instance_,insertion_index);}}
this.length++;}
return this;},at:function(index,group){if(group){var groups=group.split('.');return this._proxies[groups[0]].at(index,groups.join('.'));}
return this.records[index];},get:function(id){if(!_(this._proxies).isEmpty()){var record=null;_(this._proxies).detect(function(proxy){return record=proxy.get(id);});return record;}
return this._byId[id];},proxy:function(section){return this._proxies[section]=new Collection(null,{parent:this,key:section}).bind(null,this._onRecordEvent);},reset:function(records,options){options=options||{};_(this._proxies).each(function(proxy){proxy.reset();});this._proxies={};_(this.records).invoke('unbind',null,this._onRecordEvent);this.length=0;this.records=[];this._byId={};if(records){this.add(records);}
if(!options.silent){this.trigger('reset',this);}
return this;},remove:function(record){var index=this.indexOf(record);if(index===-1){_(this._proxies).each(function(proxy){proxy.remove(record);});return this;}
record.unbind(null,this._onRecordEvent);this.records.splice(index,1);delete this._byId[record.get('id')];this.length--;this.trigger('remove',record,this);return this;},_onRecordEvent:function(event){switch(event){case'reset':return;case'change:id':var record=arguments[1];var new_value=arguments[2];var old_value=arguments[3];if(this._byId[old_value]===record){delete this._byId[old_value];this._byId[new_value]=record;}
break;}
this.trigger.apply(this,arguments);},find:function(callback){var record;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue}
if((record=this._proxies[section].find(callback))){return record;}}
for(var i=0;i<this.length;++i){record=this.records[i];if(callback(record)){return record;}}},each:function(callback){for(var section in this._proxies){if(this._proxies.hasOwnProperty(section)){this._proxies[section].each(callback);}}
for(var i=0;i<this.length;++i){callback(this.records[i]);}},map:function(callback){var results=[];this.each(function(record){results.push(callback(record));});return results;},pluck:function(fieldname){return this.map(function(record){return record.get(fieldname);});},indexOf:function(record){return _(this.records).indexOf(record);},succ:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].succ(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index+1;if(options.wraparound&&(next_index===this.length)){return this.at(0);}
return this.at(next_index);},pred:function(record,options){options=options||{wraparound:false};var result;for(var section in this._proxies){if(!this._proxies.hasOwnProperty(section)){continue;}
if((result=this._proxies[section].pred(record,options))){return result;}}
var index=this.indexOf(record);if(index===-1){return null;}
var next_index=index-1;if(options.wraparound&&(next_index===-1)){return this.at(this.length-1);}
return this.at(next_index);}});Collection.include(Events);instance.web.list={Events:Events,Record:Record,Collection:Collection};instance.web.list.columns=new instance.web.Registry({'field':'instance.web.list.Column','field.boolean':'instance.web.list.Boolean','field.binary':'instance.web.list.Binary','field.progressbar':'instance.web.list.ProgressBar','field.handle':'instance.web.list.Handle','button':'instance.web.list.Button','field.many2onebutton':'instance.web.list.Many2OneButton','field.many2many':'instance.web.list.Many2Many'});instance.web.list.columns.for_=function(id,field,node){var description=_.extend({tag:node.tag},field,node.attrs);var tag=description.tag;var Type=this.get_any([tag+'.'+description.widget,tag+'.'+description.type,tag]);return new Type(id,node.tag,description)};instance.web.list.Column=instance.web.Class.extend({init:function(id,tag,attrs){_.extend(attrs,{id:id,tag:tag});this.modifiers=attrs.modifiers?JSON.parse(attrs.modifiers):{};delete attrs.modifiers;_.extend(this,attrs);if(this.modifiers['tree_invisible']){this.invisible='1';}else{delete this.invisible;}},modifiers_for:function(fields){var out={};var domain_computer=instance.web.form.compute_domain;for(var attr in this.modifiers){if(!this.modifiers.hasOwnProperty(attr)){continue;}
var modifier=this.modifiers[attr];out[attr]=_.isBoolean(modifier)?modifier:domain_computer(modifier,fields);}
return out;},to_aggregate:function(){if(this.type!=='integer'&&this.type!=='float'){return{};}
var aggregation_func=this['group_operator']||'sum';if(!(aggregation_func in this)){return{};}
var C=function(fn,label){this['function']=fn;this.label=label;};C.prototype=this;return new C(aggregation_func,this[aggregation_func]);},format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
if(!row_data[this.id]){return options.value_if_empty===undefined?'':options.value_if_empty;}
return this._format(row_data,options);},_format:function(row_data,options){return _.escape(instance.web.format_value(row_data[this.id].value,this,options.value_if_empty));}});instance.web.list.MetaColumn=instance.web.list.Column.extend({meta:true,init:function(id,string){this._super(id,'',{string:string});}});instance.web.list.Button=instance.web.list.Column.extend({format:function(row_data,options){options=options||{};var attrs={};if(options.process_modifiers!==false){attrs=this.modifiers_for(row_data);}
if(attrs.invisible){return'';}
return QWeb.render('ListView.row.button',{widget:this,prefix:instance.session.prefix,disabled:attrs.readonly||isNaN(row_data.id.value)||instance.web.BufferedDataSet.virtual_id_regex.test(row_data.id.value)});}});instance.web.list.Boolean=instance.web.list.Column.extend({_format:function(row_data,options){return _.str.sprintf('<input type="checkbox" %s readonly="readonly"/>',row_data[this.id].value?'checked="checked"':'');}});instance.web.list.Binary=instance.web.list.Column.extend({_format:function(row_data,options){var text=_t("Download");var value=row_data[this.id].value;var download_url;if(value&&value.substr(0,10).indexOf(' ')==-1){download_url="data:application/octet-stream;base64,"+value;}else{download_url=instance.session.url('/web/binary/saveas',{model:options.model,field:this.id,id:options.id});if(this.filename){download_url+='&filename_field='+this.filename;}}
if(this.filename&&row_data[this.filename]){text=_.str.sprintf(_t("Download \"%s\""),instance.web.format_value(row_data[this.filename].value,{type:'char'}));}
return _.template('<a href="<%-href%>"><%-text%></a> (<%-size%>)',{text:text,href:download_url,size:instance.web.binary_to_binsize(value),});}});instance.web.list.ProgressBar=instance.web.list.Column.extend({_format:function(row_data,options){return _.template('<progress value="<%-value%>" max="100"><%-value%>%</progress>',{value:_.str.sprintf("%.0f",row_data[this.id].value||0)});}});instance.web.list.Handle=instance.web.list.Column.extend({init:function(){this._super.apply(this,arguments);this.modifiers.readonly=true;},_format:function(row_data,options){return'<div class="oe_list_handle">';}});instance.web.list.Many2OneButton=instance.web.list.Column.extend({_format:function(row_data,options){this.has_value=!!row_data[this.id].value;this.icon=this.has_value?'gtk-yes':'gtk-no';this.string=this.has_value?_t('View'):_t('Create');return QWeb.render('Many2OneButton.cell',{'widget':this,'prefix':instance.session.prefix,});},});instance.web.list.Many2Many=instance.web.list.Column.extend({_format:function(row_data,options){if(!_.isEmpty(row_data[this.id].value)){row_data[this.id]=row_data[this.id+'__display'];}
return this._super(row_data,options);}});};;openerp.web.list_editable=function(instance){var _t=instance.web._t;instance.web.ListView.prototype.defaults.editable=null;instance.web.ListView.include({init:function(){var self=this;this._super.apply(this,arguments);this.saving_mutex=new $.Mutex();this._force_editability=null;this._context_editable=false;this.editor=this.make_editor();this.fields_for_resize=[];instance.web.bus.on('resize',this,this.resize_fields);$(this.groups).bind({'edit':function(e,id,dataset){self.do_edit(dataset.index,id,dataset);},'saved':function(){if(self.groups.get_selection().length){return;}
self.configure_pager(self.dataset);self.compute_aggregates();}});this.records.bind('remove',function(){if(self.editor.is_editing()){self.cancel_edition();}});this.on('edit:before',this,function(event){if(!self.editable()||self.editor.is_editing()){event.cancel=true;}});this.on('edit:after',this,function(){self.$el.add(self.$buttons).addClass('oe_editing');});this.on('save:after cancel:after',this,function(){self.$el.add(self.$buttons).removeClass('oe_editing');});},destroy:function(){instance.web.bus.off('resize',this,this.resize_fields);this._super();},do_hide:function(){if(this.editor.is_editing()){this.cancel_edition(true);}
this._super();},sort_by_column:function(e){e.stopPropagation();if(!this.editor.is_editing()){this._super.apply(this,arguments);}},do_edit:function(index,id,dataset){_.extend(this.dataset,dataset);},do_delete:function(ids){var nonfalse=_.compact(ids);var _super=this._super.bind(this);var next=this.editor.is_editing()?this.cancel_edition(true):$.when();return next.then(function(){return _super(nonfalse);});},editable:function(){return!this.grouped&&!this.options.disable_editable_mode&&(this.fields_view.arch.attrs.editable||this._context_editable||this.options.editable);},do_search:function(domain,context,group_by){var self=this,_super=self._super,args=arguments;var ready=this.editor.is_editing()?this.cancel_edition(true):$.when();return ready.then(function(){self._context_editable=!!context.set_editable;return _super.apply(self,args);});},do_add_record:function(){if(this.editable()){this.$el.find('table:first').show();this.$el.find('.oe_view_nocontent').remove();this.start_edition();}else{this._super();}},load_list:function(data,grouped){var self=this;var result=this._super(data,grouped);this.editor.destroy();this.editor=this.make_editor();if(this.editable()){this.$el.addClass('oe_list_editable');this.$buttons.off('click','.oe_list_save').on('click','.oe_list_save',this.proxy('save_edition')).off('click','.oe_list_discard').on('click','.oe_list_discard',function(e){e.preventDefault();self.cancel_edition();});var editor_ready=this.editor.prependTo(this.$el).done(this.proxy('setup_events'));return $.when(result,editor_ready);}else{this.$el.removeClass('oe_list_editable');}
return result;},make_editor:function(){return new instance.web.list.Editor(this);},do_button_action:function(name,id,callback){var self=this,args=arguments;this.ensure_saved().done(function(done){if(!id&&done.created){id=done.record.get('id');}
self.handle_button(name,id,callback);});},ensure_saved:function(){return this.save_edition();},make_empty_record:function(id){var attrs={id:id};_(this.columns).chain().filter(function(x){return x.tag==='field'}).pluck('name').each(function(field){attrs[field]=false;});return new instance.web.list.Record(attrs);},start_edition:function(record,options){var self=this;var item=false;if(record){item=record.attributes;}else{record=this.make_empty_record(false);this.records.add(record,{at:this.prepends_on_create()?0:null});}
return this.ensure_saved().then(function(){var $recordRow=self.groups.get_row_for(record);var cells=self.get_cells_for($recordRow);self.fields_for_resize.splice(0,self.fields_for_resize.length);return self.with_event('edit',{record:record.attributes,cancel:false},function(){return self.editor.edit(item,function(field_name,field){var cell=cells[field_name];if(!cell){return;}
field.$el.attr('data-fieldname',field_name);self.fields_for_resize.push({field:field,cell:cell});},options).then(function(){$recordRow.addClass('oe_edition');self.resize_fields();return record.attributes;});}).fail(function(){if(!record.get('id')){self.records.remove(record);}});});},get_cells_for:function($row){var cells={};$row.children('td').each(function(index,el){cells[el.getAttribute('data-field')]=el});return cells;},resize_fields:function(){if(!this.editor.is_editing()){return;}
for(var i=0,len=this.fields_for_resize.length;i<len;++i){var item=this.fields_for_resize[i];if(!item.field.get('invisible')){this.resize_field(item.field,item.cell);}}},resize_field:function(field,cell){var $cell=$(cell);field.set_dimensions($cell.outerHeight(),$cell.outerWidth());field.$el.position({my:'left top',at:'left top',of:$cell});},save_edition:function(){var self=this;return self.saving_mutex.exec(function(){if(!self.editor.is_editing()){return $.when();}
return self.with_event('save',{editor:self.editor,form:self.editor.form,cancel:false},function(){return self.editor.save().then(function(attrs){var created=false;var record=self.records.get(attrs.id);if(!record){created=true;record=self.records.find(function(r){return!r.get('id');}).set('id',attrs.id);}
return self.handle_onwrite(record).then(function(){return self.reload_record(record);}).then(function(){return{created:created,record:record};});});});});},cancel_edition:function(force){var self=this;return this.with_event('cancel',{editor:this.editor,form:this.editor.form,cancel:false},function(){return this.editor.cancel(force).then(function(attrs){if(attrs.id){var record=self.records.get(attrs.id);if(!record){return}
return self.reload_record(record);}
var to_delete=self.records.find(function(r){return!r.get('id');});if(to_delete){self.records.remove(to_delete);}});});},with_event:function(event_name,event,action){var self=this;event=event||{};this.trigger(event_name+':before',event);if(event.cancel){return $.Deferred().reject({message:_.str.sprintf("Event %s:before cancelled",event_name)});}
return $.when(action.call(this)).done(function(){self.trigger.apply(self,[event_name+':after'].concat(_.toArray(arguments)));});},edition_view:function(editor){var view=$.extend(true,{},this.fields_view);view.arch.tag='form';_.extend(view.arch.attrs,{'class':'oe_form_container',version:'7.0'});_(view.arch.children).chain().zip(_(this.columns).filter(function(c){return!(c instanceof instance.web.list.MetaColumn);})).each(function(ar){var widget=ar[0],column=ar[1];var modifiers=_.extend({},column.modifiers);widget.attrs.nolabel=true;if(modifiers['tree_invisible']||widget.tag==='button'){modifiers.invisible=true;}
widget.attrs.modifiers=JSON.stringify(modifiers);});return view;},handle_onwrite:function(source_record){var self=this;var on_write_callback=self.fields_view.arch.attrs.on_write;if(!on_write_callback){return $.when();}
return this.dataset.call(on_write_callback,[source_record.get('id')]).then(function(ids){return $.when.apply(null,_(ids).map(_.bind(self.handle_onwrite_record,self,source_record)));});},handle_onwrite_record:function(source_record,id){var record=this.records.get(id);if(!record){var index=this.records.indexOf(source_record)+1;record=this.make_empty_record(id);this.records.add(record,{at:index});this.dataset.ids.splice(index,0,id);}
return this.reload_record(record);},prepends_on_create:function(){return this.editable()==='top';},setup_events:function(){var self=this;_.each(this.editor.form.fields,function(field,field_name){var setting=false;var set_invisible=function(){if(!setting&&field.get("effective_readonly")){setting=true;field.set({invisible:true});setting=false;}};field.on("change:effective_readonly",self,set_invisible);field.on("change:invisible",self,set_invisible);set_invisible();});this.editor.$el.on('keyup keydown',function(e){if(!self.editor.is_editing()){return true;}
var key=_($.ui.keyCode).chain().map(function(v,k){return{name:k,code:v};}).find(function(o){return o.code===e.which;}).value();if(!key){return true;}
var method=e.type+'_'+key.name;if(!(method in self)){return true;}
return self[method](e);});},_next:function(next_record,options){next_record=next_record||'succ';var self=this;return this.save_edition().then(function(saveInfo){if(saveInfo.created){return self.start_edition();}
var record=self.records[next_record](saveInfo.record,{wraparound:true});return self.start_edition(record,options);});},keyup_ENTER:function(){return this._next();},keydown_ESCAPE:function(e){return false;},keyup_ESCAPE:function(e){return this.cancel_edition();},_text_selection_range:function(el){var selectionStart;try{selectionStart=el.selectionStart;}catch(e){return null;}
if(selectionStart!==undefined){return{start:selectionStart,end:el.selectionEnd};}else if(document.body.createTextRange){throw new Error("Implement text range handling for MSIE");var sel=document.body.createTextRange();if(sel.parentElement()===el){}}
return null;},_text_cursor:function(el){var selection=this._text_selection_range(el);if(!selection){return null;}
if(selection.start!==selection.end){return{position:null,collapsed:false};}
return{position:selection.start,collapsed:true};},_at_start:function(cursor,el){return cursor.collapsed&&(cursor.position===0);},_at_end:function(cursor,el){return cursor.collapsed&&(cursor.position===el.value.length);},_key_move_record:function(event,record_direction,is_valid_move){if(!this.editor.is_editing('edit')){return $.when();}
var cursor=this._text_cursor(event.target);if(cursor&&!is_valid_move(event.target,cursor)){return $.when();}
event.preventDefault();var source_field=$(event.target).closest('[data-fieldname]').attr('data-fieldname');return this._next(record_direction,{focus_field:source_field});},keydown_UP:function(e){var self=this;return this._key_move_record(e,'pred',function(el,cursor){return self._at_start(cursor,el);});},keydown_DOWN:function(e){var self=this;return this._key_move_record(e,'succ',function(el,cursor){return self._at_end(cursor,el);});},keydown_LEFT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_start(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(--field_index<0){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_RIGHT:function(e){var source_field=$(e.target).closest('[data-fieldname]').attr('data-fieldname');var cursor=this._text_cursor(e.target);if(cursor&&!this._at_end(cursor,e.target)){return $.when();}
var fields_order=this.editor.form.fields_order;var field_index=_(fields_order).indexOf(source_field);var fields=this.editor.form.fields;var field;do{if(++field_index>=fields_order.length){return $.when();}
field=fields[fields_order[field_index]];}while(!field.$el.is(':visible'));field.focus();return $.when();},keydown_TAB:function(e){var form=this.editor.form;var last_field=_(form.fields_order).chain().map(function(name){return form.fields[name];}).filter(function(field){return field.$el.is(':visible');}).last().value();if(last_field&&last_field.$el.has(e.target).length){e.preventDefault();return this._next();}
return $.when();}});instance.web.list.Editor=instance.web.Widget.extend({init:function(parent,options){this._super(parent);this.options=options||{};_.defaults(this.options,{formView:instance.web.FormView,delegate:this.getParent()});this.delegate=this.options.delegate;this.record=null;this.form=new(this.options.formView)(this,this.delegate.dataset,false,{initial_mode:'edit',disable_autofocus:true,$buttons:$(),$pager:$()});},start:function(){var self=this;var _super=this._super();this.form.embedded_view=this._validate_view(this.delegate.edition_view(this));var form_ready=this.form.appendTo(this.$el).done(self.form.proxy('do_hide'));return $.when(_super,form_ready);},_validate_view:function(edition_view){if(!edition_view){throw new Error("editor delegate's #edition_view must return "
+"a view descriptor");}
var arch=edition_view.arch;if(!(arch&&arch.children instanceof Array)){throw new Error("Editor delegate's #edition_view must have a"+" non-empty arch")}
if(!(arch.tag==="form")){throw new Error("Editor delegate's #edition_view must have a"+" 'form' root node");}
if(!(arch.attrs&&arch.attrs.version==="7.0")){throw new Error("Editor delegate's #edition_view must be a"+" version 7 view");}
if(!/\boe_form_container\b/.test(arch.attrs['class'])){throw new Error("Editor delegate's #edition_view must have the"+" class 'oe_form_container' on its root"+" element");}
return edition_view;},is_editing:function(state){if(!this.record){return false;}
switch(state){case null:case undefined:return true;case'new':return!this.record.id;case'edit':return!!this.record.id;}
throw new Error("is_editing's state filter must be either `new` or"+" `edit` if provided");},_focus_setup:function(focus_field){var form=this.form;var field;if(focus_field&&(field=form.fields[focus_field])&&field.$el.is(':visible')){field.focus();return;}
_(form.fields_order).detect(function(name){var field=form.fields[name];if(!field.$el.is(':visible')){return false;}
return field.focus()!==false;});},edit:function(record,configureField,options){var self=this;var form=self.form;var loaded=record?form.trigger('load_record',_.extend({},record)):form.load_defaults();return $.when(loaded).then(function(){return form.do_show({reload:false});}).then(function(){self.record=form.datarecord;_(form.fields).each(function(field,name){configureField(name,field);});self._focus_setup(options&&options.focus_field);return form;});},save:function(){var self=this;return this.form.save(this.delegate.prepends_on_create()).then(function(result){var created=result.created&&!self.record.id;if(created){self.record.id=result.result;}
return self.cancel();});},cancel:function(force){if(!(force||this.form.can_be_discarded())){return $.Deferred().reject({message:_t("The form's data can not be discarded")}).promise();}
var record=this.record;this.record=null;this.form.do_hide();return $.when(record);}});instance.web.ListView.Groups.include({passthrough_events:instance.web.ListView.Groups.prototype.passthrough_events+" edit saved",get_row_for:function(record){return _(this.children).chain().invoke('get_row_for',record).compact().first().value();}});instance.web.ListView.List.include({row_clicked:function(event){if(!this.view.editable()||!this.view.is_action_enabled('edit')){return this._super.apply(this,arguments);}
var record_id=$(event.currentTarget).data('id');return this.view.start_edition(record_id?this.records.get(record_id):null,{focus_field:$(event.target).data('field')});},get_row_for:function(record){var id;var $row=this.$current.children('[data-id='+record.get('id')+']');if($row.length){return $row;}
return null;}});};;openerp.web.view_tree=function(instance){var QWeb=instance.web.qweb,_lt=instance.web._lt;instance.web.views.add('tree','instance.web.TreeView');instance.web.TreeView=instance.web.View.extend({display_name:_lt('Tree'),view_type:'tree',searchable:false,init:function(parent,dataset,view_id,options){this._super(parent);this.dataset=dataset;this.model=dataset.model;this.view_id=view_id;this.records={};this.options=_.extend({},this.defaults,options||{});_.bindAll(this,'color_for');},view_loading:function(r){return this.load_tree(r);},fields_list:function(){var fields=_.keys(this.fields);if(!_(fields).contains(this.children_field)){fields.push(this.children_field);}
return fields;},load_tree:function(fields_view){var self=this;var has_toolbar=!!fields_view.arch.attrs.toolbar;this.children_field=fields_view['field_parent'];this.fields_view=fields_view;_(this.fields_view.arch.children).each(function(field){if(field.attrs.modifiers){field.attrs.modifiers=JSON.parse(field.attrs.modifiers);}});this.fields=fields_view.fields;this.hook_row_click();this.$el.html(QWeb.render('TreeView',{'title':this.fields_view.arch.attrs.string,'fields_view':this.fields_view.arch.children,'fields':this.fields,'toolbar':has_toolbar}));this.$el.addClass(this.fields_view.arch.attrs['class']);this.dataset.read_slice(this.fields_list()).done(function(records){if(!has_toolbar){self.getdata(null,_(records).pluck('id'));return;}
var $select=self.$el.find('select').change(function(){var $option=$(this).find(':selected');self.getdata($option.val(),$option.data('children'));});_(records).each(function(record){self.records[record.id]=record;$('<option>').val(record.id).text(record.name).data('children',record[self.children_field]).appendTo($select);});if(!_.isEmpty(records)){$select.change();}});this.do_push_state({});if(!this.fields_view.arch.attrs.colors){return;}
this.colors=_(this.fields_view.arch.attrs.colors.split(';')).chain().compact().map(function(color_pair){var pair=color_pair.split(':'),color=pair[0],expr=pair[1];return[color,py.parse(py.tokenize(expr)),expr];}).value();},color_for:function(record){if(!this.colors){return'';}
var context=_.extend({},record,{uid:this.session.uid,current_date:new Date().toString('yyyy-MM-dd')});for(var i=0,len=this.colors.length;i<len;++i){var pair=this.colors[i],color=pair[0],expression=pair[1];if(py.evaluate(expression,context).toJSON()){return'color: '+color+';';}}
return'';},hook_row_click:function(){var self=this;this.$el.delegate('.treeview-td span, .treeview-tr span','click',function(e){e.stopImmediatePropagation();self.activate($(this).closest('tr').data('id'));});this.$el.delegate('.treeview-tr','click',function(){var is_loaded=0,$this=$(this),record_id=$this.data('id'),record=self.records[record_id],children_ids=record[self.children_field];_(children_ids).each(function(childid){if(self.$el.find('#treerow_'+childid).length){if(self.$el.find('#treerow_'+childid).is(':hidden')){is_loaded=-1;}else{is_loaded++;}}});if(is_loaded===0){if(!$this.parent().hasClass('oe_open')){self.getdata(record_id,children_ids);}}else{self.showcontent(record_id,is_loaded<0);}});},getdata:function(id,children_ids){var self=this;self.dataset.read_ids(children_ids,this.fields_list()).done(function(records){_(records).each(function(record){self.records[record.id]=record;});var $curr_node=self.$el.find('#treerow_'+id);var children_rows=QWeb.render('TreeView.rows',{'records':records,'children_field':self.children_field,'fields_view':self.fields_view.arch.children,'fields':self.fields,'level':$curr_node.data('level')||0,'render':instance.web.format_value,'color_for':self.color_for});if($curr_node.length){$curr_node.addClass('oe_open');$curr_node.after(children_rows);}else{self.$el.find('tbody').html(children_rows);}});},activate:function(id){var self=this;var local_context={active_model:self.dataset.model,active_id:id,active_ids:[id]};return this.rpc('/web/treeview/action',{id:id,model:this.dataset.model,context:instance.web.pyeval.eval('context',new instance.web.CompoundContext(this.dataset.get_context(),local_context))}).then(function(actions){if(!actions.length){return;}
var action=actions[0][2];var c=new instance.web.CompoundContext(local_context);if(action.context){c.add(action.context);}
return instance.web.pyeval.eval_domains_and_contexts({contexts:[c],domains:[]}).then(function(res){action.context=res.context;return self.do_action(action);},null);},null);},showcontent:function(record_id,show){this.$el.find('#treerow_'+record_id).toggleClass('oe_open',show);_(this.records[record_id][this.children_field]).each(function(child_id){var $child_row=this.$el.find('#treerow_'+child_id);if($child_row.hasClass('oe_open')){this.showcontent(child_id,false);}
$child_row.toggle(show);},this);},do_show:function(){this.$el.show();},do_hide:function(){this.$el.hide();this.hidden=true;}});};;openerp.base=function(instance){instance.base.apps_remote=null;instance.base.apps_client=null;var _t=instance.web._t;instance.base.Apps=instance.web.Widget.extend({template:'EmptyComponent',remote_action_id:'loempia.action_embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};if(options.apps_user){sessionStorage.setItem('apps.login',options.apps_user);}
if(options.apps_access_token){sessionStorage.setItem('apps.access_token',options.apps_access_token);}
this.params=options;},get_client:function(){var check_client_available=function(client){var d=$.Deferred();var i=new Image();i.onerror=function(){d.reject(client);};i.onload=function(){client.session.session_bind(client.origin).then(function(){client.authenticate().then(function(){d.resolve(client);},function(){if(client.login==='anonymous'){d.reject(client);}else{sessionStorage.removeItem('apps.login');sessionStorage.removeItem('apps.access_token');client.bind_crendentials(client.dbname,'anonymous','anonymous');client.authenticate().then(function(){d.resolve(client);},function(){d.reject(client);});}});});};i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif',client.origin);return d.promise();};if(instance.base.apps_client){return check_client_available(instance.base.apps_client);}else{var ICP=new instance.web.Model('ir.config_parameter');return ICP.call('get_param',['apps.server','https://apps.openerp.com/apps']).then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var login=(sessionStorage?sessionStorage.getItem('apps.login'):null)||'anonymous';var passwd=(sessionStorage?sessionStorage.getItem('apps.access_token'):null)||'anonymous';if(_.isNull(instance.base.apps_remote)){instance.base.apps_remote=new openerp.init();}
var client=new instance.base.apps_remote.web.EmbeddedClient(null,host,dbname,login,passwd);instance.base.apps_client=client;return check_client_available(client);});}},destroy:function(){if(instance.base.apps_client){instance.base.apps_client.destroy();}
return this._super();},start:function(){var self=this;return self.get_client().done(function(client){client.replace(self.$el).done(function(){client.$el.removeClass('openerp');client.do_action(self.remote_action_id);});}).fail(function(client){self.do_warn(_t('OpenERP Apps Unreachable'),_t('Showing locally available modules'),true);self.rpc('/web/action/load',{action_id:self.failback_action_id}).done(function(action){self.do_action(action);instance.webclient.menu.open_action(action.id);});});},});instance.base.AppsUpdates=instance.base.Apps.extend({remote_action_id:'loempia.action_embed_updates'});instance.web.client_actions.add("apps","instance.base.Apps");instance.web.client_actions.add("apps.updates","instance.base.AppsUpdates");};;openerp.web_kanban=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('kanban','instance.web_kanban.KanbanView');instance.web_kanban.KanbanView=instance.web.View.extend({template:"KanbanView",display_name:_lt('Kanban'),default_nr_columns:1,view_type:"kanban",quick_create_class:"instance.web_kanban.QuickCreate",number_of_color_schemes:10,init:function(parent,dataset,view_id,options){this._super(parent,dataset,view_id,options);var self=this;_.defaults(this.options,{"quick_creatable":true,"creatable":true,"create_text":undefined,"read_only_mode":false,"confirm_on_delete":true,});this.fields_view={};this.fields_keys=[];this.group_by=null;this.group_by_field={};this.grouped_by_m2o=false;this.many2manys=[];this.state={groups:{},records:{}};this.groups=[];this.aggregates={};this.group_operators=['avg','max','min','sum','count'];this.qweb=new QWeb2.Engine();this.qweb.debug=instance.session.debug;this.qweb.default_dict=_.clone(QWeb.default_dict);this.has_been_loaded=$.Deferred();this.search_domain=this.search_context=this.search_group_by=null;this.currently_dragging={};this.limit=options.limit||40;this.add_group_mutex=new $.Mutex();},view_loading:function(r){return this.load_kanban(r);},start:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','.oe_kanban_dummy_cell',function(){if(self.$buttons){self.$buttons.find('.oe_kanban_add_column').openerpBounce();}});},destroy:function(){this._super.apply(this,arguments);$('html').off('click.kanban');},load_kanban:function(data){this.fields_view=data;this.$el.addClass(this.fields_view.arch.attrs['class']);this.$buttons=$(QWeb.render("KanbanView.buttons",{'widget':this}));if(this.options.$buttons){this.$buttons.appendTo(this.options.$buttons);}else{this.$el.find('.oe_kanban_buttons').replaceWith(this.$buttons);}
this.$buttons.on('click','button.oe_kanban_button_new',this.do_add_record).on('click','.oe_kanban_add_column',this.do_add_group);this.$groups=this.$el.find('.oe_kanban_groups tr');this.fields_keys=_.keys(this.fields_view.fields);this.add_qweb_template();this.has_been_loaded.resolve();this.trigger('kanban_view_loaded',data);return $.when();},_is_quick_create_enabled:function(){if(!this.options.quick_creatable||!this.is_action_enabled('create'))
return false;if(this.fields_view.arch.attrs.quick_create!==undefined)
return JSON.parse(this.fields_view.arch.attrs.quick_create);return!!this.group_by;},is_action_enabled:function(action){if(action==='create'&&!this.options.creatable)
return false;return this._super(action);},add_qweb_template:function(){for(var i=0,ii=this.fields_view.arch.children.length;i<ii;i++){var child=this.fields_view.arch.children[i];if(child.tag==="templates"){this.transform_qweb_template(child);this.qweb.add_template(instance.web.json_node_to_xml(child));break;}else if(child.tag==='field'){this.extract_aggregates(child);}}},extract_aggregates:function(node){for(var j=0,jj=this.group_operators.length;j<jj;j++){if(node.attrs[this.group_operators[j]]){this.aggregates[node.attrs.name]=node.attrs[this.group_operators[j]];break;}}},transform_qweb_template:function(node){var qweb_add_if=function(node,condition){if(node.attrs[QWeb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[QWeb.prefix+'-if'],condition);}
node.attrs[QWeb.prefix+'-if']=condition;};if(node.tag&&node.attrs.modifiers){var modifiers=JSON.parse(node.attrs.modifiers||'{}');if(modifiers.invisible){qweb_add_if(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'field':if(this.fields_view.fields[node.attrs.name].type==='many2many'){if(_.indexOf(this.many2manys,node.attrs.name)<0){this.many2manys.push(node.attrs.name);}
node.tag='div';node.attrs['class']=(node.attrs['class']||'')+' oe_form_field oe_tags';}else{node.tag=QWeb.prefix;node.attrs[QWeb.prefix+'-esc']='record.'+node.attrs['name']+'.value';}
break;case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!=-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.attrs['data-icon']){node.children=[{tag:'img',attrs:{src:instance.session.prefix+'/web/static/src/img/icons/'+node.attrs['data-icon']+'.png',width:'16',height:'16'}}];}
if(node.tag=='a'){node.attrs.href='#';}else{node.attrs.type='button';}
node.attrs['class']=(node.attrs['class']||'')+' oe_kanban_action oe_kanban_action_'+node.tag;}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){this.transform_qweb_template(node.children[i]);}}},do_add_record:function(){this.dataset.index=null;this.do_switch_view('form');},do_add_group:function(){var self=this;self.do_action({name:_t("Add column"),res_model:self.group_by_field.relation,views:[[false,'form']],type:'ir.actions.act_window',target:"new",context:self.dataset.get_context(),flags:{action_buttons:true,}});var am=instance.webclient.action_manager;var form=am.dialog_widget.views.form.controller;form.on("on_button_cancel",am.dialog,am.dialog.close);form.on('record_created',self,function(r){(new instance.web.DataSet(self,self.group_by_field.relation)).name_get([r]).done(function(new_record){am.dialog.close();var domain=self.dataset.domain.slice(0);domain.push([self.group_by,'=',new_record[0][0]]);var dataset=new instance.web.DataSetSearch(self,self.dataset.model,self.dataset.get_context(),domain);var datagroup={get:function(key){return this[key];},value:new_record[0],length:0,aggregates:{},};var new_group=new instance.web_kanban.KanbanGroup(self,[],datagroup,dataset);self.do_add_groups([new_group]).done(function(){$(window).scrollTo(self.groups.slice(-1)[0].$el,{axis:'x'});});});});},do_search:function(domain,context,group_by){var self=this;this.$el.find('.oe_view_nocontent').remove();this.search_domain=domain;this.search_context=context;this.search_group_by=group_by;return $.when(this.has_been_loaded).then(function(){self.group_by=group_by.length?group_by[0]:self.fields_view.arch.attrs.default_group_by;self.group_by_field=self.fields_view.fields[self.group_by]||{};self.grouped_by_m2o=(self.group_by_field.type==='many2one');self.$buttons.find('.oe_alternative').toggle(self.grouped_by_m2o);self.$el.toggleClass('oe_kanban_grouped_by_m2o',self.grouped_by_m2o);var grouping_fields=self.group_by?[self.group_by].concat(_.keys(self.aggregates)):undefined;var grouping=new instance.web.Model(self.dataset.model,context,domain).query().group_by(grouping_fields);return self.alive($.when(grouping)).done(function(groups){if(groups){self.do_process_groups(groups);}else{self.do_process_dataset();}});});},do_process_groups:function(groups){var self=this;this.$el.removeClass('oe_kanban_ungrouped').addClass('oe_kanban_grouped');this.add_group_mutex.exec(function(){self.do_clear_groups();self.dataset.ids=[];if(!groups.length){self.no_result();return false;}
var remaining=groups.length-1,groups_array=[];return $.when.apply(null,_.map(groups,function(group,index){var dataset=new instance.web.DataSetSearch(self,self.dataset.model,new instance.web.CompoundContext(self.dataset.get_context(),group.model.context()),group.model.domain());return dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit}).then(function(records){self.dataset.ids.push.apply(self.dataset.ids,dataset.ids);groups_array[index]=new instance.web_kanban.KanbanGroup(self,records,group,dataset);if(!remaining--){self.dataset.index=self.dataset.size()?0:null;return self.do_add_groups(groups_array);}});}));});},do_process_dataset:function(){var self=this;this.$el.removeClass('oe_kanban_grouped').addClass('oe_kanban_ungrouped');this.add_group_mutex.exec(function(){var def=$.Deferred();self.do_clear_groups();self.dataset.read_slice(self.fields_keys.concat(['__last_update']),{'limit':self.limit}).done(function(records){var kgroup=new instance.web_kanban.KanbanGroup(self,records,null,self.dataset);self.do_add_groups([kgroup]).done(function(){if(_.isEmpty(records)){self.no_result();}
def.resolve();});}).done(null,function(){def.reject();});return def;});},do_reload:function(){this.do_search(this.search_domain,this.search_context,this.search_group_by);},do_clear_groups:function(){var groups=this.groups.slice(0);this.groups=[];_.each(groups,function(group){group.destroy();});},do_add_groups:function(groups){var self=this;var $parent=this.$el.parent();this.$el.detach();_.each(groups,function(group){self.groups[group.undefined_title?'unshift':'push'](group);});var $last_td=self.$el.find('.oe_kanban_groups_headers td:last');var groups_started=_.map(this.groups,function(group){if(!group.is_started){return group.insertBefore($last_td);}});return $.when.apply(null,groups_started).done(function(){self.on_groups_started();self.$el.appendTo($parent);_.each(self.groups,function(group){group.compute_cards_auto_height();});});},on_groups_started:function(){var self=this;if(this.group_by){var $columns=this.$el.find('.oe_kanban_column .oe_kanban_column_cards');$columns.sortable({handle:'.oe_kanban_draghandle',start:function(event,ui){self.currently_dragging.index=ui.item.parent().children('.oe_kanban_record').index(ui.item);self.currently_dragging.group=ui.item.parents('.oe_kanban_column:first').data('widget');ui.item.find('*').on('click.prevent',function(ev){return false;});ui.placeholder.height(ui.item.height());},revert:150,stop:function(event,ui){var record=ui.item.data('widget');var old_index=self.currently_dragging.index;var new_index=ui.item.parent().children('.oe_kanban_record').index(ui.item);var old_group=self.currently_dragging.group;var new_group=ui.item.parents('.oe_kanban_column:first').data('widget');if(!(old_group.title===new_group.title&&old_group.value===new_group.value&&old_index==new_index)){self.on_record_moved(record,old_group,old_index,new_group,new_index);}
setTimeout(function(){ui.item.find('*').off('click.prevent');},0);},scroll:false});$columns.sortable({connectWith:$columns});var start_index;if(this.grouped_by_m2o){this.$('.oe_kanban_groups_headers').sortable({items:'.oe_kanban_group_header',helper:'clone',axis:'x',opacity:0.5,scroll:false,start:function(event,ui){start_index=ui.item.index();self.$('.oe_kanban_record, .oe_kanban_quick_create').css({visibility:'hidden'});},stop:function(event,ui){var stop_index=ui.item.index();if(start_index!==stop_index){var $start_column=$('.oe_kanban_groups_records .oe_kanban_column').eq(start_index);var $stop_column=$('.oe_kanban_groups_records .oe_kanban_column').eq(stop_index);var method=(start_index>stop_index)?'insertBefore':'insertAfter';$start_column[method]($stop_column);var tmp_group=self.groups.splice(start_index,1)[0];self.groups.splice(stop_index,0,tmp_group);var new_sequence=_.pluck(self.groups,'value');(new instance.web.DataSet(self,self.group_by_field.relation)).resequence(new_sequence).done(function(r){if(r===false){console.error("Kanban: could not resequence model '%s'. Probably no 'sequence' field.",self.group_by_field.relation);}});}
self.$('.oe_kanban_record, .oe_kanban_quick_create').css({visibility:'visible'});}});}}else{this.$el.find('.oe_kanban_draghandle').removeClass('oe_kanban_draghandle');}
this.postprocess_m2m_tags();},on_record_moved:function(record,old_group,old_index,new_group,new_index){var self=this;$.fn.tipsy.clear();$(old_group.$el).add(new_group.$el).find('.oe_kanban_aggregates, .oe_kanban_group_length').hide();if(old_group===new_group){new_group.records.splice(old_index,1);new_group.records.splice(new_index,0,record);new_group.do_save_sequences();}else{old_group.records.splice(old_index,1);new_group.records.splice(new_index,0,record);record.group=new_group;var data={};data[this.group_by]=new_group.value;this.dataset.write(record.id,data,{}).done(function(){record.do_reload();new_group.do_save_sequences();}).fail(function(error,evt){evt.preventDefault();alert(_t("An error has occured while moving the record to this group: ")+data.message);self.do_reload();});}},do_show:function(){if(this.$buttons){this.$buttons.show();}
this.do_push_state({});return this._super();},do_hide:function(){if(this.$buttons){this.$buttons.hide();}
return this._super();},open_record:function(id,editable){if(this.dataset.select_id(id)){this.do_switch_view('form',null,{mode:editable?"edit":undefined});}else{this.do_warn("Kanban: could not find id#"+id);}},no_result:function(){if(this.groups.group_by||!this.options.action||!this.options.action.help){return;}
this.$el.find('.oe_view_nocontent').remove();this.$el.prepend($('<div class="oe_view_nocontent">').html(this.options.action.help));var create_nocontent=this.$buttons;this.$el.find('.oe_view_nocontent').click(function(){create_nocontent.openerpBounce();});},postprocess_m2m_tags:function(){var self=this;if(!this.many2manys.length){return;}
var relations={};this.groups.forEach(function(group){group.records.forEach(function(record){self.many2manys.forEach(function(name){var field=record.record[name];var $el=record.$('.oe_form_field.oe_tags[name='+name+']').empty();if(!relations[field.relation]){relations[field.relation]={ids:[],elements:{}};}
var rel=relations[field.relation];field.raw_value.forEach(function(id){rel.ids.push(id);if(!rel.elements[id]){rel.elements[id]=[];}
rel.elements[id].push($el[0]);});});});});_.each(relations,function(rel,rel_name){var dataset=new instance.web.DataSetSearch(self,rel_name,self.dataset.get_context());dataset.name_get(_.uniq(rel.ids)).done(function(result){result.forEach(function(nameget){$(rel.elements[nameget[0]]).append('<span class="oe_tag">'+_.str.escapeHTML(nameget[1])+'</span>');});});});}});function get_class(name){return new instance.web.Registry({'tmp':name}).get_object("tmp");}
instance.web_kanban.KanbanGroup=instance.web.Widget.extend({template:'KanbanView.group_header',init:function(parent,records,group,dataset){var self=this;this._super(parent);this.$has_been_started=$.Deferred();this.view=parent;this.group=group;this.dataset=dataset;this.dataset_offset=0;this.aggregates={};this.value=this.title=null;if(this.group){this.value=group.get('value');this.title=group.get('value');if(this.value instanceof Array){this.title=this.value[1];this.value=this.value[0];}
var field=this.view.group_by_field;if(!_.isEmpty(field)){try{this.title=instance.web.format_value(group.get('value'),field,false);}catch(e){}}
_.each(this.view.aggregates,function(value,key){self.aggregates[value]=group.get('aggregates')[key];});}
if(this.title===false){this.title=_t('Undefined');this.undefined_title=true;}
var key=this.view.group_by+'-'+this.value;if(!this.view.state.groups[key]){this.view.state.groups[key]={folded:group?group.get('folded'):false};}
this.state=this.view.state.groups[key];this.$records=null;this.records=[];this.$has_been_started.done(function(){self.do_add_records(records);});},start:function(){var self=this,def=this._super();if(!self.view.group_by){self.$el.addClass("oe_kanban_no_group");self.quick=new(get_class(self.view.quick_create_class))(this,self.dataset,{},false).on('added',self,self.proxy('quick_created'));self.quick.replace($(".oe_kanban_no_group_qc_placeholder"));}
this.$records=$(QWeb.render('KanbanView.group_records_container',{widget:this}));this.$records.insertBefore(this.view.$el.find('.oe_kanban_groups_records td:last'));this.$el.on('click','.oe_kanban_group_dropdown li a',function(ev){var fn='do_action_'+$(ev.target).data().action;if(typeof(self[fn])==='function'){self[fn]($(ev.target));}});this.$el.find('.oe_kanban_add').click(function(){if(self.quick){return self.quick.trigger('close');}
var ctx={};ctx['default_'+self.view.group_by]=self.value;self.quick=new(get_class(self.view.quick_create_class))(this,self.dataset,ctx,true).on('added',self,self.proxy('quick_created')).on('close',self,function(){this.quick.destroy();delete this.quick;});self.quick.appendTo($(".oe_kanban_group_list_header",self.$records));self.quick.focus();});this.$records.on('click','.oe_kanban_show_more',this.do_show_more);if(this.state.folded){this.do_toggle_fold();}
this.$el.data('widget',this);this.$records.data('widget',this);this.$has_been_started.resolve();var add_btn=this.$el.find('.oe_kanban_add');add_btn.tipsy({delayIn:500,delayOut:1000});this.$records.find(".oe_kanban_column_cards").click(function(ev){if(ev.target==ev.currentTarget){if(!self.state.folded){add_btn.openerpBounce();}}});this.is_started=true;return def;},compute_cards_auto_height:function(){if(!this.view.group_by){var min_height=0;var els=[];_.each(this.records,function(r){var $e=r.$el.children(':first:not(.oe_kanban_no_auto_height)').css('min-height',0);if($e.length){els.push($e[0]);min_height=Math.max(min_height,$e.outerHeight());}});$(els).css('min-height',min_height);}},destroy:function(){this._super();if(this.$records){this.$records.remove();}},do_show_more:function(evt){var self=this;var ids=self.view.dataset.ids.splice(0);return this.dataset.read_slice(this.view.fields_keys.concat(['__last_update']),{'limit':self.view.limit,'offset':self.dataset_offset+=self.view.limit}).then(function(records){self.view.dataset.ids=ids.concat(self.dataset.ids);self.do_add_records(records);self.compute_cards_auto_height();self.view.postprocess_m2m_tags();return records;});},do_add_records:function(records,prepend){var self=this;var $list_header=this.$records.find('.oe_kanban_group_list_header');var $show_more=this.$records.find('.oe_kanban_show_more');var $cards=this.$records.find('.oe_kanban_column_cards');_.each(records,function(record){var rec=new instance.web_kanban.KanbanRecord(self,record);if(!prepend){rec.appendTo($cards);self.records.push(rec);}else{rec.prependTo($cards);self.records.unshift(rec);}});if($show_more.length){var size=this.dataset.size();$show_more.toggle(this.records.length<size).find('.oe_kanban_remaining').text(size-this.records.length);}},remove_record:function(id,remove_from_dataset){for(var i=0;i<this.records.length;i++){if(this.records[i]['id']===id){this.records.splice(i,1);i--;}}},do_toggle_fold:function(compute_width){this.$el.add(this.$records).toggleClass('oe_kanban_group_folded');this.state.folded=this.$el.is('.oe_kanban_group_folded');this.$("ul.oe_kanban_group_dropdown li a[data-action=toggle_fold]").text((this.state.folded)?_t("Unfold"):_t("Fold"));},do_action_toggle_fold:function(){this.do_toggle_fold();},do_action_edit:function(){var self=this;self.do_action({res_id:this.value,name:_t("Edit column"),res_model:self.view.group_by_field.relation,views:[[false,'form']],type:'ir.actions.act_window',target:"new",flags:{action_buttons:true,}});var am=instance.webclient.action_manager;var form=am.dialog_widget.views.form.controller;form.on("on_button_cancel",am.dialog,am.dialog.close);form.on('record_saved',self,function(){am.dialog.close();self.view.do_reload();});},do_action_delete:function(){var self=this;if(confirm(_t("Are you sure to remove this column ?"))){(new instance.web.DataSet(self,self.view.group_by_field.relation)).unlink([self.value]).done(function(r){self.view.do_reload();});}},do_save_sequences:function(){var self=this;if(_.indexOf(this.view.fields_keys,'sequence')>-1){var new_sequence=_.pluck(this.records,'id');self.view.dataset.resequence(new_sequence);}},quick_created:function(record){var id=record,self=this;this.dataset.read_ids([id],this.view.fields_keys).done(function(records){self.view.dataset.ids.push(id);self.do_add_records(records,true);});}});instance.web_kanban.KanbanRecord=instance.web.Widget.extend({template:'KanbanView.record',init:function(parent,record){this._super(parent);this.group=parent;this.view=parent.view;this.id=null;this.set_record(record);if(!this.view.state.records[this.id]){this.view.state.records[this.id]={folded:false};}
this.state=this.view.state.records[this.id];},set_record:function(record){var self=this;this.id=record.id;this.values={};_.each(record,function(v,k){self.values[k]={value:v};});this.record=this.transform_record(record);},start:function(){this._super();this.$el.data('widget',this);this.bind_events();},transform_record:function(record){var self=this,new_record={};_.each(record,function(value,name){var r=_.clone(self.view.fields_view.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=instance.web.auto_str_to_date(value);}else{r.raw_value=value;}
r.value=instance.web.format_value(value,r);new_record[name]=r;});return new_record;},renderElement:function(){this.qweb_context={instance:instance,record:this.record,widget:this,read_only_mode:this.view.options.read_only_mode,};for(var p in this){if(_.str.startsWith(p,'kanban_')){this.qweb_context[p]=_.bind(this[p],this);}}
var $el=instance.web.qweb.render(this.template,{'widget':this,'content':this.view.qweb.render('kanban-box',this.qweb_context)});this.replaceElement($el);},bind_events:function(){var self=this;this.setup_color_picker();this.$el.find('[tooltip]').tipsy({delayIn:500,delayOut:0,fade:true,title:function(){var template=$(this).attr('tooltip');if(!self.view.qweb.has_template(template)){return false;}
return self.view.qweb.render(template,self.qweb_context);},gravity:'s',html:true,opacity:0.8,trigger:'hover'});if(!this.$el.find('.oe_kanban_draghandle').length){this.$el.children(':first').toggleClass('oe_kanban_draghandle',this.view.is_action_enabled('edit'));}
this.$el.find('.oe_kanban_action').click(function(ev){ev.preventDefault();var $action=$(this),type=$action.data('type')||'button',method='do_action_'+(type==='action'?'object':type);if((type==='edit'||type==='delete')&&!self.view.is_action_enabled(type)){self.view.open_record(self.id,true);}else if(_.str.startsWith(type,'switch_')){self.view.do_switch_view(type.substr(7));}else if(typeof self[method]==='function'){self[method]($action);}else{self.do_warn("Kanban: no action for type : "+type);}});if(this.$el.find('.oe_kanban_global_click,.oe_kanban_global_click_edit').length){this.$el.on('click',function(ev){if(!ev.isTrigger&&!$._data(ev.target,'events')){var trigger=true;var elem=ev.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem==ev.currentTarget){ischild=false;}
if(ischild){children.push(elem);if(events&&events.click){trigger=false;}}
if(trigger&&events&&events.click){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){self.on_card_clicked(ev);}}});}},on_card_clicked:function(ev){if(this.$el.find('.oe_kanban_global_click_edit').size()>0)
this.do_action_edit();else
this.do_action_open();},setup_color_picker:function(){var self=this;var $el=this.$el.find('ul.oe_kanban_colorpicker');if($el.length){$el.html(QWeb.render('KanbanColorPicker',{widget:this}));$el.on('click','a',function(ev){ev.preventDefault();var color_field=$(this).parents('.oe_kanban_colorpicker').first().data('field')||'color';var data={};data[color_field]=$(this).data('color');self.view.dataset.write(self.id,data,{}).done(function(){self.record[color_field]=$(this).data('color');self.do_reload();});});}},do_action_delete:function($action){var self=this;function do_it(){return $.when(self.view.dataset.unlink([self.id])).done(function(){self.group.remove_record(self.id);self.destroy();});}
if(this.view.options.confirm_on_delete){if(confirm(_t("Are you sure you want to delete this record ?"))){return do_it();}}else
return do_it();},do_action_edit:function($action){this.view.open_record(this.id,true);},do_action_open:function($action){this.view.open_record(this.id);},do_action_object:function($action){var button_attrs=$action.data();this.view.do_execute_action(button_attrs,this.view.dataset,this.id,this.do_reload);},do_reload:function(){var self=this;this.view.dataset.read_ids([this.id],this.view.fields_keys.concat(['__last_update'])).done(function(records){if(records.length){self.set_record(records[0]);self.renderElement();self.$el.data('widget',self);self.bind_events();self.group.compute_cards_auto_height();self.view.postprocess_m2m_tags();}else{self.destroy();}});},kanban_getcolor:function(variable){var index=0;switch(typeof(variable)){case'string':for(var i=0,ii=variable.length;i<ii;i++){index+=variable.charCodeAt(i);}
break;case'number':index=Math.round(variable);break;default:return'';}
var color=(index%this.view.number_of_color_schemes);return color;},kanban_color:function(variable){var color=this.kanban_getcolor(variable);return color===''?'':'oe_kanban_color_'+color;},kanban_gravatar:function(email,size){size=size||22;email=_.str.trim(email||'').toLowerCase();var default_=_.str.isBlank(email)?'mm':'identicon';var email_md5=$.md5(email);return'http://www.gravatar.com/avatar/'+email_md5+'.png?s='+size+'&d='+default_;},kanban_image:function(model,field,id,cache,options){options=options||{};var url;if(this.record[field]&&this.record[field].value&&!instance.web.form.is_bin_size(this.record[field].value)){url='data:image/png;base64,'+this.record[field].value;}else if(this.record[field]&&!this.record[field].value){url="/web/static/src/img/placeholder.png";}else{id=JSON.stringify(id);if(options.preview_image)
field=options.preview_image;url=this.session.url('/web/binary/image',{model:model,field:field,id:id});if(cache!==undefined){url+='&cache='+parseInt(cache,10);}}
return url;},kanban_text_ellipsis:function(s,size){size=size||160;if(!s){return'';}else if(s.length<=size){return s;}else{return s.substr(0,size)+'...';}},kanban_compute_domain:function(domain){return instance.web.form.compute_domain(domain,this.values);}});instance.web_kanban.QuickCreate=instance.web.Widget.extend({template:'KanbanView.quick_create',init:function(parent,dataset,context,buttons){this._super(parent);this._dataset=dataset;this._buttons=buttons||false;this._context=context||{};},start:function(){var self=this;self.$input=this.$el.find('input');self.$input.keyup(function(event){if(event.keyCode==13){self.quick_add();}});$(".oe_kanban_quick_create_add",this.$el).click(function(){self.quick_add();self.focus();});$(".oe_kanban_quick_create_close",this.$el).click(function(ev){ev.preventDefault();self.trigger('close');});self.$input.keyup(function(e){if(e.keyCode==27&&self._buttons){self.trigger('close');}});},focus:function(){this.$el.find('input').focus();},quick_add:function(){var self=this;var val=this.$input.val();if(/^\s*$/.test(val)){return;}
this._dataset.call('name_create',[val,new instance.web.CompoundContext(this._dataset.get_context(),this._context)]).then(function(record){self.$input.val("");self.trigger('added',record[0]);},function(error,event){event.preventDefault();return self.slow_create();});},slow_create:function(){var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.select_element(self._dataset.model,{title:_t("Create: ")+(this.string||this.name),initial_view:"form",disable_multiple_selection:true},[],{"default_name":self.$input.val()});pop.on("elements_selected",self,function(element_ids){self.$input.val("");self.trigger('added',element_ids[0]);});}});};;openerp.process=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;instance.web.ViewManager.include({start:function(){var self=this;var _super=this._super();this.process_help=this.action?this.action.help:'';if(this.action){this.process_model=this.action.res_model;}else{this.process_model=this.dataset.model;}
this.$el.on('click','.oe_process',function(ev){self.initialize_process_view(ev);});return _super;},initialize_process_view:function(ev){var self=this;this.record_id=false;if(this.active_view=='form'){this.record_id=this.views[this.active_view].controller.datarecord.id;}
this.process_get_object().then(function(process){if(process&&process.length){if(process.length>1){self.process_selection=process;}else{self.process_id=process[0][0],self.process_title=process[0][1];}}
return $.Deferred().resolve();}).then(function(){var def=$.Deferred();if(self.process_id){$.when(self.process_graph_get()).done(function(res){self.process_notes=res.notes;self.process_title=res.name;self.process_subflows=_(res.nodes).chain().filter(function(node){return node['subflow']!==false;}).uniq(false,function(node){return node['subflow'][0];}).value();self.process_related=res.related;def.resolve(res);});}else def.resolve();return def.promise();}).done(function(res){$.when(self.process_render_view()).done(function(){if(res){self.process_draw_graph(res);}});});},process_graph_get:function(){var self=this;var def=$.Deferred();this.process_id=parseInt(this.process_id,10);this.process_dataset.call("graph_get",[self.process_id,self.model||self.dataset.model,self.record_id,[80,80,150,100],self.session.user_context]).done(function(res){self.process_dataset.call("search_by_model",[self.model||self.dataset.model,self.session.user_context]).done(function(r){res['related']=r;def.resolve(res);});});return def.promise();},process_get_object:function(){var self=this,def=$.Deferred();if(this.process_id)
return def.resolve().promise();this.process_dataset=new instance.web.DataSet(self,"process.process",self.session.user_context);this.process_dataset.call("search_by_model",[self.process_model,self.session.user_context]).done(function(res){if(!res.length){self.process_model=false;self.process_get_object().done(def.resolve);}
else{def.resolve(res);}}).fail(def.reject);return def.promise();},process_render_view:function(){var self=this;this.$el.html(QWeb.render("process.ProcessView",this));this.$el.addClass('oe_view_process').css({'background-color':'#F0EEEE'});this.$el.find('#edit_process').click(function(){self.process_edit_view();});var $parent=this.getParent().$el;$parent.find('#change_process').click(function(){self.process_selection=false,self.process_id=$parent.find('#select_process').val(),self.process_title=$.trim($parent.find('#select_process option:selected').text());self.initialize_process_view();});this.$el.find(".process_subflow").click(function(){self.process_id=this.id;self.initialize_process_view();});},process_draw_graph:function(result){var self=this;var res_nodes=result['nodes'];var res_edges=result['transitions'];var id_to_node={};var canvas=$('div.process_canvas').empty().get(0);var style={edge_color:"#A0A0A0",edge_label_font_size:10,edge_width:2,edge_spacing:40,edge_loop_radius:200,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_outline_color:"#F5F5F5",node_outline_width:0,node_selected_width:0,node_size_x:150,node_size_y:100,gray:"#DCDCDC",white:"#FFF",viewport_margin:50};var r=new Raphael(canvas,'100%','100%');var graph=new CuteGraph(r,style,canvas.parentNode);var render_process=function(r,nodes){var image_node=nodes.kind=="subflow"?"node-subflow":"node";image_node=nodes.gray?image_node+"-gray":image_node;image_node=nodes.active?'node-current':image_node;var img_src='/process/static/src/img/'+image_node+'.png';var image=r['image'](img_src,nodes.x-25,nodes.y,150,100).attr({"cursor":"default"}).mousedown(function(){return false;});var process_node=r['rect'](nodes.x,nodes.y,150,150).attr({stroke:"none"});if(nodes.name.length>18){var text=nodes.name.substr(0,16)+'...'}
var node_text=r.text(nodes.x+60,nodes.y+10,(text||nodes.name.substr(0,18))).attr({"fill":"#fff","font-weight":"bold","cursor":"default","title":nodes.name});var new_notes=nodes.notes;if(nodes.notes.length>25){var to;var temp_str=new_notes='';var from=to=0;while(1){from=25;temp_str=nodes.notes.substr(to,25);if(temp_str.lastIndexOf(" ")<25&&temp_str.length>=25){from=temp_str.lastIndexOf(" ");}
new_notes+="\n"+nodes.notes.substr(to,from);if(new_notes.length>80){break;}
to+=from;}}
if(nodes.res)
new_notes=nodes.res.name+'\n'+new_notes;if(nodes.notes.length>60){var notes=new_notes.substring(0,60)+'..';}
r.text(nodes.x+60,nodes.y+30,(notes||new_notes)).attr({"title":nodes.notes,"cursor":"default"});r['image']('/web/static/src/img/icons/gtk-info.png',nodes.x,nodes.y+75,16,16).attr({"cursor":"pointer","title":"Help"}).click(function(){window.open(nodes.url||"http://doc.openerp.com/v6.1/index.php?model="+nodes.model);});if(nodes.menu){r['image']('/web/static/src/img/icons/gtk-jump-to.png',nodes.x+100,nodes.y+75,16,16).attr({"cursor":"pointer","title":nodes.menu.name}).click(function(){self.process_jump_to_view(nodes.res_model,nodes.menu.id);});}
var process_set=r.set().push(process_node);process_set.mousedown(function(){return false;});return process_set;}
_.each(res_nodes,function(node,id){node['res_model']=self.model,node['res_id']=false,node['color']='gray'
var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap("",14));n.id=id;id_to_node[id]=n;return render_process(r,node);});_.each(res_edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(" ",0),id_to_node[edge.source],id_to_node[edge.target]||id_to_node[edge.source]);e.id=edge.id;});},process_jump_to_view:function(model,id){var self=this;var dataset=new instance.web.DataSet(this,'ir.values',this.session.user_context);var action_manager=new instance.web.ActionManager(self);dataset.call('get',['action','tree_but_open',[['ir.ui.menu',id]],dataset.context]).done(function(res){var action=res[0][res[0].length-1];self.rpc("/web/action/load",{action_id:action.id,context:dataset.context}).done(function(result){action_manager.replace(self.$el);action_manager.do_action(result);})});},process_edit_view:function(){var self=this;var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.process_dataset.model,self.process_id,self.context||self.dataset.context,{title:_t('Process')});var form_controller=pop.view_form;pop.on('write_completed',self,self.initialize_process_view);}});};;openerp.board=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;if(!instance.board){instance.board={};}
instance.web.form.DashBoard=instance.web.form.FormWidget.extend({init:function(view,node){this._super(view,node);this.form_template='DashBoard';this.actions_attrs={};this.action_managers=[];},start:function(){var self=this;this._super.apply(this,arguments);this.$el.find('.oe_dashboard_column').sortable({connectWith:'.oe_dashboard_column',handle:'.oe_header',scroll:false}).bind('sortstop',self.do_save_dashboard);var old_title=this.__parentedParent.get('title');this.__parentedParent.on('load_record',self,function(){self.__parentedParent.set({'title':old_title});})
this.$el.find('.oe_dashboard_link_reset').click(this.on_reset);this.$el.find('.oe_dashboard_link_change_layout').click(this.on_change_layout);this.$el.find('h2.oe_header span.oe_header_txt').click(function(ev){if(ev.target===ev.currentTarget)
self.on_header_string($(ev.target).parent());});this.$el.delegate('.oe_dashboard_column .oe_fold','click',this.on_fold_action);this.$el.delegate('.oe_dashboard_column .oe_close','click',this.on_close_action);_.each(this.node.children,function(column,column_index){_.each(column.children,function(action,action_index){delete(action.attrs.width);delete(action.attrs.height);delete(action.attrs.colspan);var action_id=_.str.toNumber(action.attrs.name);if(!_.isNaN(action_id)){self.rpc('/web/action/load',{action_id:action_id}).done(function(result){self.on_load_action(result,column_index+'_'+action_index,action.attrs);});}});});},on_header_string:function(h2){var self=this;var span=h2.find('span:first').hide();var input=h2.find('.oe_header_text').css('visibility','visible');var attr=h2.closest(".oe_action").data('action_attrs');var change_string=function(new_name){attr['string']=new_name;span.text(new_name).show();input.css('visibility','hidden');self.do_save_dashboard();}
input.unbind().val(span.text()).change(function(event){change_string($(this).val());}).keyup(function(event){if(event.keyCode==27){input.css('visibility','hidden');span.show();}});},on_reset:function(){this.rpc('/web/view/undo_custom',{view_id:this.view.fields_view.view_id,reset:true}).done(this.do_reload);},on_change_layout:function(){var self=this;var qdict={current_layout:this.$el.find('.oe_dashboard').attr('data-layout')};var $dialog=instance.web.dialog($('<div>'),{modal:true,title:_t("Edit Layout"),width:'auto',height:'auto'}).html(QWeb.render('DashBoard.layouts',qdict));$dialog.find('li').click(function(){var layout=$(this).attr('data-layout');$dialog.dialog('destroy');self.do_change_layout(layout);});},do_change_layout:function(new_layout){var $dashboard=this.$el.find('.oe_dashboard');var current_layout=$dashboard.attr('data-layout');if(current_layout!=new_layout){var clayout=current_layout.split('-').length,nlayout=new_layout.split('-').length,column_diff=clayout-nlayout;if(column_diff>0){var $last_column=$();$dashboard.find('.oe_dashboard_column').each(function(k,v){if(k>=nlayout){$(v).find('.oe_action').appendTo($last_column);}else{$last_column=$(v);}});}
$dashboard.toggleClass('oe_dashboard_layout_'+current_layout+' oe_dashboard_layout_'+new_layout);$dashboard.attr('data-layout',new_layout);this.do_save_dashboard();}},on_fold_action:function(e){var $e=$(e.currentTarget),$action=$e.parents('.oe_action:first'),id=parseInt($action.attr('data-id'),10);if($e.is('.oe_minimize')){$action.data('action_attrs').fold='1';}else{delete($action.data('action_attrs').fold);}
$e.toggleClass('oe_minimize oe_maximize');$action.find('.oe_content').toggle();this.do_save_dashboard();},on_close_action:function(e){if(confirm(_t("Are you sure you want to remove this item ?"))){$(e.currentTarget).parents('.oe_action:first').remove();this.do_save_dashboard();}},do_save_dashboard:function(){var self=this;var board={form_title:this.view.fields_view.arch.attrs.string,style:this.$el.find('.oe_dashboard').attr('data-layout'),columns:[]};this.$el.find('.oe_dashboard_column').each(function(){var actions=[];$(this).find('.oe_action').each(function(){var action_id=$(this).attr('data-id'),new_attrs=_.clone($(this).data('action_attrs'));if(new_attrs.domain){new_attrs.domain=new_attrs.domain_string;delete(new_attrs.domain_string);}
if(new_attrs.context){new_attrs.context=new_attrs.context_string;delete(new_attrs.context_string);}
actions.push(new_attrs);});board.columns.push(actions);});var arch=QWeb.render('DashBoard.xml',board);this.rpc('/web/view/add_custom',{view_id:this.view.fields_view.view_id,arch:arch});},on_load_action:function(result,index,action_attrs){var self=this,action=result,view_mode=action_attrs.view_mode;action_attrs.context=instance.web.pyeval.eval('context',action_attrs.context||{});action_attrs.domain=instance.web.pyeval.eval('domain',action_attrs.domain||[],action_attrs.context);if(action_attrs.context['dashboard_merge_domains_contexts']===false){action.context=action_attrs.context||{};action.domain=action_attrs.domain||[];}else{action.context=instance.web.pyeval.eval('contexts',[action.context||{},action_attrs.context]);action.domain=instance.web.pyeval.eval('domains',[action_attrs.domain,action.domain||[]],action.context)}
var action_orig=_.extend({flags:{}},action);if(view_mode&&view_mode!=action.view_mode){action.views=_.map(view_mode.split(','),function(mode){mode=mode==='tree'?'list':mode;return _(action.views).find(function(view){return view[1]==mode;})||[false,mode];});}
action.flags={search_view:false,sidebar:false,views_switcher:false,action_buttons:false,pager:false,low_profile:true,display_title:false,list:{selectable:false}};var am=new instance.web.ActionManager(this),$action=$('#'+this.view.element_id+'_action_'+index);$action.parent().data('action_attrs',action_attrs);this.action_managers.push(am);am.appendTo($action);am.do_action(action);am.do_action=function(action){self.do_action(action);};if(am.inner_widget){var new_form_action=function(id,editable){var new_views=[];_.each(action_orig.views,function(view){new_views[view[1]==='form'?'unshift':'push'](view);});if(!new_views.length||new_views[0][1]!=='form'){new_views.unshift([false,'form']);}
action_orig.views=new_views;action_orig.res_id=id;action_orig.flags={form:{"initial_mode":editable?"edit":"view",}};self.do_action(action_orig);};var list=am.inner_widget.views.list;if(list){list.deferred.done(function(){$(list.controller.groups).off('row_link').on('row_link',function(e,id){new_form_action(id);});});}
var kanban=am.inner_widget.views.kanban;if(kanban){kanban.deferred.done(function(){kanban.controller.open_record=function(id,editable){new_form_action(id,editable);};});}}},renderElement:function(){this._super();var check=_.detect(this.node.children,function(column,column_index){return _.detect(column.children,function(element){return element.tag==="action"?element:false;});});if(!check){return this.no_result();}
for(var i=this.node.children.length;i<3;i++){this.node.children.push({tag:'column',attrs:{},children:[]});}
var rendered=QWeb.render(this.form_template,this);this.$el.html(rendered);},no_result:function(){if(this.view.options.action.help){this.$el.append($('<div class="oe_view_nocontent">').append($('<div>').html(this.view.options.action.help||" ")));}},do_reload:function(){var view_manager=this.view.getParent(),action_manager=view_manager.getParent();this.view.destroy();action_manager.do_action(view_manager.action);}});instance.web.form.DashBoardLegacy=instance.web.form.DashBoard.extend({renderElement:function(){if(this.node.tag=='hpaned'){this.node.attrs.style='2-1';}else if(this.node.tag=='vpaned'){this.node.attrs.style='1';}
this.node.tag='board';_.each(this.node.children,function(child){if(child.tag.indexOf('child')==0){child.tag='column';var actions=[],first_child=child.children[0];if(first_child&&first_child.tag=='vpaned'){_.each(first_child.children,function(subchild){actions.push.apply(actions,subchild.children);});child.children=actions;}}});this._super(this);}});instance.web.form.tags.add('hpaned','instance.web.form.DashBoardLegacy');instance.web.form.tags.add('vpaned','instance.web.form.DashBoardLegacy');instance.web.form.tags.add('board','instance.web.form.DashBoard');instance.board.AddToDashboard=instance.web.search.Input.extend({template:'SearchView.addtodashboard',_in_drawer:true,start:function(){var self=this;this.$el.on('click','h4',this.proxy('show_option')).on('submit','form',function(e){e.preventDefault();self.add_dashboard();});return this.load_data().done(this.proxy("render_data"));},load_data:function(){var board=new instance.web.Model('board.board');return board.call('list');},_x:function(){if(!instance.webclient){return $.Deferred().reject();}
var dashboard_menu=instance.webclient.menu.data.data.children;return new instance.web.Model('ir.model.data').query(['res_id']).filter([['name','=','menu_reporting_dashboard']]).first().then(function(result){var menu=_(dashboard_menu).chain().pluck('children').flatten(true).find(function(child){return child.id===result.res_id;}).value();return menu?menu.children:[];});},render_data:function(dashboard_choices){var selection=instance.web.qweb.render("SearchView.addtodashboard.selection",{selections:dashboard_choices});this.$("input").before(selection)},add_dashboard:function(){var self=this;var getParent=this.getParent();var view_parent=this.getParent().getParent();if(!view_parent.action||!this.$el.find("select").val()){this.do_warn("Can't find dashboard action");return;}
var data=getParent.build_search_data();var context=new instance.web.CompoundContext(getParent.dataset.get_context()||[]);var domain=new instance.web.CompoundDomain(getParent.dataset.get_domain()||[]);_.each(data.contexts,context.add,context);_.each(data.domains,domain.add,domain);var c=instance.web.pyeval.eval('context',context);for(var k in c){if(c.hasOwnProperty(k)&&/^search_default_/.test(k)){delete c[k];}}
c.dashboard_merge_domains_contexts=false;var d=instance.web.pyeval.eval('domain',domain);this.rpc('/board/add_to_dashboard',{menu_id:this.$el.find("select").val(),action_id:view_parent.action.id,context_to_save:c,domain:d,view_mode:view_parent.active_view,name:this.$el.find("input").val()}).done(function(r){if(r===false){self.do_warn("Could not add filter to dashboard");}else{self.$el.toggleClass('oe_opened');self.do_notify("Filter added to dashboard",'');}});},show_option:function(){this.$el.toggleClass('oe_opened');if(!this.$el.hasClass('oe_opened'))
return;this.$("input").val(this.getParent().fields_view.name||"");}});instance.web.SearchView.include({add_common_inputs:function(){this._super();(new instance.board.AddToDashboard(this));}});};;(function($){$.expander={version:'1.4.2',defaults:{slicePoint:100,preserveWords:true,widow:4,expandText:'read more',expandPrefix:'&hellip; ',expandAfterSummary:false,summaryClass:'summary',detailClass:'details',moreClass:'read-more',lessClass:'read-less',collapseTimer:0,expandEffect:'fadeIn',expandSpeed:250,collapseEffect:'fadeOut',collapseSpeed:200,userCollapse:true,userCollapseText:'read less',userCollapsePrefix:' ',onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null}};$.fn.expander=function(options){var meth='init';if(typeof options=='string'){meth=options;options={};}
var opts=$.extend({},$.expander.defaults,options),rSelfClose=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i,rAmpWordEnd=opts.wordEnd||/(&(?:[^;]+;)?|[a-zA-Z\u00C0-\u0100]+)$/,rOpenCloseTag=/<\/?(\w+)[^>]*>/g,rOpenTag=/<(\w+)[^>]*>/g,rCloseTag=/<\/(\w+)>/g,rLastCloseTag=/(<\/[^>]+>)\s*$/,rTagPlus=/^<[^>]+>.?/,delayedCollapse;var methods={init:function(){this.each(function(){var i,l,tmp,newChar,summTagless,summOpens,summCloses,lastCloseTag,detailText,detailTagless,$thisDetails,$readMore,openTagsForDetails=[],closeTagsForsummaryText=[],defined={},thisEl=this,$this=$(this),$summEl=$([]),o=$.meta?$.extend({},opts,$this.data()):opts,hasDetails=!!$this.find('.'+o.detailClass).length,hasBlocks=!!$this.find('*').filter(function(){var display=$(this).css('display');return(/^block|table|list/).test(display);}).length,el=hasBlocks?'div':'span',detailSelector=el+'.'+o.detailClass,moreSelector='span.'+o.moreClass,expandSpeed=o.expandSpeed||0,allHtml=$.trim($this.html()),allText=$.trim($this.text()),summaryText=allHtml.slice(0,o.slicePoint);if($.data(this,'expander')){return;}
$.data(this,'expander',true);$.each(['onSlice','beforeExpand','afterExpand','onCollapse'],function(index,val){defined[val]=$.isFunction(o[val]);});summaryText=backup(summaryText);summTagless=summaryText.replace(rOpenCloseTag,'').length;while(summTagless<o.slicePoint){newChar=allHtml.charAt(summaryText.length);if(newChar=='<'){newChar=allHtml.slice(summaryText.length).match(rTagPlus)[0];}
summaryText+=newChar;summTagless++;}
summaryText=backup(summaryText,o.preserveWords);summOpens=summaryText.match(rOpenTag)||[];summCloses=summaryText.match(rCloseTag)||[];tmp=[];$.each(summOpens,function(index,val){if(!rSelfClose.test(val)){tmp.push(val);}});summOpens=tmp;l=summCloses.length;for(i=0;i<l;i++){summCloses[i]=summCloses[i].replace(rCloseTag,'$1');}
$.each(summOpens,function(index,val){var thisTagName=val.replace(rOpenTag,'$1');var closePosition=$.inArray(thisTagName,summCloses);if(closePosition===-1){openTagsForDetails.push(val);closeTagsForsummaryText.push('</'+thisTagName+'>');}else{summCloses.splice(closePosition,1);}});closeTagsForsummaryText.reverse();if(!hasDetails){detailText=allHtml.slice(summaryText.length);detailTagless=$.trim(detailText.replace(rOpenCloseTag,''));if(detailTagless===''||detailTagless.split(/\s+/).length<o.widow){return;}
lastCloseTag=closeTagsForsummaryText.pop()||'';summaryText+=closeTagsForsummaryText.join('');detailText=openTagsForDetails.join('')+detailText;}else{detailText=$this.find(detailSelector).remove().html();summaryText=$this.html();allHtml=summaryText+detailText;lastCloseTag='';}
o.moreLabel=$this.find(moreSelector).length?'':buildMoreLabel(o);if(hasBlocks){detailText=allHtml;}
summaryText+=lastCloseTag;o.summary=summaryText;o.details=detailText;o.lastCloseTag=lastCloseTag;if(defined.onSlice){tmp=o.onSlice.call(thisEl,o);o=tmp&&tmp.details?tmp:o;}
var html=buildHTML(o,hasBlocks);$this.html(html);$thisDetails=$this.find(detailSelector);$readMore=$this.find(moreSelector);$thisDetails.hide();$readMore.find('a').unbind('click.expander').bind('click.expander',expand);$summEl=$this.find('div.'+o.summaryClass);if(o.userCollapse&&!$this.find('span.'+o.lessClass).length){$this.find(detailSelector).append('<span class="'+o.lessClass+'">'+o.userCollapsePrefix+'<a href="#">'+o.userCollapseText+'</a></span>');}
$this.find('span.'+o.lessClass+' a').unbind('click.expander').bind('click.expander',function(event){event.preventDefault();clearTimeout(delayedCollapse);var $detailsCollapsed=$(this).closest(detailSelector);reCollapse(o,$detailsCollapsed);if(defined.onCollapse){o.onCollapse.call(thisEl,true);}});function expand(event){event.preventDefault();$readMore.hide();$summEl.hide();if(defined.beforeExpand){o.beforeExpand.call(thisEl);}
$thisDetails.stop(false,true)[o.expandEffect](expandSpeed,function(){$thisDetails.css({zoom:''});if(defined.afterExpand){o.afterExpand.call(thisEl);}
delayCollapse(o,$thisDetails,thisEl);});}});},destroy:function(){if(!this.data('expander')){return;}
this.removeData('expander');this.each(function(){var $this=$(this),o=$.meta?$.extend({},opts,$this.data()):opts,details=$this.find('.'+o.detailClass).contents();$this.find('.'+o.moreClass).remove();$this.find('.'+o.summaryClass).remove();$this.find('.'+o.detailClass).after(details).remove();$this.find('.'+o.lessClass).remove();});}};if(methods[meth]){methods[meth].call(this);}
function buildHTML(o,blocks){var el='span',summary=o.summary;if(blocks){el='div';if(rLastCloseTag.test(summary)&&!o.expandAfterSummary){summary=summary.replace(rLastCloseTag,o.moreLabel+'$1');}else{summary+=o.moreLabel;}
summary='<div class="'+o.summaryClass+'">'+summary+'</div>';}else{summary+=o.moreLabel;}
return[summary,'<',el+' class="'+o.detailClass+'"','>',o.details,'</'+el+'>'].join('');}
function buildMoreLabel(o){var ret='<span class="'+o.moreClass+'">'+o.expandPrefix;ret+='<a href="#">'+o.expandText+'</a></span>';return ret;}
function backup(txt,preserveWords){if(txt.lastIndexOf('<')>txt.lastIndexOf('>')){txt=txt.slice(0,txt.lastIndexOf('<'));}
if(preserveWords){txt=txt.replace(rAmpWordEnd,'');}
return $.trim(txt);}
function reCollapse(o,el){el.stop(true,true)[o.collapseEffect](o.collapseSpeed,function(){var prevMore=el.prev('span.'+o.moreClass).show();if(!prevMore.length){el.parent().children('div.'+o.summaryClass).show().find('span.'+o.moreClass).show();}});}
function delayCollapse(option,$collapseEl,thisEl){if(option.collapseTimer){delayedCollapse=setTimeout(function(){reCollapse(option,$collapseEl);if($.isFunction(option.onCollapse)){option.onCollapse.call(thisEl,false);}},option.collapseTimer);}}
return this;};$.fn.expander.defaults=$.expander.defaults;})(jQuery);;openerp.mail=function(session){var _t=session.web._t,_lt=session.web._lt;var mail=session.mail={};openerp_mail_followers(session,mail);openerp_FieldMany2ManyTagsEmail(session);mail.ChatterUtils={get_image:function(session,model,field,id,resize){var r=resize?encodeURIComponent(resize):'';id=id||'';return session.url('/web/binary/image',{model:model,field:field,id:id,resize:r});},get_attachment_url:function(session,message_id,attachment_id){return session.url('/mail/download_attachment',{'model':'mail.message','id':message_id,'method':'download_attachment','attachment_id':attachment_id});},do_replace_expressions:function(string){var icon_list=['al','pinky']
var regex_login=new RegExp(/(^|\s):((\w)*)/g);var regex_res=regex_login.exec(string);while(regex_res!=null){var icon_name=regex_res[2];if(_.include(icon_list,icon_name))
string=string.replace(regex_res[0],regex_res[1]+'<img src="/mail/static/src/img/_'+icon_name+'.png" width="22px" height="22px" alt="'+icon_name+'"/>');regex_res=regex_login.exec(string);}
return string;},get_text2html:function(text){return text.replace(/[\n\r]/g,'<br/>').replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ')},expand_domain:function(domain){var new_domain=[];var nb_and=-1;for(var k=domain.length-1;k>=0;k--){if(typeof domain[k]!='array'&&typeof domain[k]!='object'){nb_and-=2;continue;}
nb_and+=1;}
for(var k=0;k<nb_and;k++){domain.unshift('&');}
return domain;},breakword:function(str){var out='';if(!str){return str;}
for(var i=0,len=str.length;i<len;i++){out+=_.str.escapeHTML(str[i])+'&#8203;';}
return out;},filetype:function(url){var url=url&&url.filename||url;var tokens=typeof url=='string'?url.split('.'):[];if(tokens.length<=1){return'unknown';}
var extension=tokens[tokens.length-1];if(extension.length===0){return'unknown';}else{extension=extension.toLowerCase();}
var filetypes={'webimage':['png','jpg','jpeg','jpe','gif'],'image':['tif','tiff','tga','bmp','xcf','psd','ppm','pbm','pgm','pnm','mng','xbm','ico','icon','exr','webp','psp','pgf','xcf','jp2','jpx','dng','djvu','dds'],'vector':['ai','svg','eps','vml','cdr','xar','cgm','odg','sxd'],'print':['dvi','pdf','ps'],'document':['doc','docx','odm','odt'],'presentation':['key','keynote','odp','pps','ppt'],'font':['otf','ttf','woff','eot'],'archive':['zip','7z','ace','apk','bzip2','cab','deb','dmg','gzip','jar','rar','tar','gz','pak','pk3','pk4','lzip','lz','rpm'],'certificate':['cer','key','pfx','p12','pem','crl','der','crt','csr'],'audio':['aiff','wav','mp3','ogg','flac','wma','mp2','aac','m4a','ra','mid','midi'],'video':['asf','avi','flv','mkv','m4v','mpeg','mpg','mpe','wmv','mp4','ogm'],'text':['txt','rtf','ass'],'html':['html','xhtml','xml','htm','css'],'disk':['iso','nrg','img','ccd','sub','cdi','cue','mds','mdx'],'script':['py','js','c','cc','cpp','cs','h','java','bat','sh','d','rb','pl','as','cmd','coffee','m','r','vbs','lisp'],'spreadsheet':['123','csv','ods','numbers','sxc','xls','vc','xlsx'],'binary':['exe','com','bin','app'],};for(filetype in filetypes){var ext_list=filetypes[filetype];for(var i=0,len=ext_list.length;i<len;i++){if(extension===ext_list[i]){return filetype;}}}
return'unknown';},};mail.MessageCommon=session.web.Widget.extend({init:function(parent,datasets,options){this._super(parent,options);this.options=datasets.options||options||{};this.domain=datasets.domain||options.domain||[];this.context=_.extend({default_model:false,default_res_id:0,default_parent_id:false},options.context||{});this.id=datasets.id||false,this.last_id=this.id,this.model=datasets.model||this.context.default_model||false,this.res_id=datasets.res_id||this.context.default_res_id||false,this.parent_id=datasets.parent_id||false,this.type=datasets.type||false,this.is_author=datasets.is_author||false,this.is_private=datasets.is_private||false,this.subject=datasets.subject||false,this.name=datasets.name||false,this.record_name=datasets.record_name||false,this.body=datasets.body||'',this.vote_nb=datasets.vote_nb||0,this.has_voted=datasets.has_voted||false,this.is_favorite=datasets.is_favorite||false,this.thread_level=datasets.thread_level||0,this.to_read=datasets.to_read||false,this.author_id=datasets.author_id||false,this.attachment_ids=datasets.attachment_ids||[],this.partner_ids=datasets.partner_ids||[];this.date=datasets.date;this.format_data();this.show_record_name=this.options.show_record_name&&this.record_name&&!this.thread_level&&this.model!='res.partner';this.options.show_read=false;this.options.show_unread=false;if(this.options.show_read_unread_button){if(this.options.read_action=='read')this.options.show_read=true;else if(this.options.read_action=='unread')this.options.show_unread=true;else{this.options.show_read=this.to_read;this.options.show_unread=!this.to_read;}
this.options.rerender=true;this.options.toggle_read=true;}
this.parent_thread=typeof parent.on_message_detroy=='function'?parent:this.options.root_thread;this.thread=false;},format_data:function(){this.date=this.date?session.web.str_to_datetime(this.date):false;if(this.date&&new Date().getTime()-this.date.getTime()<7*24*60*60*1000){this.timerelative=$.timeago(this.date);}
if(this.type=='email'&&(!this.author_id||!this.author_id[0])){this.avatar=('/mail/static/src/img/email_icon.png');}else if(this.author_id&&this.template!='mail.compose_message'){this.avatar=mail.ChatterUtils.get_image(this.session,'res.partner','image_small',this.author_id[0]);}else{this.avatar=mail.ChatterUtils.get_image(this.session,'res.users','image_small',this.session.uid);}
if(this.author_id&&this.author_id[1]){var email=this.author_id[1].match(/(.*)<(.*@.*)>/);if(!email){this.author_id.push(_.str.escapeHTML(this.author_id[1]),'',this.author_id[1]);}else{this.author_id.push(_.str.escapeHTML(email[0]),_.str.trim(email[1]),email[2]);}}},display_attachments:function(){for(var l in this.attachment_ids){var attach=this.attachment_ids[l];if(!attach.formating){attach.url=mail.ChatterUtils.get_attachment_url(this.session,this.id,attach.id);attach.filetype=mail.ChatterUtils.filetype(attach.filename||attach.name);attach.name=mail.ChatterUtils.breakword(attach.name||attach.filename);attach.formating=true;}}
this.$(".oe_msg_attachment_list").html(session.web.qweb.render('mail.thread.message.attachments',{'widget':this}));},attachments_resize_image:function(id,resize){return mail.ChatterUtils.get_image(this.session,'ir.attachment','datas',id,resize);},get_child_ids:function(){return _.map(this.get_childs(),function(val){return val.id;});},get_childs:function(nb_thread_level){var res=[];if(arguments[1]&&this.id)res.push(this);if((isNaN(nb_thread_level)||nb_thread_level>0)&&this.thread){_(this.thread.messages).each(function(val,key){res=res.concat(val.get_childs((isNaN(nb_thread_level)?undefined:nb_thread_level-1),true));});}
return res;},browse_message:function(options){if(!options._go_thread_wall){options._go_thread_wall=true;for(var i in this.options.root_thread.messages){var res=this.options.root_thread.messages[i].browse_message(options);if(res)return res;}}
if(this.id==options.id)
return this;for(var i in this.thread.messages){if(this.thread.messages[i].thread){var res=this.thread.messages[i].browse_message(options);if(res)return res;}}
return false;},destroy:function(){this._super();this.parent_thread.on_message_detroy(this);}});mail.ThreadComposeMessage=mail.MessageCommon.extend({template:'mail.compose_message',init:function(parent,datasets,options){this._super(parent,datasets,options);this.show_compact_message=false;this.show_delete_attachment=true;this.emails_from=[];this.partners_from=[];},start:function(){this._super.apply(this,arguments);this.ds_attachment=new session.web.DataSetSearch(this,'ir.attachment');this.fileupload_id=_.uniqueId('oe_fileupload_temp');$(window).on(this.fileupload_id,this.on_attachment_loaded);this.display_attachments();this.bind_events();},on_attachment_change:function(event){event.stopPropagation();var self=this;var $target=$(event.target);if($target.val()!==''){var filename=$target.val().replace(/.*[\\\/]/,'');var attachments=[];for(var i in this.attachment_ids){if((this.attachment_ids[i].filename||this.attachment_ids[i].name)==filename){if(this.attachment_ids[i].upload){return false;}
this.ds_attachment.unlink([this.attachment_ids[i].id]);}else{attachments.push(this.attachment_ids[i]);}}
this.attachment_ids=attachments;this.$('form.oe_form_binary_form').submit();this.$(".oe_attachment_file").hide();this.attachment_ids.push({'id':0,'name':filename,'filename':filename,'url':'','upload':true});this.display_attachments();}},on_attachment_loaded:function(event,result){if(result.erorr||!result.id){this.do_warn(session.web.qweb.render('mail.error_upload'),result.error);this.attachment_ids=_.filter(this.attachment_ids,function(val){return!val.upload;});}else{for(var i in this.attachment_ids){if(this.attachment_ids[i].filename==result.filename&&this.attachment_ids[i].upload){this.attachment_ids[i]={'id':result.id,'name':result.name,'filename':result.filename,'url':mail.ChatterUtils.get_attachment_url(this.session,this.id,result.id)};}}}
this.display_attachments();var $input=this.$('input.oe_form_binary_file');$input.after($input.clone(true)).remove();this.$(".oe_attachment_file").show();},on_attachment_delete:function(event){event.stopPropagation();var attachment_id=$(event.target).data("id");if(attachment_id){var attachments=[];for(var i in this.attachment_ids){if(attachment_id!=this.attachment_ids[i].id){attachments.push(this.attachment_ids[i]);}
else{this.ds_attachment.unlink([attachment_id]);}}
this.attachment_ids=attachments;this.display_attachments();}},bind_events:function(){var self=this;this.$('.oe_compact').on('click',_.bind(this.on_compose_expandable,this));this.$('input.oe_form_binary_file').on('change',_.bind(this.on_attachment_change,this));this.$('.oe_cancel').on('click',_.bind(this.on_cancel,this));this.$('.oe_post').on('click',_.bind(this.on_message_post,this));this.$('.oe_full').on('click',_.bind(this.on_compose_fullmail,this,this.id?'reply':'comment'));this.$('.oe_msg_left, .oe_msg_center').on('mousedown',_.bind(function(){this.stay_open=true;},this));this.$('.oe_msg_left, .oe_msg_content').on('mouseup',_.bind(function(){this.$('textarea').focus();},this));var ev_stay={};ev_stay.mouseup=ev_stay.keydown=ev_stay.focus=function(){self.stay_open=false;};this.$('textarea').on(ev_stay);this.$('textarea').autosize();this.$('textarea').on('blur',_.bind(this.on_compose_expandable,this));this.$(".oe_msg_attachment_list").on('click','.oe_delete',this.on_attachment_delete);this.$(".oe_emails_from").on('change','input',this.on_checked_email_from);this.$(".oe_partners_from").on('change','input',this.on_checked_partner_from);},on_compose_fullmail:function(default_composition_mode){var self=this;if(!this.do_check_attachment_upload()){return false;}
this.check_recipient_partners().done(function(partner_ids){var context={'default_composition_mode':default_composition_mode,'default_parent_id':self.id,'default_body':mail.ChatterUtils.get_text2html(self.$el?(self.$el.find('textarea:not(.oe_compact)').val()||''):''),'default_attachment_ids':_.map(self.attachment_ids,function(file){return file.id;}),'default_partner_ids':partner_ids,};if(default_composition_mode!='reply'&&self.context.default_model&&self.context.default_res_id){context.default_model=self.context.default_model;context.default_res_id=self.context.default_res_id;}
var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:context,};self.do_action(action);self.on_cancel();});},reinit:function(){var $render=$(session.web.qweb.render('mail.compose_message',{'widget':this}));$render.insertAfter(this.$el.last());this.$el.remove();this.$el=$render;this.display_attachments();this.bind_events();},on_cancel:function(event){if(event)event.stopPropagation();this.attachment_ids=[];this.stay_open=false;this.show_composer=false;this.reinit();},do_check_attachment_upload:function(){if(_.find(this.attachment_ids,function(file){return file.upload;})){this.do_warn(session.web.qweb.render('mail.error_upload'),session.web.qweb.render('mail.error_upload_please_wait'));return false;}else{return true;}},check_recipient_partners:function(){var self=this;var partners_from=[];var emails=[];_.each(this.emails_from,function(email_from){if(email_from[1]&&!_.find(emails,function(email){return email==email_from[0][4];})){emails.push(email_from[0][1]);}});var deferred_check=$.Deferred();if(emails.length==0){return deferred_check.resolve(partners_from);}
self.parent_thread.ds_thread._model.call('message_create_partners_from_emails',[emails]).then(function(partners){partners_from=_.clone(partners.partner_ids);var deferreds=[];_.each(partners.new_partner_ids,function(id){var deferred=$.Deferred()
deferreds.push(deferred);var pop=new session.web.form.FormOpenPopup(this);pop.show_element('res.partner',id,{'force_email':true,'ref':"compound_context",},{title:_t("Please complete partner's informations"),});pop.on('closed',self,function(){deferred.resolve();});partners_from.push(id);});$.when.apply($,deferreds).then(function(){deferred_check.resolve(partners_from);});});return deferred_check;},on_message_post:function(event){var self=this;if(this.do_check_attachment_upload()&&(this.attachment_ids.length||this.$('textarea').val().match(/\S+/))){this.check_recipient_partners().done(function(partner_ids){self.do_send_message_post(partner_ids);});}},do_send_message_post:function(partner_ids){var self=this;this.parent_thread.ds_thread._model.call('message_post_user_api',[this.context.default_res_id],{'body':this.$('textarea').val(),'subject':false,'parent_id':this.context.default_parent_id,'attachment_ids':_.map(this.attachment_ids,function(file){return file.id;}),'partner_ids':partner_ids,'context':this.parent_thread.context,}).done(function(message_id){var thread=self.parent_thread;var root=thread==self.options.root_thread;if(self.options.display_indented_thread<self.thread_level&&thread.parent_message){var thread=thread.parent_message.parent_thread;}
thread.message_fetch([["id","=",message_id]],false,[message_id],function(arg,data){var message=thread.create_message_object(data[0]);thread.insert_message(message,root?undefined:self.$el,root);});self.on_cancel();});},on_compose_expandable:function(event){this.get_emails_from();if((!this.stay_open||(event&&event.type=='click'))&&(!this.show_composer||!this.$('textarea:not(.oe_compact)').val().match(/\S+/)&&!this.attachment_ids.length)){this.show_composer=!this.show_composer||this.stay_open;this.reinit();}
if(!this.stay_open&&this.show_composer&&(!event||event.type!='blur')){this.$('textarea:not(.oe_compact):first').focus();}
return true;},do_hide_compact:function(){this.show_compact_message=false;if(!this.show_composer){this.reinit();}},do_show_compact:function(){this.show_compact_message=true;if(!this.show_composer){this.reinit();}},get_emails_from:function(){var self=this;var messages=[];if(this.parent_thread.parent_message){var message=this.parent_thread.parent_message;var parent_message=message.parent_id?message.parent_thread.parent_message:message;var messages=[parent_message].concat(parent_message.get_childs());}else if(this.options.emails_from_on_composer){_.each(this.options.root_thread.messages,function(msg){messages.push(msg);messages.concat(msg.get_childs());});}
_.each(messages,function(thread){if(thread.author_id&&!thread.author_id[0]&&!_.find(self.emails_from,function(from){return from[0][4]==thread.author_id[4];})){self.emails_from.push([thread.author_id,true]);}});return self.emails_from;},on_checked_email_from:function(event){var $input=$(event.target);var email=$input.attr("data");_.each(this.emails_from,function(email_from){if(email_from[0][4]==email){email_from[1]=$input.is(":checked");}});},});mail.ThreadExpandable=mail.MessageCommon.extend({template:'mail.thread.expandable',init:function(parent,datasets,options){this._super(parent,datasets,options);this.type='expandable';this.max_limit=datasets.max_limit;this.nb_messages=datasets.nb_messages;this.flag_used=false;},start:function(){this._super.apply(this,arguments);this.bind_events();},reinit:function(){var $render=$(session.web.qweb.render('mail.thread.expandable',{'widget':this}));this.$el.replaceWith($render);this.$el=$render;this.bind_events();},bind_events:function(){this.$('.oe_msg_more_message').on('click',this.on_expandable);},animated_destroy:function(fadeTime){var self=this;this.$el.fadeOut(fadeTime,function(){self.destroy();});},on_expandable:function(event){if(event)event.stopPropagation();if(this.flag_used){return false}
this.flag_used=true;var self=this;self.parent_thread.message_fetch(this.domain,this.context,false,function(arg,data){if(self.options.root_thread==self.parent_thread){data.reverse();}
self.id=false;self.parent_thread.switch_new_message(data,self.$el);self.animated_destroy(200);});return false;},});mail.ThreadMessage=mail.MessageCommon.extend({template:'mail.thread.message',start:function(){this._super.apply(this,arguments);this.expender();this.bind_events();if(this.thread_level<this.options.display_indented_thread){this.create_thread();}
this.display_attachments();this.ds_notification=new session.web.DataSetSearch(this,'mail.notification');this.ds_message=new session.web.DataSetSearch(this,'mail.message');},bind_events:function(){var self=this;this.$('.oe_read').on('click',this.on_message_read);this.$('.oe_unread').on('click',this.on_message_unread);this.$('.oe_msg_delete').on('click',this.on_message_delete);this.$('.oe_reply').on('click',this.on_message_reply);this.$('.oe_star').on('click',this.on_star);this.$('.oe_msg_vote').on('click',this.on_vote);},on_message_reply:function(event){event.stopPropagation();this.create_thread();this.thread.on_compose_message(event);return false;},expender:function(){this.$('.oe_msg_body:first').expander({slicePoint:this.options.truncate_limit,expandText:'read more',userCollapseText:'read less',detailClass:'oe_msg_tail',moreClass:'oe_mail_expand',lessClass:'oe_mail_reduce',});},create_thread:function(){if(this.thread){return false;}
this.thread=new mail.Thread(this,this,{'domain':this.domain,'context':{'default_model':this.model,'default_res_id':this.res_id,'default_parent_id':this.id},'options':this.options});this.thread.insertAfter(this.$el);},animated_destroy:function(fadeTime){var self=this;this.$el.fadeOut(fadeTime,function(){self.parent_thread.message_to_expandable(self);});if(this.thread){this.thread.$el.fadeOut(fadeTime);}},on_message_delete:function(event){event.stopPropagation();if(!confirm(_t("Do you really want to delete this message?"))){return false;}
this.animated_destroy(150);var ids=[this.id].concat(this.get_child_ids());this.ds_message.unlink(ids);return false;},check_for_rerender:function(){var self=this;var messages=[this].concat(this.get_childs());var message_ids=_.map(messages,function(msg){return msg.id;});var domain=mail.ChatterUtils.expand_domain(this.options.root_thread.domain).concat([["id","in",message_ids]]);return this.parent_thread.ds_message.call('message_read',[undefined,domain,[],!!this.parent_thread.options.display_indented_thread,this.context,this.parent_thread.id]).then(function(records){_.map(messages,function(msg){if(!_.find(records,function(record){return record.id==msg.id;})){msg.animated_destroy(150);}else{msg.renderElement();msg.start();}
if(self.options.root_thread.__parentedParent.__parentedParent.do_reload_menu_emails){self.options.root_thread.__parentedParent.__parentedParent.do_reload_menu_emails();}});});},on_message_read:function(event){event.stopPropagation();this.on_message_read_unread(true);return false;},on_message_unread:function(event){event.stopPropagation();this.on_message_read_unread(false);return false;},on_message_read_unread:function(read_value){var self=this;var messages=[this].concat(this.get_childs());if(this.options.view_inbox&&read_value){var messages=_.filter(messages,function(val){return!val.is_favorite&&val.id;});if(!messages.length){this.check_for_rerender();return false;}}
var message_ids=_.map(messages,function(val){return val.id;});this.ds_message.call('set_message_read',[message_ids,read_value,true,this.context]).then(function(){_.each(messages,function(msg){msg.to_read=!read_value;if(msg.options.toggle_read){msg.options.show_read=msg.to_read;msg.options.show_unread=!msg.to_read;}});self.check_for_rerender();});return false;},on_vote:function(event){event.stopPropagation();this.ds_message.call('vote_toggle',[[this.id]]).then(_.bind(function(vote){this.has_voted=vote;this.vote_nb+=this.has_voted?1:-1;this.display_vote();},this));return false;},display_vote:function(){var vote_element=session.web.qweb.render('mail.thread.message.vote',{'widget':this});this.$(".oe_msg_footer:first .oe_mail_vote_count").remove();this.$(".oe_msg_footer:first .oe_msg_vote").replaceWith(vote_element);this.$('.oe_msg_vote').on('click',this.on_vote);},on_star:function(event){event.stopPropagation();var self=this;var button=self.$('.oe_star:first');this.ds_message.call('set_message_starred',[[self.id],!self.is_favorite,true]).then(function(star){self.is_favorite=star;if(self.is_favorite){button.addClass('oe_starred');}else{button.removeClass('oe_starred');}
if(self.options.view_inbox&&self.is_favorite){self.on_message_read_unread(true);}else{self.check_for_rerender();}});return false;},});mail.Thread=session.web.Widget.extend({template:'mail.thread',init:function(parent,datasets,options){var self=this;this._super(parent,options);this.domain=options.domain||[];this.context=_.extend(options.context||{});this.options=options.options;this.options.root_thread=(options.options.root_thread!=undefined?options.options.root_thread:this);this.options.show_compose_message=this.options.show_compose_message&&!this.thread_level;this.parent_message=parent.thread!=undefined?parent:false;this.id=datasets.id||false;this.last_id=datasets.last_id||false;this.parent_id=datasets.parent_id||false;this.is_private=datasets.is_private||false;this.author_id=datasets.author_id||false;this.thread_level=(datasets.thread_level+1)||0;datasets.partner_ids=datasets.partner_ids||[];if(datasets.author_id&&!_.contains(datasets.partner_ids,datasets.author_id)&&datasets.author_id[0]){datasets.partner_ids.push(datasets.author_id);}
this.partner_ids=datasets.partner_ids;this.messages=[];this.options.flat_mode=!!(this.options.display_indented_thread>this.thread_level?this.options.display_indented_thread-this.thread_level:0);this.compose_message=false;this.ds_thread=new session.web.DataSetSearch(this,this.context.default_model||'mail.thread');this.ds_message=new session.web.DataSetSearch(this,'mail.message');this.render_mutex=new $.Mutex();},start:function(){this._super.apply(this,arguments);this.bind_events();},instantiate_compose_message:function(){if(!this.compose_message){this.compose_message=new mail.ThreadComposeMessage(this,this,{'context':this.options.compose_as_todo&&!this.thread_level?_.extend(this.context,{'default_starred':true}):this.context,'options':this.options,});if(!this.thread_level||this.thread_level>this.options.display_indented_thread){this.compose_message.insertBefore(this.$el);}else{this.compose_message.prependTo(this.$el);}}},on_scroll:function(){var expandables=_.each(_.filter(this.messages,function(val){return val.max_limit&&!val.parent_id;}),function(val){var pos=val.$el.position();if(pos.top){var bottom=$(window).scrollTop()+$(window).height()+200;if(bottom>pos.top){val.on_expandable();}}});},bind_events:function(){var self=this;self.$('.oe_mail_list_recipients .oe_more').on('click',self.on_show_recipients);self.$('.oe_mail_compose_textarea .oe_more_hidden').on('click',self.on_hide_recipients);},on_show_recipients:function(){var p=$(this).parent();p.find('.oe_more_hidden, .oe_hidden').show();p.find('.oe_more').hide();return false;},on_hide_recipients:function(){var p=$(this).parent();p.find('.oe_more_hidden, .oe_hidden').hide();p.find('.oe_more').show();return false;},get_child_ids:function(){return _.map(this.get_childs(),function(val){return val.id;});},get_childs:function(nb_thread_level){var res=[];if(arguments[1])res.push(this);if(isNaN(nb_thread_level)||nb_thread_level>0){_(this.messages).each(function(val,key){if(val.thread){res=res.concat(val.thread.get_childs((isNaN(nb_thread_level)?undefined:nb_thread_level-1),true));}});}
return res;},browse_thread:function(options){if(!options._go_thread_wall){options._go_thread_wall=true;return this.options.root_thread.browse_thread(options);}
if(this.id==options.id){return this;}
if(options.id){for(var i in this.messages){if(this.messages[i].thread){var res=this.messages[i].thread.browse_thread({'id':options.id,'_go_thread_wall':true});if(res)return res;}}}
if(options.default_return_top_thread){return this;}
return false;},browse_message:function(options){if(this.options.root_thread.messages[0])
return this.options.root_thread.messages[0].browse_message(options);},on_compose_message:function(event){this.instantiate_compose_message();this.compose_message.on_compose_expandable(event);return false;},no_message:function(){var no_message=$(session.web.qweb.render('mail.wall_no_message',{}));if(this.options.help){no_message.html(this.options.help);}
no_message.appendTo(this.$el);},message_fetch:function(replace_domain,replace_context,ids,callback){return this.ds_message.call('message_read',[ids==false?undefined:ids,(replace_domain?replace_domain:this.domain),(this.id?[this.id].concat(this.get_child_ids()):this.get_child_ids()),this.options.flat_mode,(replace_context?replace_context:this.context),this.context.default_parent_id||undefined]).done(callback?_.bind(callback,this,arguments):this.proxy('switch_new_message')).done(this.proxy('message_fetch_set_read'));},message_fetch_set_read:function(message_list){if(!this.context.mail_read_set_read)return;this.render_mutex.exec(_.bind(function(){msg_ids=_.pluck(message_list,'id');return this.ds_message.call('set_message_read',[msg_ids,true,false,this.context]);},this));},create_message_object:function(data){var self=this;var data=_.extend(data,{'thread_level':data.thread_level?data.thread_level:self.thread_level});data.options=_.extend(self.options,data.options);if(data.type=='expandable'){var message=new mail.ThreadExpandable(self,data,{'context':{'default_model':data.model||self.context.default_model,'default_res_id':data.res_id||self.context.default_res_id,'default_parent_id':self.id,}});}else{data.record_name=(data.record_name!=''&&data.record_name)||(self.parent_message&&self.parent_message.record_name);var message=new mail.ThreadMessage(self,data,{'context':{'default_model':data.model,'default_res_id':data.res_id,'default_parent_id':data.id,}});}
for(var i in self.messages){if(message.id&&self.messages[i]&&self.messages[i].id==message.id){self.messages[i].destroy();}}
self.messages.push(message);return message;},insert_message:function(message,dom_insert_after,prepend){var self=this;if(this.options.show_compact_message>this.thread_level){this.instantiate_compose_message();this.compose_message.do_show_compact();}
this.$('.oe_view_nocontent').remove();if(dom_insert_after){message.insertAfter(dom_insert_after);}else if(prepend){message.prependTo(self.$el);}else{message.appendTo(self.$el);}
message.$el.hide().fadeIn(500);return message},switch_new_message:function(records,dom_insert_after){var self=this;_(records).each(function(record){var thread=self.browse_thread({'id':record.parent_id,'default_return_top_thread':true});var message=thread.create_message_object(record);thread.insert_message(message,typeof dom_insert_after=='object'?dom_insert_after:false);});if(!records.length&&this.options.root_thread==this){this.no_message();}},on_message_detroy:function(message){this.messages=_.filter(this.messages,function(val){return!val.isDestroyed();});if(this.options.root_thread==this&&!this.messages.length){this.no_message();}
return false;},message_to_expandable:function(message){if(!this.thread_level||message.isDestroyed()){message.destroy();return false;}
var messages=_.sortBy(this.messages,function(val){return val.id;});var it=_.indexOf(messages,message);var msg_up=message.$el.prev('.oe_msg');var msg_down=message.$el.next('.oe_msg');var msg_up=msg_up.hasClass('oe_msg_expandable')?_.find(this.messages,function(val){return val.$el[0]==msg_up[0];}):false;var msg_down=msg_down.hasClass('oe_msg_expandable')?_.find(this.messages,function(val){return val.$el[0]==msg_down[0];}):false;var message_dom=[["id","=",message.id]];if(msg_up&&msg_up.type=="expandable"&&msg_down&&msg_down.type=="expandable"){msg_up.domain=mail.ChatterUtils.expand_domain(msg_up.domain);msg_down.domain=mail.ChatterUtils.expand_domain(msg_down.domain);msg_down.domain=['|','|'].concat(msg_up.domain).concat(message_dom).concat(msg_down.domain);if(!msg_down.max_limit){msg_down.nb_messages+=1+msg_up.nb_messages;}
msg_up.$el.remove();msg_up.destroy();msg_down.reinit();}else if(msg_up&&msg_up.type=="expandable"){msg_up.domain=mail.ChatterUtils.expand_domain(msg_up.domain);msg_up.domain=['|'].concat(msg_up.domain).concat(message_dom);msg_up.nb_messages++;msg_up.reinit();}else if(msg_down&&msg_down.type=="expandable"){msg_down.domain=mail.ChatterUtils.expand_domain(msg_down.domain);msg_down.domain=['|'].concat(msg_down.domain).concat(message_dom);if(!msg_down.max_limit){msg_down.nb_messages++;}
msg_down.reinit();}else{var expandable=new mail.ThreadExpandable(this,{'model':message.model,'parent_id':message.parent_id,'nb_messages':1,'thread_level':message.thread_level,'parent_id':message.parent_id,'domain':message_dom,'options':message.options,},{'context':{'default_model':message.model||this.context.default_model,'default_res_id':message.res_id||this.context.default_res_id,'default_parent_id':this.id,}});this.messages.push(expandable);expandable.insertAfter(message.$el);}
message.destroy();return true;},});session.web.client_actions.add('mail.Widget','session.mail.Widget');mail.Widget=session.web.Widget.extend({template:'mail.Root',init:function(parent,action){this._super(parent,action);var self=this;this.action=_.clone(action);this.domain=this.action.domain||this.action.params.domain||[];this.context=this.action.context||this.action.params.context||{};this.action.params=_.extend({'display_indented_thread':-1,'show_reply_button':false,'show_read_unread_button':false,'truncate_limit':250,'show_record_name':false,'show_compose_message':false,'show_compact_message':false,'compose_placeholder':false,'show_link':true,'view_inbox':false,'message_ids':undefined,'compose_as_todo':false,'readonly':false,'emails_from_on_composer':true,},this.action.params);this.action.params.help=this.action.help||false;},start:function(options){this._super.apply(this,arguments);this.message_render();this.bind_events();},message_render:function(search){this.thread=new mail.Thread(this,{},{'domain':this.domain,'context':this.context,'options':this.action.params,});this.thread.appendTo(this.$el);if(this.action.params.show_compose_message){this.thread.instantiate_compose_message();this.thread.compose_message.do_show_compact();}
this.thread.message_fetch(null,null,this.action.params.message_ids);},bind_events:function(){$(document).scroll(_.bind(this.thread.on_scroll,this.thread));$(window).resize(_.bind(this.thread.on_scroll,this.thread));this.$el.resize(_.bind(this.thread.on_scroll,this.thread));window.setTimeout(_.bind(this.thread.on_scroll,this.thread),500);},});session.web.form.widgets.add('mail_thread','openerp.mail.RecordThread');mail.RecordThread=session.web.form.AbstractField.extend({template:'mail.record_thread',init:function(parent,node){this._super.apply(this,arguments);this.node=_.clone(node);this.node.params=_.extend({'display_indented_thread':-1,'show_reply_button':false,'show_read_unread_button':true,'read_action':'unread','show_record_name':false,'show_compact_message':1,},this.node.params);if(this.node.attrs.placeholder){this.node.params.compose_placeholder=this.node.attrs.placeholder;}
if(this.node.attrs.readonly){this.node.params.readonly=this.node.attrs.readonly;}
this.domain=this.node.params&&this.node.params.domain||[];if(!this.__parentedParent.is_action_enabled('edit')){this.node.params.show_link=false;}},start:function(){this._super.apply(this,arguments);this.view.on("change:actual_mode",this,this._check_visibility);this._check_visibility();},_check_visibility:function(){this.$el.toggle(this.view.get("actual_mode")!=="create");},render_value:function(){var self=this;if(!this.view.datarecord.id||session.web.BufferedDataSet.virtual_id_regex.test(this.view.datarecord.id)){this.$('oe_mail_thread').hide();return;}
this.node.params=_.extend(this.node.params,{'message_ids':this.get_value(),'show_compose_message':this.view.is_action_enabled('edit'),});this.node.context={'mail_read_set_read':true,'default_res_id':this.view.datarecord.id||false,'default_model':this.view.model||false,};if(this.root){$('<span class="oe_mail-placeholder"/>').insertAfter(this.root.$el);this.root.destroy();}
this.root=new mail.Widget(this,_.extend(this.node,{'domain':(this.domain||[]).concat([['model','=',this.view.model],['res_id','=',this.view.datarecord.id]]),}));return this.root.replace(this.$('.oe_mail-placeholder'));},});session.web.client_actions.add('mail.wall','session.mail.Wall');mail.Wall=session.web.Widget.extend({template:'mail.wall',init:function(parent,action){this._super(parent,action);this.action=_.clone(action);this.domain=this.action.params.domain||this.action.domain||[];this.context=_.extend(this.action.params.context||{},this.action.context||{});this.defaults={};for(var key in this.context){if(key.match(/^search_default_/)){this.defaults[key.replace(/^search_default_/,'')]=this.context[key];}}
this.action.params=_.extend({'display_indented_thread':1,'show_reply_button':true,'show_read_unread_button':true,'show_compose_message':true,'show_record_name':true,'show_compact_message':this.action.params.view_mailbox?false:1,'view_inbox':false,'emails_from_on_composer':false,},this.action.params);},start:function(){this._super.apply(this);this.bind_events();var searchview_loaded=this.load_searchview(this.defaults);if(!this.searchview.has_defaults){this.message_render();}},do_reload_menu_emails:function(){var menu=this.__parentedParent.__parentedParent.menu;},load_searchview:function(defaults){var self=this;var ds_msg=new session.web.DataSetSearch(this,'mail.message');this.searchview=new session.web.SearchView(this,ds_msg,false,defaults||{},false);this.searchview.appendTo(this.$('.oe_view_manager_view_search')).then(function(){self.searchview.on('search_data',self,self.do_searchview_search);});if(this.searchview.has_defaults){this.searchview.ready.then(this.searchview.do_search);}
return this.searchview},do_searchview_search:function(domains,contexts,groupbys){var self=this;session.web.pyeval.eval_domains_and_contexts({domains:domains||[],contexts:contexts||[],group_by_seq:groupbys||[]}).then(function(results){if(self.root){$('<span class="oe_mail-placeholder"/>').insertAfter(self.root.$el);self.root.destroy();}
return self.message_render(results);});},message_render:function(search){var domain=this.domain.concat(search&&search['domain']?search['domain']:[]);var context=_.extend(this.context,search&&search['context']?search['context']:{});this.root=new mail.Widget(this,_.extend(this.action,{'domain':domain,'context':context,}));return this.root.replace(this.$('.oe_mail-placeholder'));},bind_events:function(){var self=this;this.$(".oe_write_full").click(function(event){event.stopPropagation();var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',action_from:'mail.ThreadComposeMessage',views:[[false,'form']],target:'new',context:{},};session.client.action_manager.do_action(action);});this.$(".oe_write_onwall").click(function(){self.root.thread.on_compose_message();});}});session.web.ComposeMessageTopButton=session.web.Widget.extend({template:'mail.ComposeMessageTopButton',start:function(){this.$('button').on('click',this.on_compose_message);this._super();},on_compose_message:function(event){event.stopPropagation();var action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{},};session.client.action_manager.do_action(action);},});session.web.UserMenu.include({do_update:function(){var self=this;this._super.apply(this,arguments);this.update_promise.then(function(){var mail_button=new session.web.ComposeMessageTopButton();mail_button.appendTo(session.webclient.$el.find('.oe_systray'));});},});};;openerp_mail_followers=function(session,mail){var _t=session.web._t,_lt=session.web._lt;var mail_followers=session.mail_followers={};session.web.form.widgets.add('mail_followers','openerp.mail_followers.Followers');mail_followers.Followers=session.web.form.AbstractField.extend({template:'mail.followers',init:function(){this._super.apply(this,arguments);this.image=this.node.attrs.image||'image_small';this.comment=this.node.attrs.help||false;this.displayed_limit=this.node.attrs.displayed_nb||10;this.displayed_nb=this.displayed_limit;this.ds_model=new session.web.DataSetSearch(this,this.view.model);this.ds_follow=new session.web.DataSetSearch(this,this.field.relation);this.ds_users=new session.web.DataSetSearch(this,'res.users');this.value=[];this.followers=[];this.view_is_editable=this.__parentedParent.is_action_enabled('edit');},start:function(){this.view.on("change:actual_mode",this,this.on_check_visibility_mode);this.on_check_visibility_mode();this.reinit();this.bind_events();this._super();},on_check_visibility_mode:function(){this.set({"force_invisible":this.view.get("actual_mode")=="create"});},set_value:function(_value){this.value=_value;this._super(_value);},reinit:function(){this.message_is_follower==undefined;this.display_buttons();},bind_events:function(){var self=this;this.$('.oe_follower').on('click',function(event){if($(this).hasClass('oe_notfollow'))
self.do_follow();else
self.do_unfollow();});this.$el.on('click','.oe_subtype_list input',self.do_update_subscription);this.$('.oe_invite').on('click',self.on_invite_follower);this.$el.on('click','.oe_remove_follower',self.on_remove_follower);this.$el.on('click','.oe_show_more',self.on_show_more_followers)},on_invite_follower:function(event){var self=this;var action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{'default_res_model':this.view.dataset.model,'default_res_id':this.view.datarecord.id,},}
this.do_action(action,{on_close:function(){self.read_value();},});},on_show_more_followers:function(event){this.displayed_nb+=this.displayed_limit;this.display_followers(false);},on_remove_follower:function(event){var partner_id=$(event.target).data('id');var context=new session.web.CompoundContext(this.build_context(),{});return this.ds_model.call('message_unsubscribe',[[this.view.datarecord.id],[partner_id],context]).then(this.proxy('read_value'));},read_value:function(){var self=this;this.displayed_nb=this.displayed_limit;return this.ds_model.read_ids([this.view.datarecord.id],['message_follower_ids']).then(function(results){self.value=results[0].message_follower_ids;self.render_value();});},render_value:function(){this.reinit();return this.fetch_followers(this.value);},fetch_followers:function(value_){this.value=value_||{};return this.ds_follow.call('read',[this.value,['name','user_ids']]).then(this.proxy('display_followers'),this.proxy('fetch_generic')).then(this.proxy('display_buttons')).then(this.proxy('fetch_subtypes'));},fetch_generic:function(error,event){var self=this;event.preventDefault();return this.ds_users.call('read',[this.session.uid,['partner_id']]).then(function(results){var pid=results['partner_id'][0];self.message_is_follower=(_.indexOf(self.value,pid)!=-1);}).then(self.proxy('display_generic'));},_format_followers:function(count){function _t(str){return str;}
var str='';if(count<=0){str=_t('No followers');}else if(count===1){str=_t('One follower');}else{str=''+count+' '+_t('followers');}
return str;},display_generic:function(){var self=this;var node_user_list=this.$('.oe_follower_list').empty();this.$('.oe_follower_title').html(this._format_followers(this.value.length));},display_followers:function(records){var self=this;this.followers=records||this.followers;this.message_is_follower=this.set_is_follower(this.followers);var node_user_list=this.$('.oe_follower_list').empty();this.$('.oe_follower_title').html(this._format_followers(this.followers.length));var truncated=this.followers.slice(0,this.displayed_nb);_(truncated).each(function(record){record.avatar_url=mail.ChatterUtils.get_image(self.session,'res.partner','image_small',record.id);$(session.web.qweb.render('mail.followers.partner',{'record':record,'widget':self})).appendTo(node_user_list);});if(truncated.length<this.followers.length){$(session.web.qweb.render('mail.followers.show_more',{'number':(this.followers.length-truncated.length)})).appendTo(node_user_list);}},set_is_follower:function(records){var user_ids=_.pluck(_.pluck(records,'user_ids'),0);return _.indexOf(user_ids,this.session.uid)!=-1;},display_buttons:function(){if(this.message_is_follower){this.$('button.oe_follower').removeClass('oe_notfollow').addClass('oe_following');}
else{this.$('button.oe_follower').removeClass('oe_following').addClass('oe_notfollow');}
if(this.view.is_action_enabled('edit'))
this.$('span.oe_mail_invite_wrapper').hide();else
this.$('span.oe_mail_invite_wrapper').show();},fetch_subtypes:function(){var self=this;var subtype_list_ul=this.$('.oe_subtype_list').empty();if(!this.message_is_follower)return;var id=this.view.datarecord.id;this.ds_model.call('message_get_subscription_data',[[id],new session.web.CompoundContext(this.build_context(),{})]).then(function(data){self.display_subtypes(data,id);});},display_subtypes:function(data,id){var self=this;var subtype_list_ul=this.$('.oe_subtype_list');var records=[];var nb_subtype=0;subtype_list_ul.empty();if(data[id]){records=data[id].message_subtype_data;}
_(records).each(function(record){nb_subtype++;});if(nb_subtype>1){this.$('hr').show();_(records).each(function(record,record_name){record.name=record_name;record.followed=record.followed||undefined;$(session.web.qweb.render('mail.followers.subtype',{'record':record})).appendTo(self.$('.oe_subtype_list'));});}else{this.$('hr').hide();}},do_follow:function(){var context=new session.web.CompoundContext(this.build_context(),{});this.ds_model.call('message_subscribe_users',[[this.view.datarecord.id],[this.session.uid],undefined,context]).then(this.proxy('read_value'));_.each(this.$('.oe_subtype_list input'),function(record){$(record).attr('checked','checked');});},do_unfollow:function(){_(this.$('.oe_msg_subtype_check')).each(function(record){$(record).attr('checked',false);});var context=new session.web.CompoundContext(this.build_context(),{});return this.ds_model.call('message_unsubscribe_users',[[this.view.datarecord.id],[this.session.uid],context]).then(this.proxy('read_value'));},do_update_subscription:function(event){var self=this;var checklist=new Array();_(this.$('.oe_actions input[type="checkbox"]')).each(function(record){if($(record).is(':checked')){checklist.push(parseInt($(record).data('id')));}});if(!checklist.length){this.do_unfollow();}else{var context=new session.web.CompoundContext(this.build_context(),{});return this.ds_model.call('message_subscribe_users',[[this.view.datarecord.id],[this.session.uid],checklist,context]).then(this.proxy('read_value'));}},});};;openerp_FieldMany2ManyTagsEmail=function(instance){var _t=instance.web._t;instance.web.form.FieldMany2ManyTagsEmail=instance.web.form.FieldMany2ManyTags.extend({start:function(){this.values=[];this.values_checking=[];this.on("change:value",this,this.on_change_value_check);this.trigger("change:value");this._super.apply(this,arguments);},on_change_value_check:function(){this.values=_.uniq(this.values);var values_removed=_.difference(this.values,this.get('value'));if(values_removed.length){this.values=_.difference(this.values,values_removed);this.set({'value':this.values});return false;}
var not_checked=_.difference(this.get('value'),this.values,this.values_checking);if(not_checked.length){this.values_checking=this.values_checking.concat(not_checked);this._check_email_popup(not_checked);}},_check_email_popup:function(ids){var self=this;new instance.web.Model('res.partner').call("search",[[["id","in",ids],["email","=",false],["notification_email_send","in",['all','comment']]]],{context:this.build_context()}).then(function(record_ids){var valid_partner=_.difference(ids,record_ids);self.values=self.values.concat(valid_partner);self.values_checking=_.difference(self.values_checking,valid_partner);_.each(record_ids,function(id){var pop=new instance.web.form.FormOpenPopup(self);pop.show_element('res.partner',id,self.build_context(),{title:_t("Please complete partner's informations and Email"),});pop.on('write_completed',self,function(){this.values.push(id);this.values_checking=_.without(this.values_checking,id);this.set({'value':this.values});});pop.on('closed',self,function(){this.values_checking=_.without(this.values_checking,id);this.set({'value':this.values});});});});},});instance.web.form.widgets=instance.web.form.widgets.extend({'many2many_tags_email':'instance.web.form.FieldMany2ManyTagsEmail',});};;openerp.edi=function(instance){var _t=instance.web._t;instance.edi={}
instance.edi.EdiImport=instance.web.Widget.extend({init:function(parent,url){this._super();this.url=url;},start:function(){if(!this.session.session_is_valid()){this.show_login();this.session.on_session_valid.add({callback:this.proxy('show_import'),unique:true,});}else{this.show_import();}},show_import:function(){this.destroy_content();this.do_import();},show_login:function(){this.destroy_content();this.login=new instance.web.Login(this);this.login.appendTo(this.$el);},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},do_import:function(){this.rpc('/edi/import_edi_url',{url:this.url}).done(this.on_imported).fail(this.on_imported_error);},on_imported:function(response){if('action'in response){this.rpc("/web/session/save_session_action",{the_action:response.action}).done(function(key){window.location="/#sa="+encodeURIComponent(key);});}
else{$('<div>').dialog({modal:true,title:'Import Successful!',buttons:{Ok:function(){$(this).dialog("close");window.location="/";}}}).html(_t('The document has been successfully imported!'));}},on_imported_error:function(response){var self=this;var msg=_t("Sorry, the document could not be imported.");if(response.data.message){msg+="\n "+_t("Reason:")+response.data.message;}
var params={error:response,message:msg};$(instance.web.qweb.render("CrashManager.warning",params)).dialog({title:_t("Document Import Notification"),modal:true,buttons:{Ok:function(){$(this).dialog("close");}}});}});instance.edi.edi_import=function(url){instance.session.session_bind().done(function(){new instance.edi.EdiImport(null,url).appendTo($("body").addClass('openerp'));});}};;openerp.account=function(instance){openerp.account.quickadd(instance);var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.account=instance.web.account||{};instance.web.views.add('tree_account_reconciliation','instance.web.account.ReconciliationListView');instance.web.account.ReconciliationListView=instance.web.ListView.extend({init:function(){this._super.apply(this,arguments);var self=this;this.current_partner=null;this.on('record_selected',this,function(){if(self.get_selected_ids().length===0){self.$(".oe_account_recon_reconcile").attr("disabled","");}else{self.$(".oe_account_recon_reconcile").removeAttr("disabled");}});},load_list:function(){var self=this;var tmp=this._super.apply(this,arguments);if(this.partners){this.$el.prepend(QWeb.render("AccountReconciliation",{widget:this}));this.$(".oe_account_recon_previous").click(function(){self.current_partner=(self.current_partner-1)%self.partners.length;self.search_by_partner();});this.$(".oe_account_recon_next").click(function(){self.current_partner=(self.current_partner+1)%self.partners.length;self.search_by_partner();});this.$(".oe_account_recon_reconcile").click(function(){self.reconcile();});this.$(".oe_account_recom_mark_as_reconciled").click(function(){self.mark_as_reconciled();});}
return tmp;},do_search:function(domain,context,group_by){var self=this;this.last_domain=domain;this.last_context=context;this.last_group_by=group_by;this.old_search=_.bind(this._super,this);var mod=new instance.web.Model("account.move.line",context,domain);return mod.call("list_partners_to_reconcile",[]).then(function(result){var current=self.current_partner!==null?self.partners[self.current_partner][0]:null;self.partners=result;var index=_.find(_.range(self.partners.length),function(el){if(current===self.partners[el][0])
return true;});if(index!==undefined)
self.current_partner=index;else
self.current_partner=self.partners.length==0?null:0;self.search_by_partner();});},search_by_partner:function(){var self=this;var fct=function(){return self.old_search(new instance.web.CompoundDomain(self.last_domain,[["partner_id","in",self.current_partner===null?[]:[self.partners[self.current_partner][0]]]]),self.last_context,self.last_group_by);};if(self.current_partner===null){self.last_reconciliation_date=_t("Never");return fct();}else{return new instance.web.Model("res.partner").call("read",[self.partners[self.current_partner][0],["last_reconciliation_date"]]).then(function(res){self.last_reconciliation_date=instance.web.format_value(res.last_reconciliation_date,{"type":"datetime"},_t("Never"));return fct();});}},reconcile:function(){var self=this;var ids=this.get_selected_ids();if(ids.length===0){instance.web.dialog($("<div />").text(_t("You must choose at least one record.")),{title:_t("Warning"),modal:true});return false;}
new instance.web.Model("ir.model.data").call("get_object_reference",["account","action_view_account_move_line_reconcile"]).then(function(result){var additional_context=_.extend({active_id:ids[0],active_ids:ids,active_model:self.model});return self.rpc("/web/action/load",{action_id:result[1],context:additional_context}).done(function(result){result.context=instance.web.pyeval.eval('contexts',[result.context,additional_context]);result.flags=result.flags||{};result.flags.new_window=true;return self.do_action(result,{on_close:function(){self.do_search(self.last_domain,self.last_context,self.last_group_by);}});});});},mark_as_reconciled:function(){var self=this;var id=self.partners[self.current_partner][0];new instance.web.Model("res.partner").call("mark_as_reconciled",[[id]]).then(function(){self.do_search(self.last_domain,self.last_context,self.last_group_by);});},do_select:function(ids,records){this.trigger('record_selected')
this._super.apply(this,arguments);},});};;openerp.account.quickadd=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.account=instance.web.account||{};instance.web.views.add('tree_account_move_line_quickadd','instance.web.account.QuickAddListView');instance.web.account.QuickAddListView=instance.web.ListView.extend({init:function(){this._super.apply(this,arguments);this.journals=[];this.periods=[];this.current_journal=null;this.current_period=null;this.default_period=null;this.default_journal=null;this.current_journal_type=null;this.current_journal_currency=null;this.current_journal_analytic=null;},start:function(){var tmp=this._super.apply(this,arguments);var self=this;this.$el.parent().prepend(QWeb.render("AccountMoveLineQuickAdd",{widget:this}));this.$el.parent().find('.oe_account_select_journal').change(function(){self.current_journal=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.$el.parent().find('.oe_account_select_period').change(function(){self.current_period=this.value===''?null:parseInt(this.value);self.do_search(self.last_domain,self.last_context,self.last_group_by);});this.on('edit:after',this,function(){self.$el.parent().find('.oe_account_select_journal').attr('disabled','disabled');self.$el.parent().find('.oe_account_select_period').attr('disabled','disabled');});this.on('save:after cancel:after',this,function(){self.$el.parent().find('.oe_account_select_journal').removeAttr('disabled');self.$el.parent().find('.oe_account_select_period').removeAttr('disabled');});var mod=new instance.web.Model("account.move.line",self.dataset.context,self.dataset.domain);mod.call("default_get",[['journal_id','period_id'],self.dataset.context]).then(function(result){self.current_period=result['period_id'];self.current_journal=result['journal_id'];});return tmp;},do_search:function(domain,context,group_by){var self=this;this.last_domain=domain;this.last_context=context;this.last_group_by=group_by;this.old_search=_.bind(this._super,this);var mod=new instance.web.Model("account.move.line",context,domain);return $.when(mod.call("list_journals",[]).then(function(result){self.journals=result;}),mod.call("list_periods",[]).then(function(result){self.periods=result;})).then(function(){var o;self.$el.parent().find('.oe_account_select_journal').children().remove().end();self.$el.parent().find('.oe_account_select_journal').append(new Option('',''));for(var i=0;i<self.journals.length;i++){o=new Option(self.journals[i][1],self.journals[i][0]);if(self.journals[i][0]===self.current_journal){self.current_journal_type=self.journals[i][2];self.current_journal_currency=self.journals[i][3];self.current_journal_analytic=self.journals[i][4];$(o).attr('selected',true);}
self.$el.parent().find('.oe_account_select_journal').append(o);}
self.$el.parent().find('.oe_account_select_period').children().remove().end();self.$el.parent().find('.oe_account_select_period').append(new Option('',''));for(var i=0;i<self.periods.length;i++){o=new Option(self.periods[i][1],self.periods[i][0]);self.$el.parent().find('.oe_account_select_period').append(o);}
self.$el.parent().find('.oe_account_select_period').val(self.current_period).attr('selected',true);return self.search_by_journal_period();});},search_by_journal_period:function(){var self=this;var domain=[];if(self.current_journal!==null)domain.push(["journal_id","=",self.current_journal]);if(self.current_period!==null)domain.push(["period_id","=",self.current_period]);self.last_context["journal_id"]=self.current_journal===null?false:self.current_journal;if(self.current_period===null)delete self.last_context["period_id"];else self.last_context["period_id"]=self.current_period;self.last_context["journal_type"]=self.current_journal_type;self.last_context["currency"]=self.current_journal_currency;self.last_context["analytic_journal_id"]=self.current_journal_analytic;return self.old_search(new instance.web.CompoundDomain(self.last_domain,domain),self.last_context,self.last_group_by);},});};;openerp.share=function(session){var _t=session.web._t;var has_action_id=false;function launch_wizard(self,view,user_type,invite){var action=view.getParent().action;var Share=new session.web.DataSet(self,'share.wizard',view.dataset.get_context());var domain=new session.web.CompoundDomain(view.dataset.domain);if(view.fields_view.type=='form'){domain=new session.web.CompoundDomain(domain,[['id','=',view.datarecord.id]]);}
if(view.fields_view.type=='form')rec_name=view.datarecord.name;else rec_name='';session.web.pyeval.eval_domains_and_contexts({domains:[domain],contexts:[view.dataset.context]}).done(function(result){Share.create({name:action.name,record_name:rec_name,domain:result.domain,action_id:action.id,user_type:user_type||'embedded',view_type:view.fields_view.type,invite:invite||false,}).done(function(share_id){var step1=Share.call('go_step_1',[[share_id]]).done(function(result){var action=result;self.do_action(action);});});});}
function has_share(yes,no){if(!session.session.share_flag){session.session.share_flag=$.Deferred(function(){var func=new session.web.Model("share.wizard").get_func("has_share");func(session.session.uid).then(function(res){if(res){session.session.share_flag.resolve();}else{session.session.share_flag.reject();}});});}
session.session.share_flag.done(yes).fail(no);}
session.web.Sidebar=session.web.Sidebar.extend({start:function(){var self=this;this._super(this);has_share(function(){self.add_items('other',[{label:_t('Share'),callback:self.on_click_share,classname:'oe_share'},{label:_t('Embed'),callback:self.on_click_share_link,classname:'oe_share'},]);});},on_click_share:function(item){var view=this.getParent()
launch_wizard(this,view,'emails',false);},on_click_share_link:function(item){var view=this.getParent()
launch_wizard(this,view,'embedded',false);},});session.mail.RecordThread.include({start:function(){start_res=this._super.apply(this,arguments);if(has_action_id){this.$el.find('button.oe_share_invite').show();}
return start_res;}});session.web.ViewManagerAction.include({start:function(){var self=this;this.check_if_action_is_defined();has_share(function(){self.$el.delegate('button.oe_share_invite','click',self.on_click_share_invite);});return this._super.apply(this,arguments);},check_if_action_is_defined:function(){if(this.action&&this.action.id){has_action_id=true;}
else{has_action_id=false;}},on_click_share_invite:function(e){e.preventDefault();launch_wizard(this,this.views[this.active_view].controller,'emails',true);},});};;openerp.auth_signup=function(instance){instance.auth_signup=instance.auth_signup||{};var _t=instance.web._t;instance.web.Login.include({start:function(){var self=this;var d=this._super();d.done(function(){self.$(".oe_signup_show").hide();self.$('a.oe_signup_signup').click(function(ev){if(ev){ev.preventDefault();}
self.$el.addClass("oe_login_signup");self.$(".oe_signup_show").show();self.$(".oe_signup_hide").hide();return false;});self.$('a.oe_signup_back').click(function(ev){if(ev){ev.preventDefault();}
self.$el.removeClass("oe_login_signup");self.$(".oe_signup_show").hide();self.$(".oe_signup_hide").show();delete self.params.token;return false;});var dblist=self.db_list||[];var dbname=self.params.db||(dblist.length===1?dblist[0]:null);if(self.params.error_message){self.show_error(self.params.error_message);delete self.params.error_message;}
if(dbname&&self.params.token){self.rpc("/auth_signup/retrieve",{dbname:dbname,token:self.params.token}).done(self.on_token_loaded).fail(self.on_token_failed)}
if(dbname&&self.params.login){self.$("form input[name=login]").val(self.params.login);}
self.$('a.oe_signup_reset_password').click(self.do_reset_password);self.$('a.oe_signup_signup').hide();self.$('a.oe_signup_reset_password').hide();if(dbname){self.rpc("/auth_signup/get_config",{dbname:dbname}).done(function(result){if(result.signup){self.$('a.oe_signup_signup').show();}
if(result.reset_password){self.$('a.oe_signup_reset_password').show();}});}});return d;},on_token_loaded:function(result){this.selected_db=result.db;this.on_db_loaded([result.db]);if(result.token){this.$el.addClass("oe_login_signup");self.$(".oe_signup_show").show();self.$(".oe_signup_hide").hide();this.$("form input[name=name]").val(result.name).attr("readonly","readonly");if(result.login){this.$("form input[name=login]").val(result.login).attr("readonly","readonly");}else{this.$("form input[name=login]").val(result.email);}}else{delete this.params.token;this.$("form input[name=login]").val(result.login||"");}},on_token_failed:function(result,ev){if(ev){ev.preventDefault();}
this.show_error(_t("Invalid signup token"));delete this.params.db;delete this.params.token;},on_submit:function(ev){if(ev){ev.preventDefault();}
if(this.$el.hasClass("oe_login_signup")){var db=this.$("form [name=db]").val();var name=this.$("form input[name=name]").val();var login=this.$("form input[name=login]").val();var password=this.$("form input[name=password]").val();var confirm_password=this.$("form input[name=confirm_password]").val();if(!db){this.do_warn(_t("Login"),_t("No database selected !"));return false;}else if(!name){this.do_warn(_t("Login"),_t("Please enter a name."));return false;}else if(!login){this.do_warn(_t("Login"),_t("Please enter a username."));return false;}else if(!password||!confirm_password){this.do_warn(_t("Login"),_t("Please enter a password and confirm it."));return false;}else if(password!==confirm_password){this.do_warn(_t("Login"),_t("Passwords do not match; please retype them."));return false;}
var params={dbname:db,token:this.params.token||"",name:name,login:login,password:password,};var self=this,super_=this._super;this.rpc('/auth_signup/signup',params).done(function(result){if(result.error){self.show_error(result.error);}else{super_.apply(self,[ev]);}});}else{this._super(ev);}},do_reset_password:function(ev){if(ev){ev.preventDefault();}
var db=this.$("form [name=db]").val();var login=this.$("form input[name=login]").val();if(!db){this.do_warn(_t("Login"),_t("No database selected !"));return false;}else if(!login){this.do_warn(_t("Login"),_t("Please enter a username or email address."))
return false;}
var params={dbname:db,login:login,};var url="/auth_signup/reset_password?"+$.param(params);window.location=url;},});};;openerp.portal_anonymous=function(instance){instance.web.Session.include({load_translations:function(){var self=this;var browser_lang=(navigator.language||navigator.userLanguage).replace('-','_');if(this.username==='anonymous'&&this.user_context.lang.indexOf(browser_lang)===-1){return(new instance.web.Model('res.lang')).query(['code','iso_code']).filter([['code','like',browser_lang.substring(0,2).toLowerCase()]]).all().then(function(langs){if(langs.length>0){var l=_.filter(langs,function(lang){return lang.code===browser_lang||lang.iso_code===browser_lang;});if(!_.isEmpty(l)){self.user_context.lang=l[0].code;}else{l=_.filter(langs,function(lang){return lang.iso_code===_.pluck(langs,'iso_code').sort(function(a,b){return a.length-b.length;})[0];});self.user_context.lang=l[0].code;}}
return self.rpc('/web/webclient/translations',{mods:self.module_list,lang:self.user_context.lang}).done(function(trans){instance.web._t.database.set_bundle(trans);});});}
return this._super();},});instance.web.Login.include({start:function(){var self=this;return $.when(this._super()).then(function(){var params=$.deparam($.param.querystring());var dblist=self.db_list||[];if(!self.session.session_is_valid()&&dblist.length===1&&(!params.token||!params.login)){self.remember_credentials=false;return self.do_login(dblist[0],'anonymous','anonymous');}});},});instance.web.UserMenu.include({init:function(parent){this._super(parent);if(this.session.username=='anonymous'){this.template='UserMenu.portal_anonymous';this.do_update=function(){};}},start:function(){var self=this;this._super.apply(this,arguments);this.$el.find('a.login').click(function(){var p=self.getParent();var am=p.action_manager;p.$el.find('.oe_leftbar').hide();am.do_action({type:'ir.actions.client',tag:'login',target:'current',params:{login_successful:function(){am.do_action("reload");}}});});}});instance.web.WebClient.include({check_timezone:function(){if(this.session.username!=='anonymous'){return this._super.apply(this,arguments);}
return false;},});};;openerp.web_tests=function(instance){instance.web.client_actions.add('buncha-forms','instance.web_tests.BunchaForms');instance.web_tests={};instance.web_tests.BunchaForms=instance.web.Widget.extend({init:function(parent){this._super(parent);this.dataset=new instance.web.DataSetSearch(this,'test.listview.relations');this.form=new instance.web.FormView(this,this.dataset,false,{action_buttons:false,pager:false});this.form.registry=instance.web.form.readonly;},render:function(){return'<div class="oe_bunchaforms"></div>';},start:function(){$.when(this.dataset.read_slice(),this.form.appendTo(this.$el)).done(this.on_everything_loaded);},on_everything_loaded:function(slice){var records=slice[0].records;if(!records.length){this.form.trigger("load_record",{});return;}
this.form.trigger("load_record",records[0]);_(records.slice(1)).each(function(record,index){this.dataset.index=index+1;this.form.reposition($('<div>').appendTo(this.$el));this.form.trigger("load_record",record);},this);}});};;openerp.web_tests_demo=function(instance){instance.web_tests_demo={value_true:true,SomeType:instance.web.Class.extend({init:function(value){this.value=value;}})};};;var _gaq=_gaq||[];openerp.web_analytics=function(instance){(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'===document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();instance.web_analytics.Tracker=instance.web.Class.extend({init:function(webclient){var self=this;self.initialized=$.Deferred();_gaq.push(['_setAccount','UA-7333765-1']);_gaq.push(['_setDomainName','.openerp.com']);self.initialize_custom(webclient).then(function(){webclient.on('state_pushed',self,self.on_state_pushed);self.include_tracker();});},_get_user_type:function(){return'Local User';},_get_user_access_level:function(){if(!instance.session.session_is_valid()){return"Unauthenticated User";}
if(instance.session.uid===1){return'Admin User';}
if(instance.session.username.indexOf('@')!==-1){return'Portal User';}
if(instance.session.username==='anonymous'){return'Anonymous User';}
return'Normal User';},initialize_custom:function(){var self=this;instance.session.rpc("/web/webclient/version_info",{}).done(function(res){_gaq.push(['_setCustomVar',5,'Version',res.server_version,3]);self._push_customvars();self.initialized.resolve(self);});return self.initialized;},_push_customvars:function(){var self=this;_gaq.push(['_setCustomVar',4,'User Access Level',self._get_user_access_level(),1]);_gaq.push(['_setCustomVar',1,'User Type Conversion',self._get_user_type(),2]);},_push_pageview:function(url){_gaq.push(['_trackPageview',url]);},_push_event:function(options){_gaq.push(['_trackEvent',options.category,options.action,options.label,options.value,options.noninteraction]);},_push_ecommerce:function(trans_data,item_list){_gaq.push(['_addTrans',trans_data.order_id,trans_data.store_name,trans_data.total,trans_data.tax,trans_data.shipping,trans_data.city,trans_data.state,trans_data.country,]);_.each(item_list,function(item){_gaq.push(['_addItem',item.order_id,item.sku,item.name,item.category,item.price,item.quantity,]);});_gaq.push(['_trackTrans']);},on_state_pushed:function(state){if(state.model&&state.view_type){var url=instance.web_analytics.generateUrl({'model':state.model,'view_type':state.view_type});this._push_event({'category':state.model,'action':state.view_type,'label':url,});this._push_pageview(url);}},include_tracker:function(){var t=this;instance.web.FormView.include({init:function(parent,dataset,view_id,options){this._super.apply(this,arguments);var self=this;this.on('record_created',self,function(r){var url=instance.web_analytics.generateUrl({'model':self.model,'view_type':'form'});t._push_event({'category':self.model,'action':'create','label':url,'noninteraction':true,});});this.on('record_saved',self,function(r){var url=instance.web_analytics.generateUrl({'model':self.model,'view_type':'form'});t._push_event({'category':self.model,'action':'save','label':url,'noninteraction':true,});});}});instance.web.ActionManager.include({ir_actions_client:function(action,options){var url=instance.web_analytics.generateUrl({'action':action.tag});t._push_event({'category':action.type,'action':action.tag,'label':url,});t._push_pageview(url);return this._super.apply(this,arguments);},});instance.web.View.include({do_execute_action:function(action_data,dataset,record_id,on_closed){var category=this.model||dataset.model||'';var action;if(action_data.name&&_.isNaN(action_data.name-0)){action=action_data.name;}else{action=action_data.string||action_data.special||'';}
var url=instance.web_analytics.generateUrl({'model':category,'view_type':this.view_type});t._push_event({'category':category,'action':action,'label':url,'noninteraction':true,});return this._super.apply(this,arguments);},});instance.web.CrashManager.include({show_error:function(error){var hash=window.location.hash;var params=$.deparam(hash.substr(hash.indexOf('#')+1));var options={};if(params.model&&params.view_type){options={'model':params.model,'view_type':params.view_type};}else{options={'action':params.action};}
var url=instance.web_analytics.generateUrl(options);t._push_event({'category':options.model||"ir.actions.client",'action':"error "+(error.code?error.message+error.data.message:error.type+error.data.debug),'label':url,'noninteraction':true,});this._super.apply(this,arguments);},});},});instance.web_analytics.generateUrl=function(options){var url='';var keys=_.keys(options);keys=_.sortBy(keys,function(i){return i;});_.each(keys,function(key){url+='/'+key+'/'+options[key];});return url;};instance.web_analytics.setupTracker=function(wc){return wc.tracker.initialized;};instance.web.Client.include({bind_events:function(){this._super.apply(this,arguments);this.tracker=new instance.web_analytics.Tracker(this);},});instance.web.Session.include({session_authenticate:function(){return $.when(this._super.apply(this,arguments)).then(function(){if(instance.client&&instance.client.tracker){instance.client.tracker._push_customvars();}});},});};;openerp.pad=function(instance){instance.web.form.FieldPad=instance.web.form.AbstractField.extend({template:'FieldPad',configured:false,content:"",start:function(){this._super();var self=this;this.on('change:effective_readonly',this,function(){self.renderElement();});},render_value:function(){var self=this;var _super=_.bind(this._super,this);if(this.get("value")===false||this.get("value")===""){self.view.dataset.call('pad_generate_url',{context:{model:self.view.model,field_name:self.name,object_id:self.view.datarecord.id}}).done(function(data){if(data&&data.url){self.set({value:data.url});_super(data.url);self.renderElement();}});}else{self.renderElement();}
this._dirty_flag=true;},renderElement:function(){var self=this;var value=this.get('value');if(this.pad_loading_request){this.pad_loading_request.abort();}
if(!_.str.startsWith(value,'http')){this.configured=false;this.content="";}else{this.configured=true;if(!this.get('effective_readonly')){this.content='<iframe width="100%" height="100%" frameborder="0" src="'+value+'?showChat=false&userName='+this.session.username+'"></iframe>';}else{this.content='<div class="oe_pad_loading">... Loading pad ...</div>';this.pad_loading_request=$.get(value+'/export/html').done(function(data){groups=/\<\s*body\s*\>(.*?)\<\s*\/body\s*\>/.exec(data);data=(groups||[]).length>=2?groups[1]:'';self.$('.oe_pad_content').html('<div class="oe_pad_readonly"><div>');self.$('.oe_pad_readonly').html(data);}).error(function(){self.$('.oe_pad_content').text('Unable to load pad');});}}
this._super();this.$('.oe_pad_content').html(this.content);this.$('.oe_pad_switch').click(function(){self.$el.toggleClass('oe_pad_fullscreen');});},});instance.web.form.widgets=instance.web.form.widgets.extend({'pad':'instance.web.form.FieldPad',});};;openerp.document=function(instance){_t=instance.web._t;instance.web.Sidebar.include({init:function(){this._super.apply(this,arguments);this.sections.splice(1,0,{'name':'files','label':_t('Attachment(s)'),});this.items['files']=[];},on_attachments_loaded:function(attachments){var self=this;_.chain(attachments.reverse()).groupBy(function(attachment){return attachment.name}).each(function(attachment){if(attachment.length>1)
_.map(attachment,function(attachment,i){attachment.name=_.str.sprintf(_t("%s (%s)"),attachment.name,i+1)})})
self._super(attachments);},});};;openerp.google_docs=function(instance,m){var _t=instance.web._t,QWeb=instance.web.qweb;instance.web.Sidebar.include({redraw:function(){var self=this;this._super.apply(this,arguments);self.$el.find('.oe_sidebar_add_attachment').after(QWeb.render('AddGoogleDocumentItem',{widget:self}))
self.$el.find('.oe_sidebar_add_google_doc').on('click',function(e){self.on_google_doc();});},on_google_doc:function(){var self=this;var view=self.getParent();var ids=(view.fields_view.type!="form")?view.groups.get_selection().ids:[view.datarecord.id];if(!_.isEmpty(ids)){view.sidebar_eval_context().done(function(context){var ds=new instance.web.DataSet(this,'ir.attachment',context);ds.call('google_doc_get',[view.dataset.model,ids,context]).done(function(r){if(r=='False'){var params={error:response,message:_t("The user google credentials are not set yet. Contact your administrator for help.")}
$(openerp.web.qweb.render("DialogWarning",params)).dialog({title:_t("User Google credentials are not yet set."),modal:true,});}}).done(function(r){window.open(r.url,"_blank");view.reload();});});}}});};;openerp.web_shortcuts=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t;instance.web_shortcuts.Shortcuts=instance.web.Widget.extend({template:'Systray.Shortcuts',init:function(){this._super();this.on('load',this,this.load);this.on('add',this,this.add);this.on('display',this,this.display);this.on('remove',this,this.remove);this.on('click',this,this.click);this.model=new instance.web.Model('ir.ui.view_sc');},start:function(){var self=this;this._super();this.trigger('load');this.$el.on('click','.oe_systray_shortcuts_items a',function(){self.trigger('click',$(this));});},load:function(){var self=this;this.$el.find('.oe_systray_shortcuts_items').empty();return this.model.call('get_sc',[instance.session.uid,'ir.ui.menu',instance.web.pyeval.eval('context',{})]).done(function(shortcuts){_.each(shortcuts,function(sc){self.trigger('display',sc);});});},add:function(sc){var self=this;this.model.call('create',[sc]).then(function(out){self.trigger('load');});},display:function(sc){var self=this;this.$el.find('.oe_systray_shortcuts_items').append();var $sc=$(QWeb.render('Systray.Shortcuts.Item',{'shortcut':sc}));$sc.appendTo(self.$el.find('.oe_systray_shortcuts_items'));},remove:function(menu_id){var menu_id=this.session.active_id;var $shortcut=this.$el.find('.oe_systray_shortcuts_items li a[data-id='+menu_id+']');var shortcut_id=$shortcut.data('shortcut-id');$shortcut.remove();this.model.call('unlink',[shortcut_id]);},click:function($link){var self=this,id=$link.data('id');self.session.active_id=id;self.rpc('/web/menu/action',{'menu_id':id}).done(function(ir_menu_data){if(ir_menu_data.action.length){instance.webclient.on_menu_action({action_id:ir_menu_data.action[0][2].id});}});this.$el.find('.oe_systray_shortcuts').trigger('mouseout');},has:function(menu_id){return!!this.$el.find('a[data-id='+menu_id+']').length;}});instance.web.UserMenu.include({do_update:function(){var self=this;this._super.apply(this,arguments);this.update_promise.done(function(){if(self.shortcuts){self.shortcuts.trigger('load');}else{self.shortcuts=new instance.web_shortcuts.Shortcuts(self);self.shortcuts.appendTo(instance.webclient.$el.find('.oe_systray'));}});},});instance.web.ViewManagerAction.include({switch_mode:function(view_type,no_store){var self=this;this._super.apply(this,arguments).done(function(){self.shortcut_check(self.views[view_type]);});},shortcut_check:function(view){var self=this;var shortcuts_menu=instance.webclient.user_menu.shortcuts;var grandparent=this.getParent()&&this.getParent().getParent();var $shortcut_toggle=this.$el.find('.oe_shortcuts_toggle');if(!this.action.name||!(view.view_type===this.views_src[0].view_type&&view.view_id===this.views_src[0].view_id)){$shortcut_toggle.hide();return;}
if(shortcuts_menu){$shortcut_toggle.toggleClass('oe_shortcuts_remove',shortcuts_menu.has(self.session.active_id));$shortcut_toggle.unbind("click").click(function(){if($shortcut_toggle.hasClass("oe_shortcuts_remove")){shortcuts_menu.trigger('remove',self.session.active_id);}else{shortcuts_menu.trigger('add',{'user_id':self.session.uid,'res_id':self.session.active_id,'resource':'ir.ui.menu','name':self.action.name});}
$shortcut_toggle.toggleClass("oe_shortcuts_remove");});}}});};;openerp.project=function(openerp){openerp.web_kanban.KanbanView.include({project_display_members_names:function(){var self=this;var members_ids=[];self.$el.find('img[data-member_id]').each(function(){members_ids.push($(this).data('member_id'));});var dataset=new openerp.web.DataSetSearch(self,'res.users',self.session.context,[['id','in',_.uniq(members_ids)]]);dataset.read_slice(['id','name']).done(function(result){_.each(result,function(v,k){self.$el.find('img[data-member_id='+v.id+']').attr('title',v.name).tipsy({offset:10});});});},on_groups_started:function(){var self=this;self._super.apply(self,arguments);if(self.dataset.model==='project.project'){self.project_display_members_names();}},on_record_moved:function(record,old_group,old_index,new_group,new_index){var self=this;this._super.apply(this,arguments);if(new_group.state.folded)
new_group.do_action_toggle_fold();}});openerp.web_kanban.KanbanRecord.include({on_card_clicked:function(){if(this.view.dataset.model==='project.project'){this.$('.oe_kanban_project_list a').first().click();}else{this._super.apply(this,arguments);}},});};;openerp.auth_openid=function(instance){var QWeb=instance.web.qweb;instance.web.Login=instance.web.Login.extend({start:function(){var self=this;var d=self._super.apply(this,arguments).done(function(){self._default_error_message=self.$el.find('.oe_login_error_message').text();self.$openid_selected_button=$();self.$openid_selected_input=$();self.$openid_selected_provider=null;var openIdProvider=null;if(self.has_local_storage&&self.remember_credentials){openIdProvider=localStorage.getItem('openid-provider');}
if(openIdProvider){$openid_selected_provider=openIdProvider;self.do_openid_select('a[href="#'+openIdProvider+'"]',openIdProvider,true);if(self.has_local_storage&&self.remember_credentials){self.$openid_selected_input.find('input').val(localStorage.getItem('openid-login'));}}
else{self.do_openid_select('a[data-url=""]','login,password',true);}
self.$el.find('a[data-url]').click(function(event){event.preventDefault();var selected_oidh=$(this).attr('href').substr(1);if(selected_oidh!=self.$openid_selected_provider){self.do_openid_select(this,selected_oidh);}});self._check_error();});return d;},do_openid_select:function(button,provider,noautosubmit){var self=this;self.$openid_selected_button.add(self.$openid_selected_input).removeClass('selected');self.$openid_selected_button=self.$el.find(button).addClass('selected');var input=_(provider.split(',')).map(function(p){return'li[data-provider="'+p+'"]';}).join(',');self.$openid_selected_input=self.$el.find(input).addClass('selected');self.$openid_selected_input.find('input:first').focus();self.$openid_selected_provider=(self.$openid_selected_button.attr('href')||'').substr(1);if(self.has_local_storage&&self.remember_credentials){localStorage.setItem('openid-provider',self.$openid_selected_provider);}
if(!noautosubmit&&self.$openid_selected_input.length==0){self.$el.find('form').submit();}},_check_error:function(){var self=this;if(this.params.loginerror!==undefined){this.rpc('/auth_openid/login/status',{}).done(function(result){if(_.contains(['success','failure'],result.status)&&result.message){self.do_warn('Invalid OpenID Login',result.message);}
if(result.status==='setup_needed'&&result.message){window.location.replace(result.message);}});}},on_submit:function(ev){var dataurl=this.$openid_selected_button.attr('data-url');if(!dataurl){this.reset_error_message();this._super(ev);}else{ev.preventDefault();var id=this.$openid_selected_input.find('input').val();if(this.has_local_storage&&this.remember_credentials){localStorage.setItem('openid-login',id);}
var db=this.$el.find("form [name=db]").val();var openid_url=dataurl.replace('{id}',id);this.do_openid_login(db,openid_url);}},do_openid_login:function(db,openid_url){var self=this;this.rpc('/auth_openid/login/verify',{'db':db,'url':openid_url}).done(function(result){if(result.error){self.do_warn(result.title,result.error);return;}
if(result.session_id){self.session.set_cookie('session_id',result.session_id);}
if(result.action==='post'){document.open();document.write(result.value);document.close();}else if(result.action==='redirect'){window.location.replace(result.value);}else{}});},do_warn:function(title,msg){this.$el.find('.oe_login_error_message').text(msg).show();this._super(title,msg);},reset_error_message:function(){this.$el.find('.oe_login_error_message').text(this._default_error_message);}});};;openerp.hr_attendance=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;var _lt=instance.web._lt;instance.hr_attendance.AttendanceSlider=instance.web.Widget.extend({template:'AttendanceSlider',init:function(parent){this._super(parent);this.set({"signed_in":false});},start:function(){var self=this;var tmp=function(){this.$el.toggleClass("oe_attendance_nosigned",!this.get("signed_in"));this.$el.toggleClass("oe_attendance_signed",this.get("signed_in"));};this.on("change:signed_in",this,tmp);_.bind(tmp,this)();this.$(".oe_attendance_signin").click(function(){self.do_update_attendance();});this.$(".oe_attendance_signout").click(function(){self.do_update_attendance();});this.$el.tipsy({title:function(){var last_text=instance.web.format_value(self.last_sign,{type:"datetime"});var current_text=instance.web.format_value(new Date(),{type:"datetime"});var duration=self.last_sign?$.timeago(self.last_sign):"none";if(self.get("signed_in")){return _.str.sprintf(_t("Last sign in: %s,<br />%s.<br />Click to sign out."),last_text,duration);}else{return _.str.sprintf(_t("Click to Sign In at %s."),current_text);}},html:true,});return this.check_attendance();},do_update_attendance:function(){var self=this;var hr_employee=new instance.web.DataSet(self,'hr.employee');hr_employee.call('attendance_action_change',[[self.employee.id]]).done(function(result){self.last_sign=new Date();self.set({"signed_in":!self.get("signed_in")});});},check_attendance:function(){var self=this;self.employee=false;this.$el.hide();var employee=new instance.web.DataSetSearch(self,'hr.employee',self.session.user_context,[['user_id','=',self.session.uid]]);return employee.read_slice(['id','name','state','last_sign','attendance_access']).then(function(res){if(_.isEmpty(res))
return;if(res[0].attendance_access===false){return;}
self.$el.show();self.employee=res[0];self.last_sign=instance.web.str_to_datetime(self.employee.last_sign);self.set({"signed_in":self.employee.state!=="absent"});});},});instance.web.UserMenu.include({do_update:function(){this._super();var self=this;this.update_promise.done(function(){if(!_.isUndefined(self.attendanceslider)){return;}
var Users=new instance.web.Model('res.users');Users.call('has_group',['base.group_user']).done(function(is_employee){if(is_employee){self.attendanceslider=new instance.hr_attendance.AttendanceSlider(self);self.attendanceslider.prependTo(instance.webclient.$('.oe_systray'));}else{self.attendanceslider=null;}});});},});};;(function($){if(typeof $.fn.each2=="undefined"){$.fn.extend({each2:function(c){var j=$([0]),i=-1,l=this.length;while(++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==false);return this;}});}})(jQuery);(function($,undefined){"use strict";if(window.Select2!==undefined){return;}
var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer;KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return true;}
return false;},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return true;}
if(e.metaKey)return true;return false;},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&k<=123;}};nextUid=(function(){var counter=1;return function(){return counter++;};}());function indexOf(value,array){var i=0,l=array.length,v;if(typeof value==="undefined"){return-1;}
if(value.constructor===String){for(;i<l;i=i+1)if(value.localeCompare(array[i])===0)return i;}else{for(;i<l;i=i+1){v=array[i];if(v.constructor===String){if(v.localeCompare(value)===0)return i;}else{if(v===value)return i;}}}
return-1;}
function equal(a,b){if(a===b)return true;if(a===undefined||b===undefined)return false;if(a===null||b===null)return false;if(a.constructor===String)return a.localeCompare(b)===0;if(b.constructor===String)return b.localeCompare(a)===0;return false;}
function splitVal(string,separator){var val,i,l;if(string===null||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;i<l;i=i+1)val[i]=$.trim(val[i]);return val;}
function getSideBorderPadding(element){return element.outerWidth()-element.width();}
function installKeyUpChangeEvent(element){var key="keyup-change-value";element.bind("keydown",function(){if($.data(element,key)===undefined){$.data(element,key,element.val());}});element.bind("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change");}});}
$(document).delegate("*","mousemove",function(e){$.data(document,"select2-lastpos",{x:e.pageX,y:e.pageY});});function installFilteredMouseMove(element){element.bind("mousemove",function(e){var lastpos=$.data(document,"select2-lastpos");if(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY){$(e.target).trigger("mousemove-filtered",e);}});}
function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout);timeout=window.setTimeout(function(){fn.apply(ctx,args);},quietMillis);};}
function thunk(formula){var evaluated=false,value;return function(){if(evaluated===false){value=formula();evaluated=true;}
return value;};};function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e);});element.bind("scroll",function(e){if(indexOf(e.target,element.get())>=0)notify(e);});}
function killEvent(event){event.preventDefault();event.stopPropagation();}
function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});$("body").append(sizer);}
sizer.text(e.val());return sizer.width();}
function markMatch(text,term,markup){var match=text.toUpperCase().indexOf(term.toUpperCase()),tl=term.length;if(match<0){markup.push(text);return;}
markup.push(text.substring(0,match));markup.push("<span class='select2-match'>");markup.push(text.substring(match,match+tl));markup.push("</span>");markup.push(text.substring(match+tl,text.length));}
function ajax(options){var timeout,requestSequence=0,handler=null,quietMillis=options.quietMillis||100;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){requestSequence+=1;var requestNumber=requestSequence,data=options.data,transport=options.transport||$.ajax,traditional=options.traditional||false,type=options.type||'GET';data=data.call(this,query.term,query.page,query.context);if(null!==handler){handler.abort();}
handler=transport.call(null,{url:options.url,dataType:options.dataType,data:data,type:type,traditional:traditional,success:function(data){if(requestNumber<requestSequence){return;}
var results=options.results(data,query.page);query.callback(results);}});},quietMillis);};}
function local(options){var data=options,dataText,text=function(item){return""+item.text;};if(!$.isArray(data)){text=data.text;if(!$.isFunction(text)){dataText=data.text;text=function(item){return item[dataText];};}
data=data.results;}
return function(query){var t=query.term,filtered={results:[]},process;if(t===""){query.callback({results:data});return;}
process=function(datum,collection){var group,attr;datum=datum[0];if(datum.children){group={};for(attr in datum){if(datum.hasOwnProperty(attr))group[attr]=datum[attr];}
group.children=[];$(datum.children).each2(function(i,childDatum){process(childDatum,group.children);});if(group.children.length){collection.push(group);}}else{if(query.matcher(t,text(datum))){collection.push(datum);}}};$(data).each2(function(i,datum){process(datum,filtered.results);});query.callback(filtered);};}
function tags(data){if($.isFunction(data)){return data;}
return function(query){var t=query.term,filtered={results:[]};$(data).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;if(t===""||query.matcher(t,text)){filtered.results.push(isObject?this:{id:this,text:this});}});query.callback(filtered);};}
function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return true;if(!formatter)return false;throw new Error("formatterName must be a function or a falsy value");}
function evaluate(val){return $.isFunction(val)?val():val;}
function countResults(results){var count=0;$.each(results,function(i,item){if(item.children){count+=countResults(item.children);}else{count++;}});return count;}
function defaultTokenizer(input,selection,selectCallback,opts){var original=input,dupe=false,token,index,i,l,separator;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;while(true){index=-1;for(i=0,l=opts.tokenSeparators.length;i<l;i++){separator=opts.tokenSeparators[i];index=input.indexOf(separator);if(index>=0)break;}
if(index<0)break;token=input.substring(0,index);input=input.substring(index+separator.length);if(token.length>0){token=opts.createSearchChoice(token,selection);if(token!==undefined&&token!==null&&opts.id(token)!==undefined&&opts.id(token)!==null){dupe=false;for(i=0,l=selection.length;i<l;i++){if(equal(opts.id(token),opts.id(selection[i]))){dupe=true;break;}}
if(!dupe)selectCallback(token);}}}
if(original.localeCompare(input)!=0)return input;}
$(document).ready(function(){$(document).delegate("*","mousedown touchend",function(e){var target=$(e.target).closest("div.select2-container").get(0),attr;if(target){$(document).find("div.select2-container-active").each(function(){if(this!==target)$(this).data("select2").blur();});}else{target=$(e.target).closest("div.select2-drop").get(0);$(document).find("div.select2-drop-active").each(function(){if(this!==target)$(this).data("select2").blur();});}
target=$(e.target);attr=target.attr("for");if("LABEL"===e.target.tagName&&attr&&attr.length>0){target=$("#"+attr);target=target.data("select2");if(target!==undefined){target.focus();e.preventDefault();}}});});function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor;}
AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments);};},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;if(opts.element.data("select2")!==undefined&&opts.element.data("select2")!==null){this.destroy();}
this.enabled=true;this.container=this.createContainer();this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,'\\$1');this.container.attr("id",this.containerId);this.body=thunk(function(){return opts.element.closest("body");});if(opts.element.attr("class")!==undefined){this.container.addClass(opts.element.attr("class").replace(/validate\[[\S ]+] ?/,''));}
this.container.css(evaluate(opts.containerCss));this.container.addClass(evaluate(opts.containerCssClass));this.opts.element.data("select2",this).hide().before(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.addClass(evaluate(opts.dropdownCssClass));this.dropdown.data("select2",this);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");search.attr("tabIndex",this.opts.element.attr("tabIndex"));this.resultsPage=0;this.context=null;this.initContainer();this.initContainerWidth();installFilteredMouseMove(this.results);this.dropdown.delegate(resultsSelector,"mousemove-filtered",this.bind(this.highlightUnderEvent));installDebouncedScroll(80,this.results);this.dropdown.delegate(resultsSelector,"scroll-debounced",this.bind(this.loadMoreIfNeeded));if($.fn.mousewheel){results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop(),height;if(deltaY>0&&top-deltaY<=0){results.scrollTop(0);killEvent(e);}else if(deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e);}});}
installKeyUpChangeEvent(search);search.bind("keyup-change",this.bind(this.updateResults));search.bind("focus",function(){search.addClass("select2-focused");if(search.val()===" ")search.val("");});search.bind("blur",function(){search.removeClass("select2-focused");});this.dropdown.delegate(resultsSelector,"mouseup",this.bind(function(e){if($(e.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e);}else{this.focusSearch();}
killEvent(e);}));this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation();});if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource();}
if(opts.element.is(":disabled")||opts.element.is("[readonly='readonly']"))this.disable();},destroy:function(){var select2=this.opts.element.data("select2");if(select2!==undefined){select2.container.remove();select2.dropdown.remove();select2.opts.element.removeData("select2").unbind(".select2").show();}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl;element=opts.element;if(element.get(0).tagName.toLowerCase()==="select"){this.select=select=opts.element;}
if(select){$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");}});}
opts=$.extend({},{populateResults:function(container,results,query){var populate,data,result,children,id=this.opts.id,self=this;populate=function(results,container,depth){var i,l,result,selectable,compound,node,label,innerContainer,formatted;for(i=0,l=results.length;i<l;i=i+1){result=results[i];selectable=id(result)!==undefined;compound=("children"in result)&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");if(compound){node.addClass("select2-result-with-children");}
node.addClass(self.opts.formatResultCssClass(result));label=$("<div></div>");label.addClass("select2-result-label");formatted=opts.formatResult(result,label,query);if(formatted!==undefined){label.html(self.opts.escapeMarkup(formatted));}
node.append(label);if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer);}
node.data("select2-data",result);container.append(node);}};populate(results,container,0);}},$.fn.select2.defaults,opts);if(typeof(opts.id)!=="function"){idKey=opts.id;opts.id=function(e){return e[idKey];};}
if(select){opts.query=this.bind(function(query){var data={results:[],more:false},term=query.term,children,firstChild,process;process=function(element,collection){var group;if(element.is("option")){if(query.matcher(term,element.text(),element)){collection.push({id:element.attr("value"),text:element.text(),element:element.get(),css:element.attr("class")});}}else if(element.is("optgroup")){group={text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")};element.children().each2(function(i,elm){process(elm,group.children);});if(group.children.length>0){collection.push(group);}}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){firstChild=children[0];if($(firstChild).text()===""){children=children.not(firstChild);}}
children.each2(function(i,elm){process(elm,data.results);});query.callback(data);});opts.id=function(e){return e.id;};opts.formatResultCssClass=function(data){return data.css;}}else{if(!("query"in opts)){if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");if(ajaxUrl&&ajaxUrl.length>0){opts.ajax.url=ajaxUrl;}
opts.query=ajax(opts.ajax);}else if("data"in opts){opts.query=local(opts.data);}else if("tags"in opts){opts.query=tags(opts.tags);opts.createSearchChoice=function(term){return{id:term,text:term};};opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var id=this,text=this,tags=opts.tags;if($.isFunction(tags))tags=tags();$(tags).each(function(){if(equal(this.id,id)){text=this.text;return false;}});data.push({id:id,text:text});});callback(data);};}}}
if(typeof(opts.query)!=="function"){throw"query function not defined for Select2 "+opts.element.attr("id");}
return opts;},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection();}}));},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange)
this.opts.element.blur();},enable:function(){if(this.enabled)return;this.enabled=true;this.container.removeClass("select2-container-disabled");},disable:function(){if(!this.enabled)return;this.close();this.enabled=false;this.container.addClass("select2-container-disabled");},opened:function(){return this.container.hasClass("select2-dropdown-open");},positionDropdown:function(){var offset=this.container.offset(),height=this.container.outerHeight(),width=this.container.outerWidth(),dropHeight=this.dropdown.outerHeight(),viewportBottom=$(window).scrollTop()+document.documentElement.clientHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=(offset.top-dropHeight)>=this.body().scrollTop(),aboveNow=this.dropdown.hasClass("select2-drop-above"),bodyOffset,above,css;if(this.body().css('position')!=='static'){bodyOffset=this.body().offset();dropTop-=bodyOffset.top;dropLeft-=bodyOffset.left;}
if(aboveNow){above=true;if(!enoughRoomAbove&&enoughRoomBelow)above=false;}else{above=false;if(!enoughRoomBelow&&enoughRoomAbove)above=true;}
if(above){dropTop=offset.top-dropHeight;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above");}
else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");}
css=$.extend({top:dropTop,left:dropLeft,width:width},evaluate(this.opts.dropdownCss));this.dropdown.css(css);},shouldOpen:function(){var event;if(this.opened())return false;event=jQuery.Event("open");this.opts.element.trigger(event);return!event.isDefaultPrevented();},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");},open:function(){if(!this.shouldOpen())return false;window.setTimeout(this.bind(this.opening),1);return true;},opening:function(){var cid=this.containerId,selector=this.containerSelector,scroll="scroll."+cid,resize="resize."+cid;this.container.parents().each(function(){$(this).bind(scroll,function(){var s2=$(selector);if(s2.length==0){$(this).unbind(scroll);}
s2.select2("close");});});$(window).bind(resize,function(){var s2=$(selector);if(s2.length==0){$(window).unbind(resize);}
s2.select2("close");});this.clearDropdownAlignmentPreference();if(this.search.val()===" "){this.search.val("");}
this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.updateResults(true);if(this.dropdown[0]!==this.body().children().last()[0]){this.dropdown.detach().appendTo(this.body());}
this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");this.ensureHighlightVisible();this.focusSearch();},close:function(){if(!this.opened())return;var self=this;this.container.parents().each(function(){$(this).unbind("scroll."+self.containerId);});$(window).unbind("resize."+this.containerId);this.clearDropdownAlignmentPreference();this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();this.clearSearch();this.opts.element.trigger(jQuery.Event("close"));},clearSearch:function(){},ensureHighlightVisible:function(){var results=this.results,children,index,child,hb,rb,y,more;index=this.highlight();if(index<0)return;if(index==0){results.scrollTop(0);return;}
children=results.find(".select2-result-selectable");child=$(children[index]);hb=child.offset().top+child.outerHeight();if(index===children.length-1){more=results.find("li.select2-more-results");if(more.length>0){hb=more.offset().top+more.outerHeight();}}
rb=results.offset().top+results.outerHeight();if(hb>rb){results.scrollTop(results.scrollTop()+(hb-rb));}
y=child.offset().top-results.offset().top;if(y<0){results.scrollTop(results.scrollTop()+y);}},moveHighlight:function(delta){var choices=this.results.find(".select2-result-selectable"),index=this.highlight();while(index>-1&&index<choices.length){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")){this.highlight(index);break;}}},highlight:function(index){var choices=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0){return indexOf(choices.filter(".select2-highlighted")[0],choices.get());}
if(index>=choices.length)index=choices.length-1;if(index<0)index=0;choices.removeClass("select2-highlighted");$(choices[index]).addClass("select2-highlighted");this.ensureHighlightVisible();},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length;},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.results.find('.select2-result-selectable');this.highlight(choices.index(el));}else if(el.length==0){this.results.find(".select2-highlighted").removeClass("select2-highlighted");}},loadMoreIfNeeded:function(){var results=this.results,more=results.find("li.select2-more-results"),below,offset=-1,page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(more.length===0)return;below=more.offset().top-results.offset().top-results.height();if(below<=0){more.addClass("select2-active");this.opts.query({term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){if(!self.opened())return;self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});if(data.more===true){more.detach().appendTo(results).text(self.opts.formatLoadMore(page+1));window.setTimeout(function(){self.loadMoreIfNeeded();},10);}else{more.remove();}
self.positionDropdown();self.resultsPage=page;})});}},tokenize:function(){},updateResults:function(initial){var search=this.search,results=this.results,opts=this.opts,data,self=this,input;if(initial!==true&&(this.showSearchInput===false||!this.opened())){return;}
search.addClass("select2-active");function postRender(){results.scrollTop(0);search.removeClass("select2-active");self.positionDropdown();}
function render(html){results.html(self.opts.escapeMarkup(html));postRender();}
if(opts.maximumSelectionSize>=1){data=this.data();if($.isArray(data)&&data.length>=opts.maximumSelectionSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+opts.formatSelectionTooBig(opts.maximumSelectionSize)+"</li>");return;}}
if(search.val().length<opts.minimumInputLength&&checkFormatter(opts.formatInputTooShort,"formatInputTooShort")){render("<li class='select2-no-results'>"+opts.formatInputTooShort(search.val(),opts.minimumInputLength)+"</li>");return;}
else{render("<li class='select2-searching'>"+opts.formatSearching()+"</li>");}
input=this.tokenize();if(input!=undefined&&input!=null){search.val(input);}
this.resultsPage=1;opts.query({term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(!this.opened())return;this.context=(data.context===undefined)?null:data.context;if(this.opts.createSearchChoice&&search.val()!==""){def=this.opts.createSearchChoice.call(null,search.val(),data.results);if(def!==undefined&&def!==null&&self.id(def)!==undefined&&self.id(def)!==null){if($(data.results).filter(function(){return equal(self.id(this),self.id(def));}).length===0){data.results.unshift(def);}}}
if(data.results.length===0&&checkFormatter(opts.formatNoMatches,"formatNoMatches")){render("<li class='select2-no-results'>"+opts.formatNoMatches(search.val())+"</li>");return;}
results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===true&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.append("<li class='select2-more-results'>"+self.opts.escapeMarkup(opts.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded();},10);}
this.postprocessResults(data,initial);postRender();})});},cancel:function(){this.close();},blur:function(){this.close();this.container.removeClass("select2-container-active");this.dropdown.removeClass("select2-drop-active");if(this.search[0]===document.activeElement){this.search.blur();}
this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");},focusSearch:function(){this.search.show();this.search.focus();window.setTimeout(this.bind(function(){this.search.show();this.search.focus();this.search.val(this.search.val());}),10);},selectHighlighted:function(){var index=this.highlight(),highlighted=this.results.find(".select2-highlighted").not(".select2-disabled"),data=highlighted.closest('.select2-result-selectable').data("select2-data");if(data){highlighted.addClass("select2-disabled");this.highlight(index);this.onSelect(data);}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder;},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l;if(this.opts.width==="off"){return null;}else if(this.opts.width==="element"){return this.opts.element.outerWidth()===0?'auto':this.opts.element.outerWidth()+'px';}else if(this.opts.width==="copy"||this.opts.width==="resolve"){style=this.opts.element.attr('style');if(style!==undefined){attrs=style.split(';');for(i=0,l=attrs.length;i<l;i=i+1){matches=attrs[i].replace(/\s/g,'').match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(matches!==null&&matches.length>=1)
return matches[1];}}
if(this.opts.width==="resolve"){style=this.opts.element.css('width');if(style.indexOf("%")>0)return style;return(this.opts.element.outerWidth()===0?'auto':this.opts.element.outerWidth()+'px');}
return null;}else if($.isFunction(this.opts.width)){return this.opts.width();}else{return this.opts.width;}};var width=resolveContainerWidth.call(this);if(width!==null){this.container.attr("style","width: "+width);}}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container"}).html(["    <a href='#' onclick='return false;' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},opening:function(){this.search.show();this.parent.opening.apply(this,arguments);this.dropdown.removeClass("select2-offscreen");},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show();},focus:function(){this.close();this.selection.focus();},isFocused:function(){return this.selection[0]===document.activeElement;},cancel:function(){this.parent.cancel.apply(this,arguments);this.selection.focus();},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,clickingInside=false;this.selection=selection=container.find(".select2-choice");this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.TAB:case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}else{if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return;}
this.open();if(e.which===KEY.ENTER){return;}}}));this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1");}));this.search.bind("blur",this.bind(function(){if(!this.opened())this.container.removeClass("select2-container-active");window.setTimeout(this.bind(function(){this.selection.attr("tabIndex",this.opts.element.attr("tabIndex"));}),10);}));selection.bind("mousedown",this.bind(function(e){clickingInside=true;if(this.opened()){this.close();this.selection.focus();}else if(this.enabled){this.open();}
clickingInside=false;}));dropdown.bind("mousedown",this.bind(function(){this.search.focus();}));selection.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");this.search.attr("tabIndex","-1");}));selection.bind("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active");}
window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"));}),10);}));selection.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return;}
if(e.which==KEY.DELETE){if(this.opts.allowClear){this.clear();}
return;}
this.open();if(e.which===KEY.ENTER){killEvent(e);return;}
if(e.which<48){killEvent(e);return;}
var keyWritten=String.fromCharCode(e.which).toLowerCase();if(e.shiftKey){keyWritten=keyWritten.toUpperCase();}
this.search.focus();this.search.val(keyWritten);killEvent(e);}));selection.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear();killEvent(e);this.close();this.triggerChange();this.selection.focus();}));this.setPlaceholder();this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active");}));},clear:function(){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder();},initSelection:function(){var selected;if(this.opts.element.val()===""){this.close();this.setPlaceholder();}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&selected!==null){self.updateSelection(selected);self.close();self.setPlaceholder();}});}},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var selected=element.find(":selected");if($.isFunction(callback))
callback({id:selected.attr("value"),text:selected.text()});};}
return opts;},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.opts.element.val()===""&&placeholder!==undefined){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(placeholder));this.selection.addClass("select2-default");this.selection.find("abbr").hide();}},postprocessResults:function(data,initial){var selected=0,self=this,showSearchInput=true;this.results.find(".select2-result-selectable").each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return false;}});this.highlight(selected);if(initial===true){showSearchInput=this.showSearchInput=countResults(data.results)>=this.opts.minimumResultsForSearch;this.dropdown.find(".select2-search")[showSearchInput?"removeClass":"addClass"]("select2-search-hidden");$(this.dropdown,this.container)[showSearchInput?"addClass":"removeClass"]("select2-with-searchbox");}},onSelect:function(data){var old=this.opts.element.val();this.opts.element.val(this.id(data));this.updateSelection(data);this.close();this.selection.focus();if(!equal(old,this.id(data))){this.triggerChange();}},updateSelection:function(data){var container=this.selection.find("span"),formatted;this.selection.data("select2-data",data);container.empty();formatted=this.opts.formatSelection(data,container);if(formatted!==undefined){container.append(this.opts.escapeMarkup(formatted));}
this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==undefined){this.selection.find("abbr").show();}},val:function(){var val,data=null,self=this;if(arguments.length===0){return this.opts.element.val();}
val=arguments[0];if(this.select){this.select.val(val).find(":selected").each2(function(i,elm){data={id:elm.attr("value"),text:elm.text()};return false;});this.updateSelection(data);this.setPlaceholder();}else{if(this.opts.initSelection===undefined){throw new Error("cannot call val() if initSelection() is not defined");}
if(!val){this.clear();return;}
this.opts.element.val(val);this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(!data?"":self.id(data));self.updateSelection(data);self.setPlaceholder();});}},clearSearch:function(){this.search.val("");},data:function(value){var data;if(arguments.length===0){data=this.selection.data("select2-data");if(data==undefined)data=null;return data;}else{if(!value||value===""){this.clear();}else{this.opts.element.val(!value?"":this.id(value));this.updateSelection(value);}}}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var data=[];element.find(":selected").each2(function(i,elm){data.push({id:elm.attr("value"),text:elm.text()});});if($.isFunction(callback))
callback(data);};}
return opts;},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===KEY.BACKSPACE&&this.search.val()===""){this.close();var choices,selected=selection.find(".select2-search-choice-focus");if(selected.length>0){this.unselect(selected.first());this.search.width(10);killEvent(e);return;}
choices=selection.find(".select2-search-choice");if(choices.length>0){choices.last().addClass("select2-search-choice-focus");}}else{selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:case KEY.TAB:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.BACKSPACE||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){return;}
this.open();if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);}}));this.search.bind("keyup",this.bind(this.resizeSearch));this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.clearSearch();e.stopImmediatePropagation();}));this.container.delegate(selector,"mousedown",this.bind(function(e){if(!this.enabled)return;if($(e.target).closest(".select2-search-choice").length>0){return;}
this.clearPlaceholder();this.open();this.focusSearch();e.preventDefault();}));this.container.delegate(selector,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder();}));this.clearSearch();},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments);this.search.removeAttr("disabled");},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments);this.search.attr("disabled",true);},initSelection:function(){var data;if(this.opts.element.val()===""){this.updateSelection([]);this.close();this.clearSearch();}
if(this.select||this.opts.element.val()!==""){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&data!==null){self.updateSelection(data);self.close();self.clearSearch();}});}},clearSearch:function(){var placeholder=this.getPlaceholder();if(placeholder!==undefined&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(placeholder).addClass("select2-default");this.resizeSearch();}else{this.search.val(" ").width(10);}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default");}else{if(this.search.val()===" ")this.search.val("");}},opening:function(){this.parent.opening.apply(this,arguments);this.clearPlaceholder();this.resizeSearch();this.focusSearch();},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);},focus:function(){this.close();this.search.focus();},isFocused:function(){return this.search.hasClass("select2-focused");},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this);}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this);});self.postprocessResults();},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer(input,this.data(),this.bind(this.onSelect),this.opts);if(input!=null&&input!=undefined){this.search.val(input);if(input.length>0){this.open();}}},onSelect:function(data){this.addSelectedChoice(data);if(this.select){this.postprocessResults();}
if(this.opts.closeOnSelect){this.close();this.search.width(10);}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();this.positionDropdown();}else{this.close();}}
this.triggerChange({added:data});this.focusSearch();},cancel:function(){this.close();this.focusSearch();},addSelectedChoice:function(data){var choice=$("<li class='select2-search-choice'>"+"    <div></div>"+"    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a>"+"</li>"),id=this.id(data),val=this.getVal(),formatted;formatted=this.opts.formatSelection(data,choice);choice.find("div").replaceWith("<div>"+this.opts.escapeMarkup(formatted)+"</div>");choice.find(".select2-search-choice-close").bind("mousedown",killEvent).bind("click dblclick",this.bind(function(e){if(!this.enabled)return;$(e.target).closest(".select2-search-choice").fadeOut('fast',this.bind(function(){this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch();})).dequeue();killEvent(e);})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");}));choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val);},unselect:function(selected){var val=this.getVal(),data,index;selected=selected.closest(".select2-search-choice");if(selected.length===0){throw"Invalid argument: "+selected+". Must be .select2-search-choice";}
data=selected.data("select2-data");index=indexOf(this.id(data),val);if(index>=0){val.splice(index,1);this.setVal(val);if(this.select)this.postprocessResults();}
selected.remove();this.triggerChange({removed:data});},postprocessResults:function(){var val=this.getVal(),choices=this.results.find(".select2-result-selectable"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-disabled").removeClass("select2-result-selectable");}else{choice.removeClass("select2-disabled").addClass("select2-result-selectable");}});compound.each2(function(i,e){if(e.find(".select2-result-selectable").length==0){e.addClass("select2-disabled");}else{e.removeClass("select2-disabled");}});choices.each2(function(i,choice){if(!choice.hasClass("select2-disabled")&&choice.hasClass("select2-result-selectable")){self.highlight(0);return false;}});},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;if(searchWidth<minimumWidth){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<40){searchWidth=maxWidth-sideBorderPadding;}
this.search.width(searchWidth);},getVal:function(){var val;if(this.select){val=this.select.val();return val===null?[]:val;}else{val=this.opts.element.val();return splitVal(val,this.opts.separator);}},setVal:function(val){var unique;if(this.select){this.select.val(val);}else{unique=[];$(val).each(function(){if(indexOf(this,unique)<0)unique.push(this);});this.opts.element.val(unique.length===0?"":unique.join(this.opts.separator));}},val:function(){var val,data=[],self=this;if(arguments.length===0){return this.getVal();}
val=arguments[0];if(!val){this.opts.element.val("");this.updateSelection([]);this.clearSearch();return;}
this.setVal(val);if(this.select){this.select.find(":selected").each(function(){data.push({id:$(this).attr("value"),text:$(this).text()});});this.updateSelection(data);}else{if(this.opts.initSelection===undefined){throw new Error("val() cannot be called if initSelection() is not defined")}
this.opts.initSelection(this.opts.element,function(data){var ids=$(data).map(self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch();});}
this.clearSearch();},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");}
this.search.width(0);this.searchContainer.hide();},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")));});this.setVal(val);this.triggerChange();},data:function(values){var self=this,ids;if(arguments.length===0){return this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data");}).get();}else{if(!values){values=[];}
ids=$.map(values,function(e){return self.opts.id(e)});this.setVal(ids);this.updateSelection(values);this.clearSearch();}}});$.fn.select2=function(){var args=Array.prototype.slice.call(arguments,0),opts,select2,value,multiple,allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(args.length===0||typeof(args[0])==="object"){opts=args.length===0?{}:$.extend({},args[0]);opts.element=$(this);if(opts.element.get(0).tagName.toLowerCase()==="select"){multiple=opts.element.attr("multiple");}else{multiple=opts.multiple||false;if("tags"in opts){opts.multiple=multiple=true;}}
select2=multiple?new MultiSelect2():new SingleSelect2();select2.init(opts);}else if(typeof(args[0])==="string"){if(indexOf(args[0],allowedMethods)<0){throw"Unknown method: "+args[0];}
value=undefined;select2=$(this).data("select2");if(select2===undefined)return;if(args[0]==="container"){value=select2.container;}else{value=select2[args[0]].apply(select2,args.slice(1));}
if(value!==undefined){return false;}}else{throw"Invalid arguments to select2 plugin: "+args;}});return(value===undefined)?this:value;};$.fn.select2.defaults={width:"copy",closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query){var markup=[];markMatch(result.text,query.term,markup);return markup.join("");},formatSelection:function(data,container){return data.text;},formatResultCssClass:function(data){return undefined;},formatNoMatches:function(){return"No matches found";},formatInputTooShort:function(input,min){return"Please enter "+(min-input.length)+" more characters";},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(limit==1?"":"s");},formatLoadMore:function(pageNumber){return"Loading more results...";},formatSearching:function(){return"Searching...";},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id;},matcher:function(term,text){return text.toUpperCase().indexOf(term.toUpperCase())>=0;},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:function(markup){if(markup&&typeof(markup)==="string"){return markup.replace(/&/g,"&amp;");}
return markup;},blurOnChange:false};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch},"class":{"abstract":AbstractSelect2,"single":SingleSelect2,"multi":MultiSelect2}};}(jQuery));;(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;openerp.base_import=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;var _lt=instance.web._lt;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
instance.web.ListView.prototype.defaults.import_enabled=true;instance.web.ListView.include({load_list:function(){var self=this;var add_button=false;if(!this.$buttons){add_button=true;}
this._super.apply(this,arguments);if(add_button){this.$buttons.on('click','.oe_list_button_import',function(){self.do_action({type:'ir.actions.client',tag:'import',params:{model:self.dataset.model}},{on_reverse_breadcrumb:function(){self.reload();},});return false;});}}});instance.web.client_actions.add('import','instance.web.DataImport');instance.web.DataImport=instance.web.Widget.extend({template:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:'utf-8'},{name:'separator',label:_lt("Separator:"),value:','},{name:'quoting',label:_lt("Quoting:"),value:'"'}],events:{'change .oe_import_file':'loaded_file','click .oe_import_file_reload':'loaded_file','change input.oe_import_has_header, .oe_import_options input':'settings_changed','click a.oe_import_toggle':function(e){e.preventDefault();var $el=$(e.target);($el.next().length?$el.next():$el.parent().next()).toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},'click .oe_import_validate':'validate','click .oe_import_import':'import','click .oe_import_cancel':function(e){e.preventDefault();this.exit();}},init:function(parent,action){var self=this;this._super.apply(this,arguments);this.res_model=action.params.model;this.id=null;this.Import=new instance.web.Model('base_import.import');},start:function(){var self=this;this.setup_encoding_picker();this.setup_separator_picker();return $.when(this._super(),this.Import.call('create',[{'res_model':this.res_model}]).done(function(id){self.id=id;self.$('input[name=import_id]').val(id);}))},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'160px',query:function(q){var make=function(term){return{id:term,text:term};};var suggestions=_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 '+'gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),make);if(q.term){suggestions.unshift(make(q.term));}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:'utf-8',text:'utf-8'});}}).select2('val','utf-8');},setup_separator_picker:function(){this.$('input.oe_import_separator').select2({width:'160px',query:function(q){var suggestions=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];if(q.term){suggestions.unshift({id:q.term,text:q.term});}
q.callback({results:suggestions});},initSelection:function(e,c){return c({id:',',text:_t("Comma")});},});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked')};_(this.opts).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});return options;},onfile_loaded:function(){this.$('.oe_import_button, .oe_import_file_reload').prop('disabled',true);if(!this.$('input.oe_import_file').val()){return;}
this.$el.removeClass('oe_import_preview oe_import_error');jsonp(this.$el,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$('.oe_import_button, .oe_import_file_reload').prop('disabled',true);this.$el.addClass('oe_import_with_file');this.$el.removeClass('oe_import_preview_error oe_import_error');this.$el.toggleClass('oe_import_noheaders',!this.$('input.oe_import_has_header').prop('checked'));this.Import.call('parse_preview',[this.id,this.import_options()]).done(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$('.oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview_error oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){this.$('.oe_import_import').removeClass('oe_highlight');this.$('.oe_import_validate').addClass('oe_highlight');this.$('.oe_import_button, .oe_import_file_reload').prop('disabled',false);this.$el.addClass('oe_import_preview');this.$('table').html(QWeb.render('ImportView.preview',result));if(result.headers.length===1){this.$('.oe_import_options').show();this.onresults(null,null,null,[{type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")}]);}
var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.select2({allowClear:true,minimumInputLength:0,data:data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
callback(item_finder(default_value));},width:'resolve',dropdownCssClass:'oe_import_selector'});},generate_fields_completion:function(root){var basic=[];var regulars=[];var o2m=[];function traverse(field,ancestors,collection){var subfields=field.fields;var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(!collection){if(field.name==='id'){collection=basic}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required});for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection);}}
_(root.fields).each(function(field){traverse(field,[]);});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);return basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m}]);},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(options){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();return this.Import.call('do',[this.id,fields,this.import_options()],options).then(undefined,function(error,event){if(event){event.preventDefault();}
return $.when([{type:'error',record:false,message:error.data.fault_code,}]);});},onvalidate:function(){return this.call_import({dryrun:true}).done(this.proxy('validated'));},onimport:function(){var self=this;return this.call_import({dryrun:false}).done(function(message){if(!_.any(message,function(message){return message.type==='error'})){self['import_succeeded']();return;}
self['import_failed'](message);});},onimported:function(){this.exit();},exit:function(){this.do_action({type:'ir.actions.client',tag:'history_back'});},onresults:function(event,from,to,message){var no_messages=_.isEmpty(message);this.$('.oe_import_import').toggleClass('oe_highlight',no_messages);this.$('.oe_import_validate').toggleClass('oe_highlight',!no_messages);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}
var offset=1;if(this.import_options().headers){offset+=1;}
this.$el.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:_(message).groupBy('message'),at:function(rows){var from=rows.from+offset;var to=rows.to+offset;if(from===to){return _.str.sprintf(_t("at row %d"),from);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices">%s <ul>%s</ul></div>',_.str.escapeHTML(_t("Here are the possible values:")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s">',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("Get all possible values")),'</a>','</div>'].join('')},}));},});StateMachine.create({target:instance.web.DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}]})};;openerp.web_linkedin=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;instance.web_linkedin.LinkedinTester=instance.web.Class.extend({init:function(){this.linkedin_added=false;this.linkedin_def=$.Deferred();this.auth_def=$.Deferred();},error_catcher:function(callback){var self=this;if(!this.realError){this.realError=Error;this.window_onerror=window.onerror;}
if(!callback){Error=self.realError;return false;}
this.callback=callback;window.onerror=function(message,fileName,lineNumber){if(!window.onerror.prototype.catched){self.window_onerror(message,fileName,lineNumber);}
if(self.realError!=Error){window.onerror.prototype.catched=false;}else{window.onerror=self.window_onerror;}};window.onerror.prototype.catched=false;Error=function(message,fileName,lineNumber){this.name=message;this.message=message;this.fileName=fileName;this.lineNumber=lineNumber;this.caller=Error.caller.toString();window.onerror.prototype.catched=self.callback.apply(self,[this]);return this;};Error.prototype.toString=function(){return this.name;};},linkedin_disabled:function(error){this.linkedin_def.reject();this.auth_def.reject();IN=false;instance.web.dialog($(QWeb.render("LinkedIn.DisabledWarning",{'error':error})),{title:_t("LinkedIn is not enabled"),buttons:[{text:_t("Ok"),click:function(){$(this).dialog("close");}}]});},test_linkedin:function(){var self=this;return this.test_api_key().then(function(){if(self.linkedin_added){return self.linkedin_def;}
self.$linkedin=$('<div class="oe_linkedin_login_hidden" style="display:none;"><script type="in/Login"></script></div>');self.error_catcher(function(error){if(!!error.caller.match(/API Key is invalid/)){self.linkedin_disabled(error);self.$linkedin.remove();console.debug("LinkedIn JavaScript removed.");self.linkedin_added=false;self.error_catcher(false);return true;}else{return false;}});window.setTimeout(function(){self.error_catcher(false);},5000);$("body").append(self.$linkedin);var tag=document.createElement('script');tag.type='text/javascript';tag.src="http://platform.linkedin.com/in.js";tag.innerHTML='api_key : '+self.api_key+'\nauthorize : true\nscope: r_network r_basicprofile';document.getElementsByTagName('head')[0].appendChild(tag);self.linkedin_added=true;$(tag).load(function(event){console.debug("LinkedIn JavaScript inserted.");IN.Event.on(IN,"frameworkLoaded",function(){self.error_catcher(false);console.debug("LinkedIn DOM node inserted and frameworkLoaded.");});IN.Event.on(IN,"systemReady",function(){self.linkedin_def.resolve();console.debug("LinkedIn systemReady.");});IN.Event.on(IN,"auth",function(){self.auth_def.resolve();});IN.Event.on(IN,"logout",function(){self.auth_def.reject();self.auth_def=$.Deferred();});});return self.linkedin_def.promise();});},test_api_key:function(){var self=this;if(this.api_key){return $.when();}
return new instance.web.Model("ir.config_parameter").call("get_param",["web.linkedin.apikey"]).then(function(a){if(!!a){self.api_key=a;return true;}else{return $.Deferred().reject();}});},test_authentication:function(){var self=this;this.linkedin_def.done(function(){if(IN.User.isAuthorized()){self.auth_def.resolve();}else{IN.User.authorize();}});return this.auth_def.promise();},});instance.web_linkedin.tester=new instance.web_linkedin.LinkedinTester();instance.web_linkedin.Linkedin=instance.web.form.FieldChar.extend({init:function(){this._super.apply(this,arguments);this.display_dm=new instance.web.DropMisordered(true);},initialize_content:function(){var $ht=$(QWeb.render("FieldChar.linkedin"));var $in=this.$("input");$in.replaceWith($ht);this.$(".oe_linkedin_input").append($in);this.$(".oe_linkedin_img").click(_.bind(this.search_linkedin,this));this._super();},search_linkedin:function(){var self=this;if(!this.open_in_process){this.open_in_process=true;this.display_dm.add(instance.web_linkedin.tester.test_linkedin()).done(function(){self.open_in_process=false;var text=(self.get("value")||"").replace(/^\s+|\s+$/g,"").replace(/\s+/g," ");instance.web_linkedin.tester.test_authentication().done(function(){var pop=new instance.web_linkedin.LinkedinSearchPopup(self,text);pop.open();pop.on("selected",this,function(entity){self.selected_entity(entity);});});});}},selected_entity:function(entity){var self=this;this.create_on_change(entity).done(function(to_change){var values=self.view.get_fields_values();_.each(to_change,function(value,key){if(!/linkedin/.test(key)&&!!values[key]){if(!_.isArray(values[key])){delete to_change[key];}}})
self.view.set_values(to_change);});},create_on_change:function(entity){return entity.__type==="company"?this.create_or_modify_company(entity):this.create_or_modify_partner(entity);},create_or_modify_company:function(entity){var self=this;var to_change={};var image_def=null;to_change.is_company=true;to_change.name=entity.name;to_change.image=false;if(entity.logoUrl){image_def=self.rpc('/web_linkedin/binary/url2binary',{'url':entity.logoUrl}).then(function(data){to_change.image=data;});}
to_change.website=entity.websiteUrl;to_change.phone=false;_.each((entity.locations||{}).values||[],function(el){to_change.phone=el.contactInfo.phone1;});to_change.linkedin_url=_.str.sprintf("http://www.linkedin.com/company/%d",entity.id);_.each(to_change,function(val,key){if(self.field_manager.datarecord[key]){to_change[key]=self.field_manager.datarecord[key];}});to_change.child_ids=[];var children_def=$.Deferred();IN.API.PeopleSearch().fields(commonPeopleFields).params({"company-name":entity.universalName,"current-company":true,"count":50,}).result(function(result){console.debug("Linkedin pepople in this company found :",result.numResults,"=>",result.people._count,result.people.values);var result=_.reject(result.people.values||[],function(el){return!el.formattedName;});self.create_or_modify_company_partner(result).then(function(childs_to_change){_.each(childs_to_change,function(data){to_change.child_ids.push(data.id?[1,data.id,data]:[0,0,data]);});children_def.resolve();});}).error(function(){children_def.reject();});return $.when(image_def,children_def).then(function(){return to_change;});},create_or_modify_partner:function(entity,rpc_search_similar_partner){var self=this;return this.create_or_modify_partner_change(entity).then(function(to_change){_.each(to_change,function(val,key){if(self.field_manager.datarecord[key]){to_change[key]=self.field_manager.datarecord[key];}});});},create_or_modify_partner_change:function(entity){var to_change={};var defs=[];to_change.is_company=false;to_change.name=entity.formattedName;if(entity.pictureUrl){defs.push(this.rpc('/web_linkedin/binary/url2binary',{'url':entity.pictureUrl}).then(function(data){to_change.image=data;}));}
_.each((entity.phoneNumbers||{}).values||[],function(el){if(el.phoneType==="mobile"){to_change.mobile=el.phoneNumber;}else{to_change.phone=el.phoneNumber;}});var positions=(entity.positions||{}).values||[];for(key in positions){var position=positions[key];if(position.isCurrent){var company_name=position.company?position.company.name:false;if(!entity.parent_id&&entity.parent_id!==0&&company_name){defs.push(new instance.web.DataSetSearch(this,'res.partner').call("search",[[["name","=",company_name]]]).then(function(data){if(data[0])to_change.parent_id=data[0];else position.title=position.title+' ('+company_name+') ';to_change.function=position.title;}));}else if(!entity.__company||!company_name||company_name==entity.__company){to_change.function=position.title+(company_name?' ('+company_name+') ':'');}
break;}};if(entity.parent_id){to_change.parent_id=entity.parent_id;}
to_change.linkedin_url=to_change.linkedin_public_url=entity.publicProfileUrl||false;to_change.linkedin_id=entity.id||false;return $.when.apply($,defs).then(function(){return to_change;});},create_or_modify_company_partner:function(entities){var self=this;var deferrer=$.Deferred();var defs=[];var childs_to_change=[];_.each(entities,function(entity,key){var entity=_.extend(entity,{'__type':"people",'__company':entity.universalName,'parent_id':self.field_manager.datarecord.id||0});defs.push(self.create_or_modify_partner_change(entity).then(function(to_change){childs_to_change[key]=to_change;}));});$.when.apply($,defs).then(function(){new instance.web.DataSetSearch(this,'res.partner').call("linkedin_check_similar_partner",[entities]).then(function(partners){_.each(partners,function(partner,i){_.each(partner,function(val,key){if(val){childs_to_change[i][key]=val;}});});deferrer.resolve(childs_to_change);});});return deferrer;}});instance.web.form.widgets.add('linkedin','instance.web_linkedin.Linkedin');instance.web_linkedin.Linkedin_url=instance.web.form.FieldChar.extend({initialize_content:function(){this.$("input,span").replaceWith($(QWeb.render("FieldChar.linkedin_url")));this._super();},render_value:function(){this._super();this.$(".oe_linkedin_url").attr("href",this.field_manager.datarecord.linkedin_url||"#").toggle(!!this.field_manager.datarecord.linkedin_url);},});instance.web.form.widgets.add('linkedin_url','instance.web_linkedin.Linkedin_url');var commonPeopleFields=["id","picture-url","public-profile-url","first-name","last-name","formatted-name","location","phone-numbers","im-accounts","main-address","headline","positions","summary","specialties"];instance.web_linkedin.LinkedinSearchPopup=instance.web.Dialog.extend({template:"Linkedin.popup",init:function(parent,search){var self=this;if(!IN.User.isAuthorized()){this.$buttons=$("<div/>");this.destroy();}
this._super(parent,{'title':QWeb.render('LinkedIn.AdvancedSearch',{'title':_t("LinkedIn search")})});this.search=search;this.limit=5;},start:function(){this._super();this.bind_event();this.display_account();this.do_search();},bind_event:function(){var self=this;this.$el.parent().on("click",".oe_linkedin_logout",function(){IN.User.logout();self.destroy();});this.$search=this.$el.parent().find(".oe_linkedin_advanced_search");this.$url=this.$search.find("input[name='search']");this.$button=this.$search.find("button");this.$button.on("click",function(e){e.stopPropagation();self.do_search(self.$url.val()||'');});this.$url.on("click mousedown mouseup",function(e){e.stopPropagation();}).on("keydown",function(e){if(e.keyCode==13){$(e.target).blur();self.$button.click();}});},display_account:function(){var self=this;IN.API.Profile("me").fields(["firstName","lastName"]).result(function(result){$(QWeb.render('LinkedIn.loginInformation',result.values[0])).appendTo(self.$el.parent().find(".ui-dialog-buttonpane"));})},do_search:function(url){if(!IN.User||!IN.User.isAuthorized()){this.destroy();}
var self=this;var deferrers=[];this.$(".oe_linkedin_pop_c, .oe_linkedin_pop_p").empty();if(url&&url.length){var deferrer_c=$.Deferred();var deferrer_p=$.Deferred();deferrers.push(deferrer_c,deferrer_p);var url=url.replace(/\/+$/,'');var uid=url.replace(/(.*linkedin\.com\/[a-z]+\/)|(^.*\/company\/)|(\&.*$)/gi,'');IN.API.Raw(_.str.sprintf("companies/universal-name=%s:(id,name,logo-url,description,industry,website-url,locations,universal-name)",encodeURIComponent(uid.toLowerCase()))).result(function(result){self.do_result_companies({'companies':{'values':[result]}});deferrer_c.resolve();}).error(function(error){self.do_result_companies({});deferrer_c.resolve();});var url_public="http://www.linkedin.com/pub/"+uid;IN.API.Profile("url="+encodeURI(url_public).replace(/%2F/g,'/')).fields(commonPeopleFields).result(function(result){self.do_result_people({'people':result});deferrer_p.resolve();}).error(function(error){self.do_warn(_t("LinkedIn error"),_t("LinkedIn is temporary down for the searches by url."));self.do_result_people({});deferrer_p.resolve();});this.search=url;}
var deferrer_c_k=$.Deferred();var deferrer_p_k=$.Deferred();deferrers.push(deferrer_c_k,deferrer_p_k);IN.API.Raw(_.str.sprintf("company-search:(companies:"+"(id,name,logo-url,description,industry,website-url,locations,universal-name))?keywords=%s&count=%d",encodeURI(this.search),this.limit)).result(function(result){self.do_result_companies(result);deferrer_c_k.resolve();});IN.API.PeopleSearch().fields(commonPeopleFields).params({"keywords":this.search,"count":this.limit}).result(function(result){self.do_result_people(result);deferrer_p_k.resolve();});return $.when.apply($,deferrers);},do_result_companies:function(companies){var lst=(companies.companies||{}).values||[];lst=_.first(lst,this.limit);lst=_.map(lst,function(el){el.__type="company";return el;});console.debug("Linkedin companies found:",(companies.companies||{})._total,'=>',lst.length,lst);return this.display_result(lst,this.$(".oe_linkedin_pop_c"));},do_result_people:function(people){var plst=(people.people||{}).values||[];plst=_.first(plst,this.limit);plst=_.map(plst,function(el){el.__type="people";return el;});console.debug("Linkedin people found:",people.numResults,'=>',plst.length,plst);return this.display_result(plst,this.$(".oe_linkedin_pop_p"));},display_result:function(result,$elem){var self=this;var $row;$elem.find(".oe_no_result").remove();_.each(result,function(el){var pc=new instance.web_linkedin.EntityWidget(self,el);if(!$elem.find("div").size()||$elem.find(" > div:last > div").size()>=5){$row=$("<div style='display: table-row;width:100%'/>");$row.appendTo($elem);}
pc.appendTo($row);pc.$el.css("display","table-cell");pc.$el.css("width","20%");pc.on("selected",self,function(data){self.trigger("selected",data);self.destroy();});});if(!$elem.find("div").size()){$elem.append($('<div class="oe_no_result">').text(_t("No results found")));}},});instance.web_linkedin.EntityWidget=instance.web.Widget.extend({template:"Linkedin.EntityWidget",init:function(parent,data){this._super(parent);this.data=data;},start:function(){var self=this;this.$el.click(function(){self.trigger("selected",self.data);});if(this.data.__type==="company"){this.$("h3").text(this.data.name);self.$("img").attr("src",this.data.logoUrl);self.$(".oe_linkedin_entity_headline").text(this.data.industry);}else{this.$("h3").text(this.data.formattedName);self.$("img").attr("src",this.data.pictureUrl);self.$(".oe_linkedin_entity_headline").text(this.data.headline);}},});};;openerp.web_view_editor=function(instance){var _t=instance.web._t;var QWeb=instance.web.qweb;instance.web.ViewManagerAction.include({on_debug_changed:function(evt){var val=$(evt.currentTarget).find('option:selected').val(),current_view=this.views[this.active_view].controller;if(val==="manage_views"){if(current_view.fields_view&&current_view.fields_view.arch){var view_editor=new instance.web_view_editor.ViewEditor(current_view,current_view.$el,this.dataset,current_view.fields_view.arch);view_editor.start();}else{this.do_warn(_t("Manage Views"),_t("Could not find current view declaration"));}
evt.currentTarget.selectedIndex=0;}else{return this._super.apply(this,arguments);}}});instance.web_view_editor.ViewEditor=instance.web.Widget.extend({init:function(parent,element_id,dataset,view,options){this._super(parent);this.parent=parent;this.dataset=new instance.web.DataSetSearch(this,'ir.ui.view',null,null),this.model=dataset.model;this.xml_element_id=0;this.property=instance.web_view_editor.ViewEditor.property_widget;this.one_object=false;},start:function(){this.init_view_editor();},init_view_editor:function(){var self=this,action_title=_.str.sprintf(_t("Manage Views (%s)"),this.model);var action={name:action_title,context:this.session.user_context,domain:[["model","=",this.model]],res_model:'ir.ui.view',views:[[false,'list']],type:'ir.actions.act_window',target:"current",limit:this.dataset.limit||80,auto_search:true,flags:{sidebar:false,deletable:false,views_switcher:false,action_buttons:false,search_view:false,pager:false,radio:true,select_view_id:self.parent.fields_view.view_id}};this.view_edit_dialog=new instance.web.Dialog(this,{title:action_title,width:850,buttons:[{text:_t("Create"),click:function(){self.on_create_view();}},{text:_t("Edit"),click:function(){self.xml_element_id=0;self.get_arch();}},{text:_t("Remove"),click:function(){self.do_delete_view();}},{text:_t("Close"),click:function(){self.view_edit_dialog.close();window.location.reload();}}]}).open();this.view_edit_dialog.on("closing",this,function(){window.location.reload();});this.main_view_id=this.parent.fields_view.view_id;this.action_manager=new instance.web.ActionManager(this);this.action_manager.appendTo(this.view_edit_dialog.$el);$.when(this.action_manager.do_action(action)).done(function(){var viewmanager=self.action_manager.inner_widget;var controller=viewmanager.views[viewmanager.active_view].controller;controller.on('view_loaded',self,function(){$(controller.groups).bind({'selected':function(e,ids,records){self.main_view_id=ids[0];}});});});},on_create_view:function(){var self=this;this.create_view_dialog=new instance.web.Dialog(this,{title:_.str.sprintf(_t("Create a view (%s)"),self.model),buttons:[{text:_t("Save"),click:function(){var view_values={};var warn=false;_.each(self.create_view_widget,function(widget){if(widget.is_invalid){warn=true;return false;}
if(widget.dirty&&!widget.is_invalid){view_values[widget.name]=widget.get_value();}});if(warn){self.on_valid_create_view(self.create_view_widget);}else{$.when(self.do_save_view(view_values)).done(function(){self.create_view_dialog.close();var controller=self.action_manager.inner_widget.views[self.action_manager.inner_widget.active_view].controller;controller.reload_content();});}}},{text:_t("Cancel"),click:function(){self.create_view_dialog.close();}}]}).open();var view_widget=[{'name':'view_name','string':'View Name','type':'char','required':true,'value':this.model+'.custom_'+Math.round(Math.random()*1000)},{'name':'view_type','string':'View Type','type':'selection','required':true,'value':'Form','selection':[['',''],['tree','Tree'],['form','Form'],['graph','Graph'],['calendar','Calender']]},{'name':'proirity','string':'Priority','type':'float','required':true,'value':'16'}];this.create_view_dialog.$el.append('<table id="create_view"  style="width:400px" class="oe_form"></table>');this.create_view_widget=[];_.each(view_widget,function(widget){var type_widget=new(self.property.get_any([widget.type]))(self.create_view_dialog,widget);self.create_view_dialog.$el.find('table[id=create_view]').append('<tr><td width="100px" align="right">'+widget.string+':</td>'+type_widget.render()+'</tr>');var value=null;if(widget.value){value=widget.value;type_widget.dirty=true;}
type_widget.start();type_widget.set_value(value);self.create_view_widget.push(type_widget);});},do_save_view:function(values){def=$.Deferred();var field_dataset=new instance.web.DataSetSearch(this,this.model,null,null);var model_dataset=new instance.web.DataSetSearch(this,'ir.model',null,null);var view_string="",field_name=false,self=this;field_dataset.call('fields_get',[]).done(function(fields){_.each(['name','x_name'],function(value){if(_.include(_.keys(fields),value)){field_name=value;return false;}});if(field_name){model_dataset.read_slice(['name','field_id'],{"domain":[['model','=',self.model]]}).done(function(records){if(records){view_string=records[0].name;}
var arch=_.str.sprintf("<?xml version='1.0'?>\n<%s string='%s'>\n\t<field name='%s'/>\n</%s>",values.view_type,view_string,field_name,values.view_type);var vals={'model':self.model,'name':values.view_name,'priority':values.priority,'type':values.view_type,'arch':arch};def=self.dataset.create(vals);});}});return def.promise();},on_valid_create_view:function(widgets){var msg="<ul>";_.each(widgets,function(widget){if(widget.is_invalid){msg+="<li>"+widget.name+"</li>";}});msg+="</ul>";this.do_warn(_t("The following fields are invalid :"),msg);},add_node_name:function(node){if(node.tagName.toLowerCase()=="button"||node.tagName.toLowerCase()=="field"){return(node.getAttribute('name'))?_.str.sprintf("<%s name='%s'>",node.tagName.toLowerCase(),node.getAttribute('name')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}else if(node.tagName.toLowerCase()=="group"){return(node.getAttribute('string'))?_.str.sprintf("<%s>",node.getAttribute('string')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}else{return(node.getAttribute('string'))?_.str.sprintf("<%s string='%s'>",node.tagName.toLowerCase(),node.getAttribute('string')):_.str.sprintf("<%s>",node.tagName.toLowerCase());}},do_delete_view:function(){var self=this;if(confirm(_t("Do you really want to remove this view?"))){var controller=this.action_manager.inner_widget.views[this.action_manager.inner_widget.active_view].controller;this.dataset.unlink([this.main_view_id]).done(function(){controller.reload_content();self.main_view_id=self.parent.fields_view.view_id;});}},create_View_Node:function(node){ViewNode={'level':($(node).parents()).length+1,'id':this.xml_element_id+=1,'att_list':[],'name':this.add_node_name(node),'child_id':[]};ViewNode.att_list.push(node.tagName.toLowerCase());_.each(node.attributes,function(att){ViewNode.att_list.push([att.nodeName,att.nodeValue]);});return ViewNode;},append_child_object:function(main_object,parent_id,child_obj_list){var self=this;if(main_object.id==parent_id){main_object.child_id=child_obj_list;return main_object;}else{_.each(main_object.child_id,function(child_object){self.append_child_object(child_object,parent_id,child_obj_list);});}},convert_arch_to_obj:function(xml_Node,main_object,parent_id){var self=this;var child_obj_list=[];_.each(xml_Node,function(element){child_obj_list.push(self.create_View_Node(element));});this.append_child_object(main_object,parent_id,child_obj_list);var obj_xml_list=_.zip(xml_Node,child_obj_list);_.each(obj_xml_list,function(node){var children=_.filter(node[0].childNodes,function(child){return child.nodeType==1;});if(children){self.convert_arch_to_obj(children,main_object,node[1].id);}});return main_object;},parse_xml:function(arch,view_id){main_object={'level':0,'id':this.xml_element_id+=1,'att_list':[],'name':_.str.sprintf("<view view_id = %s>",view_id),'child_id':[]};var xml_arch=QWeb.load_xml(arch);return[this.convert_arch_to_obj(xml_arch.childNodes,main_object,this.xml_element_id)];},get_arch:function(){var self=this;var view_arch_list=[];this.dataset.read_ids([parseInt(self.main_view_id)],['arch','type','priority']).done(function(arch){if(arch.length){var arch_object=self.parse_xml(arch[0].arch,self.main_view_id);self.main_view_type=arch[0].type=='tree'?'list':arch[0].type;view_arch_list.push({"view_id":self.main_view_id,"arch":arch[0].arch,"priority":arch[0].priority});self.dataset.read_slice([],{domain:[['inherit_id','=',parseInt(self.main_view_id)]]}).done(function(result){_.each(result,function(res){view_arch_list.push({"view_id":res.id,"arch":res.arch,"priority":res.priority});self.inherit_view(arch_object,res);});return self.edit_view({"main_object":arch_object,"parent_child_id":self.parent_child_list(arch_object,[]),"arch":view_arch_list});});}else{self.do_warn(_t("Please select view in list :"));}});},parent_child_list:function(one_object,parent_list){var self=this;_.each(one_object,function(element){if(element.child_id.length!=0){parent_list.push({"key":element.id,"value":_.pluck(element.child_id,'id')});self.parent_child_list(element.child_id,parent_list);}});return parent_list;},inherit_view:function(arch_object,result){var self=this,xml_list=[],xml_arch=QWeb.load_xml(result.arch);if(xml_arch.childNodes[0].tagName=="data"){xml_list=_.filter(xml_arch.childNodes[0].childNodes,function(child){return child.nodeType==1;});}else{xml_list.push(xml_arch.childNodes[0]);}
_.each(xml_list,function(xml){var expr_to_list=[],xpath_arch_object=self.parse_xml(QWeb.tools.xml_node_to_string(xml),result.id);if(xml.tagName=="xpath"){var part_expr=_.without(xml.getAttribute('expr').split("/"),"");_.each(part_expr,function(part){expr_to_list.push(_.without($.trim(part.replace(/[^a-zA-Z 0-9 _]+/g,'!')).split("!"),""));});}else{var temp=_.reject(xpath_arch_object[0].child_id[0].att_list,function(list){return list instanceof Array?_.include(list,"position"):false;});expr_to_list=[_.flatten(temp)];}
self.inherit_apply(expr_to_list,arch_object,xpath_arch_object);});},inherit_apply:function(expr_list,arch_object,xpath_arch_object){var self=this;if(xpath_arch_object.length){var check=expr_list[0],obj=false;switch(check.length){case 2:if(parseInt(check[1])){var temp_list=_.select(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});obj=arch_object[_.indexOf(arch_object,temp_list[parseInt(check[1])-1])];}else{obj=_.detect(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});}
break;case 3:obj=_.detect(arch_object,function(element){if((_.intersection(_.flatten(element.att_list),_.uniq(check))).length==_.uniq(check).length){return element;}});break;case 1:var temp_list=_.select(arch_object,function(element){return _.include(_.flatten(element.att_list),check[0]);});if(temp_list.length!=0){expr_list.length==1?obj=temp_list[0]:expr_list.shift();}
break;}
if(obj){expr_list.shift();if(expr_list.length){self.inherit_apply(expr_list,obj.child_id,xpath_arch_object);}else{self.increase_level(xpath_arch_object[0],obj.level+1);obj.child_id.push(xpath_arch_object[0]);xpath_arch_object.pop();}}else{_.each(arch_object,function(element){self.inherit_apply(expr_list,element.child_id,xpath_arch_object);});}}},increase_level:function(val,level){var self=this;val.level=level;_.each(val.child_id,function(val,key){self.increase_level(val,level+1);});},do_select_row:function(row_id){this.edit_xml_dialog.$el.find("tr[id^='viewedit-']").removeClass('ui-selected');this.edit_xml_dialog.$el.find("tr[id=viewedit-"+row_id+"]").addClass('ui-selected');},do_parent_img_hide_show:function(img){if(_.str.include($(img).attr('src'),'/web/static/src/img/collapse.gif')){$(img).attr('src','/web/static/src/img/expand.gif');this.on_expand(img);}else{$(img).attr('src','/web/static/src/img/collapse.gif');this.on_collapse(img);}},edit_view:function(one_object){var self=this;this.one_object=one_object;this.edit_xml_dialog=new instance.web.Dialog(this,{title:_.str.sprintf(_t("View Editor %d - %s"),self.main_view_id,self.model),height:'90%',buttons:[{text:_t("Inherited View"),click:function(){var selected_row=self.edit_xml_dialog.$el.find('.ui-selected');if(selected_row.length){if(selected_row.find('a').text().search("field")!=-1){if(confirm(_t("Do you really wants to create an inherited view here?"))){self.inherited_view(selected_row);}}else{alert(_t("Can't Update View"));}}else{alert(_t("Select an element"));}}},{text:_t("Preview"),click:function(){var action={context:self.session.user_context,res_model:self.model,views:[[self.main_view_id,self.main_view_type]],type:'ir.actions.act_window',target:"new",auto_search:true,flags:{sidebar:false,views_switcher:false,action_buttons:false}};var action_manager=new instance.web.ActionManager(self);action_manager.do_action(action);}},{text:_t("Close"),click:function(){self.action_manager.inner_widget.views[self.action_manager.inner_widget.active_view].controller.reload_content();self.edit_xml_dialog.close();}}]}).open();var no_property_att=[];_.each(_PROPERTIES,function(val,key){if(!val.length)no_property_att.push(key);});this.edit_xml_dialog.$el.html(QWeb.render('view_editor',{'data':one_object['main_object'],'no_properties':no_property_att}));this.edit_xml_dialog.$el.find("tr[id^='viewedit-']").click(function(){self.do_select_row(this.id.split('-')[1]);});this.edit_xml_dialog.$el.find("img[id^='parentimg-']").click(function(){self.do_parent_img_hide_show(this);});this.edit_xml_dialog.$el.find("img[id^='side-']").click(function(){self.on_select_img(this);});},inherited_view:function(selected_row){var self=this;var row_id=parseInt((selected_row.attr('id')).split('-')[1]);var obj=self.get_object_by_id(row_id,self.one_object['main_object'],[])[0];var view_name=this.model+'.inherit_'+Math.round(Math.random()*1000);var view_find=selected_row;var view_id;var min_level=parseInt(selected_row.attr('level'));while(1){view_find=view_find.prev();if(view_find.length==0||self.edit_xml_dialog.$el.find(view_find).find('a').text().search("view_id")!=-1&&parseInt(view_find.attr('level'))<min_level){view_id=parseInt($(view_find).find('a').text().replace(/[^0-9]+/g,''));break;}
if(view_find.attr('level')<min_level){min_level=parseInt(view_find.attr('level'));}}
var val=_.detect(obj.att_list,function(val){return val[0]=="name";});var priority=_.detect(self.one_object['arch'],function(val){return val.view_id==view_id;});var arch=_.str.sprintf("<?xml version='1.0'?>\n\t <field name='%s' position='after'> </field>",val[1]);var vals={'model':self.model,'name':view_name,'priority':priority.priority+1,'type':"form",'arch':arch,'inherit_id':self.main_view_id};this.dataset.create(vals).done(function(id){var arch_to_obj=self.parse_xml(arch,id);obj.child_id.push(arch_to_obj[0]);self.one_object['parent_child_id']=self.parent_child_list(self.one_object['main_object'],[]);self.one_object['arch'].push({'view_id':id,"arch":arch,'priority':priority.priority+1});self.increase_level(arch_to_obj[0],obj.level+1);self.render_inherited_view(selected_row,arch_to_obj[0]);});},render_inherited_view:function(selected_row,obj){var self=this,row_id=parseInt((selected_row.attr('id')).split('-')[1]);var clone=this.create_clone(selected_row.clone(),obj);if(selected_row.find("img[id^='parentimg-']").length==0){($(selected_row.find('a').parent()).siblings('td')).append($('<img width="16" height="16"></img>').attr('src','/web/static/src/img/collapse.gif').attr('id','parentimg-'+row_id).click(function(){self.do_parent_img_hide_show(this);}));}
self.edit_xml_dialog.$el.find("tr[id='viewedit-"+row_id+"']").after(clone.removeClass('ui-selected'));_.each(obj.child_id,function(obj){self.render_inherited_view(clone,obj);});},on_select_img:function(element_img){var self=this;var side=$(element_img).closest("tr[id^='viewedit-']");this.one_object.clicked_tr_id=parseInt((side.attr('id')).split('-')[1]);this.one_object.clicked_tr_level=parseInt(side.attr('level'));var img=side.find("img[id='parentimg-"+this.one_object.clicked_tr_id+"']").attr('src');var view_id=0,view_xml_id=0,view_find=side;var min_level=this.one_object.clicked_tr_id;if(($(side).find('a').text()).search("view_id")!=-1){view_id=parseInt(($(view_find).find('a').text()).replace(/[^0-9]+/g,''));view_xml_id=(view_find.attr('id')).split('-')[1];this.one_object.clicked_tr_id+=1;this.one_object.clicked_tr_level+=1;}else{while(1){view_find=view_find.prev();if(view_find.length==0||(self.edit_xml_dialog.$el.find(view_find).find('a').text()).search("view_id")!=-1&&parseInt(view_find.attr('level'))<min_level){view_id=parseInt(($(view_find).find('a').text()).replace(/[^0-9]+/g,''));view_xml_id=parseInt((view_find.attr('id')).split('-')[1]);break;}
if(view_find.attr('level')<min_level){min_level=parseInt(view_find.attr('level'));}}}
this.one_object.clicked_tr_view=[view_id,view_xml_id];switch(element_img.id){case"side-add":self.do_node_add(side);break;case"side-remove":if(confirm(_t("Do you really want to remove this node?"))){self.do_save_update_arch("remove_node");}
break;case"side-edit":self.do_node_edit(side);break;case"side-up":self.do_node_up(side,img);break;case"side-down":self.do_node_down(side,img);break;}},do_node_add:function(side){var self=this,property_to_check=[];var tr=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object['main_object'],[])[0].att_list[0];var parent_tr=($(side).prevAll("tr[level="+String(this.one_object.clicked_tr_level-1)+"]"))[0];var field_dataset=new instance.web.DataSetSearch(this,this.model,null,null);parent_tr=self.get_object_by_id(parseInt($(parent_tr).attr('id').replace(/[^0-9]+/g,'')),this.one_object['main_object'],[])[0].att_list[0];_.each([tr,parent_tr],function(element){var value=_.has(_CHILDREN,element)?element:_.str.include(html_tag,element)?"html_tag":false;property_to_check.push(value);});field_dataset.call('fields_get',[]).done(function(result){var fields=_.keys(result);fields.push(" "),fields.sort();self.on_add_node(property_to_check,fields);});},do_node_edit:function(side){var self=this;var result=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object['main_object'],[]);if(result.length&&result[0]&&result[0].att_list){var properties=_PROPERTIES[result[0].att_list[0]];self.on_edit_node(properties);}},do_node_down:function(cur_tr,img){var self=this,next_tr,last_tr,tr_to_move=[];tr_to_move.push(cur_tr);if(img){while(1){next_tr=cur_tr.next();if(parseInt(next_tr.attr('level'))<=this.one_object.clicked_tr_level||next_tr.length==0){last_tr=next_tr;break;}else{tr_to_move.push(next_tr);cur_tr=next_tr;}}}else{last_tr=cur_tr.next();}
if((self.edit_xml_dialog.$el.find(last_tr).find('a').text()).search("view_id")!=-1){return false;}
if(last_tr.length!=0&&parseInt(last_tr.attr('level'))==this.one_object.clicked_tr_level){var last_tr_id=(last_tr.attr('id')).split('-')[1];img=last_tr.find("img[id='parentimg-"+last_tr_id+"']").attr('src');if(img){self.edit_xml_dialog.$el.find("img[id='parentimg-"+last_tr_id+"']").attr('src','/web/static/src/img/expand.gif');while(1){var next_tr=last_tr.next();if(next_tr.attr('level')<=this.one_object.clicked_tr_level||next_tr.length==0)break;next_tr.hide();last_tr=next_tr;}}
tr_to_move.reverse();_.each(tr_to_move,function(rec){$(last_tr).after(rec);});self.do_save_update_arch("down");}},do_node_up:function(cur_tr,img){var self=this,side=cur_tr,tr_to_move=[];tr_to_move.push(side);while(1){var prev_tr=cur_tr.prev();if(this.one_object.clicked_tr_level>=parseInt(prev_tr.attr('level'))||prev_tr.length==0){last_tr=prev_tr;break;}
cur_tr=prev_tr;}
if(img){self.edit_xml_dialog.$el.find("img[id='parentimg-"+this.one_object.clicked_tr_id+"']").attr('src','/web/static/src/img/expand.gif');while(1){next_tr=side.next();if(parseInt(next_tr.attr('level'))<=this.one_object.clicked_tr_level||next_tr.length==0){break;}else{next_tr.hide();tr_to_move.push(next_tr);side=next_tr;}}}
if(last_tr.length!=0&&parseInt(last_tr.attr('level'))==this.one_object.clicked_tr_level&&(self.edit_xml_dialog.$el.find(last_tr).find('a').text()).search("view_id")==-1){_.each(tr_to_move,function(rec){$(last_tr).before(rec);});self.do_save_update_arch("up");}},do_save_update_arch:function(move_direct,update_values){var self=this;var arch=_.detect(self.one_object['arch'],function(element)
{return element.view_id==self.one_object.clicked_tr_view[0]});var obj=self.get_object_by_id(this.one_object.clicked_tr_view[1],this.one_object['main_object'],[]);var xml_arch=QWeb.load_xml(arch.arch);if(xml_arch.childNodes[0].tagName=="data"){var check_list=_.flatten(obj[0].child_id[0].att_list);var children=_.filter(xml_arch.childNodes[0].childNodes,function(child){return child.nodeType==1;});arch.arch=_.detect(children,function(xml_child){var temp_obj=self.create_View_Node(xml_child),insert=_.intersection(_.flatten(temp_obj.att_list),_.uniq(check_list));if(insert.length==_.uniq(check_list).length){return xml_child;}});xml_arch=QWeb.load_xml(arch.arch);}
return self.do_save_xml(xml_arch.documentElement,obj[0].child_id[0],obj[0].child_id,move_direct,update_values,arch);},get_object_by_id:function(id,one_object,result){var self=this;if(result.length==0){var check=_.detect(one_object,function(obj){return id==obj.id;});if(check){result.push(check);}
_.each(one_object,function(obj){self.get_object_by_id(id,obj.child_id,result);});}
return result;},create_clone:function(clone,new_node_obj){var self=this;clone.find('a').text(new_node_obj.name);($(clone.find('a').parent()).siblings('td')).css("padding-left",20*new_node_obj.level);clone.attr("id","viewedit-"+new_node_obj.id);clone.attr("level",new_node_obj.level);clone.find("img[id^='parentimg-']").remove();clone.bind("click",function(){self.do_select_row(this.id.split('-')[1]);});clone.find("img[id^='side-']").click(function(){self.on_select_img(this);});return clone;},do_save_xml:function(arch1,obj,child_list,move_direct,update_values,arch){var self=this,children_list=$(arch1).children(),list_obj_xml;try{list_obj_xml=_.zip(children_list,obj.child_id);}catch(err){return;}
if(this.one_object.clicked_tr_id){if(obj.id==this.one_object.clicked_tr_id){var parent=false,index=_.indexOf(child_list,obj);if(move_direct=="down"){var next=$(arch1).next();$(next).after(arch1);var re_insert_obj=child_list.splice(index,1);child_list.splice(index+1,0,re_insert_obj[0]);parent=$(arch1).parents();}else if(move_direct=="up"){var prev=$(arch1).prev();$(prev).before(arch1);var re_insert_obj=child_list.splice(index,1);child_list.splice(index-1,0,re_insert_obj[0]);parent=$(arch1).parents();}else if(move_direct=="update_node"){_.each(update_values,function(val){if(val[1])$(arch1)[0].setAttribute(val[0],val[1]);else $(arch1)[0].removeAttribute(val[0]);});var new_obj=self.create_View_Node(arch1);new_obj.id=obj.id,new_obj.child_id=obj.child_id;self.edit_xml_dialog.$el.find("tr[id='viewedit-"+this.one_object.clicked_tr_id+"']").find('a').text(new_obj.name);child_list.splice(index,1,new_obj);parent=$(arch1).parents();}else if(move_direct=="add_node"){var tr_click=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+self.one_object.clicked_tr_id+"']"),temp_xml=QWeb.load_xml(update_values[0]),object_xml=self.create_View_Node(temp_xml.childNodes[0]);(update_values[1]=="Inside")?object_xml.level=obj.level+1:object_xml.level=obj.level;var clone=self.create_clone(tr_click.clone(),object_xml),after_append=_.detect(self.one_object['parent_child_id'],function(ele){return self.one_object.clicked_tr_id==ele.key;});after_append=(after_append)?_.last(after_append.value):self.one_object.clicked_tr_id;switch(update_values[1]){case"After":self.edit_xml_dialog.$el.find("tr[id='viewedit-"+after_append+"']").after(clone);$(arch1).after($(update_values[0]));child_list.splice(index+1,0,object_xml);break;case"Before":tr_click.before(clone);$(arch1).before($(update_values[0]));child_list.splice(index-1,0,object_xml);break;case"Inside":if(tr_click.find("img[id^='parentimg-']").length==0){($(tr_click.find('a').parent()).siblings('td')).append($('<img width="16" height="16"></img>').attr('src','/web/static/src/img/collapse.gif').attr('id','parentimg-'+self.one_object.clicked_tr_id).click(function(){self.do_parent_img_hide_show(this);}));}
$(arch1).append($(update_values[0]));self.edit_xml_dialog.$el.find("tr[id='viewedit-"+after_append+"']").after(clone);obj.child_id.push(object_xml);break;}
self.edit_xml_dialog.$el.find("tr[id='viewedit-"+object_xml.id+"']").removeClass('ui-selected');parent=$(arch1).parents();}else if(move_direct=="remove_node"){parent=$(arch1).parents();if(parent.length==0||(parent[0].tagName.toLowerCase()=="data")){self.one_object.clicked_tr_id=self.one_object.clicked_tr_id-1;self.one_object.clicked_tr_level=self.one_object.clicked_tr_level-1;(parent.length==0)?parent.push("remove_view"):false;}
$(arch1).remove();child_list.splice(index,1);var cur_tr=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+self.one_object.clicked_tr_id+"']");_.each(self.get_list_tr(cur_tr,self.one_object.clicked_tr_level),function(tr_element){tr_element.remove();});cur_tr.remove();var parent_img=_.detect(self.one_object['parent_child_id'],function(element){return _.include(element.value,self.one_object.clicked_tr_id);});if(parent_img.value.length==1){self.edit_xml_dialog.$el.find("tr[id='viewedit-"+parent_img.key+"']").find("img[id^='parentimg-']").remove();}
self.one_object['parent_child_id']=self.parent_child_list(self.one_object['main_object'],[]);}
var convert_to_utf=(parent.length!=0)?parent[parent.length-1]:arch1;if(convert_to_utf!="remove_view"){convert_to_utf=QWeb.tools.xml_node_to_string(convert_to_utf);convert_to_utf=convert_to_utf.replace('xmlns="http://www.w3.org/1999/xhtml"',"");convert_to_utf='<?xml version="1.0"?>'+convert_to_utf;arch.arch=convert_to_utf;this.dataset.write(this.one_object.clicked_tr_view[0],{"arch":convert_to_utf});}else{this.dataset.unlink([this.one_object.clicked_tr_view[0]]);}
if(move_direct=="add_node"){self.add_node_dialog.close();self.on_select_img(clone.find("img[id='side-edit']")[0]);self.one_object['parent_child_id']=self.parent_child_list(self.one_object['main_object'],[]);}}
if(obj.level<=this.one_object.clicked_tr_level){_.each(list_obj_xml,function(child_node){self.do_save_xml(child_node[0],child_node[1],obj.child_id,move_direct,update_values,arch);});}}},on_expand:function(expand_img){var level=parseInt($(expand_img).closest("tr[id^='viewedit-']").attr('level'));var cur_tr=$(expand_img).closest("tr[id^='viewedit-']");_.each(this.get_list_tr(cur_tr,level),function(tr_element){tr_element.hide();});},get_list_tr:function(cur_tr,level){tr_list=[];while(1){var nxt_tr=cur_tr.next();if(parseInt(nxt_tr.attr('level'))>level){cur_tr=nxt_tr;tr_list.push(nxt_tr);}else return tr_list;}},on_collapse:function(collapse_img){var self=this,id=collapse_img.id.split('-')[1];var datas=_.detect(self.one_object['parent_child_id'],function(res){return res.key==id;});_.each(datas.value,function(rec){var tr=self.edit_xml_dialog.$el.find("tr[id='viewedit-"+rec+"']");tr.find("img[id='parentimg-"+rec+"']").attr('src','/web/static/src/img/expand.gif');tr.show();});},on_edit_node:function(properties){var self=this;this.edit_node_dialog=new instance.web.Dialog(this,{title:_t("Properties"),width:450,buttons:[{text:_t("Update"),click:function(){var warn=false,update_values=[];_.each(self.edit_widget,function(widget){if(widget.is_invalid){warn=true;return false;}
if(widget.dirty&&!widget.is_invalid){update_values.push([widget.name,widget.get_value()]);}});if(warn){self.on_valid_create_view(self.edit_widget);}else{self.do_save_update_arch("update_node",update_values);self.edit_node_dialog.close();}}},{text:_t("Cancel"),click:function(){self.edit_node_dialog.close();}}]}).open();var _PROPERTIES_ATTRIBUTES={'name':{'name':'name','string':'Name','type':'char'},'string':{'name':'string','string':'String','type':'char'},'required':{'name':'required','string':'Required','type':'boolean'},'readonly':{'name':'readonly','string':'Readonly','type':'boolean'},'invisible':{'name':'invisible','string':'Invisible','type':'boolean'},'domain':{'name':'domain','string':'Domain','type':'char'},'context':{'name':'context','string':'Context','type':'char'},'limit':{'name':'limit','string':'Limit','type':'float'},'min_rows':{'name':'min_rows','string':'Minimum rows','type':'float'},'date_start':{'name':'date_start','string':'Start date','type':'char'},'date_delay':{'name':'date_delay','string':'Delay date','type':'char'},'day_length':{'name':'day_length','string':'Day length','type':'char'},'mode':{'name':'mode','string':'Mode','type':'char'},'align':{'name':'align','string':'Alignment ','type':'selection','selection':[['',''],['0.0','Left'],['0.5','Center'],['1.0','Right']]},'icon':{'name':'icon','string':'Icon','type':'selection','selection':_ICONS},'type':{'name':'type','string':'Type','type':'selection','selection':[['',''],['action','Action'],['object','Object'],['workflow','Workflow'],['server_action','Server Action']]},'special':{'name':'special','string':'Special','type':'selection','selection':[['',''],['save','Save Button'],['cancel','Cancel Button'],['open','Open Button']]},'target':{'name':'target','string':'Target','type':'selection','selection':[['',''],['new','New Window']]},'confirm':{'name':'confirm','string':'Confirm','type':'char'},'style':{'name':'style','string':'Style','type':'selection','selection':[["",""],["1","1"],["1-1","1-1"],["1-2","1-2"],["2-1","2-1"],["1-1-1","1-1-1"]]},'filename':{'name':'filename','string':'File Name','type':'char'},'width':{'name':'width','string':'Width','type':'float'},'height':{'name':'height','string':'Height','type':'float'},'attrs':{'name':'attrs','string':'Attrs','type':'char'},'col':{'name':'col','string':'col','type':'float'},'link':{'name':'link','string':'Link','type':'char'},'position':{'name':'position','string':'Position','type':'selection','selection':[['',''],['after','After'],['before','Before'],['inside','Inside'],['replace','Replace']]},'states':{'name':'states','string':'states','type':'char'},'eval':{'name':'eval','string':'Eval','type':'char'},'ref':{'name':'ref','string':'Ref','type':'char'},'on_change':{'name':'on_change','string':'On change','type':'char'},'nolabel':{'name':'nolabel','string':'No label','type':'boolean'},'completion':{'name':'completion','string':'Completion','type':'boolean'},'colspan':{'name':'colspan','string':'Colspan','type':'float'},'widget':{'name':'widget','string':'widget','type':'selection'},'colors':{'name':'colors','string':'Colors','type':'char'},'editable':{'name':'editable','string':'Editable','type':'selection','selection':[["",""],["top","Top"],["bottom","Bottom"]]},'groups':{'name':'groups','string':'Groups','type':'selection_multi'},'fonts':{'name':'fonts','string':'fonts','type':'char'},};var arch_val=self.get_object_by_id(this.one_object.clicked_tr_id,this.one_object['main_object'],[]);this.edit_node_dialog.$el.append('<table id="rec_table"  style="width:400px" class="oe_form"></table>');this.edit_widget=[];self.ready=$.when(self.on_groups(properties)).done(function(){_PROPERTIES_ATTRIBUTES['groups']['selection']=self.groups;var values=_.keys(instance.web.form.widgets.map);values.push('');values.sort();_PROPERTIES_ATTRIBUTES['widget']['selection']=values;var widgets=_.filter(_PROPERTIES_ATTRIBUTES,function(property){return _.include(properties,property.name)});_.each(widgets,function(widget){var type_widget=new(self.property.get_any([widget.type]))(self.edit_node_dialog,widget);var value=_.detect(arch_val[0]['att_list'],function(res){return res instanceof Array?_.include(res,widget.name):false;});value=value instanceof Array?value[1]:value;self.edit_node_dialog.$el.find('table[id=rec_table]').append('<tr><td align="right">'+widget.string+':</td>'+type_widget.render()+'</tr>');type_widget.start();type_widget.set_value(value);self.edit_widget.push(type_widget);});});},on_groups:function(properties){var self=this,def=$.Deferred();if(!_.include(properties,'groups')){self.groups=false;def.resolve();}
var group_ids=[],group_names={},groups=[];var res_groups=new instance.web.DataSetSearch(this,'res.groups',null,null),model_data=new instance.web.DataSetSearch(self,'ir.model.data',null,null);res_groups.read_slice([],{}).done(function(res_grp){_.each(res_grp,function(res){var key=res.id;group_names[key]=res.full_name;group_ids.push(res.id);});model_data.read_slice([],{domain:[['res_id','in',group_ids],['model','=','res.groups']]}).done(function(model_grp){_.each(model_grp,function(res_group){groups.push([res_group.module+"."+res_group.name,group_names[res_group.res_id]]);});self.groups=groups;def.resolve();});});return def.promise();},on_add_node:function(properties,fields){var self=this;var render_list=[{'name':'node_type','selection':_.keys(_CHILDREN).sort(),'value':'field','string':'Node Type','type':'selection'},{'name':'field_value','selection':fields,'value':false,'string':'','type':'selection'},{'name':'position','selection':['After','Before','Inside'],'value':false,'string':'Position','type':'selection'}];this.add_widget=[];this.add_node_dialog=new instance.web.Dialog(this,{title:_t("Properties"),width:450,buttons:[{text:_t("Update"),click:function(){var check_add_node=true,values={};_.each(self.add_widget,function(widget){values[widget.name]=widget.get_value()||false;});(values.position=="Inside")?check_add_node=(_.include(_CHILDREN[properties[0]],values.node_type))?true:false:check_add_node=(_.include(_CHILDREN[properties[1]],values.node_type))?true:false;if(values.node_type=="field"&&check_add_node)
{check_add_node=(values.field_value!=" ")?true:false;}
if(check_add_node){var tag=(values.node_type=="field")?_.str.sprintf("<%s name='%s'> </%s>",values.node_type,values.field_value,values.node_type):_.str.sprintf("<%s> </%s>",values.node_type,values.node_type);self.do_save_update_arch("add_node",[tag,values.position]);}else{alert("Can't Update View");}}},{text:_t("Cancel"),click:function(){self.add_node_dialog.close();}}]}).open();this.add_node_dialog.$el.append('<table id="rec_table"  style="width:420px" class="oe_form"><tbody><tr></tbody></table>');var table_selector=self.add_node_dialog.$el.find('table[id=rec_table] tbody');_.each(render_list,function(node){type_widget=new(self.property.get_any([node.type]))(self.add_node_dialog,node);if(node.name=="position"){table_selector.append('</tr><tr><td align="right" width="100px">'+node.string+'</td>'+type_widget.render()+'</tr>');}else{table_selector.append('<td align="right">'+node.string+'</td>'+type_widget.render());if(node.name=="field_value"){table_selector.append('<td id="new_field" align="right"  width="100px"> <button>'+_.str.escapeHTML(_t("New Field"))+'</button></td>');}}
type_widget.start();type_widget.set_value(node.value);self.add_widget.push(type_widget);});table_selector.find("td[id^=]").attr("width","100px");self.add_node_dialog.$el.find('#new_field').click(function(){model_data=new instance.web.DataSetSearch(self,'ir.model',null,null);model_data.read_slice([],{domain:[['model','=',self.model]]}).done(function(result){self.render_new_field(result[0]);});});},render_new_field:function(result){var self=this;var action={context:{'default_model_id':result.id,'manual':true,'module':result.model},res_model:"ir.model.fields",views:[[false,'form']],type:'ir.actions.act_window',target:"new",flags:{action_buttons:true}};var action_manager=new instance.web.ActionManager(self);$.when(action_manager.do_action(action)).done(function(){var controller=action_manager.dialog_widget.views['form'].controller;controller.on("on_button_cancel",self,function(){action_manager.destroy();});controller.on("save",self,function(){action_manager.destroy();var value=controller.fields.name.get('value');self.add_node_dialog.$el.find('select[id=field_value]').append($("<option selected></option>").attr("value",value).text(value));_.detect(self.add_widget,function(widget){widget.name=="field_value"?widget.selection.push(value):false;});});});}});instance.web_view_editor.ViewEditor.Field=instance.web.Class.extend({init:function(view,widget){this.$el=view.$el;this.dirty=false;this.name=widget.name;this.selection=widget.selection||[];this.required=widget.required||false;this.string=widget.string||"";this.type=widget.type;this.is_invalid=false;},start:function(){this.update_dom();},update_dom:function(){this.$el.find("td[id="+this.name+"]").toggleClass('invalid',this.is_invalid);this.$el.find("td[id="+this.name+"]").toggleClass('required',this.required);},on_ui_change:function(){this.validate();this.dirty=true;this.update_dom();},validate:function(){this.is_invalid=false;try{var value=instance.web.parse_value(this.get_value(),this,'');this.is_invalid=this.required&&value==='';}catch(e){this.is_invalid=true;}},render:function(){return _.str.sprintf("<td id = %s>%s</td>",this.name,QWeb.render(this.template,{widget:this}))}});instance.web_view_editor.ViewEditor.FieldBoolean=instance.web_view_editor.ViewEditor.Field.extend({template:"vieweditor_boolean",start:function(){var self=this;this._super();this.$el.find("input[id="+self.name+"]").change(function(){self.on_ui_change();});},set_value:function(value){if(value){this.$el.find("input[id="+this.name+"]").attr('checked',true);}},get_value:function(){return this.$el.find("input[id="+this.name+"]").is(':checked')?"1":null;}});instance.web_view_editor.ViewEditor.FieldChar=instance.web_view_editor.ViewEditor.Field.extend({template:"vieweditor_char",start:function(){var self=this;this._super();this.$el.find("input[id="+this.name+"]").css('width','100%').change(function(){self.on_ui_change();});},set_value:function(value){this.$el.find("input[id="+this.name+"]").val(value);},get_value:function(){return this.$el.find("input[id="+this.name+"]").val();}});instance.web_view_editor.ViewEditor.FieldSelect=instance.web_view_editor.ViewEditor.Field.extend({template:"vieweditor_selection",start:function(){var self=this;this._super();this.$el.find("select[id="+this.name+"]").css('width','100%').change(function(){self.on_ui_change();if(self.name=="node_type"){if(self.get_value()=="field"){self.$el.find('#new_field').show();self.$el.find("select[id=field_value]").show();}else{self.$el.find('#new_field').hide();self.$el.find("select[id=field_value]").hide();}}});},set_value:function(value){var index=0;value=value===null?false:value;for(var i=0,ii=this.selection.length;i<ii;i++){if((this.selection[i]instanceof Array&&this.selection[i][0]===value)||this.selection[i]===value)index=i;}
this.$el.find("select[id="+this.name+"]")[0].selectedIndex=index;},get_value:function(){return this.$el.find("select[id="+this.name+"]").val();}});instance.web_view_editor.ViewEditor.FieldSelectMulti=instance.web_view_editor.ViewEditor.FieldSelect.extend({start:function(){this._super();this.$el.find("select[id="+this.name+"]").css('height','100px').attr("multiple",true);},set_value:function(value){var self=this;self.$el.find("#groups option").attr("selected",false);if(!value)return false;_.each(this.selection,function(item){if(_.include(value.split(','),item[0])){self.$el.find("select[id="+self.name+"] option[value='"+item[0]+"']").attr("selected",1)}});}});instance.web_view_editor.ViewEditor.FieldFloat=instance.web_view_editor.ViewEditor.FieldChar.extend({});var _PROPERTIES={'field':['name','string','required','readonly','invisible','domain','context','nolabel','completion','colspan','widget','eval','ref','on_change','attrs','groups'],'form':['string','col','link'],'notebook':['colspan','position','groups'],'page':['string','states','attrs','groups'],'group':['string','col','colspan','invisible','states','attrs','groups'],'image':['filename','width','height','groups'],'separator':['string','colspan','groups'],'label':['string','align','colspan','groups'],'button':['name','string','icon','type','states','readonly','special','target','confirm','context','attrs','colspan','groups'],'newline':[],'board':['style'],'column':[],'action':['name','string','colspan','groups'],'tree':['string','colors','editable','link','limit','min_rows','fonts'],'graph':['string','type'],'calendar':['string','date_start','date_stop','date_delay','day_length','color','mode']};var _CHILDREN={'form':['notebook','group','field','label','button','board','newline','separator'],'tree':['field'],'graph':['field'],'calendar':['field'],'notebook':['page'],'page':['notebook','group','field','label','button','newline','separator'],'group':['field','label','button','separator','newline','group'],'board':['column'],'action':[],'field':['form','tree','graph','field'],'label':[],'button':[],'newline':[],'separator':[],'sheet':['group','field','notebook','label','separator','div','page'],'kanban':['field'],'html_tag':['notebook','group','field','label','button','board','newline','separator']};var html_tag=['div','h1','h2','h3','h4','h5','h6','td','tr'];var _ICONS=['','STOCK_ABOUT','STOCK_ADD','STOCK_APPLY','STOCK_BOLD','STOCK_CANCEL','STOCK_CDROM','STOCK_CLEAR','STOCK_CLOSE','STOCK_COLOR_PICKER','STOCK_CONNECT','STOCK_CONVERT','STOCK_COPY','STOCK_CUT','STOCK_DELETE','STOCK_DIALOG_AUTHENTICATION','STOCK_DIALOG_ERROR','STOCK_DIALOG_INFO','STOCK_DIALOG_QUESTION','STOCK_DIALOG_WARNING','STOCK_DIRECTORY','STOCK_DISCONNECT','STOCK_DND','STOCK_DND_MULTIPLE','STOCK_EDIT','STOCK_EXECUTE','STOCK_FILE','STOCK_FIND','STOCK_FIND_AND_REPLACE','STOCK_FLOPPY','STOCK_GOTO_BOTTOM','STOCK_GOTO_FIRST','STOCK_GOTO_LAST','STOCK_GOTO_TOP','STOCK_GO_BACK','STOCK_GO_DOWN','STOCK_GO_FORWARD','STOCK_GO_UP','STOCK_HARDDISK','STOCK_HELP','STOCK_HOME','STOCK_INDENT','STOCK_INDEX','STOCK_ITALIC','STOCK_JUMP_TO','STOCK_JUSTIFY_CENTER','STOCK_JUSTIFY_FILL','STOCK_JUSTIFY_LEFT','STOCK_JUSTIFY_RIGHT','STOCK_MEDIA_FORWARD','STOCK_MEDIA_NEXT','STOCK_MEDIA_PAUSE','STOCK_MEDIA_PLAY','STOCK_MEDIA_PREVIOUS','STOCK_MEDIA_RECORD','STOCK_MEDIA_REWIND','STOCK_MEDIA_STOP','STOCK_MISSING_IMAGE','STOCK_NETWORK','STOCK_NEW','STOCK_NO','STOCK_OK','STOCK_OPEN','STOCK_PASTE','STOCK_PREFERENCES','STOCK_PRINT','STOCK_PRINT_PREVIEW','STOCK_PROPERTIES','STOCK_QUIT','STOCK_REDO','STOCK_REFRESH','STOCK_REMOVE','STOCK_REVERT_TO_SAVED','STOCK_SAVE','STOCK_SAVE_AS','STOCK_SELECT_COLOR','STOCK_SELECT_FONT','STOCK_SORT_ASCENDING','STOCK_SORT_DESCENDING','STOCK_SPELL_CHECK','STOCK_STOP','STOCK_STRIKETHROUGH','STOCK_UNDELETE','STOCK_UNDERLINE','STOCK_UNDO','STOCK_UNINDENT','STOCK_YES','STOCK_ZOOM_100','STOCK_ZOOM_FIT','STOCK_ZOOM_IN','STOCK_ZOOM_OUT','terp-account','terp-crm','terp-mrp','terp-product','terp-purchase','terp-sale','terp-tools','terp-administration','terp-hr','terp-partner','terp-project','terp-report','terp-stock','terp-calendar','terp-graph'];instance.web_view_editor.ViewEditor.property_widget=new instance.web.Registry({'boolean':'instance.web_view_editor.ViewEditor.FieldBoolean','selection_multi':'instance.web_view_editor.ViewEditor.FieldSelectMulti','selection':'instance.web_view_editor.ViewEditor.FieldSelect','char':'instance.web_view_editor.ViewEditor.FieldChar','float':'instance.web_view_editor.ViewEditor.FieldFloat'});};;(function(glob){var version="0.3.4",has="hasOwnProperty",separator=/[\.\/]/,wildcard="*",fun=function(){},numsort=function(a,b){return a-b;},current_event,stop,events={n:{}},eve=function(name,scope){var e=events,oldstop=stop,args=Array.prototype.slice.call(arguments,2),listeners=eve.listeners(name),z=0,f=false,l,indexed=[],queue={},out=[],ce=current_event,errors=[];current_event=name;stop=0;for(var i=0,ii=listeners.length;i<ii;i++)if("zIndex"in listeners[i]){indexed.push(listeners[i].zIndex);if(listeners[i].zIndex<0){queue[listeners[i].zIndex]=listeners[i];}}
indexed.sort(numsort);while(indexed[z]<0){l=queue[indexed[z++]];out.push(l.apply(scope,args));if(stop){stop=oldstop;return out;}}
for(i=0;i<ii;i++){l=listeners[i];if("zIndex"in l){if(l.zIndex==indexed[z]){out.push(l.apply(scope,args));if(stop){break;}
do{z++;l=queue[indexed[z]];l&&out.push(l.apply(scope,args));if(stop){break;}}while(l)}else{queue[l.zIndex]=l;}}else{out.push(l.apply(scope,args));if(stop){break;}}}
stop=oldstop;current_event=ce;return out.length?out:null;};eve.listeners=function(name){var names=name.split(separator),e=events,item,items,k,i,ii,j,jj,nes,es=[e],out=[];for(i=0,ii=names.length;i<ii;i++){nes=[];for(j=0,jj=es.length;j<jj;j++){e=es[j].n;items=[e[names[i]],e[wildcard]];k=2;while(k--){item=items[k];if(item){nes.push(item);out=out.concat(item.f||[]);}}}
es=nes;}
return out;};eve.on=function(name,f){var names=name.split(separator),e=events;for(var i=0,ii=names.length;i<ii;i++){e=e.n;!e[names[i]]&&(e[names[i]]={n:{}});e=e[names[i]];}
e.f=e.f||[];for(i=0,ii=e.f.length;i<ii;i++)if(e.f[i]==f){return fun;}
e.f.push(f);return function(zIndex){if(+zIndex==+zIndex){f.zIndex=+zIndex;}};};eve.stop=function(){stop=1;};eve.nt=function(subname){if(subname){return new RegExp("(?:\\.|\\/|^)"+subname+"(?:\\.|\\/|$)").test(current_event);}
return current_event;};eve.off=eve.unbind=function(name,f){var names=name.split(separator),e,key,splice,i,ii,j,jj,cur=[events];for(i=0,ii=names.length;i<ii;i++){for(j=0;j<cur.length;j+=splice.length-2){splice=[j,1];e=cur[j].n;if(names[i]!=wildcard){if(e[names[i]]){splice.push(e[names[i]]);}}else{for(key in e)if(e[has](key)){splice.push(e[key]);}}
cur.splice.apply(cur,splice);}}
for(i=0,ii=cur.length;i<ii;i++){e=cur[i];while(e.n){if(f){if(e.f){for(j=0,jj=e.f.length;j<jj;j++)if(e.f[j]==f){e.f.splice(j,1);break;}
!e.f.length&&delete e.f;}
for(key in e.n)if(e.n[has](key)&&e.n[key].f){var funcs=e.n[key].f;for(j=0,jj=funcs.length;j<jj;j++)if(funcs[j]==f){funcs.splice(j,1);break;}
!funcs.length&&delete e.n[key].f;}}else{delete e.f;for(key in e.n)if(e.n[has](key)&&e.n[key].f){delete e.n[key].f;}}
e=e.n;}}};eve.once=function(name,f){var f2=function(){var res=f.apply(this,arguments);eve.unbind(name,f2);return res;};return eve.on(name,f2);};eve.version=version;eve.toString=function(){return"You are running Eve "+version;};(typeof module!="undefined"&&module.exports)?(module.exports=eve):(typeof define!="undefined"?(define("eve",[],function(){return eve;})):(glob.eve=eve));})(this);(function(){function R(first){if(R.is(first,"function")){return loaded?first():eve.on("DOMload",first);}else if(R.is(first,array)){return R._engine.create[apply](R,first.splice(0,3+R.is(first[0],nu))).add(first);}else{var args=Array.prototype.slice.call(arguments,0);if(R.is(args[args.length-1],"function")){var f=args.pop();return loaded?f.call(R._engine.create[apply](R,args)):eve.on("DOMload",function(){f.call(R._engine.create[apply](R,args));});}else{return R._engine.create[apply](R,arguments);}}}
R.version="2.0.2";R.eve=eve;var loaded,separator=/[, ]+/,elements={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},formatrg=/\{(\d+)\}/g,proto="prototype",has="hasOwnProperty",g={doc:document,win:window},oldRaphael={was:Object.prototype[has].call(g.win,"Raphael"),is:g.win.Raphael},Paper=function(){this.ca=this.customAttributes={};},paperproto,appendChild="appendChild",apply="apply",concat="concat",supportsTouch="createTouch"in g.doc,E="",S=" ",Str=String,split="split",events="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),touchMap={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},lowerCase=Str.prototype.toLowerCase,math=Math,mmax=math.max,mmin=math.min,abs=math.abs,pow=math.pow,PI=math.PI,nu="number",string="string",array="array",toString="toString",fillString="fill",objectToString=Object.prototype.toString,paper={},push="push",ISURL=R._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,colourRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,isnan={"NaN":1,"Infinity":1,"-Infinity":1},bezierrg=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,round=math.round,setAttribute="setAttribute",toFloat=parseFloat,toInt=parseInt,upperCase=Str.prototype.toUpperCase,availableAttrs=R._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},availableAnimAttrs=R._availableAnimAttrs={blur:nu,"clip-rect":"csv",cx:nu,cy:nu,fill:"colour","fill-opacity":nu,"font-size":nu,height:nu,opacity:nu,path:"path",r:nu,rx:nu,ry:nu,stroke:"colour","stroke-opacity":nu,"stroke-width":nu,transform:"transform",width:nu,x:nu,y:nu},whitespace=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,commaSpaces=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,hsrg={hs:1,rg:1},p2s=/,?([achlmqrstvxz]),?/gi,pathCommand=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,tCommand=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,radial_gradient=R._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,eldata={},sortByKey=function(a,b){return a.key-b.key;},sortByNumber=function(a,b){return toFloat(a)-toFloat(b);},fun=function(){},pipe=function(x){return x;},rectPath=R._rectPath=function(x,y,w,h,r){if(r){return[["M",x+r,y],["l",w-r*2,0],["a",r,r,0,0,1,r,r],["l",0,h-r*2],["a",r,r,0,0,1,-r,r],["l",r*2-w,0],["a",r,r,0,0,1,-r,-r],["l",0,r*2-h],["a",r,r,0,0,1,r,-r],["z"]];}
return[["M",x,y],["l",w,0],["l",0,h],["l",-w,0],["z"]];},ellipsePath=function(x,y,rx,ry){if(ry==null){ry=rx;}
return[["M",x,y],["m",0,-ry],["a",rx,ry,0,1,1,0,2*ry],["a",rx,ry,0,1,1,0,-2*ry],["z"]];},getPath=R._getPath={path:function(el){return el.attr("path");},circle:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.r);},ellipse:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.rx,a.ry);},rect:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height,a.r);},image:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height);},text:function(el){var bbox=el._getBBox();return rectPath(bbox.x,bbox.y,bbox.width,bbox.height);}},mapPath=R.mapPath=function(path,matrix){if(!matrix){return path;}
var x,y,i,j,ii,jj,pathi;path=path2curve(path);for(i=0,ii=path.length;i<ii;i++){pathi=path[i];for(j=1,jj=pathi.length;j<jj;j+=2){x=matrix.x(pathi[j],pathi[j+1]);y=matrix.y(pathi[j],pathi[j+1]);pathi[j]=x;pathi[j+1]=y;}}
return path;};R._g=g;R.type=(g.win.SVGAngle||g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(R.type=="VML"){var d=g.doc.createElement("div"),b;d.innerHTML='<v:shape adj="1"/>';b=d.firstChild;b.style.behavior="url(#default#VML)";if(!(b&&typeof b.adj=="object")){return(R.type=E);}
d=null;}
R.svg=!(R.vml=R.type=="VML");R._Paper=Paper;R.fn=paperproto=Paper.prototype=R.prototype;R._id=0;R._oid=0;R.is=function(o,type){type=lowerCase.call(type);if(type=="finite"){return!isnan[has](+o);}
if(type=="array"){return o instanceof Array;}
return(type=="null"&&o===null)||(type==typeof o&&o!==null)||(type=="object"&&o===Object(o))||(type=="array"&&Array.isArray&&Array.isArray(o))||objectToString.call(o).slice(8,-1).toLowerCase()==type;};R.angle=function(x1,y1,x2,y2,x3,y3){if(x3==null){var x=x1-x2,y=y1-y2;if(!x&&!y){return 0;}
return(180+math.atan2(-y,-x)*180/PI+360)%360;}else{return R.angle(x1,y1,x3,y3)-R.angle(x2,y2,x3,y3);}};R.rad=function(deg){return deg%360*PI/180;};R.deg=function(rad){return rad*180/PI%360;};R.snapTo=function(values,value,tolerance){tolerance=R.is(tolerance,"finite")?tolerance:10;if(R.is(values,array)){var i=values.length;while(i--)if(abs(values[i]-value)<=tolerance){return values[i];}}else{values=+values;var rem=value%values;if(rem<tolerance){return value-rem;}
if(rem>values-tolerance){return value-rem+values;}}
return value;};var createUUID=R.createUUID=(function(uuidRegEx,uuidReplacer){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx,uuidReplacer).toUpperCase();};})(/[xy]/g,function(c){var r=math.random()*16|0,v=c=="x"?r:(r&3|8);return v.toString(16);});R.setWindow=function(newwin){eve("setWindow",R,g.win,newwin);g.win=newwin;g.doc=g.win.document;if(R._engine.initWin){R._engine.initWin(g.win);}};var toHex=function(color){if(R.vml){var trim=/^\s+|\s+$/g;var bod;try{var docum=new ActiveXObject("htmlfile");docum.write("<body>");docum.close();bod=docum.body;}catch(e){bod=createPopup().document.body;}
var range=bod.createTextRange();toHex=cacher(function(color){try{bod.style.color=Str(color).replace(trim,E);var value=range.queryCommandValue("ForeColor");value=((value&255)<<16)|(value&65280)|((value&16711680)>>>16);return"#"+("000000"+value.toString(16)).slice(-6);}catch(e){return"none";}});}else{var i=g.doc.createElement("i");i.title="Rapha\xebl Colour Picker";i.style.display="none";g.doc.body.appendChild(i);toHex=cacher(function(color){i.style.color=color;return g.doc.defaultView.getComputedStyle(i,E).getPropertyValue("color");});}
return toHex(color);},hsbtoString=function(){return"hsb("+[this.h,this.s,this.b]+")";},hsltoString=function(){return"hsl("+[this.h,this.s,this.l]+")";},rgbtoString=function(){return this.hex;},prepareRGB=function(r,g,b){if(g==null&&R.is(r,"object")&&"r"in r&&"g"in r&&"b"in r){b=r.b;g=r.g;r=r.r;}
if(g==null&&R.is(r,string)){var clr=R.getRGB(r);r=clr.r;g=clr.g;b=clr.b;}
if(r>1||g>1||b>1){r/=255;g/=255;b/=255;}
return[r,g,b];},packageRGB=function(r,g,b,o){r*=255;g*=255;b*=255;var rgb={r:r,g:g,b:b,hex:R.rgb(r,g,b),toString:rgbtoString};R.is(o,"finite")&&(rgb.opacity=o);return rgb;};R.color=function(clr){var rgb;if(R.is(clr,"object")&&"h"in clr&&"s"in clr&&"b"in clr){rgb=R.hsb2rgb(clr);clr.r=rgb.r;clr.g=rgb.g;clr.b=rgb.b;clr.hex=rgb.hex;}else if(R.is(clr,"object")&&"h"in clr&&"s"in clr&&"l"in clr){rgb=R.hsl2rgb(clr);clr.r=rgb.r;clr.g=rgb.g;clr.b=rgb.b;clr.hex=rgb.hex;}else{if(R.is(clr,"string")){clr=R.getRGB(clr);}
if(R.is(clr,"object")&&"r"in clr&&"g"in clr&&"b"in clr){rgb=R.rgb2hsl(clr);clr.h=rgb.h;clr.s=rgb.s;clr.l=rgb.l;rgb=R.rgb2hsb(clr);clr.v=rgb.b;}else{clr={hex:"none"};clr.r=clr.g=clr.b=clr.h=clr.s=clr.v=clr.l=-1;}}
clr.toString=rgbtoString;return clr;};R.hsb2rgb=function(h,s,v,o){if(this.is(h,"object")&&"h"in h&&"s"in h&&"b"in h){v=h.b;s=h.s;h=h.h;o=h.o;}
h*=360;var R,G,B,X,C;h=(h%360)/60;C=v*s;X=C*(1-abs(h%2-1));R=G=B=v-C;h=~~h;R+=[C,X,0,0,X,C][h];G+=[X,C,C,X,0,0][h];B+=[0,0,X,C,C,X][h];return packageRGB(R,G,B,o);};R.hsl2rgb=function(h,s,l,o){if(this.is(h,"object")&&"h"in h&&"s"in h&&"l"in h){l=h.l;s=h.s;h=h.h;}
if(h>1||s>1||l>1){h/=360;s/=100;l/=100;}
h*=360;var R,G,B,X,C;h=(h%360)/60;C=2*s*(l<.5?l:1-l);X=C*(1-abs(h%2-1));R=G=B=l-C/2;h=~~h;R+=[C,X,0,0,X,C][h];G+=[X,C,C,X,0,0][h];B+=[0,0,X,C,C,X][h];return packageRGB(R,G,B,o);};R.rgb2hsb=function(r,g,b){b=prepareRGB(r,g,b);r=b[0];g=b[1];b=b[2];var H,S,V,C;V=mmax(r,g,b);C=V-mmin(r,g,b);H=(C==0?null:V==r?(g-b)/C:V==g?(b-r)/C+2:(r-g)/C+4);H=((H+360)%6)*60/360;S=C==0?0:C/V;return{h:H,s:S,b:V,toString:hsbtoString};};R.rgb2hsl=function(r,g,b){b=prepareRGB(r,g,b);r=b[0];g=b[1];b=b[2];var H,S,L,M,m,C;M=mmax(r,g,b);m=mmin(r,g,b);C=M-m;H=(C==0?null:M==r?(g-b)/C:M==g?(b-r)/C+2:(r-g)/C+4);H=((H+360)%6)*60/360;L=(M+m)/2;S=(C==0?0:L<.5?C/(2*L):C/(2-2*L));return{h:H,s:S,l:L,toString:hsltoString};};R._path2string=function(){return this.join(",").replace(p2s,"$1");};function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item){return array.push(array.splice(i,1)[0]);}}
function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join("\u2400"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];if(cache[has](args)){repush(count,args);return postprocessor?postprocessor(cache[args]):cache[args];}
count.length>=1e3&&delete cache[count.shift()];count.push(args);cache[args]=f[apply](scope,arg);return postprocessor?postprocessor(cache[args]):cache[args];}
return newf;}
var preload=R._preload=function(src,f){var img=g.doc.createElement("img");img.style.cssText="position:absolute;left:-9999em;top:-9999em";img.onload=function(){f.call(this);this.onload=null;g.doc.body.removeChild(this);};img.onerror=function(){g.doc.body.removeChild(this);};g.doc.body.appendChild(img);img.src=src;};function clrToString(){return this.hex;}
R.getRGB=cacher(function(colour){if(!colour||!!((colour=Str(colour)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};}
if(colour=="none"){return{r:-1,g:-1,b:-1,hex:"none",toString:clrToString};}
!(hsrg[has](colour.toLowerCase().substring(0,2))||colour.charAt()=="#")&&(colour=toHex(colour));var res,red,green,blue,opacity,t,values,rgb=colour.match(colourRegExp);if(rgb){if(rgb[2]){blue=toInt(rgb[2].substring(5),16);green=toInt(rgb[2].substring(3,5),16);red=toInt(rgb[2].substring(1,3),16);}
if(rgb[3]){blue=toInt((t=rgb[3].charAt(3))+t,16);green=toInt((t=rgb[3].charAt(2))+t,16);red=toInt((t=rgb[3].charAt(1))+t,16);}
if(rgb[4]){values=rgb[4][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);rgb[1].toLowerCase().slice(0,4)=="rgba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);}
if(rgb[5]){values=rgb[5][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsb2rgb(red,green,blue,opacity);}
if(rgb[6]){values=rgb[6][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsla"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsl2rgb(red,green,blue,opacity);}
rgb={r:red,g:green,b:blue,toString:clrToString};rgb.hex="#"+(16777216|blue|(green<<8)|(red<<16)).toString(16).slice(1);R.is(opacity,"finite")&&(rgb.opacity=opacity);return rgb;}
return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};},R);R.hsb=cacher(function(h,s,b){return R.hsb2rgb(h,s,b).hex;});R.hsl=cacher(function(h,s,l){return R.hsl2rgb(h,s,l).hex;});R.rgb=cacher(function(r,g,b){return"#"+(16777216|b|(g<<8)|(r<<16)).toString(16).slice(1);});R.getColor=function(value){var start=this.getColor.start=this.getColor.start||{h:0,s:1,b:value||.75},rgb=this.hsb2rgb(start.h,start.s,start.b);start.h+=.075;if(start.h>1){start.h=0;start.s-=.2;start.s<=0&&(this.getColor.start={h:0,s:1,b:start.b});}
return rgb.hex;};R.getColor.reset=function(){delete this.start;};function catmullRom2bezier(crp,z){var d=[];for(var i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];if(z){if(!i){p[0]={x:+crp[iLen-2],y:+crp[iLen-1]};}else if(iLen-4==i){p[3]={x:+crp[0],y:+crp[1]};}else if(iLen-2==i){p[2]={x:+crp[0],y:+crp[1]};p[3]={x:+crp[2],y:+crp[3]};}}else{if(iLen-4==i){p[3]=p[2];}else if(!i){p[0]={x:+crp[i],y:+crp[i+1]};}}
d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y]);}
return d;}
R.parsePathString=cacher(function(pathString){if(!pathString){return null;}
var paramCounts={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},data=[];if(R.is(pathString,array)&&R.is(pathString[0],array)){data=pathClone(pathString);}
if(!data.length){Str(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();c.replace(pathValues,function(a,b){b&&params.push(+b);});if(name=="m"&&params.length>2){data.push([b][concat](params.splice(0,2)));name="l";b=b=="m"?"l":"L";}
if(name=="r"){data.push([b][concat](params));}else while(params.length>=paramCounts[name]){data.push([b][concat](params.splice(0,paramCounts[name])));if(!paramCounts[name]){break;}}});}
data.toString=R._path2string;return data;});R.parseTransformString=cacher(function(TString){if(!TString){return null;}
var paramCounts={r:3,s:4,t:2,m:6},data=[];if(R.is(TString,array)&&R.is(TString[0],array)){data=pathClone(TString);}
if(!data.length){Str(TString).replace(tCommand,function(a,b,c){var params=[],name=lowerCase.call(b);c.replace(pathValues,function(a,b){b&&params.push(+b);});data.push([b][concat](params));});}
data.toString=R._path2string;return data;});R.findDotsAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+t12*3*t*c1x+t1*3*t*t*c2x+t3*p2x,y=t13*p1y+t12*3*t*c1y+t1*3*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y),ax=t1*p1x+t*c1x,ay=t1*p1y+t*c1y,cx=t1*c2x+t*p2x,cy=t1*c2y+t*p2y,alpha=(90-math.atan2(mx-nx,my-ny)*180/PI);(mx>nx||my<ny)&&(alpha+=180);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha};};R._removedFactory=function(methodname){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+methodname+"\u201d of removed object");};};var pathDimensions=cacher(function(path){if(!path){return{x:0,y:0,width:0,height:0};}
path=path2curve(path);var x=0,y=0,X=[],Y=[],p;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=p[1];y=p[2];X.push(x);Y.push(y);}else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X[concat](dim.min.x,dim.max.x);Y=Y[concat](dim.min.y,dim.max.y);x=p[5];y=p[6];}}
var xmin=mmin[apply](0,X),ymin=mmin[apply](0,Y);return{x:xmin,y:ymin,width:mmax[apply](0,X)-xmin,height:mmax[apply](0,Y)-ymin};},null,function(o){return{x:o.x,y:o.y,width:o.width,height:o.height};}),pathClone=function(pathArray){var res=[];if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
for(var i=0,ii=pathArray.length;i<ii;i++){res[i]=[];for(var j=0,jj=pathArray[i].length;j<jj;j++){res[i][j]=pathArray[i][j];}}
res.toString=R._path2string;return res;},pathToRelative=R._pathToRelative=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=pathArray[0][1];y=pathArray[0][2];mx=x;my=y;start++;res.push(["M",x,y]);}
for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0])){r[0]=lowerCase.call(pa[0]);switch(r[0]){case"a":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]-x).toFixed(3);r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1];my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++){r[j]=+(pa[j]-((j%2)?x:y)).toFixed(3);}}}else{r=res[i]=[];if(pa[0]=="m"){mx=pa[1]+x;my=pa[2]+y;}
for(var k=0,kk=pa.length;k<kk;k++){res[i][k]=pa[k];}}
var len=res[i].length;switch(res[i][0]){case"z":x=mx;y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2];y+=+res[i][len-1];}}
res.toString=R._path2string;return res;},0,pathClone),pathToAbsolute=R._pathToAbsolute=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
if(!pathArray||!pathArray.length){return[["M",0,0]];}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=+pathArray[0][1];y=+pathArray[0][2];mx=x;my=y;start++;res[0]=["M",x,y];}
var crz=pathArray.length==3&&pathArray[0][0]=="M"&&pathArray[1][0].toUpperCase()=="R"&&pathArray[2][0].toUpperCase()=="Z";for(var r,pa,i=start,ii=pathArray.length;i<ii;i++){res.push(r=[]);pa=pathArray[i];if(pa[0]!=upperCase.call(pa[0])){r[0]=upperCase.call(pa[0]);switch(r[0]){case"A":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]+x);r[7]=+(pa[7]+y);break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":var dots=[x,y][concat](pa.slice(1));for(var j=2,jj=dots.length;j<jj;j++){dots[j]=+dots[j]+x;dots[++j]=+dots[j]+y;}
res.pop();res=res[concat](catmullRom2bezier(dots,crz));break;case"M":mx=+pa[1]+x;my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++){r[j]=+pa[j]+((j%2)?x:y);}}}else if(pa[0]=="R"){dots=[x,y][concat](pa.slice(1));res.pop();res=res[concat](catmullRom2bezier(dots,crz));r=["R"][concat](pa.slice(-2));}else{for(var k=0,kk=pa.length;k<kk;k++){r[k]=pa[k];}}
switch(r[0]){case"Z":x=mx;y=my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2];my=r[r.length-1];default:x=r[r.length-2];y=r[r.length-1];}}
res.toString=R._path2string;return res;},null,pathClone),l2c=function(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2];},q2c=function(x1,y1,ax,ay,x2,y2){var _13=1/3,_23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2];},a2c=function(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var _120=PI*120/180,rad=PI/180*(+angle||0),res=[],xy,rotate=cacher(function(x,y,rad){var X=x*math.cos(rad)-y*math.sin(rad),Y=x*math.sin(rad)+y*math.cos(rad);return{x:X,y:Y};});if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var cos=math.cos(PI/180*angle),sin=math.sin(PI/180*angle),x=(x1-x2)/2,y=(y1-y2)/2;var h=(x*x)/(rx*rx)+(y*y)/(ry*ry);if(h>1){h=math.sqrt(h);rx=h*rx;ry=h*ry;}
var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;f1<0&&(f1=PI*2+f1);f2<0&&(f2=PI*2+f2);if(sweep_flag&&f1>f2){f1=f1-PI*2;}
if(!sweep_flag&&f2>f1){f2=f2-PI*2;}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3];}
var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*math.cos(f2);y2=cy+ry*math.sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy]);}
df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4][concat](res);}else{res=[m2,m3,m4][concat](res).join()[split](",");var newres=[];for(var i=0,ii=res.length;i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;}
return newres;}},findDotAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t;return{x:pow(t1,3)*p1x+pow(t1,2)*3*t*c1x+t1*3*t*t*c2x+pow(t,3)*p2x,y:pow(t1,3)*p1y+pow(t1,2)*3*t*c1y+t1*3*t*t*c2y+pow(t,3)*p2y};},curveDim=cacher(function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){var a=(c2x-2*c1x+p1x)-(p2x-2*c2x+c1x),b=2*(c1x-p1x)-2*(c2x-c1x),c=p1x-c1x,t1=(-b+math.sqrt(b*b-4*a*c))/2/a,t2=(-b-math.sqrt(b*b-4*a*c))/2/a,y=[p1y,p2y],x=[p1x,p2x],dot;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x.push(dot.x);y.push(dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x.push(dot.x);y.push(dot.y);}
a=(c2y-2*c1y+p1y)-(p2y-2*c2y+c1y);b=2*(c1y-p1y)-2*(c2y-c1y);c=p1y-c1y;t1=(-b+math.sqrt(b*b-4*a*c))/2/a;t2=(-b-math.sqrt(b*b-4*a*c))/2/a;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x.push(dot.x);y.push(dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x.push(dot.x);y.push(dot.y);}
return{min:{x:mmin[apply](0,x),y:mmin[apply](0,y)},max:{x:mmax[apply](0,x),y:mmax[apply](0,y)}};}),path2curve=R._path2curve=cacher(function(path,path2){var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d){var nx,ny;if(!path){return["C",d.x,d.y,d.x,d.y,d.x,d.y];}
!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null);switch(path[0]){case"M":d.X=path[1];d.Y=path[2];break;case"A":path=["C"][concat](a2c[apply](0,[d.x,d.y][concat](path.slice(1))));break;case"S":nx=d.x+(d.x-(d.bx||d.x));ny=d.y+(d.y-(d.by||d.y));path=["C",nx,ny][concat](path.slice(1));break;case"T":d.qx=d.x+(d.x-(d.qx||d.x));d.qy=d.y+(d.y-(d.qy||d.y));path=["C"][concat](q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1];d.qy=path[2];path=["C"][concat](q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"][concat](l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"][concat](l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"][concat](l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"][concat](l2c(d.x,d.y,d.X,d.Y));break;}
return path;},fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();var pi=pp[i];while(pi.length){pp.splice(i++,0,["C"][concat](pi.splice(0,6)));}
pp.splice(i,1);ii=mmax(p.length,p2&&p2.length||0);}},fixM=function(path1,path2,a1,a2,i){if(path1&&path2&&path1[i][0]=="M"&&path2[i][0]!="M"){path2.splice(i,0,["M",a2.x,a2.y]);a1.bx=0;a1.by=0;a1.x=path1[i][1];a1.y=path1[i][2];ii=mmax(p.length,p2&&p2.length||0);}};for(var i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]=processPath(p[i],attrs);fixArc(p,i);p2&&(p2[i]=processPath(p2[i],attrs2));p2&&fixArc(p2,i);fixM(p,p2,attrs,attrs2,i);fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=toFloat(seg[seglen-4])||attrs.x;attrs.by=toFloat(seg[seglen-3])||attrs.y;attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x);attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y);attrs2.x=p2&&seg2[seg2len-2];attrs2.y=p2&&seg2[seg2len-1];}
return p2?[p,p2]:p;},null,pathClone),parseDots=R._parseDots=cacher(function(gradient){var dots=[];for(var i=0,ii=gradient.length;i<ii;i++){var dot={},par=gradient[i].match(/^([^:]*):?([\d\.]*)/);dot.color=R.getRGB(par[1]);if(dot.color.error){return null;}
dot.color=dot.color.hex;par[2]&&(dot.offset=par[2]+"%");dots.push(dot);}
for(i=1,ii=dots.length-1;i<ii;i++){if(!dots[i].offset){var start=toFloat(dots[i-1].offset||0),end=0;for(var j=i+1;j<ii;j++){if(dots[j].offset){end=dots[j].offset;break;}}
if(!end){end=100;j=ii;}
end=toFloat(end);var d=(end-start)/(j-i+1);for(;i<j;i++){start+=d;dots[i].offset=start+"%";}}}
return dots;}),tear=R._tear=function(el,paper){el==paper.top&&(paper.top=el.prev);el==paper.bottom&&(paper.bottom=el.next);el.next&&(el.next.prev=el.prev);el.prev&&(el.prev.next=el.next);},tofront=R._tofront=function(el,paper){if(paper.top===el){return;}
tear(el,paper);el.next=null;el.prev=paper.top;paper.top.next=el;paper.top=el;},toback=R._toback=function(el,paper){if(paper.bottom===el){return;}
tear(el,paper);el.next=paper.bottom;el.prev=null;paper.bottom.prev=el;paper.bottom=el;},insertafter=R._insertafter=function(el,el2,paper){tear(el,paper);el2==paper.top&&(paper.top=el);el2.next&&(el2.next.prev=el);el.next=el2.next;el.prev=el2;el2.next=el;},insertbefore=R._insertbefore=function(el,el2,paper){tear(el,paper);el2==paper.bottom&&(paper.bottom=el);el2.prev&&(el2.prev.next=el);el.prev=el2.prev;el2.prev=el;el.next=el2;},extractTransform=R._extractTransform=function(el,tstr){if(tstr==null){return el._.transform;}
tstr=Str(tstr).replace(/\.{3}|\u2026/g,el._.transform||E);var tdata=R.parseTransformString(tstr),deg=0,dx=0,dy=0,sx=1,sy=1,_=el._,m=new Matrix;_.transform=tdata||[];if(tdata){for(var i=0,ii=tdata.length;i<ii;i++){var t=tdata[i],tlen=t.length,command=Str(t[0]).toLowerCase(),absolute=t[0]!=command,inver=absolute?m.invert():0,x1,y1,x2,y2,bb;if(command=="t"&&tlen==3){if(absolute){x1=inver.x(0,0);y1=inver.y(0,0);x2=inver.x(t[1],t[2]);y2=inver.y(t[1],t[2]);m.translate(x2-x1,y2-y1);}else{m.translate(t[1],t[2]);}}else if(command=="r"){if(tlen==2){bb=bb||el.getBBox(1);m.rotate(t[1],bb.x+bb.width/2,bb.y+bb.height/2);deg+=t[1];}else if(tlen==4){if(absolute){x2=inver.x(t[2],t[3]);y2=inver.y(t[2],t[3]);m.rotate(t[1],x2,y2);}else{m.rotate(t[1],t[2],t[3]);}
deg+=t[1];}}else if(command=="s"){if(tlen==2||tlen==3){bb=bb||el.getBBox(1);m.scale(t[1],t[tlen-1],bb.x+bb.width/2,bb.y+bb.height/2);sx*=t[1];sy*=t[tlen-1];}else if(tlen==5){if(absolute){x2=inver.x(t[3],t[4]);y2=inver.y(t[3],t[4]);m.scale(t[1],t[2],x2,y2);}else{m.scale(t[1],t[2],t[3],t[4]);}
sx*=t[1];sy*=t[2];}}else if(command=="m"&&tlen==7){m.add(t[1],t[2],t[3],t[4],t[5],t[6]);}
_.dirtyT=1;el.matrix=m;}}
el.matrix=m;_.sx=sx;_.sy=sy;_.deg=deg;_.dx=dx=m.e;_.dy=dy=m.f;if(sx==1&&sy==1&&!deg&&_.bbox){_.bbox.x+=+dx;_.bbox.y+=+dy;}else{_.dirtyT=1;}},getEmpty=function(item){var l=item[0];switch(l.toLowerCase()){case"t":return[l,0,0];case"m":return[l,1,0,0,1,0,0];case"r":if(item.length==4){return[l,0,item[2],item[3]];}else{return[l,0];}
case"s":if(item.length==5){return[l,1,1,item[3],item[4]];}else if(item.length==3){return[l,1,1];}else{return[l,1];}}},equaliseTransform=R._equaliseTransform=function(t1,t2){t2=Str(t2).replace(/\.{3}|\u2026/g,t1);t1=R.parseTransformString(t1)||[];t2=R.parseTransformString(t2)||[];var maxlength=mmax(t1.length,t2.length),from=[],to=[],i=0,j,jj,tt1,tt2;for(;i<maxlength;i++){tt1=t1[i]||getEmpty(t2[i]);tt2=t2[i]||getEmpty(tt1);if((tt1[0]!=tt2[0])||(tt1[0].toLowerCase()=="r"&&(tt1[2]!=tt2[2]||tt1[3]!=tt2[3]))||(tt1[0].toLowerCase()=="s"&&(tt1[3]!=tt2[3]||tt1[4]!=tt2[4]))){return;}
from[i]=[];to[i]=[];for(j=0,jj=mmax(tt1.length,tt2.length);j<jj;j++){j in tt1&&(from[i][j]=tt1[j]);j in tt2&&(to[i][j]=tt2[j]);}}
return{from:from,to:to};};R._getContainer=function(x,y,w,h){var container;container=h==null&&!R.is(x,"object")?g.doc.getElementById(x):x;if(container==null){return;}
if(container.tagName){if(y==null){return{container:container,width:container.style.pixelWidth||container.offsetWidth,height:container.style.pixelHeight||container.offsetHeight};}else{return{container:container,width:y,height:w};}}
return{container:1,x:x,y:y,width:w,height:h};};R.pathToRelative=pathToRelative;R._engine={};R.path2curve=path2curve;R.matrix=function(a,b,c,d,e,f){return new Matrix(a,b,c,d,e,f);};function Matrix(a,b,c,d,e,f){if(a!=null){this.a=+a;this.b=+b;this.c=+c;this.d=+d;this.e=+e;this.f=+f;}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0;}}
(function(matrixproto){matrixproto.add=function(a,b,c,d,e,f){var out=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],matrix=[[a,c,e],[b,d,f],[0,0,1]],x,y,z,res;if(a&&a instanceof Matrix){matrix=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]];}
for(x=0;x<3;x++){for(y=0;y<3;y++){res=0;for(z=0;z<3;z++){res+=m[x][z]*matrix[z][y];}
out[x][y]=res;}}
this.a=out[0][0];this.b=out[1][0];this.c=out[0][1];this.d=out[1][1];this.e=out[0][2];this.f=out[1][2];};matrixproto.invert=function(){var me=this,x=me.a*me.d-me.b*me.c;return new Matrix(me.d/x,-me.b/x,-me.c/x,me.a/x,(me.c*me.f-me.d*me.e)/x,(me.b*me.e-me.a*me.f)/x);};matrixproto.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.e,this.f);};matrixproto.translate=function(x,y){this.add(1,0,0,1,x,y);};matrixproto.scale=function(x,y,cx,cy){y==null&&(y=x);(cx||cy)&&this.add(1,0,0,1,cx,cy);this.add(x,0,0,y,0,0);(cx||cy)&&this.add(1,0,0,1,-cx,-cy);};matrixproto.rotate=function(a,x,y){a=R.rad(a);x=x||0;y=y||0;var cos=+math.cos(a).toFixed(9),sin=+math.sin(a).toFixed(9);this.add(cos,sin,-sin,cos,x,y);this.add(1,0,0,1,-x,-y);};matrixproto.x=function(x,y){return x*this.a+y*this.c+this.e;};matrixproto.y=function(x,y){return x*this.b+y*this.d+this.f;};matrixproto.get=function(i){return+this[Str.fromCharCode(97+i)].toFixed(4);};matrixproto.toString=function(){return R.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join();};matrixproto.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')";};matrixproto.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)];};function norm(a){return a[0]*a[0]+a[1]*a[1];}
function normalize(a){var mag=math.sqrt(norm(a));a[0]&&(a[0]/=mag);a[1]&&(a[1]/=mag);}
matrixproto.split=function(){var out={};out.dx=this.e;out.dy=this.f;var row=[[this.a,this.c],[this.b,this.d]];out.scalex=math.sqrt(norm(row[0]));normalize(row[0]);out.shear=row[0][0]*row[1][0]+row[0][1]*row[1][1];row[1]=[row[1][0]-row[0][0]*out.shear,row[1][1]-row[0][1]*out.shear];out.scaley=math.sqrt(norm(row[1]));normalize(row[1]);out.shear/=out.scaley;var sin=-row[0][1],cos=row[1][1];if(cos<0){out.rotate=R.deg(math.acos(cos));if(sin<0){out.rotate=360-out.rotate;}}else{out.rotate=R.deg(math.asin(sin));}
out.isSimple=!+out.shear.toFixed(9)&&(out.scalex.toFixed(9)==out.scaley.toFixed(9)||!out.rotate);out.isSuperSimple=!+out.shear.toFixed(9)&&out.scalex.toFixed(9)==out.scaley.toFixed(9)&&!out.rotate;out.noRotation=!+out.shear.toFixed(9)&&!out.rotate;return out;};matrixproto.toTransformString=function(shorter){var s=shorter||this[split]();if(s.isSimple){s.scalex=+s.scalex.toFixed(4);s.scaley=+s.scaley.toFixed(4);s.rotate=+s.rotate.toFixed(4);return(s.dx||s.dy?"t"+[s.dx,s.dy]:E)+
(s.scalex!=1||s.scaley!=1?"s"+[s.scalex,s.scaley,0,0]:E)+
(s.rotate?"r"+[s.rotate,0,0]:E);}else{return"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)];}};})(Matrix.prototype);var version=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);if((navigator.vendor=="Apple Computer, Inc.")&&(version&&version[1]<4||navigator.platform.slice(0,2)=="iP")||(navigator.vendor=="Google Inc."&&version&&version[1]<8)){paperproto.safari=function(){var rect=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){rect.remove();});};}else{paperproto.safari=fun;}
var preventDefault=function(){this.returnValue=false;},preventTouch=function(){return this.originalEvent.preventDefault();},stopPropagation=function(){this.cancelBubble=true;},stopTouch=function(){return this.originalEvent.stopPropagation();},addEvent=(function(){if(g.doc.addEventListener){return function(obj,type,fn,element){var realName=supportsTouch&&touchMap[type]?touchMap[type]:type,f=function(e){var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;if(supportsTouch&&touchMap[has](type)){for(var i=0,ii=e.targetTouches&&e.targetTouches.length;i<ii;i++){if(e.targetTouches[i].target==obj){var olde=e;e=e.targetTouches[i];e.originalEvent=olde;e.preventDefault=preventTouch;e.stopPropagation=stopTouch;break;}}}
return fn.call(element,e,x,y);};obj.addEventListener(realName,f,false);return function(){obj.removeEventListener(realName,f,false);return true;};};}else if(g.doc.attachEvent){return function(obj,type,fn,element){var f=function(e){e=e||g.win.event;var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;e.preventDefault=e.preventDefault||preventDefault;e.stopPropagation=e.stopPropagation||stopPropagation;return fn.call(element,e,x,y);};obj.attachEvent("on"+type,f);var detacher=function(){obj.detachEvent("on"+type,f);return true;};return detacher;};}})(),drag=[],dragMove=function(e){var x=e.clientX,y=e.clientY,scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,dragi,j=drag.length;while(j--){dragi=drag[j];if(supportsTouch){var i=e.touches.length,touch;while(i--){touch=e.touches[i];if(touch.identifier==dragi.el._drag.id){x=touch.clientX;y=touch.clientY;(e.originalEvent?e.originalEvent:e).preventDefault();break;}}}else{e.preventDefault();}
var node=dragi.el.node,o,next=node.nextSibling,parent=node.parentNode,display=node.style.display;g.win.opera&&parent.removeChild(node);node.style.display="none";o=dragi.el.paper.getElementByPoint(x,y);node.style.display=display;g.win.opera&&(next?parent.insertBefore(node,next):parent.appendChild(node));o&&eve("drag.over."+dragi.el.id,dragi.el,o);x+=scrollX;y+=scrollY;eve("drag.move."+dragi.el.id,dragi.move_scope||dragi.el,x-dragi.el._drag.x,y-dragi.el._drag.y,x,y,e);}},dragUp=function(e){R.unmousemove(dragMove).unmouseup(dragUp);var i=drag.length,dragi;while(i--){dragi=drag[i];dragi.el._drag={};eve("drag.end."+dragi.el.id,dragi.end_scope||dragi.start_scope||dragi.move_scope||dragi.el,e);}
drag=[];},elproto=R.el={};for(var i=events.length;i--;){(function(eventName){R[eventName]=elproto[eventName]=function(fn,scope){if(R.is(fn,"function")){this.events=this.events||[];this.events.push({name:eventName,f:fn,unbind:addEvent(this.shape||this.node||g.doc,eventName,fn,scope||this)});}
return this;};R["un"+eventName]=elproto["un"+eventName]=function(fn){var events=this.events||[],l=events.length;while(l--)if(events[l].name==eventName&&events[l].f==fn){events[l].unbind();events.splice(l,1);!events.length&&delete this.events;return this;}
return this;};})(events[i]);}
elproto.data=function(key,value){var data=eldata[this.id]=eldata[this.id]||{};if(arguments.length==1){if(R.is(key,"object")){for(var i in key)if(key[has](i)){this.data(i,key[i]);}
return this;}
eve("data.get."+this.id,this,data[key],key);return data[key];}
data[key]=value;eve("data.set."+this.id,this,value,key);return this;};elproto.removeData=function(key){if(key==null){eldata[this.id]={};}else{eldata[this.id]&&delete eldata[this.id][key];}
return this;};elproto.hover=function(f_in,f_out,scope_in,scope_out){return this.mouseover(f_in,scope_in).mouseout(f_out,scope_out||scope_in);};elproto.unhover=function(f_in,f_out){return this.unmouseover(f_in).unmouseout(f_out);};var draggable=[];elproto.drag=function(onmove,onstart,onend,move_scope,start_scope,end_scope){function start(e){(e.originalEvent||e).preventDefault();var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft;this._drag.x=e.clientX+scrollX;this._drag.y=e.clientY+scrollY;this._drag.id=e.identifier;!drag.length&&R.mousemove(dragMove).mouseup(dragUp);drag.push({el:this,move_scope:move_scope,start_scope:start_scope,end_scope:end_scope});onstart&&eve.on("drag.start."+this.id,onstart);onmove&&eve.on("drag.move."+this.id,onmove);onend&&eve.on("drag.end."+this.id,onend);eve("drag.start."+this.id,start_scope||move_scope||this,e.clientX+scrollX,e.clientY+scrollY,e);}
this._drag={};draggable.push({el:this,start:start});this.mousedown(start);return this;};elproto.onDragOver=function(f){f?eve.on("drag.over."+this.id,f):eve.unbind("drag.over."+this.id);};elproto.undrag=function(){var i=draggable.length;while(i--)if(draggable[i].el==this){this.unmousedown(draggable[i].start);draggable.splice(i,1);eve.unbind("drag.*."+this.id);}
!draggable.length&&R.unmousemove(dragMove).unmouseup(dragUp);};paperproto.circle=function(x,y,r){var out=R._engine.circle(this,x||0,y||0,r||0);this.__set__&&this.__set__.push(out);return out;};paperproto.rect=function(x,y,w,h,r){var out=R._engine.rect(this,x||0,y||0,w||0,h||0,r||0);this.__set__&&this.__set__.push(out);return out;};paperproto.ellipse=function(x,y,rx,ry){var out=R._engine.ellipse(this,x||0,y||0,rx||0,ry||0);this.__set__&&this.__set__.push(out);return out;};paperproto.path=function(pathString){pathString&&!R.is(pathString,string)&&!R.is(pathString[0],array)&&(pathString+=E);var out=R._engine.path(R.format[apply](R,arguments),this);this.__set__&&this.__set__.push(out);return out;};paperproto.image=function(src,x,y,w,h){var out=R._engine.image(this,src||"about:blank",x||0,y||0,w||0,h||0);this.__set__&&this.__set__.push(out);return out;};paperproto.text=function(x,y,text){var out=R._engine.text(this,x||0,y||0,Str(text));this.__set__&&this.__set__.push(out);return out;};paperproto.set=function(itemsArray){!R.is(itemsArray,"array")&&(itemsArray=Array.prototype.splice.call(arguments,0,arguments.length));var out=new Set(itemsArray);this.__set__&&this.__set__.push(out);return out;};paperproto.setStart=function(set){this.__set__=set||this.set();};paperproto.setFinish=function(set){var out=this.__set__;delete this.__set__;return out;};paperproto.setSize=function(width,height){return R._engine.setSize.call(this,width,height);};paperproto.setViewBox=function(x,y,w,h,fit){return R._engine.setViewBox.call(this,x,y,w,h,fit);};paperproto.top=paperproto.bottom=null;paperproto.raphael=R;var getOffset=function(elem){var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+(g.win.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,left=box.left+(g.win.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft;return{y:top,x:left};};paperproto.getElementByPoint=function(x,y){var paper=this,svg=paper.canvas,target=g.doc.elementFromPoint(x,y);if(g.win.opera&&target.tagName=="svg"){var so=getOffset(svg),sr=svg.createSVGRect();sr.x=x-so.x;sr.y=y-so.y;sr.width=sr.height=1;var hits=svg.getIntersectionList(sr,null);if(hits.length){target=hits[hits.length-1];}}
if(!target){return null;}
while(target.parentNode&&target!=svg.parentNode&&!target.raphael){target=target.parentNode;}
target==paper.canvas.parentNode&&(target=svg);target=target&&target.raphael?paper.getById(target.raphaelid):null;return target;};paperproto.getById=function(id){var bot=this.bottom;while(bot){if(bot.id==id){return bot;}
bot=bot.next;}
return null;};paperproto.forEach=function(callback,thisArg){var bot=this.bottom;while(bot){if(callback.call(thisArg,bot)===false){return this;}
bot=bot.next;}
return this;};function x_y(){return this.x+S+this.y;}
function x_y_w_h(){return this.x+S+this.y+S+this.width+" \xd7 "+this.height;}
elproto.getBBox=function(isWithoutTransform){if(this.removed){return{};}
var _=this._;if(isWithoutTransform){if(_.dirty||!_.bboxwt){this.realPath=getPath[this.type](this);_.bboxwt=pathDimensions(this.realPath);_.bboxwt.toString=x_y_w_h;_.dirty=0;}
return _.bboxwt;}
if(_.dirty||_.dirtyT||!_.bbox){if(_.dirty||!this.realPath){_.bboxwt=0;this.realPath=getPath[this.type](this);}
_.bbox=pathDimensions(mapPath(this.realPath,this.matrix));_.bbox.toString=x_y_w_h;_.dirty=_.dirtyT=0;}
return _.bbox;};elproto.clone=function(){if(this.removed){return null;}
var out=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(out);return out;};elproto.glow=function(glow){if(this.type=="text"){return null;}
glow=glow||{};var s={width:(glow.width||10)+(+this.attr("stroke-width")||1),fill:glow.fill||false,opacity:glow.opacity||.5,offsetx:glow.offsetx||0,offsety:glow.offsety||0,color:glow.color||"#000"},c=s.width/2,r=this.paper,out=r.set(),path=this.realPath||getPath[this.type](this);path=this.matrix?mapPath(path,this.matrix):path;for(var i=1;i<c+1;i++){out.push(r.path(path).attr({stroke:s.color,fill:s.fill?s.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(s.width/c*i).toFixed(3),opacity:+(s.opacity/c).toFixed(3)}));}
return out.insertBefore(this).translate(s.offsetx,s.offsety);};var curveslengths={},getPointAtSegmentLength=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){var len=0,precision=100,name=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y].join(),cache=curveslengths[name],old,dot;!cache&&(curveslengths[name]=cache={data:[]});cache.timer&&clearTimeout(cache.timer);cache.timer=setTimeout(function(){delete curveslengths[name];},2e3);if(length!=null&&!cache.precision){var total=getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y);cache.precision=~~total*10;cache.data=[];}
precision=cache.precision||precision;for(var i=0;i<precision+1;i++){if(cache.data[i*precision]){dot=cache.data[i*precision];}else{dot=R.findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,i/precision);cache.data[i*precision]=dot;}
i&&(len+=pow(pow(old.x-dot.x,2)+pow(old.y-dot.y,2),.5));if(length!=null&&len>=length){return dot;}
old=dot;}
if(length==null){return len;}},getLengthFactory=function(istotal,subpath){return function(path,length,onlystart){path=path2curve(path);var x,y,p,l,sp="",subpaths={},point,len=0;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=+p[1];y=+p[2];}else{l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);if(len+l>length){if(subpath&&!subpaths.start){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);sp+=["C"+point.start.x,point.start.y,point.m.x,point.m.y,point.x,point.y];if(onlystart){return sp;}
subpaths.start=sp;sp=["M"+point.x,point.y+"C"+point.n.x,point.n.y,point.end.x,point.end.y,p[5],p[6]].join();len+=l;x=+p[5];y=+p[6];continue;}
if(!istotal&&!subpath){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);return{x:point.x,y:point.y,alpha:point.alpha};}}
len+=l;x=+p[5];y=+p[6];}
sp+=p.shift()+p;}
subpaths.end=sp;point=istotal?len:subpath?subpaths:R.findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1);point.alpha&&(point={x:point.x,y:point.y,alpha:point.alpha});return point;};};var getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory(),getSubpathsAtLength=getLengthFactory(0,1);R.getTotalLength=getTotalLength;R.getPointAtLength=getPointAtLength;R.getSubpath=function(path,from,to){if(this.getTotalLength(path)-to<1e-6){return getSubpathsAtLength(path,from).end;}
var a=getSubpathsAtLength(path,to,1);return from?getSubpathsAtLength(a,from).end:a;};elproto.getTotalLength=function(){if(this.type!="path"){return;}
if(this.node.getTotalLength){return this.node.getTotalLength();}
return getTotalLength(this.attrs.path);};elproto.getPointAtLength=function(length){if(this.type!="path"){return;}
return getPointAtLength(this.attrs.path,length);};elproto.getSubpath=function(from,to){if(this.type!="path"){return;}
return R.getSubpath(this.attrs.path,from,to);};var ef=R.easing_formulas={linear:function(n){return n;},"<":function(n){return pow(n,1.7);},">":function(n){return pow(n,.48);},"<>":function(n){var q=.48-n/1.04,Q=math.sqrt(.1734+q*q),x=Q-q,X=pow(abs(x),1/3)*(x<0?-1:1),y=-Q-q,Y=pow(abs(y),1/3)*(y<0?-1:1),t=X+Y+.5;return(1-t)*3*t*t+t*t*t;},backIn:function(n){var s=1.70158;return n*n*((s+1)*n-s);},backOut:function(n){n=n-1;var s=1.70158;return n*n*((s+1)*n+s)+1;},elastic:function(n){if(n==!!n){return n;}
return pow(2,-10*n)*math.sin((n-.075)*(2*PI)/.3)+1;},bounce:function(n){var s=7.5625,p=2.75,l;if(n<(1/p)){l=s*n*n;}else{if(n<(2/p)){n-=(1.5/p);l=s*n*n+.75;}else{if(n<(2.5/p)){n-=(2.25/p);l=s*n*n+.9375;}else{n-=(2.625/p);l=s*n*n+.984375;}}}
return l;}};ef.easeIn=ef["ease-in"]=ef["<"];ef.easeOut=ef["ease-out"]=ef[">"];ef.easeInOut=ef["ease-in-out"]=ef["<>"];ef["back-in"]=ef.backIn;ef["back-out"]=ef.backOut;var animationElements=[],requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,16);},animation=function(){var Now=+new Date,l=0;for(;l<animationElements.length;l++){var e=animationElements[l];if(e.el.removed||e.paused){continue;}
var time=Now-e.start,ms=e.ms,easing=e.easing,from=e.from,diff=e.diff,to=e.to,t=e.t,that=e.el,set={},now,init={},key;if(e.initstatus){time=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*ms;e.status=e.initstatus;delete e.initstatus;e.stop&&animationElements.splice(l--,1);}else{e.status=(e.prev+(e.percent-e.prev)*(time/ms))/e.anim.top;}
if(time<0){continue;}
if(time<ms){var pos=easing(time/ms);for(var attr in from)if(from[has](attr)){switch(availableAnimAttrs[attr]){case nu:now=+from[attr]+pos*ms*diff[attr];break;case"colour":now="rgb("+[upto255(round(from[attr].r+pos*ms*diff[attr].r)),upto255(round(from[attr].g+pos*ms*diff[attr].g)),upto255(round(from[attr].b+pos*ms*diff[attr].b))].join(",")+")";break;case"path":now=[];for(var i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(var j=1,jj=from[attr][i].length;j<jj;j++){now[i][j]=+from[attr][i][j]+pos*ms*diff[attr][i][j];}
now[i]=now[i].join(S);}
now=now.join(S);break;case"transform":if(diff[attr].real){now=[];for(i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(j=1,jj=from[attr][i].length;j<jj;j++){now[i][j]=from[attr][i][j]+pos*ms*diff[attr][i][j];}}}else{var get=function(i){return+from[attr][i]+pos*ms*diff[attr][i];};now=[["m",get(0),get(1),get(2),get(3),get(4),get(5)]];}
break;case"csv":if(attr=="clip-rect"){now=[];i=4;while(i--){now[i]=+from[attr][i]+pos*ms*diff[attr][i];}}
break;default:var from2=[][concat](from[attr]);now=[];i=that.paper.customAttributes[attr].length;while(i--){now[i]=+from2[i]+pos*ms*diff[attr][i];}
break;}
set[attr]=now;}
that.attr(set);(function(id,that,anim){setTimeout(function(){eve("anim.frame."+id,that,anim);});})(that.id,that,e.anim);}else{(function(f,el,a){setTimeout(function(){eve("anim.frame."+el.id,el,a);eve("anim.finish."+el.id,el,a);R.is(f,"function")&&f.call(el);});})(e.callback,that,e.anim);that.attr(to);animationElements.splice(l--,1);if(e.repeat>1&&!e.next){for(key in to)if(to[has](key)){init[key]=e.totalOrigin[key];}
e.el.attr(init);runAnimation(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1);}
if(e.next&&!e.stop){runAnimation(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat);}}}
R.svg&&that&&that.paper&&that.paper.safari();animationElements.length&&requestAnimFrame(animation);},upto255=function(color){return color>255?255:color<0?0:color;};elproto.animateWith=function(el,anim,params,ms,easing,callback){var element=this;if(element.removed){callback&&callback.call(element);return element;}
var a=params instanceof Animation?params:R.animation(params,ms,easing,callback),x,y;runAnimation(a,element,a.percents[0],null,element.attr());for(var i=0,ii=animationElements.length;i<ii;i++){if(animationElements[i].anim==anim&&animationElements[i].el==el){animationElements[ii-1].start=animationElements[i].start;break;}}
return element;};function CubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration){var cx=3*p1x,bx=3*(p2x-p1x)-cx,ax=1-cx-bx,cy=3*p1y,by=3*(p2y-p1y)-cy,ay=1-cy-by;function sampleCurveX(t){return((ax*t+bx)*t+cx)*t;}
function solve(x,epsilon){var t=solveCurveX(x,epsilon);return((ay*t+by)*t+cy)*t;}
function solveCurveX(x,epsilon){var t0,t1,t2,x2,d2,i;for(t2=x,i=0;i<8;i++){x2=sampleCurveX(t2)-x;if(abs(x2)<epsilon){return t2;}
d2=(3*ax*t2+2*bx)*t2+cx;if(abs(d2)<1e-6){break;}
t2=t2-x2/d2;}
t0=0;t1=1;t2=x;if(t2<t0){return t0;}
if(t2>t1){return t1;}
while(t0<t1){x2=sampleCurveX(t2);if(abs(x2-x)<epsilon){return t2;}
if(x>x2){t0=t2;}else{t1=t2;}
t2=(t1-t0)/2+t0;}
return t2;}
return solve(t,1/(200*duration));}
elproto.onAnimation=function(f){f?eve.on("anim.frame."+this.id,f):eve.unbind("anim.frame."+this.id);return this;};function Animation(anim,ms){var percents=[],newAnim={};this.ms=ms;this.times=1;if(anim){for(var attr in anim)if(anim[has](attr)){newAnim[toFloat(attr)]=anim[attr];percents.push(toFloat(attr));}
percents.sort(sortByNumber);}
this.anim=newAnim;this.top=percents[percents.length-1];this.percents=percents;}
Animation.prototype.delay=function(delay){var a=new Animation(this.anim,this.ms);a.times=this.times;a.del=+delay||0;return a;};Animation.prototype.repeat=function(times){var a=new Animation(this.anim,this.ms);a.del=this.del;a.times=math.floor(mmax(times,0))||1;return a;};function runAnimation(anim,element,percent,status,totalOrigin,times){percent=toFloat(percent);var params,isInAnim,isInAnimSet,percents=[],next,prev,timestamp,ms=anim.ms,from={},to={},diff={};if(status){for(i=0,ii=animationElements.length;i<ii;i++){var e=animationElements[i];if(e.el.id==element.id&&e.anim==anim){if(e.percent!=percent){animationElements.splice(i,1);isInAnimSet=1;}else{isInAnim=e;}
element.attr(e.totalOrigin);break;}}}else{status=+to;}
for(var i=0,ii=anim.percents.length;i<ii;i++){if(anim.percents[i]==percent||anim.percents[i]>status*anim.top){percent=anim.percents[i];prev=anim.percents[i-1]||0;ms=ms/anim.top*(percent-prev);next=anim.percents[i+1];params=anim.anim[percent];break;}else if(status){element.attr(anim.anim[anim.percents[i]]);}}
if(!params){return;}
if(!isInAnim){for(var attr in params)if(params[has](attr)){if(availableAnimAttrs[has](attr)||element.paper.customAttributes[has](attr)){from[attr]=element.attr(attr);(from[attr]==null)&&(from[attr]=availableAttrs[attr]);to[attr]=params[attr];switch(availableAnimAttrs[attr]){case nu:diff[attr]=(to[attr]-from[attr])/ms;break;case"colour":from[attr]=R.getRGB(from[attr]);var toColour=R.getRGB(to[attr]);diff[attr]={r:(toColour.r-from[attr].r)/ms,g:(toColour.g-from[attr].g)/ms,b:(toColour.b-from[attr].b)/ms};break;case"path":var pathes=path2curve(from[attr],to[attr]),toPath=pathes[1];from[attr]=pathes[0];diff[attr]=[];for(i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[0];for(var j=1,jj=from[attr][i].length;j<jj;j++){diff[attr][i][j]=(toPath[i][j]-from[attr][i][j])/ms;}}
break;case"transform":var _=element._,eq=equaliseTransform(_[attr],to[attr]);if(eq){from[attr]=eq.from;to[attr]=eq.to;diff[attr]=[];diff[attr].real=true;for(i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[from[attr][i][0]];for(j=1,jj=from[attr][i].length;j<jj;j++){diff[attr][i][j]=(to[attr][i][j]-from[attr][i][j])/ms;}}}else{var m=(element.matrix||new Matrix),to2={_:{transform:_.transform},getBBox:function(){return element.getBBox(1);}};from[attr]=[m.a,m.b,m.c,m.d,m.e,m.f];extractTransform(to2,to[attr]);to[attr]=to2._.transform;diff[attr]=[(to2.matrix.a-m.a)/ms,(to2.matrix.b-m.b)/ms,(to2.matrix.c-m.c)/ms,(to2.matrix.d-m.d)/ms,(to2.matrix.e-m.e)/ms,(to2.matrix.e-m.f)/ms];}
break;case"csv":var values=Str(params[attr])[split](separator),from2=Str(from[attr])[split](separator);if(attr=="clip-rect"){from[attr]=from2;diff[attr]=[];i=from2.length;while(i--){diff[attr][i]=(values[i]-from[attr][i])/ms;}}
to[attr]=values;break;default:values=[][concat](params[attr]);from2=[][concat](from[attr]);diff[attr]=[];i=element.paper.customAttributes[attr].length;while(i--){diff[attr][i]=((values[i]||0)-(from2[i]||0))/ms;}
break;}}}
var easing=params.easing,easyeasy=R.easing_formulas[easing];if(!easyeasy){easyeasy=Str(easing).match(bezierrg);if(easyeasy&&easyeasy.length==5){var curve=easyeasy;easyeasy=function(t){return CubicBezierAtTime(t,+curve[1],+curve[2],+curve[3],+curve[4],ms);};}else{easyeasy=pipe;}}
timestamp=params.start||anim.start||+new Date;e={anim:anim,percent:percent,timestamp:timestamp,start:timestamp+(anim.del||0),status:0,initstatus:status||0,stop:false,ms:ms,easing:easyeasy,from:from,diff:diff,to:to,el:element,callback:params.callback,prev:prev,next:next,repeat:times||anim.times,origin:element.attr(),totalOrigin:totalOrigin};animationElements.push(e);if(status&&!isInAnim&&!isInAnimSet){e.stop=true;e.start=new Date-ms*status;if(animationElements.length==1){return animation();}}
if(isInAnimSet){e.start=new Date-e.ms*status;}
animationElements.length==1&&requestAnimFrame(animation);}else{isInAnim.initstatus=status;isInAnim.start=new Date-isInAnim.ms*status;}
eve("anim.start."+element.id,element,anim);}
R.animation=function(params,ms,easing,callback){if(params instanceof Animation){return params;}
if(R.is(easing,"function")||!easing){callback=callback||easing||null;easing=null;}
params=Object(params);ms=+ms||0;var p={},json,attr;for(attr in params)if(params[has](attr)&&toFloat(attr)!=attr&&toFloat(attr)+"%"!=attr){json=true;p[attr]=params[attr];}
if(!json){return new Animation(params,ms);}else{easing&&(p.easing=easing);callback&&(p.callback=callback);return new Animation({100:p},ms);}};elproto.animate=function(params,ms,easing,callback){var element=this;if(element.removed){callback&&callback.call(element);return element;}
var anim=params instanceof Animation?params:R.animation(params,ms,easing,callback);runAnimation(anim,element,anim.percents[0],null,element.attr());return element;};elproto.setTime=function(anim,value){if(anim&&value!=null){this.status(anim,mmin(value,anim.ms)/anim.ms);}
return this;};elproto.status=function(anim,value){var out=[],i=0,len,e;if(value!=null){runAnimation(anim,this,-1,mmin(value,1));return this;}else{len=animationElements.length;for(;i<len;i++){e=animationElements[i];if(e.el.id==this.id&&(!anim||e.anim==anim)){if(anim){return e.status;}
out.push({anim:e.anim,status:e.status});}}
if(anim){return 0;}
return out;}};elproto.pause=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){if(eve("anim.pause."+this.id,this,animationElements[i].anim)!==false){animationElements[i].paused=true;}}
return this;};elproto.resume=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){var e=animationElements[i];if(eve("anim.resume."+this.id,this,e.anim)!==false){delete e.paused;this.status(e.anim,e.status);}}
return this;};elproto.stop=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){if(eve("anim.stop."+this.id,this,animationElements[i].anim)!==false){animationElements.splice(i--,1);}}
return this;};elproto.toString=function(){return"Rapha\xebl\u2019s object";};var Set=function(items){this.items=[];this.length=0;this.type="set";if(items){for(var i=0,ii=items.length;i<ii;i++){if(items[i]&&(items[i].constructor==elproto.constructor||items[i].constructor==Set)){this[this.items.length]=this.items[this.items.length]=items[i];this.length++;}}}},setproto=Set.prototype;setproto.push=function(){var item,len;for(var i=0,ii=arguments.length;i<ii;i++){item=arguments[i];if(item&&(item.constructor==elproto.constructor||item.constructor==Set)){len=this.items.length;this[len]=this.items[len]=item;this.length++;}}
return this;};setproto.pop=function(){this.length&&delete this[this.length--];return this.items.pop();};setproto.forEach=function(callback,thisArg){for(var i=0,ii=this.items.length;i<ii;i++){if(callback.call(thisArg,this.items[i],i)===false){return this;}}
return this;};for(var method in elproto)if(elproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname][apply](el,arg);});};})(method);}
setproto.attr=function(name,value){if(name&&R.is(name,array)&&R.is(name[0],"object")){for(var j=0,jj=name.length;j<jj;j++){this.items[j].attr(name[j]);}}else{for(var i=0,ii=this.items.length;i<ii;i++){this.items[i].attr(name,value);}}
return this;};setproto.clear=function(){while(this.length){this.pop();}};setproto.splice=function(index,count,insertion){index=index<0?mmax(this.length+index,0):index;count=mmax(0,mmin(this.length-index,count));var tail=[],todel=[],args=[],i;for(i=2;i<arguments.length;i++){args.push(arguments[i]);}
for(i=0;i<count;i++){todel.push(this[index+i]);}
for(;i<this.length-index;i++){tail.push(this[index+i]);}
var arglen=args.length;for(i=0;i<arglen+tail.length;i++){this.items[index+i]=this[index+i]=i<arglen?args[i]:tail[i-arglen];}
i=this.items.length=this.length-=count-arglen;while(this[i]){delete this[i++];}
return new Set(todel);};setproto.exclude=function(el){for(var i=0,ii=this.length;i<ii;i++)if(this[i]==el){this.splice(i,1);return true;}};setproto.animate=function(params,ms,easing,callback){(R.is(easing,"function")||!easing)&&(callback=easing||null);var len=this.items.length,i=len,item,set=this,collector;if(!len){return this;}
callback&&(collector=function(){!--len&&callback.call(set);});easing=R.is(easing,string)?easing:collector;var anim=R.animation(params,ms,easing,collector);item=this.items[--i].animate(anim);while(i--){this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(item,anim,anim);}
return this;};setproto.insertAfter=function(el){var i=this.items.length;while(i--){this.items[i].insertAfter(el);}
return this;};setproto.getBBox=function(){var x=[],y=[],w=[],h=[];for(var i=this.items.length;i--;)if(!this.items[i].removed){var box=this.items[i].getBBox();x.push(box.x);y.push(box.y);w.push(box.x+box.width);h.push(box.y+box.height);}
x=mmin[apply](0,x);y=mmin[apply](0,y);return{x:x,y:y,width:mmax[apply](0,w)-x,height:mmax[apply](0,h)-y};};setproto.clone=function(s){s=new Set;for(var i=0,ii=this.items.length;i<ii;i++){s.push(this.items[i].clone());}
return s;};setproto.toString=function(){return"Rapha\xebl\u2018s set";};R.registerFont=function(font){if(!font.face){return font;}
this.fonts=this.fonts||{};var fontcopy={w:font.w,face:{},glyphs:{}},family=font.face["font-family"];for(var prop in font.face)if(font.face[has](prop)){fontcopy.face[prop]=font.face[prop];}
if(this.fonts[family]){this.fonts[family].push(fontcopy);}else{this.fonts[family]=[fontcopy];}
if(!font.svg){fontcopy.face["units-per-em"]=toInt(font.face["units-per-em"],10);for(var glyph in font.glyphs)if(font.glyphs[has](glyph)){var path=font.glyphs[glyph];fontcopy.glyphs[glyph]={w:path.w,k:{},d:path.d&&"M"+path.d.replace(/[mlcxtrv]/g,function(command){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[command]||"M";})+"z"};if(path.k){for(var k in path.k)if(path[has](k)){fontcopy.glyphs[glyph].k[k]=path.k[k];}}}}
return font;};paperproto.getFont=function(family,weight,style,stretch){stretch=stretch||"normal";style=style||"normal";weight=+weight||{normal:400,bold:700,lighter:300,bolder:800}[weight]||400;if(!R.fonts){return;}
var font=R.fonts[family];if(!font){var name=new RegExp("(^|\\s)"+family.replace(/[^\w\d\s+!~.:_-]/g,E)+"(\\s|$)","i");for(var fontName in R.fonts)if(R.fonts[has](fontName)){if(name.test(fontName)){font=R.fonts[fontName];break;}}}
var thefont;if(font){for(var i=0,ii=font.length;i<ii;i++){thefont=font[i];if(thefont.face["font-weight"]==weight&&(thefont.face["font-style"]==style||!thefont.face["font-style"])&&thefont.face["font-stretch"]==stretch){break;}}}
return thefont;};paperproto.print=function(x,y,string,font,size,origin,letter_spacing){origin=origin||"middle";letter_spacing=mmax(mmin(letter_spacing||0,1),-1);var out=this.set(),letters=Str(string)[split](E),shift=0,path=E,scale;R.is(font,string)&&(font=this.getFont(font));if(font){scale=(size||16)/font.face["units-per-em"];var bb=font.face.bbox[split](separator),top=+bb[0],height=+bb[1]+(origin=="baseline"?bb[3]-bb[1]+(+font.face.descent):(bb[3]-bb[1])/2);for(var i=0,ii=letters.length;i<ii;i++){var prev=i&&font.glyphs[letters[i-1]]||{},curr=font.glyphs[letters[i]];shift+=i?(prev.w||font.w)+(prev.k&&prev.k[letters[i]]||0)+(font.w*letter_spacing):0;curr&&curr.d&&out.push(this.path(curr.d).attr({fill:"#000",stroke:"none",transform:[["t",shift*scale,0]]}));}
out.transform(["...s",scale,scale,top,height,"t",(x-top)/scale,(y-height)/scale]);}
return out;};paperproto.add=function(json){if(R.is(json,"array")){var res=this.set(),i=0,ii=json.length,j;for(;i<ii;i++){j=json[i]||{};elements[has](j.type)&&res.push(this[j.type]().attr(j));}}
return res;};R.format=function(token,params){var args=R.is(params,array)?[0][concat](params):arguments;token&&R.is(token,string)&&args.length-1&&(token=token.replace(formatrg,function(str,i){return args[++i]==null?E:args[i];}));return token||E;};R.fullfill=(function(){var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,replacer=function(all,key,obj){var res=obj;key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName;if(res){if(name in res){res=res[name];}
typeof res=="function"&&isFunc&&(res=res());}});res=(res==null||res==obj?all:res)+"";return res;};return function(str,obj){return String(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj);});};})();R.ninja=function(){oldRaphael.was?(g.win.Raphael=oldRaphael.is):delete Raphael;return R;};R.st=setproto;(function(doc,loaded,f){if(doc.readyState==null&&doc.addEventListener){doc.addEventListener(loaded,f=function(){doc.removeEventListener(loaded,f,false);doc.readyState="complete";},false);doc.readyState="loading";}
function isLoaded(){(/in/).test(doc.readyState)?setTimeout(isLoaded,9):R.eve("DOMload");}
isLoaded();})(document,"DOMContentLoaded");oldRaphael.was?(g.win.Raphael=R):(Raphael=R);eve.on("DOMload",function(){loaded=true;});})();window.Raphael.svg&&function(R){var has="hasOwnProperty",Str=String,toFloat=parseFloat,toInt=parseInt,math=Math,mmax=math.max,abs=math.abs,pow=math.pow,separator=/[, ]+/,eve=R.eve,E="",S=" ";var xlink="http://www.w3.org/1999/xlink",markers={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},markerCounter={};R.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version;};var $=function(el,attr){if(attr){if(typeof el=="string"){el=$(el);}
for(var key in attr)if(attr[has](key)){if(key.substring(0,6)=="xlink:"){el.setAttributeNS(xlink,key.substring(6),Str(attr[key]));}else{el.setAttribute(key,Str(attr[key]));}}}else{el=R._g.doc.createElementNS("http://www.w3.org/2000/svg",el);el.style&&(el.style.webkitTapHighlightColor="rgba(0,0,0,0)");}
return el;},addGradientFill=function(element,gradient){var type="linear",id=element.id+gradient,fx=.5,fy=.5,o=element.node,SVG=element.paper,s=o.style,el=R._g.doc.getElementById(id);if(!el){gradient=Str(gradient).replace(R._radial_gradient,function(all,_fx,_fy){type="radial";if(_fx&&_fy){fx=toFloat(_fx);fy=toFloat(_fy);var dir=((fy>.5)*2-1);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*dir+.5)&&fy!=.5&&(fy=fy.toFixed(5)-1e-5*dir);}
return E;});gradient=gradient.split(/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}
var vector=[0,0,math.cos(R.rad(angle)),math.sin(R.rad(angle))],max=1/(mmax(abs(vector[2]),abs(vector[3]))||1);vector[2]*=max;vector[3]*=max;if(vector[2]<0){vector[0]=-vector[2];vector[2]=0;}
if(vector[3]<0){vector[1]=-vector[3];vector[3]=0;}}
var dots=R._parseDots(gradient);if(!dots){return null;}
id=id.replace(/[\(\)\s,\xb0#]/g,"_");if(element.gradient&&id!=element.gradient.id){SVG.defs.removeChild(element.gradient);delete element.gradient;}
if(!element.gradient){el=$(type+"Gradient",{id:id});element.gradient=el;$(el,type=="radial"?{fx:fx,fy:fy}:{x1:vector[0],y1:vector[1],x2:vector[2],y2:vector[3],gradientTransform:element.matrix.invert()});SVG.defs.appendChild(el);for(var i=0,ii=dots.length;i<ii;i++){el.appendChild($("stop",{offset:dots[i].offset?dots[i].offset:i?"100%":"0%","stop-color":dots[i].color||"#fff"}));}}}
$(o,{fill:"url(#"+id+")",opacity:1,"fill-opacity":1});s.fill=E;s.opacity=1;s.fillOpacity=1;return 1;},updatePosition=function(o){var bbox=o.getBBox(1);$(o.pattern,{patternTransform:o.matrix.invert()+" translate("+bbox.x+","+bbox.y+")"});},addArrow=function(o,value,isEnd){if(o.type=="path"){var values=Str(value).toLowerCase().split("-"),p=o.paper,se=isEnd?"end":"start",node=o.node,attrs=o.attrs,stroke=attrs["stroke-width"],i=values.length,type="classic",from,to,dx,refX,attr,w=3,h=3,t=5;while(i--){switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":h=5;break;case"narrow":h=2;break;case"long":w=5;break;case"short":w=2;break;}}
if(type=="open"){w+=2;h+=2;t+=2;dx=1;refX=isEnd?4:1;attr={fill:"none",stroke:attrs.stroke};}else{refX=dx=w/2;attr={fill:attrs.stroke,stroke:"none"};}
if(o._.arrows){if(isEnd){o._.arrows.endPath&&markerCounter[o._.arrows.endPath]--;o._.arrows.endMarker&&markerCounter[o._.arrows.endMarker]--;}else{o._.arrows.startPath&&markerCounter[o._.arrows.startPath]--;o._.arrows.startMarker&&markerCounter[o._.arrows.startMarker]--;}}else{o._.arrows={};}
if(type!="none"){var pathId="raphael-marker-"+type,markerId="raphael-marker-"+se+type+w+h+o.id;if(!R._g.doc.getElementById(pathId)){p.defs.appendChild($($("path"),{"stroke-linecap":"round",d:markers[type],id:pathId}));markerCounter[pathId]=1;}else{markerCounter[pathId]++;}
var marker=R._g.doc.getElementById(markerId),use;if(!marker){marker=$($("marker"),{id:markerId,markerHeight:h,markerWidth:w,orient:"auto",refX:refX,refY:h/2});use=$($("use"),{"xlink:href":"#"+pathId,transform:(isEnd?"rotate(180 "+w/2+" "+h/2+") ":E)+"scale("+w/t+","+h/t+")","stroke-width":(1/((w/t+h/t)/2)).toFixed(4)});marker.appendChild(use);p.defs.appendChild(marker);markerCounter[markerId]=1;}else{markerCounter[markerId]++;use=marker.getElementsByTagName("use")[0];}
$(use,attr);var delta=dx*(type!="diamond"&&type!="oval");if(isEnd){from=o._.arrows.startdx*stroke||0;to=R.getTotalLength(attrs.path)-delta*stroke;}else{from=delta*stroke;to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0);}
attr={};attr["marker-"+se]="url(#"+markerId+")";if(to||from){attr.d=Raphael.getSubpath(attrs.path,from,to);}
$(node,attr);o._.arrows[se+"Path"]=pathId;o._.arrows[se+"Marker"]=markerId;o._.arrows[se+"dx"]=delta;o._.arrows[se+"Type"]=type;o._.arrows[se+"String"]=value;}else{if(isEnd){from=o._.arrows.startdx*stroke||0;to=R.getTotalLength(attrs.path)-from;}else{from=0;to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0);}
o._.arrows[se+"Path"]&&$(node,{d:Raphael.getSubpath(attrs.path,from,to)});delete o._.arrows[se+"Path"];delete o._.arrows[se+"Marker"];delete o._.arrows[se+"dx"];delete o._.arrows[se+"Type"];delete o._.arrows[se+"String"];}
for(attr in markerCounter)if(markerCounter[has](attr)&&!markerCounter[attr]){var item=R._g.doc.getElementById(attr);item&&item.parentNode.removeChild(item);}}},dasharray={"":[0],"none":[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},addDashes=function(o,value,params){value=dasharray[Str(value).toLowerCase()];if(value){var width=o.attrs["stroke-width"]||"1",butt={round:width,square:width,butt:0}[o.attrs["stroke-linecap"]||params["stroke-linecap"]]||0,dashes=[],i=value.length;while(i--){dashes[i]=value[i]*width+((i%2)?1:-1)*butt;}
$(o.node,{"stroke-dasharray":dashes.join(",")});}},setFillAndStroke=function(o,params){var node=o.node,attrs=o.attrs,vis=node.style.visibility;node.style.visibility="hidden";for(var att in params){if(params[has](att)){if(!R._availableAttrs[has](att)){continue;}
var value=params[att];attrs[att]=value;switch(att){case"blur":o.blur(value);break;case"href":case"title":case"target":var pn=node.parentNode;if(pn.tagName.toLowerCase()!="a"){var hl=$("a");pn.insertBefore(hl,node);hl.appendChild(node);pn=hl;}
if(att=="target"){pn.setAttributeNS(xlink,"show",value=="blank"?"new":value);}else{pn.setAttributeNS(xlink,att,value);}
break;case"cursor":node.style.cursor=value;break;case"transform":o.transform(value);break;case"arrow-start":addArrow(o,value);break;case"arrow-end":addArrow(o,value,1);break;case"clip-rect":var rect=Str(value).split(separator);if(rect.length==4){o.clip&&o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);var el=$("clipPath"),rc=$("rect");el.id=R.createUUID();$(rc,{x:rect[0],y:rect[1],width:rect[2],height:rect[3]});el.appendChild(rc);o.paper.defs.appendChild(el);$(node,{"clip-path":"url(#"+el.id+")"});o.clip=rc;}
if(!value){var path=node.getAttribute("clip-path");if(path){var clip=R._g.doc.getElementById(path.replace(/(^url\(#|\)$)/g,E));clip&&clip.parentNode.removeChild(clip);$(node,{"clip-path":E});delete o.clip;}}
break;case"path":if(o.type=="path"){$(node,{d:value?attrs.path=R._pathToAbsolute(value):"M0,0"});o._.dirty=1;if(o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}}
break;case"width":node.setAttribute(att,value);o._.dirty=1;if(attrs.fx){att="x";value=attrs.x;}else{break;}
case"x":if(attrs.fx){value=-attrs.x-(attrs.width||0);}
case"rx":if(att=="rx"&&o.type=="rect"){break;}
case"cx":node.setAttribute(att,value);o.pattern&&updatePosition(o);o._.dirty=1;break;case"height":node.setAttribute(att,value);o._.dirty=1;if(attrs.fy){att="y";value=attrs.y;}else{break;}
case"y":if(attrs.fy){value=-attrs.y-(attrs.height||0);}
case"ry":if(att=="ry"&&o.type=="rect"){break;}
case"cy":node.setAttribute(att,value);o.pattern&&updatePosition(o);o._.dirty=1;break;case"r":if(o.type=="rect"){$(node,{rx:value,ry:value});}else{node.setAttribute(att,value);}
o._.dirty=1;break;case"src":if(o.type=="image"){node.setAttributeNS(xlink,"href",value);}
break;case"stroke-width":if(o._.sx!=1||o._.sy!=1){value/=mmax(abs(o._.sx),abs(o._.sy))||1;}
if(o.paper._vbSize){value*=o.paper._vbSize;}
node.setAttribute(att,value);if(attrs["stroke-dasharray"]){addDashes(o,attrs["stroke-dasharray"],params);}
if(o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}
break;case"stroke-dasharray":addDashes(o,value,params);break;case"fill":var isURL=Str(value).match(R._ISURL);if(isURL){el=$("pattern");var ig=$("image");el.id=R.createUUID();$(el,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});$(ig,{x:0,y:0,"xlink:href":isURL[1]});el.appendChild(ig);(function(el){R._preload(isURL[1],function(){var w=this.offsetWidth,h=this.offsetHeight;$(el,{width:w,height:h});$(ig,{width:w,height:h});o.paper.safari();});})(el);o.paper.defs.appendChild(el);$(node,{fill:"url(#"+el.id+")"});o.pattern=el;o.pattern&&updatePosition(o);break;}
var clr=R.getRGB(value);if(!clr.error){delete params.gradient;delete attrs.gradient;!R.is(attrs.opacity,"undefined")&&R.is(params.opacity,"undefined")&&$(node,{opacity:attrs.opacity});!R.is(attrs["fill-opacity"],"undefined")&&R.is(params["fill-opacity"],"undefined")&&$(node,{"fill-opacity":attrs["fill-opacity"]});}else if((o.type=="circle"||o.type=="ellipse"||Str(value).charAt()!="r")&&addGradientFill(o,value)){if("opacity"in attrs||"fill-opacity"in attrs){var gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){var stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":("opacity"in attrs?attrs.opacity:1)*("fill-opacity"in attrs?attrs["fill-opacity"]:1)});}}
attrs.gradient=value;attrs.fill="none";break;}
clr[has]("opacity")&&$(node,{"fill-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});case"stroke":clr=R.getRGB(value);node.setAttribute(att,clr.hex);att=="stroke"&&clr[has]("opacity")&&$(node,{"stroke-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});if(att=="stroke"&&o._.arrows){"startString"in o._.arrows&&addArrow(o,o._.arrows.startString);"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1);}
break;case"gradient":(o.type=="circle"||o.type=="ellipse"||Str(value).charAt()!="r")&&addGradientFill(o,value);break;case"opacity":if(attrs.gradient&&!attrs[has]("stroke-opacity")){$(node,{"stroke-opacity":value>1?value/100:value});}
case"fill-opacity":if(attrs.gradient){gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":value});}
break;}
default:att=="font-size"&&(value=toInt(value,10)+"px");var cssrule=att.replace(/(\-.)/g,function(w){return w.substring(1).toUpperCase();});node.style[cssrule]=value;o._.dirty=1;node.setAttribute(att,value);break;}}}
tuneText(o,params);node.style.visibility=vis;},leading=1.2,tuneText=function(el,params){if(el.type!="text"||!(params[has]("text")||params[has]("font")||params[has]("font-size")||params[has]("x")||params[has]("y"))){return;}
var a=el.attrs,node=el.node,fontSize=node.firstChild?toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild,E).getPropertyValue("font-size"),10):10;if(params[has]("text")){a.text=params.text;while(node.firstChild){node.removeChild(node.firstChild);}
var texts=Str(params.text).split("\n"),tspans=[],tspan;for(var i=0,ii=texts.length;i<ii;i++){tspan=$("tspan");i&&$(tspan,{dy:fontSize*leading,x:a.x});tspan.appendChild(R._g.doc.createTextNode(texts[i]));node.appendChild(tspan);tspans[i]=tspan;}}else{tspans=node.getElementsByTagName("tspan");for(i=0,ii=tspans.length;i<ii;i++)if(i){$(tspans[i],{dy:fontSize*leading,x:a.x});}else{$(tspans[0],{dy:0});}}
$(node,{x:a.x,y:a.y});el._.dirty=1;var bb=el._getBBox(),dif=a.y-(bb.y+bb.height/2);dif&&R.is(dif,"finite")&&$(tspans[0],{dy:dif});},Element=function(node,svg){var X=0,Y=0;this[0]=this.node=node;node.raphael=true;this.id=R._oid++;node.raphaelid=this.id;this.matrix=R.matrix();this.realPath=null;this.paper=svg;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!svg.bottom&&(svg.bottom=this);this.prev=svg.top;svg.top&&(svg.top.next=this);svg.top=this;this.next=null;},elproto=R.el;Element.prototype=elproto;elproto.constructor=Element;R._engine.path=function(pathString,SVG){var el=$("path");SVG.canvas&&SVG.canvas.appendChild(el);var p=new Element(el,SVG);p.type="path";setFillAndStroke(p,{fill:"none",stroke:"#000",path:pathString});return p;};elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
deg=Str(deg).split(separator);if(deg.length-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2;cy=bbox.y+bbox.height/2;}
this.transform(this._.transform.concat([["r",deg,cx,cy]]));return this;};elproto.scale=function(sx,sy,cx,cy){if(this.removed){return this;}
sx=Str(sx).split(separator);if(sx.length-1){sy=toFloat(sx[1]);cx=toFloat(sx[2]);cy=toFloat(sx[3]);}
sx=toFloat(sx[0]);(sy==null)&&(sy=sx);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);}
cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;this.transform(this._.transform.concat([["s",sx,sy,cx,cy]]));return this;};elproto.translate=function(dx,dy){if(this.removed){return this;}
dx=Str(dx).split(separator);if(dx.length-1){dy=toFloat(dx[1]);}
dx=toFloat(dx[0])||0;dy=+dy||0;this.transform(this._.transform.concat([["t",dx,dy]]));return this;};elproto.transform=function(tstr){var _=this._;if(tstr==null){return _.transform;}
R._extractTransform(this,tstr);this.clip&&$(this.clip,{transform:this.matrix.invert()});this.pattern&&updatePosition(this);this.node&&$(this.node,{transform:this.matrix});if(_.sx!=1||_.sy!=1){var sw=this.attrs[has]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":sw});}
return this;};elproto.hide=function(){!this.removed&&this.paper.safari(this.node.style.display="none");return this;};elproto.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this;};elproto.remove=function(){if(this.removed){return;}
var paper=this.paper;paper.__set__&&paper.__set__.exclude(this);eve.unbind("*.*."+this.id);if(this.gradient){paper.defs.removeChild(this.gradient);}
R._tear(this,paper);if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.removeChild(this.node.parentNode);}else{this.node.parentNode.removeChild(this.node);}
for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
this.removed=true;};elproto._getBBox=function(){if(this.node.style.display=="none"){this.show();var hide=true;}
var bbox={};try{bbox=this.node.getBBox();}catch(e){}finally{bbox=bbox||{};}
hide&&this.hide();return bbox;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var a in this.attrs)if(this.attrs[has](a)){res[a]=this.attrs[a];}
res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;res.transform=this._.transform;return res;}
if(value==null&&R.is(name,"string")){if(name=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
if(name=="transform"){return this._.transform;}
var names=name.split(separator),out={};for(var i=0,ii=names.length;i<ii;i++){name=names[i];if(name in this.attrs){out[name]=this.attrs[name];}else if(R.is(this.paper.customAttributes[name],"function")){out[name]=this.paper.customAttributes[name].def;}else{out[name]=R._availableAttrs[name];}}
return ii-1?out:out[names[0]];}
if(value==null&&R.is(name,"array")){out={};for(i=0,ii=name.length;i<ii;i++){out[name[i]]=this.attr(name[i]);}
return out;}
if(value!=null){var params={};params[name]=value;}else if(name!=null&&R.is(name,"object")){params=name;}
for(var key in params){eve("attr."+key+"."+this.id,this,params[key]);}
for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
setFillAndStroke(this,params);return this;};elproto.toFront=function(){if(this.removed){return this;}
if(this.node.parentNode.tagName.toLowerCase()=="a"){this.node.parentNode.parentNode.appendChild(this.node.parentNode);}else{this.node.parentNode.appendChild(this.node);}
var svg=this.paper;svg.top!=this&&R._tofront(this,svg);return this;};elproto.toBack=function(){if(this.removed){return this;}
var parent=this.node.parentNode;if(parent.tagName.toLowerCase()=="a"){parent.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild);}else if(parent.firstChild!=this.node){parent.insertBefore(this.node,this.node.parentNode.firstChild);}
R._toback(this,this.paper);var svg=this.paper;return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
var node=element.node||element[element.length-1].node;if(node.nextSibling){node.parentNode.insertBefore(this.node,node.nextSibling);}else{node.parentNode.appendChild(this.node);}
R._insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
var node=element.node||element[0].node;node.parentNode.insertBefore(this.node,node);R._insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var t=this;if(+size!==0){var fltr=$("filter"),blur=$("feGaussianBlur");t.attrs.blur=size;fltr.id=R.createUUID();$(blur,{stdDeviation:+size||1.5});fltr.appendChild(blur);t.paper.defs.appendChild(fltr);t._blur=fltr;$(t.node,{filter:"url(#"+fltr.id+")"});}else{if(t._blur){t._blur.parentNode.removeChild(t._blur);delete t._blur;delete t.attrs.blur;}
t.node.removeAttribute("filter");}};R._engine.circle=function(svg,x,y,r){var el=$("circle");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,r:r,fill:"none",stroke:"#000"};res.type="circle";$(el,res.attrs);return res;};R._engine.rect=function(svg,x,y,w,h,r){var el=$("rect");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"};res.type="rect";$(el,res.attrs);return res;};R._engine.ellipse=function(svg,x,y,rx,ry){var el=$("ellipse");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,rx:rx,ry:ry,fill:"none",stroke:"#000"};res.type="ellipse";$(el,res.attrs);return res;};R._engine.image=function(svg,src,x,y,w,h){var el=$("image");$(el,{x:x,y:y,width:w,height:h,preserveAspectRatio:"none"});el.setAttributeNS(xlink,"href",src);svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,src:src};res.type="image";return res;};R._engine.text=function(svg,x,y,text){var el=$("text");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);res.attrs={x:x,y:y,"text-anchor":"middle",text:text,font:R._availableAttrs.font,stroke:"none",fill:"#000"};res.type="text";setFillAndStroke(res,res.attrs);return res;};R._engine.setSize=function(width,height){this.width=width||this.width;this.height=height||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",this.height);if(this._viewBox){this.setViewBox.apply(this,this._viewBox);}
return this;};R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con&&con.container,x=con.x,y=con.y,width=con.width,height=con.height;if(!container){throw new Error("SVG container not found.");}
var cnvs=$("svg"),css="overflow:hidden;",isFloating;x=x||0;y=y||0;width=width||512;height=height||342;$(cnvs,{height:height,version:1.1,width:width,xmlns:"http://www.w3.org/2000/svg"});if(container==1){cnvs.style.cssText=css+"position:absolute;left:"+x+"px;top:"+y+"px";R._g.doc.body.appendChild(cnvs);isFloating=1;}else{cnvs.style.cssText=css+"position:relative";if(container.firstChild){container.insertBefore(cnvs,container.firstChild);}else{container.appendChild(cnvs);}}
container=new R._Paper;container.width=width;container.height=height;container.canvas=cnvs;container.clear();container._left=container._top=0;isFloating&&(container.renderfix=function(){});container.renderfix();return container;};R._engine.setViewBox=function(x,y,w,h,fit){eve("setViewBox",this,this._viewBox,[x,y,w,h,fit]);var size=mmax(w/this.width,h/this.height),top=this.top,aspectRatio=fit?"meet":"xMinYMin",vb,sw;if(x==null){if(this._vbSize){size=1;}
delete this._vbSize;vb="0 0 "+this.width+S+this.height;}else{this._vbSize=size;vb=x+S+y+S+w+S+h;}
$(this.canvas,{viewBox:vb,preserveAspectRatio:aspectRatio});while(size&&top){sw="stroke-width"in top.attrs?top.attrs["stroke-width"]:1;top.attr({"stroke-width":sw});top._.dirty=1;top._.dirtyT=1;top=top.prev;}
this._viewBox=[x,y,w,h,!!fit];return this;};R.prototype.renderfix=function(){var cnvs=this.canvas,s=cnvs.style,pos;try{pos=cnvs.getScreenCTM()||cnvs.createSVGMatrix();}catch(e){pos=cnvs.createSVGMatrix();}
var left=-pos.e%1,top=-pos.f%1;if(left||top){if(left){this._left=(this._left+left)%1;s.left=this._left+"px";}
if(top){this._top=(this._top+top)%1;s.top=this._top+"px";}}};R.prototype.clear=function(){R.eve("clear",this);var c=this.canvas;while(c.firstChild){c.removeChild(c.firstChild);}
this.bottom=this.top=null;(this.desc=$("desc")).appendChild(R._g.doc.createTextNode("Created with Rapha\xebl "+R.version));c.appendChild(this.desc);c.appendChild(this.defs=$("defs"));};R.prototype.remove=function(){eve("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}};var setproto=R.st;for(var method in elproto)if(elproto[has](method)&&!setproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg);});};})(method);}}(window.Raphael);window.Raphael.vml&&function(R){var has="hasOwnProperty",Str=String,toFloat=parseFloat,math=Math,round=math.round,mmax=math.max,mmin=math.min,abs=math.abs,fillString="fill",separator=/[, ]+/,eve=R.eve,ms=" progid:DXImageTransform.Microsoft",S=" ",E="",map={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},bites=/([clmz]),?([^clmz]*)/gi,blurregexp=/ progid:\S+Blur\([^\)]+\)/g,val=/-?[^,\s-]+/g,cssDot="position:absolute;left:0;top:0;width:1px;height:1px",zoom=21600,pathTypes={path:1,rect:1,image:1},ovalTypes={circle:1,ellipse:1},path2vml=function(path){var total=/[ahqstv]/ig,command=R._pathToAbsolute;Str(path).match(total)&&(command=R._path2curve);total=/[clmz]/g;if(command==R._pathToAbsolute&&!Str(path).match(total)){var res=Str(path).replace(bites,function(all,command,args){var vals=[],isMove=command.toLowerCase()=="m",res=map[command];args.replace(val,function(value){if(isMove&&vals.length==2){res+=vals+map[command=="m"?"l":"L"];vals=[];}
vals.push(round(value*zoom));});return res+vals;});return res;}
var pa=command(path),p,r;res=[];for(var i=0,ii=pa.length;i<ii;i++){p=pa[i];r=pa[i][0].toLowerCase();r=="z"&&(r="x");for(var j=1,jj=p.length;j<jj;j++){r+=round(p[j]*zoom)+(j!=jj-1?",":E);}
res.push(r);}
return res.join(S);},compensation=function(deg,dx,dy){var m=R.matrix();m.rotate(-deg,.5,.5);return{dx:m.x(dx,dy),dy:m.y(dx,dy)};},setCoords=function(p,sx,sy,dx,dy,deg){var _=p._,m=p.matrix,fillpos=_.fillpos,o=p.node,s=o.style,y=1,flip="",dxdy,kx=zoom/sx,ky=zoom/sy;s.visibility="hidden";if(!sx||!sy){return;}
o.coordsize=abs(kx)+S+abs(ky);s.rotation=deg*(sx*sy<0?-1:1);if(deg){var c=compensation(deg,dx,dy);dx=c.dx;dy=c.dy;}
sx<0&&(flip+="x");sy<0&&(flip+=" y")&&(y=-1);s.flip=flip;o.coordorigin=(dx*-kx)+S+(dy*-ky);if(fillpos||_.fillsize){var fill=o.getElementsByTagName(fillString);fill=fill&&fill[0];o.removeChild(fill);if(fillpos){c=compensation(deg,m.x(fillpos[0],fillpos[1]),m.y(fillpos[0],fillpos[1]));fill.position=c.dx*y+S+c.dy*y;}
if(_.fillsize){fill.size=_.fillsize[0]*abs(sx)+S+_.fillsize[1]*abs(sy);}
o.appendChild(fill);}
s.visibility="visible";};R.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version;};var addArrow=function(o,value,isEnd){var values=Str(value).toLowerCase().split("-"),se=isEnd?"end":"start",i=values.length,type="classic",w="medium",h="medium";while(i--){switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":case"narrow":h=values[i];break;case"long":case"short":w=values[i];break;}}
var stroke=o.node.getElementsByTagName("stroke")[0];stroke[se+"arrow"]=type;stroke[se+"arrowlength"]=w;stroke[se+"arrowwidth"]=h;},setFillAndStroke=function(o,params){o.attrs=o.attrs||{};var node=o.node,a=o.attrs,s=node.style,xy,newpath=pathTypes[o.type]&&(params.x!=a.x||params.y!=a.y||params.width!=a.width||params.height!=a.height||params.cx!=a.cx||params.cy!=a.cy||params.rx!=a.rx||params.ry!=a.ry||params.r!=a.r),isOval=ovalTypes[o.type]&&(a.cx!=params.cx||a.cy!=params.cy||a.r!=params.r||a.rx!=params.rx||a.ry!=params.ry),res=o;for(var par in params)if(params[has](par)){a[par]=params[par];}
if(newpath){a.path=R._getPath[o.type](o);o._.dirty=1;}
params.href&&(node.href=params.href);params.title&&(node.title=params.title);params.target&&(node.target=params.target);params.cursor&&(s.cursor=params.cursor);"blur"in params&&o.blur(params.blur);if(params.path&&o.type=="path"||newpath){node.path=path2vml(~Str(a.path).toLowerCase().indexOf("r")?R._pathToAbsolute(a.path):a.path);if(o.type=="image"){o._.fillpos=[a.x,a.y];o._.fillsize=[a.width,a.height];setCoords(o,1,1,0,0,0);}}"transform"in params&&o.transform(params.transform);if(isOval){var cx=+a.cx,cy=+a.cy,rx=+a.rx||+a.r||0,ry=+a.ry||+a.r||0;node.path=R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",round((cx-rx)*zoom),round((cy-ry)*zoom),round((cx+rx)*zoom),round((cy+ry)*zoom),round(cx*zoom));}
if("clip-rect"in params){var rect=Str(params["clip-rect"]).split(separator);if(rect.length==4){rect[2]=+rect[2]+(+rect[0]);rect[3]=+rect[3]+(+rect[1]);var div=node.clipRect||R._g.doc.createElement("div"),dstyle=div.style;dstyle.clip=R.format("rect({1}px {2}px {3}px {0}px)",rect);if(!node.clipRect){dstyle.position="absolute";dstyle.top=0;dstyle.left=0;dstyle.width=o.paper.width+"px";dstyle.height=o.paper.height+"px";node.parentNode.insertBefore(div,node);div.appendChild(node);node.clipRect=div;}}
if(!params["clip-rect"]){node.clipRect&&(node.clipRect.style.clip="auto");}}
if(o.textpath){var textpathStyle=o.textpath.style;params.font&&(textpathStyle.font=params.font);params["font-family"]&&(textpathStyle.fontFamily='"'+params["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,E)+'"');params["font-size"]&&(textpathStyle.fontSize=params["font-size"]);params["font-weight"]&&(textpathStyle.fontWeight=params["font-weight"]);params["font-style"]&&(textpathStyle.fontStyle=params["font-style"]);}
if("arrow-start"in params){addArrow(res,params["arrow-start"]);}
if("arrow-end"in params){addArrow(res,params["arrow-end"],1);}
if(params.opacity!=null||params["stroke-width"]!=null||params.fill!=null||params.src!=null||params.stroke!=null||params["stroke-width"]!=null||params["stroke-opacity"]!=null||params["fill-opacity"]!=null||params["stroke-dasharray"]!=null||params["stroke-miterlimit"]!=null||params["stroke-linejoin"]!=null||params["stroke-linecap"]!=null){var fill=node.getElementsByTagName(fillString),newfill=false;fill=fill&&fill[0];!fill&&(newfill=fill=createNode(fillString));if(o.type=="image"&&params.src){fill.src=params.src;}
params.fill&&(fill.on=true);if(fill.on==null||params.fill=="none"||params.fill===null){fill.on=false;}
if(fill.on&&params.fill){var isURL=Str(params.fill).match(R._ISURL);if(isURL){fill.parentNode==node&&node.removeChild(fill);fill.rotate=true;fill.src=isURL[1];fill.type="tile";var bbox=o.getBBox(1);fill.position=bbox.x+S+bbox.y;o._.fillpos=[bbox.x,bbox.y];R._preload(isURL[1],function(){o._.fillsize=[this.offsetWidth,this.offsetHeight];});}else{fill.color=R.getRGB(params.fill).hex;fill.src=E;fill.type="solid";if(R.getRGB(params.fill).error&&(res.type in{circle:1,ellipse:1}||Str(params.fill).charAt()!="r")&&addGradientFill(res,params.fill,fill)){a.fill="none";a.gradient=params.fill;fill.rotate=false;}}}
if("fill-opacity"in params||"opacity"in params){var opacity=((+a["fill-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+R.getRGB(params.fill).o+1||2)-1);opacity=mmin(mmax(opacity,0),1);fill.opacity=opacity;if(fill.src){fill.color="none";}}
node.appendChild(fill);var stroke=(node.getElementsByTagName("stroke")&&node.getElementsByTagName("stroke")[0]),newstroke=false;!stroke&&(newstroke=stroke=createNode("stroke"));if((params.stroke&&params.stroke!="none")||params["stroke-width"]||params["stroke-opacity"]!=null||params["stroke-dasharray"]||params["stroke-miterlimit"]||params["stroke-linejoin"]||params["stroke-linecap"]){stroke.on=true;}
(params.stroke=="none"||params.stroke===null||stroke.on==null||params.stroke==0||params["stroke-width"]==0)&&(stroke.on=false);var strokeColor=R.getRGB(params.stroke);stroke.on&&params.stroke&&(stroke.color=strokeColor.hex);opacity=((+a["stroke-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+strokeColor.o+1||2)-1);var width=(toFloat(params["stroke-width"])||1)*.75;opacity=mmin(mmax(opacity,0),1);params["stroke-width"]==null&&(width=a["stroke-width"]);params["stroke-width"]&&(stroke.weight=width);width&&width<1&&(opacity*=width)&&(stroke.weight=1);stroke.opacity=opacity;params["stroke-linejoin"]&&(stroke.joinstyle=params["stroke-linejoin"]||"miter");stroke.miterlimit=params["stroke-miterlimit"]||8;params["stroke-linecap"]&&(stroke.endcap=params["stroke-linecap"]=="butt"?"flat":params["stroke-linecap"]=="square"?"square":"round");if(params["stroke-dasharray"]){var dasharray={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};stroke.dashstyle=dasharray[has](params["stroke-dasharray"])?dasharray[params["stroke-dasharray"]]:E;}
newstroke&&node.appendChild(stroke);}
if(res.type=="text"){res.paper.canvas.style.display=E;var span=res.paper.span,m=100,fontSize=a.font&&a.font.match(/\d+(?:\.\d*)?(?=px)/);s=span.style;a.font&&(s.font=a.font);a["font-family"]&&(s.fontFamily=a["font-family"]);a["font-weight"]&&(s.fontWeight=a["font-weight"]);a["font-style"]&&(s.fontStyle=a["font-style"]);fontSize=toFloat(a["font-size"]||fontSize&&fontSize[0])||10;s.fontSize=fontSize*m+"px";res.textpath.string&&(span.innerHTML=Str(res.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var brect=span.getBoundingClientRect();res.W=a.w=(brect.right-brect.left)/m;res.H=a.h=(brect.bottom-brect.top)/m;res.X=a.x;res.Y=a.y+res.H/2;("x"in params||"y"in params)&&(res.path.v=R.format("m{0},{1}l{2},{1}",round(a.x*zoom),round(a.y*zoom),round(a.x*zoom)+1));var dirtyattrs=["x","y","text","font","font-family","font-weight","font-style","font-size"];for(var d=0,dd=dirtyattrs.length;d<dd;d++)if(dirtyattrs[d]in params){res._.dirty=1;break;}
switch(a["text-anchor"]){case"start":res.textpath.style["v-text-align"]="left";res.bbx=res.W/2;break;case"end":res.textpath.style["v-text-align"]="right";res.bbx=-res.W/2;break;default:res.textpath.style["v-text-align"]="center";res.bbx=0;break;}
res.textpath.style["v-text-kern"]=true;}},addGradientFill=function(o,gradient,fill){o.attrs=o.attrs||{};var attrs=o.attrs,pow=Math.pow,opacity,oindex,type="linear",fxfy=".5 .5";o.attrs.gradient=gradient;gradient=Str(gradient).replace(R._radial_gradient,function(all,fx,fy){type="radial";if(fx&&fy){fx=toFloat(fx);fy=toFloat(fy);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*((fy>.5)*2-1)+.5);fxfy=fx+S+fy;}
return E;});gradient=gradient.split(/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}}
var dots=R._parseDots(gradient);if(!dots){return null;}
o=o.shape||o.node;if(dots.length){o.removeChild(fill);fill.on=true;fill.method="none";fill.color=dots[0].color;fill.color2=dots[dots.length-1].color;var clrs=[];for(var i=0,ii=dots.length;i<ii;i++){dots[i].offset&&clrs.push(dots[i].offset+S+dots[i].color);}
fill.colors=clrs.length?clrs.join():"0% "+fill.color;if(type=="radial"){fill.type="gradientTitle";fill.focus="100%";fill.focussize="0 0";fill.focusposition=fxfy;fill.angle=0;}else{fill.type="gradient";fill.angle=(270-angle)%360;}
o.appendChild(fill);}
return 1;},Element=function(node,vml){this[0]=this.node=node;node.raphael=true;this.id=R._oid++;node.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=vml;this.matrix=R.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!vml.bottom&&(vml.bottom=this);this.prev=vml.top;vml.top&&(vml.top.next=this);vml.top=this;this.next=null;};var elproto=R.el;Element.prototype=elproto;elproto.constructor=Element;elproto.transform=function(tstr){if(tstr==null){return this._.transform;}
var vbs=this.paper._viewBoxShift,vbt=vbs?"s"+[vbs.scale,vbs.scale]+"-1-1t"+[vbs.dx,vbs.dy]:E,oldt;if(vbs){oldt=tstr=Str(tstr).replace(/\.{3}|\u2026/g,this._.transform||E);}
R._extractTransform(this,vbt+tstr);var matrix=this.matrix.clone(),skew=this.skew,o=this.node,split,isGrad=~Str(this.attrs.fill).indexOf("-"),isPatt=!Str(this.attrs.fill).indexOf("url(");matrix.translate(-.5,-.5);if(isPatt||isGrad||this.type=="image"){skew.matrix="1 0 0 1";skew.offset="0 0";split=matrix.split();if((isGrad&&split.noRotation)||!split.isSimple){o.style.filter=matrix.toFilter();var bb=this.getBBox(),bbt=this.getBBox(1),dx=bb.x-bbt.x,dy=bb.y-bbt.y;o.coordorigin=(dx*-zoom)+S+(dy*-zoom);setCoords(this,1,1,dx,dy,0);}else{o.style.filter=E;setCoords(this,split.scalex,split.scaley,split.dx,split.dy,split.rotate);}}else{o.style.filter=E;skew.matrix=Str(matrix);skew.offset=matrix.offset();}
oldt&&(this._.transform=oldt);return this;};elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
if(deg==null){return;}
deg=Str(deg).split(separator);if(deg.length-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2;cy=bbox.y+bbox.height/2;}
this._.dirtyT=1;this.transform(this._.transform.concat([["r",deg,cx,cy]]));return this;};elproto.translate=function(dx,dy){if(this.removed){return this;}
dx=Str(dx).split(separator);if(dx.length-1){dy=toFloat(dx[1]);}
dx=toFloat(dx[0])||0;dy=+dy||0;if(this._.bbox){this._.bbox.x+=dx;this._.bbox.y+=dy;}
this.transform(this._.transform.concat([["t",dx,dy]]));return this;};elproto.scale=function(sx,sy,cx,cy){if(this.removed){return this;}
sx=Str(sx).split(separator);if(sx.length-1){sy=toFloat(sx[1]);cx=toFloat(sx[2]);cy=toFloat(sx[3]);isNaN(cx)&&(cx=null);isNaN(cy)&&(cy=null);}
sx=toFloat(sx[0]);(sy==null)&&(sy=sx);(cy==null)&&(cx=cy);if(cx==null||cy==null){var bbox=this.getBBox(1);}
cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;this.transform(this._.transform.concat([["s",sx,sy,cx,cy]]));this._.dirtyT=1;return this;};elproto.hide=function(){!this.removed&&(this.node.style.display="none");return this;};elproto.show=function(){!this.removed&&(this.node.style.display=E);return this;};elproto._getBBox=function(){if(this.removed){return{};}
return{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H};};elproto.remove=function(){if(this.removed){return;}
this.paper.__set__&&this.paper.__set__.exclude(this);R.eve.unbind("*.*."+this.id);R._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
this.removed=true;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var a in this.attrs)if(this.attrs[has](a)){res[a]=this.attrs[a];}
res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;res.transform=this._.transform;return res;}
if(value==null&&R.is(name,"string")){if(name==fillString&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
var names=name.split(separator),out={};for(var i=0,ii=names.length;i<ii;i++){name=names[i];if(name in this.attrs){out[name]=this.attrs[name];}else if(R.is(this.paper.customAttributes[name],"function")){out[name]=this.paper.customAttributes[name].def;}else{out[name]=R._availableAttrs[name];}}
return ii-1?out:out[names[0]];}
if(this.attrs&&value==null&&R.is(name,"array")){out={};for(i=0,ii=name.length;i<ii;i++){out[name[i]]=this.attr(name[i]);}
return out;}
var params;if(value!=null){params={};params[name]=value;}
value==null&&R.is(name,"object")&&(params=name);for(var key in params){eve("attr."+key+"."+this.id,this,params[key]);}
if(params){for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
if(params.text&&this.type=="text"){this.textpath.string=params.text;}
setFillAndStroke(this,params);}
return this;};elproto.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&R._tofront(this,this.paper);return this;};elproto.toBack=function(){if(this.removed){return this;}
if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);R._toback(this,this.paper);}
return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
if(element.constructor==R.st.constructor){element=element[element.length-1];}
if(element.node.nextSibling){element.node.parentNode.insertBefore(this.node,element.node.nextSibling);}else{element.node.parentNode.appendChild(this.node);}
R._insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
if(element.constructor==R.st.constructor){element=element[0];}
element.node.parentNode.insertBefore(this.node,element.node);R._insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var s=this.node.runtimeStyle,f=s.filter;f=f.replace(blurregexp,E);if(+size!==0){this.attrs.blur=size;s.filter=f+S+ms+".Blur(pixelradius="+(+size||1.5)+")";s.margin=R.format("-{0}px 0 0 -{0}px",round(+size||1.5));}else{s.filter=f;s.margin=0;delete this.attrs.blur;}};R._engine.path=function(pathString,vml){var el=createNode("shape");el.style.cssText=cssDot;el.coordsize=zoom+S+zoom;el.coordorigin=vml.coordorigin;var p=new Element(el,vml),attr={fill:"none",stroke:"#000"};pathString&&(attr.path=pathString);p.type="path";p.path=[];p.Path=E;setFillAndStroke(p,attr);vml.canvas.appendChild(el);var skew=createNode("skew");skew.on=true;el.appendChild(skew);p.skew=skew;p.transform(E);return p;};R._engine.rect=function(vml,x,y,w,h,r){var path=R._rectPath(x,y,w,h,r),res=vml.path(path),a=res.attrs;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.r=r;a.path=path;res.type="rect";return res;};R._engine.ellipse=function(vml,x,y,rx,ry){var res=vml.path(),a=res.attrs;res.X=x-rx;res.Y=y-ry;res.W=rx*2;res.H=ry*2;res.type="ellipse";setFillAndStroke(res,{cx:x,cy:y,rx:rx,ry:ry});return res;};R._engine.circle=function(vml,x,y,r){var res=vml.path(),a=res.attrs;res.X=x-r;res.Y=y-r;res.W=res.H=r*2;res.type="circle";setFillAndStroke(res,{cx:x,cy:y,r:r});return res;};R._engine.image=function(vml,src,x,y,w,h){var path=R._rectPath(x,y,w,h),res=vml.path(path).attr({stroke:"none"}),a=res.attrs,node=res.node,fill=node.getElementsByTagName(fillString)[0];a.src=src;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.path=path;res.type="image";fill.parentNode==node&&node.removeChild(fill);fill.rotate=true;fill.src=src;fill.type="tile";res._.fillpos=[x,y];res._.fillsize=[w,h];node.appendChild(fill);setCoords(res,1,1,0,0,0);return res;};R._engine.text=function(vml,x,y,text){var el=createNode("shape"),path=createNode("path"),o=createNode("textpath");x=x||0;y=y||0;text=text||"";path.v=R.format("m{0},{1}l{2},{1}",round(x*zoom),round(y*zoom),round(x*zoom)+1);path.textpathok=true;o.string=Str(text);o.on=true;el.style.cssText=cssDot;el.coordsize=zoom+S+zoom;el.coordorigin="0 0";var p=new Element(el,vml),attr={fill:"#000",stroke:"none",font:R._availableAttrs.font,text:text};p.shape=el;p.path=path;p.textpath=o;p.type="text";p.attrs.text=Str(text);p.attrs.x=x;p.attrs.y=y;p.attrs.w=1;p.attrs.h=1;setFillAndStroke(p,attr);el.appendChild(o);el.appendChild(path);vml.canvas.appendChild(el);var skew=createNode("skew");skew.on=true;el.appendChild(skew);p.skew=skew;p.transform(E);return p;};R._engine.setSize=function(width,height){var cs=this.canvas.style;this.width=width;this.height=height;width==+width&&(width+="px");height==+height&&(height+="px");cs.width=width;cs.height=height;cs.clip="rect(0 "+width+" "+height+" 0)";if(this._viewBox){R._engine.setViewBox.apply(this,this._viewBox);}
return this;};R._engine.setViewBox=function(x,y,w,h,fit){R.eve("setViewBox",this,this._viewBox,[x,y,w,h,fit]);var width=this.width,height=this.height,size=1/mmax(w/width,h/height),H,W;if(fit){H=height/h;W=width/w;if(w*H<width){x-=(width-w*H)/2/H;}
if(h*W<height){y-=(height-h*W)/2/W;}}
this._viewBox=[x,y,w,h,!!fit];this._viewBoxShift={dx:-x,dy:-y,scale:size};this.forEach(function(el){el.transform("...");});return this;};var createNode;R._engine.initWin=function(win){var doc=win.document;doc.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!doc.namespaces.rvml&&doc.namespaces.add("rvml","urn:schemas-microsoft-com:vml");createNode=function(tagName){return doc.createElement('<rvml:'+tagName+' class="rvml">');};}catch(e){createNode=function(tagName){return doc.createElement('<'+tagName+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');};}};R._engine.initWin(R._g.win);R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con.container,height=con.height,s,width=con.width,x=con.x,y=con.y;if(!container){throw new Error("VML container not found.");}
var res=new R._Paper,c=res.canvas=R._g.doc.createElement("div"),cs=c.style;x=x||0;y=y||0;width=width||512;height=height||342;res.width=width;res.height=height;width==+width&&(width+="px");height==+height&&(height+="px");res.coordsize=zoom*1e3+S+zoom*1e3;res.coordorigin="0 0";res.span=R._g.doc.createElement("span");res.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";c.appendChild(res.span);cs.cssText=R.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",width,height);if(container==1){R._g.doc.body.appendChild(c);cs.left=x+"px";cs.top=y+"px";cs.position="absolute";}else{if(container.firstChild){container.insertBefore(c,container.firstChild);}else{container.appendChild(c);}}
res.renderfix=function(){};return res;};R.prototype.clear=function(){R.eve("clear",this);this.canvas.innerHTML=E;this.span=R._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null;};R.prototype.remove=function(){R.eve("remove",this);this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=typeof this[i]=="function"?R._removedFactory(i):null;}
return true;};var setproto=R.st;for(var method in elproto)if(elproto[has](method)&&!setproto[has](method)){setproto[method]=(function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg);});};})(method);}}(window.Raphael);;(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);;(function(window){function Vec2(x,y){this.x=x;this.y=y;}
window.Vec2=Vec2;var rad2deg=57.29577951308232;var deg2rad=0.017453292519943295;var epsilon=0.0000001;Vec2.new_polar_deg=function(len,angle){var v=new Vec2(len,0);return v.rotate_deg(angle);};Vec2.new_polar=function(len,angle){var v=new Vec2(len,0);v.rotate(angle);return v;};Vec2.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y);};Vec2.prototype.len_sq=function(){return this.x*this.x+this.y*this.y;};Vec2.prototype.dist=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return Math.sqrt(dx*dx+dy*dy);};Vec2.prototype.dist_sq=function(v){var dx=this.x-v.x;var dy=this.y-v.y;return dx*dx+dy*dy;};Vec2.prototype.dist_sq_xy=function(x,y){var dx=this.x-x;var dy=this.y-y;return dx*dx+dy*dy;};Vec2.prototype.dot=function(v){return this.x*v.x+this.y*v.y;};Vec2.prototype.dot_xy=function(x,y){return this.x*x+this.y*y;};Vec2.prototype.clone=function(){return new Vec2(this.x,this.y);};Vec2.prototype.add=function(v){return new Vec2(this.x+v.x,this.y+v.y);};Vec2.prototype.add_xy=function(x,y){return new Vec2(this.x+x,this.y+y);};Vec2.prototype.sub=function(v){return new Vec2(this.x-v.x,this.y-v.y);};Vec2.prototype.sub_xy=function(x,y){return new Vec2(this.x-x,this.y-y);};Vec2.prototype.mult=function(v){return new Vec2(this.x*v.x,this.y*v.y);};Vec2.prototype.mult_xy=function(x,y){return new Vec2(this.x*x,this.y*y);};Vec2.prototype.scale=function(f){return new Vec2(this.x*f,this.y*f);};Vec2.prototype.neg=function(f){return new Vec2(-this.x,-this.y);};Vec2.prototype.normalize=function(){var len=this.len();if(len==0){return new Vec2(0,1);}else if(len!=1){return this.scale(1.0/len);}
return new Vec2(this.x,this.y);};Vec2.prototype.set_len=function(l){return this.normalize().scale(l);};Vec2.prototype.project=function(v){return v.set_len(this.dot(v));};Vec2.prototype.toString=function(){var str="";str+="[";str+=this.x;str+=",";str+=this.y;str+="]";return str;};Vec2.prototype.rotate=function(rad){var c=Math.cos(rad);var s=Math.sin(rad);var px=this.x*c-this.y*s;var py=this.x*s+this.y*c;return new Vec2(px,py);};Vec2.prototype.rotate_deg=function(deg){return this.rotate(deg*deg2rad);};Vec2.prototype.lerp=function(v,alpha){var inv_alpha=1-alpha;return new Vec2(this.x*inv_alpha+v.x*alpha,this.y*inv_alpha+v.y*alpha);};Vec2.prototype.angle=function(){return Math.atan2(this.y,this.x);};Vec2.prototype.angle_deg=function(){return Math.atan2(this.y,this.x)*rad2deg;};Vec2.prototype.equals=function(v){if(Math.abs(this.x-v.x)>epsilon){return false;}else if(Math.abs(this.y-v.y)>epsilon){return false;}
return true;};Vec2.prototype.equals_xy=function(x,y){if(Math.abs(this.x-x)>epsilon){return false;}else if(Math.abs(this.y-y)>epsilon){return false;}
return true;};})(window);(function(window){function BEllipse(cx,cy,rx,ry){this.type='ellipse';this.x=cx-rx;this.y=cy-ry;this.sx=2*rx;this.sy=2*ry;this.hx=rx;this.hy=ry;this.cx=cx;this.cy=cy;this.mx=cx+rx;this.my=cy+ry;}
window.BEllipse=BEllipse;BEllipse.prototype.collide_segment=function(a,b){var collisions=[];if(a.equals(b)){return collisions;}
var c=new Vec2(this.cx,this.cy);a=a.sub(c).mult_xy(1/this.hx,1/this.hy);b=b.sub(c).mult_xy(1/this.hx,1/this.hy);if(a.len_sq()<1&&b.len_sq()<1){return collisions;}
var ab=b.sub(a);var A=(ab.x*ab.x+ab.y*ab.y);var B=2*(ab.x*a.x+ab.y*a.y);var C=a.x*a.x+a.y*a.y-1;var u=B*B-4*A*C;if(u<0){return collisions;}
u=Math.sqrt(u);var u1=(-B+u)/(2*A);var u2=(-B-u)/(2*A);if(u1>=0&&u1<=1){var pos=a.add(ab.scale(u1));collisions.push(pos);}
if(u1!=u2&&u2>=0&&u2<=1){var pos=a.add(ab.scale(u2));collisions.push(pos);}
for(var i=0;i<collisions.length;i++){collisions[i]=collisions[i].mult_xy(this.hx,this.hy);collisions[i]=collisions[i].add_xy(this.cx,this.cy);}
return collisions;};function BRect(x,y,sx,sy){this.type='rect';this.x=x;this.y=y;this.sx=sx;this.sy=sy;this.hx=sx/2;this.hy=sy/2;this.cx=x+this.hx;this.cy=y+this.hy;this.mx=x+sx;this.my=y+sy;}
window.BRect=BRect;BRect.new_centered=function(cx,cy,sx,sy){return new BRect(cx-sx/2,cy-sy/2,sx,sy);};function line_intersect(a,b,c,d){var f=((d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y));if(f==0){return null;}
f=1/f;var fab=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))*f;if(fab<0||fab>1){return null;}
var fcd=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))*f;if(fcd<0||fcd>1){return null;}
return new Vec2(a.x+fab*(b.x-a.x),a.y+fab*(b.y-a.y));}
BRect.prototype.collide_segment=function(a,b){var collisions=[];var corners=[new Vec2(this.x,this.y),new Vec2(this.x,this.my),new Vec2(this.mx,this.my),new Vec2(this.mx,this.y)];var pos=line_intersect(a,b,corners[0],corners[1]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[1],corners[2]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[2],corners[3]);if(pos)collisions.push(pos);pos=line_intersect(a,b,corners[3],corners[0]);if(pos)collisions.push(pos);return collisions;};BRect.prototype.contains_vec=function(vec){return(vec.x>=this.x&&vec.x<=this.mx&&vec.y>=this.y&&vec.y<=this.my);};BRect.prototype.contains_xy=function(x,y){return(x>=this.x&&x<=this.mx&&y>=this.y&&y<=this.my);};BEllipse.prototype.contains_vec=function(v){v=v.mult_xy(this.hx,this.hy);return v.len_sq()<=1;};BEllipse.prototype.contains_xy=function(x,y){return this.contains(new Vec2(x,y));};})(window);;(function(window){function EdgeEnd(pos_x,pos_y){this.x=pos_x;this.y=pos_y;this.get_pos=function(){return new Vec2(this.x,this.y);}}
function CloseButton(graph,entity,entity_type,pos_x,pos_y){var self=this;var visible=false;var close_button_radius=graph.style.close_button_radius||8;var close_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);close_circle.attr({'opacity':0,'fill':graph.style.close_button_color||"black",'cursor':'pointer','stroke':'none'});close_circle.transform(graph.get_transform());graph.set_scrolling(close_circle);var close_label=graph.r.text(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,"x");close_label.attr({'fill':graph.style.close_button_x_color||"white",'font-size':close_button_radius,'cursor':'pointer'});close_label.transform(graph.get_transform());graph.set_scrolling(close_label);var dummy_circle=graph.r.circle(entity.get_pos().x+pos_x,entity.get_pos().y+pos_y,close_button_radius);dummy_circle.attr({'opacity':1,'fill':'transparent','stroke':'none','cursor':'pointer'});dummy_circle.transform(graph.get_transform());graph.set_scrolling(dummy_circle);this.get_pos=function(){return entity.get_pos().add_xy(pos_x,pos_y);};this.update_pos=function(){var pos=self.get_pos();close_circle.attr({'cx':pos.x,'cy':pos.y});dummy_circle.attr({'cx':pos.x,'cy':pos.y});close_label.attr({'x':pos.x,'y':pos.y});};function hover_in(){if(!visible){return;}
close_circle.animate({'r':close_button_radius*1.5},300,'elastic');dummy_circle.animate({'r':close_button_radius*1.5},300,'elastic');}
function hover_out(){if(!visible){return;}
close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');}
dummy_circle.hover(hover_in,hover_out);close_circle.hover(hover_in,hover_out);close_label.hover(hover_in,hover_out);function click_action(){if(!visible){return;}
close_circle.attr({'r':close_button_radius*2});dummy_circle.attr({'r':close_button_radius*2});close_circle.animate({'r':close_button_radius},400,'linear');dummy_circle.animate({'r':close_button_radius},400,'linear');if(entity_type=="node"){$.when(GraphNode.destruction_callback(entity)).done(function(){entity.remove();});}else if(entity_type=="edge"){$.when(GraphEdge.destruction_callback(entity)).done(function(){entity.remove();});}}
dummy_circle.click(click_action);close_circle.click(click_action);close_label.click(click_action);this.show=function(){if(!visible){close_circle.animate({'opacity':1},100,'linear');close_label.animate({'opacity':1},100,'linear');visible=true;}}
this.hide=function(){if(visible){close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear');visible=false;}}
this.remove=function(){if(visible){visible=false;close_circle.animate({'opacity':0},100,'linear');close_label.animate({'opacity':0},100,'linear',self.remove);}else{close_circle.remove();close_label.remove();dummy_circle.remove();}}}
function Connector(graph,node,pos_x,pos_y){var visible=false;var conn_circle=graph.r.circle(node.get_pos().x+pos_x,node.get_pos().y+pos_y,4);conn_circle.attr({'opacity':0,'fill':graph.style.node_outline_color,'stroke':'none'});conn_circle.transform(graph.get_transform());graph.set_scrolling(conn_circle);var self=this;this.update_pos=function(){conn_circle.attr({'cx':node.get_pos().x+pos_x,'cy':node.get_pos().y+pos_y});};this.get_pos=function(){return new node.get_pos().add_xy(pos_x,pos_y);};this.remove=function(){conn_circle.remove();}
function hover_in(){if(!visible){return;}
conn_circle.animate({'r':8},300,'elastic');if(graph.creating_edge){graph.target_node=node;conn_circle.animate({'fill':graph.style.connector_active_color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_selected_width,},100,'linear');}}
function hover_out(){if(!visible){return;}
conn_circle.animate({'r':graph.style.connector_radius,'fill':graph.style.node_outline_color,'stroke':'none'},400,'linear');graph.target_node=null;}
conn_circle.hover(hover_in,hover_out);var drag_down=function(){if(!visible){return;}
self.ox=conn_circle.attr("cx");self.oy=conn_circle.attr("cy");self.edge_start=new EdgeEnd(self.ox,self.oy);self.edge_end=new EdgeEnd(self.ox,self.oy);self.edge_tmp=new GraphEdge(graph,'',self.edge_start,self.edge_end,true);graph.creating_edge=true;};var drag_move=function(dx,dy){if(!visible){return;}
self.edge_end.x=self.ox+dx;self.edge_end.y=self.oy+dy;self.edge_tmp.update();};var drag_up=function(){if(!visible){return;}
graph.creating_edge=false;self.edge_tmp.remove();if(graph.target_node){var edge_prop=GraphEdge.creation_callback(node,graph.target_node);if(edge_prop){var new_edge=new GraphEdge(graph,edge_prop.label,node,graph.target_node);GraphEdge.new_edge_callback(new_edge);}}};conn_circle.drag(drag_move,drag_down,drag_up);function show(){if(!visible){conn_circle.animate({'opacity':1},100,'linear');visible=true;}}
function hide(){if(visible){conn_circle.animate({'opacity':0},100,'linear');visible=false;}}
this.show=show;this.hide=hide;}
function Graph(r,style,viewport){var self=this;var nodes=[];var edges=[];var graph={};var links={};var uid=1;var selected_entity=null;self.creating_edge=false;self.target_node=null;self.r=r;self.style=style;var tr_x=0,tr_y=0;var background=r.rect(0,0,'100%','100%').attr({'fill':'white','stroke':'none','opacity':0,'cursor':'move'});this.get_transform=function(){return"T"+tr_x+","+tr_y};var translate_all=function(dx,dy){tr_x+=dx;tr_y+=dy;var tstr=self.get_transform();r.forEach(function(el){if(el!=background){el.transform(tstr);}});};var get_bounds=function(){var minx=Number.MAX_VALUE;var miny=Number.MAX_VALUE;var maxx=Number.MIN_VALUE;var maxy=Number.MIN_VALUE;for(var i=0;i<nodes.length;i++){var pos=nodes[i].get_pos();minx=Math.min(minx,pos.x);miny=Math.min(miny,pos.y);maxx=Math.max(maxx,pos.x);maxy=Math.max(maxy,pos.y);}
minx=minx-style.node_size_x/2+tr_x;miny=miny-style.node_size_y/2+tr_y;maxx=maxx+style.node_size_x/2+tr_x;maxy=maxy+style.node_size_y/2+tr_y;return{minx:minx,miny:miny,maxx:maxx,maxy:maxy};};var translation_respects_viewport=function(dx,dy,margin){if(!viewport){return true;}
margin=margin||0;var b=get_bounds();var width=viewport.offsetWidth;var height=viewport.offsetHeight;if((dy<0&&b.maxy+dy<margin)||(dy>0&&b.miny+dy>height-margin)||(dx<0&&b.maxx+dx<margin)||(dx>0&&b.minx+dx>width-margin)){return false;}
return true;}
this.set_scrolling=function(raph_element){$(raph_element.node).bind('mousewheel',function(event,delta){var dy=delta*20;if(translation_respects_viewport(0,dy,style.viewport_margin)){translate_all(0,dy);}});};var px,py;var bg_drag_down=function(){px=py=0;};var bg_drag_move=function(x,y){var dx=x-px;var dy=y-py;px=x;py=y;if(translation_respects_viewport(dx,dy,style.viewport_margin)){translate_all(dx,dy);}};var bg_drag_up=function(){};background.drag(bg_drag_move,bg_drag_down,bg_drag_up);this.set_scrolling(background);this.add_node=function(n){nodes.push(n);n.uid=uid++;};this.get_node_list=function(){return nodes;};this.add_edge=function(n1,n2,e){edges.push(e);e.uid=uid++;if(!graph[n1.uid])graph[n1.uid]={};if(!graph[n1.uid][n2.uid])graph[n1.uid][n2.uid]=[];if(!links[n1.uid])links[n1.uid]=[];if(!links[n2.uid])links[n2.uid]=[];graph[n1.uid][n2.uid].push(e);links[n1.uid].push(e);if(n1!=n2){links[n2.uid].push(e);}};this.remove_edge=function(edge){edges=_.without(edges,edge);var n1=edge.get_start();var n2=edge.get_end();links[n1.uid]=_.without(links[n1.uid],edge);links[n2.uid]=_.without(links[n2.uid],edge);graph[n1.uid][n2.uid]=_.without(graph[n1.uid][n2.uid],edge);if(selected_entity==edge){selected_entity=null;}};this.remove_node=function(node){var linked_edges=self.get_linked_edge_list(node);for(var i=0;i<linked_edges.length;i++){linked_edges[i].remove();}
nodes=_.without(nodes,node);if(selected_entity==node){selected_entity=null;}}
this.get_edge_list=function(n1,n2){var list=[];if(!graph[n1.uid])return list;if(!graph[n1.uid][n2.uid])return list;return graph[n1.uid][n2.uid];};this.get_linked_edge_list=function(n){if(!links[n.uid])return[];return links[n.uid];};this.get_edge_curvature=function(n1,n2,e){var el_12=this.get_edge_list(n1,n2);var c12=el_12.length;var el_21=this.get_edge_list(n2,n1);var c21=el_21.length;if(c12+c21==1){return 0;}else{var index=0;for(var i=0;i<c12;i++){if(el_12[i].uid<e.uid){index++;}}
if(c21==0){return index-(c12-1)/2.0;}else{return index+0.5;}}};this.get_loop_angle=function(n,e){var loop_list=this.get_edge_list(n,n);var slots=[];for(var angle=0;angle<360;angle+=45){slots.push(Vec2.new_polar_deg(1,angle));}
var links=this.get_linked_edge_list(n);for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||edge.is_loop()){continue;}
var end=edge.get_end();if(end==n){end=edge.get_start();}
var dir=end.get_pos().sub(n.get_pos()).normalize();for(var s=0;s<slots.length;s++){var score=slots[s].dot(dir);if(score<0){score=-0.2*Math.pow(score,2);}else{score=Math.pow(score,2);}
if(!slots[s].score){slots[s].score=score;}else{slots[s].score+=score;}}}
slots.sort(function(a,b){return a.score<b.score?-1:1;});var index=0;for(var i=0;i<links.length;i++){var edge=links[i];if(!edge.is_loop||!edge.is_loop()){continue;}
if(edge.uid<e.uid){index++;}}
index%=slots.length;return slots[index].angle_deg();}
this.select=function(entity){if(selected_entity){if(selected_entity==entity){return;}else{if(selected_entity.set_not_selected){selected_entity.set_not_selected();}
selected_entity=null;}}
selected_entity=entity;if(entity&&entity.set_selected){entity.set_selected();}};}
function GraphNode(graph,pos_x,pos_y,label,type,color){var self=this;var r=graph.r;var sy=graph.style.node_size_y;var sx=graph.style.node_size_x;var node_fig=null;var selected=false;this.connectors=[];this.close_button=null;this.uid=0;graph.add_node(this);if(type=='circle'){node_fig=r.ellipse(pos_x,pos_y,sx/2,sy/2);}else{node_fig=r.rect(pos_x-sx/2,pos_y-sy/2,sx,sy);}
node_fig.attr({'fill':color,'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width,'cursor':'pointer'});node_fig.transform(graph.get_transform());graph.set_scrolling(node_fig);var node_label=r.text(pos_x,pos_y,label);node_label.attr({'fill':graph.style.node_label_color,'font-size':graph.style.node_label_font_size,'cursor':'pointer'});node_label.transform(graph.get_transform());graph.set_scrolling(node_label);var update_linked_edges=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].update();}};var set_pos=function(pos){if(type=='circle'){node_fig.attr({'cx':pos.x,'cy':pos.y});}else{node_fig.attr({'x':pos.x-sx/2,'y':pos.y-sy/2});}
node_label.attr({'x':pos.x,'y':pos.y});for(var i=0;i<self.connectors.length;i++){self.connectors[i].update_pos();}
if(self.close_button){self.close_button.update_pos();}
update_linked_edges();};var get_fig=function(){return node_fig;};var get_pos=function(){if(type=='circle'){return new Vec2(node_fig.attr('cx'),node_fig.attr('cy'));}else{return new Vec2(node_fig.attr('x')+sx/2,node_fig.attr('y')+sy/2);}};var get_label=function(){return node_label.attr("text");};var set_label=function(text){node_label.attr({'text':text});};var get_bound=function(){if(type=='circle'){return new BEllipse(get_pos().x,get_pos().y,sx/2,sy/2);}else{return BRect.new_centered(get_pos().x,get_pos().y,sx,sy);}};var set_selected=function(){if(!selected){selected=true;node_fig.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});if(!self.close_button){self.close_button=new CloseButton(graph,self,"node",sx/2,-sy/2);self.close_button.show();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].show();}}};var set_not_selected=function(){if(selected){node_fig.animate({'stroke':graph.style.node_outline_color,'stroke-width':graph.style.node_outline_width},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}
selected=false;}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].hide();}};var remove=function(){if(self.close_button){self.close_button.remove();}
for(var i=0;i<self.connectors.length;i++){self.connectors[i].remove();}
graph.remove_node(self);node_fig.remove();node_label.remove();}
this.set_pos=set_pos;this.get_pos=get_pos;this.set_label=set_label;this.get_label=get_label;this.get_bound=get_bound;this.get_fig=get_fig;this.set_selected=set_selected;this.set_not_selected=set_not_selected;this.update_linked_edges=update_linked_edges;this.remove=remove;var click_action=function(){if(type=='circle'){node_fig.attr({'rx':sx/2+3,'ry':sy/2+3});node_fig.animate({'rx':sx/2,'ry':sy/2},500,'elastic');}else{var cx=get_pos().x;var cy=get_pos().y;node_fig.attr({'x':cx-(sx/2)-3,'y':cy-(sy/2)-3,'ẃidth':sx+6,'height':sy+6});node_fig.animate({'x':cx-sx/2,'y':cy-sy/2,'ẃidth':sx,'height':sy},500,'elastic');}
graph.select(self);};node_fig.click(click_action);node_label.click(click_action);var drag_down=function(){this.opos=get_pos();};var drag_move=function(dx,dy){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_disable();}
if(self.close_button){self.close_button.hide();}
set_pos(this.opos.add_xy(dx,dy));};var drag_up=function(){var edges=graph.get_linked_edge_list(self);for(var i=0;i<edges.length;i++){edges[i].label_enable();}
if(self.close_button){self.close_button.show();}};node_fig.drag(drag_move,drag_down,drag_up);node_label.drag(drag_move,drag_down,drag_up);function hover_in(){if(graph.creating_edge){graph.target_node=self;}}
function hover_out(){graph.target_node=null;}
node_fig.hover(hover_in,hover_out);node_label.hover(hover_in,hover_out);function double_click(){GraphNode.double_click_callback(self);}
node_fig.dblclick(double_click);node_label.dblclick(double_click);this.connectors.push(new Connector(graph,this,-sx/2,0));this.connectors.push(new Connector(graph,this,sx/2,0));this.connectors.push(new Connector(graph,this,0,-sy/2));this.connectors.push(new Connector(graph,this,0,sy/2));this.close_button=new CloseButton(graph,this,"node",sx/2,-sy/2);}
GraphNode.double_click_callback=function(node){console.log("double click from node:",node);};GraphNode.destruction_callback=function(node){return true;};function GraphEdge(graph,label,start,end,tmp){var self=this;var r=graph.r;var curvature=0;var s,e;var mc;var mc1,mc2;var elfs=graph.style.edge_label_font_size||10;var label_enabled=true;this.uid=0;var edge_path="";var selected=false;if(!tmp){graph.add_edge(start,end,this);}
function get_label_pos(path){var cpos=path.getTotalLength()*0.5;var cindex=Math.abs(Math.floor(curvature));var mod=((cindex%3))*(elfs*3.1)-(elfs*0.5);var verticality=Math.abs(end.get_pos().sub(start.get_pos()).normalize().dot_xy(0,1));verticality=Math.max(verticality-0.5,0)*2;var lpos=path.getPointAtLength(cpos+mod*verticality);return new Vec2(lpos.x,lpos.y-elfs*(1-verticality));}
this.get_pos=function(){if(!edge){return start.get_pos().lerp(end.get_pos(),0.5);}
return get_label_pos(edge);}
function make_line(){return"M"+s.x+","+s.y+"L"+e.x+","+e.y;}
function make_curve(){return"M"+s.x+","+s.y+"Q"+mc.x+","+mc.y+" "+e.x+","+e.y;}
function make_loop(){return"M"+s.x+" "+s.y+"C"+mc1.x+" "+mc1.y+" "+mc2.x+" "+mc2.y+" "+e.x+" "+e.y;}
function update_curve(){if(start!=end){if(!tmp){curvature=graph.get_edge_curvature(start,end,self);}else{curvature=0;}
s=start.get_pos();e=end.get_pos();mc=s.lerp(e,0.5);var se=e.sub(s);se=se.normalize();se=se.rotate_deg(-90);se=se.scale(curvature*graph.style.edge_spacing);mc=mc.add(se);if(start.get_bound){var col=start.get_bound().collide_segment(s,mc);if(col.length>0){s=col[0];}}
if(end.get_bound){var col=end.get_bound().collide_segment(mc,e);if(col.length>0){e=col[0];}}
if(curvature!=0){edge_path=make_curve();}else{edge_path=make_line();}}else{var rad=graph.style.edge_loop_radius||100;s=start.get_pos();e=end.get_pos();var r=Vec2.new_polar_deg(rad,graph.get_loop_angle(start,self));mc=s.add(r);var p=r.rotate_deg(90);mc1=mc.add(p.set_len(rad*0.5));mc2=mc.add(p.set_len(-rad*0.5));if(start.get_bound){var col=start.get_bound().collide_segment(s,mc1);if(col.length>0){s=col[0];}
var col=start.get_bound().collide_segment(e,mc2);if(col.length>0){e=col[0];}}
edge_path=make_loop();}}
update_curve();var edge=r.path(edge_path).attr({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width,'arrow-end':'block-wide-long','cursor':'pointer'}).insertBefore(graph.get_node_list()[0].get_fig());var labelpos=get_label_pos(edge);var edge_label=r.text(labelpos.x,labelpos.y-elfs,label).attr({'fill':graph.style.edge_label_color,'cursor':'pointer','font-size':elfs});edge.transform(graph.get_transform());graph.set_scrolling(edge);edge_label.transform(graph.get_transform());graph.set_scrolling(edge_label);if(!tmp){var edges_start=graph.get_linked_edge_list(start);var edges_end=graph.get_linked_edge_list(end);var edges=edges_start.length<edges_end.length?edges_start:edges_end;for(var i=0;i<edges.length;i++){if(edges[i]!=self){edges[i].update();}}}
function label_enable(){if(!label_enabled){label_enabled=true;edge_label.animate({'opacity':1},100,'linear');if(self.close_button){self.close_button.show();}
self.update();}}
function label_disable(){if(label_enabled){label_enabled=false;edge_label.animate({'opacity':0},100,'linear');if(self.close_button){self.close_button.hide();}}}
function update(){update_curve();edge.attr({'path':edge_path});if(label_enabled){var labelpos=get_label_pos(edge);edge_label.attr({'x':labelpos.x,'y':labelpos.y-14});}}
function remove(){edge.remove();edge_label.remove();if(!tmp){graph.remove_edge(self);}
if(start.update_linked_edges){start.update_linked_edges();}
if(start!=end&&end.update_linked_edges){end.update_linked_edges();}
if(self.close_button){self.close_button.remove();}}
this.set_selected=function(){if(!selected){selected=true;edge.attr({'stroke':graph.style.node_selected_color,'stroke-width':graph.style.node_selected_width});edge_label.attr({'fill':graph.style.node_selected_color});if(!self.close_button){self.close_button=new CloseButton(graph,self,"edge",0,30);self.close_button.show();}}};this.set_not_selected=function(){if(selected){selected=false;edge.animate({'stroke':graph.style.edge_color,'stroke-width':graph.style.edge_width},100,'linear');edge_label.animate({'fill':graph.style.edge_label_color},100,'linear');if(self.close_button){self.close_button.remove();self.close_button=null;}}};function click_action(){graph.select(self);}
edge.click(click_action);edge_label.click(click_action);function double_click_action(){GraphEdge.double_click_callback(self);}
edge.dblclick(double_click_action);edge_label.dblclick(double_click_action);this.label_enable=label_enable;this.label_disable=label_disable;this.update=update;this.remove=remove;this.is_loop=function(){return start==end;};this.get_start=function(){return start;};this.get_end=function(){return end;};}
GraphEdge.double_click_callback=function(edge){console.log("double click from edge:",edge);};GraphEdge.creation_callback=function(start,end){var edge_prop={};edge_prop.label='new edge!';return edge_prop;};GraphEdge.new_edge_callback=function(new_edge){};GraphEdge.destruction_callback=function(edge){return true;};function wordwrap(str,width){width=width||32;var cut=true;var brk='\n';if(!str){return str;}
var regex='.{1,'+width+'}(\\s|$)'+(cut?'|.{'+width+'}|.+$':'|\\S+?(\\s|$)');return str.match(new RegExp(regex,'g')).join(brk);}
window.CuteGraph=Graph;window.CuteNode=GraphNode;window.CuteEdge=GraphEdge;window.CuteGraph.wordwrap=wordwrap;})(window);;openerp.web_diagram=function(instance){var QWeb=instance.web.qweb,_t=instance.web._t,_lt=instance.web._lt;instance.web.views.add('diagram','instance.web.DiagramView');instance.web.DiagramView=instance.web.View.extend({display_name:_lt('Diagram'),view_type:'diagram',searchable:false,init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(options);this.view_manager=parent;this.dataset=dataset;this.model=this.dataset.model;this.view_id=view_id;this.domain=this.dataset._domain||[];this.context={};this.ids=this.dataset.ids;this.on('pager_action_executed',self,self.pager_action_trigger);},view_loading:function(r){return this.load_diagram(r);},toTitleCase:function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});},load_diagram:function(result){var self=this;if(this.ids&&this.ids.length){this.id=this.ids[self.dataset.index||0];}
this.fields_view=result,this.view_id=this.fields_view.view_id,this.fields=this.fields_view.fields,this.nodes=this.fields_view.arch.children[0],this.connectors=this.fields_view.arch.children[1],this.node=this.nodes.attrs.object,this.connector=this.connectors.attrs.object;this.labels=_.filter(this.fields_view.arch.children,function(label){return label.tag=="label";});this.$el.html(QWeb.render("DiagramView",{'widget':self}));this.$el.addClass(this.fields_view.arch.attrs['class']);_.each(self.labels,function(label){html_label='<p style="padding: 4px;">'+label.attrs.string+"</p>";self.$el.find('.oe_diagram_header').append(html_label);})
this.init_pager();this.$el.find('#new_node.oe_diagram_button_new').click(function(){self.add_node();});if(this.id){self.get_diagram_info();}
this.trigger('diagram_view_loaded',result);},get_diagram_info:function(){var self=this;var params={'id':this.id,'model':this.model,'node':this.node,'connector':this.connector,'bgcolor':this.nodes.attrs.bgcolor,'shape':this.nodes.attrs.shape,'src_node':this.connectors.attrs.source,'des_node':this.connectors.attrs.destination,'label':this.connectors.attrs.label||false,'visible_nodes':[],'invisible_nodes':[],'node_fields':[],'connectors':[],'connectors_fields':[]};_.each(this.nodes.children,function(child){if(child.attrs.invisible=='1')
params['invisible_nodes'].push(child.attrs.name);else{params['visible_nodes'].push(child.attrs.name);params['node_fields'].push(self.fields[child.attrs.name]['string']||this.toTitleCase(child.attrs.name));}});_.each(this.connectors.children,function(conn){params['connectors_fields'].push(self.fields[conn.attrs.name]['string']||this.toTitleCase(conn.attrs.name));params['connectors'].push(conn.attrs.name);});this.rpc('/web_diagram/diagram/get_diagram_info',params).done(function(result){self.draw_diagram(result);});},on_diagram_loaded:function(record){var id_record=record['id'];if(id_record){this.id=id_record;this.get_diagram_info();this.do_push_state({id:id_record});}else{this.do_push_state({});}},do_load_state:function(state,warm){if(state&&state.id){if(!this.dataset.get_id_index(state.id)){this.dataset.ids.push(state.id);}
this.dataset.select_id(state.id);if(warm){this.do_show();}}},draw_diagram:function(result){var self=this;var res_nodes=result['nodes'];var res_edges=result['conn'];this.parent_field=result.parent_field;this.$el.find('h3.oe_diagram_title').text(result.name);var id_to_node={};var style={edge_color:"#A0A0A0",edge_label_color:"#555",edge_label_font_size:10,edge_width:2,edge_spacing:100,edge_loop_radius:100,node_label_color:"#333",node_label_font_size:12,node_outline_color:"#333",node_outline_width:1,node_selected_color:"#0097BE",node_selected_width:2,node_size_x:110,node_size_y:80,connector_active_color:"#FFF",connector_radius:4,close_button_radius:8,close_button_color:"#333",close_button_x_color:"#FFF",gray:"#DCDCDC",white:"#FFF",viewport_margin:50};var canvas=self.$el.find('div.oe_diagram_diagram').empty().get(0);var r=new Raphael(canvas,'100%','100%');var graph=new CuteGraph(r,style,canvas.parentNode);var confirm_dialog=$('#dialog').dialog({autoOpen:false,title:_t("Are you sure?")});_.each(res_nodes,function(node){var n=new CuteNode(graph,node.x+50,node.y+50,CuteGraph.wordwrap(node.name,14),node.shape==='rectangle'?'rect':'circle',node.color==='white'?style.white:style.gray);n.id=node.id;id_to_node[node.id]=n;});_.each(res_edges,function(edge){var e=new CuteEdge(graph,CuteGraph.wordwrap(edge.signal,32),id_to_node[edge.s_id],id_to_node[edge.d_id]||id_to_node[edge.s_id]);e.id=edge.id;});CuteNode.double_click_callback=function(cutenode){self.edit_node(cutenode.id);};var i=0;CuteNode.destruction_callback=function(cutenode){if(!confirm(_t("Deleting this node cannot be undone.\nIt will also delete all connected transitions.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new instance.web.DataSet(self,self.node).unlink([cutenode.id]);};CuteEdge.double_click_callback=function(cuteedge){self.edit_connector(cuteedge.id);};CuteEdge.creation_callback=function(node_start,node_end){return{label:_t("")};};CuteEdge.new_edge_callback=function(cuteedge){self.add_connector(cuteedge.get_start().id,cuteedge.get_end().id,cuteedge);};CuteEdge.destruction_callback=function(cuteedge){if(!confirm(_t("Deleting this transition cannot be undone.\n\nAre you sure ?"))){return $.Deferred().reject().promise();}
return new instance.web.DataSet(self,self.connector).unlink([cuteedge.id]);};},edit_node:function(node_id){var self=this;var title=_t('Activity');var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.node,node_id,self.context||self.dataset.context,{title:_t("Open: ")+title});pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});var form_fields=[self.parent_field];var form_controller=pop.view_form;form_controller.on("load_record",self,function(){_.each(form_fields,function(fld){if(!(fld in form_controller.fields)){return;}
var field=form_controller.fields[fld];field.$input.prop('disabled',true);field.$drop_down.unbind();});});},add_node:function(){var self=this;var title=_t('Activity');var pop=new instance.web.form.SelectCreatePopup(self);pop.select_element(self.node,{title:_t("Create:")+title,initial_view:'form',disable_multiple_selection:true},self.dataset.domain,self.context||self.dataset.context);pop.on("elements_selected",self,function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});var form_controller=pop.view_form;var form_fields=[this.parent_field];form_controller.on("load_record",self,function(){_.each(form_fields,function(fld){if(!(fld in form_controller.fields)){return;}
var field=form_controller.fields[fld];field.set_value(self.id);field.dirty=true;});});},edit_connector:function(connector_id){var self=this;var title=_t('Transition');var pop=new instance.web.form.FormOpenPopup(self);pop.show_element(self.connector,parseInt(connector_id,10),self.context||self.dataset.context,{title:_t("Open: ")+title});pop.on('write_completed',self,function(){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});},add_connector:function(node_source_id,node_dest_id,dummy_cuteedge){var self=this;var title=_t('Transition');var pop=new instance.web.form.SelectCreatePopup(self);pop.select_element(self.connector,{title:_t("Create:")+title,initial_view:'form',disable_multiple_selection:true},this.dataset.domain,this.context||this.dataset.context);pop.on("elements_selected",self,function(element_ids){self.dataset.read_index(_.keys(self.fields_view.fields)).then(self.on_diagram_loaded);});pop.$el.bind("dialogbeforeclose",function(){if(dummy_cuteedge){dummy_cuteedge.remove();}});var form_controller=pop.view_form;form_controller.on("load_record",self,function(){form_controller.fields[self.connectors.attrs.source].set_value(node_source_id);form_controller.fields[self.connectors.attrs.source].dirty=true;form_controller.fields[self.connectors.attrs.destination].set_value(node_dest_id);form_controller.fields[self.connectors.attrs.destination].dirty=true;});},do_hide:function(){if(this.$pager){this.$pager.hide();}
this._super();},init_pager:function(){var self=this;if(this.$pager)
this.$pager.remove();this.$pager=$(QWeb.render("DiagramView.pager",{'widget':self})).hide();if(this.options.$pager){this.$pager.appendTo(this.options.$pager);}else{this.$el.find('.oe_diagram_pager').replaceWith(this.$pager);}
this.$pager.on('click','a[data-pager-action]',function(){var action=$(this).data('pager-action');self.execute_pager_action(action);});this.do_update_pager();},pager_action_trigger:function(){var loaded=this.dataset.read_index(_.keys(this.fields_view.fields)).then(this.on_diagram_loaded);this.do_update_pager();return loaded;},execute_pager_action:function(action){switch(action){case'first':this.dataset.index=0;break;case'previous':this.dataset.previous();break;case'next':this.dataset.next();break;case'last':this.dataset.index=this.dataset.ids.length-1;break;}
this.trigger('pager_action_executed');},do_update_pager:function(hide_index){this.$pager.toggle(this.dataset.ids.length>1);if(hide_index){$(".oe_diagram_pager_state",this.$pager).html("");}else{$(".oe_diagram_pager_state",this.$pager).html(_.str.sprintf(_t("%d / %d"),this.dataset.index+1,this.dataset.ids.length));}},do_show:function(){this.do_push_state({});return $.when(this._super(),this.execute_pager_action('reload'));}});};;if(!window.dhtmlx){dhtmlx=function(obj){for(var a in obj)dhtmlx[a]=obj[a];return dhtmlx;};}
dhtmlx.extend_api=function(name,map,ext){var t=window[name];if(!t)return;window[name]=function(obj){if(obj&&typeof obj=="object"&&!obj.tagName){var that=t.apply(this,(map._init?map._init(obj):arguments));for(var a in dhtmlx)
if(map[a])this[map[a]](dhtmlx[a]);for(var a in obj){if(map[a])this[map[a]](obj[a]);else if(a.indexOf("on")==0){this.attachEvent(a,obj[a]);}}}else
var that=t.apply(this,arguments);if(map._patch)map._patch(this);return that||this;};window[name].prototype=t.prototype;if(ext)
dhtmlXHeir(window[name].prototype,ext);};dhtmlxAjax={get:function(url,callback){var t=new dtmlXMLLoaderObject(true);t.async=(arguments.length<3);t.waitCall=callback;t.loadXML(url)
return t;},post:function(url,post,callback){var t=new dtmlXMLLoaderObject(true);t.async=(arguments.length<4);t.waitCall=callback;t.loadXML(url,true,post)
return t;},getSync:function(url){return this.get(url,null,true)},postSync:function(url,post){return this.post(url,post,null,true);}}
function dtmlXMLLoaderObject(funcObject,dhtmlObject,async,rSeed){this.xmlDoc="";if(typeof(async)!="undefined")
this.async=async;else
this.async=true;this.onloadAction=funcObject||null;this.mainObject=dhtmlObject||null;this.waitCall=null;this.rSeed=rSeed||false;return this;};dtmlXMLLoaderObject.count=0;dtmlXMLLoaderObject.prototype.waitLoadFunction=function(dhtmlObject){var once=true;this.check=function(){if((dhtmlObject)&&(dhtmlObject.onloadAction!=null)){if((!dhtmlObject.xmlDoc.readyState)||(dhtmlObject.xmlDoc.readyState==4)){if(!once)
return;once=false;dtmlXMLLoaderObject.count++;if(typeof dhtmlObject.onloadAction=="function")
dhtmlObject.onloadAction(dhtmlObject.mainObject,null,null,null,dhtmlObject);if(dhtmlObject.waitCall){dhtmlObject.waitCall.call(this,dhtmlObject);dhtmlObject.waitCall=null;}}}};return this.check;};dtmlXMLLoaderObject.prototype.getXMLTopNode=function(tagName,oldObj){if(this.xmlDoc.responseXML){var temp=this.xmlDoc.responseXML.getElementsByTagName(tagName);if(temp.length==0&&tagName.indexOf(":")!=-1)
var temp=this.xmlDoc.responseXML.getElementsByTagName((tagName.split(":"))[1]);var z=temp[0];}else
var z=this.xmlDoc.documentElement;if(z){this._retry=false;return z;}
if(!this._retry){this._retry=true;var oldObj=this.xmlDoc;this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),true);return this.getXMLTopNode(tagName,oldObj);}
dhtmlxError.throwError("LoadXML","Incorrect XML",[(oldObj||this.xmlDoc),this.mainObject]);return document.createElement("DIV");};dtmlXMLLoaderObject.prototype.loadXMLString=function(xmlString,silent){if(!_isIE){var parser=new DOMParser();this.xmlDoc=parser.parseFromString(xmlString,"text/xml");}else{this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.async=this.async;this.xmlDoc.onreadystatechange=function(){};this.xmlDoc["loadXM"+"L"](xmlString);}
if(silent)
return;if(this.onloadAction)
this.onloadAction(this.mainObject,null,null,null,this);if(this.waitCall){this.waitCall();this.waitCall=null;}}
dtmlXMLLoaderObject.prototype.loadXML=function(filePath,postMode,postVars,rpc){if(this.rSeed)
filePath+=((filePath.indexOf("?")!=-1)?"&":"?")+"a_dhx_rSeed="+(new Date()).valueOf();this.filePath=filePath;if((!_isIE)&&(window.XMLHttpRequest))
this.xmlDoc=new XMLHttpRequest();else{this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP");}
if(this.async)
this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this);this.xmlDoc.open(postMode?"POST":"GET",filePath,this.async);if(rpc){this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")");this.xmlDoc.setRequestHeader("Content-type","text/xml");}
else if(postMode)
this.xmlDoc.setRequestHeader('Content-type','application/x-www-form-urlencoded');this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlDoc.send(null||postVars);if(!this.async)
(new this.waitLoadFunction(this))();};dtmlXMLLoaderObject.prototype.destructor=function(){this._filterXPath=null;this._getAllNamedChilds=null;this._retry=null;this.async=null;this.rSeed=null;this.filePath=null;this.onloadAction=null;this.mainObject=null;this.xmlDoc=null;this.doXPath=null;this.doXPathOpera=null;this.doXSLTransToObject=null;this.doXSLTransToString=null;this.loadXML=null;this.loadXMLString=null;this.doSerialization=null;this.xmlNodeToJSON=null;this.getXMLTopNode=null;this.setXSLParamValue=null;return null;}
dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(node){var t={};for(var i=0;i<node.attributes.length;i++)
t[node.attributes[i].name]=node.attributes[i].value;t["_tagvalue"]=node.firstChild?node.firstChild.nodeValue:"";for(var i=0;i<node.childNodes.length;i++){var name=node.childNodes[i].tagName;if(name){if(!t[name])t[name]=[];t[name].push(this.xmlNodeToJSON(node.childNodes[i]));}}
return t;}
function callerFunction(funcObject,dhtmlObject){this.handler=function(e){if(!e)
e=window.event;funcObject(e,dhtmlObject);return true;};return this.handler;};function getAbsoluteLeft(htmlObject){return getOffset(htmlObject).left;}
function getAbsoluteTop(htmlObject){return getOffset(htmlObject).top;}
function getOffsetSum(elem){var top=0,left=0;while(elem){top=top+parseInt(elem.offsetTop);left=left+parseInt(elem.offsetLeft);elem=elem.offsetParent;}
return{top:top,left:left};}
function getOffsetRect(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)};}
function getOffset(elem){if(elem.getBoundingClientRect){return getOffsetRect(elem);}else{return getOffsetSum(elem);}}
function convertStringToBoolean(inputString){if(typeof(inputString)=="string")
inputString=inputString.toLowerCase();switch(inputString){case"1":case"true":case"yes":case"y":case 1:case true:return true;break;default:return false;}}
function getUrlSymbol(str){if(str.indexOf("?")!=-1)
return"&"
else
return"?"}
function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)
return window.dhtmlDragAndDrop;this.lastLanding=0;this.dragNode=0;this.dragStartNode=0;this.dragStartObject=0;this.tempDOMU=null;this.tempDOMM=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this;};dhtmlDragAndDropObject.prototype.removeDraggableItem=function(htmlNode){htmlNode.onmousedown=null;htmlNode.dragStarter=null;htmlNode.dragLanding=null;}
dhtmlDragAndDropObject.prototype.addDraggableItem=function(htmlNode,dhtmlObject){htmlNode.onmousedown=this.preCreateDragCopy;htmlNode.dragStarter=dhtmlObject;this.addDragLanding(htmlNode,dhtmlObject);}
dhtmlDragAndDropObject.prototype.addDragLanding=function(htmlNode,dhtmlObject){htmlNode.dragLanding=dhtmlObject;}
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){if((e||window.event)&&(e||event).button==2)
return;if(window.dhtmlDragAndDrop.waitDrag){window.dhtmlDragAndDrop.waitDrag=0;document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU;document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM;return false;}
if(window.dhtmlDragAndDrop.dragNode)
window.dhtmlDragAndDrop.stopDrag(e);window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove;window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=new Date().valueOf();if((e)&&(e.preventDefault)){e.preventDefault();return false;}
return false;};dhtmlDragAndDropObject.prototype.callDrag=function(e){if(!e)
e=window.event;dragger=window.dhtmlDragAndDrop;if((new Date()).valueOf()-dragger.downtime<100)return;if(!dragger.dragNode){if(dragger.waitDrag){dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e);if(!dragger.dragNode)
return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return false;}
dragger.gldragNode=dragger.dragNode;document.body.appendChild(dragger.dragNode);document.body.onmouseup=dragger.stopDrag;dragger.waitDrag=0;dragger.dragNode.pWindow=window;dragger.initFrameRoute();}
else return dragger.stopDrag(e,true);}
if(dragger.dragNode.parentNode!=window.document.body&&dragger.gldragNode){var grd=dragger.gldragNode;if(dragger.gldragNode.old)
grd=dragger.gldragNode.old;grd.parentNode.removeChild(grd);var oldBody=dragger.dragNode.pWindow;if(grd.pWindow&&grd.pWindow.dhtmlDragAndDrop.lastLanding)
grd.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(grd.pWindow.dhtmlDragAndDrop.lastLanding);if(_isIE){var div=document.createElement("Div");div.innerHTML=dragger.dragNode.outerHTML;dragger.dragNode=div.childNodes[0];}else
dragger.dragNode=dragger.dragNode.cloneNode(true);dragger.dragNode.pWindow=window;dragger.gldragNode.old=dragger.dragNode;document.body.appendChild(dragger.dragNode);oldBody.dhtmlDragAndDrop.dragNode=dragger.dragNode;}
dragger.dragNode.style.left=e.clientX+15+(dragger.fx?dragger.fx*(-1):0)
+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";dragger.dragNode.style.top=e.clientY+3+(dragger.fy?dragger.fy*(-1):0)
+(document.body.scrollTop||document.documentElement.scrollTop)+"px";if(!e.srcElement)
var z=e.target;else
z=e.srcElement;dragger.checkLanding(z,e);}
dhtmlDragAndDropObject.prototype.calculateFramePosition=function(n){if(window.name){var el=parent.frames[window.name].frameElement.offsetParent;var fx=0;var fy=0;while(el){fx+=el.offsetLeft;fy+=el.offsetTop;el=el.offsetParent;}
if((parent.dhtmlDragAndDrop)){var ls=parent.dhtmlDragAndDrop.calculateFramePosition(1);fx+=ls.split('_')[0]*1;fy+=ls.split('_')[1]*1;}
if(n)
return fx+"_"+fy;else
this.fx=fx;this.fy=fy;}
return"0_0";}
dhtmlDragAndDropObject.prototype.checkLanding=function(htmlObject,e){if((htmlObject)&&(htmlObject.dragLanding)){if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding);this.lastLanding=htmlObject;this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,e.clientX,e.clientY,e);this.lastLanding_scr=(_isIE?e.srcElement:e.target);}else{if((htmlObject)&&(htmlObject.tagName!="BODY"))
this.checkLanding(htmlObject.parentNode,e);else{if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding,e.clientX,e.clientY,e);this.lastLanding=0;if(this._onNotFound)
this._onNotFound();}}}
dhtmlDragAndDropObject.prototype.stopDrag=function(e,mode){dragger=window.dhtmlDragAndDrop;if(!mode){dragger.stopFrameRoute();var temp=dragger.lastLanding;dragger.lastLanding=null;if(temp)
temp.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,temp,(_isIE?event.srcElement:e.target));}
dragger.lastLanding=null;if((dragger.dragNode)&&(dragger.dragNode.parentNode==document.body))
dragger.dragNode.parentNode.removeChild(dragger.dragNode);dragger.dragNode=0;dragger.gldragNode=0;dragger.fx=0;dragger.fy=0;dragger.dragStartNode=0;dragger.dragStartObject=0;document.body.onmouseup=dragger.tempDOMU;document.body.onmousemove=dragger.tempDOMM;dragger.tempDOMU=null;dragger.tempDOMM=null;dragger.waitDrag=0;}
dhtmlDragAndDropObject.prototype.stopFrameRoute=function(win){if(win)
window.dhtmlDragAndDrop.stopDrag(1,1);for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
dhtmlDragAndDropObject.prototype.initFrameRoute=function(win,mode){if(win){window.dhtmlDragAndDrop.preCreateDragCopy();window.dhtmlDragAndDrop.dragStartNode=win.dhtmlDragAndDrop.dragStartNode;window.dhtmlDragAndDrop.dragStartObject=win.dhtmlDragAndDrop.dragStartObject;window.dhtmlDragAndDrop.dragNode=win.dhtmlDragAndDrop.dragNode;window.dhtmlDragAndDrop.gldragNode=win.dhtmlDragAndDrop.dragNode;window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag;window.waitDrag=0;if(((!_isIE)&&(mode))&&((!_isFF)||(_FFrv<1.8)))
window.dhtmlDragAndDrop.calculateFramePosition();}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.initFrameRoute(window);}catch(e){}
for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.initFrameRoute(window,((!win||mode)?1:0));}catch(e){}}}
_isFF=false;_isIE=false;_isOpera=false;_isKHTML=false;_isMacOS=false;_isChrome=false;_FFrv=false;_KHTMLrv=false;_OperaRv=false;if(navigator.userAgent.indexOf('Macintosh')!=-1)
_isMacOS=true;if(navigator.userAgent.toLowerCase().indexOf('chrome')>-1)
_isChrome=true;if((navigator.userAgent.indexOf('Safari')!=-1)||(navigator.userAgent.indexOf('Konqueror')!=-1)){_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Safari')+7,5));if(_KHTMLrv>525){_isFF=true;_FFrv=1.9;}else
_isKHTML=true;}else if(navigator.userAgent.indexOf('Opera')!=-1){_isOpera=true;_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Opera')+6,3));}
else if(navigator.appName.indexOf("Microsoft")!=-1){_isIE=true;if((navigator.appVersion.indexOf("MSIE 8.0")!=-1||navigator.appVersion.indexOf("MSIE 9.0")!=-1||navigator.appVersion.indexOf("MSIE 10.0")!=-1)&&document.compatMode!="BackCompat"){_isIE=8;}}else{_isFF=true;_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])}
dtmlXMLLoaderObject.prototype.doXPath=function(xpathExp,docObj,namespace,result_type){if(_isKHTML||(!_isIE&&!window.XPathResult))
return this.doXPathOpera(xpathExp,docObj);if(_isIE){if(!docObj)
if(!this.xmlDoc.nodeName)
docObj=this.xmlDoc.responseXML
else
docObj=this.xmlDoc;if(!docObj)
dhtmlxError.throwError("LoadXML","Incorrect XML",[(docObj||this.xmlDoc),this.mainObject]);if(namespace!=null)
docObj.setProperty("SelectionNamespaces","xmlns:xsl='"+namespace+"'");if(result_type=='single'){return docObj.selectSingleNode(xpathExp);}
else{return docObj.selectNodes(xpathExp)||new Array(0);}}else{var nodeObj=docObj;if(!docObj){if(!this.xmlDoc.nodeName){docObj=this.xmlDoc.responseXML}
else{docObj=this.xmlDoc;}}
if(!docObj)
dhtmlxError.throwError("LoadXML","Incorrect XML",[(docObj||this.xmlDoc),this.mainObject]);if(docObj.nodeName.indexOf("document")!=-1){nodeObj=docObj;}
else{nodeObj=docObj;docObj=docObj.ownerDocument;}
var retType=XPathResult.ANY_TYPE;if(result_type=='single')
retType=XPathResult.FIRST_ORDERED_NODE_TYPE
var rowsCol=new Array();var col=docObj.evaluate(xpathExp,nodeObj,function(pref){return namespace},retType,null);if(retType==XPathResult.FIRST_ORDERED_NODE_TYPE){return col.singleNodeValue;}
var thisColMemb=col.iterateNext();while(thisColMemb){rowsCol[rowsCol.length]=thisColMemb;thisColMemb=col.iterateNext();}
return rowsCol;}}
function _dhtmlxError(type,name,params){if(!this.catches)
this.catches=new Array();return this;}
_dhtmlxError.prototype.catchError=function(type,func_name){this.catches[type]=func_name;}
_dhtmlxError.prototype.throwError=function(type,name,params){if(this.catches[type])
return this.catches[type](type,name,params);if(this.catches["ALL"])
return this.catches["ALL"](type,name,params);alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]);return null;}
window.dhtmlxError=new _dhtmlxError();dtmlXMLLoaderObject.prototype.doXPathOpera=function(xpathExp,docObj){var z=xpathExp.replace(/[\/]+/gi,"/").split('/');var obj=null;var i=1;if(!z.length)
return[];if(z[0]==".")
obj=[docObj];else if(z[0]==""){obj=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(z[i].replace(/\[[^\]]*\]/g,""));i++;}else
return[];for(i;i<z.length;i++)obj=this._getAllNamedChilds(obj,z[i]);if(z[i-1].indexOf("[")!=-1)
obj=this._filterXPath(obj,z[i-1]);return obj;}
dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){var c=new Array();var b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,"");for(var i=0;i<a.length;i++)
if(a[i].getAttribute(b))
c[c.length]=a[i];return c;}
dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=new Array();if(_isKHTML)
b=b.toUpperCase();for(var i=0;i<a.length;i++)for(var j=0;j<a[i].childNodes.length;j++){if(_isKHTML){if(a[i].childNodes[j].tagName&&a[i].childNodes[j].tagName.toUpperCase()==b)
c[c.length]=a[i].childNodes[j];}
else if(a[i].childNodes[j].tagName==b)
c[c.length]=a[i].childNodes[j];}
return c;}
function dhtmlXHeir(a,b){for(var c in b)
if(typeof(b[c])=="function")
a[c]=b[c];return a;}
function dhtmlxEvent(el,event,handler){if(el.addEventListener)
el.addEventListener(event,handler,false);else if(el.attachEvent)
el.attachEvent("on"+event,handler);}
dtmlXMLLoaderObject.prototype.xslDoc=null;dtmlXMLLoaderObject.prototype.setXSLParamValue=function(paramName,paramValue,xslDoc){if(!xslDoc)
xslDoc=this.xslDoc
if(xslDoc.responseXML)
xslDoc=xslDoc.responseXML;var item=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+paramName+"']",xslDoc,"http:/\/www.w3.org/1999/XSL/Transform","single");if(item!=null)
item.firstChild.nodeValue=paramValue}
dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(xslDoc,xmlDoc){if(!xslDoc)
xslDoc=this.xslDoc;if(xslDoc.responseXML)
xslDoc=xslDoc.responseXML
if(!xmlDoc)
xmlDoc=this.xmlDoc;if(xmlDoc.responseXML)
xmlDoc=xmlDoc.responseXML
if(!_isIE){if(!this.XSLProcessor){this.XSLProcessor=new XSLTProcessor();this.XSLProcessor.importStylesheet(xslDoc);}
var result=this.XSLProcessor.transformToDocument(xmlDoc);}else{var result=new ActiveXObject("Msxml2.DOMDocument.3.0");try{xmlDoc.transformNodeToObject(xslDoc,result);}catch(e){result=xmlDoc.transformNode(xslDoc);}}
return result;}
dtmlXMLLoaderObject.prototype.doXSLTransToString=function(xslDoc,xmlDoc){var res=this.doXSLTransToObject(xslDoc,xmlDoc);if(typeof(res)=="string")
return res;return this.doSerialization(res);}
dtmlXMLLoaderObject.prototype.doSerialization=function(xmlDoc){if(!xmlDoc)
xmlDoc=this.xmlDoc;if(xmlDoc.responseXML)
xmlDoc=xmlDoc.responseXML
if(!_isIE){var xmlSerializer=new XMLSerializer();return xmlSerializer.serializeToString(xmlDoc);}else
return xmlDoc.xml;}
dhtmlxEventable=function(obj){obj.attachEvent=function(name,catcher,callObj){name='ev_'+name.toLowerCase();if(!this[name])
this[name]=new this.eventCatcher(callObj||this);return(name+':'+this[name].addEvent(catcher));}
obj.callEvent=function(name,arg0){name='ev_'+name.toLowerCase();if(this[name])
return this[name].apply(this,arg0);return true;}
obj.checkEvent=function(name){return(!!this['ev_'+name.toLowerCase()])}
obj.eventCatcher=function(obj){var dhx_catch=[];var z=function(){var res=true;for(var i=0;i<dhx_catch.length;i++){if(dhx_catch[i]!=null){var zr=dhx_catch[i].apply(obj,arguments);res=res&&zr;}}
return res;}
z.addEvent=function(ev){if(typeof(ev)!="function")
ev=eval(ev);if(ev)
return dhx_catch.push(ev)-1;return false;}
z.removeEvent=function(id){dhx_catch[id]=null;}
return z;}
obj.detachEvent=function(id){if(id!=false){var list=id.split(':');this[list[0]].removeEvent(list[1]);}}
obj.detachAllEvents=function(){for(var name in this){if(name.indexOf("ev_")==0)
delete this[name];}}
obj=null;};if(!window.dhtmlx)
window.dhtmlx={};(function(){var _dhx_msg_cfg=null;function callback(config,result){var usercall=config.callback;modality(false);config.box.parentNode.removeChild(config.box);_dhx_msg_cfg=config.box=null;if(usercall)
usercall(result);}
function modal_key(e){if(_dhx_msg_cfg){e=e||event;var code=e.which||event.keyCode;if(dhtmlx.message.keyboard){if(code==13||code==32)
callback(_dhx_msg_cfg,true);if(code==27)
callback(_dhx_msg_cfg,false);}
if(e.preventDefault)
e.preventDefault();return!(e.cancelBubble=true);}}
if(document.attachEvent)
document.attachEvent("onkeydown",modal_key);else
document.addEventListener("keydown",modal_key,true);function modality(mode){if(!modality.cover){modality.cover=document.createElement("DIV");modality.cover.onkeydown=modal_key;modality.cover.className="dhx_modal_cover";document.body.appendChild(modality.cover);}
var height=document.body.scrollHeight;modality.cover.style.display=mode?"inline-block":"none";}
function button(text,result){var button_css="dhtmlx_"+text.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+button_css+"' result='"+result+"' ><div>"+text+"</div></div>";}
function info(text){if(!t.area){t.area=document.createElement("DIV");t.area.className="dhtmlx_message_area";t.area.style[t.position]="5px";document.body.appendChild(t.area);}
t.hide(text.id);var message=document.createElement("DIV");message.innerHTML="<div>"+text.text+"</div>";message.className="dhtmlx-info dhtmlx-"+text.type;message.onclick=function(){t.hide(text.id);text=null;};if(t.position=="bottom"&&t.area.firstChild)
t.area.insertBefore(message,t.area.firstChild);else
t.area.appendChild(message);if(text.expire>0)
t.timers[text.id]=window.setTimeout(function(){t.hide(text.id);},text.expire);t.pull[text.id]=message;message=null;return text.id;}
function _boxStructure(config,ok,cancel){var box=document.createElement("DIV");box.className=" dhtmlx_modal_box dhtmlx-"+config.type;box.setAttribute("dhxbox",1);var inner='';if(config.width)
box.style.width=config.width;if(config.height)
box.style.height=config.height;if(config.title)
inner+='<div class="dhtmlx_popup_title">'+config.title+'</div>';inner+='<div class="dhtmlx_popup_text"><span>'+(config.content?'':config.text)+'</span></div><div  class="dhtmlx_popup_controls">';if(ok)
inner+=button(config.ok||"OK",true);if(cancel)
inner+=button(config.cancel||"Cancel",false);if(config.buttons){for(var i=0;i<config.buttons.length;i++)
inner+=button(config.buttons[i],i);}
inner+='</div>';box.innerHTML=inner;if(config.content){var node=config.content;if(typeof node=="string")
node=document.getElementById(node);if(node.style.display=='none')
node.style.display="";box.childNodes[config.title?1:0].appendChild(node);}
box.onclick=function(e){e=e||event;var source=e.target||e.srcElement;if(!source.className)source=source.parentNode;if(source.className.split(" ")[0]=="dhtmlx_popup_button"){result=source.getAttribute("result");result=(result=="true")||(result=="false"?false:result);callback(config,result);}};config.box=box;if(ok||cancel)
_dhx_msg_cfg=config;return box;}
function _createBox(config,ok,cancel){var box=config.tagName?config:_boxStructure(config,ok,cancel);if(!config.hidden)
modality(true);document.body.appendChild(box);var x=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-box.offsetWidth)/2));var y=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-box.offsetHeight)/2));if(config.position=="top")
box.style.top="-3px";else
box.style.top=y+'px';box.style.left=x+'px';box.onkeydown=modal_key;box.focus();if(config.hidden)
dhtmlx.modalbox.hide(box);return box;}
function alertPopup(config){return _createBox(config,true,false);}
function confirmPopup(config){return _createBox(config,true,true);}
function boxPopup(config){return _createBox(config);}
function box_params(text,type,callback){if(typeof text!="object"){if(typeof type=="function"){callback=type;type="";}
text={text:text,type:type,callback:callback};}
return text;}
function params(text,type,expire,id){if(typeof text!="object")
text={text:text,type:type,expire:expire,id:id};text.id=text.id||t.uid();text.expire=text.expire||t.expire;return text;}
dhtmlx.alert=function(){text=box_params.apply(this,arguments);text.type=text.type||"confirm";return alertPopup(text);};dhtmlx.confirm=function(){text=box_params.apply(this,arguments);text.type=text.type||"alert";return confirmPopup(text);};dhtmlx.modalbox=function(){text=box_params.apply(this,arguments);text.type=text.type||"alert";return boxPopup(text);};dhtmlx.modalbox.hide=function(node){while(node&&node.getAttribute&&!node.getAttribute("dhxbox"))
node=node.parentNode;if(node){node.parentNode.removeChild(node);modality(false);}};var t=dhtmlx.message=function(text,type,expire,id){text=params.apply(this,arguments);text.type=text.type||"info";var subtype=text.type.split("-")[0];switch(subtype){case"alert":return alertPopup(text);case"confirm":return confirmPopup(text);case"modalbox":return boxPopup(text);default:return info(text);break;}};t.seed=(new Date()).valueOf();t.uid=function(){return t.seed++;};t.expire=4000;t.keyboard=true;t.position="top";t.pull={};t.timers={};t.hideAll=function(){for(var key in t.pull)
t.hide(key);};t.hide=function(id){var obj=t.pull[id];if(obj&&obj.parentNode){window.setTimeout(function(){obj.parentNode.removeChild(obj);obj=null;},2000);obj.className+=" hidden";if(t.timers[id])
window.clearTimeout(t.timers[id]);delete t.pull[id];}};})();function dataProcessor(serverProcessorURL){this.serverProcessor=serverProcessorURL;this.action_param="!nativeeditor_status";this.object=null;this.updatedRows=[];this.autoUpdate=true;this.updateMode="cell";this._tMode="GET";this.post_delim="_";this._waitMode=0;this._in_progress={};this._invalid={};this.mandatoryFields=[];this.messages=[];this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"};this.enableUTFencoding(true);dhtmlxEventable(this);return this;}
dataProcessor.prototype={setTransactionMode:function(mode,total){this._tMode=mode;this._tSend=total;},escape:function(data){if(this._utf)
return encodeURIComponent(data);else
return escape(data);},enableUTFencoding:function(mode){this._utf=convertStringToBoolean(mode);},setDataColumns:function(val){this._columns=(typeof val=="string")?val.split(","):val;},getSyncState:function(){return!this.updatedRows.length;},enableDataNames:function(mode){this._endnm=convertStringToBoolean(mode);},enablePartialDataSend:function(mode){this._changed=convertStringToBoolean(mode);},setUpdateMode:function(mode,dnd){this.autoUpdate=(mode=="cell");this.updateMode=mode;this.dnd=dnd;},ignore:function(code,master){this._silent_mode=true;code.call(master||window);this._silent_mode=false;},setUpdated:function(rowId,state,mode){if(this._silent_mode)return;var ind=this.findRow(rowId);mode=mode||"updated";var existing=this.obj.getUserData(rowId,this.action_param);if(existing&&mode=="updated")mode=existing;if(state){this.set_invalid(rowId,false);this.updatedRows[ind]=rowId;this.obj.setUserData(rowId,this.action_param,mode);if(this._in_progress[rowId])
this._in_progress[rowId]="wait";}else{if(!this.is_invalid(rowId)){this.updatedRows.splice(ind,1);this.obj.setUserData(rowId,this.action_param,"");}}
if(!state)
this._clearUpdateFlag(rowId);this.markRow(rowId,state,mode);if(state&&this.autoUpdate)this.sendData(rowId);},_clearUpdateFlag:function(id){},markRow:function(id,state,mode){var str="";var invalid=this.is_invalid(id);if(invalid){str=this.styles[invalid];state=true;}
if(this.callEvent("onRowMark",[id,state,mode,invalid])){str=this.styles[state?mode:"clear"]+str;this.obj[this._methods[0]](id,str);if(invalid&&invalid.details){str+=this.styles[invalid+"_cell"];for(var i=0;i<invalid.details.length;i++)
if(invalid.details[i])
this.obj[this._methods[1]](id,i,str);}}},getState:function(id){return this.obj.getUserData(id,this.action_param);},is_invalid:function(id){return this._invalid[id];},set_invalid:function(id,mode,details){if(details)mode={value:mode,details:details,toString:function(){return this.value.toString();}};this._invalid[id]=mode;},checkBeforeUpdate:function(rowId){return true;},sendData:function(rowId){if(this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2))return;if(this.obj.editStop)this.obj.editStop();if(typeof rowId=="undefined"||this._tSend)return this.sendAllData();if(this._in_progress[rowId])return false;this.messages=[];if(!this.checkBeforeUpdate(rowId)&&this.callEvent("onValidatationError",[rowId,this.messages]))return false;this._beforeSendData(this._getRowData(rowId),rowId);},_beforeSendData:function(data,rowId){if(!this.callEvent("onBeforeUpdate",[rowId,this.getState(rowId),data]))return false;this._sendData(data,rowId);},serialize:function(data,id){if(typeof data=="string")
return data;if(typeof id!="undefined")
return this.serialize_one(data,"");else{var stack=[];var keys=[];for(var key in data)
if(data.hasOwnProperty(key)){stack.push(this.serialize_one(data[key],key+this.post_delim));keys.push(key);}
stack.push("ids="+this.escape(keys.join(",")));if(dhtmlx.security_key)
stack.push("dhx_security="+dhtmlx.security_key);return stack.join("&");}},serialize_one:function(data,pref){if(typeof data=="string")
return data;var stack=[];for(var key in data)
if(data.hasOwnProperty(key))
stack.push(this.escape((pref||"")+key)+"="+this.escape(data[key]));return stack.join("&");},_sendData:function(a1,rowId){if(!a1)return;if(!this.callEvent("onBeforeDataSending",rowId?[rowId,this.getState(rowId),a1]:[null,null,a1]))return false;if(rowId)
this._in_progress[rowId]=(new Date()).valueOf();var a2=new dtmlXMLLoaderObject(this.afterUpdate,this,true);var a3=this.serverProcessor+(this._user?(getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&")):"");if(this._tMode!="POST")
a2.loadXML(a3+((a3.indexOf("?")!=-1)?"&":"?")+this.serialize(a1,rowId));else
a2.loadXML(a3,true,this.serialize(a1,rowId));this._waitMode++;},sendAllData:function(){if(!this.updatedRows.length)return;this.messages=[];var valid=true;for(var i=0;i<this.updatedRows.length;i++)
valid&=this.checkBeforeUpdate(this.updatedRows[i]);if(!valid&&!this.callEvent("onValidatationError",["",this.messages]))return false;if(this._tSend)
this._sendData(this._getAllData());else
for(var i=0;i<this.updatedRows.length;i++)
if(!this._in_progress[this.updatedRows[i]]){if(this.is_invalid(this.updatedRows[i]))continue;this._beforeSendData(this._getRowData(this.updatedRows[i]),this.updatedRows[i]);if(this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2))return;}},_getAllData:function(rowId){var out={};var has_one=false;for(var i=0;i<this.updatedRows.length;i++){var id=this.updatedRows[i];if(this._in_progress[id]||this.is_invalid(id))continue;if(!this.callEvent("onBeforeUpdate",[id,this.getState(id)]))continue;out[id]=this._getRowData(id,id+this.post_delim);has_one=true;this._in_progress[id]=(new Date()).valueOf();}
return has_one?out:null;},setVerificator:function(ind,verifFunction){this.mandatoryFields[ind]=verifFunction||(function(value){return(value!="");});},clearVerificator:function(ind){this.mandatoryFields[ind]=false;},findRow:function(pattern){var i=0;for(i=0;i<this.updatedRows.length;i++)
if(pattern==this.updatedRows[i])break;return i;},defineAction:function(name,handler){if(!this._uActions)this._uActions=[];this._uActions[name]=handler;},afterUpdateCallback:function(sid,tid,action,btag){var marker=sid;var correct=(action!="error"&&action!="invalid");if(!correct)this.set_invalid(sid,action);if((this._uActions)&&(this._uActions[action])&&(!this._uActions[action](btag)))
return(delete this._in_progress[marker]);if(this._in_progress[marker]!="wait")
this.setUpdated(sid,false);var soid=sid;switch(action){case"update":case"updated":case"inserted":case"insert":if(tid!=sid){this.obj[this._methods[2]](sid,tid);sid=tid;}
break;case"delete":case"deleted":this.obj.setUserData(sid,this.action_param,"true_deleted");this.obj[this._methods[3]](sid);delete this._in_progress[marker];return this.callEvent("onAfterUpdate",[sid,action,tid,btag]);break;}
if(this._in_progress[marker]!="wait"){if(correct)this.obj.setUserData(sid,this.action_param,'');delete this._in_progress[marker];}else{delete this._in_progress[marker];this.setUpdated(tid,true,this.obj.getUserData(sid,this.action_param));}
this.callEvent("onAfterUpdate",[sid,action,tid,btag]);},afterUpdate:function(that,b,c,d,xml){xml.getXMLTopNode("data");if(!xml.xmlDoc.responseXML)return;var atag=xml.doXPath("//data/action");for(var i=0;i<atag.length;i++){var btag=atag[i];var action=btag.getAttribute("type");var sid=btag.getAttribute("sid");var tid=btag.getAttribute("tid");that.afterUpdateCallback(sid,tid,action,btag);}
that.finalizeUpdate();},finalizeUpdate:function(){if(this._waitMode)this._waitMode--;if((this.obj.mytype=="tree"||this.obj._h2)&&this.updatedRows.length)
this.sendData();this.callEvent("onAfterUpdateFinish",[]);if(!this.updatedRows.length)
this.callEvent("onFullSync",[]);},init:function(anObj){this.obj=anObj;if(this.obj._dp_init)
this.obj._dp_init(this);},setOnAfterUpdate:function(ev){this.attachEvent("onAfterUpdate",ev);},enableDebug:function(mode){},setOnBeforeUpdateHandler:function(func){this.attachEvent("onBeforeDataSending",func);},setAutoUpdate:function(interval,user){interval=interval||2000;this._user=user||(new Date()).valueOf();this._need_update=false;this._loader=null;this._update_busy=false;this.attachEvent("onAfterUpdate",function(sid,action,tid,xml_node){this.afterAutoUpdate(sid,action,tid,xml_node);});this.attachEvent("onFullSync",function(){this.fullSync();});var self=this;window.setInterval(function(){self.loadUpdate();},interval);},afterAutoUpdate:function(sid,action,tid,xml_node){if(action=='collision'){this._need_update=true;return false;}else{return true;}},fullSync:function(){if(this._need_update==true){this._need_update=false;this.loadUpdate();}
return true;},getUpdates:function(url,callback){if(this._update_busy)
return false;else
this._update_busy=true;this._loader=this._loader||new dtmlXMLLoaderObject(true);this._loader.async=true;this._loader.waitCall=callback;this._loader.loadXML(url);},_v:function(node){if(node.firstChild)return node.firstChild.nodeValue;return"";},_a:function(arr){var res=[];for(var i=0;i<arr.length;i++){res[i]=this._v(arr[i]);};return res;},loadUpdate:function(){var self=this;var version=this.obj.getUserData(0,"version");var url=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+version].join("&");url=url.replace("editing=true&","");this.getUpdates(url,function(){var vers=self._loader.doXPath("//userdata");self.obj.setUserData(0,"version",self._v(vers[0]));var upds=self._loader.doXPath("//update");if(upds.length){self._silent_mode=true;for(var i=0;i<upds.length;i++){var status=upds[i].getAttribute('status');var id=upds[i].getAttribute('id');var parent=upds[i].getAttribute('parent');switch(status){case'inserted':self.callEvent("insertCallback",[upds[i],id,parent]);break;case'updated':self.callEvent("updateCallback",[upds[i],id,parent]);break;case'deleted':self.callEvent("deleteCallback",[upds[i],id,parent]);break;}}
self._silent_mode=false;}
self._update_busy=false;self=null;});}};if(window.dhtmlXGridObject){dhtmlXGridObject.prototype._init_point_connector=dhtmlXGridObject.prototype._init_point;dhtmlXGridObject.prototype._init_point=function(){var clear_url=function(url){url=url.replace(/(\?|\&)connector[^\f]*/g,"");return url+(url.indexOf("?")!=-1?"&":"?")+"connector=true"+(this.hdr.rows.length>0?"&dhx_no_header=1":"");};var combine_urls=function(url){return clear_url.call(this,url)+(this._connector_sorting||"")+(this._connector_filter||"");};var sorting_url=function(url,ind,dir){this._connector_sorting="&dhx_sort["+ind+"]="+dir;return combine_urls.call(this,url);};var filtering_url=function(url,inds,vals){for(var i=0;i<inds.length;i++)
inds[i]="dhx_filter["+inds[i]+"]="+encodeURIComponent(vals[i]);this._connector_filter="&"+inds.join("&");return combine_urls.call(this,url);};this.attachEvent("onCollectValues",function(ind){if(this._con_f_used[ind]){if(typeof(this._con_f_used[ind])=="object")
return this._con_f_used[ind];else
return false;}
return true;});this.attachEvent("onDynXLS",function(){this.xmlFileUrl=combine_urls.call(this,this.xmlFileUrl);return true;});this.attachEvent("onBeforeSorting",function(ind,type,dir){if(type=="connector"){var self=this;this.clearAndLoad(sorting_url.call(this,this.xmlFileUrl,ind,dir),function(){self.setSortImgState(true,ind,dir);});return false;}
return true;});this.attachEvent("onFilterStart",function(a,b){if(this._con_f_used.length){this.clearAndLoad(filtering_url.call(this,this.xmlFileUrl,a,b));return false;}
return true;});this.attachEvent("onXLE",function(a,b,c,xml){if(!xml)return;});if(this._init_point_connector)this._init_point_connector();};dhtmlXGridObject.prototype._con_f_used=[];dhtmlXGridObject.prototype._in_header_connector_text_filter=function(t,i){if(!this._con_f_used[i])
this._con_f_used[i]=1;return this._in_header_text_filter(t,i);};dhtmlXGridObject.prototype._in_header_connector_select_filter=function(t,i){if(!this._con_f_used[i])
this._con_f_used[i]=2;return this._in_header_select_filter(t,i);};dhtmlXGridObject.prototype.load_connector=dhtmlXGridObject.prototype.load;dhtmlXGridObject.prototype.load=function(url,call,type){if(!this._colls_loaded&&this.cellType){var ar=[];for(var i=0;i<this.cellType.length;i++)
if(this.cellType[i].indexOf("co")==0||this._con_f_used[i]==2)ar.push(i);if(ar.length)
arguments[0]+=(arguments[0].indexOf("?")!=-1?"&":"?")+"connector=true&dhx_colls="+ar.join(",");}
return this.load_connector.apply(this,arguments);};dhtmlXGridObject.prototype._parseHead_connector=dhtmlXGridObject.prototype._parseHead;dhtmlXGridObject.prototype._parseHead=function(url,call,type){this._parseHead_connector.apply(this,arguments);if(!this._colls_loaded){var cols=this.xmlLoader.doXPath("./coll_options",arguments[0]);for(var i=0;i<cols.length;i++){var f=cols[i].getAttribute("for");var v=[];var combo=null;if(this.cellType[f]=="combo")
combo=this.getColumnCombo(f);if(this.cellType[f].indexOf("co")==0)
combo=this.getCombo(f);var os=this.xmlLoader.doXPath("./item",cols[i]);for(var j=0;j<os.length;j++){var val=os[j].getAttribute("value");if(combo){var lab=os[j].getAttribute("label")||val;if(combo.addOption)
combo.addOption([[val,lab]]);else
combo.put(val,lab);v[v.length]=lab;}else
v[v.length]=val;}
if(this._con_f_used[f*1])
this._con_f_used[f*1]=v;}
this._colls_loaded=true;}};}
if(window.dataProcessor){dataProcessor.prototype.init_original=dataProcessor.prototype.init;dataProcessor.prototype.init=function(obj){this.init_original(obj);obj._dataprocessor=this;this.setTransactionMode("POST",true);this.serverProcessor+=(this.serverProcessor.indexOf("?")!=-1?"&":"?")+"editing=true";};}
dhtmlxError.catchError("LoadXML",function(a,b,c){if(c[0].status!=0){alert(c[0].responseText);}});window.dhtmlXScheduler=window.scheduler={version:"3.5.0"};dhtmlxEventable(scheduler);scheduler.init=function(id,date,mode){date=date||(new Date());mode=mode||"week";scheduler.date.init();this._obj=(typeof id=="string")?document.getElementById(id):id;this._els=[];this._scroll=true;this._quirks=(_isIE&&document.compatMode=="BackCompat");this._quirks7=(_isIE&&navigator.appVersion.indexOf("MSIE 8")==-1);this.get_elements();this.init_templates();this.set_actions();dhtmlxEvent(window,"resize",function(){window.clearTimeout(scheduler._resize_timer);scheduler._resize_timer=window.setTimeout(function(){if(scheduler.callEvent("onSchedulerResize",[])){scheduler.update_view();scheduler.callEvent("onAfterSchedulerResize",[]);}},100);});this.set_sizes();scheduler.callEvent('onSchedulerReady',[]);this.setCurrentView(date,mode);};scheduler.xy={nav_height:22,min_event_height:40,scale_width:50,bar_height:20,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,lightbox_additional_height:50};scheduler.keys={edit_save:13,edit_cancel:27};scheduler.set_sizes=function(){var w=this._x=this._obj.clientWidth-this.xy.margin_left;var h=this._y=this._obj.clientHeight-this.xy.margin_top;var scale_x=this._table_view?0:(this.xy.scale_width+this.xy.scroll_width);var scale_s=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els["dhx_cal_navline"][0],w,this.xy.nav_height,0,0);this.set_xy(this._els["dhx_cal_header"][0],w-scale_x,this.xy.scale_height,scale_s,this.xy.nav_height+(this._quirks?-1:1));var actual_height=this._els["dhx_cal_navline"][0].offsetHeight;if(actual_height>0)this.xy.nav_height=actual_height;var data_y=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els["dhx_cal_data"][0],w,h-(data_y+2),0,data_y+2);};scheduler.set_xy=function(node,w,h,x,y){node.style.width=Math.max(0,w)+"px";node.style.height=Math.max(0,h)+"px";if(arguments.length>3){node.style.left=x+"px";node.style.top=y+"px";}};scheduler.get_elements=function(){var els=this._obj.getElementsByTagName("DIV");for(var i=0;i<els.length;i++){var name=els[i].className;if(name)name=name.split(" ")[0];if(!this._els[name])this._els[name]=[];this._els[name].push(els[i]);var t=scheduler.locale.labels[els[i].getAttribute("name")||name];if(t)els[i].innerHTML=t;}};scheduler.set_actions=function(){for(var a in this._els)
if(this._click[a])
for(var i=0;i<this._els[a].length;i++)
this._els[a][i].onclick=scheduler._click[a];this._obj.onselectstart=function(e){return false;};this._obj.onmousemove=function(e){scheduler._on_mouse_move(e||event);};this._obj.onmousedown=function(e){scheduler._on_mouse_down(e||event);};this._obj.onmouseup=function(e){scheduler._on_mouse_up(e||event);};this._obj.ondblclick=function(e){scheduler._on_dbl_click(e||event);};this._obj.oncontextmenu=function(e){var ev=e||event;var src=ev.target||ev.srcElement;var returnValue=scheduler.callEvent("onContextMenu",[scheduler._locate_event(src),ev]);return returnValue;};};scheduler.select=function(id){if(this._select_id==id)return;this.editStop(false);this.unselect();this._select_id=id;this.updateEvent(id);};scheduler.unselect=function(id){if(id&&id!=this._select_id)return;var t=this._select_id;this._select_id=null;if(t)this.updateEvent(t);};scheduler.getState=function(){return{mode:this._mode,date:this._date,min_date:this._min_date,max_date:this._max_date,editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode};};scheduler._click={dhx_cal_data:function(e){var trg=e?e.target:event.srcElement;var id=scheduler._locate_event(trg);e=e||event;if(!id){scheduler.callEvent("onEmptyClick",[scheduler.getActionData(e).date,e]);}else{if(!scheduler.callEvent("onClick",[id,e])||scheduler.config.readonly)return;}
if(id&&scheduler.config.select){scheduler.select(id);var mask=trg.className;if(mask.indexOf("_icon")!=-1)
scheduler._click.buttons[mask.split(" ")[1].replace("icon_","")](id);}else
scheduler._close_not_saved();},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1);},dhx_cal_next_button:function(dummy,step){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),(step||1),scheduler._mode));},dhx_cal_today_button:function(){scheduler.setCurrentView(new Date());},dhx_cal_tab:function(){var name=this.getAttribute("name");var mode=name.substring(0,name.search("_tab"));scheduler.setCurrentView(scheduler._date,mode);},buttons:{"delete":function(id){var c=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(c,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(id)});},edit:function(id){scheduler.edit(id);},save:function(id){scheduler.editStop(true);},details:function(id){scheduler.showLightbox(id);},cancel:function(id){scheduler.editStop(false);}}};scheduler._dhtmlx_confirm=function(message,title,callback){if(!message)
return callback();var opts={text:message};if(title)
opts.title=title;if(callback){opts.callback=function(result){if(result)
callback();};}
dhtmlx.confirm(opts);};scheduler.addEventNow=function(start,end,e){var base={};if(start&&start.constructor.toString().match(/object/i)!==null){base=start;start=null;}
var d=(this.config.event_duration||this.config.time_step)*60000;if(!start)start=Math.round((new Date()).valueOf()/d)*d;var start_date=new Date(start);if(!end){var start_hour=this.config.first_hour;if(start_hour>start_date.getHours()){start_date.setHours(start_hour);start=start_date.valueOf();}
end=start.valueOf()+d;}
var end_date=new Date(end);if(start_date.valueOf()==end_date.valueOf())
end_date.setTime(end_date.valueOf()+d);base.start_date=base.start_date||start_date;base.end_date=base.end_date||end_date;base.text=base.text||this.locale.labels.new_event;base.id=this._drag_id=this.uid();this._drag_mode="new-size";this._loading=true;this.addEvent(base);this.callEvent("onEventCreated",[this._drag_id,e]);this._loading=false;this._drag_event={};this._on_mouse_up(e);};scheduler._on_dbl_click=function(e,src){src=src||(e.target||e.srcElement);if(this.config.readonly)return;var name=src.className.split(" ")[0];switch(name){case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_wa_day_data":case"dhx_marked_timespan":if(!scheduler.config.dblclick_create)break;this.addEventNow(this.getActionData(e).date,null,e);break;case"dhx_cal_event":case"dhx_wa_ev_body":case"dhx_agenda_line":case"dhx_grid_event":case"dhx_cal_event_line":case"dhx_cal_event_clear":var id=this._locate_event(src);if(!this.callEvent("onDblClick",[id,e]))return;if(this.config.details_on_dblclick||this._table_view||!this.getEvent(id)._timed||!this.config.select)
this.showLightbox(id);else
this.edit(id);break;case"dhx_time_block":case"dhx_cal_container":return;break;default:var t=this["dblclick_"+name];if(t){t.call(this,e);}
else{if(src.parentNode&&src!=this)
return scheduler._on_dbl_click(e,src.parentNode);}
break;}};scheduler._mouse_coords=function(ev){var pos;var b=document.body;var d=document.documentElement;if(ev.pageX||ev.pageY)
pos={x:ev.pageX,y:ev.pageY};else pos={x:ev.clientX+(b.scrollLeft||d.scrollLeft||0)-b.clientLeft,y:ev.clientY+(b.scrollTop||d.scrollTop||0)-b.clientTop};pos.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width);pos.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els["dhx_cal_data"][0].scrollTop;pos.ev=ev;var handler=this["mouse_"+this._mode];if(handler)
return handler.call(this,pos);if(!this._table_view){pos.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(pos.x/this._cols[0])-1));pos.y=Math.max(0,Math.ceil(pos.y*60/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step);}else{if(!this._cols||!this._colsS)
return pos;var dy=0;for(dy=1;dy<this._colsS.heights.length;dy++)
if(this._colsS.heights[dy]>pos.y)break;pos.y=Math.ceil((Math.max(0,pos.x/this._cols[0])+Math.max(0,dy-1)*7)*24*60/this.config.time_step);if(scheduler._drag_mode||this._mode=="month")
pos.y=(Math.max(0,Math.ceil(pos.x/this._cols[0])-1)+Math.max(0,dy-1)*7)*24*60/this.config.time_step;pos.x=0;}
return pos;};scheduler._close_not_saved=function(){if(new Date().valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var c=scheduler.locale.labels.confirm_closing;scheduler._dhtmlx_confirm(c,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing);});}};scheduler._correct_shift=function(start,back){return start-=((new Date(scheduler._min_date)).getTimezoneOffset()-(new Date(start)).getTimezoneOffset())*60000*(back?-1:1);};scheduler._on_mouse_move=function(e){if(this._drag_mode){var pos=this._mouse_coords(e);if(!this._drag_pos||pos.custom||this._drag_pos.x!=pos.x||this._drag_pos.y!=pos.y){var start,end;if(this._edit_id!=this._drag_id)
this._close_not_saved();this._drag_pos=pos;if(this._drag_mode=="create"){this._close_not_saved();this._loading=true;start=this._get_date_from_pos(pos).valueOf();var res=this.callEvent("onBeforeEventCreated",[e]);if(!res)
return;if(!this._drag_start){this._drag_start=start;return;}
end=start;if(end==this._drag_start)return;this._drag_id=this.uid();this.addEvent(new Date(this._drag_start),new Date(end),this.locale.labels.new_event,this._drag_id,pos.fields);this.callEvent("onEventCreated",[this._drag_id,e]);this._loading=false;this._drag_mode="new-size";}
var ev=this.getEvent(this._drag_id);if(this._drag_mode=="move"){start=this._min_date.valueOf()+(pos.y*this.config.time_step+pos.x*24*60)*60000;if(!pos.custom&&this._table_view)start+=this.date.time_part(ev.start_date)*1000;start=this._correct_shift(start);end=ev.end_date.valueOf()-(ev.start_date.valueOf()-start);}else{start=ev.start_date.valueOf();end=ev.end_date.valueOf();if(this._table_view){var resize_date=this._min_date.valueOf()+pos.y*this.config.time_step*60000+(pos.custom?0:24*60*60000);if(this._mode=="month")
resize_date=this._correct_shift(resize_date,false);if(pos.resize_from_start)
start=resize_date;else
end=resize_date;}else{end=this.date.date_part(new Date(ev.end_date)).valueOf()+pos.y*this.config.time_step*60000;this._els["dhx_cal_data"][0].style.cursor="s-resize";if(this._mode=="week"||this._mode=="day")
end=this._correct_shift(end);}
if(this._drag_mode=="new-size"){if(end<=this._drag_start){var shift=pos.shift||((this._table_view&&!pos.custom)?24*60*60000:0);start=end-(pos.shift?0:shift);end=this._drag_start+(shift||(this.config.time_step*60000));}else{start=this._drag_start;}}else{if(end<=start)
end=start+this.config.time_step*60000;}}
var new_end=new Date(end-1);var new_start=new Date(start);if(this._table_view||(new_end.getDate()==new_start.getDate()&&new_end.getHours()<this.config.last_hour)||scheduler._allow_dnd){ev.start_date=new_start;ev.end_date=new Date(end);if(this.config.update_render){var sx=scheduler._els["dhx_cal_data"][0].scrollTop;this.update_view();scheduler._els["dhx_cal_data"][0].scrollTop=sx;}else
this.updateEvent(this._drag_id);}
if(this._table_view){this.for_rendered(this._drag_id,function(r){r.className+=" dhx_in_move";});}}}else{if(scheduler.checkEvent("onMouseMove")){var id=this._locate_event(e.target||e.srcElement);this.callEvent("onMouseMove",[id,e]);}}};scheduler._on_mouse_down=function(e,src){if(this.config.readonly||this._drag_mode)return;src=src||(e.target||e.srcElement);var classname=src.className&&src.className.split(" ")[0];switch(classname){case"dhx_cal_event_line":case"dhx_cal_event_clear":if(this._table_view)
this._drag_mode="move";break;case"dhx_event_move":case"dhx_wa_ev_body":this._drag_mode="move";break;case"dhx_event_resize":this._drag_mode="resize";break;case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_matrix_cell":case"dhx_marked_timespan":this._drag_mode="create";this.unselect(this._select_id);break;case"":if(src.parentNode)
return scheduler._on_mouse_down(e,src.parentNode);default:if(scheduler.checkEvent("onMouseDown")&&scheduler.callEvent("onMouseDown",[classname])){if(src.parentNode&&src!=this){return scheduler._on_mouse_down(e,src.parentNode);}}
this._drag_mode=null;this._drag_id=null;break;}
if(this._drag_mode){var id=this._locate_event(src);if(!this.config["drag_"+this._drag_mode]||!this.callEvent("onBeforeDrag",[id,this._drag_mode,e]))
this._drag_mode=this._drag_id=0;else{this._drag_id=id;this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{});}}
this._drag_start=null;};scheduler._on_mouse_up=function(e){if(this._drag_mode&&this._drag_id){this._els["dhx_cal_data"][0].style.cursor="default";var ev=this.getEvent(this._drag_id);if(this._drag_event._dhx_changed||!this._drag_event.start_date||ev.start_date.valueOf()!=this._drag_event.start_date.valueOf()||ev.end_date.valueOf()!=this._drag_event.end_date.valueOf()){var is_new=(this._drag_mode=="new-size");if(!this.callEvent("onBeforeEventChanged",[ev,e,is_new,this._drag_event])){if(is_new)
this.deleteEvent(ev.id,true);else{this._drag_event._dhx_changed=false;scheduler._lame_copy(ev,this._drag_event);this.updateEvent(ev.id);}}else{var drag_id=this._drag_id;this._drag_id=this._drag_mode=null;if(is_new&&this.config.edit_on_create){this.unselect();this._new_event=new Date();if(this._table_view||this.config.details_on_create||!this.config.select){return this.showLightbox(drag_id);}
this._drag_pos=true;this._select_id=this._edit_id=drag_id;}else{if(!this._new_event)
this.callEvent(is_new?"onEventAdded":"onEventChanged",[drag_id,this.getEvent(drag_id)]);}}}
if(this._drag_pos)this.render_view_data();}
this._drag_id=null;this._drag_mode=null;this._drag_pos=null;};scheduler.update_view=function(){this._reset_scale();if(this._load_mode&&this._load())return this._render_wait=true;this.render_view_data();};scheduler.updateView=function(date,mode){date=date||this._date;mode=mode||this._mode;var dhx_cal_data='dhx_cal_data';if(!this._mode)
this._obj.className+=" dhx_scheduler_"+mode;else{this._obj.className=this._obj.className.replace("dhx_scheduler_"+this._mode,"dhx_scheduler_"+mode);}
var prev_scroll=(this._mode==mode&&this.config.preserve_scroll)?this._els[dhx_cal_data][0].scrollTop:false;if(this[this._mode+"_view"]&&mode&&this._mode!=mode)
this[this._mode+"_view"](false);this._close_not_saved();var dhx_multi_day='dhx_multi_day';if(this._els[dhx_multi_day]){this._els[dhx_multi_day][0].parentNode.removeChild(this._els[dhx_multi_day][0]);this._els[dhx_multi_day]=null;}
this._mode=mode;this._date=date;this._table_view=(this._mode=="month");var tabs=this._els["dhx_cal_tab"];for(var i=0;i<tabs.length;i++){var name=tabs[i].className;name=name.replace(/ active/g,"");if(tabs[i].getAttribute("name")==this._mode+"_tab")
name=name+" active";tabs[i].className=name;}
var view=this[this._mode+"_view"];view?view(true):this.update_view();if(typeof prev_scroll=="number")
this._els[dhx_cal_data][0].scrollTop=prev_scroll;};scheduler.setCurrentView=function(date,mode){if(!this.callEvent("onBeforeViewChange",[this._mode,this._date,mode,date]))return;this.updateView(date,mode);this.callEvent("onViewChange",[this._mode,this._date]);};scheduler._render_x_header=function(i,left,d,h){var head=document.createElement("DIV");head.className="dhx_scale_bar";this.set_xy(head,this._cols[i]-1,this.xy.scale_height-2,left,0);head.innerHTML=this.templates[this._mode+"_scale_date"](d,this._mode);h.appendChild(head);};scheduler._reset_scale=function(){if(!this.templates[this._mode+"_date"])return;var h=this._els["dhx_cal_header"][0];var b=this._els["dhx_cal_data"][0];var c=this.config;h.innerHTML="";b.scrollTop=0;b.innerHTML="";var str=((c.readonly||(!c.drag_resize))?" dhx_resize_denied":"")+((c.readonly||(!c.drag_move))?" dhx_move_denied":"");if(str)b.className="dhx_cal_data"+str;this._scales={};this._cols=[];this._colsS={height:0};this._dy_shift=0;this.set_sizes();var summ=parseInt(h.style.width,10);var left=0;var d,dd,sd,today;dd=this.date[this._mode+"_start"](new Date(this._date.valueOf()));d=sd=this._table_view?scheduler.date.week_start(dd):dd;today=this.date.date_part(new Date());var ed=scheduler.date.add(dd,1,this._mode);var count=7;if(!this._table_view){var count_n=this.date["get_"+this._mode+"_end"];if(count_n)ed=count_n(dd);count=Math.round((ed.valueOf()-dd.valueOf())/(1000*60*60*24));}
this._min_date=d;this._els["dhx_cal_date"][0].innerHTML=this.templates[this._mode+"_date"](dd,ed,this._mode);for(var i=0;i<count;i++){this._cols[i]=Math.floor(summ/(count-i));this._render_x_header(i,left,d,h);if(!this._table_view){var scales=document.createElement("DIV");var cls="dhx_scale_holder";if(d.valueOf()==today.valueOf())cls="dhx_scale_holder_now";scales.className=cls+" "+this.templates.week_date_class(d,today);this.set_xy(scales,this._cols[i]-1,c.hour_size_px*(c.last_hour-c.first_hour),left+this.xy.scale_width+1,0);b.appendChild(scales);this.callEvent("onScaleAdd",[scales,d]);}
d=this.date.add(d,1,"day");summ-=this._cols[i];left+=this._cols[i];this._colsS[i]=(this._cols[i-1]||0)+(this._colsS[i-1]||(this._table_view?0:this.xy.scale_width+2));this._colsS['col_length']=count+1;}
this._max_date=d;this._colsS[count]=this._cols[count-1]+this._colsS[count-1];if(this._table_view)
this._reset_month_scale(b,dd,sd);else{this._reset_hours_scale(b,dd,sd);if(c.multi_day){var dhx_multi_day='dhx_multi_day';if(this._els[dhx_multi_day]){this._els[dhx_multi_day][0].parentNode.removeChild(this._els[dhx_multi_day][0]);this._els[dhx_multi_day]=null;}
var navline=this._els["dhx_cal_navline"][0];var top=navline.offsetHeight+this._els["dhx_cal_header"][0].offsetHeight+1;var c1=document.createElement("DIV");c1.className=dhx_multi_day;c1.style.visibility="hidden";this.set_xy(c1,this._colsS[this._colsS.col_length-1]+this.xy.scroll_width,0,0,top);b.parentNode.insertBefore(c1,b);var c2=c1.cloneNode(true);c2.className=dhx_multi_day+"_icon";c2.style.visibility="hidden";this.set_xy(c2,this.xy.scale_width,0,0,top);c1.appendChild(c2);this._els[dhx_multi_day]=[c1,c2];this._els[dhx_multi_day][0].onclick=this._click.dhx_cal_data;}}};scheduler._reset_hours_scale=function(b,dd,sd){var c=document.createElement("DIV");c.className="dhx_scale_holder";var date=new Date(1980,1,1,this.config.first_hour,0,0);for(var i=this.config.first_hour*1;i<this.config.last_hour;i++){var cc=document.createElement("DIV");cc.className="dhx_scale_hour";cc.style.height=this.config.hour_size_px-(this._quirks?0:1)+"px";cc.style.width=this.xy.scale_width+"px";cc.innerHTML=scheduler.templates.hour_scale(date);c.appendChild(cc);date=this.date.add(date,1,"hour");}
b.appendChild(c);if(this.config.scroll_hour)
b.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour);};scheduler._reset_month_scale=function(b,dd,sd){var ed=scheduler.date.add(dd,1,"month");var cd=new Date();this.date.date_part(cd);this.date.date_part(sd);var rows=Math.ceil(Math.round((ed.valueOf()-sd.valueOf())/(60*60*24*1000))/7);var tdcss=[];var height=(Math.floor(b.clientHeight/rows)-22);this._colsS.height=height+22;var h=this._colsS.heights=[];for(var i=0;i<=7;i++)
tdcss[i]=" style='height:"+height+"px; width:"+((this._cols[i]||0)-1)+"px;' ";var cellheight=0;this._min_date=sd;var html="<table cellpadding='0' cellspacing='0'>";var rendered_dates=[];for(var i=0;i<rows;i++){html+="<tr>";for(var j=0;j<7;j++){html+="<td";var cls="";if(sd<dd)
cls='dhx_before';else if(sd>=ed)
cls='dhx_after';else if(sd.valueOf()==cd.valueOf())
cls='dhx_now';html+=" class='"+cls+" "+this.templates.month_date_class(sd,cd)+"' ";html+="><div class='dhx_month_head'>"+this.templates.month_day(sd)+"</div><div class='dhx_month_body' "+tdcss[j]+"></div></td>";rendered_dates.push(sd);sd=this.date.add(sd,1,"day");}
html+="</tr>";h[i]=cellheight;cellheight+=this._colsS.height;}
html+="</table>";this._max_date=sd;b.innerHTML=html;this._scales={};var divs=b.getElementsByTagName('div');for(var i=0;i<rendered_dates.length;i++){var div=divs[(i*2)+1];var date=rendered_dates[i];this._scales[+date]=div;}
for(var i=0;i<rendered_dates.length;i++){var date=rendered_dates[i];this.callEvent("onScaleAdd",[this._scales[+date],date]);}
return sd;};scheduler.getLabel=function(property,key){var sections=this.config.lightbox.sections;for(var i=0;i<sections.length;i++){if(sections[i].map_to==property){var options=sections[i].options;for(var j=0;j<options.length;j++){if(options[j].key==key){return options[j].label;}}}}
return"";};scheduler.updateCollection=function(list_name,collection){var list=scheduler.serverList(list_name);if(!list)return false;list.splice(0,list.length);list.push.apply(list,collection||[]);scheduler.callEvent("onOptionsLoad",[]);scheduler.resetLightbox();return true;};scheduler._lame_clone=function(object,cache){var i,t,result;cache=cache||[];for(i=0;i<cache.length;i+=2)
if(object===cache[i])
return cache[i+1];if(object&&typeof object=="object"){result={};t=[Array,Date,Number,String,Boolean];for(i=0;i<t.length;i++){if(object instanceof t[i])
result=i?new t[i](object):new t[i]();}
cache.push(object,result);for(i in object){if(Object.prototype.hasOwnProperty.apply(object,[i]))
result[i]=scheduler._lame_clone(object[i],cache)}}
return result||object;};scheduler._lame_copy=function(target,source){for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key];}}
return target;};scheduler._get_date_from_pos=function(pos){var start=this._min_date.valueOf()+(pos.y*this.config.time_step+(this._table_view?0:pos.x)*24*60)*60000;return new Date(this._correct_shift(start));};scheduler.getActionData=function(n_ev){var pos=this._mouse_coords(n_ev);return{date:this._get_date_from_pos(pos),section:pos.section};};scheduler.date={init:function(){var s=scheduler.locale.date.month_short;var t=scheduler.locale.date.month_short_hash={};for(var i=0;i<s.length;i++)
t[s[i]]=i;var s=scheduler.locale.date.month_full;var t=scheduler.locale.date.month_full_hash={};for(var i=0;i<s.length;i++)
t[s[i]]=i;},date_part:function(date){date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);if(date.getHours()!=0)
date.setTime(date.getTime()+60*60*1000*(24-date.getHours()));return date;},time_part:function(date){return(date.valueOf()/1000-date.getTimezoneOffset()*60)%86400;},week_start:function(date){var shift=date.getDay();if(scheduler.config.start_on_monday){if(shift===0)shift=6;else shift--;}
return this.date_part(this.add(date,-1*shift,"day"));},month_start:function(date){date.setDate(1);return this.date_part(date);},year_start:function(date){date.setMonth(0);return this.month_start(date);},day_start:function(date){return this.date_part(date);},add:function(date,inc,mode){var ndate=new Date(date.valueOf());switch(mode){case"week":inc*=7;case"day":ndate.setDate(ndate.getDate()+inc);if(!date.getHours()&&ndate.getHours())
ndate.setTime(ndate.getTime()+60*60*1000*(24-ndate.getHours()));break;case"month":var new_month=ndate.getMonth()+inc;var t_ndate=new Date(ndate);ndate.setMonth(new_month);if(ndate.getMonth()!=new_month&&ndate.getMonth()!=(new_month%12)){t_ndate.setDate(1);t_ndate.setMonth(new_month);t_ndate.setDate(new Date(t_ndate.getFullYear(),new_month+1,0).getDate());ndate=t_ndate;}
break;case"year":ndate.setYear(ndate.getFullYear()+inc);break;case"hour":ndate.setHours(ndate.getHours()+inc);break;case"minute":ndate.setMinutes(ndate.getMinutes()+inc);break;default:return scheduler.date["add_"+mode](date,inc,mode);}
return ndate;},to_fixed:function(num){if(num<10)return"0"+num;return num;},copy:function(date){return new Date(date.valueOf());},date_to_str:function(format,utc){format=format.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return"\"+scheduler.date.to_fixed(date.getDate())+\"";case"%m":return"\"+scheduler.date.to_fixed((date.getMonth()+1))+\"";case"%j":return"\"+date.getDate()+\"";case"%n":return"\"+(date.getMonth()+1)+\"";case"%y":return"\"+scheduler.date.to_fixed(date.getFullYear()%100)+\"";case"%Y":return"\"+date.getFullYear()+\"";case"%D":return"\"+scheduler.locale.date.day_short[date.getDay()]+\"";case"%l":return"\"+scheduler.locale.date.day_full[date.getDay()]+\"";case"%M":return"\"+scheduler.locale.date.month_short[date.getMonth()]+\"";case"%F":return"\"+scheduler.locale.date.month_full[date.getMonth()]+\"";case"%h":return"\"+scheduler.date.to_fixed((date.getHours()+11)%12+1)+\"";case"%g":return"\"+((date.getHours()+11)%12+1)+\"";case"%G":return"\"+date.getHours()+\"";case"%H":return"\"+scheduler.date.to_fixed(date.getHours())+\"";case"%i":return"\"+scheduler.date.to_fixed(date.getMinutes())+\"";case"%a":return"\"+(date.getHours()>11?\"pm\":\"am\")+\"";case"%A":return"\"+(date.getHours()>11?\"PM\":\"AM\")+\"";case"%s":return"\"+scheduler.date.to_fixed(date.getSeconds())+\"";case"%W":return"\"+scheduler.date.to_fixed(scheduler.date.getISOWeek(date))+\"";default:return a;}});if(utc)format=format.replace(/date\.get/g,"date.getUTC");return new Function("date","return \""+format+"\";");},str_to_date:function(format,utc){var splt="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);";var mask=format.match(/%[a-zA-Z]/g);for(var i=0;i<mask.length;i++){switch(mask[i]){case"%j":case"%d":splt+="set[2]=temp["+i+"]||1;";break;case"%n":case"%m":splt+="set[1]=(temp["+i+"]||1)-1;";break;case"%y":splt+="set[0]=temp["+i+"]*1+(temp["+i+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":splt+="set[3]=temp["+i+"]||0;";break;case"%i":splt+="set[4]=temp["+i+"]||0;";break;case"%Y":splt+="set[0]=temp["+i+"]||0;";break;case"%a":case"%A":splt+="set[3]=set[3]%12+((temp["+i+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":splt+="set[5]=temp["+i+"]||0;";break;case"%M":splt+="set[1]=scheduler.locale.date.month_short_hash[temp["+i+"]]||0;";break;case"%F":splt+="set[1]=scheduler.locale.date.month_full_hash[temp["+i+"]]||0;";break;default:break;}}
var code="set[0],set[1],set[2],set[3],set[4],set[5]";if(utc)code=" Date.UTC("+code+")";return new Function("date","var set=[0,0,1,0,0,0]; "+splt+" return new Date("+code+");");},getISOWeek:function(ndate){if(!ndate)return false;var nday=ndate.getDay();if(nday===0){nday=7;}
var first_thursday=new Date(ndate.valueOf());first_thursday.setDate(ndate.getDate()+(4-nday));var year_number=first_thursday.getFullYear();var ordinal_date=Math.round((first_thursday.getTime()-new Date(year_number,0,1).getTime())/86400000);var week_number=1+Math.floor(ordinal_date/7);return week_number;},getUTCISOWeek:function(ndate){return this.getISOWeek(ndate);},convert_to_utc:function(date){return new Date(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds());}};scheduler.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",description:"Description",year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid"}};scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",hour_size_px:42,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:false,drag_resize:1,drag_move:1,drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,click_form_details:0,cascade_event_display:false,cascade_event_count:4,cascade_event_margin:30,drag_lightbox:true,preserve_scroll:true,select:true,server_utc:false,positive_closing:false,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:true},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:true,displayed_event_color:"#ffc5ab",displayed_event_text_color:"#7e2727"};scheduler.templates={};scheduler.init_templates=function(){var labels=scheduler.locale.labels;labels.dhx_save_btn=labels.icon_save;labels.dhx_cancel_btn=labels.icon_cancel;labels.dhx_delete_btn=labels.icon_delete;var d=scheduler.date.date_to_str;var c=scheduler.config;var f=function(a,b){for(var c in b)
if(!a[c])a[c]=b[c];};f(scheduler.templates,{day_date:d(c.default_date),month_date:d(c.month_date),week_date:function(d1,d2){return scheduler.templates.day_date(d1)+" &ndash; "+scheduler.templates.day_date(scheduler.date.add(d2,-1,"day"));},day_scale_date:d(c.default_date),month_scale_date:d(c.week_date),week_scale_date:d(c.day_date),hour_scale:d(c.hour_date),time_picker:d(c.hour_date),event_date:d(c.hour_date),month_day:d(c.month_day),xml_date:scheduler.date.str_to_date(c.xml_date,c.server_utc),load_format:d(c.load_date,c.server_utc),xml_format:d(c.xml_date,c.server_utc),api_date:scheduler.date.str_to_date(c.api_date),event_header:function(start,end,ev){return scheduler.templates.event_date(start)+" - "+scheduler.templates.event_date(end);},event_text:function(start,end,ev){return ev.text;},event_class:function(start,end,ev){return"";},month_date_class:function(d){return"";},week_date_class:function(d){return"";},event_bar_date:function(start,end,ev){return scheduler.templates.event_date(start)+" ";},event_bar_text:function(start,end,ev){return ev.text;}});this.callEvent("onTemplatesReady",[]);};scheduler.uid=function(){if(!this._seed)this._seed=(new Date).valueOf();return this._seed++;};scheduler._events={};scheduler.clearAll=function(){this._events={};this._loaded={};this.clear_view();};scheduler.addEvent=function(start_date,end_date,text,id,extra_data){if(!arguments.length)
return this.addEventNow();var ev=start_date;if(arguments.length!=1){ev=extra_data||{};ev.start_date=start_date;ev.end_date=end_date;ev.text=text;ev.id=id;}
ev.id=ev.id||scheduler.uid();ev.text=ev.text||"";if(typeof ev.start_date=="string")ev.start_date=this.templates.api_date(ev.start_date);if(typeof ev.end_date=="string")ev.end_date=this.templates.api_date(ev.end_date);var d=(this.config.event_duration||this.config.time_step)*60000;if(ev.start_date.valueOf()==ev.end_date.valueOf())
ev.end_date.setTime(ev.end_date.valueOf()+d);ev._timed=this.is_one_day_event(ev);var is_new=!this._events[ev.id];this._events[ev.id]=ev;this.event_updated(ev);if(!this._loading)
this.callEvent(is_new?"onEventAdded":"onEventChanged",[ev.id,ev]);return ev.id;};scheduler.deleteEvent=function(id,silent){var ev=this._events[id];if(!silent&&(!this.callEvent("onBeforeEventDelete",[id,ev])||!this.callEvent("onConfirmedBeforeEventDelete",[id,ev])))
return;if(ev){delete this._events[id];this.unselect(id);this.event_updated(ev);}
this.callEvent("onEventDeleted",[id,ev]);};scheduler.getEvent=function(id){return this._events[id];};scheduler.setEvent=function(id,hash){this._events[id]=hash;};scheduler.for_rendered=function(id,method){for(var i=this._rendered.length-1;i>=0;i--)
if(this._rendered[i].getAttribute("event_id")==id)
method(this._rendered[i],i);};scheduler.changeEventId=function(id,new_id){if(id==new_id)return;var ev=this._events[id];if(ev){ev.id=new_id;this._events[new_id]=ev;delete this._events[id];}
this.for_rendered(id,function(r){r.setAttribute("event_id",new_id);});if(this._select_id==id)this._select_id=new_id;if(this._edit_id==id)this._edit_id=new_id;this.callEvent("onEventIdChange",[id,new_id]);};(function(){var attrs=["text","Text","start_date","StartDate","end_date","EndDate"];var create_getter=function(name){return function(id){return(scheduler.getEvent(id))[name];};};var create_setter=function(name){return function(id,value){var ev=scheduler.getEvent(id);ev[name]=value;ev._changed=true;ev._timed=this.is_one_day_event(ev);scheduler.event_updated(ev,true);};};for(var i=0;i<attrs.length;i+=2){scheduler["getEvent"+attrs[i+1]]=create_getter(attrs[i]);scheduler["setEvent"+attrs[i+1]]=create_setter(attrs[i]);}})();scheduler.event_updated=function(ev,force){if(this.is_visible_events(ev))
this.render_view_data();else
this.clear_event(ev.id);};scheduler.is_visible_events=function(ev){return(ev.start_date<this._max_date&&this._min_date<ev.end_date);};scheduler.is_one_day_event=function(ev){var delta=ev.end_date.getDate()-ev.start_date.getDate();if(!delta)
return ev.start_date.getMonth()==ev.end_date.getMonth()&&ev.start_date.getFullYear()==ev.end_date.getFullYear();else{if(delta<0)delta=Math.ceil((ev.end_date.valueOf()-ev.start_date.valueOf())/(24*60*60*1000));return(delta==1&&!ev.end_date.getHours()&&!ev.end_date.getMinutes()&&(ev.start_date.getHours()||ev.start_date.getMinutes()));}};scheduler.get_visible_events=function(only_timed){var stack=[];for(var id in this._events)
if(this.is_visible_events(this._events[id]))
if(!only_timed||this._events[id]._timed)
if(this.filter_event(id,this._events[id]))
stack.push(this._events[id]);return stack;};scheduler.filter_event=function(id,ev){var filter=this["filter_"+this._mode];return(filter)?filter(id,ev):true;};scheduler.render_view_data=function(evs,hold){if(!evs){if(this._not_render){this._render_wait=true;return;}
this._render_wait=false;this.clear_view();evs=this.get_visible_events(!(this._table_view||this.config.multi_day));}
if(this.config.multi_day&&!this._table_view){var tvs=[];var tvd=[];for(var i=0;i<evs.length;i++){if(evs[i]._timed)
tvs.push(evs[i]);else
tvd.push(evs[i]);}
this._rendered_location=this._els['dhx_multi_day'][0];this._table_view=true;this.render_data(tvd,hold);this._table_view=false;this._rendered_location=this._els['dhx_cal_data'][0];this._table_view=false;this.render_data(tvs,hold);}else{this._rendered_location=this._els['dhx_cal_data'][0];this.render_data(evs,hold);}};scheduler.render_data=function(evs,hold){evs=this._pre_render_events(evs,hold);for(var i=0;i<evs.length;i++)
if(this._table_view)
this.render_event_bar(evs[i]);else
this.render_event(evs[i]);};scheduler._pre_render_events=function(evs,hold){var hb=this.xy.bar_height;var h_old=this._colsS.heights;var h=this._colsS.heights=[0,0,0,0,0,0,0];var data=this._els["dhx_cal_data"][0];if(!this._table_view)
evs=this._pre_render_events_line(evs,hold);else
evs=this._pre_render_events_table(evs,hold);if(this._table_view){if(hold)
this._colsS.heights=h_old;else{var evl=data.firstChild;if(evl.rows){for(var i=0;i<evl.rows.length;i++){h[i]++;if((h[i])*hb>this._colsS.height-22){var cells=evl.rows[i].cells;for(var j=0;j<cells.length;j++){cells[j].childNodes[1].style.height=h[i]*hb+"px";}
h[i]=(h[i-1]||0)+cells[0].offsetHeight;}
h[i]=(h[i-1]||0)+evl.rows[i].cells[0].offsetHeight;}
h.unshift(0);if(evl.parentNode.offsetHeight<evl.parentNode.scrollHeight&&!evl._h_fix){for(var i=0;i<evl.rows.length;i++){var cell=evl.rows[i].cells[6].childNodes[0];var w=cell.offsetWidth-scheduler.xy.scroll_width+"px";cell.style.width=w;cell.nextSibling.style.width=w;}
evl._h_fix=true;}}else{if(!evs.length&&this._els["dhx_multi_day"][0].style.visibility=="visible")
h[0]=-1;if(evs.length||h[0]==-1){var childs=evl.parentNode.childNodes;var dh=((h[0]+1)*hb+1)+"px";data.style.top=(this._els["dhx_cal_navline"][0].offsetHeight+this._els["dhx_cal_header"][0].offsetHeight+parseInt(dh,10))+'px';data.style.height=(this._obj.offsetHeight-parseInt(data.style.top,10)-(this.xy.margin_top||0))+'px';var last=this._els["dhx_multi_day"][0];last.style.height=dh;last.style.visibility=(h[0]==-1?"hidden":"visible");last=this._els["dhx_multi_day"][1];last.style.height=dh;last.style.visibility=(h[0]==-1?"hidden":"visible");last.className=h[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small";this._dy_shift=(h[0]+1)*hb;h[0]=0;}}}}
return evs;};scheduler._get_event_sday=function(ev){return Math.floor((ev.start_date.valueOf()-this._min_date.valueOf())/(24*60*60*1000));};scheduler._get_event_mapped_end_date=function(ev){var end_date=ev.end_date;if(this.config.separate_short_events){var ev_duration=(ev.end_date-ev.start_date)/60000;if(ev_duration<this._min_mapped_duration){end_date=this.date.add(end_date,this._min_mapped_duration-ev_duration,"minute");}}
return end_date;};scheduler._pre_render_events_line=function(evs,hold){evs.sort(function(a,b){if(a.start_date.valueOf()==b.start_date.valueOf())
return a.id>b.id?1:-1;return a.start_date>b.start_date?1:-1;});var days=[];var evs_originals=[];this._min_mapped_duration=Math.ceil(this.xy.min_event_height*60/this.config.hour_size_px);for(var i=0;i<evs.length;i++){var ev=evs[i];var sd=ev.start_date;var ed=ev.end_date;var sh=sd.getHours();var eh=ed.getHours();ev._sday=this._get_event_sday(ev);if(!days[ev._sday])days[ev._sday]=[];if(!hold){ev._inner=false;var stack=days[ev._sday];while(stack.length){var t_ev=stack[stack.length-1];var t_end_date=this._get_event_mapped_end_date(t_ev);if(t_end_date.valueOf()<=ev.start_date.valueOf()){stack.splice(stack.length-1,1);}else{break;}}
var sorderSet=false;for(var j=0;j<stack.length;j++){var t_ev=stack[j];var t_end_date=this._get_event_mapped_end_date(t_ev);if(t_end_date.valueOf()<=ev.start_date.valueOf()){sorderSet=true;ev._sorder=t_ev._sorder;stack.splice(j,1);ev._inner=true;break;}}
if(stack.length)
stack[stack.length-1]._inner=true;if(!sorderSet){if(stack.length){if(stack.length<=stack[stack.length-1]._sorder){if(!stack[stack.length-1]._sorder)
ev._sorder=0;else
for(j=0;j<stack.length;j++){var _is_sorder=false;for(var k=0;k<stack.length;k++){if(stack[k]._sorder==j){_is_sorder=true;break;}}
if(!_is_sorder){ev._sorder=j;break;}}
ev._inner=true;}else{var _max_sorder=stack[0]._sorder;for(j=1;j<stack.length;j++){if(stack[j]._sorder>_max_sorder)
_max_sorder=stack[j]._sorder;}
ev._sorder=_max_sorder+1;ev._inner=false;}}else
ev._sorder=0;}
stack.push(ev);if(stack.length>(stack.max_count||0)){stack.max_count=stack.length;ev._count=stack.length;}else{ev._count=(ev._count)?ev._count:1;}}
if(sh<this.config.first_hour||eh>=this.config.last_hour){evs_originals.push(ev);evs[i]=ev=this._copy_event(ev);if(sh<this.config.first_hour){ev.start_date.setHours(this.config.first_hour);ev.start_date.setMinutes(0);}
if(eh>=this.config.last_hour){ev.end_date.setMinutes(0);ev.end_date.setHours(this.config.last_hour);}
if(ev.start_date>ev.end_date||sh==this.config.last_hour){evs.splice(i,1);i--;continue;}}}
if(!hold){for(var i=0;i<evs.length;i++){evs[i]._count=days[evs[i]._sday].max_count;}
for(var i=0;i<evs_originals.length;i++)
evs_originals[i]._count=days[evs_originals[i]._sday].max_count;}
return evs;};scheduler._time_order=function(evs){evs.sort(function(a,b){if(a.start_date.valueOf()==b.start_date.valueOf()){if(a._timed&&!b._timed)return 1;if(!a._timed&&b._timed)return-1;return a.id>b.id?1:-1;}
return a.start_date>b.start_date?1:-1;});};scheduler._pre_render_events_table=function(evs,hold){this._time_order(evs);var out=[];var weeks=[[],[],[],[],[],[],[]];var max=this._colsS.heights;var start_date;var cols=this._cols.length;var chunks_info={};for(var i=0;i<evs.length;i++){var ev=evs[i];var id=ev.id;if(!chunks_info[id]){chunks_info[id]={first_chunk:true,last_chunk:true};}
var chunk_info=chunks_info[id];var sd=(start_date||ev.start_date);var ed=ev.end_date;if(sd<this._min_date){chunk_info.first_chunk=false;sd=this._min_date;}
if(ed>this._max_date){chunk_info.last_chunk=false;ed=this._max_date;}
var locate_s=this.locate_holder_day(sd,false,ev);ev._sday=locate_s%cols;var locate_e=this.locate_holder_day(ed,true,ev)||cols;ev._eday=(locate_e%cols)||cols;ev._length=locate_e-locate_s;ev._sweek=Math.floor((this._correct_shift(sd.valueOf(),1)-this._min_date.valueOf())/(60*60*1000*24*cols));var stack=weeks[ev._sweek];var stack_line;for(stack_line=0;stack_line<stack.length;stack_line++)
if(stack[stack_line]._eday<=ev._sday)
break;if(!ev._sorder||!hold){ev._sorder=stack_line;}
if(ev._sday+ev._length<=cols){start_date=null;out.push(ev);stack[stack_line]=ev;max[ev._sweek]=stack.length-1;ev._first_chunk=chunk_info.first_chunk;ev._last_chunk=chunk_info.last_chunk;}else{var copy=this._copy_event(ev);copy.id=ev.id;copy._length=cols-ev._sday;copy._eday=cols;copy._sday=ev._sday;copy._sweek=ev._sweek;copy._sorder=ev._sorder;copy.end_date=this.date.add(sd,copy._length,"day");copy._first_chunk=chunk_info.first_chunk;if(chunk_info.first_chunk){chunk_info.first_chunk=false;}
out.push(copy);stack[stack_line]=copy;start_date=copy.end_date;max[ev._sweek]=stack.length-1;i--;continue;}}
return out;};scheduler._copy_dummy=function(){var a=new Date(this.start_date);var b=new Date(this.end_date);this.start_date=a;this.end_date=b;};scheduler._copy_event=function(ev){this._copy_dummy.prototype=ev;return new this._copy_dummy();};scheduler._rendered=[];scheduler.clear_view=function(){for(var i=0;i<this._rendered.length;i++){var obj=this._rendered[i];if(obj.parentNode)obj.parentNode.removeChild(obj);}
this._rendered=[];};scheduler.updateEvent=function(id){var ev=this.getEvent(id);this.clear_event(id);if(ev&&this.is_visible_events(ev)&&this.filter_event(id,ev)&&(this._table_view||this.config.multi_day||ev._timed)){if(this.config.update_render)
this.render_view_data();else
this.render_view_data([ev],true);}};scheduler.clear_event=function(id){this.for_rendered(id,function(node,i){if(node.parentNode)
node.parentNode.removeChild(node);scheduler._rendered.splice(i,1);});};scheduler.render_event=function(ev){var menu=scheduler.xy.menu_width;if(ev._sday<0)return;var parent=scheduler.locate_holder(ev._sday);if(!parent)return;var sm=ev.start_date.getHours()*60+ev.start_date.getMinutes();var em=(ev.end_date.getHours()*60+ev.end_date.getMinutes())||(scheduler.config.last_hour*60);var ev_count=ev._count||1;var ev_sorder=ev._sorder||0;var top=(Math.round((sm*60*1000-this.config.first_hour*60*60*1000)*this.config.hour_size_px/(60*60*1000)))%(this.config.hour_size_px*24);var height=Math.max(scheduler.xy.min_event_height,(em-sm)*this.config.hour_size_px/60);var width=Math.floor((parent.clientWidth-menu)/ev_count);var left=ev_sorder*width+1;if(!ev._inner)width=width*(ev_count-ev_sorder);if(this.config.cascade_event_display){var limit=this.config.cascade_event_count;var margin=this.config.cascade_event_margin;left=ev_sorder%limit*margin;var right=(ev._inner)?(ev_count-ev_sorder-1)%limit*margin/2:0;width=Math.floor(parent.clientWidth-menu-left-right);}
var d=this._render_v_bar(ev.id,menu+left,top,width,height,ev._text_style,scheduler.templates.event_header(ev.start_date,ev.end_date,ev),scheduler.templates.event_text(ev.start_date,ev.end_date,ev));this._rendered.push(d);parent.appendChild(d);left=left+parseInt(parent.style.left,10)+menu;if(this._edit_id==ev.id){d.style.zIndex=1;width=Math.max(width-4,scheduler.xy.editor_width);d=document.createElement("DIV");d.setAttribute("event_id",ev.id);this.set_xy(d,width,height-20,left,top+14);d.className="dhx_cal_editor";var d2=document.createElement("DIV");this.set_xy(d2,width-6,height-26);d2.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;";d.appendChild(d2);this._els["dhx_cal_data"][0].appendChild(d);this._rendered.push(d);d2.innerHTML="<textarea class='dhx_cal_editor'>"+ev.text+"</textarea>";if(this._quirks7)d2.firstChild.style.height=height-12+"px";this._editor=d2.firstChild;this._editor.onkeydown=function(e){if((e||event).shiftKey)return true;var code=(e||event).keyCode;if(code==scheduler.keys.edit_save)scheduler.editStop(true);if(code==scheduler.keys.edit_cancel)scheduler.editStop(false);};this._editor.onselectstart=function(e){return(e||event).cancelBubble=true;};d2.firstChild.focus();this._els["dhx_cal_data"][0].scrollLeft=0;d2.firstChild.select();}
if(this.xy.menu_width!==0&&this._select_id==ev.id){if(this.config.cascade_event_display&&this._drag_mode)
d.style.zIndex=1;var icons=this.config["icons_"+((this._edit_id==ev.id)?"edit":"select")];var icons_str="";var bg_color=(ev.color?("background-color: "+ev.color+";"):"");var color=(ev.textColor?("color: "+ev.textColor+";"):"");for(var i=0;i<icons.length;i++)
icons_str+="<div class='dhx_menu_icon "+icons[i]+"' style='"+bg_color+""+color+"' title='"+this.locale.labels[icons[i]]+"'></div>";var obj=this._render_v_bar(ev.id,left-menu+1,top,menu,icons.length*20+26-2,"","<div style='"+bg_color+""+color+"' class='dhx_menu_head'></div>",icons_str,true);obj.style.left=left-menu+1;this._els["dhx_cal_data"][0].appendChild(obj);this._rendered.push(obj);}};scheduler._render_v_bar=function(id,x,y,w,h,style,contentA,contentB,bottom){var d=document.createElement("DIV");var ev=this.getEvent(id);var cs=(bottom)?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event";var cse=scheduler.templates.event_class(ev.start_date,ev.end_date,ev);if(cse)cs=cs+" "+cse;var bg_color=(ev.color?("background:"+ev.color+";"):"");var color=(ev.textColor?("color:"+ev.textColor+";"):"");var html='<div event_id="'+id+'" class="'+cs+'" style="position:absolute; top:'+y+'px; left:'+x+'px; width:'+(w-4)+'px; height:'+h+'px;'+(style||"")+'"></div>';d.innerHTML=html;var container=d.cloneNode(true).firstChild;if(scheduler.renderEvent&&!bottom&&scheduler.renderEvent(container,ev)){return container;}else{container=d.firstChild;var inner_html='<div class="dhx_event_move dhx_header" style=" width:'+(w-6)+'px;'+bg_color+'" >&nbsp;</div>';inner_html+='<div class="dhx_event_move dhx_title" style="'+bg_color+''+color+'">'+contentA+'</div>';inner_html+='<div class="dhx_body" style=" width:'+(w-(this._quirks?4:14))+'px; height:'+(h-(this._quirks?20:30)+1)+'px;'+bg_color+''+color+'">'+contentB+'</div>';var footer_class="dhx_event_resize dhx_footer";if(bottom)
footer_class="dhx_resize_denied "+footer_class;inner_html+='<div class="'+footer_class+'" style=" width:'+(w-8)+'px;'+(bottom?' margin-top:-1px;':'')+''+bg_color+''+color+'" ></div>';container.innerHTML=inner_html;}
return container;};scheduler.locate_holder=function(day){if(this._mode=="day")return this._els["dhx_cal_data"][0].firstChild;return this._els["dhx_cal_data"][0].childNodes[day];};scheduler.locate_holder_day=function(date,past){var day=Math.floor((this._correct_shift(date,1)-this._min_date)/(60*60*24*1000));if(past&&this.date.time_part(date))day++;return day;};scheduler.render_event_bar=function(ev){var parent=this._rendered_location;var x=this._colsS[ev._sday];var x2=this._colsS[ev._eday];if(x2==x)x2=this._colsS[ev._eday+1];var hb=this.xy.bar_height;var y=this._colsS.heights[ev._sweek]+(this._colsS.height?(this.xy.month_scale_height+2):2)+(ev._sorder*hb);var d=document.createElement("DIV");var cs="dhx_cal_event_clear";if(!ev._timed){cs="dhx_cal_event_line";if(ev.hasOwnProperty("_first_chunk")&&ev._first_chunk)
cs+=" dhx_cal_event_line_start";if(ev.hasOwnProperty("_last_chunk")&&ev._last_chunk)
cs+=" dhx_cal_event_line_end";}
var cse=scheduler.templates.event_class(ev.start_date,ev.end_date,ev);if(cse)cs=cs+" "+cse;var bg_color=(ev.color?("background:"+ev.color+";"):"");var color=(ev.textColor?("color:"+ev.textColor+";"):"");var html='<div event_id="'+ev.id+'" class="'+cs+'" style="position:absolute; top:'+y+'px; left:'+x+'px; width:'+(x2-x-15)+'px;'+color+''+bg_color+''+(ev._text_style||"")+'">';ev=scheduler.getEvent(ev.id);if(ev._timed)
html+=scheduler.templates.event_bar_date(ev.start_date,ev.end_date,ev);html+=scheduler.templates.event_bar_text(ev.start_date,ev.end_date,ev)+'</div>';html+='</div>';d.innerHTML=html;this._rendered.push(d.firstChild);parent.appendChild(d.firstChild);};scheduler._locate_event=function(node){var id=null;while(node&&!id&&node.getAttribute){id=node.getAttribute("event_id");node=node.parentNode;}
return id;};scheduler.edit=function(id){if(this._edit_id==id)return;this.editStop(false,id);this._edit_id=id;this.updateEvent(id);};scheduler.editStop=function(mode,id){if(id&&this._edit_id==id)return;var ev=this.getEvent(this._edit_id);if(ev){if(mode)ev.text=this._editor.value;this._edit_id=null;this._editor=null;this.updateEvent(ev.id);this._edit_stop_event(ev,mode);}};scheduler._edit_stop_event=function(ev,mode){if(this._new_event){if(!mode){if(ev)
this.deleteEvent(ev.id,true);}else{this.callEvent("onEventAdded",[ev.id,ev]);}
this._new_event=null;}else{if(mode)
this.callEvent("onEventChanged",[ev.id,ev]);}};scheduler.getEvents=function(from,to){var result=[];for(var a in this._events){var ev=this._events[a];if(ev&&((!from&&!to)||(ev.start_date<to&&ev.end_date>from)))
result.push(ev);}
return result;};scheduler.getRenderedEvent=function(id){if(!id)
return;var rendered_events=scheduler._rendered;for(var i=0;i<rendered_events.length;i++){var rendered_event=rendered_events[i];if(rendered_event.getAttribute("event_id")==id){return rendered_event;}}
return null;};scheduler.showEvent=function(id,mode){var ev=(typeof id=="number"||typeof id=="string")?scheduler.getEvent(id):id;mode=mode||scheduler._mode;if(!ev||(this.checkEvent("onBeforeEventDisplay")&&!this.callEvent("onBeforeEventDisplay",[ev,mode])))
return;var scroll_hour=scheduler.config.scroll_hour;scheduler.config.scroll_hour=ev.start_date.getHours();var preserve_scroll=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=false;var original_color=ev.color;var original_text_color=ev.textColor;if(scheduler.config.highlight_displayed_event){ev.color=scheduler.config.displayed_event_color;ev.textColor=scheduler.config.displayed_event_text_color;}
scheduler.setCurrentView(new Date(ev.start_date),mode);ev.color=original_color;ev.textColor=original_text_color;scheduler.config.scroll_hour=scroll_hour;scheduler.config.preserve_scroll=preserve_scroll;if(scheduler.matrix&&scheduler.matrix[mode]){scheduler._els["dhx_cal_data"][0].scrollTop=getAbsoluteTop(scheduler.getRenderedEvent(ev.id));}
scheduler.callEvent("onAfterEventDisplay",[ev,mode]);};scheduler._loaded={};scheduler._load=function(url,from){url=url||this._load_url;url+=(url.indexOf("?")==-1?"?":"&")+"timeshift="+(new Date()).getTimezoneOffset();if(this.config.prevent_cache)url+="&uid="+this.uid();var to;from=from||this._date;if(this._load_mode){var lf=this.templates.load_format;from=this.date[this._load_mode+"_start"](new Date(from.valueOf()));while(from>this._min_date)from=this.date.add(from,-1,this._load_mode);to=from;var cache_line=true;while(to<this._max_date){to=this.date.add(to,1,this._load_mode);if(this._loaded[lf(from)]&&cache_line)
from=this.date.add(from,1,this._load_mode);else cache_line=false;}
var temp_to=to;do{to=temp_to;temp_to=this.date.add(to,-1,this._load_mode);}while(temp_to>from&&this._loaded[lf(temp_to)]);if(to<=from)
return false;dhtmlxAjax.get(url+"&from="+lf(from)+"&to="+lf(to),function(l){scheduler.on_load(l);});while(from<to){this._loaded[lf(from)]=true;from=this.date.add(from,1,this._load_mode);}}else
dhtmlxAjax.get(url,function(l){scheduler.on_load(l);});this.callEvent("onXLS",[]);return true;};scheduler.on_load=function(loader){var evs;if(this._process)
evs=this[this._process].parse(loader.xmlDoc.responseText);else
evs=this._magic_parser(loader);scheduler._process_loading(evs);this.callEvent("onXLE",[]);};scheduler._process_loading=function(evs){this._loading=true;this._not_render=true;for(var i=0;i<evs.length;i++){if(!this.callEvent("onEventLoading",[evs[i]]))continue;this.addEvent(evs[i]);}
this._not_render=false;if(this._render_wait)this.render_view_data();this._loading=false;if(this._after_call)this._after_call();this._after_call=null;};scheduler.json={};scheduler.json.parse=function(data){if(typeof data=="string"){scheduler._temp=eval("("+data+")");data=(scheduler._temp)?scheduler._temp.data||scheduler._temp:[];}
if(data.dhx_security)
dhtmlx.security_key=data.dhx_security;var collections=(scheduler._temp&&scheduler._temp.collections)?scheduler._temp.collections:{};var collections_loaded=false;for(var key in collections){if(collections.hasOwnProperty(key)){collections_loaded=true;var collection=collections[key];var arr=scheduler.serverList[key];if(!arr)continue;arr.splice(0,arr.length);for(var j=0;j<collection.length;j++){var option=collection[j];var obj={key:option.value,label:option.label};for(var option_key in option){if(option.hasOwnProperty(option_key)){if(option_key=="value"||option_key=="label")
continue;obj[option_key]=option[option_key];}}
arr.push(obj);}}}
if(collections_loaded)
scheduler.callEvent("onOptionsLoad",[]);var evs=[];for(var i=0;i<data.length;i++){data[i].start_date=scheduler.templates.xml_date(data[i].start_date);data[i].end_date=scheduler.templates.xml_date(data[i].end_date);evs.push(data[i]);}
return evs;};scheduler.parse=function(data,type){this._process=type;this.on_load({xmlDoc:{responseText:data}});};scheduler.load=function(url,call){if(typeof call=="string"){this._process=call;call=arguments[2];}
this._load_url=url;this._after_call=call;this._load(url,this._date);};scheduler.setLoadMode=function(mode){if(mode=="all")mode="";this._load_mode=mode;};scheduler.refresh=function(refresh_all){alert("not implemented");};scheduler.serverList=function(name,array){if(array){return this.serverList[name]=array.slice(0);}
return this.serverList[name]=(this.serverList[name]||[]);};scheduler._userdata={};scheduler._magic_parser=function(loader){var xml;if(!loader.getXMLTopNode){var xml_string=loader.xmlDoc.responseText;loader=new dtmlXMLLoaderObject(function(){});loader.loadXMLString(xml_string);}
xml=loader.getXMLTopNode("data");if(xml.tagName!="data")return[];var skey=xml.getAttribute("dhx_security");if(skey)
dhtmlx.security_key=skey;var opts=loader.doXPath("//coll_options");for(var i=0;i<opts.length;i++){var bind=opts[i].getAttribute("for");var arr=this.serverList[bind];if(!arr)continue;arr.splice(0,arr.length);var itms=loader.doXPath(".//item",opts[i]);for(var j=0;j<itms.length;j++){var itm=itms[j];var attrs=itm.attributes;var obj={key:itms[j].getAttribute("value"),label:itms[j].getAttribute("label")};for(var k=0;k<attrs.length;k++){var attr=attrs[k];if(attr.nodeName=="value"||attr.nodeName=="label")
continue;obj[attr.nodeName]=attr.nodeValue;}
arr.push(obj);}}
if(opts.length)
scheduler.callEvent("onOptionsLoad",[]);var ud=loader.doXPath("//userdata");for(var i=0;i<ud.length;i++){var udx=this.xmlNodeToJSON(ud[i]);this._userdata[udx.name]=udx.text;}
var evs=[];xml=loader.doXPath("//event");for(var i=0;i<xml.length;i++){evs[i]=this.xmlNodeToJSON(xml[i]);evs[i].text=evs[i].text||evs[i]._tagvalue;evs[i].start_date=this.templates.xml_date(evs[i].start_date);evs[i].end_date=this.templates.xml_date(evs[i].end_date);}
return evs;};scheduler.xmlNodeToJSON=function(node){var t={};for(var i=0;i<node.attributes.length;i++)
t[node.attributes[i].name]=node.attributes[i].value;for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];if(child.nodeType==1)
t[child.tagName]=child.firstChild?child.firstChild.nodeValue:"";}
if(!t.text)t.text=node.firstChild?node.firstChild.nodeValue:"";return t;};scheduler.attachEvent("onXLS",function(){if(this.config.show_loading===true){var t;t=this.config.show_loading=document.createElement("DIV");t.className='dhx_loading';t.style.left=Math.round((this._x-128)/2)+"px";t.style.top=Math.round((this._y-15)/2)+"px";this._obj.appendChild(t);}});scheduler.attachEvent("onXLE",function(){var t;if(t=this.config.show_loading)
if(typeof t=="object"){this._obj.removeChild(t);this.config.show_loading=true;}});scheduler.ical={parse:function(str){var data=str.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(!data.length)return;data[0]=data[0].replace(/[\r\n]+(?=[a-z \t])/g," ");data[0]=data[0].replace(/\;[^:\r\n]*/g,"");var incoming=[];var match;var event_r=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");while(match=event_r.exec(data)){var e={};var param;var param_r=/[^\r\n]+[\r\n]+/g;while(param=param_r.exec(match[1]))
this.parse_param(param.toString(),e);if(e.uid&&!e.id)e.id=e.uid;incoming.push(e);}
return incoming;},parse_param:function(str,obj){var d=str.indexOf(":");if(d==-1)return;var name=str.substr(0,d).toLowerCase();var value=str.substr(d+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");if(name=="summary")
name="text";else if(name=="dtstart"){name="start_date";value=this.parse_date(value,0,0);}
else if(name=="dtend"){name="end_date";value=this.parse_date(value,0,0);}
obj[name]=value;},parse_date:function(value,dh,dm){var t=value.split("T");if(t[1]){dh=t[1].substr(0,2);dm=t[1].substr(2,2);}
var dy=t[0].substr(0,4);var dn=parseInt(t[0].substr(4,2),10)-1;var dd=t[0].substr(6,2);if(scheduler.config.server_utc&&!t[1]){return new Date(Date.UTC(dy,dn,dd,dh,dm));}
return new Date(dy,dn,dd,dh,dm);},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"};scheduler.lightbox={};scheduler.formSection=function(name){var config=this.config.lightbox.sections;var i=0;for(i;i<config.length;i++)
if(config[i].name==name)
break;var section=config[i];if(!scheduler._lightbox)
scheduler.getLightbox();var header=document.getElementById(section.id);var node=header.nextSibling;var result={section:section,header:header,node:node,getValue:function(ev){return scheduler.form_blocks[section.type].get_value(node,(ev||{}),section);},setValue:function(value,ev){return scheduler.form_blocks[section.type].set_value(node,value,(ev||{}),section);}};var handler=scheduler.lightbox["get_"+section.type+"_control"];return handler?handler(result):result;};scheduler.lightbox.get_template_control=function(result){result.control=result.node;return result;};scheduler.lightbox.get_select_control=function(result){result.control=result.node.getElementsByTagName('select')[0];return result;};scheduler.lightbox.get_textarea_control=function(result){result.control=result.node.getElementsByTagName('textarea')[0];return result;};scheduler.lightbox.get_time_control=function(result){result.control=result.node.getElementsByTagName('select');return result;};scheduler.form_blocks={template:{render:function(sns){var height=(sns.height||"30")+"px";return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+height+";'></div>";},set_value:function(node,value,ev,config){node.innerHTML=value||"";},get_value:function(node,ev,config){return node.innerHTML||"";},focus:function(node){}},textarea:{render:function(sns){var height=(sns.height||"130")+"px";return"<div class='dhx_cal_ltext' style='height:"+height+";'><textarea></textarea></div>";},set_value:function(node,value,ev){node.firstChild.value=value||"";},get_value:function(node,ev){return node.firstChild.value;},focus:function(node){var a=node.firstChild;a.select();a.focus();}},select:{render:function(sns){var height=(sns.height||"23")+"px";var html="<div class='dhx_cal_ltext' style='height:"+height+";'><select style='width:100%;'>";for(var i=0;i<sns.options.length;i++)
html+="<option value='"+sns.options[i].key+"'>"+sns.options[i].label+"</option>";html+="</select></div>";return html;},set_value:function(node,value,ev,sns){var select=node.firstChild;if(!select._dhx_onchange&&sns.onchange){select.onchange=sns.onchange;select._dhx_onchange=true;}
if(typeof value=="undefined")
value=(select.options[0]||{}).value;select.value=value||"";},get_value:function(node,ev){return node.firstChild.value;},focus:function(node){var a=node.firstChild;if(a.select)a.select();a.focus();}},time:{render:function(sns){var cfg=scheduler.config;var dt=this.date.date_part(new Date());var last=24*60,first=0;if(scheduler.config.limit_time_select){last=60*cfg.last_hour+1;first=60*cfg.first_hour;dt.setHours(cfg.first_hour);}
var html="<select>";var i=first;var tdate=dt.getDate();sns._time_values=[];while(i<last){var time=this.templates.time_picker(dt);html+="<option value='"+i+"'>"+time+"</option>";sns._time_values.push(i);dt.setTime(dt.valueOf()+this.config.time_step*60*1000);var diff=(dt.getDate()!=tdate)?1:0;i=diff*24*60+dt.getHours()*60+dt.getMinutes();}
html+="</select> <select>";for(var i=1;i<32;i++)
html+="<option value='"+i+"'>"+i+"</option>";html+="</select> <select>";for(var i=0;i<12;i++)
html+="<option value='"+i+"'>"+this.locale.date.month_full[i]+"</option>";html+="</select> <select>";dt=dt.getFullYear()-5;for(var i=0;i<10;i++)
html+="<option value='"+(dt+i)+"'>"+(dt+i)+"</option>";html+="</select> ";return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+html+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+html+"</div>";},set_value:function(node,value,ev,config){var cfg=scheduler.config;var s=node.getElementsByTagName("select");if(cfg.full_day){if(!node._full_day){var html="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";if(!scheduler.config.wide_form)
html=node.previousSibling.innerHTML+html;node.previousSibling.innerHTML=html;node._full_day=true;}
var input=node.previousSibling.getElementsByTagName("input")[0];input.checked=(scheduler.date.time_part(ev.start_date)===0&&scheduler.date.time_part(ev.end_date)===0);s[0].disabled=input.checked;s[s.length/2].disabled=input.checked;input.onclick=function(){if(input.checked){var obj={};scheduler.form_blocks.time.get_value(node,obj);var start_date=scheduler.date.date_part(obj.start_date);var end_date=scheduler.date.date_part(obj.end_date);if(+end_date==+start_date||(+end_date>=+start_date&&(ev.end_date.getHours()!=0||ev.end_date.getMinutes()!=0)))
end_date=scheduler.date.add(end_date,1,"day");}
s[0].disabled=input.checked;s[s.length/2].disabled=input.checked;_fill_lightbox_select(s,0,start_date||ev.start_date);_fill_lightbox_select(s,4,end_date||ev.end_date);};}
if(cfg.auto_end_date&&cfg.event_duration){function _update_lightbox_select(){var start_date=new Date(s[3].value,s[2].value,s[1].value,0,s[0].value);var end_date=new Date(start_date.getTime()+(scheduler.config.event_duration*60*1000));_fill_lightbox_select(s,4,end_date);}
for(var i=0;i<4;i++){s[i].onchange=_update_lightbox_select;}}
function _fill_lightbox_select(s,i,d){var time_values=config._time_values;var direct_value=d.getHours()*60+d.getMinutes();var fixed_value=direct_value;var value_found=false;for(var k=0;k<time_values.length;k++){var t_v=time_values[k];if(t_v===direct_value){value_found=true;break;}
if(t_v<direct_value)
fixed_value=t_v;}
s[i+0].value=(value_found)?direct_value:fixed_value;s[i+1].value=d.getDate();s[i+2].value=d.getMonth();s[i+3].value=d.getFullYear();}
_fill_lightbox_select(s,0,ev.start_date);_fill_lightbox_select(s,4,ev.end_date);},get_value:function(node,ev){s=node.getElementsByTagName("select");ev.start_date=new Date(s[3].value,s[2].value,s[1].value,0,s[0].value);ev.end_date=new Date(s[7].value,s[6].value,s[5].value,0,s[4].value);if(ev.end_date<=ev.start_date)
ev.end_date=scheduler.date.add(ev.start_date,scheduler.config.time_step,"minute");return{start_date:new Date(ev.start_date),end_date:new Date(ev.end_date)};},focus:function(node){node.getElementsByTagName("select")[0].focus();}}};scheduler.showCover=function(box){if(box){box.style.display="block";var scroll_top=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;var scroll_left=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;var view_height=window.innerHeight||document.documentElement.clientHeight;if(scroll_top)
box.style.top=Math.round(scroll_top+Math.max((view_height-box.offsetHeight)/2,0))+"px";else
box.style.top=Math.round(Math.max(((view_height-box.offsetHeight)/2),0)+9)+"px";if(document.documentElement.scrollWidth>document.body.offsetWidth)
box.style.left=Math.round(scroll_left+(document.body.offsetWidth-box.offsetWidth)/2)+"px";else
box.style.left=Math.round((document.body.offsetWidth-box.offsetWidth)/2)+"px";}
this.show_cover();};scheduler.showLightbox=function(id){if(!id)return;if(!this.callEvent("onBeforeLightbox",[id])){if(this._new_event)
this._new_event=null;return;}
var box=this.getLightbox();this.showCover(box);this._fill_lightbox(id,box);this.callEvent("onLightbox",[id]);};scheduler._fill_lightbox=function(id,box){var ev=this.getEvent(id);var s=box.getElementsByTagName("span");if(scheduler.templates.lightbox_header){s[1].innerHTML="";s[2].innerHTML=scheduler.templates.lightbox_header(ev.start_date,ev.end_date,ev);}else{s[1].innerHTML=this.templates.event_header(ev.start_date,ev.end_date,ev);s[2].innerHTML=(this.templates.event_bar_text(ev.start_date,ev.end_date,ev)||"").substr(0,70);}
var sns=this.config.lightbox.sections;for(var i=0;i<sns.length;i++){var current_sns=sns[i];var node=document.getElementById(current_sns.id).nextSibling;var block=this.form_blocks[current_sns.type];var value=(ev[current_sns.map_to]!==undefined)?ev[current_sns.map_to]:current_sns.default_value;block.set_value.call(this,node,value,ev,current_sns);if(sns[i].focus)
block.focus.call(this,node);}
scheduler._lightbox_id=id;};scheduler._lightbox_out=function(ev){var sns=this.config.lightbox.sections;for(var i=0;i<sns.length;i++){var node=document.getElementById(sns[i].id);node=(node?node.nextSibling:node);var block=this.form_blocks[sns[i].type];var res=block.get_value.call(this,node,ev,sns[i]);if(sns[i].map_to!="auto")
ev[sns[i].map_to]=res;}
return ev;};scheduler._empty_lightbox=function(data){var id=scheduler._lightbox_id;var ev=this.getEvent(id);var box=this.getLightbox();this._lame_copy(ev,data);ev._timed=this.is_one_day_event(ev);this.setEvent(ev.id,ev);this._edit_stop_event(ev,true);this.render_view_data();};scheduler.hide_lightbox=function(id){this.hideCover(this.getLightbox());this._lightbox_id=null;this.callEvent("onAfterLightbox",[]);};scheduler.hideCover=function(box){if(box)box.style.display="none";this.hide_cover();};scheduler.hide_cover=function(){if(this._cover)
this._cover.parentNode.removeChild(this._cover);this._cover=null;};scheduler.show_cover=function(){this._cover=document.createElement("DIV");this._cover.className="dhx_cal_cover";var _document_height=((document.height!==undefined)?document.height:document.body.offsetHeight);var _scroll_height=((document.documentElement)?document.documentElement.scrollHeight:0);this._cover.style.height=Math.max(_document_height,_scroll_height)+'px';document.body.appendChild(this._cover);};scheduler.save_lightbox=function(){var data=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));if(this.checkEvent("onEventSave")&&!this.callEvent("onEventSave",[this._lightbox_id,data,this._new_event]))
return;this._empty_lightbox(data);this.hide_lightbox();};scheduler.startLightbox=function(id,box){this._lightbox_id=id;this._lightbox=box;this.showCover(box);};scheduler.endLightbox=function(mode,box){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),mode);if(mode)
scheduler.render_view_data();this.hideCover(box);this._lightbox_id=null;};scheduler.resetLightbox=function(){if(scheduler._lightbox)
scheduler._lightbox.parentNode.removeChild(scheduler._lightbox);scheduler._lightbox=null;};scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]);this.endLightbox(false);this.hide_lightbox();};scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(e){var src=e?e.target:event.srcElement;if(!src.className)src=src.previousSibling;if(src&&src.className)
switch(src.className){case"dhx_save_btn":scheduler.save_lightbox();break;case"dhx_delete_btn":var c=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(c,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id);scheduler._new_event=null;scheduler.hide_lightbox();});break;case"dhx_cancel_btn":scheduler.cancel_lightbox();break;default:if(src.getAttribute("dhx_button")){scheduler.callEvent("onLightboxButton",[src.className,src,e]);}else{var index,block,sec;if(src.className.indexOf("dhx_custom_button")!=-1){if(src.className.indexOf("dhx_custom_button_")!=-1){index=src.parentNode.getAttribute("index");sec=src.parentNode.parentNode;}else{index=src.getAttribute("index");sec=src.parentNode;src=src.firstChild;}}
if(index){block=scheduler.form_blocks[scheduler.config.lightbox.sections[index].type];block.button_click(index,src,sec,sec.nextSibling);}}
break;}};this.getLightbox().onkeydown=function(e){switch((e||event).keyCode){case scheduler.keys.edit_save:if((e||event).shiftKey)return;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox();break;default:break;}};};scheduler.setLightboxSize=function(){var d=this._lightbox;if(!d)return;var con=d.childNodes[1];con.style.height="0px";con.style.height=con.scrollHeight+"px";d.style.height=con.scrollHeight+scheduler.xy.lightbox_additional_height+"px";con.style.height=con.scrollHeight+"px";};scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd);dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd);scheduler._init_dnd_events=function(){};};scheduler._move_while_dnd=function(e){if(scheduler._dnd_start_lb){if(!document.dhx_unselectable){document.body.className+=" dhx_unselectable";document.dhx_unselectable=true;}
var lb=scheduler.getLightbox();var now=(e&&e.target)?[e.pageX,e.pageY]:[event.clientX,event.clientY];lb.style.top=scheduler._lb_start[1]+now[1]-scheduler._dnd_start_lb[1]+"px";lb.style.left=scheduler._lb_start[0]+now[0]-scheduler._dnd_start_lb[0]+"px";}};scheduler._ready_to_dnd=function(e){var lb=scheduler.getLightbox();scheduler._lb_start=[parseInt(lb.style.left,10),parseInt(lb.style.top,10)];scheduler._dnd_start_lb=(e&&e.target)?[e.pageX,e.pageY]:[event.clientX,event.clientY];};scheduler._finish_dnd=function(){if(scheduler._lb_start){scheduler._lb_start=scheduler._dnd_start_lb=false;document.body.className=document.body.className.replace(" dhx_unselectable","");document.dhx_unselectable=false;}};scheduler.getLightbox=function(){if(!this._lightbox){var d=document.createElement("DIV");d.className="dhx_cal_light";if(scheduler.config.wide_form)
d.className+=" dhx_cal_light_wide";if(scheduler.form_blocks.recurring)
d.className+=" dhx_cal_light_rec";if(/msie|MSIE 6/.test(navigator.userAgent))
d.className+=" dhx_ie6";d.style.visibility="hidden";var html=this._lightbox_template;var buttons=this.config.buttons_left;for(var i=0;i<buttons.length;i++)
html+="<div class='dhx_btn_set dhx_left_btn_set "+buttons[i]+"_set'><div dhx_button='1' class='"+buttons[i]+"'></div><div>"+scheduler.locale.labels[buttons[i]]+"</div></div>";buttons=this.config.buttons_right;for(var i=0;i<buttons.length;i++)
html+="<div class='dhx_btn_set dhx_right_btn_set "+buttons[i]+"_set' style='float:right;'><div dhx_button='1' class='"+buttons[i]+"'></div><div>"+scheduler.locale.labels[buttons[i]]+"</div></div>";html+="</div>";d.innerHTML=html;if(scheduler.config.drag_lightbox){d.firstChild.onmousedown=scheduler._ready_to_dnd;d.firstChild.onselectstart=function(){return false;};d.firstChild.style.cursor="pointer";scheduler._init_dnd_events();}
document.body.insertBefore(d,document.body.firstChild);this._lightbox=d;var sns=this.config.lightbox.sections;html="";for(var i=0;i<sns.length;i++){var block=this.form_blocks[sns[i].type];if(!block)continue;sns[i].id="area_"+this.uid();var button="";if(sns[i].button){button="<div class='dhx_custom_button' index='"+i+"'><div class='dhx_custom_button_"+sns[i].button+"'></div><div>"+this.locale.labels["button_"+sns[i].button]+"</div></div>";}
if(this.config.wide_form){html+="<div class='dhx_wrap_section'>";}
html+="<div id='"+sns[i].id+"' class='dhx_cal_lsection'>"+button+this.locale.labels["section_"+sns[i].name]+"</div>"+block.render.call(this,sns[i]);html+="</div>"}
var ds=d.getElementsByTagName("div");for(var i=0;i<ds.length;i++){var t_ds=ds[i];if(t_ds.className=="dhx_cal_larea"){t_ds.innerHTML=html;break;}}
this.setLightboxSize();this._init_lightbox_events(this);d.style.display="none";d.style.visibility="visible";}
return this._lightbox;};scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>";scheduler._dp_init=function(dp){dp._methods=["setEventTextStyle","","changeEventId","deleteEvent"];this.attachEvent("onEventAdded",function(id){if(!this._loading&&this.validId(id))
dp.setUpdated(id,true,"inserted");});this.attachEvent("onConfirmedBeforeEventDelete",function(id){if(!this.validId(id))return;var z=dp.getState(id);if(z=="inserted"||this._new_event){dp.setUpdated(id,false);return true;}
if(z=="deleted")return false;if(z=="true_deleted")return true;dp.setUpdated(id,true,"deleted");return false;});this.attachEvent("onEventChanged",function(id){if(!this._loading&&this.validId(id))
dp.setUpdated(id,true,"updated");});dp._getRowData=function(id,pref){var ev=this.obj.getEvent(id);var data={};for(var a in ev){if(a.indexOf("_")==0)continue;if(ev[a]&&ev[a].getUTCFullYear)
data[a]=this.obj.templates.xml_format(ev[a]);else
data[a]=ev[a];}
return data;};dp._clearUpdateFlag=function(){};dp.attachEvent("insertCallback",scheduler._update_callback);dp.attachEvent("updateCallback",scheduler._update_callback);dp.attachEvent("deleteCallback",function(upd,id){this.obj.setUserData(id,this.action_param,"true_deleted");this.obj.deleteEvent(id);});};scheduler.setUserData=function(id,name,value){if(id)
this.getEvent(id)[name]=value;else
this._userdata[name]=value;};scheduler.getUserData=function(id,name){return id?this.getEvent(id)[name]:this._userdata[name];};scheduler.setEventTextStyle=function(id,style){this.for_rendered(id,function(r){r.style.cssText+=";"+style;});var ev=this.getEvent(id);ev["_text_style"]=style;this.event_updated(ev);};scheduler.validId=function(id){return true;};scheduler._update_callback=function(upd,id){var data=scheduler.xmlNodeToJSON(upd.firstChild);data.text=data.text||data._tagvalue;data.start_date=scheduler.templates.xml_date(data.start_date);data.end_date=scheduler.templates.xml_date(data.end_date);scheduler.addEvent(data);};;scheduler.templates.calendar_month=scheduler.date.date_to_str("%F %Y");scheduler.templates.calendar_scale_date=scheduler.date.date_to_str("%D");scheduler.templates.calendar_date=scheduler.date.date_to_str("%d");scheduler.config.minicalendar={mark_events:true};scheduler._synced_minicalendars=[];scheduler.renderCalendar=function(obj,_prev,is_refresh){var cal=null;var date=obj.date||(new Date());if(typeof date=="string")
date=this.templates.api_date(date);if(!_prev){var cont=obj.container;var pos=obj.position;if(typeof cont=="string")
cont=document.getElementById(cont);if(typeof pos=="string")
pos=document.getElementById(pos);if(pos&&(typeof pos.left=="undefined")){var tpos=getOffset(pos);pos={top:tpos.top+pos.offsetHeight,left:tpos.left};}
if(!cont)
cont=scheduler._get_def_cont(pos);cal=this._render_calendar(cont,date,obj);cal.onclick=function(e){e=e||event;var src=e.target||e.srcElement;if(src.className.indexOf("dhx_month_head")!=-1){var pname=src.parentNode.className;if(pname.indexOf("dhx_after")==-1&&pname.indexOf("dhx_before")==-1){var newdate=scheduler.templates.xml_date(this.getAttribute("date"));newdate.setDate(parseInt(src.innerHTML,10));scheduler.unmarkCalendar(this);scheduler.markCalendar(this,newdate,"dhx_calendar_click");this._last_date=newdate;if(this.conf.handler)this.conf.handler.call(scheduler,newdate,this);}}};}else{cal=this._render_calendar(_prev.parentNode,date,obj,_prev);scheduler.unmarkCalendar(cal);}
if(scheduler.config.minicalendar.mark_events){var start=scheduler.date.month_start(date);var end=scheduler.date.add(start,1,"month");var evs=this.getEvents(start,end);var filter=this["filter_"+this._mode];for(var i=0;i<evs.length;i++){var ev=evs[i];if(filter&&!filter(ev.id,ev))
continue;var d=ev.start_date;if(d.valueOf()<start.valueOf())
d=start;d=scheduler.date.date_part(new Date(d.valueOf()));while(d<ev.end_date){this.markCalendar(cal,d,"dhx_year_event");d=this.date.add(d,1,"day");if(d.valueOf()>=end.valueOf())
break;}}}
this._markCalendarCurrentDate(cal);cal.conf=obj;if(obj.sync&&!is_refresh)
this._synced_minicalendars.push(cal);return cal;};scheduler._get_def_cont=function(pos){if(!this._def_count){this._def_count=document.createElement("DIV");this._def_count.className="dhx_minical_popup";this._def_count.onclick=function(e){(e||event).cancelBubble=true;};document.body.appendChild(this._def_count);}
this._def_count.style.left=pos.left+"px";this._def_count.style.top=pos.top+"px";this._def_count._created=new Date();return this._def_count;};scheduler._locateCalendar=function(cal,date){var table=cal.childNodes[2].childNodes[0];if(typeof date=="string")
date=scheduler.templates.api_date(date);var d=cal.week_start+date.getDate()-1;return table.rows[Math.floor(d/7)].cells[d%7].firstChild;};scheduler.markCalendar=function(cal,date,css){this._locateCalendar(cal,date).className+=" "+css;};scheduler.unmarkCalendar=function(cal,date,css){date=date||cal._last_date;css=css||"dhx_calendar_click";if(!date)return;var el=this._locateCalendar(cal,date);el.className=(el.className||"").replace(RegExp(css,"g"));};scheduler._week_template=function(width){var summ=(width||250);var left=0;var week_template=document.createElement("div");var dummy_date=this.date.week_start(new Date());for(var i=0;i<7;i++){this._cols[i]=Math.floor(summ/(7-i));this._render_x_header(i,left,dummy_date,week_template);dummy_date=this.date.add(dummy_date,1,"day");summ-=this._cols[i];left+=this._cols[i];}
week_template.lastChild.className+=" dhx_scale_bar_last";return week_template;};scheduler.updateCalendar=function(obj,sd){obj.conf.date=sd;this.renderCalendar(obj.conf,obj,true);};scheduler._mini_cal_arrows=["&nbsp","&nbsp"];scheduler._render_calendar=function(obj,sd,conf,previous){var ts=scheduler.templates;var temp=this._cols;this._cols=[];var temp2=this._mode;this._mode="calendar";var temp3=this._colsS;this._colsS={height:0};var temp4=new Date(this._min_date);var temp5=new Date(this._max_date);var temp6=new Date(scheduler._date);var temp7=ts.month_day;ts.month_day=ts.calendar_date;sd=this.date.month_start(sd);var week_template=this._week_template(obj.offsetWidth-1);var d;if(previous)
d=previous;else{d=document.createElement("DIV");d.className="dhx_cal_container dhx_mini_calendar";}
d.setAttribute("date",this.templates.xml_format(sd));d.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_week'>"+week_template.innerHTML+"</div><div class='dhx_year_body'></div>";d.childNodes[0].innerHTML=this.templates.calendar_month(sd);if(conf.navigation){var move_minicalendar_date=function(calendar,diff){var date=scheduler.date.add(calendar._date,diff,"month");scheduler.updateCalendar(calendar,date);if(scheduler._date.getMonth()==calendar._date.getMonth()&&scheduler._date.getFullYear()==calendar._date.getFullYear()){scheduler._markCalendarCurrentDate(calendar);}};var css_classnames=["dhx_cal_prev_button","dhx_cal_next_button"];var css_texts=["left:1px;top:2px;position:absolute;","left:auto; right:1px;top:2px;position:absolute;"];var diffs=[-1,1];var handler=function(diff){return function(){if(conf.sync){var calendars=scheduler._synced_minicalendars;for(var k=0;k<calendars.length;k++){move_minicalendar_date(calendars[k],diff);}}else{move_minicalendar_date(d,diff);}}};for(var j=0;j<2;j++){var arrow=document.createElement("DIV");arrow.className=css_classnames[j];arrow.style.cssText=css_texts[j];arrow.innerHTML=this._mini_cal_arrows[j];d.firstChild.appendChild(arrow);arrow.onclick=handler(diffs[j])}}
d._date=new Date(sd);d.week_start=(sd.getDay()-(this.config.start_on_monday?1:0)+7)%7;var dd=this.date.week_start(sd);this._reset_month_scale(d.childNodes[2],sd,dd);var r=d.childNodes[2].firstChild.rows;for(var k=r.length;k<6;k++){var last_row=r[r.length-1];r[0].parentNode.appendChild(last_row.cloneNode(true));var last_day_number=parseInt(last_row.childNodes[last_row.childNodes.length-1].childNodes[0].innerHTML);last_day_number=(last_day_number<10)?last_day_number:0;for(var ri=0;ri<r[k].childNodes.length;ri++){r[k].childNodes[ri].className="dhx_after";r[k].childNodes[ri].childNodes[0].innerHTML=scheduler.date.to_fixed(++last_day_number);}}
if(!previous)
obj.appendChild(d);d.childNodes[1].style.height=(d.childNodes[1].childNodes[0].offsetHeight-1)+"px";this._cols=temp;this._mode=temp2;this._colsS=temp3;this._min_date=temp4;this._max_date=temp5;scheduler._date=temp6;ts.month_day=temp7;return d;};scheduler.destroyCalendar=function(cal,force){if(!cal&&this._def_count&&this._def_count.firstChild){if(force||(new Date()).valueOf()-this._def_count._created.valueOf()>500)
cal=this._def_count.firstChild;}
if(!cal)return;cal.onclick=null;cal.innerHTML="";if(cal.parentNode)
cal.parentNode.removeChild(cal);if(this._def_count)
this._def_count.style.top="-1000px";};scheduler.isCalendarVisible=function(){if(this._def_count&&parseInt(this._def_count.style.top,10)>0)
return this._def_count;return false;};scheduler.attachEvent("onTemplatesReady",function(){dhtmlxEvent(document.body,"click",function(){scheduler.destroyCalendar();});});scheduler.templates.calendar_time=scheduler.date.date_to_str("%d-%m-%Y");scheduler.form_blocks.calendar_time={render:function(){var html="<input class='dhx_readonly' type='text' readonly='true'>";var cfg=scheduler.config;var dt=this.date.date_part(new Date());var last=24*60,first=0;if(cfg.limit_time_select){first=60*cfg.first_hour;last=60*cfg.last_hour+1;}
dt.setHours(first/60);html+=" <select>";for(var i=first;i<last;i+=this.config.time_step*1){var time=this.templates.time_picker(dt);html+="<option value='"+i+"'>"+time+"</option>";dt=this.date.add(dt,this.config.time_step,"minute");}
html+="</select>";var full_day=scheduler.config.full_day;return"<div style='height:30px;padding-top:0; font-size:inherit;' class='dhx_section_time'>"+html+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+html+"</div>";},set_value:function(node,value,ev){var inputs=node.getElementsByTagName("input");var selects=node.getElementsByTagName("select");var _init_once=function(inp,date,number){inp.onclick=function(){scheduler.destroyCalendar(null,true);scheduler.renderCalendar({position:inp,date:new Date(this._date),navigation:true,handler:function(new_date){inp.value=scheduler.templates.calendar_time(new_date);inp._date=new Date(new_date);scheduler.destroyCalendar();if(scheduler.config.event_duration&&scheduler.config.auto_end_date&&number==0){_update_minical_select();}}});};};if(scheduler.config.full_day){if(!node._full_day){var html="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";if(!scheduler.config.wide_form)
html=node.previousSibling.innerHTML+html;node.previousSibling.innerHTML=html;node._full_day=true;}
var input=node.previousSibling.getElementsByTagName("input")[0];var isFulldayEvent=(scheduler.date.time_part(ev.start_date)==0&&scheduler.date.time_part(ev.end_date)==0);input.checked=isFulldayEvent;selects[0].disabled=input.checked;selects[1].disabled=input.checked;input.onclick=function(){if(input.checked==true){var obj={};scheduler.form_blocks.calendar_time.get_value(node,obj);var start_date=scheduler.date.date_part(obj.start_date);var end_date=scheduler.date.date_part(obj.end_date);if(+end_date==+start_date||(+end_date>=+start_date&&(ev.end_date.getHours()!=0||ev.end_date.getMinutes()!=0)))
end_date=scheduler.date.add(end_date,1,"day");}
var start=start_date||ev.start_date;var end=end_date||ev.end_date;_attach_action(inputs[0],start);_attach_action(inputs[1],end);selects[0].value=start.getHours()*60+start.getMinutes();selects[1].value=end.getHours()*60+end.getMinutes();selects[0].disabled=input.checked;selects[1].disabled=input.checked;};}
if(scheduler.config.event_duration&&scheduler.config.auto_end_date){function _update_minical_select(){start_date=scheduler.date.add(inputs[0]._date,selects[0].value,"minute");end_date=new Date(start_date.getTime()+(scheduler.config.event_duration*60*1000));inputs[1].value=scheduler.templates.calendar_time(end_date);inputs[1]._date=scheduler.date.date_part(new Date(end_date));selects[1].value=end_date.getHours()*60+end_date.getMinutes();}
selects[0].onchange=_update_minical_select;}
function _attach_action(inp,date,number){_init_once(inp,date,number);inp.value=scheduler.templates.calendar_time(date);inp._date=scheduler.date.date_part(new Date(date));}
_attach_action(inputs[0],ev.start_date,0);_attach_action(inputs[1],ev.end_date,1);_init_once=function(){};selects[0].value=ev.start_date.getHours()*60+ev.start_date.getMinutes();selects[1].value=ev.end_date.getHours()*60+ev.end_date.getMinutes();},get_value:function(node,ev){var inputs=node.getElementsByTagName("input");var selects=node.getElementsByTagName("select");ev.start_date=scheduler.date.add(inputs[0]._date,selects[0].value,"minute");ev.end_date=scheduler.date.add(inputs[1]._date,selects[1].value,"minute");if(ev.end_date<=ev.start_date)
ev.end_date=scheduler.date.add(ev.start_date,scheduler.config.time_step,"minute");},focus:function(node){}};scheduler.linkCalendar=function(calendar,datediff){var action=function(){var date=scheduler._date;var dateNew=new Date(date.valueOf());if(datediff)dateNew=datediff(dateNew);dateNew.setDate(1);scheduler.updateCalendar(calendar,dateNew);return true;};scheduler.attachEvent("onViewChange",action);scheduler.attachEvent("onXLE",action);scheduler.attachEvent("onEventAdded",action);scheduler.attachEvent("onEventChanged",action);scheduler.attachEvent("onAfterEventDelete",action);action();};scheduler._markCalendarCurrentDate=function(calendar){var date=scheduler._date;var mode=scheduler._mode;var month_start=scheduler.date.month_start(new Date(calendar._date));var month_end=scheduler.date.add(month_start,1,"month");if(mode=='day'||(this._props&&!!this._props[mode])){if(month_start.valueOf()<=date.valueOf()&&month_end>date){scheduler.markCalendar(calendar,date,"dhx_calendar_click");}}else if(mode=='week'){var dateNew=scheduler.date.week_start(new Date(date.valueOf()));for(var i=0;i<7;i++){if(month_start.valueOf()<=dateNew.valueOf()&&month_end>dateNew)
scheduler.markCalendar(calendar,dateNew,"dhx_calendar_click");dateNew=scheduler.date.add(dateNew,1,"day");}}};scheduler.attachEvent("onEventCancel",function(){scheduler.destroyCalendar(null,true);});;(function(){if(this.scheduler){var old_scheduler_dblclick=scheduler._on_dbl_click;scheduler._on_dbl_click=function(e,src){if(src&&!src.className){return;}else{old_scheduler_dblclick.apply(this,arguments);}};}}());openerp.web_calendar=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('calendar','instance.web_calendar.CalendarView');instance.web_calendar.CalendarView=instance.web.View.extend({template:"CalendarView",display_name:_lt('Calendar'),init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.ready=$.Deferred();this.set_default_options(options);this.dataset=dataset;this.model=dataset.model;this.fields_view={};this.view_id=view_id;this.view_type='calendar';this.has_been_loaded=$.Deferred();this.dataset_events=[];this.COLOR_PALETTE=['#f57900','#cc0000','#d400a8','#75507b','#3465a4','#73d216','#c17d11','#edd400','#fcaf3e','#ef2929','#ff00c9','#ad7fa8','#729fcf','#8ae234','#e9b96e','#fce94f','#ff8e00','#ff0000','#b0008c','#9000ff','#0078ff','#00ff00','#e6ff00','#ffff00','#905000','#9b0000','#840067','#510090','#0000c9','#009b00','#9abe00','#ffc900'];this.color_map={};this.last_search=[];this.range_start=null;this.range_stop=null;this.update_range_dates(Date.today());this.selected_filters=[];},view_loading:function(r){return this.load_calendar(r);},destroy:function(){scheduler.clearAll();this._super();},load_calendar:function(data){this.fields_view=data;this.$el.addClass(this.fields_view.arch.attrs['class']);this.calendar_fields={};this.ids=this.dataset.ids;this.color_values=[];this.info_fields=[];this.name=this.fields_view.name||this.fields_view.arch.attrs.string;this.view_id=this.fields_view.view_id;this.mode=this.fields_view.arch.attrs.mode;this.date_start=this.fields_view.arch.attrs.date_start;this.date_delay=this.fields_view.arch.attrs.date_delay;this.date_stop=this.fields_view.arch.attrs.date_stop;this.day_length=this.fields_view.arch.attrs.day_length||8;this.color_field=this.fields_view.arch.attrs.color;this.color_string=this.fields_view.fields[this.color_field]?this.fields_view.fields[this.color_field].string:_t("Filter");if(this.color_field&&this.selected_filters.length===0){var default_filter;if((default_filter=this.dataset.context['calendar_default_'+this.color_field])){this.selected_filters.push(default_filter+'');}}
this.fields=this.fields_view.fields;if(!this.date_start){throw new Error(_t("Calendar view has not defined 'date_start' attribute."));}
this.calendar_fields.date_start={'name':this.date_start,'kind':this.fields[this.date_start].type};if(this.date_delay){if(this.fields[this.date_delay].type!='float'){throw new Error(_t("Calendar view has a 'date_delay' type != float"));}
this.calendar_fields.date_delay={'name':this.date_delay,'kind':this.fields[this.date_delay].type};}
if(this.date_stop){this.calendar_fields.date_stop={'name':this.date_stop,'kind':this.fields[this.date_stop].type};}
for(var fld=0;fld<this.fields_view.arch.children.length;fld++){this.info_fields.push(this.fields_view.arch.children[fld].attrs.name);}
this.init_scheduler();if(!this.sidebar&&this.options.$sidebar){this.sidebar=new instance.web_calendar.Sidebar(this);this.has_been_loaded.then(this.sidebar.appendTo(this.$el.find('.oe_calendar_sidebar_container')));}
this.trigger('calendar_view_loaded',data);return this.has_been_loaded.resolve();},init_scheduler:function(){var self=this;scheduler.clearAll();if(this.fields[this.date_start]['type']=='time'){scheduler.config.xml_date="%H:%M:%S";}else{scheduler.config.xml_date="%Y-%m-%d %H:%i";}
scheduler.config.api_date="%Y-%m-%d %H:%i";scheduler.config.multi_day=true;scheduler.config.start_on_monday=Date.CultureInfo.firstDayOfWeek!==0;scheduler.config.time_step=30;scheduler.config.scroll_hour=8;scheduler.config.drag_resize=true;scheduler.config.drag_create=true;scheduler.config.mark_now=true;scheduler.config.day_date='%l %j';scheduler.config.details_on_create=false;scheduler.locale={date:{month_full:Date.CultureInfo.monthNames,month_short:Date.CultureInfo.abbreviatedMonthNames,day_full:Date.CultureInfo.dayNames,day_short:Date.CultureInfo.abbreviatedDayNames},labels:{dhx_cal_today_button:_t("Today"),day_tab:_t("Day"),week_tab:_t("Week"),month_tab:_t("Month"),new_event:_t("New event"),icon_save:_t("Save"),icon_cancel:_t("Cancel"),icon_details:_t("Details"),icon_edit:_t("Edit"),icon_delete:_t("Delete"),confirm_closing:"",confirm_deleting:_t("Event will be deleted permanently, are you sure?"),section_description:_t("Description"),section_time:_t("Time period"),full_day:_t("Full day"),confirm_recurring:_t("Do you want to edit the whole set of repeated events?"),section_recurring:_t("Repeat event"),button_recurring:_t("Disabled"),button_recurring_open:_t("Enabled"),agenda_tab:_t("Agenda"),date:_t("Date"),description:_t("Description"),year_tab:_t("Year"),week_agenda_tab:_t("Agenda")}};scheduler.init(this.$el.find('.oe_calendar')[0],null,this.mode||'month');scheduler.detachAllEvents();scheduler.attachEvent('onViewChange',this.proxy('view_changed'));scheduler.attachEvent('onEventChanged',this.proxy('quick_save'));scheduler.attachEvent('onEventDeleted',this.proxy('delete_event'));scheduler.attachEvent('onEventAdded',function(event_id,event_obj){var fn=event_obj._force_slow_create?'slow_create':'quick_create';self[fn].apply(self,arguments);});scheduler.attachEvent('onClick',function(event_id,mouse_event){if(!self.$el.find('.dhx_cal_editor').length&&self.current_mode()==='month'){self.open_event(event_id);}else{return true;}});scheduler.attachEvent('onDblClick',function(event_id,mouse_event){if(!self.$el.find('.dhx_cal_editor').length){self.open_event(event_id);}});scheduler.attachEvent('onEmptyClick',function(start_date,mouse_event){scheduler._loading=false;if(!self.$el.find('.dhx_cal_editor').length){var end_date=new Date(start_date);end_date.addHours(1);scheduler.addEvent({start_date:start_date,end_date:end_date,_force_slow_create:true,});}});scheduler.attachEvent("onBeforeLightbox",function(event_id){var index=self.dataset.get_id_index(event_id);if(index!==null){self.open_event(self.dataset.ids[index]);}else{self.slow_create(event_id,scheduler.getEvent(event_id));}
return false;});this.refresh_scheduler();this.$el.find(".dhx_cal_navline").removeAttr('style');instance.web.bus.on('resize',this,function(){self.$el.find(".dhx_cal_navline").removeAttr('style');});},view_changed:function(mode,date){this.$el.find('.oe_calendar').removeClass('oe_cal_day oe_cal_week oe_cal_month').addClass('oe_cal_'+mode);if(!date.between(this.range_start,this.range_stop)){this.update_range_dates(date);this.ranged_search();}
this.ready.resolve();},update_range_dates:function(date){this.range_start=date.clone().moveToFirstDayOfMonth();this.range_stop=this.range_start.clone().addMonths(1).addSeconds(-1);},refresh_scheduler:function(){scheduler.setCurrentView(scheduler._date);},reload_event:function(id){this.dataset.read_ids([id],_.keys(this.fields)).done(this.proxy('events_loaded'));},get_color:function(key){if(this.color_map[key]){return this.color_map[key];}
var index=_.keys(this.color_map).length%this.COLOR_PALETTE.length;var color=this.COLOR_PALETTE[index];this.color_map[key]=color;return color;},events_loaded:function(events,fn_filter,no_filter_reload){var self=this;var res_events=[],sidebar_items={};for(var e=0;e<events.length;e++){var evt=events[e];if(!evt[this.date_start]){break;}
if(this.color_field){var filter=evt[this.color_field];if(filter){var filter_value=(typeof filter==='object')?filter[0]:filter;if(typeof(fn_filter)==='function'&&!fn_filter(filter_value)){continue;}
var filter_item={value:filter_value,label:(typeof filter==='object')?filter[1]:filter,color:this.get_color(filter_value)};if(!sidebar_items[filter_value]){sidebar_items[filter_value]=filter_item;}
evt.color=filter_item.color;evt.textColor='#ffffff';}else{evt.textColor='#000000';}}
if(this.fields[this.date_start]['type']=='date'){evt[this.date_start]=instance.web.auto_str_to_date(evt[this.date_start]).set({hour:9}).toString('yyyy-MM-dd HH:mm:ss');}
if(this.date_stop&&evt[this.date_stop]&&this.fields[this.date_stop]['type']=='date'){evt[this.date_stop]=instance.web.auto_str_to_date(evt[this.date_stop]).set({hour:17}).toString('yyyy-MM-dd HH:mm:ss');}
res_events.push(this.convert_event(evt));}
scheduler.parse(res_events,'json');this.refresh_scheduler();if(!no_filter_reload&&this.sidebar){this.sidebar.filter.events_loaded(sidebar_items);}},convert_event:function(evt){var date_start=instance.web.str_to_datetime(evt[this.date_start]),date_stop=this.date_stop?instance.web.str_to_datetime(evt[this.date_stop]):null,date_delay=evt[this.date_delay]||1.0,res_text='';if(this.info_fields){res_text=_.map(this.info_fields,function(fld){if(evt[fld]instanceof Array)
return evt[fld][1];return evt[fld];});}
if(!date_stop&&date_delay){date_stop=date_start.clone().addHours(date_delay);}
var r={'start_date':date_start.toString('yyyy-MM-dd HH:mm:ss'),'end_date':date_stop.toString('yyyy-MM-dd HH:mm:ss'),'text':res_text.join(', '),'id':evt.id};if(evt.color){r.color=evt.color;}
if(evt.textColor){r.textColor=evt.textColor;}
return r;},get_event_data:function(event_obj){var data={name:event_obj.text};data[this.date_start]=instance.web.datetime_to_str(event_obj.start_date);if(this.date_stop){data[this.date_stop]=instance.web.datetime_to_str(event_obj.end_date);}
if(this.date_delay){var diff_seconds=Math.round((event_obj.end_date.getTime()-event_obj.start_date.getTime())/1000);data[this.date_delay]=diff_seconds/3600;}
return data;},do_search:function(domain,context,group_by){this.last_search=arguments;this.ranged_search();},ranged_search:function(){var self=this;scheduler.clearAll();$.when(this.has_been_loaded,this.ready).done(function(){self.dataset.read_slice(_.keys(self.fields),{offset:0,domain:self.get_range_domain(),context:self.last_search[1]}).done(function(events){self.dataset_events=events;self.events_loaded(events);});});},get_range_domain:function(){var format=instance.web.date_to_str,domain=this.last_search[0].slice(0);domain.unshift([this.date_start,'>=',format(this.range_start.clone().addDays(-6))]);domain.unshift([this.date_start,'<=',format(this.range_stop.clone().addDays(6))]);return domain;},do_show:function(){var self=this;$.when(this.has_been_loaded).done(function(){self.$el.show();self.do_push_state({});});},get_selected_ids:function(){return[];},current_mode:function(){return scheduler.getState().mode;},quick_save:function(event_id,event_obj){var self=this;var data=this.get_event_data(event_obj);delete(data.name);var index=this.dataset.get_id_index(event_id);if(index!==null){event_id=this.dataset.ids[index];this.dataset.write(event_id,data,{});}},quick_create:function(event_id,event_obj){var self=this;var data=this.get_event_data(event_obj);this.dataset.create(data).done(function(r){var id=r;self.dataset.ids.push(id);scheduler.changeEventId(event_id,id);self.reload_event(id);}).fail(function(r,event){event.preventDefault();self.slow_create(event_id,event_obj);});},get_form_popup_infos:function(){var parent=this.getParent();var infos={view_id:false,title:this.name,};if(parent instanceof instance.web.ViewManager){infos.view_id=parent.get_view_id('form');if(parent instanceof instance.web.ViewManagerAction&&parent.action&&parent.action.name){infos.title=parent.action.name;}}
return infos;},slow_create:function(event_id,event_obj){var self=this;if(this.current_mode()==='month'){event_obj['start_date'].addHours(8);if(event_obj._length===1){event_obj['end_date']=new Date(event_obj['start_date']);event_obj['end_date'].addHours(1);}else{event_obj['end_date'].addHours(-4);}}
var defaults={};_.each(this.get_event_data(event_obj),function(val,field_name){defaults['default_'+field_name]=val;});var something_saved=false;var pop=new instance.web.form.FormOpenPopup(this);var pop_infos=this.get_form_popup_infos();pop.show_element(this.dataset.model,null,this.dataset.get_context(defaults),{title:_.str.sprintf(_t("Create: %s"),pop_infos.title),disable_multiple_selection:true,view_id:pop_infos.view_id,});pop.on('closed',self,function(){if(!something_saved){scheduler.deleteEvent(event_id);}});pop.on('create_completed',self,function(id){something_saved=true;self.dataset.ids.push(id);scheduler.changeEventId(event_id,id);self.reload_event(id);});},open_event:function(event_id){var self=this;var index=this.dataset.get_id_index(event_id);if(index===null){var event_obj=scheduler.getEvent(event_id);scheduler.deleteEvent(event_id);scheduler.addEvent({start_date:event_obj.start_date,end_date:event_obj.end_date,text:event_obj.text,_force_slow_create:true,});}else{var pop=new instance.web.form.FormOpenPopup(this);var pop_infos=this.get_form_popup_infos();var id_from_dataset=this.dataset.ids[index];pop.show_element(this.dataset.model,id_from_dataset,this.dataset.get_context(),{title:_.str.sprintf(_t("Edit: %s"),pop_infos.title),view_id:pop_infos.view_id,});pop.on('write_completed',self,function(){self.reload_event(id_from_dataset);});}},delete_event:function(event_id,event_obj){var self=this;var index=this.dataset.get_id_index(event_id);if(index!==null){this.dataset.unlink(event_id);}},});instance.web_calendar.Sidebar=instance.web.Widget.extend({template:'CalendarView.sidebar',start:function(){this._super();this.mini_calendar=scheduler.renderCalendar({container:this.$el.find('.oe_calendar_mini')[0],navigation:true,date:scheduler._date,handler:function(date,calendar){scheduler.setCurrentView(date,'day');}});scheduler.linkCalendar(this.mini_calendar);this.filter=new instance.web_calendar.SidebarFilter(this,this.getParent());this.filter.appendTo(this.$el.find('.oe_calendar_filter'));}});instance.web_calendar.SidebarFilter=instance.web.Widget.extend({events:{'change input:checkbox':'filter_click'},init:function(parent,view){this._super(parent);this.view=view;},events_loaded:function(filters){var selected_filters=this.view.selected_filters.slice(0);this.$el.html(QWeb.render('CalendarView.sidebar.responsible',{filters:filters}));this.$('div.oe_calendar_responsible input').each(function(){if(_.indexOf(selected_filters,$(this).val())>-1){$(this).click();}});},filter_click:function(e){var self=this,responsibles=[],$e=$(e.target);this.view.selected_filters=[];this.$('div.oe_calendar_responsible input:checked').each(function(){responsibles.push($(this).val());self.view.selected_filters.push($(this).val());});scheduler.clearAll();if(responsibles.length){this.view.events_loaded(this.view.dataset_events,function(filter_value){return _.indexOf(responsibles,filter_value.toString())>-1;},true);}else{this.view.events_loaded(this.view.dataset_events,false,true);}}});};;openerp.web_hello=function(instance){instance.web.SearchView=instance.web.SearchView.extend({init:function(){this._super.apply(this,arguments);this.on('search_data',this,function(){console.log('hello');});}});instance.web.Login=instance.web.Login.extend({start:function(){console.log('Hello there');return this._super.apply(this,arguments);}});};;!function($){"use strict"
var toggle='[data-toggle="dropdown"]',Dropdown=function(element){var $el=$(element).on('click.dropdown.data-api',this.toggle)
$('html').on('click.dropdown.data-api',function(){$el.parent().removeClass('open')})}
Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),selector=$this.attr('data-target'),$parent,isActive
if(!selector){selector=$this.attr('href')
selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,'')}
$parent=$(selector)
$parent.length||($parent=$this.parent())
isActive=$parent.hasClass('open')
clearMenus()
!isActive&&$parent.toggleClass('open')
return false}}
function clearMenus(){$(toggle).parent().removeClass('open')}
$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data('dropdown')
if(!data)$this.data('dropdown',(data=new Dropdown(this)))
if(typeof option=='string')data[option].call($this)})}
$.fn.dropdown.Constructor=Dropdown
$(function(){$('html').on('click.dropdown.data-api',clearMenus)
$('body').on('click.dropdown.data-api',toggle,Dropdown.prototype.toggle)})}(window.jQuery);;!function(name,context,definition){context[name]=definition(name,context);}('bean',this,function(name,context){var win=window,old=context[name],overOut=/over|out/,namespaceRegex=/[^\.]*(?=\..*)\.|.*/,nameRegex=/\..*/,addEvent='addEventListener',attachEvent='attachEvent',removeEvent='removeEventListener',detachEvent='detachEvent',doc=document||{},root=doc.documentElement||{},W3C_MODEL=root[addEvent],eventSupport=W3C_MODEL?addEvent:attachEvent,slice=Array.prototype.slice,mouseTypeRegex=/click|mouse|menu|drag|drop/i,touchTypeRegex=/^touch|^gesture/i,ONE={one:1},nativeEvents=(function(hash,events,i){for(i=0;i<events.length;i++)
hash[events[i]]=1
return hash})({},('click dblclick mouseup mousedown contextmenu '+'mousewheel DOMMouseScroll '+'mouseover mouseout mousemove selectstart selectend '+'keydown keypress keyup '+'orientationchange '+'focus blur change reset select submit '+'load unload beforeunload resize move DOMContentLoaded readystatechange '+'error abort scroll '+
(W3C_MODEL?'show '+'input invalid '+'touchstart touchmove touchend touchcancel '+'gesturestart gesturechange gestureend '+'message readystatechange pageshow pagehide popstate '+'hashchange offline online '+'afterprint beforeprint '+'dragstart dragenter dragover dragleave drag drop dragend '+'loadstart progress suspend emptied stalled loadmetadata '+'loadeddata canplay canplaythrough playing waiting seeking '+'seeked ended durationchange timeupdate play pause ratechange '+'volumechange cuechange '+'checking noupdate downloading cached updateready obsolete '+'':'')).split(' ')),customEvents=(function(){function isDescendant(parent,node){while((node=node.parentNode)!==null){if(node===parent)return true}
return false}
function check(event){var related=event.relatedTarget
if(!related)return related===null
return(related!==this&&related.prefix!=='xul'&&!/document/.test(this.toString())&&!isDescendant(this,related))}
return{mouseenter:{base:'mouseover',condition:check},mouseleave:{base:'mouseout',condition:check},mousewheel:{base:/Firefox/.test(navigator.userAgent)?'DOMMouseScroll':'mousewheel'}}})(),fixEvent=(function(){var commonProps='altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which'.split(' '),mouseProps=commonProps.concat('button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement'.split(' ')),keyProps=commonProps.concat('char charCode key keyCode'.split(' ')),touchProps=commonProps.concat('touches targetTouches changedTouches scale rotation'.split(' ')),preventDefault='preventDefault',createPreventDefault=function(event){return function(){if(event[preventDefault])
event[preventDefault]()
else
event.returnValue=false}},stopPropagation='stopPropagation',createStopPropagation=function(event){return function(){if(event[stopPropagation])
event[stopPropagation]()
else
event.cancelBubble=true}},createStop=function(synEvent){return function(){synEvent[preventDefault]()
synEvent[stopPropagation]()
synEvent.stopped=true}},copyProps=function(event,result,props){var i,p
for(i=props.length;i--;){p=props[i]
if(!(p in result)&&p in event)result[p]=event[p]}}
return function(event,isNative){var result={originalEvent:event,isNative:isNative}
if(!event)
return result
var props,type=event.type,target=event.target||event.srcElement
result[preventDefault]=createPreventDefault(event)
result[stopPropagation]=createStopPropagation(event)
result.stop=createStop(result)
result.target=target&&target.nodeType===3?target.parentNode:target
if(isNative){if(type.indexOf('key')!==-1){props=keyProps
result.keyCode=event.which||event.keyCode}else if(mouseTypeRegex.test(type)){props=mouseProps
result.rightClick=event.which===3||event.button===2
result.pos={x:0,y:0}
if(event.pageX||event.pageY){result.clientX=event.pageX
result.clientY=event.pageY}else if(event.clientX||event.clientY){result.clientX=event.clientX+doc.body.scrollLeft+root.scrollLeft
result.clientY=event.clientY+doc.body.scrollTop+root.scrollTop}
if(overOut.test(type))
result.relatedTarget=event.relatedTarget||event[(type==='mouseover'?'from':'to')+'Element']}else if(touchTypeRegex.test(type)){props=touchProps}
copyProps(event,result,props||commonProps)}
return result}})(),targetElement=function(element,isNative){return!W3C_MODEL&&!isNative&&(element===doc||element===win)?root:element},RegEntry=(function(){function entry(element,type,handler,original,namespaces){this.element=element
this.type=type
this.handler=handler
this.original=original
this.namespaces=namespaces
this.custom=customEvents[type]
this.isNative=nativeEvents[type]&&element[eventSupport]
this.eventType=W3C_MODEL||this.isNative?type:'propertychange'
this.customType=!W3C_MODEL&&!this.isNative&&type
this.target=targetElement(element,this.isNative)
this.eventSupport=this.target[eventSupport]}
entry.prototype={inNamespaces:function(checkNamespaces){var i,j
if(!checkNamespaces)
return true
if(!this.namespaces)
return false
for(i=checkNamespaces.length;i--;){for(j=this.namespaces.length;j--;){if(checkNamespaces[i]===this.namespaces[j])
return true}}
return false},matches:function(checkElement,checkOriginal,checkHandler){return this.element===checkElement&&(!checkOriginal||this.original===checkOriginal)&&(!checkHandler||this.handler===checkHandler)}}
return entry})(),registry=(function(){var map={},forAll=function(element,type,original,handler,fn){if(!type||type==='*'){for(var t in map){if(t.charAt(0)==='$')
forAll(element,t.substr(1),original,handler,fn)}}else{var i=0,l,list=map['$'+type],all=element==='*'
if(!list)
return
for(l=list.length;i<l;i++){if(all||list[i].matches(element,original,handler))
if(!fn(list[i],list,i,type))
return}}},has=function(element,type,original){var i,list=map['$'+type]
if(list){for(i=list.length;i--;){if(list[i].matches(element,original,null))
return true}}
return false},get=function(element,type,original){var entries=[]
forAll(element,type,original,null,function(entry){return entries.push(entry)})
return entries},put=function(entry){(map['$'+entry.type]||(map['$'+entry.type]=[])).push(entry)
return entry},del=function(entry){forAll(entry.element,entry.type,null,entry.handler,function(entry,list,i){list.splice(i,1)
if(list.length===0)
delete map['$'+entry.type]
return false})},entries=function(){var t,entries=[]
for(t in map){if(t.charAt(0)==='$')
entries=entries.concat(map[t])}
return entries}
return{has:has,get:get,put:put,del:del,entries:entries}})(),listener=W3C_MODEL?function(element,type,fn,add){element[add?addEvent:removeEvent](type,fn,false)}:function(element,type,fn,add,custom){if(custom&&add&&element['_on'+custom]===null)
element['_on'+custom]=0
element[add?attachEvent:detachEvent]('on'+type,fn)},nativeHandler=function(element,fn,args){return function(event){event=fixEvent(event||((this.ownerDocument||this.document||this).parentWindow||win).event,true)
return fn.apply(element,[event].concat(args))}},customHandler=function(element,fn,type,condition,args,isNative){return function(event){if(condition?condition.apply(this,arguments):W3C_MODEL?true:event&&event.propertyName==='_on'+type||!event){if(event)
event=fixEvent(event||((this.ownerDocument||this.document||this).parentWindow||win).event,isNative)
fn.apply(element,event&&(!args||args.length===0)?arguments:slice.call(arguments,event?0:1).concat(args))}}},once=function(rm,element,type,fn,originalFn){return function(){rm(element,type,originalFn)
fn.apply(this,arguments)}},removeListener=function(element,orgType,handler,namespaces){var i,l,entry,type=(orgType&&orgType.replace(nameRegex,'')),handlers=registry.get(element,type,handler)
for(i=0,l=handlers.length;i<l;i++){if(handlers[i].inNamespaces(namespaces)){if((entry=handlers[i]).eventSupport)
listener(entry.target,entry.eventType,entry.handler,false,entry.type)
registry.del(entry)}}},addListener=function(element,orgType,fn,originalFn,args){var entry,type=orgType.replace(nameRegex,''),namespaces=orgType.replace(namespaceRegex,'').split('.')
if(registry.has(element,type,fn))
return element
if(type==='unload')
fn=once(removeListener,element,type,fn,originalFn)
if(customEvents[type]){if(customEvents[type].condition)
fn=customHandler(element,fn,type,customEvents[type].condition,true)
type=customEvents[type].base||type}
entry=registry.put(new RegEntry(element,type,fn,originalFn,namespaces[0]&&namespaces))
entry.handler=entry.isNative?nativeHandler(element,entry.handler,args):customHandler(element,entry.handler,type,false,args,false)
if(entry.eventSupport)
listener(entry.target,entry.eventType,entry.handler,true,entry.customType)},del=function(selector,fn,$){return function(e){var target,i,array=typeof selector==='string'?$(selector,this):selector
for(target=e.target;target&&target!==this;target=target.parentNode){for(i=array.length;i--;){if(array[i]===target){return fn.apply(target,arguments)}}}}},remove=function(element,typeSpec,fn){var k,m,type,namespaces,i,rm=removeListener,isString=typeSpec&&typeof typeSpec==='string'
if(isString&&typeSpec.indexOf(' ')>0){typeSpec=typeSpec.split(' ')
for(i=typeSpec.length;i--;)
remove(element,typeSpec[i],fn)
return element}
type=isString&&typeSpec.replace(nameRegex,'')
if(type&&customEvents[type])
type=customEvents[type].type
if(!typeSpec||isString){if(namespaces=isString&&typeSpec.replace(namespaceRegex,''))
namespaces=namespaces.split('.')
rm(element,type,fn,namespaces)}else if(typeof typeSpec==='function'){rm(element,null,typeSpec)}else{for(k in typeSpec){if(typeSpec.hasOwnProperty(k))
remove(element,k,typeSpec[k])}}
return element},add=function(element,events,fn,delfn,$){var type,types,i,args,originalFn=fn,isDel=fn&&typeof fn==='string'
if(events&&!fn&&typeof events==='object'){for(type in events){if(events.hasOwnProperty(type))
add.apply(this,[element,type,events[type]])}}else{args=arguments.length>3?slice.call(arguments,3):[]
types=(isDel?fn:events).split(' ')
isDel&&(fn=del(events,(originalFn=delfn),$))&&(args=slice.call(args,1))
this===ONE&&(fn=once(remove,element,events,fn,originalFn))
for(i=types.length;i--;)addListener(element,types[i],fn,originalFn,args)}
return element},one=function(){return add.apply(ONE,arguments)},fireListener=W3C_MODEL?function(isNative,type,element){var evt=doc.createEvent(isNative?'HTMLEvents':'UIEvents')
evt[isNative?'initEvent':'initUIEvent'](type,true,true,win,1)
element.dispatchEvent(evt)}:function(isNative,type,element){element=targetElement(element,isNative)
isNative?element.fireEvent('on'+type,doc.createEventObject()):element['_on'+type]++},fire=function(element,type,args){var i,j,l,names,handlers,types=type.split(' ')
for(i=types.length;i--;){type=types[i].replace(nameRegex,'')
if(names=types[i].replace(namespaceRegex,''))
names=names.split('.')
if(!names&&!args&&element[eventSupport]){fireListener(nativeEvents[type],type,element)}else{handlers=registry.get(element,type)
args=[false].concat(args)
for(j=0,l=handlers.length;j<l;j++){if(handlers[j].inNamespaces(names))
handlers[j].handler.apply(element,args)}}}
return element},clone=function(element,from,type){var i=0,handlers=registry.get(from,type),l=handlers.length
for(;i<l;i++)
handlers[i].original&&add(element,handlers[i].type,handlers[i].original)
return element},bean={add:add,one:one,remove:remove,clone:clone,fire:fire,noConflict:function(){context[name]=old
return this}}
if(win[attachEvent]){var cleanup=function(){var i,entries=registry.entries()
for(i in entries){if(entries[i].type&&entries[i].type!=='unload')
remove(entries[i].element,entries[i].type)}
win[detachEvent]('onunload',cleanup)
win.CollectGarbage&&win.CollectGarbage()}
win[attachEvent]('onunload',cleanup)}
return bean});;(function(){var
global=this,previousFlotr=this.Flotr,Flotr;Flotr={_:_,bean:bean,isIphone:/iphone/i.test(navigator.userAgent),isIE:(navigator.appVersion.indexOf("MSIE")!=-1?parseFloat(navigator.appVersion.split("MSIE")[1]):false),graphTypes:{},plugins:{},addType:function(name,graphType){Flotr.graphTypes[name]=graphType;Flotr.defaultOptions[name]=graphType.options||{};Flotr.defaultOptions.defaultType=Flotr.defaultOptions.defaultType||name;},addPlugin:function(name,plugin){Flotr.plugins[name]=plugin;Flotr.defaultOptions[name]=plugin.options||{};},draw:function(el,data,options,GraphKlass){GraphKlass=GraphKlass||Flotr.Graph;return new GraphKlass(el,data,options);},merge:function(src,dest){var i,v,result=dest||{};for(i in src){v=src[i];if(v&&typeof(v)==='object'){if(v.constructor===Array){result[i]=this._.clone(v);}else if(v.constructor!==RegExp&&!this._.isElement(v)){result[i]=Flotr.merge(v,(dest?dest[i]:undefined));}else{result[i]=v;}}else{result[i]=v;}}
return result;},clone:function(object){return Flotr.merge(object,{});},getTickSize:function(noTicks,min,max,decimals){var delta=(max-min)/noTicks,magn=Flotr.getMagnitude(delta),tickSize=10,norm=delta/magn;if(norm<1.5)tickSize=1;else if(norm<2.25)tickSize=2;else if(norm<3)tickSize=((decimals===0)?2:2.5);else if(norm<7.5)tickSize=5;return tickSize*magn;},defaultTickFormatter:function(val,axisOpts){return val+'';},defaultTrackFormatter:function(obj){return'('+obj.x+', '+obj.y+')';},engineeringNotation:function(value,precision,base){var sizes=['Y','Z','E','P','T','G','M','k',''],fractionSizes=['y','z','a','f','p','n','µ','m',''],total=sizes.length;base=base||1000;precision=Math.pow(10,precision||2);if(value===0)return 0;if(value>1){while(total--&&(value>=base))value/=base;}
else{sizes=fractionSizes;total=sizes.length;while(total--&&(value<1))value*=base;}
return(Math.round(value*precision)/precision)+sizes[total];},getMagnitude:function(x){return Math.pow(10,Math.floor(Math.log(x)/Math.LN10));},toPixel:function(val){return Math.floor(val)+0.5;},toRad:function(angle){return-angle*(Math.PI/180);},floorInBase:function(n,base){return base*Math.floor(n/base);},drawText:function(ctx,text,x,y,style){if(!ctx.fillText){ctx.drawText(text,x,y,style);return;}
style=this._.extend({size:Flotr.defaultOptions.fontSize,color:'#000000',textAlign:'left',textBaseline:'bottom',weight:1,angle:0},style);ctx.save();ctx.translate(x,y);ctx.rotate(style.angle);ctx.fillStyle=style.color;ctx.font=(style.weight>1?"bold ":"")+(style.size*1.3)+"px sans-serif";ctx.textAlign=style.textAlign;ctx.textBaseline=style.textBaseline;ctx.fillText(text,0,0);ctx.restore();},getBestTextAlign:function(angle,style){style=style||{textAlign:'center',textBaseline:'middle'};angle+=Flotr.getTextAngleFromAlign(style);if(Math.abs(Math.cos(angle))>10e-3)
style.textAlign=(Math.cos(angle)>0?'right':'left');if(Math.abs(Math.sin(angle))>10e-3)
style.textBaseline=(Math.sin(angle)>0?'top':'bottom');return style;},alignTable:{'right middle':0,'right top':Math.PI/4,'center top':Math.PI/2,'left top':3*(Math.PI/4),'left middle':Math.PI,'left bottom':-3*(Math.PI/4),'center bottom':-Math.PI/2,'right bottom':-Math.PI/4,'center middle':0},getTextAngleFromAlign:function(style){return Flotr.alignTable[style.textAlign+' '+style.textBaseline]||0;},noConflict:function(){global.Flotr=previousFlotr;return this;}};global.Flotr=Flotr;})();;Flotr.defaultOptions={colors:['#00A8F0','#C0D800','#CB4B4B','#4DA74D','#9440ED'],ieBackgroundColor:'#FFFFFF',title:null,subtitle:null,shadowSize:4,defaultType:null,HtmlText:true,fontColor:'#545454',fontSize:7.5,resolution:1,parseFloat:true,xaxis:{ticks:null,minorTicks:null,showLabels:true,showMinorLabels:false,labelsAngle:0,title:null,titleAngle:0,noTicks:5,minorTickFreq:null,tickFormatter:Flotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscale:false,autoscaleMargin:0,color:null,mode:'normal',timeFormat:null,timeMode:'UTC',timeUnit:'millisecond',scaling:'linear',base:Math.E,titleAlign:'center',margin:true},x2axis:{},yaxis:{ticks:null,minorTicks:null,showLabels:true,showMinorLabels:false,labelsAngle:0,title:null,titleAngle:90,noTicks:5,minorTickFreq:null,tickFormatter:Flotr.defaultTickFormatter,tickDecimals:null,min:null,max:null,autoscale:false,autoscaleMargin:0,color:null,scaling:'linear',base:Math.E,titleAlign:'center',margin:true},y2axis:{titleAngle:270},grid:{color:'#545454',backgroundColor:null,backgroundImage:null,watermarkAlpha:0.4,tickColor:'#DDDDDD',labelMargin:3,verticalLines:true,minorVerticalLines:null,horizontalLines:true,minorHorizontalLines:null,outlineWidth:1,outline:'nsew',circular:false},mouse:{track:false,trackAll:false,position:'se',relative:false,trackFormatter:Flotr.defaultTrackFormatter,margin:5,lineColor:'#FF3F19',trackDecimals:1,sensibility:2,trackY:true,radius:3,fillColor:null,fillOpacity:0.4}};;(function(){var
_=Flotr._;function Color(r,g,b,a){this.rgba=['r','g','b','a'];var x=4;while(-1<--x){this[this.rgba[x]]=arguments[x]||((x==3)?1.0:0);}
this.normalize();}
var COLOR_NAMES={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]};Color.prototype={scale:function(rf,gf,bf,af){var x=4;while(-1<--x){if(!_.isUndefined(arguments[x]))this[this.rgba[x]]*=arguments[x];}
return this.normalize();},alpha:function(alpha){if(!_.isUndefined(alpha)&&!_.isNull(alpha)){this.a=alpha;}
return this.normalize();},clone:function(){return new Color(this.r,this.b,this.g,this.a);},limit:function(val,minVal,maxVal){return Math.max(Math.min(val,maxVal),minVal);},normalize:function(){var limit=this.limit;this.r=limit(parseInt(this.r,10),0,255);this.g=limit(parseInt(this.g,10),0,255);this.b=limit(parseInt(this.b,10),0,255);this.a=limit(this.a,0,1);return this;},distance:function(color){if(!color)return;color=new Color.parse(color);var dist=0,x=3;while(-1<--x){dist+=Math.abs(this[this.rgba[x]]-color[this.rgba[x]]);}
return dist;},toString:function(){return(this.a>=1.0)?'rgb('+[this.r,this.g,this.b].join(',')+')':'rgba('+[this.r,this.g,this.b,this.a].join(',')+')';},contrast:function(){var
test=1-(0.299*this.r+0.587*this.g+0.114*this.b)/255;return(test<0.5?'#000000':'#ffffff');}};_.extend(Color,{parse:function(color){if(color instanceof Color)return color;var result;if((result=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color)))
return new Color(parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16));if((result=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color)))
return new Color(parseInt(result[1],10),parseInt(result[2],10),parseInt(result[3],10));if((result=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color)))
return new Color(parseInt(result[1]+result[1],16),parseInt(result[2]+result[2],16),parseInt(result[3]+result[3],16));if((result=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(color)))
return new Color(parseInt(result[1],10),parseInt(result[2],10),parseInt(result[3],10),parseFloat(result[4]));if((result=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color)))
return new Color(parseFloat(result[1])*2.55,parseFloat(result[2])*2.55,parseFloat(result[3])*2.55);if((result=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(color)))
return new Color(parseFloat(result[1])*2.55,parseFloat(result[2])*2.55,parseFloat(result[3])*2.55,parseFloat(result[4]));var name=(color+'').replace(/^\s*([\S\s]*?)\s*$/,'$1').toLowerCase();if(name=='transparent'){return new Color(255,255,255,0);}
return(result=COLOR_NAMES[name])?new Color(result[0],result[1],result[2]):new Color(0,0,0,0);},processColor:function(color,options){var opacity=options.opacity;if(!color)return'rgba(0, 0, 0, 0)';if(color instanceof Color)return color.alpha(opacity).toString();if(_.isString(color))return Color.parse(color).alpha(opacity).toString();var grad=color.colors?color:{colors:color};if(!options.ctx){if(!_.isArray(grad.colors))return'rgba(0, 0, 0, 0)';return Color.parse(_.isArray(grad.colors[0])?grad.colors[0][1]:grad.colors[0]).alpha(opacity).toString();}
grad=_.extend({start:'top',end:'bottom'},grad);if(/top/i.test(grad.start))options.x1=0;if(/left/i.test(grad.start))options.y1=0;if(/bottom/i.test(grad.end))options.x2=0;if(/right/i.test(grad.end))options.y2=0;var i,c,stop,gradient=options.ctx.createLinearGradient(options.x1,options.y1,options.x2,options.y2);for(i=0;i<grad.colors.length;i++){c=grad.colors[i];if(_.isArray(c)){stop=c[0];c=c[1];}
else stop=i/(grad.colors.length-1);gradient.addColorStop(stop,Color.parse(c).alpha(opacity));}
return gradient;}});Flotr.Color=Color;})();;Flotr.Date={set:function(date,name,mode,value){mode=mode||'UTC';name='set'+(mode==='UTC'?'UTC':'')+name;date[name](value);},get:function(date,name,mode){mode=mode||'UTC';name='get'+(mode==='UTC'?'UTC':'')+name;return date[name]();},format:function(d,format,mode){if(!d)return;var
get=this.get,tokens={h:get(d,'Hours',mode).toString(),H:leftPad(get(d,'Hours',mode)),M:leftPad(get(d,'Minutes',mode)),S:leftPad(get(d,'Seconds',mode)),s:get(d,'Milliseconds',mode),d:get(d,'Date',mode).toString(),m:(get(d,'Month')+1).toString(),y:get(d,'FullYear').toString(),b:Flotr.Date.monthNames[get(d,'Month',mode)]};function leftPad(n){n+='';return n.length==1?"0"+n:n;}
var r=[],c,escape=false;for(var i=0;i<format.length;++i){c=format.charAt(i);if(escape){r.push(tokens[c]||c);escape=false;}
else if(c=="%")
escape=true;else
r.push(c);}
return r.join('');},getFormat:function(time,span){var tu=Flotr.Date.timeUnits;if(time<tu.second)return"%h:%M:%S.%s";else if(time<tu.minute)return"%h:%M:%S";else if(time<tu.day)return(span<2*tu.day)?"%h:%M":"%b %d %h:%M";else if(time<tu.month)return"%b %d";else if(time<tu.year)return(span<tu.year)?"%b":"%b %y";else return"%y";},formatter:function(v,axis){var
options=axis.options,scale=Flotr.Date.timeUnits[options.timeUnit],d=new Date(v*scale);if(axis.options.timeFormat)
return Flotr.Date.format(d,options.timeFormat,options.timeMode);var span=(axis.max-axis.min)*scale,t=axis.tickSize*Flotr.Date.timeUnits[axis.tickUnit];return Flotr.Date.format(d,Flotr.Date.getFormat(t,span),options.timeMode);},generator:function(axis){var
set=this.set,get=this.get,timeUnits=this.timeUnits,spec=this.spec,options=axis.options,mode=options.timeMode,scale=timeUnits[options.timeUnit],min=axis.min*scale,max=axis.max*scale,delta=(max-min)/options.noTicks,ticks=[],tickSize=axis.tickSize,tickUnit,formatter,i;formatter=(options.tickFormatter===Flotr.defaultTickFormatter?this.formatter:options.tickFormatter);for(i=0;i<spec.length-1;++i){var d=spec[i][0]*timeUnits[spec[i][1]];if(delta<(d+spec[i+1][0]*timeUnits[spec[i+1][1]])/2&&d>=tickSize)
break;}
tickSize=spec[i][0];tickUnit=spec[i][1];if(tickUnit=="year"){tickSize=Flotr.getTickSize(options.noTicks*timeUnits.year,min,max,0);if(tickSize==0.5){tickUnit="month";tickSize=6;}}
axis.tickUnit=tickUnit;axis.tickSize=tickSize;var
d=new Date(min);var step=tickSize*timeUnits[tickUnit];function setTick(name){set(d,name,mode,Flotr.floorInBase(get(d,name,mode),tickSize));}
switch(tickUnit){case"millisecond":setTick('Milliseconds');break;case"second":setTick('Seconds');break;case"minute":setTick('Minutes');break;case"hour":setTick('Hours');break;case"month":setTick('Month');break;case"year":setTick('FullYear');break;}
if(step>=timeUnits.second)set(d,'Milliseconds',mode,0);if(step>=timeUnits.minute)set(d,'Seconds',mode,0);if(step>=timeUnits.hour)set(d,'Minutes',mode,0);if(step>=timeUnits.day)set(d,'Hours',mode,0);if(step>=timeUnits.day*4)set(d,'Date',mode,1);if(step>=timeUnits.year)set(d,'Month',mode,0);var carry=0,v=NaN,prev;do{prev=v;v=d.getTime();ticks.push({v:v/scale,label:formatter(v/scale,axis)});if(tickUnit=="month"){if(tickSize<1){set(d,'Date',mode,1);var start=d.getTime();set(d,'Month',mode,get(d,'Month',mode)+1)
var end=d.getTime();d.setTime(v+carry*timeUnits.hour+(end-start)*tickSize);carry=get(d,'Hours',mode)
set(d,'Hours',mode,0);}
else
set(d,'Month',mode,get(d,'Month',mode)+tickSize);}
else if(tickUnit=="year"){set(d,'FullYear',mode,get(d,'FullYear',mode)+tickSize);}
else
d.setTime(v+step);}while(v<max&&v!=prev);return ticks;},timeUnits:{millisecond:1,second:1000,minute:1000*60,hour:1000*60*60,day:1000*60*60*24,month:1000*60*60*24*30,year:1000*60*60*24*365.2425},spec:[[1,"millisecond"],[20,"millisecond"],[50,"millisecond"],[100,"millisecond"],[200,"millisecond"],[500,"millisecond"],[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[0.25,"month"],[0.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};;(function(){var _=Flotr._;Flotr.DOM={addClass:function(element,name){var classList=(element.className?element.className:'');if(_.include(classList.split(/\s+/g),name))return;element.className=(classList?classList+' ':'')+name;},create:function(tag){return document.createElement(tag);},node:function(html){var div=Flotr.DOM.create('div'),n;div.innerHTML=html;n=div.children[0];div.innerHTML='';return n;},empty:function(element){element.innerHTML='';},hide:function(element){Flotr.DOM.setStyles(element,{display:'none'});},insert:function(element,child){if(_.isString(child))
element.innerHTML+=child;else if(_.isElement(child))
element.appendChild(child);},opacity:function(element,opacity){element.style.opacity=opacity;},position:function(element,p){if(!element.offsetParent)
return{left:(element.offsetLeft||0),top:(element.offsetTop||0)};p=this.position(element.offsetParent);p.left+=element.offsetLeft;p.top+=element.offsetTop;return p;},removeClass:function(element,name){var classList=(element.className?element.className:'');element.className=_.filter(classList.split(/\s+/g),function(c){if(c!=name)return true;}).join(' ');},setStyles:function(element,o){_.each(o,function(value,key){element.style[key]=value;});},show:function(element){Flotr.DOM.setStyles(element,{display:''});},size:function(element){return{height:element.offsetHeight,width:element.offsetWidth};}};})();;(function(){var
F=Flotr,bean=F.bean;F.EventAdapter={observe:function(object,name,callback){bean.add(object,name,callback);return this;},fire:function(object,name,args){bean.fire(object,name,args);if(typeof(Prototype)!='undefined')
Event.fire(object,name,args);return this;},stopObserving:function(object,name,callback){bean.remove(object,name,callback);return this;},eventPointer:function(e){if(!F._.isUndefined(e.touches)&&e.touches.length>0){return{x:e.touches[0].pageX,y:e.touches[0].pageY};}else if(!F._.isUndefined(e.changedTouches)&&e.changedTouches.length>0){return{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY};}else if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY};}else if(e.clientX||e.clientY){var
d=document,b=d.body,de=d.documentElement;return{x:e.clientX+b.scrollLeft+de.scrollLeft,y:e.clientY+b.scrollTop+de.scrollTop};}}};})();;(function(){var
F=Flotr,D=F.DOM,_=F._,Text=function(o){this.o=o;};Text.prototype={dimensions:function(text,canvasStyle,htmlStyle,className){if(!text)return{width:0,height:0};return(this.o.html)?this.html(text,this.o.element,htmlStyle,className):this.canvas(text,canvasStyle);},canvas:function(text,style){if(!this.o.textEnabled)return;style=style||{};var
metrics=this.measureText(text,style),width=metrics.width,height=style.size||F.defaultOptions.fontSize,angle=style.angle||0,cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),widthPadding=2,heightPadding=6,bounds;bounds={width:Math.abs(cosAngle*width)+Math.abs(sinAngle*height)+widthPadding,height:Math.abs(sinAngle*width)+Math.abs(cosAngle*height)+heightPadding};return bounds;},html:function(text,element,style,className){var div=D.create('div');D.setStyles(div,{'position':'absolute','top':'-10000px'});D.insert(div,'<div style="'+style+'" class="'+className+' flotr-dummy-div">'+text+'</div>');D.insert(this.o.element,div);return D.size(div);},measureText:function(text,style){var
context=this.o.ctx,metrics;if(!context.fillText||(F.isIphone&&context.measure)){return{width:context.measure(text,style)};}
style=_.extend({size:F.defaultOptions.fontSize,weight:1,angle:0},style);context.save();context.font=(style.weight>1?"bold ":"")+(style.size*1.3)+"px sans-serif";metrics=context.measureText(text);context.restore();return metrics;}};Flotr.Text=Text;})();;(function(){var
D=Flotr.DOM,E=Flotr.EventAdapter,_=Flotr._,flotr=Flotr;Graph=function(el,data,options){this._setEl(el);this._initMembers();this._initPlugins();E.fire(this.el,'flotr:beforeinit',[this]);this.data=data;this.series=flotr.Series.getSeries(data);this._initOptions(options);this._initGraphTypes();this._initCanvas();this._text=new flotr.Text({element:this.el,ctx:this.ctx,html:this.options.HtmlText,textEnabled:this.textEnabled});E.fire(this.el,'flotr:afterconstruct',[this]);this._initEvents();this.findDataRanges();this.calculateSpacing();this.draw(_.bind(function(){E.fire(this.el,'flotr:afterinit',[this]);},this));};function observe(object,name,callback){E.observe.apply(this,arguments);this._handles.push(arguments);return this;}
Graph.prototype={destroy:function(){E.fire(this.el,'flotr:destroy');_.each(this._handles,function(handle){E.stopObserving.apply(this,handle);});this._handles=[];this.el.graph=null;},observe:observe,_observe:observe,processColor:function(color,options){var o={x1:0,y1:0,x2:this.plotWidth,y2:this.plotHeight,opacity:1,ctx:this.ctx};_.extend(o,options);return flotr.Color.processColor(color,o);},findDataRanges:function(){var a=this.axes,xaxis,yaxis,range;_.each(this.series,function(series){range=series.getRange();if(range){xaxis=series.xaxis;yaxis=series.yaxis;xaxis.datamin=Math.min(range.xmin,xaxis.datamin);xaxis.datamax=Math.max(range.xmax,xaxis.datamax);yaxis.datamin=Math.min(range.ymin,yaxis.datamin);yaxis.datamax=Math.max(range.ymax,yaxis.datamax);xaxis.used=(xaxis.used||range.xused);yaxis.used=(yaxis.used||range.yused);}},this);if(!a.x.used&&!a.x2.used)a.x.used=true;if(!a.y.used&&!a.y2.used)a.y.used=true;_.each(a,function(axis){axis.calculateRange();});var
types=_.keys(flotr.graphTypes),drawn=false;_.each(this.series,function(series){if(series.hide)return;_.each(types,function(type){if(series[type]&&series[type].show){this.extendRange(type,series);drawn=true;}},this);if(!drawn){this.extendRange(this.options.defaultType,series);}},this);},extendRange:function(type,series){if(this[type].extendRange)this[type].extendRange(series,series.data,series[type],this[type]);if(this[type].extendYRange)this[type].extendYRange(series.yaxis,series.data,series[type],this[type]);if(this[type].extendXRange)this[type].extendXRange(series.xaxis,series.data,series[type],this[type]);},calculateSpacing:function(){var a=this.axes,options=this.options,series=this.series,margin=options.grid.labelMargin,T=this._text,x=a.x,x2=a.x2,y=a.y,y2=a.y2,maxOutset=options.grid.outlineWidth,i,j,l,dim;_.each(a,function(axis){axis.calculateTicks();axis.calculateTextDimensions(T,options);});dim=T.dimensions(options.title,{size:options.fontSize*1.5},'font-size:1em;font-weight:bold;','flotr-title');this.titleHeight=dim.height;dim=T.dimensions(options.subtitle,{size:options.fontSize},'font-size:smaller;','flotr-subtitle');this.subtitleHeight=dim.height;for(j=0;j<options.length;++j){if(series[j].points.show){maxOutset=Math.max(maxOutset,series[j].points.radius+series[j].points.lineWidth/2);}}
var p=this.plotOffset;if(x.options.margin===false){p.bottom=0;p.top=0;}else{p.bottom+=(options.grid.circular?0:(x.used&&x.options.showLabels?(x.maxLabel.height+margin):0))+
(x.used&&x.options.title?(x.titleSize.height+margin):0)+maxOutset;p.top+=(options.grid.circular?0:(x2.used&&x2.options.showLabels?(x2.maxLabel.height+margin):0))+
(x2.used&&x2.options.title?(x2.titleSize.height+margin):0)+this.subtitleHeight+this.titleHeight+maxOutset;}
if(y.options.margin===false){p.left=0;p.right=0;}else{p.left+=(options.grid.circular?0:(y.used&&y.options.showLabels?(y.maxLabel.width+margin):0))+
(y.used&&y.options.title?(y.titleSize.width+margin):0)+maxOutset;p.right+=(options.grid.circular?0:(y2.used&&y2.options.showLabels?(y2.maxLabel.width+margin):0))+
(y2.used&&y2.options.title?(y2.titleSize.width+margin):0)+maxOutset;}
p.top=Math.floor(p.top);this.plotWidth=this.canvasWidth-p.left-p.right;this.plotHeight=this.canvasHeight-p.bottom-p.top;x.length=x2.length=this.plotWidth;y.length=y2.length=this.plotHeight;y.offset=y2.offset=this.plotHeight;x.setScale();x2.setScale();y.setScale();y2.setScale();},draw:function(after){var
context=this.ctx,i;E.fire(this.el,'flotr:beforedraw',[this.series,this]);if(this.series.length){context.save();context.translate(this.plotOffset.left,this.plotOffset.top);for(i=0;i<this.series.length;i++){if(!this.series[i].hide)this.drawSeries(this.series[i]);}
context.restore();this.clip();}
E.fire(this.el,'flotr:afterdraw',[this.series,this]);if(after)after();},drawSeries:function(series){function drawChart(series,typeKey){var options=this.getOptions(series,typeKey);this[typeKey].draw(options);}
var drawn=false;series=series||this.series;_.each(flotr.graphTypes,function(type,typeKey){if(series[typeKey]&&series[typeKey].show&&this[typeKey]){drawn=true;drawChart.call(this,series,typeKey);}},this);if(!drawn)drawChart.call(this,series,this.options.defaultType);},getOptions:function(series,typeKey){var
type=series[typeKey],graphType=this[typeKey],options={context:this.ctx,width:this.plotWidth,height:this.plotHeight,fontSize:this.options.fontSize,fontColor:this.options.fontColor,textEnabled:this.textEnabled,htmlText:this.options.HtmlText,text:this._text,element:this.el,data:series.data,color:series.color,shadowSize:series.shadowSize,xScale:_.bind(series.xaxis.d2p,series.xaxis),yScale:_.bind(series.yaxis.d2p,series.yaxis)};options=flotr.merge(type,options);options.fillStyle=this.processColor(type.fillColor||series.color,{opacity:type.fillOpacity});return options;},getEventPosition:function(e){var
d=document,b=d.body,de=d.documentElement,axes=this.axes,plotOffset=this.plotOffset,lastMousePos=this.lastMousePos,pointer=E.eventPointer(e),dx=pointer.x-lastMousePos.pageX,dy=pointer.y-lastMousePos.pageY,r,rx,ry;if('ontouchstart'in this.el){r=D.position(this.overlay);rx=pointer.x-r.left-plotOffset.left;ry=pointer.y-r.top-plotOffset.top;}else{r=this.overlay.getBoundingClientRect();rx=e.clientX-r.left-plotOffset.left-b.scrollLeft-de.scrollLeft;ry=e.clientY-r.top-plotOffset.top-b.scrollTop-de.scrollTop;}
return{x:axes.x.p2d(rx),x2:axes.x2.p2d(rx),y:axes.y.p2d(ry),y2:axes.y2.p2d(ry),relX:rx,relY:ry,dX:dx,dY:dy,absX:pointer.x,absY:pointer.y,pageX:pointer.x,pageY:pointer.y};},clickHandler:function(event){if(this.ignoreClick){this.ignoreClick=false;return this.ignoreClick;}
E.fire(this.el,'flotr:click',[this.getEventPosition(event),this]);},mouseMoveHandler:function(event){if(this.mouseDownMoveHandler)return;var pos=this.getEventPosition(event);E.fire(this.el,'flotr:mousemove',[event,pos,this]);this.lastMousePos=pos;},mouseDownHandler:function(event){if(this.mouseUpHandler)return;this.mouseUpHandler=_.bind(function(e){E.stopObserving(document,'mouseup',this.mouseUpHandler);E.stopObserving(document,'mousemove',this.mouseDownMoveHandler);this.mouseDownMoveHandler=null;this.mouseUpHandler=null;E.fire(this.el,'flotr:mouseup',[e,this]);},this);this.mouseDownMoveHandler=_.bind(function(e){var pos=this.getEventPosition(e);E.fire(this.el,'flotr:mousemove',[event,pos,this]);this.lastMousePos=pos;},this);E.observe(document,'mouseup',this.mouseUpHandler);E.observe(document,'mousemove',this.mouseDownMoveHandler);E.fire(this.el,'flotr:mousedown',[event,this]);this.ignoreClick=false;},drawTooltip:function(content,x,y,options){var mt=this.getMouseTrack(),style='opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;',p=options.position,m=options.margin,plotOffset=this.plotOffset;if(x!==null&&y!==null){if(!options.relative){if(p.charAt(0)=='n')style+='top:'+(m+plotOffset.top)+'px;bottom:auto;';else if(p.charAt(0)=='s')style+='bottom:'+(m+plotOffset.bottom)+'px;top:auto;';if(p.charAt(1)=='e')style+='right:'+(m+plotOffset.right)+'px;left:auto;';else if(p.charAt(1)=='w')style+='left:'+(m+plotOffset.left)+'px;right:auto;';}
else{if(p.charAt(0)=='n')style+='bottom:'+(m-plotOffset.top-y+this.canvasHeight)+'px;top:auto;';else if(p.charAt(0)=='s')style+='top:'+(m+plotOffset.top+y)+'px;bottom:auto;';if(p.charAt(1)=='e')style+='left:'+(m+plotOffset.left+x)+'px;right:auto;';else if(p.charAt(1)=='w')style+='right:'+(m-plotOffset.left-x+this.canvasWidth)+'px;left:auto;';}
mt.style.cssText=style;D.empty(mt);D.insert(mt,content);D.show(mt);}
else{D.hide(mt);}},clip:function(){var
ctx=this.ctx,o=this.plotOffset,w=this.canvasWidth,h=this.canvasHeight;if(flotr.isIE&&flotr.isIE<9){ctx.save();ctx.fillStyle=this.processColor(this.options.ieBackgroundColor);ctx.fillRect(0,0,w,o.top);ctx.fillRect(0,0,o.left,h);ctx.fillRect(0,h-o.bottom,w,o.bottom);ctx.fillRect(w-o.right,0,o.right,h);ctx.restore();}else{ctx.clearRect(0,0,w,o.top);ctx.clearRect(0,0,o.left,h);ctx.clearRect(0,h-o.bottom,w,o.bottom);ctx.clearRect(w-o.right,0,o.right,h);}},_initMembers:function(){this._handles=[];this.lastMousePos={pageX:null,pageY:null};this.plotOffset={left:0,right:0,top:0,bottom:0};this.ignoreClick=true;this.prevHit=null;},_initGraphTypes:function(){_.each(flotr.graphTypes,function(handler,graphType){this[graphType]=flotr.clone(handler);},this);},_initEvents:function(){var
el=this.el,touchendHandler,movement,touchend;if('ontouchstart'in el){touchendHandler=_.bind(function(e){touchend=true;E.stopObserving(document,'touchend',touchendHandler);E.fire(el,'flotr:mouseup',[event,this]);this.multitouches=null;if(!movement){this.clickHandler(e);}},this);this.observe(this.overlay,'touchstart',_.bind(function(e){movement=false;touchend=false;this.ignoreClick=false;if(e.touches&&e.touches.length>1){this.multitouches=e.touches;}
E.fire(el,'flotr:mousedown',[event,this]);this.observe(document,'touchend',touchendHandler);},this));this.observe(this.overlay,'touchmove',_.bind(function(e){var pos=this.getEventPosition(e);e.preventDefault();movement=true;if(this.multitouches||(e.touches&&e.touches.length>1)){this.multitouches=e.touches;}else{if(!touchend){E.fire(el,'flotr:mousemove',[event,pos,this]);}}
this.lastMousePos=pos;},this));}else{this.observe(this.overlay,'mousedown',_.bind(this.mouseDownHandler,this)).observe(el,'mousemove',_.bind(this.mouseMoveHandler,this)).observe(this.overlay,'click',_.bind(this.clickHandler,this)).observe(el,'mouseout',function(){E.fire(el,'flotr:mouseout');});}},_initCanvas:function(){var el=this.el,o=this.options,children=el.children,removedChildren=[],child,i,size,style;for(i=children.length;i--;){child=children[i];if(!this.canvas&&child.className==='flotr-canvas'){this.canvas=child;}else if(!this.overlay&&child.className==='flotr-overlay'){this.overlay=child;}else{removedChildren.push(child);}}
for(i=removedChildren.length;i--;){el.removeChild(removedChildren[i]);}
D.setStyles(el,{position:'relative'});size={};size.width=el.clientWidth;size.height=el.clientHeight;if(size.width<=0||size.height<=0||o.resolution<=0){throw'Invalid dimensions for plot, width = '+size.width+', height = '+size.height+', resolution = '+o.resolution;}
this.canvas=getCanvas(this.canvas,'canvas');this.overlay=getCanvas(this.overlay,'overlay');this.ctx=getContext(this.canvas);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.octx=getContext(this.overlay);this.octx.clearRect(0,0,this.overlay.width,this.overlay.height);this.canvasHeight=size.height;this.canvasWidth=size.width;this.textEnabled=!!this.ctx.drawText||!!this.ctx.fillText;function getCanvas(canvas,name){if(!canvas){canvas=D.create('canvas');if(typeof FlashCanvas!="undefined"&&typeof canvas.getContext==='function'){FlashCanvas.initElement(canvas);}
canvas.className='flotr-'+name;canvas.style.cssText='position:absolute;left:0px;top:0px;';D.insert(el,canvas);}
_.each(size,function(size,attribute){D.show(canvas);if(name=='canvas'&&canvas.getAttribute(attribute)===size){return;}
canvas.setAttribute(attribute,size*o.resolution);canvas.style[attribute]=size+'px';});canvas.context_=null;return canvas;}
function getContext(canvas){if(window.G_vmlCanvasManager)window.G_vmlCanvasManager.initElement(canvas);var context=canvas.getContext('2d');if(!window.G_vmlCanvasManager)context.scale(o.resolution,o.resolution);return context;}},_initPlugins:function(){_.each(flotr.plugins,function(plugin,name){_.each(plugin.callbacks,function(fn,c){this.observe(this.el,c,_.bind(fn,this));},this);this[name]=flotr.clone(plugin);_.each(this[name],function(fn,p){if(_.isFunction(fn))
this[name][p]=_.bind(fn,this);},this);},this);},_initOptions:function(opts){var options=flotr.clone(flotr.defaultOptions);options.x2axis=_.extend(_.clone(options.xaxis),options.x2axis);options.y2axis=_.extend(_.clone(options.yaxis),options.y2axis);this.options=flotr.merge(opts||{},options);if(this.options.grid.minorVerticalLines===null&&this.options.xaxis.scaling==='logarithmic'){this.options.grid.minorVerticalLines=true;}
if(this.options.grid.minorHorizontalLines===null&&this.options.yaxis.scaling==='logarithmic'){this.options.grid.minorHorizontalLines=true;}
E.fire(this.el,'flotr:afterinitoptions',[this]);this.axes=flotr.Axis.getAxes(this.options);var assignedColors=[],colors=[],ln=this.series.length,neededColors=this.series.length,oc=this.options.colors,usedColors=[],variation=0,c,i,j,s;for(i=neededColors-1;i>-1;--i){c=this.series[i].color;if(c){--neededColors;if(_.isNumber(c))assignedColors.push(c);else usedColors.push(flotr.Color.parse(c));}}
for(i=assignedColors.length-1;i>-1;--i)
neededColors=Math.max(neededColors,assignedColors[i]+1);for(i=0;colors.length<neededColors;){c=(oc.length==i)?new flotr.Color(100,100,100):flotr.Color.parse(oc[i]);var sign=variation%2==1?-1:1,factor=1+sign*Math.ceil(variation/2)*0.2;c.scale(factor,factor,factor);colors.push(c);if(++i>=oc.length){i=0;++variation;}}
for(i=0,j=0;i<ln;++i){s=this.series[i];if(!s.color){s.color=colors[j++].toString();}else if(_.isNumber(s.color)){s.color=colors[s.color].toString();}
if(!s.xaxis)s.xaxis=this.axes.x;if(s.xaxis==1)s.xaxis=this.axes.x;else if(s.xaxis==2)s.xaxis=this.axes.x2;if(!s.yaxis)s.yaxis=this.axes.y;if(s.yaxis==1)s.yaxis=this.axes.y;else if(s.yaxis==2)s.yaxis=this.axes.y2;for(var t in flotr.graphTypes){s[t]=_.extend(_.clone(this.options[t]),s[t]);}
s.mouse=_.extend(_.clone(this.options.mouse),s.mouse);if(_.isUndefined(s.shadowSize))s.shadowSize=this.options.shadowSize;}},_setEl:function(el){if(!el)throw'The target container doesn\'t exist';else if(el.graph instanceof Graph)el.graph.destroy();else if(!el.clientWidth)throw'The target container must be visible';el.graph=this;this.el=el;}};Flotr.Graph=Graph;})();;(function(){var
_=Flotr._,LOGARITHMIC='logarithmic';function Axis(o){this.orientation=1;this.offset=0;this.datamin=Number.MAX_VALUE;this.datamax=-Number.MAX_VALUE;_.extend(this,o);this._setTranslations();}
Axis.prototype={setScale:function(){var length=this.length;if(this.options.scaling==LOGARITHMIC){this.scale=length/(log(this.max,this.options.base)-log(this.min,this.options.base));}else{this.scale=length/(this.max-this.min);}},calculateTicks:function(){var options=this.options;this.ticks=[];this.minorTicks=[];if(options.ticks){this._cleanUserTicks(options.ticks,this.ticks);this._cleanUserTicks(options.minorTicks||[],this.minorTicks);}
else{if(options.mode=='time'){this._calculateTimeTicks();}else if(options.scaling==='logarithmic'){this._calculateLogTicks();}else{this._calculateTicks();}}},calculateRange:function(){if(!this.used)return;var axis=this,o=axis.options,min=o.min!==null?o.min:axis.datamin,max=o.max!==null?o.max:axis.datamax,margin=o.autoscaleMargin;if(o.scaling=='logarithmic'){if(min<=0)min=axis.datamin;if(max<=0)max=min;}
if(max==min){var widen=max?0.01:1.00;if(o.min===null)min-=widen;if(o.max===null)max+=widen;}
if(o.scaling==='logarithmic'){if(min<0)min=max/o.base;var maxexp=Math.log(max);if(o.base!=Math.E)maxexp/=Math.log(o.base);maxexp=Math.ceil(maxexp);var minexp=Math.log(min);if(o.base!=Math.E)minexp/=Math.log(o.base);minexp=Math.ceil(minexp);axis.tickSize=Flotr.getTickSize(o.noTicks,minexp,maxexp,o.tickDecimals===null?0:o.tickDecimals);if(o.minorTickFreq===null){if(maxexp-minexp>10)
o.minorTickFreq=0;else if(maxexp-minexp>5)
o.minorTickFreq=2;else
o.minorTickFreq=5;}}else{axis.tickSize=Flotr.getTickSize(o.noTicks,min,max,o.tickDecimals);}
axis.min=min;axis.max=max;if(o.min===null&&o.autoscale){axis.min-=axis.tickSize*margin;if(axis.min<0&&axis.datamin>=0)axis.min=0;axis.min=axis.tickSize*Math.floor(axis.min/axis.tickSize);}
if(o.max===null&&o.autoscale){axis.max+=axis.tickSize*margin;if(axis.max>0&&axis.datamax<=0&&axis.datamax!=axis.datamin)axis.max=0;axis.max=axis.tickSize*Math.ceil(axis.max/axis.tickSize);}
if(axis.min==axis.max)axis.max=axis.min+1;},calculateTextDimensions:function(T,options){var maxLabel='',length,i;if(this.options.showLabels){for(i=0;i<this.ticks.length;++i){length=this.ticks[i].label.length;if(length>maxLabel.length){maxLabel=this.ticks[i].label;}}}
this.maxLabel=T.dimensions(maxLabel,{size:options.fontSize,angle:Flotr.toRad(this.options.labelsAngle)},'font-size:smaller;','flotr-grid-label');this.titleSize=T.dimensions(this.options.title,{size:options.fontSize*1.2,angle:Flotr.toRad(this.options.titleAngle)},'font-weight:bold;','flotr-axis-title');},_cleanUserTicks:function(ticks,axisTicks){var axis=this,options=this.options,v,i,label,tick;if(_.isFunction(ticks))ticks=ticks({min:axis.min,max:axis.max});for(i=0;i<ticks.length;++i){tick=ticks[i];if(typeof(tick)==='object'){v=tick[0];label=(tick.length>1)?tick[1]:options.tickFormatter(v,{min:axis.min,max:axis.max});}else{v=tick;label=options.tickFormatter(v,{min:this.min,max:this.max});}
axisTicks[i]={v:v,label:label};}},_calculateTimeTicks:function(){this.ticks=Flotr.Date.generator(this);},_calculateLogTicks:function(){var axis=this,o=axis.options,v,decadeStart;var max=Math.log(axis.max);if(o.base!=Math.E)max/=Math.log(o.base);max=Math.ceil(max);var min=Math.log(axis.min);if(o.base!=Math.E)min/=Math.log(o.base);min=Math.ceil(min);for(i=min;i<max;i+=axis.tickSize){decadeStart=(o.base==Math.E)?Math.exp(i):Math.pow(o.base,i);var decadeEnd=decadeStart*((o.base==Math.E)?Math.exp(axis.tickSize):Math.pow(o.base,axis.tickSize));var stepSize=(decadeEnd-decadeStart)/o.minorTickFreq;axis.ticks.push({v:decadeStart,label:o.tickFormatter(decadeStart,{min:axis.min,max:axis.max})});for(v=decadeStart+stepSize;v<decadeEnd;v+=stepSize)
axis.minorTicks.push({v:v,label:o.tickFormatter(v,{min:axis.min,max:axis.max})});}
decadeStart=(o.base==Math.E)?Math.exp(i):Math.pow(o.base,i);axis.ticks.push({v:decadeStart,label:o.tickFormatter(decadeStart,{min:axis.min,max:axis.max})});},_calculateTicks:function(){var axis=this,o=axis.options,tickSize=axis.tickSize,min=axis.min,max=axis.max,start=tickSize*Math.ceil(min/tickSize),decimals,minorTickSize,v,v2,i,j;if(o.minorTickFreq)
minorTickSize=tickSize/o.minorTickFreq;for(i=0;(v=v2=start+i*tickSize)<=max;++i){decimals=o.tickDecimals;if(decimals===null)decimals=1-Math.floor(Math.log(tickSize)/Math.LN10);if(decimals<0)decimals=0;v=v.toFixed(decimals);axis.ticks.push({v:v,label:o.tickFormatter(v,{min:axis.min,max:axis.max})});if(o.minorTickFreq){for(j=0;j<o.minorTickFreq&&(i*tickSize+j*minorTickSize)<max;++j){v=v2+j*minorTickSize;axis.minorTicks.push({v:v,label:o.tickFormatter(v,{min:axis.min,max:axis.max})});}}}},_setTranslations:function(logarithmic){this.d2p=(logarithmic?d2pLog:d2p);this.p2d=(logarithmic?p2dLog:p2d);}};_.extend(Axis,{getAxes:function(options){return{x:new Axis({options:options.xaxis,n:1,length:this.plotWidth}),x2:new Axis({options:options.x2axis,n:2,length:this.plotWidth}),y:new Axis({options:options.yaxis,n:1,length:this.plotHeight,offset:this.plotHeight,orientation:-1}),y2:new Axis({options:options.y2axis,n:2,length:this.plotHeight,offset:this.plotHeight,orientation:-1})};}});function d2p(dataValue){return this.offset+this.orientation*(dataValue-this.min)*this.scale;}
function p2d(pointValue){return(this.offset+this.orientation*pointValue)/this.scale+this.min;}
function d2pLog(dataValue){return this.offset+this.orientation*(log(dataValue,this.options.base)-log(this.min,this.options.base))*this.scale;}
function p2dLog(pointValue){return exp((this.offset+this.orientation*pointValue)/this.scale+log(this.min,this.options.base),this.options.base);}
function log(value,base){value=Math.log(Math.max(value,Number.MIN_VALUE));if(base!==Math.E)
value/=Math.log(base);return value;}
function exp(value,base){return(base===Math.E)?Math.exp(value):Math.pow(base,value);}
Flotr.Axis=Axis;})();;(function(){var
_=Flotr._;function Series(o){_.extend(this,o);}
Series.prototype={getRange:function(){var
data=this.data,length=data.length,xmin=Number.MAX_VALUE,ymin=Number.MAX_VALUE,xmax=-Number.MAX_VALUE,ymax=-Number.MAX_VALUE,xused=false,yused=false,x,y,i;if(length<0||this.hide)return false;for(i=0;i<length;i++){x=data[i][0];y=data[i][1];if(x<xmin){xmin=x;xused=true;}
if(x>xmax){xmax=x;xused=true;}
if(y<ymin){ymin=y;yused=true;}
if(y>ymax){ymax=y;yused=true;}}
return{xmin:xmin,xmax:xmax,ymin:ymin,ymax:ymax,xused:xused,yused:yused};}};_.extend(Series,{getSeries:function(data){return _.map(data,function(s){var series;if(s.data){series=new Series();_.extend(series,s);}else{series=new Series({data:s});}
return series;});}});Flotr.Series=Series;})();;Flotr.addType('lines',{options:{show:false,lineWidth:2,fill:false,fillBorder:false,fillColor:null,fillOpacity:0.4,steps:false,stacked:false},stack:{values:[]},draw:function(options){var
context=options.context,lineWidth=options.lineWidth,shadowSize=options.shadowSize,offset;context.save();context.lineJoin='round';if(shadowSize){context.lineWidth=shadowSize/2;offset=lineWidth/2+context.lineWidth/2;context.strokeStyle="rgba(0,0,0,0.1)";this.plot(options,offset+shadowSize/2,false);context.strokeStyle="rgba(0,0,0,0.2)";this.plot(options,offset,false);}
context.lineWidth=lineWidth;context.strokeStyle=options.color;this.plot(options,0,true);context.restore();},plot:function(options,shadowOffset,incStack){var
context=options.context,width=options.width,height=options.height,xScale=options.xScale,yScale=options.yScale,data=options.data,stack=options.stacked?this.stack:false,length=data.length-1,prevx=null,prevy=null,zero=yScale(0),x1,x2,y1,y2,stack1,stack2,i;if(length<1)return;context.beginPath();for(i=0;i<length;++i){if(data[i][1]===null||data[i+1][1]===null)continue;x1=xScale(data[i][0]);x2=xScale(data[i+1][0]);if(stack){stack1=stack.values[data[i][0]]||0;stack2=stack.values[data[i+1][0]]||stack.values[data[i][0]]||0;y1=yScale(data[i][1]+stack1);y2=yScale(data[i+1][1]+stack2);if(incStack){stack.values[data[i][0]]=data[i][1]+stack1;if(i==length-1)
stack.values[data[i+1][0]]=data[i+1][1]+stack2;}}
else{y1=yScale(data[i][1]);y2=yScale(data[i+1][1]);}
if((y1>height&&y2>height)||(y1<0&&y2<0)||(x1<0&&x2<0)||(x1>width&&x2>width))continue;if((prevx!=x1)||(prevy!=y1+shadowOffset))
context.moveTo(x1,y1+shadowOffset);prevx=x2;prevy=y2+shadowOffset;if(options.steps){context.lineTo(prevx+shadowOffset/2,y1+shadowOffset);context.lineTo(prevx+shadowOffset/2,prevy);}else{context.lineTo(prevx,prevy);}}
if(!options.fill||options.fill&&!options.fillBorder)context.stroke();if(!shadowOffset&&options.fill){x1=xScale(data[0][0]);context.fillStyle=options.fillStyle;context.lineTo(x2,zero);context.lineTo(x1,zero);context.lineTo(x1,yScale(data[0][1]));context.fill();if(options.fillBorder){context.stroke();}}
context.closePath();},extendYRange:function(axis,data,options,lines){var o=axis.options;if(options.stacked&&((!o.max&&o.max!==0)||(!o.min&&o.min!==0))){var
newmax=axis.max,newmin=axis.min,positiveSums=lines.positiveSums||{},negativeSums=lines.negativeSums||{},x,j;for(j=0;j<data.length;j++){x=data[j][0]+'';if(data[j][1]>0){positiveSums[x]=(positiveSums[x]||0)+data[j][1];newmax=Math.max(newmax,positiveSums[x]);}
else{negativeSums[x]=(negativeSums[x]||0)+data[j][1];newmin=Math.min(newmin,negativeSums[x]);}}
lines.negativeSums=negativeSums;lines.positiveSums=positiveSums;axis.max=newmax;axis.min=newmin;}
if(options.steps){this.hit=function(options){var
data=options.data,args=options.args,yScale=options.yScale,mouse=args[0],length=data.length,n=args[1],x=mouse.x,relY=mouse.relY,i;for(i=0;i<length-1;i++){if(x>=data[i][0]&&x<=data[i+1][0]){if(Math.abs(yScale(data[i][1])-relY)<8){n.x=data[i][0];n.y=data[i][1];n.index=i;n.seriesIndex=options.index;}
break;}}};this.drawHit=function(options){var
context=options.context,args=options.args,data=options.data,xScale=options.xScale,index=args.index,x=xScale(args.x),y=options.yScale(args.y),x2;if(data.length-1>index){x2=options.xScale(data[index+1][0]);context.save();context.strokeStyle=options.color;context.lineWidth=options.lineWidth;context.beginPath();context.moveTo(x,y);context.lineTo(x2,y);context.stroke();context.closePath();context.restore();}};this.clearHit=function(options){var
context=options.context,args=options.args,data=options.data,xScale=options.xScale,width=options.lineWidth,index=args.index,x=xScale(args.x),y=options.yScale(args.y),x2;if(data.length-1>index){x2=options.xScale(data[index+1][0]);context.clearRect(x-width,y-width,x2-x+2*width,2*width);}};}}});;Flotr.addType('bars',{options:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,fillOpacity:0.4,horizontal:false,stacked:false,centered:true,topPadding:0.1},stack:{positive:[],negative:[],_positive:[],_negative:[]},draw:function(options){var
context=options.context;context.save();context.lineJoin='miter';context.lineWidth=options.lineWidth;context.strokeStyle=options.color;if(options.fill)context.fillStyle=options.fillStyle;this.plot(options);context.restore();},plot:function(options){var
data=options.data,context=options.context,shadowSize=options.shadowSize,i,geometry,left,top,width,height;if(data.length<1)return;this.translate(context,options.horizontal);for(i=0;i<data.length;i++){geometry=this.getBarGeometry(data[i][0],data[i][1],options);if(geometry===null)continue;left=geometry.left;top=geometry.top;width=geometry.width;height=geometry.height;if(options.fill)context.fillRect(left,top,width,height);if(shadowSize){context.save();context.fillStyle='rgba(0,0,0,0.05)';context.fillRect(left+shadowSize,top+shadowSize,width,height);context.restore();}
if(options.lineWidth){context.strokeRect(left,top,width,height);}}},translate:function(context,horizontal){if(horizontal){context.rotate(-Math.PI/2);context.scale(-1,1);}},getBarGeometry:function(x,y,options){var
horizontal=options.horizontal,barWidth=options.barWidth,centered=options.centered,stack=options.stacked?this.stack:false,lineWidth=options.lineWidth,bisection=centered?barWidth/2:0,xScale=horizontal?options.yScale:options.xScale,yScale=horizontal?options.xScale:options.yScale,xValue=horizontal?y:x,yValue=horizontal?x:y,stackOffset=0,stackValue,left,right,top,bottom;if(stack){stackValue=yValue>0?stack.positive:stack.negative;stackOffset=stackValue[xValue]||stackOffset;stackValue[xValue]=stackOffset+yValue;}
left=xScale(xValue-bisection);right=xScale(xValue+barWidth-bisection);top=yScale(yValue+stackOffset);bottom=yScale(stackOffset);if(bottom<0)bottom=0;return(x===null||y===null)?null:{x:xValue,y:yValue,xScale:xScale,yScale:yScale,top:top,left:Math.min(left,right)-lineWidth/2,width:Math.abs(right-left)-lineWidth,height:bottom-top};},hit:function(options){var
data=options.data,args=options.args,mouse=args[0],n=args[1],x=mouse.x,y=mouse.y,hitGeometry=this.getBarGeometry(x,y,options),width=hitGeometry.width/2,left=hitGeometry.left,geometry,i;for(i=data.length;i--;){geometry=this.getBarGeometry(data[i][0],data[i][1],options);if(geometry.y>hitGeometry.y&&Math.abs(left-geometry.left)<width){n.x=data[i][0];n.y=data[i][1];n.index=i;n.seriesIndex=options.index;}}},drawHit:function(options){var
context=options.context,args=options.args,geometry=this.getBarGeometry(args.x,args.y,options),left=geometry.left,top=geometry.top,width=geometry.width,height=geometry.height;context.save();context.strokeStyle=options.color;context.lineWidth=options.lineWidth;this.translate(context,options.horizontal);context.beginPath();context.moveTo(left,top+height);context.lineTo(left,top);context.lineTo(left+width,top);context.lineTo(left+width,top+height);if(options.fill){context.fillStyle=options.fillStyle;context.fill();}
context.stroke();context.closePath();context.restore();},clearHit:function(options){var
context=options.context,args=options.args,geometry=this.getBarGeometry(args.x,args.y,options),left=geometry.left,width=geometry.width,top=geometry.top,height=geometry.height,lineWidth=2*options.lineWidth;context.save();this.translate(context,options.horizontal);context.clearRect(left-lineWidth,Math.min(top,top+height)-lineWidth,width+2*lineWidth,Math.abs(height)+2*lineWidth);context.restore();},extendXRange:function(axis,data,options,bars){this._extendRange(axis,data,options,bars);},extendYRange:function(axis,data,options,bars){this._extendRange(axis,data,options,bars);},_extendRange:function(axis,data,options,bars){var
max=axis.options.max;if(_.isNumber(max)||_.isString(max))return;var
newmin=axis.min,newmax=axis.max,horizontal=options.horizontal,orientation=axis.orientation,positiveSums=this.positiveSums||{},negativeSums=this.negativeSums||{},value,datum,index,j;if((orientation==1&&!horizontal)||(orientation==-1&&horizontal)){if(options.centered){newmax=Math.max(axis.datamax+options.barWidth,newmax);newmin=Math.min(axis.datamin-options.barWidth,newmin);}}
if(options.stacked&&((orientation==1&&horizontal)||(orientation==-1&&!horizontal))){for(j=data.length;j--;){value=data[j][(orientation==1?1:0)]+'';datum=data[j][(orientation==1?0:1)];if(datum>0){positiveSums[value]=(positiveSums[value]||0)+datum;newmax=Math.max(newmax,positiveSums[value]);}
else{negativeSums[value]=(negativeSums[value]||0)+datum;newmin=Math.min(newmin,negativeSums[value]);}}}
if((orientation==1&&horizontal)||(orientation==-1&&!horizontal)){if(options.topPadding&&(axis.max===axis.datamax||(options.stacked&&this.stackMax!==newmax))){newmax+=options.topPadding*(newmax-newmin);}}
this.stackMin=newmin;this.stackMax=newmax;this.negativeSums=negativeSums;this.positiveSums=positiveSums;axis.max=newmax;axis.min=newmin;}});;Flotr.addType('bubbles',{options:{show:false,lineWidth:2,fill:true,fillOpacity:0.4,baseRadius:2},draw:function(options){var
context=options.context,shadowSize=options.shadowSize;context.save();context.lineWidth=options.lineWidth;context.fillStyle='rgba(0,0,0,0.05)';context.strokeStyle='rgba(0,0,0,0.05)';this.plot(options,shadowSize/2);context.strokeStyle='rgba(0,0,0,0.1)';this.plot(options,shadowSize/4);context.strokeStyle=options.color;context.fillStyle=options.fillStyle;this.plot(options);context.restore();},plot:function(options,offset){var
data=options.data,context=options.context,geometry,i,x,y,z;offset=offset||0;for(i=0;i<data.length;++i){geometry=this.getGeometry(data[i],options);context.beginPath();context.arc(geometry.x+offset,geometry.y+offset,geometry.z,0,2*Math.PI,true);context.stroke();if(options.fill)context.fill();context.closePath();}},getGeometry:function(point,options){return{x:options.xScale(point[0]),y:options.yScale(point[1]),z:point[2]*options.baseRadius};},hit:function(options){var
data=options.data,args=options.args,mouse=args[0],n=args[1],x=mouse.x,y=mouse.y,geometry,dx,dy;for(i=data.length;i--;){geometry=this.getGeometry(data[i],options);dx=geometry.x-options.xScale(x);dy=geometry.y-options.yScale(y);if(Math.sqrt(dx*dx+dy*dy)<geometry.z){n.x=data[i][0];n.y=data[i][1];n.index=i;n.seriesIndex=options.index;}}},drawHit:function(options){var
context=options.context,geometry=this.getGeometry(options.data[options.args.index],options);context.save();context.lineWidth=options.lineWidth;context.fillStyle=options.fillStyle;context.strokeStyle=options.color;context.beginPath();context.arc(geometry.x,geometry.y,geometry.z,0,2*Math.PI,true);context.fill();context.stroke();context.closePath();context.restore();},clearHit:function(options){var
context=options.context,geometry=this.getGeometry(options.data[options.args.index],options),offset=geometry.z+options.lineWidth;context.save();context.clearRect(geometry.x-offset,geometry.y-offset,2*offset,2*offset);context.restore();}});;Flotr.addType('candles',{options:{show:false,lineWidth:1,wickLineWidth:1,candleWidth:0.6,fill:true,upFillColor:'#00A8F0',downFillColor:'#CB4B4B',fillOpacity:0.5,barcharts:false},draw:function(options){var
context=options.context;context.save();context.lineJoin='miter';context.lineCap='butt';context.lineWidth=options.wickLineWidth||options.lineWidth;this.plot(options);context.restore();},plot:function(options){var
data=options.data,context=options.context,xScale=options.xScale,yScale=options.yScale,width=options.candleWidth/2,shadowSize=options.shadowSize,lineWidth=options.lineWidth,wickLineWidth=options.wickLineWidth,pixelOffset=(wickLineWidth%2)/2,color,datum,x,y,open,high,low,close,left,right,bottom,top,bottom2,top2,i;if(data.length<1)return;for(i=0;i<data.length;i++){datum=data[i];x=datum[0];open=datum[1];high=datum[2];low=datum[3];close=datum[4];left=xScale(x-width);right=xScale(x+width);bottom=yScale(low);top=yScale(high);bottom2=yScale(Math.min(open,close));top2=yScale(Math.max(open,close));color=options[open>close?'downFillColor':'upFillColor'];if(options.fill&&!options.barcharts){context.fillStyle='rgba(0,0,0,0.05)';context.fillRect(left+shadowSize,top2+shadowSize,right-left,bottom2-top2);context.save();context.globalAlpha=options.fillOpacity;context.fillStyle=color;context.fillRect(left,top2+lineWidth,right-left,bottom2-top2);context.restore();}
if(lineWidth||wickLineWidth){x=Math.floor((left+right)/2)+pixelOffset;context.strokeStyle=color;context.beginPath();if(options.barcharts){context.moveTo(x,Math.floor(top+width));context.lineTo(x,Math.floor(bottom+width));y=Math.floor(open+width)+0.5;context.moveTo(Math.floor(left)+pixelOffset,y);context.lineTo(x,y);y=Math.floor(close+width)+0.5;context.moveTo(Math.floor(right)+pixelOffset,y);context.lineTo(x,y);}else{context.strokeRect(left,top2+lineWidth,right-left,bottom2-top2);context.moveTo(x,Math.floor(top2+lineWidth));context.lineTo(x,Math.floor(top+lineWidth));context.moveTo(x,Math.floor(bottom2+lineWidth));context.lineTo(x,Math.floor(bottom+lineWidth));}
context.closePath();context.stroke();}}},extendXRange:function(axis,data,options){if(axis.options.max===null){axis.max=Math.max(axis.datamax+0.5,axis.max);axis.min=Math.min(axis.datamin-0.5,axis.min);}}});;Flotr.addType('gantt',{options:{show:false,lineWidth:2,barWidth:1,fill:true,fillColor:null,fillOpacity:0.4,centered:true},draw:function(series){var ctx=this.ctx,bw=series.gantt.barWidth,lw=Math.min(series.gantt.lineWidth,bw);ctx.save();ctx.translate(this.plotOffset.left,this.plotOffset.top);ctx.lineJoin='miter';ctx.lineWidth=lw;ctx.strokeStyle=series.color;ctx.save();this.gantt.plotShadows(series,bw,0,series.gantt.fill);ctx.restore();if(series.gantt.fill){var color=series.gantt.fillColor||series.color;ctx.fillStyle=this.processColor(color,{opacity:series.gantt.fillOpacity});}
this.gantt.plot(series,bw,0,series.gantt.fill);ctx.restore();},plot:function(series,barWidth,offset,fill){var data=series.data;if(data.length<1)return;var xa=series.xaxis,ya=series.yaxis,ctx=this.ctx,i;for(i=0;i<data.length;i++){var y=data[i][0],s=data[i][1],d=data[i][2],drawLeft=true,drawTop=true,drawRight=true;if(s===null||d===null)continue;var left=s,right=s+d,bottom=y-(series.gantt.centered?barWidth/2:0),top=y+barWidth-(series.gantt.centered?barWidth/2:0);if(right<xa.min||left>xa.max||top<ya.min||bottom>ya.max)
continue;if(left<xa.min){left=xa.min;drawLeft=false;}
if(right>xa.max){right=xa.max;if(xa.lastSerie!=series)
drawTop=false;}
if(bottom<ya.min)
bottom=ya.min;if(top>ya.max){top=ya.max;if(ya.lastSerie!=series)
drawTop=false;}
if(fill){ctx.beginPath();ctx.moveTo(xa.d2p(left),ya.d2p(bottom)+offset);ctx.lineTo(xa.d2p(left),ya.d2p(top)+offset);ctx.lineTo(xa.d2p(right),ya.d2p(top)+offset);ctx.lineTo(xa.d2p(right),ya.d2p(bottom)+offset);ctx.fill();ctx.closePath();}
if(series.gantt.lineWidth&&(drawLeft||drawRight||drawTop)){ctx.beginPath();ctx.moveTo(xa.d2p(left),ya.d2p(bottom)+offset);ctx[drawLeft?'lineTo':'moveTo'](xa.d2p(left),ya.d2p(top)+offset);ctx[drawTop?'lineTo':'moveTo'](xa.d2p(right),ya.d2p(top)+offset);ctx[drawRight?'lineTo':'moveTo'](xa.d2p(right),ya.d2p(bottom)+offset);ctx.stroke();ctx.closePath();}}},plotShadows:function(series,barWidth,offset){var data=series.data;if(data.length<1)return;var i,y,s,d,xa=series.xaxis,ya=series.yaxis,ctx=this.ctx,sw=this.options.shadowSize;for(i=0;i<data.length;i++){y=data[i][0];s=data[i][1];d=data[i][2];if(s===null||d===null)continue;var left=s,right=s+d,bottom=y-(series.gantt.centered?barWidth/2:0),top=y+barWidth-(series.gantt.centered?barWidth/2:0);if(right<xa.min||left>xa.max||top<ya.min||bottom>ya.max)
continue;if(left<xa.min)left=xa.min;if(right>xa.max)right=xa.max;if(bottom<ya.min)bottom=ya.min;if(top>ya.max)top=ya.max;var width=xa.d2p(right)-xa.d2p(left)-((xa.d2p(right)+sw<=this.plotWidth)?0:sw);var height=ya.d2p(bottom)-ya.d2p(top)-((ya.d2p(bottom)+sw<=this.plotHeight)?0:sw);ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(Math.min(xa.d2p(left)+sw,this.plotWidth),Math.min(ya.d2p(top)+sw,this.plotHeight),width,height);}},extendXRange:function(axis){if(axis.options.max===null){var newmin=axis.min,newmax=axis.max,i,j,x,s,g,stackedSumsPos={},stackedSumsNeg={},lastSerie=null;for(i=0;i<this.series.length;++i){s=this.series[i];g=s.gantt;if(g.show&&s.xaxis==axis){for(j=0;j<s.data.length;j++){if(g.show){y=s.data[j][0]+'';stackedSumsPos[y]=Math.max((stackedSumsPos[y]||0),s.data[j][1]+s.data[j][2]);lastSerie=s;}}
for(j in stackedSumsPos){newmax=Math.max(stackedSumsPos[j],newmax);}}}
axis.lastSerie=lastSerie;axis.max=newmax;axis.min=newmin;}},extendYRange:function(axis){if(axis.options.max===null){var newmax=Number.MIN_VALUE,newmin=Number.MAX_VALUE,i,j,s,g,stackedSumsPos={},stackedSumsNeg={},lastSerie=null;for(i=0;i<this.series.length;++i){s=this.series[i];g=s.gantt;if(g.show&&!s.hide&&s.yaxis==axis){var datamax=Number.MIN_VALUE,datamin=Number.MAX_VALUE;for(j=0;j<s.data.length;j++){datamax=Math.max(datamax,s.data[j][0]);datamin=Math.min(datamin,s.data[j][0]);}
if(g.centered){newmax=Math.max(datamax+0.5,newmax);newmin=Math.min(datamin-0.5,newmin);}
else{newmax=Math.max(datamax+1,newmax);newmin=Math.min(datamin,newmin);}
if(g.barWidth+datamax>newmax){newmax=axis.max+g.barWidth;}}}
axis.lastSerie=lastSerie;axis.max=newmax;axis.min=newmin;axis.tickSize=Flotr.getTickSize(axis.options.noTicks,newmin,newmax,axis.options.tickDecimals);}}});;(function(){Flotr.defaultMarkerFormatter=function(obj){return(Math.round(obj.y*100)/100)+'';};Flotr.addType('markers',{options:{show:false,lineWidth:1,color:'#000000',fill:false,fillColor:"#FFFFFF",fillOpacity:0.4,stroke:false,position:'ct',verticalMargin:0,labelFormatter:Flotr.defaultMarkerFormatter,fontSize:Flotr.defaultOptions.fontSize,stacked:false,stackingType:'b',horizontal:false},stack:{positive:[],negative:[],values:[]},draw:function(options){var
data=options.data,context=options.context,stack=options.stacked?options.stack:false,stackType=options.stackingType,stackOffsetNeg,stackOffsetPos,stackOffset,i,x,y,label;context.save();context.lineJoin='round';context.lineWidth=options.lineWidth;context.strokeStyle='rgba(0,0,0,0.5)';context.fillStyle=options.fillStyle;function stackPos(a,b){stackOffsetPos=stack.negative[a]||0;stackOffsetNeg=stack.positive[a]||0;if(b>0){stack.positive[a]=stackOffsetPos+b;return stackOffsetPos+b;}else{stack.negative[a]=stackOffsetNeg+b;return stackOffsetNeg+b;}}
for(i=0;i<data.length;++i){x=data[i][0];y=data[i][1];if(stack){if(stackType=='b'){if(options.horizontal)y=stackPos(y,x);else x=stackPos(x,y);}else if(stackType=='a'){stackOffset=stack.values[x]||0;stack.values[x]=stackOffset+y;y=stackOffset+y;}}
label=options.labelFormatter({x:x,y:y,index:i,data:data});this.plot(options.xScale(x),options.yScale(y),label,options);}
context.restore();},plot:function(x,y,label,options){var context=options.context;if(isImage(label)&&!label.complete){throw'Marker image not loaded.';}else{this._plot(x,y,label,options);}},_plot:function(x,y,label,options){var context=options.context,margin=2,left=x,top=y,dim;if(isImage(label))
dim={height:label.height,width:label.width};else
dim=options.text.canvas(label);dim.width=Math.floor(dim.width+margin*2);dim.height=Math.floor(dim.height+margin*2);if(options.position.indexOf('c')!=-1)left-=dim.width/2+margin;else if(options.position.indexOf('l')!=-1)left-=dim.width;if(options.position.indexOf('m')!=-1)top-=dim.height/2+margin;else if(options.position.indexOf('t')!=-1)top-=dim.height+options.verticalMargin;else top+=options.verticalMargin;left=Math.floor(left)+0.5;top=Math.floor(top)+0.5;if(options.fill)
context.fillRect(left,top,dim.width,dim.height);if(options.stroke)
context.strokeRect(left,top,dim.width,dim.height);if(isImage(label))
context.drawImage(label,left+margin,top+margin);else
Flotr.drawText(context,label,left+margin,top+margin,{textBaseline:'top',textAlign:'left',size:options.fontSize,color:options.color});}});function isImage(i){return typeof i==='object'&&i.constructor&&(Image?true:i.constructor===Image);}})();;(function(){var
_=Flotr._;Flotr.defaultPieLabelFormatter=function(total,value){return(100*value/total).toFixed(2)+'%';};Flotr.addType('pie',{options:{show:false,lineWidth:1,fill:true,fillColor:null,fillOpacity:0.6,explode:6,sizeRatio:0.6,startAngle:Math.PI/4,labelFormatter:Flotr.defaultPieLabelFormatter,pie3D:false,pie3DviewAngle:(Math.PI/2*0.8),pie3DspliceThickness:20},draw:function(options){var
data=options.data,context=options.context,canvas=context.canvas,lineWidth=options.lineWidth,shadowSize=options.shadowSize,sizeRatio=options.sizeRatio,height=options.height,width=options.width,explode=options.explode,color=options.color,fill=options.fill,fillStyle=options.fillStyle,radius=Math.min(canvas.width,canvas.height)*sizeRatio/2,value=data[0][1],html=[],vScale=1,measure=Math.PI*2*value/this.total,startAngle=this.startAngle||(2*Math.PI*options.startAngle),endAngle=startAngle+measure,bisection=startAngle+measure/2,label=options.labelFormatter(this.total,value),explodeCoeff=explode+radius+4,distX=Math.cos(bisection)*explodeCoeff,distY=Math.sin(bisection)*explodeCoeff,textAlign=distX<0?'right':'left',textBaseline=distY>0?'top':'bottom',style,x,y,distX,distY;context.save();context.translate(width/2,height/2);context.scale(1,vScale);x=Math.cos(bisection)*explode;y=Math.sin(bisection)*explode;if(shadowSize>0){this.plotSlice(x+shadowSize,y+shadowSize,radius,startAngle,endAngle,context);if(fill){context.fillStyle='rgba(0,0,0,0.1)';context.fill();}}
this.plotSlice(x,y,radius,startAngle,endAngle,context);if(fill){context.fillStyle=fillStyle;context.fill();}
context.lineWidth=lineWidth;context.strokeStyle=color;context.stroke();style={size:options.fontSize*1.2,color:options.fontColor,weight:1.5};if(label){if(options.htmlText||!options.textEnabled){divStyle='position:absolute;'+textBaseline+':'+(height/2+(textBaseline==='top'?distY:-distY))+'px;';divStyle+=textAlign+':'+(width/2+(textAlign==='right'?-distX:distX))+'px;';html.push('<div style="',divStyle,'" class="flotr-grid-label">',label,'</div>');}
else{style.textAlign=textAlign;style.textBaseline=textBaseline;Flotr.drawText(context,label,distX,distY,style);}}
if(options.htmlText||!options.textEnabled){var div=Flotr.DOM.node('<div style="color:'+options.fontColor+'" class="flotr-labels"></div>');Flotr.DOM.insert(div,html.join(''));Flotr.DOM.insert(options.element,div);}
context.restore();this.startAngle=endAngle;this.slices=this.slices||[];this.slices.push({radius:Math.min(canvas.width,canvas.height)*sizeRatio/2,x:x,y:y,explode:explode,start:startAngle,end:endAngle});},plotSlice:function(x,y,radius,startAngle,endAngle,context){context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,startAngle,endAngle,false);context.lineTo(x,y);context.closePath();},hit:function(options){var
data=options.data[0],args=options.args,index=options.index,mouse=args[0],n=args[1],slice=this.slices[index],x=mouse.relX-options.width/2,y=mouse.relY-options.height/2,r=Math.sqrt(x*x+y*y),theta=Math.atan(y/x),circle=Math.PI*2,explode=slice.explode||options.explode,start=slice.start%circle,end=slice.end%circle;if(x<0){theta+=Math.PI;}else if(x>0&&y<0){theta+=circle;}
if(r<slice.radius+explode&&r>explode){if((start>end&&(theta<end||theta>start))||(theta>start&&theta<end)){n.x=data[0];n.y=data[1];n.sAngle=start;n.eAngle=end;n.index=0;n.seriesIndex=index;n.fraction=data[1]/this.total;}}},drawHit:function(options){var
context=options.context,slice=this.slices[options.args.seriesIndex];context.save();context.translate(options.width/2,options.height/2);this.plotSlice(slice.x,slice.y,slice.radius,slice.start,slice.end,context);context.stroke();context.restore();},clearHit:function(options){var
context=options.context,slice=this.slices[options.args.seriesIndex],padding=2*options.lineWidth,radius=slice.radius+padding;context.save();context.translate(options.width/2,options.height/2);context.clearRect(slice.x-radius,slice.y-radius,2*radius+padding,2*radius+padding);context.restore();},extendYRange:function(axis,data){this.total=(this.total||0)+data[0][1];}});})();;Flotr.addType('points',{options:{show:false,radius:3,lineWidth:2,fill:true,fillColor:'#FFFFFF',fillOpacity:0.4},draw:function(options){var
context=options.context,lineWidth=options.lineWidth,shadowSize=options.shadowSize;context.save();if(shadowSize>0){context.lineWidth=shadowSize/2;context.strokeStyle='rgba(0,0,0,0.1)';this.plot(options,shadowSize/2+context.lineWidth/2);context.strokeStyle='rgba(0,0,0,0.2)';this.plot(options,context.lineWidth/2);}
context.lineWidth=options.lineWidth;context.strokeStyle=options.color;context.fillStyle=options.fillColor||options.color;this.plot(options);context.restore();},plot:function(options,offset){var
data=options.data,context=options.context,xScale=options.xScale,yScale=options.yScale,i,x,y;for(i=data.length-1;i>-1;--i){y=data[i][1];if(y===null)continue;x=xScale(data[i][0]);y=yScale(y);if(x<0||x>options.width||y<0||y>options.height)continue;context.beginPath();if(offset){context.arc(x,y+offset,options.radius,0,Math.PI,false);}else{context.arc(x,y,options.radius,0,2*Math.PI,true);if(options.fill)context.fill();}
context.stroke();context.closePath();}}});;Flotr.addType('radar',{options:{show:false,lineWidth:2,fill:true,fillOpacity:0.4,radiusRatio:0.90},draw:function(options){var
context=options.context,shadowSize=options.shadowSize;context.save();context.translate(options.width/2,options.height/2);context.lineWidth=options.lineWidth;context.fillStyle='rgba(0,0,0,0.05)';context.strokeStyle='rgba(0,0,0,0.05)';this.plot(options,shadowSize/2);context.strokeStyle='rgba(0,0,0,0.1)';this.plot(options,shadowSize/4);context.strokeStyle=options.color;context.fillStyle=options.fillStyle;this.plot(options);context.restore();},plot:function(options,offset){var
data=options.data,context=options.context,radius=Math.min(options.height,options.width)*options.radiusRatio/2,step=2*Math.PI/data.length,angle=-Math.PI/2,i,ratio;offset=offset||0;context.beginPath();for(i=0;i<data.length;++i){ratio=data[i][1]/this.max;context[i===0?'moveTo':'lineTo'](Math.cos(i*step+angle)*radius*ratio+offset,Math.sin(i*step+angle)*radius*ratio+offset);}
context.closePath();if(options.fill)context.fill();context.stroke();},extendYRange:function(axis,data){this.max=Math.max(axis.max,this.max||-Number.MAX_VALUE);}});;Flotr.addType('timeline',{options:{show:false,lineWidth:1,barWidth:0.2,fill:true,fillColor:null,fillOpacity:0.4,centered:true},draw:function(options){var
context=options.context;context.save();context.lineJoin='miter';context.lineWidth=options.lineWidth;context.strokeStyle=options.color;context.fillStyle=options.fillStyle;this.plot(options);context.restore();},plot:function(options){var
data=options.data,context=options.context,xScale=options.xScale,yScale=options.yScale,barWidth=options.barWidth,lineWidth=options.lineWidth,i;Flotr._.each(data,function(timeline){var
x=timeline[0],y=timeline[1],w=timeline[2],h=barWidth,xt=Math.ceil(xScale(x)),wt=Math.ceil(xScale(x+w))-xt,yt=Math.round(yScale(y)),ht=Math.round(yScale(y-h))-yt,x0=xt-lineWidth/2,y0=Math.round(yt-ht/2)-lineWidth/2;context.strokeRect(x0,y0,wt,ht);context.fillRect(x0,y0,wt,ht);});},extendRange:function(series){var
data=series.data,xa=series.xaxis,ya=series.yaxis,w=series.timeline.barWidth;if(xa.options.min===null)
xa.min=xa.datamin-w/2;if(xa.options.max===null){var
max=xa.max;Flotr._.each(data,function(timeline){max=Math.max(max,timeline[0]+timeline[2]);},this);xa.max=max+w/2;}
if(ya.options.min===null)
ya.min=ya.datamin-w;if(ya.options.min===null)
ya.max=ya.datamax+w;}});;(function(){var D=Flotr.DOM;Flotr.addPlugin('crosshair',{options:{mode:null,color:'#FF0000',hideCursor:true},callbacks:{'flotr:mousemove':function(e,pos){if(this.options.crosshair.mode){this.crosshair.clearCrosshair();this.crosshair.drawCrosshair(pos);}}},drawCrosshair:function(pos){var octx=this.octx,options=this.options.crosshair,plotOffset=this.plotOffset,x=plotOffset.left+pos.relX+0.5,y=plotOffset.top+pos.relY+0.5;if(pos.relX<0||pos.relY<0||pos.relX>this.plotWidth||pos.relY>this.plotHeight){this.el.style.cursor=null;D.removeClass(this.el,'flotr-crosshair');return;}
if(options.hideCursor){this.el.style.cursor='none';D.addClass(this.el,'flotr-crosshair');}
octx.save();octx.strokeStyle=options.color;octx.lineWidth=1;octx.beginPath();if(options.mode.indexOf('x')!=-1){octx.moveTo(x,plotOffset.top);octx.lineTo(x,plotOffset.top+this.plotHeight);}
if(options.mode.indexOf('y')!=-1){octx.moveTo(plotOffset.left,y);octx.lineTo(plotOffset.left+this.plotWidth,y);}
octx.stroke();octx.restore();},clearCrosshair:function(){var
plotOffset=this.plotOffset,position=this.lastMousePos,context=this.octx;if(position){context.clearRect(position.relX+plotOffset.left,plotOffset.top,1,this.plotHeight+1);context.clearRect(plotOffset.left,position.relY+plotOffset.top,this.plotWidth+1,1);}}});})();;(function(){var
D=Flotr.DOM,_=Flotr._;function getImage(type,canvas,width,height){var
mime='image/'+type,data=canvas.toDataURL(mime),image=new Image();image.src=data;return image;}
Flotr.addPlugin('download',{saveImage:function(type,width,height,replaceCanvas){var image=null;if(Flotr.isIE&&Flotr.isIE<9){image='<html><body>'+this.canvas.firstChild.innerHTML+'</body></html>';return window.open().document.write(image);}
if(type!=='jpeg'&&type!=='png')return;image=getImage(type,this.canvas,width,height);if(_.isElement(image)&&replaceCanvas){this.download.restoreCanvas();D.hide(this.canvas);D.hide(this.overlay);D.setStyles({position:'absolute'});D.insert(this.el,image);this.saveImageElement=image;}else{return window.open(image.src);}},restoreCanvas:function(){D.show(this.canvas);D.show(this.overlay);if(this.saveImageElement)this.el.removeChild(this.saveImageElement);this.saveImageElement=null;}});})();;(function(){var E=Flotr.EventAdapter,_=Flotr._;Flotr.addPlugin('graphGrid',{callbacks:{'flotr:beforedraw':function(){this.graphGrid.drawGrid();},'flotr:afterdraw':function(){this.graphGrid.drawOutline();}},drawGrid:function(){var
ctx=this.ctx,options=this.options,grid=options.grid,verticalLines=grid.verticalLines,horizontalLines=grid.horizontalLines,minorVerticalLines=grid.minorVerticalLines,minorHorizontalLines=grid.minorHorizontalLines,plotHeight=this.plotHeight,plotWidth=this.plotWidth,a,v,i,j;if(verticalLines||minorVerticalLines||horizontalLines||minorHorizontalLines){E.fire(this.el,'flotr:beforegrid',[this.axes.x,this.axes.y,options,this]);}
ctx.save();ctx.lineWidth=1;ctx.strokeStyle=grid.tickColor;function circularHorizontalTicks(ticks){for(i=0;i<ticks.length;++i){var ratio=ticks[i].v/a.max;for(j=0;j<=sides;++j){ctx[j===0?'moveTo':'lineTo'](Math.cos(j*coeff+angle)*radius*ratio,Math.sin(j*coeff+angle)*radius*ratio);}}}
function drawGridLines(ticks,callback){_.each(_.pluck(ticks,'v'),function(v){if((v<=a.min||v>=a.max)||(v==a.min||v==a.max)&&grid.outlineWidth)
return;callback(Math.floor(a.d2p(v))+ctx.lineWidth/2);});}
function drawVerticalLines(x){ctx.moveTo(x,0);ctx.lineTo(x,plotHeight);}
function drawHorizontalLines(y){ctx.moveTo(0,y);ctx.lineTo(plotWidth,y);}
if(grid.circular){ctx.translate(this.plotOffset.left+plotWidth/2,this.plotOffset.top+plotHeight/2);var radius=Math.min(plotHeight,plotWidth)*options.radar.radiusRatio/2,sides=this.axes.x.ticks.length,coeff=2*(Math.PI/sides),angle=-Math.PI/2;ctx.beginPath();a=this.axes.y;if(horizontalLines){circularHorizontalTicks(a.ticks);}
if(minorHorizontalLines){circularHorizontalTicks(a.minorTicks);}
if(verticalLines){_.times(sides,function(i){ctx.moveTo(0,0);ctx.lineTo(Math.cos(i*coeff+angle)*radius,Math.sin(i*coeff+angle)*radius);});}
ctx.stroke();}
else{ctx.translate(this.plotOffset.left,this.plotOffset.top);if(grid.backgroundColor){ctx.fillStyle=this.processColor(grid.backgroundColor,{x1:0,y1:0,x2:plotWidth,y2:plotHeight});ctx.fillRect(0,0,plotWidth,plotHeight);}
ctx.beginPath();a=this.axes.x;if(verticalLines)drawGridLines(a.ticks,drawVerticalLines);if(minorVerticalLines)drawGridLines(a.minorTicks,drawVerticalLines);a=this.axes.y;if(horizontalLines)drawGridLines(a.ticks,drawHorizontalLines);if(minorHorizontalLines)drawGridLines(a.minorTicks,drawHorizontalLines);ctx.stroke();}
ctx.restore();if(verticalLines||minorVerticalLines||horizontalLines||minorHorizontalLines){E.fire(this.el,'flotr:aftergrid',[this.axes.x,this.axes.y,options,this]);}},drawOutline:function(){var
that=this,options=that.options,grid=options.grid,outline=grid.outline,ctx=that.ctx,backgroundImage=grid.backgroundImage,plotOffset=that.plotOffset,leftOffset=plotOffset.left,topOffset=plotOffset.top,plotWidth=that.plotWidth,plotHeight=that.plotHeight,v,img,src,left,top,globalAlpha;if(!grid.outlineWidth)return;ctx.save();if(grid.circular){ctx.translate(leftOffset+plotWidth/2,topOffset+plotHeight/2);var radius=Math.min(plotHeight,plotWidth)*options.radar.radiusRatio/2,sides=this.axes.x.ticks.length,coeff=2*(Math.PI/sides),angle=-Math.PI/2;ctx.beginPath();ctx.lineWidth=grid.outlineWidth;ctx.strokeStyle=grid.color;ctx.lineJoin='round';for(i=0;i<=sides;++i){ctx[i===0?'moveTo':'lineTo'](Math.cos(i*coeff+angle)*radius,Math.sin(i*coeff+angle)*radius);}
ctx.stroke();}
else{ctx.translate(leftOffset,topOffset);var lw=grid.outlineWidth,orig=0.5-lw+((lw+1)%2/2),lineTo='lineTo',moveTo='moveTo';ctx.lineWidth=lw;ctx.strokeStyle=grid.color;ctx.lineJoin='miter';ctx.beginPath();ctx.moveTo(orig,orig);plotWidth=plotWidth-(lw/2)%1;plotHeight=plotHeight+lw/2;ctx[outline.indexOf('n')!==-1?lineTo:moveTo](plotWidth,orig);ctx[outline.indexOf('e')!==-1?lineTo:moveTo](plotWidth,plotHeight);ctx[outline.indexOf('s')!==-1?lineTo:moveTo](orig,plotHeight);ctx[outline.indexOf('w')!==-1?lineTo:moveTo](orig,orig);ctx.stroke();ctx.closePath();}
ctx.restore();if(backgroundImage){src=backgroundImage.src||backgroundImage;left=(parseInt(backgroundImage.left,10)||0)+plotOffset.left;top=(parseInt(backgroundImage.top,10)||0)+plotOffset.top;img=new Image();img.onload=function(){ctx.save();if(backgroundImage.alpha)ctx.globalAlpha=backgroundImage.alpha;ctx.globalCompositeOperation='destination-over';ctx.drawImage(img,0,0,img.width,img.height,left,top,plotWidth,plotHeight);ctx.restore();};img.src=src;}}});})();;(function(){var
D=Flotr.DOM,_=Flotr._,flotr=Flotr,S_MOUSETRACK='opacity:0.7;background-color:#000;color:#fff;display:none;position:absolute;padding:2px 8px;-moz-border-radius:4px;border-radius:4px;white-space:nowrap;';Flotr.addPlugin('hit',{callbacks:{'flotr:mousemove':function(e,pos){this.hit.track(pos);},'flotr:click':function(pos){this.hit.track(pos);},'flotr:mouseout':function(){this.hit.clearHit();}},track:function(pos){if(this.options.mouse.track||_.any(this.series,function(s){return s.mouse&&s.mouse.track;})){this.hit.hit(pos);}},executeOnType:function(s,method,args){var
success=false,options;if(!_.isArray(s))s=[s];function e(s,index){_.each(_.keys(flotr.graphTypes),function(type){if(s[type]&&s[type].show&&this[type][method]){options=this.getOptions(s,type);options.fill=!!s.mouse.fillColor;options.fillStyle=this.processColor(s.mouse.fillColor||'#ffffff',{opacity:s.mouse.fillOpacity});options.color=s.mouse.lineColor;options.context=this.octx;options.index=index;if(args)options.args=args;this[type][method].call(this[type],options);success=true;}},this);}
_.each(s,e,this);return success;},drawHit:function(n){var octx=this.octx,s=n.series;if(s.mouse.lineColor){octx.save();octx.lineWidth=(s.points?s.points.lineWidth:1);octx.strokeStyle=s.mouse.lineColor;octx.fillStyle=this.processColor(s.mouse.fillColor||'#ffffff',{opacity:s.mouse.fillOpacity});octx.translate(this.plotOffset.left,this.plotOffset.top);if(!this.hit.executeOnType(s,'drawHit',n)){var xa=n.xaxis,ya=n.yaxis;octx.beginPath();octx.arc(xa.d2p(n.x),ya.d2p(n.y),s.points.radius||s.mouse.radius,0,2*Math.PI,true);octx.fill();octx.stroke();octx.closePath();}
octx.restore();}
this.prevHit=n;},clearHit:function(){var prev=this.prevHit,octx=this.octx,plotOffset=this.plotOffset;octx.save();octx.translate(plotOffset.left,plotOffset.top);if(prev){if(!this.hit.executeOnType(prev.series,'clearHit',this.prevHit)){var
s=prev.series,lw=(s.points?s.points.lineWidth:1);offset=(s.points.radius||s.mouse.radius)+lw;octx.clearRect(prev.xaxis.d2p(prev.x)-offset,prev.yaxis.d2p(prev.y)-offset,offset*2,offset*2);}
D.hide(this.mouseTrack);this.prevHit=null;}
octx.restore();},hit:function(mouse){var
options=this.options,prevHit=this.prevHit,closest,sensibility,dataIndex,seriesIndex,series,value,xaxis,yaxis;if(this.series.length===0)return;n={relX:mouse.relX,relY:mouse.relY,absX:mouse.absX,absY:mouse.absY};if(options.mouse.trackY&&!options.mouse.trackAll&&this.hit.executeOnType(this.series,'hit',[mouse,n]))
{if(!_.isUndefined(n.seriesIndex)){series=this.series[n.seriesIndex];n.series=series;n.mouse=series.mouse;n.xaxis=series.xaxis;n.yaxis=series.yaxis;}}else{closest=this.hit.closest(mouse);if(closest){closest=options.mouse.trackY?closest.point:closest.x;seriesIndex=closest.seriesIndex;series=this.series[seriesIndex];xaxis=series.xaxis;yaxis=series.yaxis;sensibility=2*series.mouse.sensibility;if
(options.mouse.trackAll||(closest.distanceX<sensibility/xaxis.scale&&(!options.mouse.trackY||closest.distanceY<sensibility/yaxis.scale)))
{n.series=series;n.xaxis=series.xaxis;n.yaxis=series.yaxis;n.mouse=series.mouse;n.x=closest.x;n.y=closest.y;n.dist=closest.distance;n.index=closest.dataIndex;n.seriesIndex=seriesIndex;}}}
if(!prevHit||(prevHit.index!==n.index||prevHit.seriesIndex!==n.seriesIndex)){this.hit.clearHit();if(n.series&&n.mouse&&n.mouse.track){this.hit.drawMouseTrack(n);this.hit.drawHit(n);Flotr.EventAdapter.fire(this.el,'flotr:hit',[n,this]);}}},closest:function(mouse){var
series=this.series,options=this.options,mouseX=mouse.x,mouseY=mouse.y,compare=Number.MAX_VALUE,compareX=Number.MAX_VALUE,closest={},closestX={},check=false,serie,data,distance,distanceX,distanceY,x,y,i,j;function setClosest(o){o.distance=distance;o.distanceX=distanceX;o.distanceY=distanceY;o.seriesIndex=i;o.dataIndex=j;o.x=x;o.y=y;}
for(i=0;i<series.length;i++){serie=series[i];data=serie.data;if(data.length)check=true;for(j=data.length;j--;){x=data[j][0];y=data[j][1];if(x===null||y===null)continue;if(x<serie.xaxis.min||x>serie.xaxis.max)continue;distanceX=Math.abs(x-mouseX);distanceY=Math.abs(y-mouseY);distance=distanceX*distanceX+distanceY*distanceY;if(distance<compare){compare=distance;setClosest(closest);}
if(distanceX<compareX){compareX=distanceX;setClosest(closestX);}}}
return check?{point:closest,x:closestX}:false;},drawMouseTrack:function(n){var
pos='',s=n.series,p=n.mouse.position,m=n.mouse.margin,elStyle=S_MOUSETRACK,mouseTrack=this.mouseTrack,plotOffset=this.plotOffset,left=plotOffset.left,right=plotOffset.right,bottom=plotOffset.bottom,top=plotOffset.top,decimals=n.mouse.trackDecimals,options=this.options;if(!mouseTrack){mouseTrack=D.node('<div class="flotr-mouse-value"></div>');this.mouseTrack=mouseTrack;D.insert(this.el,mouseTrack);}
if(!n.mouse.relative){if(p.charAt(0)=='n')pos+='top:'+(m+top)+'px;bottom:auto;';else if(p.charAt(0)=='s')pos+='bottom:'+(m+bottom)+'px;top:auto;';if(p.charAt(1)=='e')pos+='right:'+(m+right)+'px;left:auto;';else if(p.charAt(1)=='w')pos+='left:'+(m+left)+'px;right:auto;';}else if(s.bars.show){pos+='bottom:'+(m-top-n.yaxis.d2p(n.y/2)+this.canvasHeight)+'px;top:auto;';pos+='left:'+(m+left+n.xaxis.d2p(n.x-options.bars.barWidth/2))+'px;right:auto;';}else if(s.pie.show){var center={x:(this.plotWidth)/2,y:(this.plotHeight)/2},radius=(Math.min(this.canvasWidth,this.canvasHeight)*s.pie.sizeRatio)/2,bisection=n.sAngle<n.eAngle?(n.sAngle+n.eAngle)/2:(n.sAngle+n.eAngle+2*Math.PI)/2;pos+='bottom:'+(m-top-center.y-Math.sin(bisection)*radius/2+this.canvasHeight)+'px;top:auto;';pos+='left:'+(m+left+center.x+Math.cos(bisection)*radius/2)+'px;right:auto;';}else{if(p.charAt(0)=='n')pos+='bottom:'+(m-top-n.yaxis.d2p(n.y)+this.canvasHeight)+'px;top:auto;';else if(p.charAt(0)=='s')pos+='top:'+(m+top+n.yaxis.d2p(n.y))+'px;bottom:auto;';if(p.charAt(1)=='e')pos+='left:'+(m+left+n.xaxis.d2p(n.x))+'px;right:auto;';else if(p.charAt(1)=='w')pos+='right:'+(m-left-n.xaxis.d2p(n.x)+this.canvasWidth)+'px;left:auto;';}
elStyle+=pos;mouseTrack.style.cssText=elStyle;if(!decimals||decimals<0)decimals=0;mouseTrack.innerHTML=n.mouse.trackFormatter({x:n.x.toFixed(decimals),y:n.y.toFixed(decimals),series:n.series,index:n.index,nearest:n,fraction:n.fraction});D.show(mouseTrack);}});})();;(function(){function isLeftClick(e,type){return(e.which?(e.which===1):(e.button===0||e.button===1));}
function boundX(x,graph){return Math.min(Math.max(0,x),graph.plotWidth-1);}
function boundY(y,graph){return Math.min(Math.max(0,y),graph.plotHeight);}
var
D=Flotr.DOM,E=Flotr.EventAdapter,_=Flotr._;Flotr.addPlugin('selection',{options:{pinchOnly:null,mode:null,color:'#B6D9FF',fps:20},callbacks:{'flotr:mouseup':function(event){var
options=this.options.selection,selection=this.selection,pointer=this.getEventPosition(event);if(!options||!options.mode)return;if(selection.interval)clearInterval(selection.interval);if(this.multitouches){selection.updateSelection();}else
if(!options.pinchOnly){selection.setSelectionPos(selection.selection.second,pointer);}
selection.clearSelection();if(selection.selecting&&selection.selectionIsSane()){selection.drawSelection();selection.fireSelectEvent();this.ignoreClick=true;}},'flotr:mousedown':function(event){var
options=this.options.selection,selection=this.selection,pointer=this.getEventPosition(event);if(!options||!options.mode)return;if(!options.mode||(!isLeftClick(event)&&_.isUndefined(event.touches)))return;if(!options.pinchOnly)selection.setSelectionPos(selection.selection.first,pointer);if(selection.interval)clearInterval(selection.interval);this.lastMousePos.pageX=null;selection.selecting=false;selection.interval=setInterval(_.bind(selection.updateSelection,this),1000/options.fps);},'flotr:destroy':function(event){clearInterval(this.selection.interval);}},getArea:function(){var s=this.selection.selection,first=s.first,second=s.second;return{x1:Math.min(first.x,second.x),x2:Math.max(first.x,second.x),y1:Math.min(first.y,second.y),y2:Math.max(first.y,second.y)};},selection:{first:{x:-1,y:-1},second:{x:-1,y:-1}},prevSelection:null,interval:null,fireSelectEvent:function(name){var a=this.axes,s=this.selection.selection,x1,x2,y1,y2;name=name||'select';x1=a.x.p2d(s.first.x);x2=a.x.p2d(s.second.x);y1=a.y.p2d(s.first.y);y2=a.y.p2d(s.second.y);E.fire(this.el,'flotr:'+name,[{x1:Math.min(x1,x2),y1:Math.min(y1,y2),x2:Math.max(x1,x2),y2:Math.max(y1,y2),xfirst:x1,xsecond:x2,yfirst:y1,ysecond:y2},this]);},setSelection:function(area,preventEvent){var options=this.options,xa=this.axes.x,ya=this.axes.y,vertScale=ya.scale,hozScale=xa.scale,selX=options.selection.mode.indexOf('x')!=-1,selY=options.selection.mode.indexOf('y')!=-1,s=this.selection.selection;this.selection.clearSelection();s.first.y=boundY((selX&&!selY)?0:(ya.max-area.y1)*vertScale,this);s.second.y=boundY((selX&&!selY)?this.plotHeight-1:(ya.max-area.y2)*vertScale,this);s.first.x=boundX((selY&&!selX)?0:area.x1,this);s.second.x=boundX((selY&&!selX)?this.plotWidth:area.x2,this);this.selection.drawSelection();if(!preventEvent)
this.selection.fireSelectEvent();},setSelectionPos:function(pos,pointer){var mode=this.options.selection.mode,selection=this.selection.selection;if(mode.indexOf('x')==-1){pos.x=(pos==selection.first)?0:this.plotWidth;}else{pos.x=boundX(pointer.relX,this);}
if(mode.indexOf('y')==-1){pos.y=(pos==selection.first)?0:this.plotHeight-1;}else{pos.y=boundY(pointer.relY,this);}},drawSelection:function(){this.selection.fireSelectEvent('selecting');var s=this.selection.selection,octx=this.octx,options=this.options,plotOffset=this.plotOffset,prevSelection=this.selection.prevSelection;if(prevSelection&&s.first.x==prevSelection.first.x&&s.first.y==prevSelection.first.y&&s.second.x==prevSelection.second.x&&s.second.y==prevSelection.second.y){return;}
octx.save();octx.strokeStyle=this.processColor(options.selection.color,{opacity:0.8});octx.lineWidth=1;octx.lineJoin='miter';octx.fillStyle=this.processColor(options.selection.color,{opacity:0.4});this.selection.prevSelection={first:{x:s.first.x,y:s.first.y},second:{x:s.second.x,y:s.second.y}};var x=Math.min(s.first.x,s.second.x),y=Math.min(s.first.y,s.second.y),w=Math.abs(s.second.x-s.first.x),h=Math.abs(s.second.y-s.first.y);octx.fillRect(x+plotOffset.left+0.5,y+plotOffset.top+0.5,w,h);octx.strokeRect(x+plotOffset.left+0.5,y+plotOffset.top+0.5,w,h);octx.restore();},updateSelection:function(){if(!this.lastMousePos.pageX)return;this.selection.selecting=true;if(this.multitouches){this.selection.setSelectionPos(this.selection.selection.first,this.getEventPosition(this.multitouches[0]));this.selection.setSelectionPos(this.selection.selection.second,this.getEventPosition(this.multitouches[1]));}else
if(this.options.selection.pinchOnly){return;}else{this.selection.setSelectionPos(this.selection.selection.second,this.lastMousePos);}
this.selection.clearSelection();if(this.selection.selectionIsSane()){this.selection.drawSelection();}},clearSelection:function(){if(!this.selection.prevSelection)return;var prevSelection=this.selection.prevSelection,lw=1,plotOffset=this.plotOffset,x=Math.min(prevSelection.first.x,prevSelection.second.x),y=Math.min(prevSelection.first.y,prevSelection.second.y),w=Math.abs(prevSelection.second.x-prevSelection.first.x),h=Math.abs(prevSelection.second.y-prevSelection.first.y);this.octx.clearRect(x+plotOffset.left-lw+0.5,y+plotOffset.top-lw,w+2*lw+0.5,h+2*lw+0.5);this.selection.prevSelection=null;},selectionIsSane:function(){var s=this.selection.selection;return Math.abs(s.second.x-s.first.x)>=5||Math.abs(s.second.y-s.first.y)>=5;}});})();;(function(){var D=Flotr.DOM;Flotr.addPlugin('labels',{callbacks:{'flotr:afterdraw':function(){this.labels.draw();}},draw:function(){var
axis,tick,left,top,xBoxWidth,radius,sides,coeff,angle,div,i,html='',noLabels=0,options=this.options,ctx=this.ctx,a=this.axes,style={size:options.fontSize};for(i=0;i<a.x.ticks.length;++i){if(a.x.ticks[i].label){++noLabels;}}
xBoxWidth=this.plotWidth/noLabels;if(options.grid.circular){ctx.save();ctx.translate(this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+this.plotHeight/2);radius=this.plotHeight*options.radar.radiusRatio/2+options.fontSize;sides=this.axes.x.ticks.length;coeff=2*(Math.PI/sides);angle=-Math.PI/2;drawLabelCircular(this,a.x,false);drawLabelCircular(this,a.x,true);drawLabelCircular(this,a.y,false);drawLabelCircular(this,a.y,true);ctx.restore();}
if(!options.HtmlText&&this.textEnabled){drawLabelNoHtmlText(this,a.x,'center','top');drawLabelNoHtmlText(this,a.x2,'center','bottom');drawLabelNoHtmlText(this,a.y,'right','middle');drawLabelNoHtmlText(this,a.y2,'left','middle');}else if((a.x.options.showLabels||a.x2.options.showLabels||a.y.options.showLabels||a.y2.options.showLabels)&&!options.grid.circular){html='';drawLabelHtml(this,a.x);drawLabelHtml(this,a.x2);drawLabelHtml(this,a.y);drawLabelHtml(this,a.y2);ctx.stroke();ctx.restore();div=D.create('div');D.setStyles(div,{fontSize:'smaller',color:options.grid.color});div.className='flotr-labels';D.insert(this.el,div);D.insert(div,html);}
function drawLabelCircular(graph,axis,minorTicks){var
ticks=minorTicks?axis.minorTicks:axis.ticks,isX=axis.orientation===1,isFirst=axis.n===1,style,offset;style={color:axis.options.color||options.grid.color,angle:Flotr.toRad(axis.options.labelsAngle),textBaseline:'middle'};for(i=0;i<ticks.length&&(minorTicks?axis.options.showMinorLabels:axis.options.showLabels);++i){tick=ticks[i];tick.label+='';if(!tick.label||!tick.label.length){continue;}
x=Math.cos(i*coeff+angle)*radius;y=Math.sin(i*coeff+angle)*radius;style.textAlign=isX?(Math.abs(x)<0.1?'center':(x<0?'right':'left')):'left';Flotr.drawText(ctx,tick.label,isX?x:3,isX?y:-(axis.ticks[i].v/axis.max)*(radius-options.fontSize),style);}}
function drawLabelNoHtmlText(graph,axis,textAlign,textBaseline){var
isX=axis.orientation===1,isFirst=axis.n===1,style,offset;style={color:axis.options.color||options.grid.color,textAlign:textAlign,textBaseline:textBaseline,angle:Flotr.toRad(axis.options.labelsAngle)};style=Flotr.getBestTextAlign(style.angle,style);for(i=0;i<axis.ticks.length&&continueShowingLabels(axis);++i){tick=axis.ticks[i];if(!tick.label||!tick.label.length){continue;}
offset=axis.d2p(tick.v);if(offset<0||offset>(isX?graph.plotWidth:graph.plotHeight)){continue;}
Flotr.drawText(ctx,tick.label,leftOffset(graph,isX,isFirst,offset),topOffset(graph,isX,isFirst,offset),style);if(!isX&&!isFirst){ctx.save();ctx.strokeStyle=style.color;ctx.beginPath();ctx.moveTo(graph.plotOffset.left+graph.plotWidth-8,graph.plotOffset.top+axis.d2p(tick.v));ctx.lineTo(graph.plotOffset.left+graph.plotWidth,graph.plotOffset.top+axis.d2p(tick.v));ctx.stroke();ctx.restore();}}
function continueShowingLabels(axis){return axis.options.showLabels&&axis.used;}
function leftOffset(graph,isX,isFirst,offset){return graph.plotOffset.left+
(isX?offset:(isFirst?-options.grid.labelMargin:options.grid.labelMargin+graph.plotWidth));}
function topOffset(graph,isX,isFirst,offset){return graph.plotOffset.top+
(isX?options.grid.labelMargin:offset)+
((isX&&isFirst)?graph.plotHeight:0);}}
function drawLabelHtml(graph,axis){var
isX=axis.orientation===1,isFirst=axis.n===1,name='',left,style,top,offset=graph.plotOffset;if(!isX&&!isFirst){ctx.save();ctx.strokeStyle=axis.options.color||options.grid.color;ctx.beginPath();}
if(axis.options.showLabels&&(isFirst?true:axis.used)){for(i=0;i<axis.ticks.length;++i){tick=axis.ticks[i];if(!tick.label||!tick.label.length||((isX?offset.left:offset.top)+axis.d2p(tick.v)<0)||((isX?offset.left:offset.top)+axis.d2p(tick.v)>(isX?graph.canvasWidth:graph.canvasHeight))){continue;}
top=offset.top+
(isX?((isFirst?1:-1)*(graph.plotHeight+options.grid.labelMargin)):axis.d2p(tick.v)-axis.maxLabel.height/2);left=isX?(offset.left+axis.d2p(tick.v)-xBoxWidth/2):0;name='';if(i===0){name=' first';}else if(i===axis.ticks.length-1){name=' last';}
name+=isX?' flotr-grid-label-x':' flotr-grid-label-y';html+=['<div style="position:absolute; text-align:'+(isX?'center':'right')+'; ','top:'+top+'px; ',((!isX&&!isFirst)?'right:':'left:')+left+'px; ','width:'+(isX?xBoxWidth:((isFirst?offset.left:offset.right)-options.grid.labelMargin))+'px; ',axis.options.color?('color:'+axis.options.color+'; '):' ','" class="flotr-grid-label'+name+'">'+tick.label+'</div>'].join(' ');if(!isX&&!isFirst){ctx.moveTo(offset.left+graph.plotWidth-8,offset.top+axis.d2p(tick.v));ctx.lineTo(offset.left+graph.plotWidth,offset.top+axis.d2p(tick.v));}}}}}});})();;(function(){var
D=Flotr.DOM,_=Flotr._;Flotr.addPlugin('legend',{options:{show:true,noColumns:1,labelFormatter:function(v){return v;},labelBoxBorderColor:'#CCCCCC',labelBoxWidth:14,labelBoxHeight:10,labelBoxMargin:5,labelBoxOpacity:0.4,container:null,position:'nw',margin:5,backgroundColor:null,backgroundOpacity:0.85},callbacks:{'flotr:afterinit':function(){this.legend.insertLegend();}},insertLegend:function(){if(!this.options.legend.show)
return;var series=this.series,plotOffset=this.plotOffset,options=this.options,legend=options.legend,fragments=[],rowStarted=false,ctx=this.ctx,itemCount=_.filter(series,function(s){return(s.label&&!s.hide);}).length,p=legend.position,m=legend.margin,i,label,color;if(itemCount){if(!options.HtmlText&&this.textEnabled&&!legend.container){var style={size:options.fontSize*1.1,color:options.grid.color};var lbw=legend.labelBoxWidth,lbh=legend.labelBoxHeight,lbm=legend.labelBoxMargin,offsetX=plotOffset.left+m,offsetY=plotOffset.top+m;var labelMaxWidth=0;for(i=series.length-1;i>-1;--i){if(!series[i].label||series[i].hide)continue;label=legend.labelFormatter(series[i].label);labelMaxWidth=Math.max(labelMaxWidth,this._text.measureText(label,style).width);}
var legendWidth=Math.round(lbw+lbm*3+labelMaxWidth),legendHeight=Math.round(itemCount*(lbm+lbh)+lbm);if(p.charAt(0)=='s')offsetY=plotOffset.top+this.plotHeight-(m+legendHeight);if(p.charAt(1)=='e')offsetX=plotOffset.left+this.plotWidth-(m+legendWidth);color=this.processColor(legend.backgroundColor||'rgb(240,240,240)',{opacity:legend.backgroundOpacity||0.1});ctx.fillStyle=color;ctx.fillRect(offsetX,offsetY,legendWidth,legendHeight);ctx.strokeStyle=legend.labelBoxBorderColor;ctx.strokeRect(Flotr.toPixel(offsetX),Flotr.toPixel(offsetY),legendWidth,legendHeight);var x=offsetX+lbm;var y=offsetY+lbm;for(i=0;i<series.length;i++){if(!series[i].label||series[i].hide)continue;label=legend.labelFormatter(series[i].label);ctx.fillStyle=series[i].color;ctx.fillRect(x,y,lbw-1,lbh-1);ctx.strokeStyle=legend.labelBoxBorderColor;ctx.lineWidth=1;ctx.strokeRect(Math.ceil(x)-1.5,Math.ceil(y)-1.5,lbw+2,lbh+2);Flotr.drawText(ctx,label,x+lbw+lbm,y+lbh,style);y+=lbh+lbm;}}
else{for(i=0;i<series.length;++i){if(!series[i].label||series[i].hide)continue;if(i%legend.noColumns===0){fragments.push(rowStarted?'</tr><tr>':'<tr>');rowStarted=true;}
var s=series[i],boxWidth=legend.labelBoxWidth,boxHeight=legend.labelBoxHeight,opacityValue=(s.bars?s.bars.fillOpacity:legend.labelBoxOpacity),opacity='opacity:'+opacityValue+';filter:alpha(opacity='+opacityValue*100+');';label=legend.labelFormatter(s.label);color='background-color:'+((s.bars&&s.bars.show&&s.bars.fillColor&&s.bars.fill)?s.bars.fillColor:s.color)+';';fragments.push('<td class="flotr-legend-color-box">','<div style="border:1px solid ',legend.labelBoxBorderColor,';padding:1px">','<div style="width:',(boxWidth-1),'px;height:',(boxHeight-1),'px;border:1px solid ',series[i].color,'">','<div style="width:',boxWidth,'px;height:',boxHeight,'px;','opacity:.4;',color,'"></div>','</div>','</div>','</td>','<td class="flotr-legend-label">',label,'</td>');}
if(rowStarted)fragments.push('</tr>');if(fragments.length>0){var table='<table style="font-size:smaller;color:'+options.grid.color+'">'+fragments.join('')+'</table>';if(legend.container){D.insert(legend.container,table);}
else{var styles={position:'absolute','z-index':2};if(p.charAt(0)=='n'){styles.top=(m+plotOffset.top)+'px';styles.bottom='auto';}
else if(p.charAt(0)=='s'){styles.bottom=(m+plotOffset.bottom)+'px';styles.top='auto';}
if(p.charAt(1)=='e'){styles.right=(m+plotOffset.right)+'px';styles.left='auto';}
else if(p.charAt(1)=='w'){styles.left=(m+plotOffset.left)+'px';styles.right='auto';}
var div=D.create('div'),size;div.className='flotr-legend';D.setStyles(div,styles);D.insert(div,table);D.insert(this.el,div);if(!legend.backgroundOpacity)
return;var c=legend.backgroundColor||options.grid.backgroundColor||'#ffffff';_.extend(styles,D.size(div),{'backgroundColor':c,'z-index':1});styles.width+='px';styles.height+='px';div=D.create('div');div.className='flotr-legend-bg';D.setStyles(div,styles);D.opacity(div,legend.backgroundOpacity);D.insert(div,' ');D.insert(this.el,div);}}}}}});})();;(function(){function getRowLabel(value){if(this.options.spreadsheet.tickFormatter){return this.options.spreadsheet.tickFormatter(value);}
else{var t=_.find(this.axes.x.ticks,function(t){return t.v==value;});if(t){return t.label;}
return value;}}
var
D=Flotr.DOM,_=Flotr._;Flotr.addPlugin('spreadsheet',{options:{show:false,tabGraphLabel:'Graph',tabDataLabel:'Data',toolbarDownload:'Download CSV',toolbarSelectAll:'Select all',csvFileSeparator:',',decimalSeparator:'.',tickFormatter:null,initialTab:'graph'},callbacks:{'flotr:afterconstruct':function(){if(!this.options.spreadsheet.show)return;var ss=this.spreadsheet,container=D.node('<div class="flotr-tabs-group" style="position:absolute;left:0px;width:'+this.canvasWidth+'px"></div>'),graph=D.node('<div style="float:left" class="flotr-tab selected">'+this.options.spreadsheet.tabGraphLabel+'</div>'),data=D.node('<div style="float:left" class="flotr-tab">'+this.options.spreadsheet.tabDataLabel+'</div>'),offset;ss.tabsContainer=container;ss.tabs={graph:graph,data:data};D.insert(container,graph);D.insert(container,data);D.insert(this.el,container);offset=D.size(data).height+2;this.plotOffset.bottom+=offset;D.setStyles(container,{top:this.canvasHeight-offset+'px'});this.observe(graph,'click',function(){ss.showTab('graph');}).observe(data,'click',function(){ss.showTab('data');});if(this.options.spreadsheet.initialTab!=='graph'){ss.showTab(this.options.spreadsheet.initialTab);}}},loadDataGrid:function(){if(this.seriesData)return this.seriesData;var s=this.series,rows={};_.each(s,function(serie,i){_.each(serie.data,function(v){var x=v[0],y=v[1],r=rows[x];if(r){r[i+1]=y;}else{var newRow=[];newRow[0]=x;newRow[i+1]=y;rows[x]=newRow;}});});this.seriesData=_.sortBy(rows,function(row,x){return parseInt(x,10);});return this.seriesData;},constructDataGrid:function(){if(this.spreadsheet.datagrid)return this.spreadsheet.datagrid;var s=this.series,datagrid=this.spreadsheet.loadDataGrid(),colgroup=['<colgroup><col />'],buttonDownload,buttonSelect,t;var html=['<table class="flotr-datagrid"><tr class="first-row">'];html.push('<th>&nbsp;</th>');_.each(s,function(serie,i){html.push('<th scope="col">'+(serie.label||String.fromCharCode(65+i))+'</th>');colgroup.push('<col />');});html.push('</tr>');_.each(datagrid,function(row){html.push('<tr>');_.times(s.length+1,function(i){var tag='td',value=row[i],content=(!_.isUndefined(value)?Math.round(value*100000)/100000:'');if(i===0){tag='th';var label=getRowLabel.call(this,content);if(label)content=label;}
html.push('<'+tag+(tag=='th'?' scope="row"':'')+'>'+content+'</'+tag+'>');},this);html.push('</tr>');},this);colgroup.push('</colgroup>');t=D.node(html.join(''));buttonDownload=D.node('<button type="button" class="flotr-datagrid-toolbar-button">'+
this.options.spreadsheet.toolbarDownload+'</button>');buttonSelect=D.node('<button type="button" class="flotr-datagrid-toolbar-button">'+
this.options.spreadsheet.toolbarSelectAll+'</button>');this.observe(buttonDownload,'click',_.bind(this.spreadsheet.downloadCSV,this)).observe(buttonSelect,'click',_.bind(this.spreadsheet.selectAllData,this));var toolbar=D.node('<div class="flotr-datagrid-toolbar"></div>');D.insert(toolbar,buttonDownload);D.insert(toolbar,buttonSelect);var containerHeight=this.canvasHeight-D.size(this.spreadsheet.tabsContainer).height-2,container=D.node('<div class="flotr-datagrid-container" style="position:absolute;left:0px;top:0px;width:'+
this.canvasWidth+'px;height:'+containerHeight+'px;overflow:auto;z-index:10"></div>');D.insert(container,toolbar);D.insert(container,t);D.insert(this.el,container);this.spreadsheet.datagrid=t;this.spreadsheet.container=container;return t;},showTab:function(tabName){if(this.spreadsheet.activeTab===tabName){return;}
switch(tabName){case'graph':D.hide(this.spreadsheet.container);D.removeClass(this.spreadsheet.tabs.data,'selected');D.addClass(this.spreadsheet.tabs.graph,'selected');break;case'data':if(!this.spreadsheet.datagrid)
this.spreadsheet.constructDataGrid();D.show(this.spreadsheet.container);D.addClass(this.spreadsheet.tabs.data,'selected');D.removeClass(this.spreadsheet.tabs.graph,'selected');break;default:throw'Illegal tab name: '+tabName;}
this.spreadsheet.activeTab=tabName;},selectAllData:function(){if(this.spreadsheet.tabs){var selection,range,doc,win,node=this.spreadsheet.constructDataGrid();this.spreadsheet.showTab('data');setTimeout(function(){if((doc=node.ownerDocument)&&(win=doc.defaultView)&&win.getSelection&&doc.createRange&&(selection=window.getSelection())&&selection.removeAllRanges){range=doc.createRange();range.selectNode(node);selection.removeAllRanges();selection.addRange(range);}
else if(document.body&&document.body.createTextRange&&(range=document.body.createTextRange())){range.moveToElementText(node);range.select();}},0);return true;}
else return false;},downloadCSV:function(){var csv='',series=this.series,options=this.options,dg=this.spreadsheet.loadDataGrid(),separator=encodeURIComponent(options.spreadsheet.csvFileSeparator);if(options.spreadsheet.decimalSeparator===options.spreadsheet.csvFileSeparator){throw"The decimal separator is the same as the column separator ("+options.spreadsheet.decimalSeparator+")";}
_.each(series,function(serie,i){csv+=separator+'"'+(serie.label||String.fromCharCode(65+i)).replace(/\"/g,'\\"')+'"';});csv+="%0D%0A";csv+=_.reduce(dg,function(memo,row){var rowLabel=getRowLabel.call(this,row[0])||'';rowLabel='"'+(rowLabel+'').replace(/\"/g,'\\"')+'"';var numbers=row.slice(1).join(separator);if(options.spreadsheet.decimalSeparator!=='.'){numbers=numbers.replace(/\./g,options.spreadsheet.decimalSeparator);}
return memo+rowLabel+separator+numbers+"%0D%0A";},'',this);if(Flotr.isIE&&Flotr.isIE<9){csv=csv.replace(new RegExp(separator,'g'),decodeURIComponent(separator)).replace(/%0A/g,'\n').replace(/%0D/g,'\r');window.open().document.write(csv);}
else window.open('data:text/csv,'+csv);}});})();;(function(){var D=Flotr.DOM;Flotr.addPlugin('titles',{callbacks:{'flotr:afterdraw':function(){this.titles.drawTitles();}},drawTitles:function(){var html,options=this.options,margin=options.grid.labelMargin,ctx=this.ctx,a=this.axes;if(!options.HtmlText&&this.textEnabled){var style={size:options.fontSize,color:options.grid.color,textAlign:'center'};if(options.subtitle){Flotr.drawText(ctx,options.subtitle,this.plotOffset.left+this.plotWidth/2,this.titleHeight+this.subtitleHeight-2,style);}
style.weight=1.5;style.size*=1.5;if(options.title){Flotr.drawText(ctx,options.title,this.plotOffset.left+this.plotWidth/2,this.titleHeight-2,style);}
style.weight=1.8;style.size*=0.8;if(a.x.options.title&&a.x.used){style.textAlign=a.x.options.titleAlign||'center';style.textBaseline='top';style.angle=Flotr.toRad(a.x.options.titleAngle);style=Flotr.getBestTextAlign(style.angle,style);Flotr.drawText(ctx,a.x.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top+a.x.maxLabel.height+this.plotHeight+2*margin,style);}
if(a.x2.options.title&&a.x2.used){style.textAlign=a.x2.options.titleAlign||'center';style.textBaseline='bottom';style.angle=Flotr.toRad(a.x2.options.titleAngle);style=Flotr.getBestTextAlign(style.angle,style);Flotr.drawText(ctx,a.x2.options.title,this.plotOffset.left+this.plotWidth/2,this.plotOffset.top-a.x2.maxLabel.height-2*margin,style);}
if(a.y.options.title&&a.y.used){style.textAlign=a.y.options.titleAlign||'right';style.textBaseline='middle';style.angle=Flotr.toRad(a.y.options.titleAngle);style=Flotr.getBestTextAlign(style.angle,style);Flotr.drawText(ctx,a.y.options.title,this.plotOffset.left-a.y.maxLabel.width-2*margin,this.plotOffset.top+this.plotHeight/2,style);}
if(a.y2.options.title&&a.y2.used){style.textAlign=a.y2.options.titleAlign||'left';style.textBaseline='middle';style.angle=Flotr.toRad(a.y2.options.titleAngle);style=Flotr.getBestTextAlign(style.angle,style);Flotr.drawText(ctx,a.y2.options.title,this.plotOffset.left+this.plotWidth+a.y2.maxLabel.width+2*margin,this.plotOffset.top+this.plotHeight/2,style);}}
else{html=[];if(options.title)
html.push('<div style="position:absolute;top:0;left:',this.plotOffset.left,'px;font-size:1em;font-weight:bold;text-align:center;width:',this.plotWidth,'px;" class="flotr-title">',options.title,'</div>');if(options.subtitle)
html.push('<div style="position:absolute;top:',this.titleHeight,'px;left:',this.plotOffset.left,'px;font-size:smaller;text-align:center;width:',this.plotWidth,'px;" class="flotr-subtitle">',options.subtitle,'</div>');html.push('</div>');html.push('<div class="flotr-axis-title" style="font-weight:bold;">');if(a.x.options.title&&a.x.used)
html.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight+options.grid.labelMargin+a.x.titleSize.height),'px;left:',this.plotOffset.left,'px;width:',this.plotWidth,'px;text-align:center;" class="flotr-axis-title">',a.x.options.title,'</div>');if(a.x2.options.title&&a.x2.used)
html.push('<div style="position:absolute;top:0;left:',this.plotOffset.left,'px;width:',this.plotWidth,'px;text-align:center;" class="flotr-axis-title">',a.x2.options.title,'</div>');if(a.y.options.title&&a.y.used)
html.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight/2-a.y.titleSize.height/2),'px;left:0;text-align:right;" class="flotr-axis-title">',a.y.options.title,'</div>');if(a.y2.options.title&&a.y2.used)
html.push('<div style="position:absolute;top:',(this.plotOffset.top+this.plotHeight/2-a.y.titleSize.height/2),'px;right:0;text-align:right;" class="flotr-axis-title">',a.y2.options.title,'</div>');html=html.join('');var div=D.create('div');D.setStyles({color:options.grid.color});div.className='flotr-titles';D.insert(this.el,div);D.insert(div,html);}}});})();;openerp.web_graph=function(instance){var _lt=instance.web._lt;var filter_values=function(o){var out={};for(var k in o){if(!o.hasOwnProperty(k)||o[k]===undefined){continue;}
out[k]=o[k];}
return out;};instance.web.views.add('graph','instance.web_graph.GraphView');instance.web_graph.GraphView=instance.web.View.extend({template:"GraphView",display_name:_lt('Graph'),view_type:"graph",init:function(parent,dataset,view_id,options){var self=this;this._super(parent);this.set_default_options(options);this.dataset=dataset;this.view_id=view_id;this.mode="bar";this.orientation=false;this.stacked=true;this.spreadsheet=false;this.forcehtml=false;this.legend="top";this.domain=[];this.context={};this.group_by=[];this.graph=null;},view_loading:function(r){return this.load_graph(r);},destroy:function(){if(this.graph){this.graph.destroy();}
this._super();},load_graph:function(fields_view_get){var self=this;this.fields_view=fields_view_get;this.$el.addClass(this.fields_view.arch.attrs['class']);this.mode=this.fields_view.arch.attrs.type||'bar';this.orientation=this.fields_view.arch.attrs.orientation=='horizontal';var width=this.$el.parent().width();this.$el.css("width",width);this.container=this.$el.find("#editor-render-body").css({width:width,height:Math.min(500,width*0.8)})[0];var graph_render=this.proxy('graph_render');this.$el.on('click','.oe_graph_options a',function(evt){var $el=$(evt.target);self.graph_render({data:filter_values({mode:$el.data('mode'),legend:$el.data('legend'),orientation:$el.data('orientation'),stacked:$el.data('stacked')})});});this.$el.find("#graph_show_data").click(function(){self.spreadsheet=!self.spreadsheet;self.graph_render();});this.$el.find("#graph_switch").click(function(){if(self.mode!='radar'){self.orientation=!self.orientation;}
self.graph_render();});this.$el.find("#graph_download").click(function(){if(self.legend=="top"){self.legend="inside";}
self.forcehtml=true;self.graph_get_data().done(function(result){self.graph_render_all(result).download.saveImage('png');}).always(function(){self.forcehtml=false;});});this.trigger('graph_view_loaded',fields_view_get);},get_format:function(options){options=options||{};var legend={show:this.legend!='no',};switch(this.legend){case'top':legend.noColumns=4;legend.container=this.$el.find("div.graph_header_legend")[0];break;case'inside':legend.position='nw';legend.backgroundColor='#D2E8FF';break;}
return _.extend({legend:legend,mouse:{track:true,relative:true},spreadsheet:{show:this.spreadsheet,initialTab:"data"},HtmlText:(options.xaxis&&options.xaxis.labelsAngle)?false:!this.forcehtml,},options);},make_graph:function(mode,container,data){if(mode==='area'){mode='line';}
var format=this.get_format(this['options_'+mode](data));return Flotr.draw(container,data.data,format);},options_bar:function(data){var min=_(data.data).chain().map(function(record){if(record.data.length>0){return _.min(record.data,function(item){return item[1];})[1];}}).min().value();return{bars:{show:true,stacked:this.stacked,horizontal:this.orientation,barWidth:0.7,lineWidth:1},grid:{verticalLines:this.orientation,horizontalLines:!this.orientation,outline:"sw",},yaxis:{ticks:this.orientation?data.ticks:false,min:!this.orientation?(min<0?min:0):null},xaxis:{labelsAngle:45,ticks:this.orientation?false:data.ticks,min:this.orientation?(min<0?min:0):null}};},options_pie:function(data){return{pie:{show:true},grid:{verticalLines:false,horizontalLines:false,outline:"",},xaxis:{showLabels:false},yaxis:{showLabels:false},};},options_radar:function(data){return{radar:{show:true,stacked:this.stacked},grid:{circular:true,minorHorizontalLines:true},xaxis:{ticks:data.ticks},};},options_line:function(data){return{lines:{show:true,},points:{show:true,},grid:{verticalLines:this.orientation,horizontalLines:!this.orientation,outline:"sw",},yaxis:{ticks:this.orientation?data.ticks:false},xaxis:{labelsAngle:45,ticks:this.orientation?false:data.ticks}};},graph_get_data:function(){var model=this.dataset.model,domain=new instance.web.CompoundDomain(this.domain||[]),context=new instance.web.CompoundContext(this.context||{}),group_by=this.group_by||[],view_id=this.view_id||false,mode=this.mode||'bar',orientation=this.orientation||false,stacked=this.stacked||false;var obj=new instance.web.Model(model);var view_get;var fields;var result=[];var ticks={};return this.alive(obj.call("fields_view_get",[view_id,'graph',context]).then(function(tmp){view_get=tmp;fields=view_get['fields'];var toload=_.select(group_by,function(x){return fields[x]===undefined});if(toload.length>=1)
return obj.call("fields_get",[toload,context]);else
return $.when([]);}).then(function(fields_to_add){_.extend(fields,fields_to_add);var tree=$($.parseXML(view_get['arch']));var pos=0;var xaxis=_.clone(group_by||[]);var yaxis=[];tree.find("field").each(function(){var field=$(this);if(!field.attr("name"))
return;if((group_by.length==0)&&((!pos)||instance.web.py_eval(field.attr('group')||"false"))){xaxis.push(field.attr('name'));}
if(pos&&!instance.web.py_eval(field.attr('group')||"false")){yaxis.push(field.attr('name'));}
pos+=1;});if(xaxis.length===0)
throw new Error("No field for the X axis!");if(yaxis.length===0)
throw new Error("No field for the Y axis!");function _convert_key(field,data){if(fields[field]['type']==='many2one')
data=data&&data[0];return data;}
function _convert(field,data,tick){tick=tick===undefined?true:false;try{data=instance.web.format_value(data,fields[field]);}catch(e){data=""+data;}
if(tick){if(ticks[data]===undefined)
ticks[data]=_.size(ticks);return ticks[data];}
return data||0;}
function _orientation(x,y){if(!orientation)
return[x,y]
return[y,x]}
if(mode==="pie"){return obj.call("read_group",[domain,yaxis.concat([xaxis[0]]),[xaxis[0]]],{context:context}).then(function(res){_.each(res,function(record){result.push({'data':[[_convert(xaxis[0],record[xaxis[0]]),record[yaxis[0]]]],'label':_convert(xaxis[0],record[xaxis[0]],false)});});});}else if((!stacked)||(xaxis.length<2)){var defs=[];_.each(xaxis,function(x){defs.push(obj.call("read_group",[domain,yaxis.concat([x]),[x]],{context:context}).then(function(res){return[x,res];}));});return $.when.apply($,defs).then(function(){_.each(_.toArray(arguments),function(res){var x=res[0];res=res[1];result.push({'data':_.map(res,function(record){return _orientation(_convert(x,record[x]),record[yaxis[0]]||0);}),'label':fields[x]['string']});});});}else{xaxis.reverse();return obj.call("read_group",[domain,yaxis.concat(xaxis.slice(0,1)),xaxis.slice(0,1)],{context:context}).then(function(axis){var defs=[];_.each(axis,function(x){var key=x[xaxis[0]]
defs.push(obj.call("read_group",[domain,yaxis.concat(xaxis.slice(1,2)),xaxis.slice(1,2)],{context:context}).then(function(res){return[x,key,res];}));});return $.when.apply($,defs).then(function(){_.each(_.toArray(arguments),function(res){var x=res[0];var key=res[1];res=res[2];result.push({'data':_.map(res,function(record){return _orientation(_convert(xaxis[1],record[xaxis[1]]),record[yaxis[0]]||0);}),'label':_convert(xaxis[0],key,false)})});});});}}).then(function(){var res={'data':result,'ticks':_.map(ticks,function(el,key){return[el,key]})};return res;}));},graph_render:function(options){options=options||{};_.extend(this,options.data);return this.graph_get_data().done(this.proxy('graph_render_all'));},graph_render_all:function(data){var i;if(this.mode=='area'){for(i=0;i<data.data.length;i++){data.data[i].lines={fill:true}}}
if(this.graph){this.graph.destroy();}
this.$el.find(".graph_header_legend").children().remove();this.graph=this.make_graph(this.mode,this.container,data);this.$el.find("a").removeClass("active");var $active=this.$el.find('a[data-mode='+this.mode+']');if($active.length>1){$active=$active.filter('[data-stacked='+this.stacked+']');}
$active=$active.add(this.$el.find('a:not([data-mode])[data-legend='+this.legend+']'));$active.addClass('active');if(this.spreadsheet){this.$el.find("#graph_show_data").addClass("active");}
return this.graph;},do_search:function(domain,context,group_by){this.domain=domain;this.context=context;this.group_by=group_by;this.graph_render();},do_show:function(){this.do_push_state({});return this._super();},});};;openerp.auth_oauth=function(instance){var QWeb=instance.web.qweb;instance.web.Login.include({start:function(parent,params){var self=this;var d=this._super.apply(this,arguments);this.$el.on('click','a.zocial',this.on_oauth_sign_in);this.oauth_providers=[];if(this.params.oauth_error===1){this.do_warn("Sign up error.","Sign up is not allowed on this database.");}else if(this.params.oauth_error===2){this.do_warn("Authentication error","");}
return d.done(this.do_oauth_load).fail(function(){self.do_oauth_load([]);});},on_db_loaded:function(result){this._super.apply(this,arguments);this.$("form [name=db]").change(this.do_oauth_load);},do_oauth_load:function(){var db=this.$("form [name=db]").val();if(db){this.rpc("/auth_oauth/list_providers",{dbname:db}).done(this.on_oauth_loaded);}},on_oauth_loaded:function(result){this.oauth_providers=result;var params=$.deparam($.param.querystring());if(this.oauth_providers.length===1&&params.type==='signup'){this.do_oauth_sign_in(this.oauth_providers[0]);}else{this.$('.oe_oauth_provider_login_button').remove();var buttons=QWeb.render("auth_oauth.Login.button",{"widget":this});this.$(".oe_login_pane form ul").after(buttons);}},on_oauth_sign_in:function(ev){ev.preventDefault();var index=$(ev.target).data('index');var provider=this.oauth_providers[index];return this.do_oauth_sign_in(provider);},do_oauth_sign_in:function(provider){var return_url=_.str.sprintf('%s//%s/auth_oauth/signin',location.protocol,location.host);if(instance.session.debug){return_url+='?debug';}
var state=this._oauth_state(provider);var params={response_type:'token',client_id:provider.client_id,redirect_uri:return_url,scope:provider.scope,state:JSON.stringify(state),};var url=provider.auth_endpoint+'?'+$.param(params);window.location=url;},_oauth_state:function(provider){var dbname=this.$("form [name=db]").val();return{d:dbname,p:provider.id,};},});};;openerp.auth_oauth_signup=function(instance){instance.web.Login.include({_oauth_state:function(provider){var state=this._super.apply(this,arguments);if(this.params.token){state.t=this.params.token;}
return state;},});};;openerp.hr_timesheet_sheet=function(instance){var QWeb=instance.web.qweb;var _t=instance.web._t;instance.hr_timesheet_sheet.WeeklyTimesheet=instance.web.form.FormWidget.extend(instance.web.form.ReinitializeWidgetMixin,{events:{"click .oe_timesheet_weekly_account a":"go_to",},init:function(){this._super.apply(this,arguments);this.set({sheets:[],date_to:false,date_from:false,});this.updating=false;this.field_manager.on("field_changed:timesheet_ids",this,this.query_sheets);this.field_manager.on("field_changed:date_from",this,function(){this.set({"date_from":instance.web.str_to_date(this.field_manager.get_field_value("date_from"))});});this.field_manager.on("field_changed:date_to",this,function(){this.set({"date_to":instance.web.str_to_date(this.field_manager.get_field_value("date_to"))});});this.field_manager.on("field_changed:user_id",this,function(){this.set({"user_id":this.field_manager.get_field_value("user_id")});});this.on("change:sheets",this,this.update_sheets);this.res_o2m_drop=new instance.web.DropMisordered();this.render_drop=new instance.web.DropMisordered();this.description_line=_t("/");},go_to:function(event){var id=JSON.parse($(event.target).data("id"));this.do_action({type:'ir.actions.act_window',res_model:"account.analytic.account",res_id:id,views:[[false,'form']],target:'current'});},query_sheets:function(){var self=this;if(self.updating)
return;var commands=this.field_manager.get_field_value("timesheet_ids");this.res_o2m_drop.add(new instance.web.Model(this.view.model).call("resolve_2many_commands",["timesheet_ids",commands,[],new instance.web.CompoundContext()])).done(function(result){self.querying=true;self.set({sheets:result});self.querying=false;});},update_sheets:function(){var self=this;if(self.querying)
return;self.updating=true;self.field_manager.set_values({timesheet_ids:self.get("sheets")}).done(function(){self.updating=false;});},initialize_field:function(){instance.web.form.ReinitializeWidgetMixin.initialize_field.call(this);var self=this;self.on("change:sheets",self,self.initialize_content);self.on("change:date_to",self,self.initialize_content);self.on("change:date_from",self,self.initialize_content);self.on("change:user_id",self,self.initialize_content);},initialize_content:function(){var self=this;if(self.setting)
return;if(!self.get("date_to")||!self.get("date_from"))
return;this.destroy_content();var dates;var accounts;var account_names;var default_get;return this.render_drop.add(new instance.web.Model("hr.analytic.timesheet").call("default_get",[['account_id','general_account_id','journal_id','date','name','user_id','product_id','product_uom_id','to_invoice','amount','unit_amount'],new instance.web.CompoundContext({'user_id':self.get('user_id')})]).then(function(result){default_get=result;dates=[];var start=self.get("date_from");var end=self.get("date_to");while(start<=end){dates.push(start);start=start.clone().addDays(1);}
accounts=_(self.get("sheets")).chain().map(function(el){if(typeof(el.account_id)==="object")
el.account_id=el.account_id[0];return el;}).groupBy("account_id").value();var account_ids=_.map(_.keys(accounts),function(el){return el==="false"?false:Number(el)});return new instance.web.Model("hr.analytic.timesheet").call("multi_on_change_account_id",[[],account_ids,new instance.web.CompoundContext({'user_id':self.get('user_id')})]).then(function(accounts_defaults){accounts=_(accounts).chain().map(function(lines,account_id){account_defaults=_.extend({},default_get,(accounts_defaults[account_id]||{}).value||{});account_id=account_id==="false"?false:Number(account_id);var index=_.groupBy(lines,"date");var days=_.map(dates,function(date){var day={day:date,lines:index[instance.web.date_to_str(date)]||[]};var to_add=_.find(day.lines,function(line){return line.name===self.description_line});if(to_add){day.lines=_.without(day.lines,to_add);day.lines.unshift(to_add);}else{day.lines.unshift(_.extend(_.clone(account_defaults),{name:self.description_line,unit_amount:0,date:instance.web.date_to_str(date),account_id:account_id,}));}
return day;});return{account:account_id,days:days,account_defaults:account_defaults};}).value();return new instance.web.Model("account.analytic.account").call("name_get",[_.pluck(accounts,"account"),new instance.web.CompoundContext()]).then(function(result){account_names={};_.each(result,function(el){account_names[el[0]]=el[1];});accounts=_.sortBy(accounts,function(el){return account_names[el.account];});});;});})).then(function(result){self.dates=dates;self.accounts=accounts;self.account_names=account_names;self.default_get=default_get;self.display_data();});},destroy_content:function(){if(this.dfm){this.dfm.destroy();this.dfm=undefined;}},display_data:function(){var self=this;self.$el.html(QWeb.render("hr_timesheet_sheet.WeeklyTimesheet",{widget:self}));_.each(self.accounts,function(account){_.each(_.range(account.days.length),function(day_count){if(!self.get('effective_readonly')){self.get_box(account,day_count).val(self.sum_box(account,day_count)).change(function(){var num=Number($(this).val());if(isNaN(num)){$(this).val(self.sum_box(account,day_count));}else{account.days[day_count].lines[0].unit_amount+=num-self.sum_box(account,day_count);self.display_totals();self.sync();}});}else{self.get_box(account,day_count).html(self.sum_box(account,day_count));}});});self.display_totals();self.$(".oe_timesheet_weekly_adding button").click(_.bind(this.init_add_account,this));},init_add_account:function(){var self=this;if(self.dfm)
return;self.$(".oe_timesheet_weekly_add_row").show();self.dfm=new instance.web.form.DefaultFieldManager(self);self.dfm.extend_field_desc({account:{relation:"account.analytic.account",},});self.account_m2o=new instance.web.form.FieldMany2One(self.dfm,{attrs:{name:"account",type:"many2one",domain:[['type','in',['normal','contract']],['state','<>','close'],['use_timesheets','=',1],['id','not in',_.pluck(self.accounts,"account")],],context:{default_use_timesheets:1,default_type:"contract",},modifiers:'{"required": true}',},});self.account_m2o.prependTo(self.$(".oe_timesheet_weekly_add_row td"));self.$(".oe_timesheet_weekly_add_row button").click(function(){var id=self.account_m2o.get_value();if(id===false){self.dfm.set({display_invalid_fields:true});return;}
var ops=self.generate_o2m_value();new instance.web.Model("hr.analytic.timesheet").call("on_change_account_id",[[],id]).then(function(res){var def=_.extend({},self.default_get,res.value,{name:self.description_line,unit_amount:0,date:instance.web.date_to_str(self.dates[0]),account_id:id,});ops.push(def);self.set({"sheets":ops});});});},get_box:function(account,day_count){return this.$('[data-account="'+account.account+'"][data-day-count="'+day_count+'"]');},get_total:function(account){return this.$('[data-account-total="'+account.account+'"]');},get_day_total:function(day_count){return this.$('[data-day-total="'+day_count+'"]');},get_super_total:function(){return this.$('.oe_timesheet_weekly_supertotal');},sum_box:function(account,day_count){var line_total=0;_.each(account.days[day_count].lines,function(line){line_total+=line.unit_amount;});return line_total;},display_totals:function(){var self=this;var day_tots=_.map(_.range(self.dates.length),function(){return 0});var super_tot=0;_.each(self.accounts,function(account){var acc_tot=0;_.each(_.range(self.dates.length),function(day_count){var sum=self.sum_box(account,day_count);acc_tot+=sum;day_tots[day_count]+=sum;super_tot+=sum;});self.get_total(account).html(acc_tot);});_.each(_.range(self.dates.length),function(day_count){self.get_day_total(day_count).html(day_tots[day_count]);});self.get_super_total().html(super_tot);},sync:function(){var self=this;self.setting=true;self.set({sheets:this.generate_o2m_value()});self.setting=false;},generate_o2m_value:function(){var self=this;var ops=[];_.each(self.accounts,function(account){var auth_keys=_.extend(_.clone(account.account_defaults),{name:true,unit_amount:true,date:true,account_id:true,});_.each(account.days,function(day){_.each(day.lines,function(line){if(line.unit_amount!==0){var tmp=_.clone(line);tmp.id=undefined;_.each(line,function(v,k){if(v instanceof Array){tmp[k]=v[0];}});_.each(_.keys(tmp),function(key){if(auth_keys[key]===undefined){tmp[key]=undefined;}});ops.push(tmp);}});});});return ops;},});instance.web.form.custom_widgets.add('weekly_timesheet','instance.hr_timesheet_sheet.WeeklyTimesheet');};;dhtmlxAjax={get:function(url,callback){var t=new dtmlXMLLoaderObject(true);t.async=(arguments.length<3);t.waitCall=callback;t.loadXML(url)
return t;},post:function(url,post,callback){var t=new dtmlXMLLoaderObject(true);t.async=(arguments.length<4);t.waitCall=callback;t.loadXML(url,true,post)
return t;},getSync:function(url){return this.get(url,null,true)},postSync:function(url,post){return this.post(url,post,null,true);}}
function dtmlXMLLoaderObject(funcObject,dhtmlObject,async,rSeed){this.xmlDoc="";if(typeof(async)!="undefined")
this.async=async;else
this.async=true;this.onloadAction=funcObject||null;this.mainObject=dhtmlObject||null;this.waitCall=null;this.rSeed=rSeed||false;return this;};dtmlXMLLoaderObject.prototype.waitLoadFunction=function(dhtmlObject){var once=true;this.check=function(){if((dhtmlObject)&&(dhtmlObject.onloadAction!=null)){if((!dhtmlObject.xmlDoc.readyState)||(dhtmlObject.xmlDoc.readyState==4)){if(!once)
return;once=false;if(typeof dhtmlObject.onloadAction=="function")
dhtmlObject.onloadAction(dhtmlObject.mainObject,null,null,null,dhtmlObject);if(dhtmlObject.waitCall){dhtmlObject.waitCall.call(this,dhtmlObject);dhtmlObject.waitCall=null;}}}};return this.check;};dtmlXMLLoaderObject.prototype.getXMLTopNode=function(tagName,oldObj){if(this.xmlDoc.responseXML){var temp=this.xmlDoc.responseXML.getElementsByTagName(tagName);if(temp.length==0&&tagName.indexOf(":")!=-1)
var temp=this.xmlDoc.responseXML.getElementsByTagName((tagName.split(":"))[1]);var z=temp[0];}else
var z=this.xmlDoc.documentElement;if(z){this._retry=false;return z;}
if((_isIE)&&(!this._retry)){var xmlString=this.xmlDoc.responseText;var oldObj=this.xmlDoc;this._retry=true;this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.async=false;this.xmlDoc["loadXM"+"L"](xmlString);return this.getXMLTopNode(tagName,oldObj);}
dhtmlxError.throwError("LoadXML","Incorrect XML",[(oldObj||this.xmlDoc),this.mainObject]);return document.createElement("DIV");};dtmlXMLLoaderObject.prototype.loadXMLString=function(xmlString){{try{var parser=new DOMParser();this.xmlDoc=parser.parseFromString(xmlString,"text/xml");}
catch(e){this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM");this.xmlDoc.async=this.async;this.xmlDoc["loadXM"+"L"](xmlString);}}
this.onloadAction(this.mainObject,null,null,null,this);if(this.waitCall){this.waitCall();this.waitCall=null;}}
dtmlXMLLoaderObject.prototype.loadXML=function(filePath,postMode,postVars,rpc){if(this.rSeed)
filePath+=((filePath.indexOf("?")!=-1)?"&":"?")+"a_dhx_rSeed="+(new Date()).valueOf();this.filePath=filePath;if((!_isIE)&&(window.XMLHttpRequest))
this.xmlDoc=new XMLHttpRequest();else{if(document.implementation&&document.implementation.createDocument){this.xmlDoc=document.implementation.createDocument("","",null);this.xmlDoc.onload=new this.waitLoadFunction(this);this.xmlDoc.load(filePath);return;}else
this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP");}
if(this.async)
this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this);this.xmlDoc.open(postMode?"POST":"GET",filePath,this.async);if(rpc){this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")");this.xmlDoc.setRequestHeader("Content-type","text/xml");}
else if(postMode)
this.xmlDoc.setRequestHeader('Content-type','application/x-www-form-urlencoded');this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlDoc.send(null||postVars);if(!this.async)
(new this.waitLoadFunction(this))();};dtmlXMLLoaderObject.prototype.destructor=function(){this._filterXPath=null;this._getAllNamedChilds=null;this._retry=null;this.async=null;this.rSeed=null;this.filePath=null;this.onloadAction=null;this.mainObject=null;this.xmlDoc=null;this.doXPath=null;this.doXPathOpera=null;this.doXSLTransToObject=null;this.doXSLTransToString=null;this.loadXML=null;this.loadXMLString=null;this.doSerialization=null;this.xmlNodeToJSON=null;this.getXMLTopNode=null;this.setXSLParamValue=null;return null;}
dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(node){var t={};for(var i=0;i<node.attributes.length;i++)
t[node.attributes[i].name]=node.attributes[i].value;t["_tagvalue"]=node.firstChild?node.firstChild.nodeValue:"";for(var i=0;i<node.childNodes.length;i++){var name=node.childNodes[i].tagName;if(name){if(!t[name])t[name]=[];t[name].push(this.xmlNodeToJSON(node.childNodes[i]));}}
return t;}
function callerFunction(funcObject,dhtmlObject){this.handler=function(e){if(!e)
e=window.event;funcObject(e,dhtmlObject);return true;};return this.handler;};function getAbsoluteLeft(htmlObject){return getOffset(htmlObject).left;}
function getAbsoluteTop(htmlObject){return getOffset(htmlObject).top;}
function getOffsetSum(elem){var top=0,left=0;while(elem){top=top+parseInt(elem.offsetTop);left=left+parseInt(elem.offsetLeft);elem=elem.offsetParent;}
return{top:top,left:left};}
function getOffsetRect(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)};}
function getOffset(elem){if(elem.getBoundingClientRect){return getOffsetRect(elem);}else{return getOffsetSum(elem);}}
function convertStringToBoolean(inputString){if(typeof(inputString)=="string")
inputString=inputString.toLowerCase();switch(inputString){case"1":case"true":case"yes":case"y":case 1:case true:return true;break;default:return false;}}
function getUrlSymbol(str){if(str.indexOf("?")!=-1)
return"&"
else
return"?"}
function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)
return window.dhtmlDragAndDrop;this.lastLanding=0;this.dragNode=0;this.dragStartNode=0;this.dragStartObject=0;this.tempDOMU=null;this.tempDOMM=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this;};dhtmlDragAndDropObject.prototype.removeDraggableItem=function(htmlNode){htmlNode.onmousedown=null;htmlNode.dragStarter=null;htmlNode.dragLanding=null;}
dhtmlDragAndDropObject.prototype.addDraggableItem=function(htmlNode,dhtmlObject){htmlNode.onmousedown=this.preCreateDragCopy;htmlNode.dragStarter=dhtmlObject;this.addDragLanding(htmlNode,dhtmlObject);}
dhtmlDragAndDropObject.prototype.addDragLanding=function(htmlNode,dhtmlObject){htmlNode.dragLanding=dhtmlObject;}
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){if((e||window.event)&&(e||event).button==2)
return;if(window.dhtmlDragAndDrop.waitDrag){window.dhtmlDragAndDrop.waitDrag=0;document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU;document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM;return false;}
window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove;window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=new Date().valueOf();if((e)&&(e.preventDefault)){e.preventDefault();return false;}
return false;};dhtmlDragAndDropObject.prototype.callDrag=function(e){if(!e)
e=window.event;dragger=window.dhtmlDragAndDrop;if((new Date()).valueOf()-dragger.downtime<100)return;if((e.button==0)&&(_isIE))
return dragger.stopDrag();if(!dragger.dragNode&&dragger.waitDrag){dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e);if(!dragger.dragNode)
return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return false;}
dragger.gldragNode=dragger.dragNode;document.body.appendChild(dragger.dragNode);document.body.onmouseup=dragger.stopDrag;dragger.waitDrag=0;dragger.dragNode.pWindow=window;dragger.initFrameRoute();}
if(dragger.dragNode.parentNode!=window.document.body){var grd=dragger.gldragNode;if(dragger.gldragNode.old)
grd=dragger.gldragNode.old;grd.parentNode.removeChild(grd);var oldBody=dragger.dragNode.pWindow;if(grd.pWindow&&grd.pWindow.dhtmlDragAndDrop.lastLanding)
grd.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(grd.pWindow.dhtmlDragAndDrop.lastLanding);if(_isIE){var div=document.createElement("Div");div.innerHTML=dragger.dragNode.outerHTML;dragger.dragNode=div.childNodes[0];}else
dragger.dragNode=dragger.dragNode.cloneNode(true);dragger.dragNode.pWindow=window;dragger.gldragNode.old=dragger.dragNode;document.body.appendChild(dragger.dragNode);oldBody.dhtmlDragAndDrop.dragNode=dragger.dragNode;}
dragger.dragNode.style.left=e.clientX+15+(dragger.fx?dragger.fx*(-1):0)
+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";dragger.dragNode.style.top=e.clientY+3+(dragger.fy?dragger.fy*(-1):0)
+(document.body.scrollTop||document.documentElement.scrollTop)+"px";if(!e.srcElement)
var z=e.target;else
z=e.srcElement;dragger.checkLanding(z,e);}
dhtmlDragAndDropObject.prototype.calculateFramePosition=function(n){if(window.name){var el=parent.frames[window.name].frameElement.offsetParent;var fx=0;var fy=0;while(el){fx+=el.offsetLeft;fy+=el.offsetTop;el=el.offsetParent;}
if((parent.dhtmlDragAndDrop)){var ls=parent.dhtmlDragAndDrop.calculateFramePosition(1);fx+=ls.split('_')[0]*1;fy+=ls.split('_')[1]*1;}
if(n)
return fx+"_"+fy;else
this.fx=fx;this.fy=fy;}
return"0_0";}
dhtmlDragAndDropObject.prototype.checkLanding=function(htmlObject,e){if((htmlObject)&&(htmlObject.dragLanding)){if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding);this.lastLanding=htmlObject;this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,e.clientX,e.clientY,e);this.lastLanding_scr=(_isIE?e.srcElement:e.target);}else{if((htmlObject)&&(htmlObject.tagName!="BODY"))
this.checkLanding(htmlObject.parentNode,e);else{if(this.lastLanding)
this.lastLanding.dragLanding._dragOut(this.lastLanding,e.clientX,e.clientY,e);this.lastLanding=0;if(this._onNotFound)
this._onNotFound();}}}
dhtmlDragAndDropObject.prototype.stopDrag=function(e,mode){dragger=window.dhtmlDragAndDrop;if(!mode){dragger.stopFrameRoute();var temp=dragger.lastLanding;dragger.lastLanding=null;if(temp)
temp.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,temp,(_isIE?event.srcElement:e.target));}
dragger.lastLanding=null;if((dragger.dragNode)&&(dragger.dragNode.parentNode==document.body))
dragger.dragNode.parentNode.removeChild(dragger.dragNode);dragger.dragNode=0;dragger.gldragNode=0;dragger.fx=0;dragger.fy=0;dragger.dragStartNode=0;dragger.dragStartObject=0;document.body.onmouseup=dragger.tempDOMU;document.body.onmousemove=dragger.tempDOMM;dragger.tempDOMU=null;dragger.tempDOMM=null;dragger.waitDrag=0;}
dhtmlDragAndDropObject.prototype.stopFrameRoute=function(win){if(win)
window.dhtmlDragAndDrop.stopDrag(1,1);for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.stopFrameRoute(window);}catch(e){}}
dhtmlDragAndDropObject.prototype.initFrameRoute=function(win,mode){if(win){window.dhtmlDragAndDrop.preCreateDragCopy();window.dhtmlDragAndDrop.dragStartNode=win.dhtmlDragAndDrop.dragStartNode;window.dhtmlDragAndDrop.dragStartObject=win.dhtmlDragAndDrop.dragStartObject;window.dhtmlDragAndDrop.dragNode=win.dhtmlDragAndDrop.dragNode;window.dhtmlDragAndDrop.gldragNode=win.dhtmlDragAndDrop.dragNode;window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag;window.waitDrag=0;if(((!_isIE)&&(mode))&&((!_isFF)||(_FFrv<1.8)))
window.dhtmlDragAndDrop.calculateFramePosition();}
try{if((parent.dhtmlDragAndDrop)&&(parent!=window)&&(parent!=win))
parent.dhtmlDragAndDrop.initFrameRoute(window);}catch(e){}
for(var i=0;i<window.frames.length;i++){try{if((window.frames[i]!=win)&&(window.frames[i].dhtmlDragAndDrop))
window.frames[i].dhtmlDragAndDrop.initFrameRoute(window,((!win||mode)?1:0));}catch(e){}}}
var _isFF=false;var _isIE=false;var _isOpera=false;var _isKHTML=false;var _isMacOS=false;var _isChrome=false;if(navigator.userAgent.indexOf('Macintosh')!=-1)
_isMacOS=true;if(navigator.userAgent.toLowerCase().indexOf('chrome')>-1)
_isChrome=true;if((navigator.userAgent.indexOf('Safari')!=-1)||(navigator.userAgent.indexOf('Konqueror')!=-1)){var _KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Safari')+7,5));if(_KHTMLrv>525){_isFF=true;var _FFrv=1.9;}else
_isKHTML=true;}else if(navigator.userAgent.indexOf('Opera')!=-1){_isOpera=true;_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf('Opera')+6,3));}
else if(navigator.appName.indexOf("Microsoft")!=-1){_isIE=true;if(navigator.appVersion.indexOf("MSIE 8.0")!=-1&&document.compatMode!="BackCompat")_isIE=8;}else{_isFF=true;var _FFrv=parseFloat(navigator.userAgent.split("rv:")[1])}
dtmlXMLLoaderObject.prototype.doXPath=function(xpathExp,docObj,namespace,result_type){if(_isKHTML||(!_isIE&&!window.XPathResult))
return this.doXPathOpera(xpathExp,docObj);if(_isIE){if(!docObj)
if(!this.xmlDoc.nodeName)
docObj=this.xmlDoc.responseXML
else
docObj=this.xmlDoc;if(!docObj)
dhtmlxError.throwError("LoadXML","Incorrect XML",[(docObj||this.xmlDoc),this.mainObject]);if(namespace!=null)
docObj.setProperty("SelectionNamespaces","xmlns:xsl='"+namespace+"'");if(result_type=='single'){return docObj.selectSingleNode(xpathExp);}
else{return docObj.selectNodes(xpathExp)||new Array(0);}}else{var nodeObj=docObj;if(!docObj){if(!this.xmlDoc.nodeName){docObj=this.xmlDoc.responseXML}
else{docObj=this.xmlDoc;}}
if(!docObj)
dhtmlxError.throwError("LoadXML","Incorrect XML",[(docObj||this.xmlDoc),this.mainObject]);if(docObj.nodeName.indexOf("document")!=-1){nodeObj=docObj;}
else{nodeObj=docObj;docObj=docObj.ownerDocument;}
var retType=XPathResult.ANY_TYPE;if(result_type=='single')
retType=XPathResult.FIRST_ORDERED_NODE_TYPE
var rowsCol=new Array();var col=docObj.evaluate(xpathExp,nodeObj,function(pref){return namespace},retType,null);if(retType==XPathResult.FIRST_ORDERED_NODE_TYPE){return col.singleNodeValue;}
var thisColMemb=col.iterateNext();while(thisColMemb){rowsCol[rowsCol.length]=thisColMemb;thisColMemb=col.iterateNext();}
return rowsCol;}}
function _dhtmlxError(type,name,params){if(!this.catches)
this.catches=new Array();return this;}
_dhtmlxError.prototype.catchError=function(type,func_name){this.catches[type]=func_name;}
_dhtmlxError.prototype.throwError=function(type,name,params){if(this.catches[type])
return this.catches[type](type,name,params);if(this.catches["ALL"])
return this.catches["ALL"](type,name,params);alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]);return null;}
window.dhtmlxError=new _dhtmlxError();dtmlXMLLoaderObject.prototype.doXPathOpera=function(xpathExp,docObj){var z=xpathExp.replace(/[\/]+/gi,"/").split('/');var obj=null;var i=1;if(!z.length)
return[];if(z[0]==".")
obj=[docObj];else if(z[0]==""){obj=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(z[i].replace(/\[[^\]]*\]/g,""));i++;}else
return[];for(i;i<z.length;i++)obj=this._getAllNamedChilds(obj,z[i]);if(z[i-1].indexOf("[")!=-1)
obj=this._filterXPath(obj,z[i-1]);return obj;}
dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){var c=new Array();var b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,"");for(var i=0;i<a.length;i++)
if(a[i].getAttribute(b))
c[c.length]=a[i];return c;}
dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=new Array();if(_isKHTML)
b=b.toUpperCase();for(var i=0;i<a.length;i++)for(var j=0;j<a[i].childNodes.length;j++){if(_isKHTML){if(a[i].childNodes[j].tagName&&a[i].childNodes[j].tagName.toUpperCase()==b)
c[c.length]=a[i].childNodes[j];}
else if(a[i].childNodes[j].tagName==b)
c[c.length]=a[i].childNodes[j];}
return c;}
function dhtmlXHeir(a,b){for(var c in b)
if(typeof(b[c])=="function")
a[c]=b[c];return a;}
function dhtmlxEvent(el,event,handler){if(el.addEventListener)
el.addEventListener(event,handler,false);else if(el.attachEvent)
el.attachEvent("on"+event,handler);}
dtmlXMLLoaderObject.prototype.xslDoc=null;dtmlXMLLoaderObject.prototype.setXSLParamValue=function(paramName,paramValue,xslDoc){if(!xslDoc)
xslDoc=this.xslDoc
if(xslDoc.responseXML)
xslDoc=xslDoc.responseXML;var item=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+paramName+"']",xslDoc,"http:/\/www.w3.org/1999/XSL/Transform","single");if(item!=null)
item.firstChild.nodeValue=paramValue}
dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(xslDoc,xmlDoc){if(!xslDoc)
xslDoc=this.xslDoc;if(xslDoc.responseXML)
xslDoc=xslDoc.responseXML
if(!xmlDoc)
xmlDoc=this.xmlDoc;if(xmlDoc.responseXML)
xmlDoc=xmlDoc.responseXML
if(!_isIE){if(!this.XSLProcessor){this.XSLProcessor=new XSLTProcessor();this.XSLProcessor.importStylesheet(xslDoc);}
var result=this.XSLProcessor.transformToDocument(xmlDoc);}else{var result=new ActiveXObject("Msxml2.DOMDocument.3.0");try{xmlDoc.transformNodeToObject(xslDoc,result);}catch(e){result=xmlDoc.transformNode(xslDoc);}}
return result;}
dtmlXMLLoaderObject.prototype.doXSLTransToString=function(xslDoc,xmlDoc){var res=this.doXSLTransToObject(xslDoc,xmlDoc);if(typeof(res)=="string")
return res;return this.doSerialization(res);}
dtmlXMLLoaderObject.prototype.doSerialization=function(xmlDoc){if(!xmlDoc)
xmlDoc=this.xmlDoc;if(xmlDoc.responseXML)
xmlDoc=xmlDoc.responseXML
if(!_isIE){var xmlSerializer=new XMLSerializer();return xmlSerializer.serializeToString(xmlDoc);}else
return xmlDoc.xml;}
dhtmlxEventable=function(obj){obj.attachEvent=function(name,catcher,callObj){name='ev_'+name.toLowerCase();if(!this[name])
this[name]=new this.eventCatcher(callObj||this);return(name+':'+this[name].addEvent(catcher));}
obj.callEvent=function(name,arg0){name='ev_'+name.toLowerCase();if(this[name])
return this[name].apply(this,arg0);return true;}
obj.checkEvent=function(name){return(!!this['ev_'+name.toLowerCase()])}
obj.eventCatcher=function(obj){var dhx_catch=[];var z=function(){var res=true;for(var i=0;i<dhx_catch.length;i++){if(dhx_catch[i]!=null){var zr=dhx_catch[i].apply(obj,arguments);res=res&&zr;}}
return res;}
z.addEvent=function(ev){if(typeof(ev)!="function")
ev=eval(ev);if(ev)
return dhx_catch.push(ev)-1;return false;}
z.removeEvent=function(id){dhx_catch[id]=null;}
return z;}
obj.detachEvent=function(id){if(id!=false){var list=id.split(':');this[list[0]].removeEvent(list[1]);}}
obj.detachAllEvents=function(){for(var name in this){if(name.indexOf("ev_")==0)
delete this[name];}}};function GanttProjectInfo(id,name,startDate)
{this.Id=id;this.Name=name;this.StartDate=startDate;this.ParentTasks=[];}
GanttProjectInfo.prototype.deleteTask=function(id)
{var task=this.getTaskById(id);if(task){if(!task.ParentTask){for(var i=0;i<this.ParentTasks.length;i++){if(this.ParentTasks[i].Id==id){if(this.ParentTasks[i].nextParentTask){if(this.ParentTasks[i].previousParentTask){this.ParentTasks[i].previousParentTask.nextParentTask=this.ParentTasks[i].nextParentTask;this.ParentTasks[i].nextParentTask.previousParentTask=this.ParentTasks[i].previousParentTask;}else{this.ParentTasks[i].nextParentTask.previousParentTask=null;}}else{if(this.ParentTasks[i].previousParentTask){this.ParentTasks[i].previousParentTask.nextParentTask=null;}}
this.ParentTasks[i]=null;this.ParentTasks.splice(i,1);break;}}}else
{var parentTask=task.ParentTask;for(var i=0;i<parentTask.ChildTasks.length;i++){if(parentTask.ChildTasks[i].Id==id){if(parentTask.ChildTasks[i].nextChildTask){if(parentTask.ChildTasks[i].previousChildTask){parentTask.ChildTasks[i].previousChildTask.nextChildTask=parentTask.ChildTasks[i].nextChildTask;parentTask.ChildTasks[i].nextChildTask.previousChildTask=parentTask.ChildTasks[i].previousChildTask;}else{parentTask.ChildTasks[i].nextChildTask.previousChildTask=null;}}else{if(parentTask.ChildTasks[i].previousChildTask){parentTask.ChildTasks[i].previousChildTask.nextChildTask=null;}}
parentTask.ChildTasks[i]=null;parentTask.ChildTasks.splice(i,1);break;}}}}};GanttProjectInfo.prototype.addTask=function(task)
{this.ParentTasks.push(task);task.setProject(this);};GanttProjectInfo.prototype.getTaskById=function(id)
{for(var j=0;j<this.ParentTasks.length;j++)
{var task=this.getTaskByIdInTree(this.ParentTasks[j],id);if(task)return task;}
return null;};GanttProjectInfo.prototype.getTaskByIdInTree=function(parentTask,id)
{if(parentTask.Id==id)
{return parentTask;}else
{for(var i=0;i<parentTask.ChildTasks.length;i++){if(parentTask.ChildTasks[i].Id==id)
{return parentTask.ChildTasks[i];}
if(parentTask.ChildTasks[i].ChildTasks.length>0)
{if(parentTask.ChildTasks[i].ChildTasks.length>0)
{var cTask=this.getTaskByIdInTree(parentTask.ChildTasks[i],id);if(cTask)return cTask;}}}}
return null;};function GanttTaskInfo(id,name,est,duration,percentCompleted,predecessorTaskId)
{this.Id=id;this.Name=name;this.EST=est;this.Duration=duration;this.PercentCompleted=percentCompleted;this.PredecessorTaskId=predecessorTaskId;this.ChildTasks=[];this.ChildPredTasks=[];this.ParentTask=null;this.PredecessorTask=null;this.Project=null;this.nextChildTask=null;this.previousChildTask=null;this.nextParentTask=null;this.previousParentTask=null;}
GanttTaskInfo.prototype.addChildTask=function(task)
{this.ChildTasks.push(task);task.ParentTask=this;};GanttTaskInfo.prototype.setProject=function(project)
{this.Project=project;for(var j=0;j<this.ChildTasks.length;j++)
{this.ChildTasks[j].setProject(project);}};function GanttTask(taskInfo,project,chart)
{this.isTask=true;this.Chart=chart;this.Project=project;this.TaskInfo=taskInfo;this.checkMove=false;this.checkResize=false;this.moveChild=false;this.maxPosXMove=-1;this.minPosXMove=-1;this.maxWidthResize=-1;this.minWidthResize=-1;this.posX=0;this.posY=0;this.MouseX=0;this.taskItemWidth=0;this.isHide=false;this._heightHideTasks=0;this._isOpen=true;this.descrTask=null;this.cTaskItem=null;this.cTaskNameItem=null;this.parentTask=null;this.predTask=null;this.childTask=[];this.childPredTask=[];this.nextChildTask=null;this.previousChildTask=null;this.nextParentTask=null;this.previousParentTask=null;}
function GanttProject(Chart,projectInfo)
{this.isProject=true;this.nextProject=null;this.previousProject=null;this.arrTasks=[];this.Project=projectInfo;this.Chart=Chart;this.percentCompleted=0;this.Duration=0;this.descrProject=null;this.projectItem=null;this.projectNameItem=null;this.posY=0;this.posX=0;}
GanttProject.prototype.checkWidthProjectNameItem=function()
{if(this.projectNameItem.offsetWidth+this.projectNameItem.offsetLeft>this.Chart.maxWidthPanelNames)
{var width=this.projectNameItem.offsetWidth+this.projectNameItem.offsetLeft-this.Chart.maxWidthPanelNames;var countChar=Math.round(width/(this.projectNameItem.offsetWidth/this.projectNameItem.firstChild.length));var pName=this.Project.Name.substring(0,this.projectNameItem.firstChild.length-countChar-3);pName+="...";this.projectNameItem.innerHTML=pName;}};GanttProject.prototype.create=function()
{var containerTasks=this.Chart.oData.firstChild;this.posX=(this.Project.StartDate-this.Chart.startDate)/(60*60*1000)*this.Chart.hourInPixels;if(this.previousProject)
{if(this.previousProject.arrTasks.length>0){var lastChildTask=this.Chart.getLastChildTask(this.previousProject.arrTasks[this.previousProject.arrTasks.length-1]);this.posY=parseInt(lastChildTask.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;}else{this.posY=parseInt(this.previousProject.projectItem[0].style.top)+this.Chart.heightTaskItem+11;}}else{this.posY=6;}
if(this.Chart._showTreePanel){var containerNames=this.Chart.panelNames.firstChild;this.projectNameItem=this.createProjectNameItem();containerNames.appendChild(this.projectNameItem);this.checkWidthProjectNameItem();}
this.projectItem=[this.createProjectItem(),[]];containerTasks.appendChild(this.projectItem[0]);if(this.Chart.isShowDescProject){containerTasks.appendChild(this.createDescrProject());}
this.addDayInPanelTime();};function GanttChart()
{this.Error=new GanttError();this.dhtmlXMLSenderObject=new dhtmlXMLSenderObject(this);this.heightTaskItem=12;this.dayInPixels=24;this.hoursInDay=8;this._showTreePanel=true;this._showTooltip=true;this.isShowDescTask=false;this.isShowDescProject=false;this.isShowNewProject=true;this.isEditable=false;this.isShowConMenu=false;this.correctError=false;this.maxWidthPanelNames=150;this.minWorkLength=8;this.paramShowTask=[];this.paramShowProject=[];this.savePath=null;this.loadPath=null;this.divTimeInfo=null;this.divInfo=null;this.panelNames=null;this.panelTime=null;this.oData=null;this.content=null;this.panelErrors=null;this.contextMenu=null;this.hourInPixelsWork=this.dayInPixels/this.hoursInDay;this.hourInPixels=this.dayInPixels/24;this.minWidthResize=this.hourInPixels;this.countDays=0;this.startDate=null;this.initialPos=0;this.contentHeight=0;this.contentWidth=0;this._oDataHeight=0;this.Project=[];this.arrProjects=[];this.xmlLoader=null;this._isIE=false;this._isFF=false;this._isOpera=false;this._isMove=false;this._isResize=false;this._isError=false;this.imgs="codebase/imgs/";this.stylePath="codebase/dhtmlxgantt.css";this.shortMonthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];this._useShortMonthNames=true;dhtmlxEventable(this);}
GanttChart.prototype.setImagePath=function(newPath)
{this.imgs=newPath;};GanttChart.prototype.setStylePath=function(newPath)
{this.stylePath=newPath;};GanttChart.prototype.setSavePath=function(newPath)
{this.savePath=newPath;};GanttChart.prototype.setLoadPath=function(newPath)
{this.loadPath=newPath;};GanttChart.prototype.setCorrectError=function(isCorrectError)
{this.correctError=isCorrectError;};GanttChart.prototype.showDescTask=function(isShowDescTask,param)
{this.isShowDescTask=isShowDescTask;var arrValues=new Array(5);if(this.isShowDescTask)
{if(param){var arrParam=param.split(",");for(var i=0;i<arrParam.length;i++){var k=this.getParamShowTask(arrParam[i]);arrValues[k]=1;}}else{arrValues[this.getParamShowTask('')]=1;}
this.paramShowTask=this.getValueShowTask(arrValues);}};GanttChart.prototype.showDescProject=function(isShowDescProject,param)
{this.isShowDescProject=isShowDescProject;var arrValues=new Array(4);if(this.isShowDescProject)
{if(param){var arrParam=param.split(",");for(var i=0;i<arrParam.length;i++){var k=this.getParamShowProject(arrParam[i]);arrValues[k]=1;}}else{arrValues[this.getParamShowProject('')]=1;}
this.paramShowProject=this.getValueShowProject(arrValues);}};GanttChart.prototype.showContextMenu=function(show)
{this.isShowConMenu=show;};GanttChart.prototype.setContextMenu=function(menu)
{this.showContextMenu(true);this.contextMenu=menu;};GanttChart.prototype.showNewProject=function(show)
{this.isShowNewProject=show;};GanttChart.prototype.getParamShowTask=function(param)
{switch(param){case'n':return 0;break;case'd':return 1;break;case'e':return 2;break;case'p':return 3;break;case's-f':return 4;break;default:return 0;break;}};GanttChart.prototype.getParamShowProject=function(param)
{switch(param){case'n':return 0;break;case'd':return 1;break;case's':return 2;break;case'p':return 3;break;default:return 0;break;}};GanttChart.prototype.getValueShowTask=function(param)
{var arrValues=[];for(var i=0;i<param.length;i++){if(param[i])
{switch(i){case 0:arrValues.push('Name');break;case 1:arrValues.push('Duration');break;case 2:arrValues.push('EST');break;case 3:arrValues.push('PercentComplete');break;case 4:arrValues.push('S-F');break;default:break;}}}
return arrValues;};GanttChart.prototype.getValueShowProject=function(param)
{var arrValues=[];for(var i=0;i<param.length;i++){if(param[i])
{switch(i){case 0:arrValues.push('Name');break;case 1:arrValues.push('Duration');break;case 2:arrValues.push('StartDate');break;case 3:arrValues.push('PercentComplete');break;default:break;}}}
return arrValues;};GanttChart.prototype.setEditable=function(isEditable)
{this.isEditable=isEditable;};GanttChart.prototype.showTreePanel=function(show)
{this._showTreePanel=show;};GanttChart.prototype.showTooltip=function(show)
{this._showTooltip=show;};GanttChart.prototype.getProjectById=function(id)
{for(var i=0;i<this.arrProjects.length;i++){if(this.arrProjects[i].Project.Id==id)
{return this.arrProjects[i];}}
return null;};GanttChart.prototype.getBrowserType=function()
{if(navigator.appName.indexOf('Explorer')!=-1)
{this._isIE=true;}else if(navigator.userAgent.indexOf('Mozilla')!=-1)
{this._isFF=true;}else if(navigator.userAgent.indexOf('Opera')!=-1)
{this._isOpera=true;}};GanttChart.prototype.addProject=function(projectInfo)
{this.Project.push(projectInfo);};GanttProject.prototype.deleteTask=function(id)
{var task=this.getTaskById(id);if(task){this.deleteChildTask(task);}else{this.Chart.Error.throwError("DATA_INSERT_ERROR",30,[id]);}};GanttChart.prototype.deleteProject=function(id)
{var project=this.getProjectById(id);if(project)
{if(project.arrTasks.length>0)
{while(project.arrTasks.length>0){project.deleteChildTask(project.arrTasks[0]);}}
if(project.nextProject)project.shiftNextProject(project,-23);for(var i=0;i<this.Project.length;i++){if(this.Project[i].Id==project.Project.Id){this.Project.splice(i,1);}}
if((project.previousProject)&&(project.nextProject))
{var previousProject=project.previousProject;previousProject.nextProject=project.nextProject;}
if((project.previousProject)&&!(project.nextProject))
{var previousProject=project.previousProject;previousProject.nextProject=null;}
if(!(project.previousProject)&&(project.nextProject))
{var nextProject=project.nextProject;nextProject.previousProject=null;}
for(var i=0;i<this.arrProjects.length;i++){if(this.arrProjects[i].Project.Id==id)
{this.arrProjects.splice(i,1);}}
project.projectItem[0].parentNode.removeChild(project.projectItem[0]);if(this.isShowDescProject){project.descrProject.parentNode.removeChild(project.descrProject);}
if(this._showTreePanel){project.projectNameItem.parentNode.removeChild(project.projectNameItem);}
this._oDataHeight-=11+this.heightTaskItem;if(this.Project.length==0)
{if(this.isShowNewProject)
{var d=new Date(this.startDate);var t=new Date(d.setDate(d.getDate()+1));var pi=new GanttProjectInfo(1,"New project",t);this.Project.push(pi);var project=new GanttProject(this,pi);project.create();this.arrProjects.push(project);this._oDataHeight+=11+this.heightTaskItem;}}}else{this.Error.throwError("DATA_INSERT_ERROR",31,[id]);}};GanttProject.prototype.setName=function(name)
{if((name!="")&&(name!=null)){this.Project.Name=name;if(this.Chart._showTreePanel)
{this.projectNameItem.innerHTML=name;this.projectNameItem.title=name;this.checkWidthProjectNameItem();}
if(this.Chart.isShowDescProject)this.descrProject.innerHTML=this.getDescStr();this.addDayInPanelTime();}};GanttProject.prototype.setPercentCompleted=function(percentCompleted)
{percentCompleted=parseInt(percentCompleted);if(isNaN(percentCompleted))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",6,null);return false;}
if(percentCompleted>100)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",7,null);return false;}else if(percentCompleted<0)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",8,null);return false;}
if((percentCompleted>0)&&(percentCompleted<100)&&(this.percentCompleted>0)&&(this.percentCompleted<100))
{this.projectItem[0].firstChild.rows[0].cells[0].width=parseInt(percentCompleted)+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=(percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";this.projectItem[0].firstChild.rows[0].cells[1].width=(100-parseInt(percentCompleted))+"%";this.projectItem[0].firstChild.rows[0].cells[1].firstChild.style.width=((100-percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";}else if(((percentCompleted==0)||(percentCompleted==100))&&(this.percentCompleted>0)&&(this.percentCompleted<100))
{if(percentCompleted==0)
{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);this.projectItem[0].firstChild.rows[0].cells[0].width=100+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";}else if(percentCompleted==100)
{this.projectItem[0].firstChild.rows[0].cells[1].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[1]);this.projectItem[0].firstChild.rows[0].cells[0].width=100+"%";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";}}else if(((percentCompleted==0)||(percentCompleted==100))&&((this.percentCompleted==0)||(this.percentCompleted==100)))
{if((percentCompleted==0)&&(this.percentCompleted==100))
{this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_bg.png";}else if((percentCompleted==100)&&(this.percentCompleted==0))
{this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"parentnode_filled.png";}}else if(((percentCompleted>0)||(percentCompleted<100))&&((this.percentCompleted==0)||(this.percentCompleted==100)))
{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);var cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=percentCompleted+"%";var imgPr=document.createElement("img");imgPr.style.width=(percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"parentnode_filled.png";cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=(100-percentCompleted)+"%";imgPr=document.createElement("img");imgPr.style.width=((100-percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}else if(this.percentCompleted==-1)
{if(percentCompleted==100)
{this.projectItem[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"parentnode_filled.png";}else if(percentCompleted<100&&percentCompleted>0)
{this.projectItem[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.projectItem[0].firstChild.rows[0].cells[0]);var cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=percentCompleted+"%";var imgPr=document.createElement("img");imgPr.style.width=(percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"parentnode_filled.png";cellprojectItem=document.createElement("TD");this.projectItem[0].firstChild.rows[0].appendChild(cellprojectItem);cellprojectItem.width=(100-percentCompleted)+"%";imgPr=document.createElement("img");imgPr.style.width=((100-percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}}
this.percentCompleted=percentCompleted;if(this.Chart.isShowDescProject)this.descrProject.innerHTML=this.getDescStr();return true;};GanttProject.prototype.deleteChildTask=function(task)
{if(task)
{if(task.cTaskItem[0].style.display=="none"){this.Chart.openTree(task.parentTask);}
if(task.childPredTask.length>0){for(var i=0;i<task.childPredTask.length;i++)
{for(var t=0;t<task.childPredTask[i].cTaskItem[1].length;t++){task.childPredTask[i].cTaskItem[1][t].parentNode.removeChild(task.childPredTask[i].cTaskItem[1][t]);}
task.childPredTask[i].cTaskItem[1]=[];task.childPredTask[i].predTask=null;}}
if(task.childTask.length>0){while(task.childTask.length>0){this.deleteChildTask(task.childTask[0]);}}
if(task.cTaskItem[0].style.display!="none")task.shiftCurrentTasks(task,-23);this.Project.deleteTask(task.TaskInfo.Id);if(task.cTaskItem[0]){task.cTaskItem[0].parentNode.removeChild(task.cTaskItem[0]);}
if(this.Chart.isShowDescTask){task.descrTask.parentNode.removeChild(task.descrTask);}
if(task.cTaskItem[1].length>0){for(var j=0;j<task.cTaskItem[1].length;j++){task.cTaskItem[1][j].parentNode.removeChild(task.cTaskItem[1][j]);}}
if(task.cTaskNameItem[0]){task.cTaskNameItem[0].parentNode.removeChild(task.cTaskNameItem[0]);}
if(task.cTaskNameItem[1]){for(var j=0;j<task.cTaskNameItem[1].length;j++){task.cTaskNameItem[1][j].parentNode.removeChild(task.cTaskNameItem[1][j]);}}
if(task.cTaskNameItem[2]){task.cTaskNameItem[2].parentNode.removeChild(task.cTaskNameItem[2]);}
if(task.parentTask)
{if(task.previousChildTask){if(task.nextChildTask){task.previousChildTask.nextChildTask=task.nextChildTask;}else{task.previousChildTask.nextChildTask=null;}}
var parentTask=task.parentTask;for(var i=0;i<parentTask.childTask.length;i++)
{if(parentTask.childTask[i].TaskInfo.Id==task.TaskInfo.Id){parentTask.childTask[i]=null;parentTask.childTask.splice(i,1);break;}}
if(parentTask.childTask.length==0){if(parentTask.cTaskNameItem[2]){parentTask.cTaskNameItem[2].parentNode.removeChild(parentTask.cTaskNameItem[2]);parentTask.cTaskNameItem[2]=null;}}}else
{if(task.previousParentTask)
{if(task.nextParentTask){task.previousParentTask.nextParentTask=task.nextParentTask;}else{task.previousParentTask.nextParentTask=null;}}
var project=task.Project;for(var i=0;i<project.arrTasks.length;i++){if(project.arrTasks[i].TaskInfo.Id==task.TaskInfo.Id){project.arrTasks.splice(i,1);}}}
if(task.predTask){var predTask=task.predTask;for(var i=0;i<predTask.childPredTask.length;i++){if(predTask.childPredTask[i].TaskInfo.Id==task.TaskInfo.Id){predTask.childPredTask[i]=null;predTask.childPredTask.splice(i,1);}}}
if(task.Project.arrTasks.length!=0){task.Project.shiftProjectItem();}
else{task.Project.projectItem[0].style.display="none";if(this.Chart.isShowDescProject)this.hideDescrProject();}
this.Chart._oDataHeight-=11+this.Chart.heightTaskItem;}};GanttProject.prototype.insertTask=function(id,name,EST,Duration,PercentCompleted,predecessorTaskId,parentTaskId)
{var task=null;var _task=null;if(this.Project.getTaskById(id)){this.Chart.Error.throwError("DATA_INSERT_ERROR",22,[id]);return false;}
if((!Duration)||(Duration<this.Chart.minWorkLength)){Duration=this.Chart.minWorkLength;}
if((!name)||(name=="")){name=id;}
if((!PercentCompleted)||(PercentCompleted=="")){PercentCompleted=0;}else{PercentCompleted=parseInt(PercentCompleted);if(PercentCompleted<0||PercentCompleted>100){this.Chart.Error.throwError("DATA_INSERT_ERROR",35,null);return false;}}
var sortRequired=false;if((parentTaskId)&&(parentTaskId!="")){var parentTask=this.Project.getTaskById(parentTaskId);if(!parentTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",21,[parentTaskId]);return false;}
EST=EST||parentTask.EST;if(EST<parentTask.EST){this.Chart.Error.throwError("DATA_INSERT_ERROR",20,[id,parentTaskId]);return false;}
task=new GanttTaskInfo(id,name,EST,Duration,PercentCompleted,predecessorTaskId);if(!this.Chart.checkPosParentTask(parentTask,task)){this.Chart.Error.throwError("DATA_INSERT_ERROR",19,[parentTaskId,id]);return false;}
task.ParentTask=parentTask;var _parentTask=this.getTaskById(parentTask.Id);var isHide=false;if(_parentTask.cTaskItem[0].style.display=="none"){isHide=true;}else if(_parentTask.cTaskNameItem[2]){if(!_parentTask._isOpen){isHide=true;}}
if(isHide){if(_parentTask.childTask.length==0){this.Chart.openTree(_parentTask.parentTask);}else{this.Chart.openTree(_parentTask);}}
if(predecessorTaskId!="")
{var predTask=this.Project.getTaskById(predecessorTaskId);if(!predTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[predecessorTaskId]);return false;}
if(predTask.ParentTask){if(predTask.ParentTask.Id!=task.ParentTask.Id){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[predTask.Id,task.Id]);return false;}}else{this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[predTask.Id,task.Id]);return false;}
if(!this.Chart.checkPosPredecessorTask(predTask,task)){this.Chart.correctPosPredecessorTask(predTask,task);}
task.PredecessorTask=predTask;}
var isAdd=false;if(sortRequired)for(var i=0;i<parentTask.ChildTasks.length;i++){if(task.EST<parentTask.ChildTasks[i].EST)
{parentTask.ChildTasks.splice(i,0,task);if(i>0){parentTask.ChildTasks[i-1].nextChildTask=parentTask.ChildTasks[i];parentTask.ChildTasks[i].previousChildTask=parentTask.ChildTasks[i-1];}
if(parentTask.ChildTasks[i+1]){parentTask.ChildTasks[i+1].previousChildTask=parentTask.ChildTasks[i];parentTask.ChildTasks[i].nextChildTask=parentTask.ChildTasks[i+1];}
isAdd=true;break;}}
if(!isAdd){if(parentTask.ChildTasks.length>0){parentTask.ChildTasks[parentTask.ChildTasks.length-1].nextChildTask=task;task.previousChildTask=parentTask.ChildTasks[parentTask.ChildTasks.length-1];}
parentTask.ChildTasks.push(task);}
if(parentTask.ChildTasks.length==1){_parentTask.cTaskNameItem[2]=_parentTask.createTreeImg();}
_task=new GanttTask(task,this,this.Chart);_task.create();if(task.nextChildTask)_task.nextChildTask=_task.Project.getTaskById(task.nextChildTask.Id);_task.addDayInPanelTime();_task.shiftCurrentTasks(_task,23);}else
{EST=EST||this.Project.StartDate;task=new GanttTaskInfo(id,name,EST,Duration,PercentCompleted,predecessorTaskId);if(task.EST<=this.Chart.startDate){this.Chart.Error.throwError("DATA_INSERT_ERROR",18,[task.Id]);return false;}
if(predecessorTaskId!=""){var predTask=this.Project.getTaskById(predecessorTaskId);if(!predTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[predecessorTaskId]);return false;}
if(!this.Chart.checkPosPredecessorTask(predTask,task)){this.Chart.correctPosPredecessorTask(predTask,task);}
if(predTask.ParentTask){this.Chart.Error.throwError("DATA_INSERT_ERROR",15,[task.Id,predTask.Id]);return false;}
task.PredecessorTask=predTask;}
var isAdd=false;if(sortRequired)for(var i=0;i<this.Project.ParentTasks.length;i++){if(EST<this.Project.ParentTasks[i].EST)
{this.Project.ParentTasks.splice(i,0,task);if(i>0){this.Project.ParentTasks[i-1].nextParentTask=task;task.previousParentTask=this.Project.ParentTasks[i-1];}
if(this.Project.ParentTasks[i+1]){this.Project.ParentTasks[i+1].previousParentTask=task;task.nextParentTask=this.Project.ParentTasks[i+1];}
isAdd=true;break;}}
if(!isAdd){if(this.Project.ParentTasks.length>0){this.Project.ParentTasks[this.Project.ParentTasks.length-1].nextParentTask=task;task.previousParentTask=this.Project.ParentTasks[this.Project.ParentTasks.length-1];}
this.Project.ParentTasks.push(task);}
_task=new GanttTask(task,this,this.Chart);_task.create();if(task.nextParentTask)_task.nextParentTask=_task.Project.getTaskById(task.nextParentTask.Id);_task.addDayInPanelTime();this.arrTasks.push(_task);_task.shiftCurrentTasks(_task,23);this.projectItem[0].style.display="inline";this.setPercentCompleted(this.getPercentCompleted());this.shiftProjectItem();if(this.Chart.isShowDescProject){this.showDescrProject();}}
this.Chart.checkHeighPanelTasks();return _task;};GanttChart.prototype.checkPosPredecessorTask=function(predTask,task)
{var widthPred=this.getWidthOnDuration(predTask.Duration);var posPred=this.getPosOnDate(predTask.EST);var posChild=this.getPosOnDate(task.EST);return(widthPred+posPred)<=posChild;};GanttChart.prototype.correctPosPredecessorTask=function(predTask,ctask,ctaskObj)
{var newDate=new Date(predTask.EST);newDate.setHours(newDate.getHours()+(predTask.Duration/this.hoursInDay*24));if(newDate.getHours()>0){newDate.setHours(0);newDate.setDate(newDate.getDate()+1);}
if(ctaskObj)ctaskObj.setEST(newDate,true);else ctask.EST=newDate;if(ctask.ParentTask)
{if(!this.checkPosParentTask(ctask.ParentTask,ctask))
{var newDate2=new Date(ctask.ParentTask.EST);newDate2.setHours(newDate2.getHours()+(ctask.ParentTask.Duration/this.hoursInDay*24));ctask.Duration=parseInt((parseInt((newDate2-ctask.EST)/(1000*60*60)))*this.hoursInDay/24);}}};GanttChart.prototype.correctPosParentTask=function(parentTask,ctask)
{if(!ctask.PredecessorTask)
{if(parentTask.EST>ctask.EST){ctask.EST=new Date(parentTask.EST);}
if(!this.checkPosParentTask(parentTask,ctask)){ctask.Duration=parentTask.Duration;}}else
{this.correctPosPredecessorTask(ctask.PredecessorTask,ctask);}};GanttChart.prototype.checkPosParentTaskInTree=function(parentTask)
{var isError=false;for(var t=0;t<parentTask.ChildTasks.length;t++)
{if(!this.checkPosParentTask(parentTask,parentTask.ChildTasks[t]))
{if(!this.correctError){this.Error.throwError("DATA_ERROR",28,[parentTask.Id,parentTask.ChildTasks[t].Id]);return true;}else{this.correctPosParentTask(parentTask,parentTask.ChildTasks[t]);}}
if(parentTask.EST>parentTask.ChildTasks[t].EST)
{if(!this.correctError){this.Error.throwError("DATA_ERROR",33,[parentTask.Id,parentTask.ChildTasks[t].Id]);return true;}else{this.correctPosParentTask(parentTask,parentTask.ChildTasks[t]);}}
if(parentTask.ChildTasks[t].ChildTasks.length>0)
{isError=this.checkPosParentTaskInTree(parentTask.ChildTasks[t]);}}
return isError;};GanttChart.prototype.setPredTask=function(project)
{var isError=false;for(var k=0;k<project.ParentTasks.length;k++){if(!this.isEmpty(project.ParentTasks[k].PredecessorTaskId))
{project.ParentTasks[k].PredecessorTask=project.getTaskById(project.ParentTasks[k].PredecessorTaskId);if(!project.ParentTasks[k].PredecessorTask){if(!this.correctError){this.Error.throwError("DATA_ERROR",27,[project.ParentTasks[k].PredecessorTaskId]);return true;}}
project.ParentTasks[k].PredecessorTask.ChildPredTasks.push(project.ParentTasks[k]);}
if(project.ParentTasks[k].PredecessorTask)
{if(!this.checkPosPredecessorTask(project.ParentTasks[k].PredecessorTask,project.ParentTasks[k])){if(!this.correctError){this.Error.throwError("DATA_ERROR",26,[project.ParentTasks[k].PredecessorTask.Id,project.ParentTasks[k].Id]);return true;}else{this.correctPosPredecessorTask(project.ParentTasks[k].PredecessorTask,project.ParentTasks[k]);}}}
isError=this.setPredTaskInTree(project.ParentTasks[k]);if(isError)return isError;}
return isError;};GanttChart.prototype.setPredTaskInTree=function(parentTask)
{var isError=false;for(var t=0;t<parentTask.ChildTasks.length;t++)
{if(!this.isEmpty(parentTask.ChildTasks[t].PredecessorTaskId))
{parentTask.ChildTasks[t].PredecessorTask=parentTask.Project.getTaskById(parentTask.ChildTasks[t].PredecessorTaskId);if(!parentTask.ChildTasks[t].PredecessorTask)
{if(!this.correctError){this.Error.throwError("DATA_ERROR",27,[parentTask.ChildTasks[t].PredecessorTaskId]);return true;}}
if(!this.checkPosPredecessorTask(parentTask.ChildTasks[t].PredecessorTask,parentTask.ChildTasks[t]))
{if(!this.correctError){this.Error.throwError("DATA_ERROR",26,[parentTask.ChildTasks[t].PredecessorTask.Id,parentTask.ChildTasks[t].Id]);return true;}else{this.correctPosPredecessorTask(parentTask.ChildTasks[t].PredecessorTask,parentTask.ChildTasks[t]);}}
parentTask.ChildTasks[t].PredecessorTask.ChildPredTasks.push(parentTask.ChildTasks[t]);}
if(parentTask.ChildTasks[t].ChildTasks.length>0)
{isError=this.setPredTaskInTree(parentTask.ChildTasks[t]);}}
return isError;};GanttChart.prototype.checkPosParentTask=function(parentTask,task)
{var widthParent=this.getWidthOnDuration(parentTask.Duration);var posParent=this.getPosOnDate(parentTask.EST);var posChild=this.getPosOnDate(task.EST);var widthChild=this.getWidthOnDuration(task.Duration);return(widthParent+posParent)>=(posChild+widthChild);};GanttChart.prototype.insertProject=function(id,name,startDate)
{if(this._isError)
{this.clearData();this.clearItems();this.hidePanelErrors();this._isError=false;}
if(this.startDate>=startDate){this.Error.throwError("DATA_INSERT_ERROR",14,null);return false;}
if(this.getProjectById(id)){this.Error.throwError("DATA_INSERT_ERROR",23,[id]);return false;}
this.checkHeighPanelTasks();var project=new GanttProjectInfo(id,name,startDate);this.Project.push(project);var _project=new GanttProject(this,project);for(var i=0;i<this.arrProjects.length;i++){if(startDate<this.arrProjects[i].Project.StartDate){this.arrProjects.splice(i,0,_project);if(i>0){_project.previousProject=this.arrProjects[i-1];this.arrProjects[i-1].nextProject=_project;}
if(i+1<=this.arrProjects.length){_project.nextProject=this.arrProjects[i+1];this.arrProjects[i+1].previousProject=_project;_project.shiftNextProject(_project,23);}
_project.create();if(this.isShowDescProject){_project.hideDescrProject();}
return _project;}}
if(this.arrProjects.length>0){this.arrProjects[this.arrProjects.length-1].nextProject=_project;_project.previousProject=this.arrProjects[this.arrProjects.length-1];}
this.arrProjects.push(_project);_project.create();if(this.isShowDescProject){_project.hideDescrProject();}
return _project;};GanttChart.prototype._showContextMenu=function(event,obj)
{if(this.contextMenu.isDhtmlxMenuObject){var res=this.callEvent("onBeforeContextMenu",[this.contextMenu,obj]);if(res===false)return;var x,y;if(_isIE){var dEl0=window.document.documentElement,dEl1=window.document.body,corrector=new Array((dEl0.scrollLeft||dEl1.scrollLeft),(dEl0.scrollTop||dEl1.scrollTop));x=event.clientX+corrector[0];y=event.clientY+corrector[1];}else{x=event.pageX;y=event.pageY;}
this.contextMenu.showContextMenu(x-1,y-1);}else{var elem=event.srcElement||event.target;this.contextMenu.showContextMenu(elem.style.left,elem.style.top,obj);}};GanttChart.prototype.openTree=function(parentTask)
{var lastParentTask=this.getLastCloseParent(parentTask);if(parentTask.TaskInfo.Id!=lastParentTask.TaskInfo.Id){this.openNode(lastParentTask);this.openTree(parentTask);}else{this.openNode(lastParentTask);}};GanttChart.prototype.openNode=function(parentTask)
{if(!parentTask._isOpen)
{parentTask.cTaskNameItem[2].src=this.imgs+"minus.gif";parentTask._isOpen=true;parentTask.shiftCurrentTasks(parentTask,parentTask._heightHideTasks);parentTask.showChildTasks(parentTask,parentTask._isOpen);parentTask._heightHideTasks=0;}};GanttChart.prototype.getLastCloseParent=function(task)
{if(task.parentTask)
{if((!task.parentTask._isOpen)||(task.parentTask.cTaskNameItem[2].style.display=="none")){return this.getLastCloseParent(task.parentTask);}else{return task;}}else{return task;}};GanttTask.prototype.setPredecessor=function(predecessorTaskId)
{if(predecessorTaskId=="")this.clearPredTask();else
{var task=this.TaskInfo;if(task.Id==predecessorTaskId){this.Chart.Error.throwError("DATA_INSERT_ERROR",36);return false;}
var predTaskObj=this.Project.getTaskById(predecessorTaskId);if(!predTaskObj){this.Chart.Error.throwError("DATA_INSERT_ERROR",27,[predecessorTaskId]);return false;}
var predTask=predTaskObj.TaskInfo;var a1=predTask.ParentTask==null,a2=task.ParentTask==null;if(a1&&!a2||!a1&&a2||!a1&&!a2&&(predTask.ParentTask.Id!=task.ParentTask.Id)){this.Chart.Error.throwError("DATA_INSERT_ERROR",32,[predTask.Id,task.Id]);return false;}
this.clearPredTask();if(!this.Chart.checkPosPredecessorTask(predTask,task)){this.Chart.correctPosPredecessorTask(predTask,task,this);}
task.PredecessorTaskId=predecessorTaskId;task.PredecessorTask=predTask;this.predTask=predTaskObj;predTaskObj.childPredTask.push(this);this.cTaskItem[1]=this.createConnectingLinesDS();}
return true;};GanttTask.prototype.clearPredTask=function(){if(this.predTask){var ch=this.predTask.childPredTask;for(var i=0;i<ch.length;i++){if(ch[i]==this){ch.splice(i,1);break;}}
for(var i=0;i<this.cTaskItem[1].length;i++){this.cTaskItem[1][i].parentNode.removeChild(this.cTaskItem[1][i]);}
this.cTaskItem[1]=[];this.TaskInfo.PredecessorTaskId=null;this.TaskInfo.PredecessorTask=null;this.predTask=null;}};GanttTask.prototype.setEST=function(est,shiftChild)
{this.moveChild=shiftChild;this.getMoveInfo();var pos=this.Chart.getPosOnDate(est);if((parseInt(this.cTaskItem[0].firstChild.firstChild.width)+pos>this.maxPosXMove)&&(this.maxPosXMove!=-1))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",12,[this.TaskInfo.Id]);this.maxPosXMove=-1;this.minPosXMove=-1;return false;}
if(pos<this.minPosXMove)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",11,[this.TaskInfo.Id]);this.maxPosXMove=-1;this.minPosXMove=-1;return false;}
this.cTaskItem[0].style.left=pos;var width=pos-this.posX;this.moveCurrentTaskItem(width,shiftChild);this.Project.shiftProjectItem();if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();this.addDayInPanelTime();this.posX=0;this.maxPosXMove=-1;this.minPosXMove=-1;return true;};GanttTask.prototype.setDuration=function(duration)
{this.getResizeInfo();var width=this.Chart.getWidthOnDuration(duration);if((width>this.maxWidthResize)&&(this.maxWidthResize!=-1))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",10,[this.TaskInfo.Id]);return false;}else if(width<this.minWidthResize)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",9,[this.TaskInfo.Id]);return false;}else{this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(width);this.endResizeItem();if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();return true;}};GanttTask.prototype.setPercentCompleted=function(percentCompleted)
{percentCompleted=parseInt(percentCompleted);if(isNaN(percentCompleted))
{this.Chart.Error.throwError("DATA_INSERT_ERROR",6,null);return false;}
if(percentCompleted>100)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",7,null);return false;}
if(percentCompleted<0)
{this.Chart.Error.throwError("DATA_INSERT_ERROR",8,null);return false;}
if((percentCompleted!=0)&&(percentCompleted!=100))
{if((this.TaskInfo.PercentCompleted!=0)&&(this.TaskInfo.PercentCompleted!=100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=percentCompleted+"%";this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1].width=100-percentCompleted+"%";}else if((this.TaskInfo.PercentCompleted==0)||(this.TaskInfo.PercentCompleted==100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0]);var cellTblTask=document.createElement("td");this.cTaskItem[0].childNodes[0].firstChild.rows[0].appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=percentCompleted+"%";var imgPrF=document.createElement("img");imgPrF.style.width=(percentCompleted*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPrF.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPrF);imgPrF.src=this.Chart.imgs+"progress_filled.png";cellTblTask=document.createElement("td");this.cTaskItem[0].childNodes[0].firstChild.rows[0].appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=(100-percentCompleted)+"%";imgPrF=document.createElement("img");imgPrF.style.width=((100-percentCompleted)*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPrF.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPrF);imgPrF.src=this.Chart.imgs+"progress_bg.png";}}else if(percentCompleted==0)
{if((this.TaskInfo.PercentCompleted!=0)&&(this.TaskInfo.PercentCompleted!=100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0]);this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=100+"%";}else
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_bg.png";}}else if(percentCompleted==100)
{if((this.TaskInfo.PercentCompleted!=0)&&(this.TaskInfo.PercentCompleted!=100))
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1].parentNode.removeChild(this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[1]);this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].width=100+"%";}else
{this.cTaskItem[0].childNodes[0].firstChild.rows[0].cells[0].firstChild.src=this.Chart.imgs+"progress_filled.png";}}
this.TaskInfo.PercentCompleted=percentCompleted;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(this.taskItemWidth);this.endResizeItem();if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();return true;};GanttTask.prototype.setName=function(name)
{if((name!="")&&(name!=null)){this.TaskInfo.Name=name;if(this.Chart._showTreePanel)
{this.cTaskNameItem[0].innerHTML=name;this.cTaskNameItem[0].title=name;this.checkWidthTaskNameItem();}
if(this.Chart.isShowDescTask)this.descrTask.innerHTML=this.getDescStr();this.addDayInPanelTime();}};GanttChart.prototype.getProjectInfoById=function(id)
{for(var i=0;i<this.Project.length;i++)
{if(this.Project[i].Id==id)
{return this.Project[i];}}
return null;};GanttChart.prototype.loadData=function(content,isFile,isLocal)
{this.clearData();if((isFile==null)||(isFile=='undefined'))
{isFile=false;}
if((isLocal==null)||(isLocal=='undefined'))
{isLocal=false;}
this.loadXML(content,isFile,isLocal);this.Project.sort(this.sort_byStartDate);this.startDate=this.getStartDate();this.clearItems();for(var i=0;i<this.Project.length;i++)
{for(var k=0;k<this.Project[i].ParentTasks.length;k++)
{if((this.Project[i].ParentTasks[k].EST!=null)&&(this.Project[i].ParentTasks[k].EST!='')){this.setESTChild(this.Project[i].ParentTasks[k]);}
else{this.Error.throwError("DATA_ERROR",25,[this.Project[i].ParentTasks[k].Id]);return;}
if(this.setPredTask(this.Project[i]))return;}
for(var k=0;k<this.Project[i].ParentTasks.length;k++){if(this.Project[i].ParentTasks[k].EST<this.Project[i].StartDate){this.Error.throwError("DATA_ERROR",24,[this.Project[i].ParentTasks[k].Id,this.Project[i].Id]);return;}
if(this.checkPosParentTaskInTree(this.Project[i].ParentTasks[k]))return;}
this.sortTasksByEST(this.Project[i]);}
for(var i=0;i<this.Project.length;i++)
{var project=new GanttProject(this,this.Project[i]);if(this.arrProjects.length>0)
{var previousProject=this.arrProjects[this.arrProjects.length-1];project.previousProject=previousProject;previousProject.nextProject=project;}
project.create();this.checkHeighPanelTasks();this.arrProjects.push(project);this.createTasks(project);}};GanttChart.prototype.clearAll=function()
{this._oDataHeight=0;this.startDate=null;this._isError=false;this.hidePanelErrors();this.clearData();this.clearItems();};GanttChart.prototype.clearData=function()
{this._oDataHeight=0;this.startDate=null;this._isError=false;this.hidePanelErrors();this.Project=[];this.arrProjects=[];};GanttChart.prototype.clearItems=function()
{this.oData.removeChild(this.oData.firstChild);this.oData.appendChild(this.createPanelTasks());this.oData.firstChild.appendChild(this.divInfo);this.oData.firstChild.appendChild(this.panelErrors);if(this._showTreePanel)
{this.panelNames.removeChild(this.panelNames.firstChild);this.panelNames.appendChild(this.createPanelNamesTasks());}
this.panelTime.removeChild(this.panelTime.firstChild);this.panelTime.appendChild(this.createPanelTime());};GanttChart.prototype.loadXML=function(content,isFile,isLocal)
{if(isFile&&(content==null||content==""))
{this.Error.throwError("DATA_SEND_ERROR",4,null);return;}
this.xmlLoader=new dtmlXMLLoaderObject(null,this,false);try
{if(!isFile)
try{this.xmlLoader.loadXMLString(content);}catch(e){this.Error.throwError("DATA_LOAD_ERROR",37,[content]);}else
if(!isLocal)
{this.xmlLoader.loadXML(this.loadPath+"?path="+content+"&rnd="+(new Date()-0),false);}else
{this.xmlLoader.loadXML(content+"?rnd="+(new Date()-0),false);}
this.doLoadDetails(isLocal);}catch(e)
{this.Error.throwError("DATA_LOAD_ERROR",5,[content]);}};GanttChart.prototype.doLoadDetails=function(isLocal)
{switch(this.xmlLoader.xmlDoc.status){case 0:if(!isLocal)
{this.Error.throwError("DATA_LOAD_ERROR",1,null);return;}
break;case 404:if(!isLocal)
{this.Error.throwError("DATA_LOAD_ERROR",5,[this.loadPath]);}else
{this.Error.throwError("DATA_LOAD_ERROR",5,[this.xmlLoader.filePath])}
return;break;case 500:this.Error.throwError("DATA_LOAD_ERROR",2,null);return;break;default:break;}
var name=null;var id=null;var est=null;var duration=null;var percentCompleted=null;var predecessorTaskId=null;var projectArr=this.xmlLoader.doXPath("//project");for(var j=0;j<projectArr.length;j++)
{var startDateTemp=projectArr[j].getAttribute("startdate");var startDate=startDateTemp.split(",");var project=new GanttProjectInfo(projectArr[j].getAttribute("id"),projectArr[j].getAttribute("name"),new Date(startDate[0],(parseInt(startDate[1])-1),startDate[2]));var taskArr=this.xmlLoader.doXPath("./task",projectArr[j]);for(var i=0;i<taskArr.length;i++){id=taskArr[i].getAttribute("id");name=(this.xmlLoader.doXPath("./name",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./name",taskArr[i])[0].firstChild.nodeValue;var estTemp=(this.xmlLoader.doXPath("./est",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./est",taskArr[i])[0].firstChild.nodeValue;est=estTemp.split(",");duration=(this.xmlLoader.doXPath("./duration",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./duration",taskArr[i])[0].firstChild.nodeValue;percentCompleted=(this.xmlLoader.doXPath("./percentcompleted",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./percentcompleted",taskArr[i])[0].firstChild.nodeValue;predecessorTaskId=(this.xmlLoader.doXPath("./predecessortasks",taskArr[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./predecessortasks",taskArr[i])[0].firstChild.nodeValue;var task=new GanttTaskInfo(id,name,new Date(est[0],(parseInt(est[1])-1),est[2]),duration,percentCompleted,predecessorTaskId);var childTasksNode=this.xmlLoader.doXPath("./childtasks",taskArr[i]);var childTasksArr=this.xmlLoader.doXPath("./task",childTasksNode[0]);if(childTasksArr.length!=0)this.readChildTasksXML(task,childTasksArr);project.addTask(task);}
this.addProject(project);}};GanttChart.prototype.readChildTasksXML=function(parentTask,childTasksArrXML)
{var name=null;var id=null;var est=null;var duration=null;var percentCompleted=null;var predecessorTaskId=null;for(var i=0;i<childTasksArrXML.length;i++)
{id=childTasksArrXML[i].getAttribute("id");name=(this.xmlLoader.doXPath("./name",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./name",childTasksArrXML[i])[0].firstChild.nodeValue;var estTemp=(this.xmlLoader.doXPath("./est",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./est",childTasksArrXML[i])[0].firstChild.nodeValue;est=estTemp.split(",");duration=(this.xmlLoader.doXPath("./duration",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./duration",childTasksArrXML[i])[0].firstChild.nodeValue;percentCompleted=(this.xmlLoader.doXPath("./percentcompleted",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./percentcompleted",childTasksArrXML[i])[0].firstChild.nodeValue;predecessorTaskId=(this.xmlLoader.doXPath("./predecessortasks",childTasksArrXML[i])[0].firstChild==null)?"":this.xmlLoader.doXPath("./predecessortasks",childTasksArrXML[i])[0].firstChild.nodeValue;var task=new GanttTaskInfo(id,name,new Date(est[0],(parseInt(est[1])-1),est[2]),duration,percentCompleted,predecessorTaskId);task.ParentTask=parentTask;parentTask.addChildTask(task);var childTasksNode=this.xmlLoader.doXPath("./childtasks",childTasksArrXML[i]);var childTasksArr=this.xmlLoader.doXPath("./task",childTasksNode[0]);if(childTasksArr.length!=0)
{this.readChildTasksXML(task,childTasksArr);}}};GanttChart.prototype.getXML=function()
{var strXML="<projects>";for(var i=0;i<this.Project.length;i++)
{strXML+="<project id ='"+this.Project[i].Id+"' name= '"+this.Project[i].Name+"' startdate = '"+this.Project[i].StartDate.getFullYear()+","+(this.Project[i].StartDate.getMonth()+1)+","+this.Project[i].StartDate.getDate()+"'>";for(var j=0;j<this.Project[i].ParentTasks.length;j++)
{strXML+="<task id ='"+this.Project[i].ParentTasks[j].Id+"'>";strXML+="<name>"+this.Project[i].ParentTasks[j].Name+"</name>";strXML+="<est>"+this.Project[i].ParentTasks[j].EST.getFullYear()+","+(this.Project[i].ParentTasks[j].EST.getMonth()+1)+","+this.Project[i].ParentTasks[j].EST.getDate()+"</est>";strXML+="<duration>"+this.Project[i].ParentTasks[j].Duration+"</duration>";strXML+="<percentcompleted>"+this.Project[i].ParentTasks[j].PercentCompleted+"</percentcompleted>";strXML+="<predecessortasks>"+this.Project[i].ParentTasks[j].PredecessorTaskId+"</predecessortasks>";strXML+="<childtasks>";strXML+=this.createChildTasksXML(this.Project[i].ParentTasks[j].ChildTasks);strXML+="</childtasks>";strXML+="</task>";}
strXML+="</project>";}
strXML+="</projects>";return strXML;};GanttChart.prototype.createChildTasksXML=function(childTasks)
{var strXML="";for(var n=0;n<childTasks.length;n++)
{strXML+="<task id='"+childTasks[n].Id+"'>";strXML+="<name>"+childTasks[n].Name+"</name>";strXML+="<est>"+childTasks[n].EST.getFullYear()+","+(childTasks[n].EST.getMonth()+1)+","+childTasks[n].EST.getDate()+"</est>";strXML+="<duration>"+childTasks[n].Duration+"</duration>";strXML+="<percentcompleted>"+childTasks[n].PercentCompleted+"</percentcompleted>";strXML+="<predecessortasks>"+childTasks[n].PredecessorTaskId+"</predecessortasks>";if(childTasks[n].ChildTasks)
{strXML+="<childtasks>";strXML+=this.createChildTasksXML(childTasks[n].ChildTasks);strXML+="</childtasks>";}
strXML+="</task>";}
return strXML;};GanttChart.prototype.sort_byEST=function(a,b)
{if(a.EST<b.EST)return-1;if(a.EST>b.EST)return 1;return 0;};GanttChart.prototype.sort_byStartDate=function(a,b)
{if(a["StartDate"]<b["StartDate"])return-1;if(a["StartDate"]>b["StartDate"])return 1;return 0;};GanttChart.prototype.setESTChild=function(parentTask)
{for(var t=0;t<parentTask.ChildTasks.length;t++)
{if((parentTask.ChildTasks[t].EST==null)||(parentTask.ChildTasks[t].EST==""))
{parentTask.ChildTasks[t].EST=parentTask.EST;}
if(parentTask.ChildTasks[t].ChildTasks.length!=0)this.setESTChild(parentTask.ChildTasks[t]);}};GanttChart.prototype.createPanelTasks=function()
{var divTasks=document.createElement("div");divTasks.className="taskPanel";divTasks.style.cssText="position:relative;";divTasks.style.height=this.contentHeight-63+"px";var w=this.startDate?(this.startDate.getDay()-1):((new Date(0)).getDay()-1);if(w==-1)w=6;divTasks.style.background="url("+this.imgs+"bg_week.png) -"+(w*24)+"px 0px";this.panelTasks=divTasks;return divTasks;};GanttChart.prototype.createPanelNamesTasks=function()
{var divListNames=document.createElement("div");divListNames.innerHTML="&nbsp;";divListNames.style.cssText="position:relative;background:url("+this.imgs+"bg.png)";divListNames.style.height=this.contentHeight-63+"px";divListNames.style.width=this.maxWidthPanelNames+"px";return divListNames;};GanttChart.prototype.createPopUpInfo=function()
{var divTaskInfo=document.createElement("div");divTaskInfo.style.cssText='display: none;';var tblTaskInfo=document.createElement("table");tblTaskInfo.style.cssText="position:absolute;top:0px;left:0px";tblTaskInfo.className="poPupInfo";divTaskInfo.appendChild(tblTaskInfo);var rowTaskInfo=tblTaskInfo.insertRow(tblTaskInfo.rows.length);var cellTaskInfo=document.createElement("td");rowTaskInfo.appendChild(cellTaskInfo);this.divInfo=divTaskInfo;return divTaskInfo;};GanttChart.prototype.createPopUpTimeInfo=function()
{var divTimeInfo=document.createElement("div");divTimeInfo.style.display="none";var tblTimeInfo=document.createElement("table");tblTimeInfo.className="poPupTime";divTimeInfo.appendChild(tblTimeInfo);var rowTimeInfo=tblTimeInfo.insertRow(tblTimeInfo.rows.length);var cellTimeInfo=document.createElement("td");cellTimeInfo.align="center";rowTimeInfo.appendChild(cellTimeInfo);return divTimeInfo;};GanttChart.prototype.createPanelTime=function()
{var panelTime=document.createElement("div");panelTime.style.position="relative";var tblTime=document.createElement("table");panelTime.appendChild(tblTime);tblTime.cellPadding="0px";tblTime.border="0px";tblTime.cellSpacing="0px";tblTime.bgColor="#FFFFFF";tblTime.style.marginTop="0px";var monthRow=tblTime.insertRow(tblTime.rows.length);var newRow=tblTime.insertRow(tblTime.rows.length);for(var i=0;i<this.countDays;i++)
{this.addPointInTimePanel(newRow,panelTime);this.addDayInPanelTime(newRow);}
return panelTime;};GanttChart.prototype.addPointInTimePanel=function(row,panelTime)
{var leftLine=document.createElement("div");leftLine.style.cssText="position:absolute;left:"+(row.cells.length*this.dayInPixels)+"px;top:20px;height:20px;width:1px;font-size:1px;margin-left:0px;margin-right:0px;margin-top:0px;margin-bottom:0px;background:#f1f3f1;";panelTime.appendChild(leftLine);};GanttChart.prototype._calculateMonthColSpan=function(date,maxLen){var m1=date.getMonth();for(var i=1;i<=maxLen;i++){date.setDate(date.getDate()+1);var m2=date.getMonth();if(m2!=m1)return i;}
return maxLen;};GanttChart.prototype.getMonthScaleLabel=function(date){return(this._useShortMonthNames?this.shortMonthNames:this.monthNames)[date.getMonth()]+" '"+(""+date.getFullYear()).substring(2);};GanttChart.prototype.useShortMonthNames=function(flag){this._useShortMonthNames=flag;};GanttChart.prototype.setShortMonthNames=function(names){this.shortMonthNames=names;};GanttChart.prototype.setMonthNames=function(names){this.monthNames=names;};GanttChart.prototype.addDayInPanelTime=function(row)
{var self=this,idx=row.cells.length,date=new Date(this.startDate);var newCell=row.insertCell(idx);newCell.style.height="20px";newCell.style.width=this.dayInPixels+"px";newCell.className="dayNumber";date.setDate(date.getDate()+parseInt(idx));var day=date.getDate()
newCell.innerHTML=day;newCell.setAttribute("idx",idx);var monthRow=row.parentNode.parentNode.rows[0];if(idx==0||day==1){var newCell2=monthRow.insertCell(monthRow.cells.length);newCell2.className="monthName";newCell2.style.height="20px";if(monthRow.cells.length%2==0)newCell2.style.backgroundColor="#f7f8f7";newCell2.colSpan=this._calculateMonthColSpan(new Date(date),Math.max(1,this.countDays-idx));newCell2.innerHTML=this.getMonthScaleLabel(date);}else{var n=monthRow.cells.length,cs=0;for(var i=0;i<n;i++){cs+=monthRow.cells[i].colSpan;}
if(idx>=cs)monthRow.cells[n-1].colSpan+=1;}
var w=date.getDay();if(w==0||w==6)newCell.style.backgroundColor="#f7f8f7";};GanttChart.prototype.incHeightPanelTasks=function(height)
{var containerTasks=this.oData.firstChild;containerTasks.style.height=parseInt(containerTasks.style.height)+height+"px";};GanttChart.prototype.incHeightPanelNames=function(height)
{var containerNames=this.panelNames.firstChild;containerNames.style.height=parseInt(containerNames.style.height)+height+"px";};GanttChart.prototype.checkHeighPanelTasks=function()
{this._oDataHeight+=11+this.heightTaskItem;if((parseInt(this.oData.firstChild.style.height)<=this._oDataHeight)){this.incHeightPanelTasks(this.heightTaskItem+11);if(this._showTreePanel)this.incHeightPanelNames(this.heightTaskItem+11);}};GanttChart.prototype.sortTasksByEST=function(project)
{project.ParentTasks.sort(this.sort_byEST);for(var i=0;i<project.ParentTasks.length;i++)
{project.ParentTasks[i]=this.sortChildTasks(project.ParentTasks[i]);}};GanttChart.prototype.sortChildTasks=function(parenttask)
{parenttask.ChildTasks.sort(this.sort_byEST);for(var i=0;i<parenttask.ChildTasks.length;i++)
{if(parenttask.ChildTasks[i].ChildTasks.length>0)this.sortChildTasks(parenttask.ChildTasks[i]);}
return parenttask;};GanttChart.prototype.errorDataHandler=function(type,descr,params)
{if(!this._isError)
{this.clearData();this.showPanelErrors();this._isError=true;}
this.addErrorInPanelErrors(type,descr);};GanttChart.prototype.createPanelErrors=function()
{var tbl=document.createElement("table");tbl.width="100%";tbl.style.display="none";tbl.className="panelErrors";this.panelErrors=tbl;return tbl;};GanttChart.prototype.showPanelErrors=function()
{this.panelErrors.style.display="inline";};GanttChart.prototype.hidePanelErrors=function()
{for(var i=0;i<this.panelErrors.rows.length;i++){this.panelErrors.rows[i].parentNode.removeChild(this.panelErrors.rows[i]);}
this.panelErrors.style.display="none";};GanttChart.prototype.addErrorInPanelErrors=function(type,descr)
{var row=this.panelErrors.insertRow(this.panelErrors.rows.length);var cell=document.createElement("td");cell.style.height="20px";cell.style.width="100px";cell.innerHTML=type;row.appendChild(cell);cell=document.createElement("td");row.appendChild(cell);cell.innerHTML=descr;};GanttChart.prototype.errorSendDataHandler=function(type,descr,params)
{alert(descr);};GanttChart.prototype.errorLoadDataHandler=function(type,descr,params)
{alert(descr);};GanttChart.prototype.errorAPIHandler=function(type,descr,params)
{alert(descr);};GanttChart.prototype.saveData=function(fileName)
{try{if(!this.dhtmlXMLSenderObject.isProcessed)
{this.dhtmlXMLSenderObject.sendData(fileName,this.savePath,this.getXML());}}catch(e){this.Error.throwError("DATA_SEND_ERROR",e,null);}};GanttChart.prototype.create=function(divId)
{var self=this;var content=document.getElementById(divId);this.content=content;this.getBrowserType();if(this._isIE){document.body.attachEvent('onselectstart',function(){window.event.returnValue=false;});document.body.attachEvent('onkeydown',function(){if(event.keyCode==65&&event.ctrlKey)window.event.returnValue=false;});}else{content.addEventListener('mousedown',function(e){e.preventDefault();},true);document.addEventListener('keydown',function(e){if(e.keyCode==65&&e.ctrlKey)e.preventDefault();},true);}
this.Error.catchError("DATA_ERROR",function(type,descr,params){self.errorDataHandler(type,descr,params)});this.Error.catchError("DATA_SEND_ERROR",function(type,descr,params){self.errorSendDataHandler(type,descr,params)});this.Error.catchError("DATA_INSERT_ERROR",function(type,descr,params){self.errorAPIHandler(type,descr,params)});this.Error.catchError("DATA_LOAD_ERROR",function(type,descr,params){self.errorLoadDataHandler(type,descr,params)});var tableControl=document.createElement("table");tableControl.cellPadding="0";tableControl.cellSpacing="0";tableControl.style.cssText="width: 100%; position: relative;";var newRowTblControl=tableControl.insertRow(tableControl.rows.length);var newCellTblControl;this.contentHeight=content.offsetHeight;this.contentWidth=content.offsetWidth;content.appendChild(tableControl);this.countDays=this.getCountDays();this.Project.sort(this.sort_byStartDate);this.startDate=this.getStartDate();this.panelTime=document.createElement("div");this.panelTime.appendChild(this.createPanelTime());this.panelTime.style.cssText="position:relative;overflow:hidden;height:40px;top:0px;left:1px";this.oData=document.createElement("div");this.oData.appendChild(this.createPanelTasks());this.oData.style.cssText="position:relative;overflow:scroll;height:"+(this.contentHeight-40)+"px;border-left:#f1f3f1 1px solid";this.oData.firstChild.appendChild(this.createPanelErrors());if(this._showTreePanel)
{this.panelNames=document.createElement("div");newCellTblControl=document.createElement("td");newCellTblControl.vAlign="top";this.panelNames.appendChild(this.createPanelNamesTasks());this.panelNames.style.cssText="position:relative;top:40px;overflow:hidden;border-left:#f1f3f1 1px solid;border-bottom:#f1f3f1 1px solid";newCellTblControl.appendChild(this.panelNames);newRowTblControl.appendChild(newCellTblControl);}
newCellTblControl=document.createElement("td");var divCell=document.createElement("div");divCell.style.cssText="position: relative;";divCell.appendChild(this.panelTime);divCell.appendChild(this.oData);newCellTblControl.appendChild(divCell);newRowTblControl.appendChild(newCellTblControl);if(this._showTreePanel){this.panelNames.style.height=(this.contentHeight-56)+"px";this.panelNames.style.width=this.maxWidthPanelNames+"px";this.oData.style.width=(this.contentWidth-this.maxWidthPanelNames)+"px";this.panelTasks.style.width=this.dayInPixels*this.countDays+"px";this.panelTime.style.width=(this.contentWidth-this.maxWidthPanelNames-0*18)+"px";this.panelTime.firstChild.style.width=this.dayInPixels*this.countDays+"px";if(this.isShowConMenu&&this.contextMenu==null)this.contextMenu=new contextMenu(this);}else{this.oData.style.width=this.contentWidth+"px";this.panelTime.style.width=(this.contentWidth-16)+"px";}
if(this._isOpera){this.oData.onmousewheel=function(){return false;}}
this.oData.onscroll=function(){self.panelTime.scrollLeft=this.scrollLeft;if(self.panelNames){self.panelNames.scrollTop=this.scrollTop;if(self.isShowConMenu)self.contextMenu.hideContextMenu();}};this.divTimeInfo=this.createPopUpTimeInfo();divCell.appendChild(this.divTimeInfo);this.oData.firstChild.appendChild(this.createPopUpInfo());for(var i=0;i<this.Project.length;i++)
{for(var k=0;k<this.Project[i].ParentTasks.length;k++)
{if(this.isEmpty(this.Project[i].ParentTasks[k].EST)){this.Project[i].ParentTasks[k].EST=this.Project[i].StartDate;}
this.setESTChild(this.Project[i].ParentTasks[k]);if(this.setPredTask(this.Project[i]))return;}
for(var k=0;k<this.Project[i].ParentTasks.length;k++){if(this.Project[i].ParentTasks[k].EST<this.Project[i].StartDate){if(!this.correctError){this.Error.throwError("DATA_ERROR",24,[this.Project[i].ParentTasks[k].Id,this.Project[i].Id]);return;}else{this.Project[i].ParentTasks[k].EST=this.Project[i].StartDate;}}
if(this.checkPosParentTaskInTree(this.Project[i].ParentTasks[k]))return;}
this.sortTasksByEST(this.Project[i]);}
for(var i=0;i<this.Project.length;i++)
{var project=new GanttProject(this,this.Project[i]);if(this.arrProjects.length>0)
{var previousProject=this.arrProjects[this.arrProjects.length-1];project.previousProject=previousProject;previousProject.nextProject=project;}
project.create();this.checkHeighPanelTasks();this.arrProjects.push(project);this.createTasks(project);}
return this;};GanttChart.prototype.isEmpty=function(value)
{return(value==null||value=='');};GanttChart.prototype.getPrintableHTML=function()
{var w=parseInt(this.oData.firstChild.style.width)-parseInt(this.oData.style.width);var h=parseInt(this.panelTasks.style.height)-parseInt(this.panelTasks.parentNode.style.height);this.oData.setAttribute("id","ganttPrint02");this.panelNames.setAttribute("id","ganttPrint03");var res='<html><head><link type="text/css" rel="stylesheet" href="'+this.stylePath+'"><scr'+'ipt>onload=function(){var w='+w+',h='+h+',c1=document.getElementById("ganttPrint01"),c2=document.getElementById("ganttPrint02"),c3=document.getElementById("ganttPrint03");'+'c2.style.width=parseInt(c2.style.width)+w+"px";c2.previousSibling.style.width=c2.style.width;c1.style.width=parseInt(c1.style.width)+w+"px";c2.style.height=parseInt(c2.style.height)+h+"px";'+'c2.style.overflow="hidden";c3.style.height=c3.firstChild.style.height;c1.style.height=parseInt(c1.style.height)+h+"px";}</scr'+'ipt></head>'+'<body><div id="ganttPrint01" style="'+this.content.style.cssText+'">'+this.content.innerHTML+'</div></body></html>';this.oData.setAttribute("id",null);this.panelNames.setAttribute("id",null);return res;};GanttChart.prototype.printToWindow=function(message)
{var o=window.open();o.document.write(this.getPrintableHTML());o.document.close();if(message!==null){o.alert(message?message:"Use browser's menu \"File->Print preview\" to setup page layout.");}};GanttChart.prototype.getStartDate=function()
{for(var i=0;i<this.Project.length;i++){if(this.startDate){if(this.Project[i].StartDate<this.startDate){this.startDate=new Date(this.Project[i].StartDate);}}
else{this.startDate=new Date(this.Project[i].StartDate);}}
this.initialPos=24*this.hourInPixels;if(this.startDate){return new Date(this.startDate.setHours(this.startDate.getHours()-24));}
else{return new Date();}};GanttChart.prototype.getCountDays=function()
{if(this._showTreePanel){return parseInt((this.contentWidth-this.maxWidthPanelNames)/(this.hourInPixels*24));}else{return parseInt((this.contentWidth)/(this.hourInPixels*24));}};GanttChart.prototype.createTasks=function(project)
{for(var j=0;j<project.Project.ParentTasks.length;j++)
{if(j>0)
{project.Project.ParentTasks[j-1].nextParentTask=project.Project.ParentTasks[j];project.Project.ParentTasks[j].previousParentTask=project.Project.ParentTasks[j-1];}
var task=new GanttTask(project.Project.ParentTasks[j],project,this);project.arrTasks.push(task);task.create();this.checkHeighPanelTasks();if(project.Project.ParentTasks[j].ChildTasks.length>0)
{this.createChildItemControls(project.Project.ParentTasks[j].ChildTasks,project);}}};GanttChart.prototype.createChildItemControls=function(arrChildTasks,project)
{for(var i=0;i<arrChildTasks.length;i++){if(i>0)
{arrChildTasks[i].previousChildTask=arrChildTasks[i-1];arrChildTasks[i-1].nextChildTask=arrChildTasks[i];}
var task=new GanttTask(arrChildTasks[i],project,this);task.create();this.checkHeighPanelTasks();if(arrChildTasks[i].ChildTasks.length>0)
{this.createChildItemControls(arrChildTasks[i].ChildTasks,project);}}};GanttTask.prototype.getPopUpInfo=function(object,event)
{var posY=object.offsetTop+this.Chart.heightTaskItem+6;var posX=object.offsetLeft+((event.layerX==null)?event.offsetX:event.layerX);var tblInfo=this.Chart.divInfo.lastChild;tblInfo.rows[0].cells[0].innerHTML="<div style='font-family: Arial, Helvetica, Sans-serif; font-size: 12px; font-weight: bold; color: #688060; margin: 0 0 4px 0;'>"+this.TaskInfo.Name+"</div>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>EST:&nbsp;</span><span class='ut'>"+this.TaskInfo.EST.getDate()+"."+(this.TaskInfo.EST.getMonth()+1)+"."+this.TaskInfo.EST.getFullYear()+"</span><br/>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut'>"+this.TaskInfo.Duration+" hours </span><br/>";if(this.predTask)
{tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Predecessor Task:&nbsp;</span>";tblInfo.rows[0].cells[0].innerHTML+="<span class='lt'>*"+this.TaskInfo.PredecessorTask.Name+"</span>";}
if(this.TaskInfo.ChildTasks.length!=0){tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Child Tasks:&nbsp;</span>";for(var i=0;i<this.TaskInfo.ChildTasks.length;i++)
{tblInfo.rows[0].cells[0].innerHTML+=(i==this.TaskInfo.ChildTasks.length-1)?("<span class='lt'>*"+this.TaskInfo.ChildTasks[i].Name+"</span>"):("<span class='lt'>*"+this.TaskInfo.ChildTasks[i].Name+"</span>");}}
if(this.TaskInfo.ParentTask){tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Parent Task:&nbsp;</span>";tblInfo.rows[0].cells[0].innerHTML+="<span class='lt'>*"+this.TaskInfo.ParentTask.Name+"</span>";}
this.Chart.divInfo.style.cssText="z-index:2;position: absolute;display: inline;";if(posY+this.Chart.divInfo.lastChild.offsetHeight+10>this.Chart.oData.offsetHeight+this.Chart.oData.scrollTop){this.Chart.divInfo.style.top=(posY-this.Chart.divInfo.lastChild.offsetHeight-10-this.Chart.heightTaskItem)+"px";}
else{this.Chart.divInfo.style.top=posY+"px";}
if(this.Chart.divInfo.lastChild.offsetWidth+posX+10>this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft){this.Chart.divInfo.style.left=posX-(this.Chart.divInfo.lastChild.offsetWidth+posX+20-(this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft))+"px";}else{this.Chart.divInfo.style.left=posX+"px";}};GanttTask.prototype.closePopUpInfo=function()
{this.Chart.divInfo.style.display="none";};GanttTask.prototype.createConnectingLinesPN=function()
{var arrConnectingLinesNames=[];return arrConnectingLinesNames;};GanttTask.prototype.createConnectingLinesDS=function()
{var oData=this.Chart.oData.firstChild;var arrLines=[];var arrowImg=new Image();arrowImg.src=this.Chart.imgs+"arr.gif";var lineVerticalRight=document.createElement("div");var lineHorizontal=document.createElement("div");var posXPredecessorTask=parseInt(this.predTask.cTaskItem[0].style.left);var posYPredecessorTask=parseInt(this.predTask.cTaskItem[0].style.top);var posXChildTask=parseInt(this.cTaskItem[0].style.left);var posYChildTask=this.posY+2;var widthChildTask=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);var widthPredecessorTask=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);if(posYPredecessorTask<posYChildTask)
{lineVerticalRight.style.cssText="border-width: 0px 0px 0px 1px; border-style: solid; border-color: #4A8F43;margin: 0px; padding: 0px;z-index:0;font-size: 1px;position: absolute;"+"height:"+(posYChildTask-this.Chart.heightTaskItem/2-posYPredecessorTask-3)+"px;width:"+1+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYPredecessorTask+this.Chart.heightTaskItem)+"px;";lineHorizontal.style.cssText="height:1px;border-color: #4A8F43;border-style: solid;border-width: 1px 0px 0px 0px;margin: 0px; padding: 0px;z-index:0;position: absolute;"+"width:"+(15+(posXChildTask-(widthPredecessorTask+posXPredecessorTask)))+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYChildTask+2)+"px;";arrowImg.style.cssText="margin: 0px; padding: 0px;width:7px;height:14px;position: absolute;left:"+(posXChildTask-7)+"px;top:"+(posYChildTask-1)+"px;";}else{lineVerticalRight.style.cssText="border-width: 0px 0px 0px 1px; border-style: solid; border-color: #4A8F43;margin: 0px; padding: 0px;z-index:0;font-size: 1px;position: absolute;"+"height:"+(posYPredecessorTask+2-posYChildTask)+"px;width:"+1+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYChildTask+2)+"px;";lineHorizontal.style.cssText="height:1px;border-color: #4A8F43;border-style: solid;border-width: 1px 0px 0px 0px;margin: 0px; padding: 0px;z-index:0;position: absolute;"+"width:"+(15+(posXChildTask-(widthPredecessorTask+posXPredecessorTask)))+"px;left:"+(posXPredecessorTask+widthPredecessorTask-20)+"px;top:"+(posYChildTask+2)+"px;";arrowImg.style.cssText="margin: 0px; padding: 0px;width:7px;height:14px;position: absolute;left:"+(posXChildTask-7)+"px;top:"+(posYChildTask-1)+"px;";}
oData.appendChild(lineVerticalRight);oData.appendChild(lineHorizontal);oData.appendChild(arrowImg);arrLines.push(lineVerticalRight);arrLines.push(arrowImg);arrLines.push(lineHorizontal);return arrLines;};GanttTask.prototype.showChildTasks=function(task,isOpen)
{if(isOpen)
{for(var i=0;i<task.childTask.length;i++)
{if(task.childTask[i].cTaskItem[0].style.display=="none"){task.childTask[i].cTaskItem[0].style.display="inline";task.childTask[i].cTaskNameItem[0].style.display="inline";if(this.Chart.isShowDescTask){task.childTask[i].showDescTask();}
task.isHide=false;if(task.childTask[i].cTaskNameItem[2]){task.childTask[i].cTaskNameItem[2].style.display="inline";isOpen=task.childTask[i]._isOpen;}
for(var k=0;k<task.childTask[i].cTaskItem[1].length;k++){task.childTask[i].cTaskItem[1][k].style.display="inline";}
for(var k=0;k<task.childTask[i].cTaskNameItem[1].length;k++){task.childTask[i].cTaskNameItem[1][k].style.display="inline";}
this._heightHideTasks+=this.Chart.heightTaskItem+11;if(task.childTask[i].childTask.length>0){this.showChildTasks(task.childTask[i],isOpen);}}}}};GanttTask.prototype.hideChildTasks=function(task)
{for(var i=0;i<task.childTask.length;i++)
{if(task.childTask[i].cTaskItem[0].style.display!="none")
{task.childTask[i].cTaskItem[0].style.display="none";task.childTask[i].cTaskNameItem[0].style.display="none";if(this.Chart.isShowDescTask){task.childTask[i].hideDescTask();}
task.isHide=true;if(task.childTask[i].cTaskNameItem[2]){task.childTask[i].cTaskNameItem[2].style.display="none";}
for(var k=0;k<task.childTask[i].cTaskItem[1].length;k++){task.childTask[i].cTaskItem[1][k].style.display="none";}
for(var k=0;k<task.childTask[i].cTaskNameItem[1].length;k++){task.childTask[i].cTaskNameItem[1][k].style.display="none";}
this._heightHideTasks+=this.Chart.heightTaskItem+11;if(task.childTask[i].childTask.length>0){this.hideChildTasks(task.childTask[i]);}}}};GanttTask.prototype.shiftCurrentTasks=function(task,height)
{this.shiftNextTask(this,height);task.Project.shiftNextProject(task.Project,height);};GanttProject.prototype.shiftNextProject=function(project,height)
{if(project.nextProject){project.nextProject.shiftProject(height);this.shiftNextProject(project.nextProject,height);}};GanttProject.prototype.shiftProject=function(height)
{this.projectItem[0].style.top=parseInt(this.projectItem[0].style.top)+height+"px";if(this.Chart.isShowDescProject){this.descrProject.style.top=parseInt(this.descrProject.style.top)+height+"px";}
if(this.Chart._showTreePanel){this.projectNameItem.style.top=parseInt(this.projectNameItem.style.top)+height+"px";}
if(this.arrTasks.length>0)
this.shiftNextParentTask(this.arrTasks[0],height);};GanttProject.prototype.shiftTask=function(task,height)
{if(this.Chart._showTreePanel){task.cTaskNameItem[0].style.top=parseInt(task.cTaskNameItem[0].style.top)+height+"px";if(task.cTaskNameItem[2]){task.cTaskNameItem[2].style.top=parseInt(task.cTaskNameItem[2].style.top)+height+"px";}
if(task.parentTask&&task.cTaskNameItem[1][0])
{task.cTaskNameItem[1][0].style.top=parseInt(task.cTaskNameItem[1][0].style.top)+height+"px";task.cTaskNameItem[1][1].style.top=parseInt(task.cTaskNameItem[1][1].style.top)+height+"px";}}
task.cTaskItem[0].style.top=parseInt(task.cTaskItem[0].style.top)+height+"px";if(this.Chart.isShowDescTask){task.descrTask.style.top=parseInt(task.descrTask.style.top)+height+"px";}
if(task.cTaskItem[1][0])
{task.cTaskItem[1][0].style.top=parseInt(task.cTaskItem[1][0].style.top)+height+"px";task.cTaskItem[1][1].style.top=parseInt(task.cTaskItem[1][1].style.top)+height+"px";task.cTaskItem[1][2].style.top=parseInt(task.cTaskItem[1][2].style.top)+height+"px";}};GanttProject.prototype.shiftNextParentTask=function(task,height)
{this.shiftTask(task,height);this.shiftChildTasks(task,height);if(task.nextParentTask){this.shiftNextParentTask(task.nextParentTask,height);}};GanttProject.prototype.shiftChildTasks=function(task,height)
{for(var i=0;i<task.childTask.length;i++)
{this.shiftTask(task.childTask[i],height);if(task.childTask[i].childTask.length>0){this.shiftChildTasks(task.childTask[i],height);}}};GanttTask.prototype.shiftTask=function(task,height)
{if(this.Chart._showTreePanel){task.cTaskNameItem[0].style.top=parseInt(task.cTaskNameItem[0].style.top)+height+"px";if(task.cTaskNameItem[2]){task.cTaskNameItem[2].style.top=parseInt(task.cTaskNameItem[2].style.top)+height+"px";}
if(task.parentTask)
{if(task.cTaskNameItem[1].length>0)if((parseInt(this.cTaskNameItem[0].style.top)>parseInt(task.parentTask.cTaskNameItem[0].style.top))&&(task.cTaskNameItem[1][0].style.display!="none")){task.cTaskNameItem[1][0].style.height=parseInt(task.cTaskNameItem[1][0].style.height)+height+"px";}else{task.cTaskNameItem[1][0].style.top=parseInt(task.cTaskNameItem[1][0].style.top)+height+"px";}
if(task.cTaskNameItem[1].length>1)task.cTaskNameItem[1][1].style.top=parseInt(task.cTaskNameItem[1][1].style.top)+height+"px";}}
task.cTaskItem[0].style.top=parseInt(task.cTaskItem[0].style.top)+height+"px";if(this.Chart.isShowDescTask){task.descrTask.style.top=parseInt(task.descrTask.style.top)+height+"px";}
if(task.predTask)
{if(task.cTaskItem[1].length>0)if(((parseInt(this.cTaskItem[0].style.top)>parseInt(task.predTask.cTaskItem[0].style.top))||(this.cTaskItem[0].id==task.predTask.TaskInfo.Id))&&task.cTaskItem[1][0].style.display!="none"){task.cTaskItem[1][0].style.height=parseInt(task.cTaskItem[1][0].style.height)+height+"px";}else{task.cTaskItem[1][0].style.top=parseInt(task.cTaskItem[1][0].style.top)+height+"px";}
if(task.cTaskItem[1].length>2){task.cTaskItem[1][1].style.top=parseInt(task.cTaskItem[1][1].style.top)+height+"px";task.cTaskItem[1][2].style.top=parseInt(task.cTaskItem[1][2].style.top)+height+"px";}}};GanttTask.prototype.shiftNextTask=function(task,height)
{if(task.nextChildTask){this.shiftTask(task.nextChildTask,height);this.shiftChildTask(task.nextChildTask,height);this.shiftNextTask(task.nextChildTask,height);}else if(task.parentTask){this.shiftNextTask(task.parentTask,height);}else if(task.nextParentTask){this.shiftTask(task.nextParentTask,height);this.shiftChildTask(task.nextParentTask,height);this.shiftNextTask(task.nextParentTask,height);}};GanttTask.prototype.shiftChildTask=function(task,height)
{for(var i=0;i<task.childTask.length;i++)
{this.shiftTask(task.childTask[i],height);if(task.childTask[i].childTask.length>0){this.shiftChildTask(task.childTask[i],height);}}};GanttChart.prototype.getPosOnDate=function(est)
{return(est-this.startDate)/(60*60*1000)*this.hourInPixels;};GanttChart.prototype.getWidthOnDuration=function(duration)
{return Math.round(this.hourInPixelsWork*duration);};GanttTask.prototype.endMove=function()
{var width=parseInt(this.cTaskItem[0].style.left)-this.posX;var est=this.getDateOnPosition(parseInt(this.cTaskItem[0].style.left));est=this.checkPos(est);this.wasMoved=this.TaskInfo.EST.valueOf()!=est.valueOf();if(this.checkMove){width=this.Chart.getPosOnDate(est)-this.posX;this.moveCurrentTaskItem(width,this.moveChild);this.Project.shiftProjectItem();}
this.checkMove=false;this.posX=0;this.maxPosXMove=-1;this.minPosXMove=-1;this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";if(this.Chart._isFF)document.body.style.cursor="";if(this.Chart._isIE)this.cTaskItem[0].childNodes[2].childNodes[0].style.cursor="";};GanttTask.prototype.checkPos=function(est)
{var h=est.getHours();if(h>=12)
{est.setDate(est.getDate()+1);est.setHours(0);if((parseInt(this.cTaskItem[0].firstChild.firstChild.width)+this.Chart.getPosOnDate(est)>this.maxPosXMove)&&(this.maxPosXMove!=-1))
{est.setDate(est.getDate()-1);est.setHours(0);}}else if((h<12)&&(h!=0))
{est.setHours(0);if((this.Chart.getPosOnDate(est)<this.minPosXMove))
{est.setDate(est.getDate()+1);}}
this.cTaskItem[0].style.left=this.Chart.getPosOnDate(est)+"px";return est;};GanttTask.prototype.getMaxPosPredChildTaskItem=function()
{var posPredChildTaskItem=0;var nextPosPredChildTaskItem=0;for(var i=0;i<this.childPredTask.length;i++)
{nextPosPredChildTaskItem=this.getMaxPosPredChildTaskItemInTree(this.childPredTask[i]);if(nextPosPredChildTaskItem>posPredChildTaskItem)
{posPredChildTaskItem=nextPosPredChildTaskItem;}}
return posPredChildTaskItem;};GanttTask.prototype.getMaxPosPredChildTaskItemInTree=function(task)
{var currentPos=parseInt(task.cTaskItem[0].firstChild.firstChild.width)+parseInt(task.cTaskItem[0].style.left);var posPredChildTaskItem=0;var nextPosPredChildTaskItem=0;for(var i=0;i<task.childPredTask.length;i++)
{nextPosPredChildTaskItem=this.getMaxPosPredChildTaskItemInTree(task.childPredTask[i]);if(nextPosPredChildTaskItem>posPredChildTaskItem)
{posPredChildTaskItem=nextPosPredChildTaskItem;}}
if(posPredChildTaskItem>currentPos)
{return posPredChildTaskItem;}
else
{return currentPos;}};GanttProject.prototype.getTaskById=function(id)
{for(var i=0;i<this.arrTasks.length;i++)
{var task=this.searchTaskInTree(this.arrTasks[i],id);if(task)return task;}
return null;};GanttProject.prototype.searchTaskInTree=function(task,id)
{if(task.TaskInfo.Id==id)
{return task;}else
{for(var i=0;i<task.childTask.length;i++)
{if(task.childTask[i].TaskInfo.Id==id)
{return task.childTask[i];}
else
{if(task.childTask[i].childTask.length>0)
{var cTask=this.searchTaskInTree(task.childTask[i],id);if(cTask)return cTask;}}}}
return null;};GanttProject.prototype.shiftProjectItem=function()
{var posItemL=null;var posItemR=null;var posProjectItemL=parseInt(this.projectItem[0].style.left);var posProjectItemR=parseInt(this.projectItem[0].firstChild.style.width)+parseInt(this.projectItem[0].style.left);var widthProjectItem=parseInt(this.projectItem[0].firstChild.style.width);for(var t=0;t<this.arrTasks.length;t++)
{var tmpPosItemL=parseInt(this.arrTasks[t].cTaskItem[0].style.left);var tmpPosItemR=parseInt(this.arrTasks[t].cTaskItem[0].style.left)+parseInt(this.arrTasks[t].cTaskItem[0].firstChild.firstChild.width);if(!posItemL){posItemL=tmpPosItemL;}
if(!posItemR){posItemR=tmpPosItemR;}
if(posItemL>tmpPosItemL){posItemL=tmpPosItemL;}
if(posItemR<tmpPosItemR){posItemR=tmpPosItemR;}}
if(posItemL!=posProjectItemL)
{this.Project.StartDate=new Date(this.Chart.startDate);this.Project.StartDate.setHours(this.Project.StartDate.getHours()+(posItemL/this.Chart.hourInPixels));}
this.projectItem[0].style.left=posItemL+"px";this.resizeProjectItem(posItemR-posItemL);this.Duration=Math.round(parseInt(this.projectItem[0].firstChild.width)/(this.Chart.hourInPixelsWork));if(this.Chart.isShowDescProject){this.moveDescrProject();}
this.addDayInPanelTime();};GanttProject.prototype.addDayInPanelTime=function()
{var width=parseInt(this.projectItem[0].style.left)+parseInt(this.projectItem[0].firstChild.style.width)+20;if(this.Chart.isShowDescProject){width+=this.descrProject.offsetWidth;}
var table=this.Chart.panelTime.firstChild,tbody=table.firstChild;if(parseInt(tbody.offsetWidth)<width)
{var countDays=Math.round((width-parseInt(tbody.offsetWidth))/this.Chart.dayInPixels);var row=tbody.rows[1];for(var n=0;n<countDays;n++)
{this.Chart.addPointInTimePanel(row,table);this.Chart.addDayInPanelTime(row);}
var w=this.Chart.dayInPixels*(row.cells.length);tbody.style.width=w+"px";this.Chart.panelTasks.style.width=(w-18)+"px";}};GanttProject.prototype.addEvent=function(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}
else if(elm.attachEvent){return elm.attachEvent('on'+evType,fn);}
else{elm['on'+evType]=fn;}};GanttProject.prototype.getPopUpInfo=function(object,event)
{var posX=object.offsetLeft+((event.layerX==null)?event.offsetX:event.layerX);var posY=object.offsetTop+this.Chart.heightTaskItem+6;var tblInfo=this.Chart.divInfo.lastChild;tblInfo.rows[0].cells[0].innerHTML="<div style='font-family: Arial, Helvetica, Sans-serif; font-size: 12px; font-weight: bold; color: #688060; margin:0 0 4px 0;'>"+this.Project.Name+"</div>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Start Date:&nbsp;</span><span class='ut'>"+this.Project.StartDate.getDate()+"."+(this.Project.StartDate.getMonth()+1)+"."+this.Project.StartDate.getFullYear()+"</span><br/>";tblInfo.rows[0].cells[0].innerHTML+="<span class='st'>Duration:&nbsp;</span><span class='ut'>"+this.Duration+" hours</span><br/>";this.Chart.divInfo.style.cssText="z-index:2;position: absolute;display: inline;";if(posY+this.Chart.divInfo.lastChild.offsetHeight+6>this.Chart.oData.offsetHeight+this.Chart.oData.scrollTop)
{this.Chart.divInfo.style.top=(posY-this.Chart.divInfo.lastChild.offsetHeight-10-this.Chart.heightTaskItem)+"px";}
else{this.Chart.divInfo.style.top=posY+"px";}
if(this.Chart.divInfo.lastChild.offsetWidth+posX+10>this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft)
{this.Chart.divInfo.style.left=posX-(this.Chart.divInfo.lastChild.offsetWidth+posX+20-(this.Chart.oData.offsetWidth+this.Chart.oData.scrollLeft))+"px";}else{this.Chart.divInfo.style.left=posX+"px";}};GanttProject.prototype.closePopUpInfo=function()
{this.Chart.divInfo.style.display="none";};GanttProject.prototype.resizeProjectItem=function(width)
{var percentCompleted=this.percentCompleted;if(percentCompleted>0&&percentCompleted<100)
{this.projectItem[0].firstChild.style.width=width+"px";this.projectItem[0].firstChild.width=width+"px";this.projectItem[0].style.width=width+"px";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=Math.round(width*percentCompleted/100)+"px";this.projectItem[0].firstChild.rows[0].cells[1].firstChild.style.width=Math.round(width*(100-percentCompleted)/100)+"px";this.projectItem[0].lastChild.firstChild.width=width+"px";}else if(percentCompleted==0||percentCompleted==100)
{this.projectItem[0].firstChild.style.width=width+"px";this.projectItem[0].firstChild.width=width+"px";this.projectItem[0].style.width=width+"px";this.projectItem[0].firstChild.rows[0].cells[0].firstChild.style.width=width+"px";this.projectItem[0].lastChild.firstChild.width=width+"px";}};GanttTask.prototype.moveCurrentTaskItem=function(width,moveChild)
{var taskItem=this.cTaskItem[0];this.TaskInfo.EST=new Date(this.Chart.startDate);this.TaskInfo.EST.setHours(this.TaskInfo.EST.getHours()+(parseInt(taskItem.style.left)/this.Chart.hourInPixels));if(this.Chart.isShowDescTask){this.showDescTask();}
if(this.cTaskItem[1].length>0){this.cTaskItem[1][2].style.width=parseInt(this.cTaskItem[1][2].style.width)+width+"px";this.cTaskItem[1][1].style.left=parseInt(this.cTaskItem[1][1].style.left)+width+"px";}
for(var i=0;i<this.childTask.length;i++){if(!this.childTask[i].predTask){this.moveChildTaskItems(this.childTask[i],width,moveChild);}}
for(var i=0;i<this.childPredTask.length;i++){this.moveChildTaskItems(this.childPredTask[i],width,moveChild);}};GanttTask.prototype.moveChildTaskItems=function(task,width,moveChild)
{var taskItem=task.cTaskItem[0];if(moveChild)
{taskItem.style.left=parseInt(taskItem.style.left)+width+"px";task.addDayInPanelTime();task.TaskInfo.EST=new Date(this.Chart.startDate);task.TaskInfo.EST.setHours(task.TaskInfo.EST.getHours()+(parseInt(taskItem.style.left)/this.Chart.hourInPixels));for(var n=0;n<task.cTaskItem[1].length;n++){task.cTaskItem[1][n].style.left=parseInt(task.cTaskItem[1][n].style.left)+width+"px";}
for(var i=0;i<task.childTask.length;i++){if(!task.childTask[i].predTask){this.moveChildTaskItems(task.childTask[i],width,moveChild);}}
for(var i=0;i<task.childPredTask.length;i++){this.moveChildTaskItems(task.childPredTask[i],width,moveChild);}}
else
{if(task.cTaskItem[1].length>0)
{task.cTaskItem[1][2].style.left=parseInt(task.cTaskItem[1][2].style.left)+width+"px";task.cTaskItem[1][2].style.width=parseInt(task.cTaskItem[1][2].style.width)-width+"px";task.cTaskItem[1][0].style.left=parseInt(task.cTaskItem[1][0].style.left)+width+"px";}}
if(this.Chart.isShowDescTask){task.moveDescTask();}};GanttTask.prototype.addDayInPanelTime=function()
{var taskItem=this.cTaskItem[0];var width=parseInt(taskItem.style.left)+parseInt(taskItem.firstChild.firstChild.width)+20;if(this.Chart.isShowDescTask){width+=this.descrTask.offsetWidth;}
var table=this.Chart.panelTime.firstChild,tbody=table.firstChild;if(parseInt(tbody.offsetWidth)<width)
{var row=tbody.rows[1];var countDays=Math.round((width+20-parseInt(tbody.offsetWidth))/this.Chart.dayInPixels);for(var n=0;n<countDays;n++)
{this.Chart.addPointInTimePanel(row,table);this.Chart.addDayInPanelTime(row);}
var w=this.Chart.dayInPixels*(row.cells.length);tbody.style.width=w+"px";this.Chart.panelTasks.style.width=(w-18)+"px";}};GanttTask.prototype.getDateOnPosition=function(position)
{var date=new Date(this.Chart.startDate);date.setHours(date.getHours()+(position/this.Chart.hourInPixels));return date;};GanttTask.prototype.moveItem=function(event)
{var pageX=event.screenX;var posTaskItem=(this.posX+(pageX-this.MouseX));var widthTaskItem=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width);var posTaskItemR=posTaskItem+widthTaskItem;if(this.checkMove)
{var date=this.getDateOnPosition(posTaskItem);var res=this.Chart.callEvent("onTaskDragging",[this,date])!==false;if(res&&((this.minPosXMove<=posTaskItem))&&((posTaskItemR<=this.maxPosXMove)||(this.maxPosXMove==-1)))
{this.moveTaskItem(posTaskItem);}}};GanttTask.prototype.moveTaskItem=function(posX)
{this.addDayInPanelTime();this.cTaskItem[0].style.left=posX+"px";var date=this.getDateOnPosition(posX);this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=date.getDate()+'.'+(date.getMonth()+1)+'.'+date.getUTCFullYear();};GanttTask.prototype.resizeItem=function(event)
{if(this.checkResize)
{var MouseX=event.screenX;var widthTaskItem=this.taskItemWidth+(MouseX-this.MouseX);var countHours=Math.round(widthTaskItem/this.Chart.hourInPixelsWork);if(this.Chart.callEvent("onTaskResizing",[this,countHours])===false)return;if(widthTaskItem>=this.taskItemWidth)
{if((widthTaskItem<=this.maxWidthResize)||(this.maxWidthResize==-1))
{this.resizeTaskItem(widthTaskItem);this.addDayInPanelTime();}else if((this.maxWidthResize!=-1)&&(widthTaskItem>this.maxWidthResize))
{this.resizeTaskItem(this.maxWidthResize);}}else if(widthTaskItem<=this.taskItemWidth)
{if(widthTaskItem>=this.minWidthResize)
{this.resizeTaskItem(widthTaskItem);}
else if(widthTaskItem<this.minWidthResize)
{this.resizeTaskItem(this.minWidthResize);}}}};GanttTask.prototype.resizeTaskItem=function(width)
{var taskItem=this.cTaskItem[0];var countHours=Math.round(width/this.Chart.hourInPixelsWork);var c=taskItem.childNodes[0].firstChild.rows[0].cells[0];if(c)
{c.firstChild.style.width=parseInt(c.width)*width/100+"px";}
c=taskItem.childNodes[0].firstChild.rows[0].cells[1];if(c)
{c.firstChild.style.width=parseInt(c.width)*width/100+"px";}
taskItem.childNodes[0].firstChild.width=width+"px";taskItem.childNodes[1].firstChild.width=width+"px";this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=countHours;taskItem.childNodes[2].childNodes[0].style.width=width+"px";taskItem.childNodes[2].childNodes[1].style.left=width-10+"px";};GanttTask.prototype.endResizeItem=function()
{var taskItem=this.cTaskItem[0];this.wasResized=this.taskItemWidth!=parseInt(taskItem.childNodes[0].firstChild.width);if(this.wasResized)
{var posXL=taskItem.offsetLeft;var posXR=taskItem.offsetLeft+parseInt(taskItem.childNodes[0].firstChild.width);this.TaskInfo.Duration=Math.round((posXR-posXL)/this.Chart.hourInPixelsWork);if(this.childPredTask.length>0)
{for(var j=0;j<this.childPredTask.length;j++)
{this.childPredTask[j].cTaskItem[1][2].style.width=parseInt(this.childPredTask[j].cTaskItem[1][2].style.width)-(parseInt(taskItem.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";this.childPredTask[j].cTaskItem[1][2].style.left=parseInt(this.childPredTask[j].cTaskItem[1][2].style.left)+(parseInt(taskItem.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";this.childPredTask[j].cTaskItem[1][0].style.left=parseInt(this.childPredTask[j].cTaskItem[1][0].style.left)+(parseInt(taskItem.childNodes[0].firstChild.width)-this.taskItemWidth)+"px";}}}
this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";this.checkResize=false;this.taskItemWidth=0;this.MouseX=0;if(this.Chart.isShowDescTask){this.showDescTask();}
this.Project.shiftProjectItem();if(this.Chart._isFF)document.body.style.cursor="";};GanttProject.prototype.moveDescrProject=function()
{this.descrProject.style.left=(parseInt(this.projectItem[0].style.left)+this.Duration*this.Chart.hourInPixelsWork+10);this.descrProject.innerHTML=this.getDescStr();};GanttProject.prototype.showDescrProject=function()
{var posX=(parseInt(this.projectItem[0].style.left)+this.Duration*this.Chart.hourInPixelsWork+10);this.descrProject.style.left=posX+"px";this.descrProject.style.visibility='visible';this.descrProject.innerHTML=this.getDescStr();};GanttProject.prototype.hideDescrProject=function()
{this.descrProject.style.visibility='hidden';};GanttProject.prototype.getDescStr=function()
{var str='',delim=", ";for(var i=0;i<this.Chart.paramShowProject.length;i++){switch(this.Chart.paramShowProject[i]){case"Name":if(str!="")str+=delim;str+=this.Project[this.Chart.paramShowProject[i]];break;case"StartDate":if(str!="")str+=delim;var d=this.Project[this.Chart.paramShowProject[i]];str+=d.getDate()+"."+(d.getMonth()+1)+"."+d.getFullYear();break;case"Duration":if(str!="")str+=delim;str+=this[this.Chart.paramShowProject[i]]+"h";break;case"percentCompleted":if(str!="")str+=delim;str+=this[this.Chart.paramShowProject[i]]+"%";break;default:break;}}
return str;};GanttProject.prototype.createDescrProject=function()
{var posX=(this.posX+this.Duration*this.Chart.hourInPixelsWork+10);var divDesc=document.createElement("div");divDesc.style.cssText+=";z-index:1;position:absolute;left:"+posX+"px;top:"+this.posY+"px;";divDesc.innerHTML=this.getDescStr();divDesc.className="descProject";this.descrProject=divDesc;if(this.Project.ParentTasks.length==0){this.descrProject.style.visibility='hidden';}
if(this.Chart._showTooltip)
{var self=this;var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.descrProject,e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divDesc,'mouseover',getPopUpInfo,false);this.addEvent(divDesc,'mouseout',closePopUpInfo,false);}
return divDesc;};GanttProject.prototype.createProjectItem=function()
{var self=this;this.percentCompleted=this.getPercentCompleted();this.Duration=this.getDuration();var projectItem=document.createElement("div");projectItem.id=this.Project.Id;projectItem.style.cssText=";z-index:1;position: absolute;left:"+this.posX+"px;top:"+this.posY+"px;";projectItem.style.width=this.Duration*this.Chart.hourInPixelsWork+"px";var tblProjectItem=document.createElement("table");projectItem.appendChild(tblProjectItem);tblProjectItem.cellPadding="0";tblProjectItem.cellSpacing="0";tblProjectItem.style.cssText="border: solid 1px #BC810D;";var width=this.Duration*this.Chart.hourInPixelsWork;tblProjectItem.width=((width==0)?1:width)+"px";tblProjectItem.style.width=((width==0)?1:width)+"px";var rowprojectItem=tblProjectItem.insertRow(tblProjectItem.rows.length);if(this.percentCompleted!=-1)
{if(this.percentCompleted!=0)
{var cellprojectItem=document.createElement("TD");rowprojectItem.appendChild(cellprojectItem);cellprojectItem.width=this.percentCompleted+"%";cellprojectItem.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width=(this.percentCompleted*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"parentnode_filled.png";}
if(this.percentCompleted!=100)
{var cellprojectItem=document.createElement("TD");rowprojectItem.appendChild(cellprojectItem);cellprojectItem.width=(100-this.percentCompleted)+"%";cellprojectItem.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width=((100-this.percentCompleted)*this.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}}else
{var cellprojectItem=document.createElement("TD");rowprojectItem.appendChild(cellprojectItem);cellprojectItem.width="1px";cellprojectItem.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width="1px";imgPr.style.height=this.Chart.heightTaskItem;cellprojectItem.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_bg.png";}
var divTaskInfo=document.createElement("div");divTaskInfo.style.cssText="text-align:center;z-index:2;position:absolute;left:0px;top:0px;";var tblTaskInfo=document.createElement("table");divTaskInfo.appendChild(tblTaskInfo);tblTaskInfo.cellPadding="0";tblTaskInfo.cellSpacing="0";tblTaskInfo.height=this.Chart.heightTaskItem+"px";tblTaskInfo.width=((this.Duration*this.Chart.hourInPixelsWork==0)?1:this.Duration*this.Chart.hourInPixelsWork)+"px";var rowTaskInfo=tblTaskInfo.insertRow(0);var cellTaskInfo=document.createElement("td");cellTaskInfo.align="center";cellTaskInfo.vAlign="top";cellTaskInfo.height=this.Chart.heightTaskItem+"px";cellTaskInfo.className="moveInfo";cellTaskInfo.style.cssText=";white-space:nowrap;";rowTaskInfo.appendChild(cellTaskInfo);projectItem.appendChild(divTaskInfo);if(this.Project.ParentTasks.length==0)
{projectItem.style.display="none";}
if(this.Chart._showTooltip)
{var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.projectItem[0],e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divTaskInfo,'mouseover',getPopUpInfo,false);this.addEvent(divTaskInfo,'mouseout',closePopUpInfo,false);}
return projectItem;};GanttProject.prototype.createProjectNameItem=function()
{var self=this;var divName=document.createElement("div");divName.style.cssText="cursor:pointer;color:#003366;font-weight:bold;font-size:12px;font-family:Tahoma,Arial;white-space:nowrap;height:15px;z-index:1;position:absolute;left:"+5+"px;top:"+this.posY+"px;";divName.innerHTML=this.Project.Name;divName.title=this.Project.Name;if(this.Chart.isShowConMenu)
{var showContMenu=function(event){if(self.Chart.contextMenu.clear)self.Chart.contextMenu.clear();var hideContMenu=null;if(!self.Chart._isIE)
{hideContMenu=function(){self.Chart.contextMenu.hideContextMenu();self.Chart.content.removeEventListener("mousedown",hideContMenu,false);};}else
{hideContMenu=function(){self.Chart.contextMenu.hideContextMenu();self.Chart.content.detachEvent("mousedown",hideContMenu);};}
self.Chart.content.onmousedown=hideContMenu;if(!self.Chart._isIE)
{event.stopPropagation();}else
{event.cancelBubble=true;}
self.Chart._showContextMenu(event,self);};if(this.Chart._isIE)
{this.addEvent(divName,"contextmenu",function(e){showContMenu(e);return false;},false);}else
{this.addEvent(divName,"contextmenu",function(e){e.preventDefault();showContMenu(e);},false);}}
return divName;};GanttProject.prototype.getPercentCompleted=function()
{var sum=0;var percentCompleted=0;for(var i=0;i<this.Project.ParentTasks.length;i++){sum+=parseInt(this.Project.ParentTasks[i].PercentCompleted);}
if(this.Project.ParentTasks.length!=0){return percentCompleted=Math.round(sum/this.Project.ParentTasks.length);}
else{return percentCompleted=-1;}};GanttProject.prototype.getDuration=function()
{var duration=0;var tmpDuration=0;if(this.Project.ParentTasks.length>0)
{for(var i=0;i<this.Project.ParentTasks.length;i++)
{tmpDuration=this.Project.ParentTasks[i].Duration*24/this.Chart.hoursInDay+(this.Project.ParentTasks[i].EST-this.Chart.startDate)/(60*60*1000);if(tmpDuration>duration)
{duration=tmpDuration;}}
return((duration-this.posX)/24)*this.Chart.hoursInDay;}else
{return 0;}};GanttProject.prototype.getId=function()
{return this.Project.Id;};GanttProject.prototype.getName=function()
{return this.Project.Name;};GanttProject.prototype.getStartDate=function()
{return this.Project.StartDate;};GanttTask.prototype.addEvent=function(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}
else if(elm.attachEvent){return elm.attachEvent('on'+evType,fn);}
else{elm['on'+evType]=fn;}};GanttTask.prototype.startMove=function(event)
{this.moveChild=event.ctrlKey;this.MouseX=event.screenX;this.getMoveInfo();this.checkMove=true;if(this.Chart.isShowDescTask){this.hideDescTask();}
if(this.Chart._isFF)document.body.style.cursor="move";if(this.Chart._isIE)event.srcElement.style.cursor="move";};GanttTask.prototype.showDescTask=function()
{var posX=(parseInt(this.cTaskItem[0].style.left)+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10);this.descrTask.style.left=posX+"px";this.descrTask.innerHTML=this.getDescStr();this.descrTask.style.visibility='visible';};GanttTask.prototype.hideDescTask=function()
{this.descrTask.style.visibility='hidden';};GanttTask.prototype.getDescStr=function()
{var str='',delim=", ";for(var i=0;i<this.Chart.paramShowTask.length;i++){var prop=this.Chart.paramShowTask[i],propValue=this.TaskInfo[prop];switch(prop){case"Name":if(str!="")str+=delim;str+=propValue;break;case"EST":if(str!="")str+=delim;str+=propValue.getDate()+"."+(propValue.getMonth()+1)+"."+propValue.getFullYear();break;case"S-F":if(str!="")str+=delim;propValue=this.TaskInfo["EST"];str+=propValue.getDate()+"."+(propValue.getMonth()+1)+"."+propValue.getFullYear()+" - ";propValue=this.getFinishDate();str+=propValue.getDate()+"."+(propValue.getMonth()+1)+"."+propValue.getFullYear();break;case"Duration":if(str!="")str+=delim;str+=propValue+"h";break;case"PercentCompleted":if(str!="")str+=delim;str+=propValue+"%";break;default:break;}}
return str;};GanttTask.prototype.getId=function()
{return this.TaskInfo.Id;};GanttTask.prototype.getName=function()
{return this.TaskInfo.Name;};GanttTask.prototype.getDuration=function()
{return this.TaskInfo.Duration;};GanttTask.prototype.getEST=function()
{return this.TaskInfo.EST;};GanttTask.prototype.getFinishDate=function()
{var date=new Date(this.TaskInfo.EST);date.setDate(date.getDate()+parseInt((this.TaskInfo["Duration"]-1)/this.Chart.hoursInDay+1)-1);return date;};GanttTask.prototype.getPercentCompleted=function()
{return this.TaskInfo.PercentCompleted;};GanttTask.prototype.getPredecessorTaskId=function()
{return this.TaskInfo.PredecessorTaskId?this.TaskInfo.PredecessorTaskId:null;};GanttTask.prototype.getParentTaskId=function()
{return this.parentTask?this.parentTask.getId():null;};GanttTask.prototype.moveDescTask=function()
{var posX=(parseInt(this.cTaskItem[0].style.left)+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10);this.descrTask.style.left=posX+"px";};GanttTask.prototype.getMoveInfo=function()
{this.posX=parseInt(this.cTaskItem[0].style.left);var widthTaskItem=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width);var posParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].style.left);var posPredTaskItem=(this.predTask==null)?0:parseInt(this.predTask.cTaskItem[0].style.left)+parseInt(this.predTask.cTaskItem[0].childNodes[0].firstChild.width);var widthParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width);var childPredPosX=0;var childParentPosX=0;var childParentPosXR=0;if(this.childPredTask.length>0)
{var posChildTaskItem=null;for(var n=0;n<this.childPredTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem>parseInt(this.childPredTask[n].cTaskItem[0].style.left))))
{posChildTaskItem=parseInt(this.childPredTask[n].cTaskItem[0].style.left);}}
childPredPosX=posChildTaskItem;}
if(this.childTask.length>0)
{var posChildTaskItemR=null;for(var n=0;n<this.childTask.length;n++)
{if((!posChildTaskItemR)||((posChildTaskItemR)&&(posChildTaskItemR>(parseInt(this.childTask[n].cTaskItem[0].style.left)))))
{posChildTaskItemR=parseInt(this.childTask[n].cTaskItem[0].style.left);}}
childParentPosXR=posChildTaskItemR;var posChildTaskItem=null;for(var n=0;n<this.childTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem<(parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width)))))
{posChildTaskItem=parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width);}}
childParentPosX=posChildTaskItem;}
if(!this.moveChild)
{if(this.childPredTask.length>0){if(this.maxPosXMove<childPredPosX)this.maxPosXMove=childPredPosX;}
if(this.childTask.length>0){if((this.childPredTask.length>0)&&(this.maxPosXMove-widthTaskItem)>childParentPosXR)this.maxPosXMove=this.maxPosXMove-((this.maxPosXMove-widthTaskItem)-childParentPosXR);if(!(this.childPredTask.length>0))this.maxPosXMove=childParentPosXR+widthTaskItem;this.minPosXMove=(childParentPosX-widthTaskItem);}
if(posParentTaskItem>0)
{if((!(this.childPredTask.length>0))&&(this.childTask.length>0)){if(this.maxPosXMove>posParentTaskItem+widthParentTaskItem){this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}}
if(this.minPosXMove<=posParentTaskItem){this.minPosXMove=posParentTaskItem;}
if((!(this.childTask.length>0))&&(!(this.childPredTask.length>0))){this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}else if((!(this.childTask.length>0))&&(this.childPredTask.length>0)){if((posParentTaskItem+widthParentTaskItem)>posPredTaskItem){this.maxPosXMove=childPredPosX;}}}
if(posPredTaskItem>0){if(this.minPosXMove<=posPredTaskItem){this.minPosXMove=posPredTaskItem;}}
if((posPredTaskItem==0)&&(posParentTaskItem==0)){if(this.minPosXMove<=this.Chart.initialPos){this.minPosXMove=this.Chart.initialPos;}}}else
{if((posParentTaskItem>0)&&(posPredTaskItem==0))
{this.minPosXMove=posParentTaskItem;this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}else if((posParentTaskItem==0)&&(posPredTaskItem==0))
{this.minPosXMove=this.Chart.initialPos;this.maxPosXMove=-1;}else if((posParentTaskItem>0)&&(posPredTaskItem>0))
{this.minPosXMove=posPredTaskItem;this.maxPosXMove=posParentTaskItem+widthParentTaskItem;}else if((posParentTaskItem==0)&&(posPredTaskItem>0))
{this.minPosXMove=posPredTaskItem;this.maxPosXMove=-1;}
if((this.parentTask)&&(this.childPredTask.length>0))
{var posChildTaskItem=this.getMaxPosPredChildTaskItem(this);var posParentTaskItem=parseInt(this.parentTask.cTaskItem[0].style.left)+parseInt(this.parentTask.cTaskItem[0].firstChild.firstChild.width);this.maxPosXMove=this.posX+widthTaskItem+posParentTaskItem-posChildTaskItem;}}};GanttTask.prototype.startResize=function(event)
{this.MouseX=event.screenX;this.getResizeInfo();if(this.Chart.isShowDescTask){this.hideDescTask();}
this.checkResize=true;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);if(this.Chart._isFF)document.body.style.cursor="e-resize";};GanttTask.prototype.getResizeInfo=function()
{var taskItem=this.cTaskItem[0];var posParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].style.left);var widthParentTaskItem=(this.parentTask==null)?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width);var posTaskItem=parseInt(this.cTaskItem[0].style.left);var childPredPosX=0;var childParentPosX=0;if(this.childPredTask.length>0)
{var posChildTaskItem=null;for(var n=0;n<this.childPredTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem>parseInt(this.childPredTask[n].cTaskItem[0].style.left))))
{posChildTaskItem=parseInt(this.childPredTask[n].cTaskItem[0].style.left);}}
childPredPosX=posChildTaskItem;}
if(this.childTask.length>0)
{var posChildTaskItem=null;for(var n=0;n<this.childTask.length;n++)
{if((!posChildTaskItem)||((posChildTaskItem)&&(posChildTaskItem<(parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width)))))
{posChildTaskItem=parseInt(this.childTask[n].cTaskItem[0].style.left)+parseInt(this.childTask[n].cTaskItem[0].firstChild.firstChild.width);}}
childParentPosX=posChildTaskItem;}
this.minWidthResize=this.Chart.minWidthResize;if(this.childTask.length>0)
{this.minWidthResize=childParentPosX-posTaskItem;}
if((this.childPredTask.length>0)&&(!this.parentTask))
{this.maxWidthResize=childPredPosX-posTaskItem;}else if((this.childPredTask.length>0)&&(this.parentTask))
{var w1=posParentTaskItem+widthParentTaskItem-posTaskItem;var w2=childPredPosX-posTaskItem;this.maxWidthResize=Math.min(w1,w2);}else if((this.childPredTask.length==0)&&(this.parentTask))
{this.maxWidthResize=posParentTaskItem+widthParentTaskItem-posTaskItem;}};GanttTask.prototype.createTaskItem=function()
{var self=this;this.posX=this.Chart.getPosOnDate(this.TaskInfo.EST);var itemControl=document.createElement("div");itemControl.id=this.TaskInfo.Id;itemControl.style.cssText=";z-index:1;position:absolute;left:"+this.posX+"px;top:"+this.posY+"px;";var divTaskItem=document.createElement("div");itemControl.appendChild(divTaskItem);divTaskItem.style.cssText="z-index:1;position: absolute;left:0px;top:0px;";var tblTaskItem=document.createElement("table");divTaskItem.appendChild(tblTaskItem);tblTaskItem.cellPadding="0";tblTaskItem.cellSpacing="0";tblTaskItem.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";tblTaskItem.style.cssText="border: solid 1px #6589A9;";var rowTblTask=tblTaskItem.insertRow(tblTaskItem.rows.length);if(this.TaskInfo.PercentCompleted!=0)
{var cellTblTask=document.createElement("td");rowTblTask.appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=this.TaskInfo.PercentCompleted+"%";cellTblTask.style.lineHeight="1px";var imgPr=document.createElement("img");imgPr.style.width=(this.TaskInfo.PercentCompleted*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPr.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPr);imgPr.src=this.Chart.imgs+"progress_filled.png";}
if(this.TaskInfo.PercentCompleted!=100)
{var cellTblTask=document.createElement("td");rowTblTask.appendChild(cellTblTask);cellTblTask.height=this.Chart.heightTaskItem+"px";cellTblTask.width=(100-this.TaskInfo.PercentCompleted)+"%";cellTblTask.style.lineHeight="1px";var imgPrF=document.createElement("img");imgPrF.style.width=((100-this.TaskInfo.PercentCompleted)*this.TaskInfo.Duration*this.Chart.hourInPixelsWork)/100+"px";imgPrF.style.height=this.Chart.heightTaskItem+"px";cellTblTask.appendChild(imgPrF);imgPrF.src=this.Chart.imgs+"progress_bg.png";}
if(this.Chart.isEditable)
{var divTaskInfo=document.createElement("div");divTaskInfo.style.cssText="text-align:center;font-size:9px;z-index:2;position: absolute;left:0px;top:0px;";var tblTaskInfo=document.createElement("table");divTaskInfo.appendChild(tblTaskInfo);tblTaskInfo.cellPadding="0";tblTaskInfo.cellSpacing="0";tblTaskInfo.height=this.Chart.heightTaskItem+"px";tblTaskInfo.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";var rowTaskInfo=tblTaskInfo.insertRow(0);var cellTaskInfo=document.createElement("TD");cellTaskInfo.align="center";cellTaskInfo.vAlign="top";cellTaskInfo.height=this.Chart.heightTaskItem+"px";cellTaskInfo.className="moveInfo";cellTaskInfo.style.cssText=";white-space:nowrap;font-size:9px";rowTaskInfo.appendChild(cellTaskInfo);itemControl.appendChild(divTaskInfo);}
var divTaskName=document.createElement("div");itemControl.appendChild(divTaskName);divTaskName.style.cssText=";z-index:2;position: absolute;left:0px;top:0px;";var divMove=document.createElement("div");divMove.innerHTML="<input type='text' style='visibility:hidden;width:1px;height:1px;'/>";if(this.Chart._isIE)
{divMove.style.background="#000000";divMove.style.filter="alpha(opacity=0)";}
divMove.style.height=this.Chart.heightTaskItem+"px";divMove.style.width=this.TaskInfo.Duration*this.Chart.hourInPixelsWork+"px";divTaskName.appendChild(divMove);if(this.Chart._showTooltip)
{var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.cTaskItem[0],e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divMove,'mouseover',getPopUpInfo,false);this.addEvent(divMove,'mouseout',closePopUpInfo,false);}
var taskClick=function(){self.Chart.callEvent("onTaskClick",[self]);};this.addEvent(divMove,'click',taskClick,false);if(this.Chart.isEditable)
{var divResize=document.createElement("div");divResize.style.cssText=";z-index:10;position: absolute;left:"+(this.TaskInfo.Duration*this.Chart.hourInPixelsWork-10)+"px;top:0px;";divResize.style.height=this.Chart.heightTaskItem+"px";divResize.style.width="10px";divResize.innerHTML="<input type='text' style='visibility:hidden;width:1px;height:1px;'/>";divTaskName.appendChild(divResize);var startMove=function(e){if(self.Chart.callEvent("onTaskStartDrag",[self])===false)return;var moveItem=function(e1){if(self.checkMove)self.moveItem(e1);};var endMove=function(){if(self.checkMove){self.endMove();self.Chart._isMove=false;if(self.Chart._isIE)
{document.body.releaseCapture();document.detachEvent("onmousemove",moveItem);document.detachEvent("onmouseup",endMove);}else{document.removeEventListener("mousemove",moveItem,true);document.removeEventListener("mouseup",endMove,true);}
if(self.wasMoved)self.Chart.callEvent("onTaskEndDrag",[self]);}};self.addEvent(document,'mousemove',moveItem,true);self.addEvent(document,'mouseup',endMove,true);if(self.Chart._showTooltip)self.closePopUpInfo();self.startMove(e);self.Chart._isMove=true;if(self.Chart._isIE)document.body.setCapture(false);};var startResize=function(e){if(self.Chart.callEvent("onTaskStartResize",[self])===false)return;var resizeItem=function(e1){if(self.checkResize)self.resizeItem(e1);};var endResizeItem=function(){if(self.checkResize){self.endResizeItem();self.Chart._isResize=false;if(self.Chart._isIE)
{document.body.releaseCapture();document.detachEvent("onmousemove",resizeItem);document.detachEvent("onmouseup",endResizeItem);}else{document.removeEventListener("mousemove",resizeItem,true);document.removeEventListener("mouseup",endResizeItem,true);}
if(self.wasResized)self.Chart.callEvent("onTaskEndResize",[self]);}};self.addEvent(document,'mousemove',resizeItem,false);self.addEvent(document,'mouseup',endResizeItem,false);self.startResize(e);if(self.Chart._isIE)document.body.setCapture(false);self.Chart._isResize=true;};this.addEvent(divMove,'mousedown',startMove,false);this.addEvent(divResize,'mousedown',startResize,false);var setCursorResize=function(e2){if(!self.Chart._isMove)(e2.srcElement?e2.srcElement:e2.target).style.cursor="e-resize";};var setCursorStandart=function(e3){if(!self.checkResize)(e3.srcElement?e3.srcElement:e3.target).style.cursor="";};this.addEvent(divResize,'mouseover',setCursorResize,false);this.addEvent(divResize,'mouseout',setCursorStandart,false);}
return itemControl;};GanttTask.prototype.createTaskNameItem=function(hasChildren)
{var self=this;var divName=document.createElement("div");divName.id=this.TaskInfo.Id;divName.style.cssText="cursor:pointer;white-space:nowrap;height:15px;z-index:1;position:absolute;left:20px;top: "+this.posY+"px;";if(hasChildren)divName.style.fontWeight="bold";divName.className="taskNameItem";divName.title=this.TaskInfo.Name;divName.innerHTML=this.TaskInfo.Name;if(this.Chart.isShowConMenu)
{var showContMenu=function(event){if(self.Chart.contextMenu.clear)self.Chart.contextMenu.clear();var hideContMenu=function(){self.Chart.contextMenu.hideContextMenu();if(self.Chart._isIE)
self.Chart.content.detachEvent("mousedown",hideContMenu);else
self.Chart.content.removeEventListener("mousedown",hideContMenu,false);};self.Chart.content.onmousedown=hideContMenu;if(!self.Chart._isIE)
{event.stopPropagation();}else
{event.cancelBubble=true;}
self.Chart._showContextMenu(event,self);};if(this.Chart._isIE)
{this.addEvent(divName,"contextmenu",function(e){showContMenu(e);return false;},false);}else
{this.addEvent(divName,"contextmenu",function(e){e.preventDefault();showContMenu(e);},false);}}
return divName;};GanttTask.prototype.createTaskDescItem=function()
{var posX=(this.posX+this.TaskInfo.Duration*this.Chart.hourInPixelsWork+10);var divDesc=document.createElement("div");divDesc.style.cssText+=";z-index:1;position:absolute;left:"+posX+"px;top:"+this.posY+"px;";divDesc.innerHTML=this.getDescStr();divDesc.className="descTask";this.descrTask=divDesc;if(this.Chart._showTooltip)
{var self=this;var getPopUpInfo=function(e){if((!self.Chart._isMove)&&(!self.Chart._isResize))self.getPopUpInfo(self.descrTask,e);};var closePopUpInfo=function(){self.closePopUpInfo();};this.addEvent(divDesc,'mouseover',getPopUpInfo,false);this.addEvent(divDesc,'mouseout',closePopUpInfo,false);}
return divDesc;};GanttTask.prototype.checkWidthTaskNameItem=function()
{if(this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft>this.Chart.maxWidthPanelNames)
{var width=this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft-this.Chart.maxWidthPanelNames;var countChar=Math.round(width/(this.cTaskNameItem[0].offsetWidth/this.cTaskNameItem[0].firstChild.length));var tName=this.TaskInfo.Name.substring(0,this.cTaskNameItem[0].firstChild.length-countChar-3);tName+="...";this.cTaskNameItem[0].innerHTML=tName;}};GanttTask.prototype.create=function()
{var containerTasks=this.Chart.oData.firstChild;var containerNames=null;if(this.Chart._showTreePanel)containerNames=this.Chart.panelNames.firstChild;var predecessorTask=this.TaskInfo.PredecessorTask;var parentTask=this.TaskInfo.ParentTask;var isCParentTask=(this.TaskInfo.ChildTasks.length>0);var self=this;this.cTaskItem=[];this.cTaskNameItem=[];if(!parentTask)
{if(this.TaskInfo.previousParentTask){this.previousParentTask=this.Project.getTaskById(this.TaskInfo.previousParentTask.Id);var lastChildTask=this.Chart.getLastChildTask(this.previousParentTask);this.posY=parseInt(lastChildTask.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;this.previousParentTask.nextParentTask=this;}else{this.posY=parseInt(this.Project.projectItem[0].style.top)+this.Chart.heightTaskItem+11;}}
if(parentTask){var task=this.Project.getTaskById(this.TaskInfo.ParentTask.Id);this.parentTask=task;if(this.TaskInfo.previousChildTask){this.previousChildTask=this.Project.getTaskById(this.TaskInfo.previousChildTask.Id);var lastChildTask=this.Chart.getLastChildTask(this.previousChildTask);this.posY=parseInt(lastChildTask.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;this.previousChildTask.nextChildTask=this;}else{this.posY=parseInt(task.cTaskItem[0].style.top)+this.Chart.heightTaskItem+11;}
task.childTask.push(this);}
if(predecessorTask){var task=this.Project.getTaskById(predecessorTask.Id);this.predTask=task;task.childPredTask.push(this);}
this.cTaskItem.push(this.createTaskItem());containerTasks.appendChild(this.cTaskItem[0]);if(this.Chart.panelNames){this.cTaskNameItem.push(this.createTaskNameItem(isCParentTask));this.Chart.panelNames.firstChild.appendChild(this.cTaskNameItem[0]);}
if(this.Chart.isShowDescTask){containerTasks.appendChild(this.createTaskDescItem());}
var arrConnectingLines=[];if(predecessorTask)arrConnectingLines=this.createConnectingLinesDS();this.cTaskItem.push(arrConnectingLines);if(this.Chart.panelNames)
{var arrConnectingLinesNames=[];if(parentTask)
{this.cTaskNameItem[0].style.left=parseInt(this.parentTask.cTaskNameItem[0].style.left)+15+"px";arrConnectingLinesNames=this.createConnectingLinesPN();}
this.checkWidthTaskNameItem();var treeImg=null;if(isCParentTask)treeImg=this.createTreeImg();this.cTaskNameItem.push(arrConnectingLinesNames);this.cTaskNameItem.push(treeImg);}
this.addDayInPanelTime();return this;};GanttTask.prototype.createTreeImg=function()
{var self=this;var treeImg=new Image();treeImg.src=this.Chart.imgs+"minus.gif";treeImg.id=this.TaskInfo.Id;treeImg.onclick=function()
{if(self._isOpen)
{this.src=self.Chart.imgs+"plus.gif";self._isOpen=false;self.hideChildTasks(self);self.shiftCurrentTasks(self,-self._heightHideTasks);}
else
{this.src=self.Chart.imgs+"minus.gif";self._isOpen=true;self.shiftCurrentTasks(self,self._heightHideTasks);self.showChildTasks(self,true);self._heightHideTasks=0;}};this.Chart.panelNames.firstChild.appendChild(treeImg);treeImg.style.cssText="cursor:pointer;left:"+(parseInt(this.cTaskNameItem[0].style.left)-12)+"px;top:"+(parseInt(this.cTaskNameItem[0].style.top)+3)+"px;z-index:12;position:absolute;";return treeImg;};GanttChart.prototype.getLastChildTask=function(task)
{if(task.childTask.length>0)
{return this.getLastChildTask(task.childTask[task.childTask.length-1]);}else
{return task;}};dhtmlXMLSenderObject=function(ganttChart)
{this.xmlHttp=this.createXMLHttpRequest();this.isProcessed=false;this.path=null;this.filename=null;this.Chart=ganttChart;};dhtmlXMLSenderObject.prototype.createXMLHttpRequest=function()
{if(window.XMLHttpRequest){return new XMLHttpRequest();}
else if(window.ActiveXObject){return new ActiveXObject("Microsoft.XMLHTTP");}};dhtmlXMLSenderObject.prototype.sendData=function(filename,path,xmlData)
{var self=this;this.path=path;this.filename=filename;if((this.path==null)||(this.path==""))
{this.Chart.Error.throwError("DATA_SEND_ERROR",3,null);return;}
if((this.filename==null)||(this.filename==""))
{this.Chart.Error.throwError("DATA_SEND_ERROR",4,null);return;}
this.isProcessed=true;this.xmlHttp.open("POST",this.path,true);if(this.Chart._isFF)
{this.xmlHttp.onerror=function(){self.xmlHttp.onreadystatechange=null;self.xmlHttp.abort();self.isProcessed=false;}}
this.xmlHttp.onreadystatechange=function(){self.getStatus();};this.xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");this.xmlHttp.send("data="+encodeURI(xmlData)+"&filename="+filename);};dhtmlXMLSenderObject.prototype.getStatus=function()
{if(this.xmlHttp.readyState==4)
{var _status="";try{_status=this.xmlHttp.status;}catch(e){this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);return 0;}
switch(_status){case 0:this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);break;case 404:this.Chart.Error.throwError("DATA_SEND_ERROR",5,[this.path]);break;case 500:this.Chart.Error.throwError("DATA_SEND_ERROR",2,null);break;case 12029:this.Chart.Error.throwError("DATA_SEND_ERROR",1,null);break;default:if(!(_status>=200&&_status<300||_status==304))
{this.Chart.Error.throwError("DATA_SEND_ERROR",0,null);}
break;}
this.isProcessed=false;}};function GanttError(){this.catches=[];this._errors=[];this._init();return this;}
GanttError.prototype._init=function()
{this._errors[0]="Connection error";this._errors[1]="Cannot connect";this._errors[2]="Server error";this._errors[3]="Path is null or empty";this._errors[4]="Filename is null or empty";this._errors[5]="File (%0) is not found";this._errors[6]="Percent Complete  should be a number";this._errors[7]="Percent Complete should be <= 100";this._errors[8]="Percent Complete should be >= 0";this._errors[9]="Increase duration of task(%0)";this._errors[10]="Reduce duration of task(%0)";this._errors[11]="Increase  EST of child task (%0)";this._errors[12]="Reduce EST of task (%0)";this._errors[13]="The project (%0) is added";this._errors[14]="Start Date of the project < start Date of the control";this._errors[15]="Task (%0) cannot be the child of predecessor task(%1)";this._errors[16]="Time of the termination of predecessor task(%0) > EST of child task(%1)";this._errors[17]="The Predecessor (%0) task  does not exist";this._errors[18]="The EST of task (%0) < start date of the control";this._errors[19]="Time of the termination of parent task (%0) < time of the termination of child task(%1)";this._errors[20]="The EST of task (%0) < EST of parent task(%1)";this._errors[21]="The parent task (%0) does not exist";this._errors[22]="The task (%0) is added";this._errors[23]="The project (%0) is added";this._errors[24]="Task (%0) EST < project (%1) startDate";this._errors[25]="Parent task (%0) EST cannot be null";this._errors[26]="Predecessor task (%0) position error. Reduce duration of predecessor task (%0) or increase EST of child task (%1)";this._errors[27]="Predecessor task (%0) does not exist";this._errors[28]="Increase duration of parent task (%0) or reduce EST of child task (%1) or reduce duration of child task(%1)";this._errors[29]="Reduce EST of parent task (%0) or increase  EST of child task (%1)";this._errors[30]="The  task(%0) does not exist";this._errors[31]="The project(%0) does not exist";this._errors[32]="Predecessor task(%0) and child task(%1) should have the same parent";this._errors[33]="Reduce EST of parent task (%0) or increase  EST of child task (%1)";this._errors[34]="EST of task(%0) < start date of the project(%1)";this._errors[35]="Percent Complete should be <= 100 and >= 0";this._errors[36]="You may not connect a task to itself.";this._errors[37]="Cannot parse this XML string.";};GanttError.prototype.catchError=function(type,handler){this.catches[type]=handler;};GanttError.prototype.getErrorString=function(str,params)
{if(!params){return str;}else{for(var i=0;i<params.length;i++){var re=new RegExp("%"+i,"gi");str=str.replace(re,params[i]);}
return str;}};GanttError.prototype.throwError=function(type,description,params){if(this.catches[type])
{var index=parseInt(description);var errorStr=this.getErrorString(this._errors[index],params);return this.catches[type](type,errorStr,params);}
return null;};function contextMenu(chart)
{this.Chart=chart;this.TabContainer=null;this.MenuPanel=null;this.tabPanel=null;this.arrTabs=[];this.isShow=false;this.hideDiv=null;this._init();}
contextMenu.prototype._init=function()
{this.createMenuPanel();this.createHideDiv();this.createTabContainer();this.createTabPanel();var self=this;var arrItems=[];var tab1=this.createTab(1,"Rename task","t",true,this);tab1.addItem(1,"New name",document.createElement("input"),"text",function(){tab1.arrItems[0].control.focus();});tab1.addItem(2,"Rename",document.createElement("input"),"button",function(){var name=tab1.arrItems[0].control.value;try{tab1.object.setName(name);tab1.hide();}catch(e){}});var tab2=this.createTab(2,"Delete task","t",true,this);tab2.addItem(1,"Delete",document.createElement("input"),"button",function()
{try{tab2.object.Project.deleteTask(tab2.object.TaskInfo.Id);tab2.hide();}
catch(e){}});var tab3=this.createTab(3,"Set EST","t",true,this);tab3.addItem(1,"EST",document.createElement("input"),"text",function(){tab3.arrItems[0].control.focus();});tab3.addItem(2,"Move children",document.createElement("input"),"checkbox",function(){tab3.arrItems[1].control.focus();});tab3.addItem(3,"Update",document.createElement("input"),"button",function(){var isMoveChild=tab3.arrItems[1].control.checked;var arr=tab3.arrItems[0].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));try{if(tab3.object.setEST(est,isMoveChild))tab3.hide();}catch(e){}});var tab4=this.createTab(4,"Set duration","t",true,this);tab4.addItem(1,"Duration",document.createElement("input"),"text",function(){tab4.arrItems[0].control.focus();});tab4.addItem(2,"Update",document.createElement("input"),"button",function(){var d=tab4.arrItems[0].control.value;try{if(tab4.object.setDuration(d))tab4.hide();}catch(e){}});var tab5=this.createTab(5,"Set % complete","t",true,this);tab5.addItem(1,"Percent Complete",document.createElement("input"),"text",function(){tab5.arrItems[0].control.focus();});tab5.addItem(2,"Update",document.createElement("input"),"button",function(){var p=tab5.arrItems[0].control.value;try{if(tab5.object.setPercentCompleted(p))tab5.hide();}catch(e){}});var tab13=this.createTab(13,"Set predecessor","t",true,this);tab13.addItem(1,"Predecessor",document.createElement("input"),"text",function(){tab13.arrItems[0].control.focus();});tab13.addItem(2,"Update",document.createElement("input"),"button",function(){var p=tab13.arrItems[0].control.value;try{if(tab13.object.setPredecessor(p))tab13.hide();}catch(e){}});var tab6=this.createTab(6,"Rename project","p",true,this);tab6.addItem(1,"New name",document.createElement("input"),"text",function(){tab6.arrItems[0].control.focus();});tab6.addItem(2,"Rename",document.createElement("input"),"button",function(){var name=tab6.arrItems[0].control.value;try{tab6.object.setName(name);tab6.hide();}catch(e){}});var tab7=this.createTab(7,"Delete project","p",true,this);tab7.addItem(1,"Delete",document.createElement("input"),"button",function(){try{tab7.object.Chart.deleteProject(tab7.object.Project.Id);tab7.hide();}catch(e){}});var tab8=this.createTab(8,"Set % complete","p",true,this);tab8.addItem(1,"Percent Complete",document.createElement("input"),"text",function(){tab8.arrItems[0].control.focus();});tab8.addItem(2,"Update",document.createElement("input"),"button",function(){var p=tab8.arrItems[0].control.value;try{if(tab8.object.setPercentCompleted(p))tab8.hide();}catch(e){}});var tab9=this.createTab(9,"Add new task","p",true,this);tab9.addItem(1,"Id",document.createElement("input"),"text",function(){tab9.arrItems[0].control.focus();});tab9.addItem(2,"Name",document.createElement("input"),"text",function(){tab9.arrItems[1].control.focus();});tab9.addItem(3,"EST",document.createElement("input"),"text",function(){tab9.arrItems[2].control.focus();});tab9.addItem(4,"Duration",document.createElement("input"),"text",function(){tab9.arrItems[3].control.focus();});tab9.addItem(5,"Percent complete",document.createElement("input"),"text",function(){tab9.arrItems[4].control.focus();});tab9.addItem(6,"Parent task id",document.createElement("input"),"text",function(){tab9.arrItems[5].control.focus();});tab9.addItem(7,"Pred task id",document.createElement("input"),"text",function(){tab9.arrItems[6].control.focus();});tab9.addItem(9,"Insert",document.createElement("input"),"button",function(){try{var id=tab9.arrItems[0].control.value;var name=tab9.arrItems[1].control.value;var arr=tab9.arrItems[2].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));var duration=tab9.arrItems[3].control.value;var pc=tab9.arrItems[4].control.value;var parentTaskId=tab9.arrItems[5].control.value;var predTaskId=tab9.arrItems[6].control.value;if(tab9.object.insertTask(id,name,est,duration,pc,predTaskId,parentTaskId))tab9.hide();}catch(e){}});var tab11=this.createTab(11,"Add successor task","t",true,this);tab11.addItem(1,"Id",document.createElement("input"),"text",function(){tab11.arrItems[0].control.focus();});tab11.addItem(2,"Name",document.createElement("input"),"text",function(){tab11.arrItems[1].control.focus();});tab11.addItem(3,"EST",document.createElement("input"),"text",function(){tab11.arrItems[2].control.focus();});tab11.addItem(4,"Duration",document.createElement("input"),"text",function(){tab11.arrItems[3].control.focus();});tab11.addItem(5,"Percent complete",document.createElement("input"),"text",function(){tab11.arrItems[4].control.focus();});tab11.addItem(6,"Insert",document.createElement("input"),"button",function(){try{var pr=tab11.object.Project;var id=tab11.arrItems[0].control.value;var name=tab11.arrItems[1].control.value;var arr=tab11.arrItems[2].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));var duration=tab11.arrItems[3].control.value;var pc=tab11.arrItems[4].control.value;var parentTaskId=(tab11.object.parentTask==null)?"":tab11.object.parentTask.TaskInfo.Id;var predTaskId=tab11.object.TaskInfo.Id;if(pr.insertTask(id,name,est,duration,pc,predTaskId,parentTaskId))tab11.hide();}catch(e){}});var tab10=this.createTab(10,"Add child task","t",true,this);tab10.addItem(1,"Id",document.createElement("input"),"text",function(){tab10.arrItems[0].control.focus();});tab10.addItem(2,"Name",document.createElement("input"),"text",function(){tab10.arrItems[1].control.focus();});tab10.addItem(3,"EST",document.createElement("input"),"text",function(){tab10.arrItems[2].control.focus();});tab10.addItem(4,"Duration",document.createElement("input"),"text",function(){tab10.arrItems[3].control.focus();});tab10.addItem(5,"Percent complete",document.createElement("input"),"text",function(){tab10.arrItems[4].control.focus();});tab10.addItem(6,"Insert",document.createElement("input"),"button",function(){try{var pr=tab10.object.Project;var id=tab10.arrItems[0].control.value;var name=tab10.arrItems[1].control.value;var arr=tab10.arrItems[2].control.value.split(".");var est=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));var duration=tab10.arrItems[3].control.value;var pc=tab10.arrItems[4].control.value;var parentTaskId=tab10.object.TaskInfo.Id;var predTaskId="";if(pr.insertTask(id,name,est,duration,pc,predTaskId,parentTaskId))tab10.hide();}catch(e){}});var tab12=this.createTab(12,"-Insert new project-","p",false,this);tab12.addItem(1,"Id",document.createElement("input"),"text",function(){tab12.arrItems[0].control.focus();});tab12.addItem(2,"Name",document.createElement("input"),"text",function(){tab12.arrItems[1].control.focus();});tab12.addItem(3,"Start date",document.createElement("input"),"text",function(){tab12.arrItems[2].control.focus();});tab12.addItem(4,"Insert",document.createElement("input"),"button",function(){try{var id=tab12.arrItems[0].control.value;var namePr=tab12.arrItems[1].control.value;var arr=tab12.arrItems[2].control.value.split(".");var startDatePr=(arr.length<3)?null:(new Date(arr[2],parseInt(arr[1])-1,arr[0]));if(self.Chart.insertProject(id,namePr,startDatePr))tab12.hide();}catch(e){}});};contextMenu.prototype.createHideDiv=function()
{this.hideDiv=document.createElement("div");this.hideDiv.style.position="absolute";this.hideDiv.style.left="0px";this.hideDiv.style.top="0px";this.Chart.content.appendChild(this.hideDiv);this.hideDiv.style.zIndex=12;this.hideDiv.style.display="none";this.hideDiv.style.background="#7D7E7D";this.hideDiv.style.cssText+=";-moz-opacity: 0.5;filter: alpha(opacity=50);opacity:.50;";this.hideDiv.style.width=this.Chart.content.offsetWidth+2+"px";this.hideDiv.style.height=this.Chart.content.offsetHeight+2+"px";};contextMenu.prototype.createMenuPanel=function()
{this.MenuPanel=document.createElement("div");this.MenuPanel.style.visibility="hidden";this.MenuPanel.style.cssText+=";z-index:10;";this.MenuPanel.style.position="absolute";this.Chart.content.appendChild(this.MenuPanel);this.MenuPanel.innerHTML="<table></table>";this.MenuPanel.firstChild.className="contextMenu";this.MenuPanel.firstChild.cellPadding=0;this.MenuPanel.firstChild.cellSpacing=0;this.MenuPanel.firstChild.style.cssText+=";background:url("+this.Chart.imgs+"menu/menu_bg.png);";};contextMenu.prototype.createTabPanel=function()
{this.tabPanel=document.createElement("div");this.tabPanel.style.visibility="hidden";this.tabPanel.style.zIndex="30";this.TabContainer.firstChild.rows[0].cells[0].appendChild(this.tabPanel);this.tabPanel.style.width="385px";this.tabPanel.style.height="290px";this.tabPanel.innerHTML="<table><tr><td></td></tr><tr><td></td></tr></table>";this.tabPanel.firstChild.cellPadding=0;this.tabPanel.firstChild.cellSpacing=0;this.tabPanel.firstChild.style.cssText="width:385px;border: 1px solid #808080;";this.tabPanel.firstChild.rows[0].cells[0].style.cssText=";height:26px;background:url("+this.Chart.imgs+"/menu/window_tr.png);background-repeat: no-repeat;color:#fff;font-size:14px;font-weight: bold;font-family: Tahoma, Arial";this.tabPanel.firstChild.rows[0].cells[0].align="center";this.tabPanel.firstChild.rows[1].cells[0].style.cssText=";height:270px;background:#F7F7F7;";this.tabPanel.firstChild.rows[1].cells[0].innerHTML="<table></table>";this.tabPanel.firstChild.rows[1].cells[0].firstChild.style.cssText="width:250px;font-size:11px;font-family:Tahoma,Arial;";this.tabPanel.firstChild.rows[1].cells[0].align="center";};contextMenu.prototype.addItemMenuPanel=function(tab)
{var self=this;var row=this.MenuPanel.firstChild.insertRow(this.MenuPanel.firstChild.rows.length);var cell=document.createElement('td');cell.innerHTML=tab.Description;cell.style.cssText="padding-left:10px;height:18px;";this.addEvent(cell,"mousedown",function(){tab.show();},false);cell.onmouseover=function(){this.style.background="url("+self.Chart.imgs+"menu/menu_selection.png)";};cell.onmouseout=function(){this.style.background="";};row.appendChild(cell);};contextMenu.prototype.showContextMenu=function(x,y,object)
{if(object.constructor==GanttTask)
{for(var i=0;i<this.arrTabs.length;i++){if(this.arrTabs[i].type=="t")
{this.arrTabs[i].object=object;this.addItemMenuPanel(this.arrTabs[i]);}}}else if(object.constructor==GanttProject)
{for(var i=0;i<this.arrTabs.length;i++){if(this.arrTabs[i].type=="p")
{this.arrTabs[i].object=object;this.addItemMenuPanel(this.arrTabs[i]);}}}
this.isShow=true;this.MenuPanel.style.cssText+=";z-index:15;";this.MenuPanel.style.visibility="visible";this.MenuPanel.style.top=parseInt(y)+this.Chart.heightTaskItem-this.Chart.oData.scrollTop+5+"px";this.MenuPanel.style.left=x;};contextMenu.prototype.hideContextMenu=function()
{this.isShow=false;this.MenuPanel.style.visibility="hidden";};contextMenu.prototype.clear=function()
{this.MenuPanel.removeChild(this.MenuPanel.firstChild);this.MenuPanel.innerHTML="<table></table>";this.MenuPanel.firstChild.className="contextMenu";this.MenuPanel.firstChild.cellPadding=0;this.MenuPanel.firstChild.cellSpacing=0;this.MenuPanel.firstChild.style.cssText+=";background:url("+this.Chart.imgs+"menu/menu_bg.png);";};contextMenu.prototype.createTab=function(id,desc,type,showOInfo,menu)
{var tab=new contextMenuTab(id,desc,type,showOInfo,menu);this.arrTabs.push(tab);return tab;};contextMenu.prototype.createTabContainer=function()
{this.TabContainer=document.createElement("div");this.TabContainer.style.position="absolute";this.TabContainer.style.top="0px";this.TabContainer.style.left="0px";this.TabContainer.style.visibility="hidden";this.TabContainer.style.zIndex="50";this.Chart.content.appendChild(this.TabContainer);this.TabContainer.innerHTML="<table><tr><td></td></tr></table>";this.TabContainer.firstChild.style.cssText=";width:100%;height:100%;";this.TabContainer.firstChild.rows[0].cells[0].align="center";this.TabContainer.style.width=this.Chart.content.offsetWidth+2+"px";this.TabContainer.style.height=this.Chart.content.offsetHeight+2+"px";};contextMenu.prototype.getTabById=function(id)
{for(var i=0;i<this.arrTabs.length;i++){if(this.arrTabs[i].Id==id){return this.arrTabs[i];}}
return null;};function contextMenuTab(id,description,type,showOInfo,contextMenu)
{this.Id=id;this.arrItems=[];this.TabItemContainer=null;this.Description=description;this.contextMenu=contextMenu;this.type=type;this.object=null;this.showObjectInfo=showOInfo;}
contextMenu.prototype.addEvent=function(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}
else if(elm.attachEvent){return elm.attachEvent('on'+evType,fn);}
else{elm['on'+evType]=fn;}};contextMenuTab.prototype.addItem=function(id,name,control,type,handler)
{if(handler){control.onclick=handler;}
control.type=type;if(type=="button")
{control.value=name;}
var tabItem=new contextMenuTabItem(id,name,control,this);this.arrItems.push(tabItem);};contextMenuTab.prototype.show=function()
{this.contextMenu.hideDiv.style.display="inline";this.contextMenu.TabContainer.style.visibility="visible";var self=this;this.contextMenu.tabPanel.firstChild.rows[0].cells[0].innerHTML=this.Description;this.contextMenu.tabPanel.style.visibility="visible";var t=this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild;var c,c2,r=null;if(this.showObjectInfo)
{if(this.object){if(this.object.constructor==GanttTask){this.insertData(t,"Id",this.object.TaskInfo.Id);this.insertData(t,"Name",this.object.TaskInfo.Name);this.insertData(t,"Duration",this.object.TaskInfo.Duration+" hrs");this.insertData(t,"Percent complete",this.object.TaskInfo.PercentCompleted+"%");this.insertData(t,"EST",this.object.TaskInfo.EST.getDate()+"."+(this.object.TaskInfo.EST.getMonth()+1)+"."+this.object.TaskInfo.EST.getFullYear());this.insertData(t,"Predecessor",this.object.TaskInfo.PredecessorTaskId);}else
{this.insertData(t,"Id",this.object.Project.Id);this.insertData(t,"Name",this.object.Project.Name);this.insertData(t,"Start date",this.object.Project.StartDate.getDate()+"."+(this.object.Project.StartDate.getMonth()+1)+"."+this.object.Project.StartDate.getFullYear());}}}
var btnCell=null;for(var i=0;i<this.arrItems.length;i++){if(this.arrItems[i].control.type=="button")
{r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);btnCell=r.insertCell(r.cells.length);btnCell.appendChild(this.arrItems[i].control);}else
{r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);c2=r.insertCell(r.cells.length);c.innerHTML=this.arrItems[i].Name;c2.appendChild(this.arrItems[i].control);}}
var b=document.createElement("input");b.type="button";b.value="Cancel";b.onclick=function()
{self.hide();};if(!btnCell){r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);btnCell=r.insertCell(r.cells.length);}else{b.style.marginLeft="10px";}
btnCell.appendChild(b);};contextMenuTab.prototype.hide=function()
{this.contextMenu.tabPanel.style.visibility="hidden";var t=this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild;t.parentNode.removeChild(t);this.contextMenu.tabPanel.firstChild.rows[1].cells[0].innerHTML="<table></table>";this.contextMenu.tabPanel.firstChild.rows[1].cells[0].firstChild.style.cssText="width:250px;font-size:11px;font-family:Tahoma,Arial;";this.contextMenu.hideDiv.style.display="none";this.contextMenu.TabContainer.style.visibility="hidden";};contextMenuTab.prototype.insertData=function(t,name,value)
{var c,c2,r=null;r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);c.style.cssText="width:100px";c.innerHTML=name;c2=r.insertCell(r.cells.length);c2.innerHTML=value;};contextMenuTab.prototype.insertControl=function(t,name,value)
{var c,c2,r=null;r=t.insertRow(t.rows.length);c=r.insertCell(r.cells.length);c.innerHTML=name;c2=r.insertCell(r.cells.length);c2.appendChild(value);};function contextMenuTabItem(id,name,control,tab)
{this.Id=id;this.Name=name;this.control=control;this.tab=tab;};openerp.web_gantt=function(instance){var _t=instance.web._t,_lt=instance.web._lt;var QWeb=instance.web.qweb;instance.web.views.add('gantt','instance.web_gantt.GanttView');instance.web_gantt.GanttView=instance.web.View.extend({display_name:_lt('Gantt'),template:"GanttView",view_type:"gantt",init:function(){var self=this;this._super.apply(this,arguments);this.has_been_loaded=$.Deferred();this.chart_id=_.uniqueId();},view_loading:function(r){return this.load_gantt(r);},load_gantt:function(fields_view_get,fields_get){var self=this;this.fields_view=fields_view_get;this.$el.addClass(this.fields_view.arch.attrs['class']);return self.alive(new instance.web.Model(this.dataset.model).call('fields_get')).then(function(fields){self.fields=fields;self.has_been_loaded.resolve();});},do_search:function(domains,contexts,group_bys){var self=this;self.last_domains=domains;self.last_contexts=contexts;self.last_group_bys=group_bys;var n_group_bys=[];if(this.fields_view.arch.attrs.default_group_by){n_group_bys=this.fields_view.arch.attrs.default_group_by.split(',');}
if(group_bys.length){n_group_bys=group_bys;}
var fields=_.compact(_.map(["date_start","date_delay","date_stop","progress"],function(key){return self.fields_view.arch.attrs[key]||'';}));fields=_.uniq(fields.concat(n_group_bys));return $.when(this.has_been_loaded).then(function(){return self.dataset.read_slice(fields,{domain:domains,context:contexts}).then(function(data){return self.on_data_loaded(data,n_group_bys);});});},reload:function(){if(this.last_domains!==undefined)
return this.do_search(this.last_domains,this.last_contexts,this.last_group_bys);},on_data_loaded:function(tasks,group_bys){var self=this;var ids=_.pluck(tasks,"id");return this.dataset.name_get(ids).then(function(names){var ntasks=_.map(tasks,function(task){return _.extend({__name:_.detect(names,function(name){return name[0]==task.id;})[1]},task);});return self.on_data_loaded_2(ntasks,group_bys);});},on_data_loaded_2:function(tasks,group_bys){var self=this;$(".oe_gantt",this.$el).html("");if(group_bys.length>0){group_bys=[group_bys[0]];}
if(group_bys.length==0){group_bys=["_pseudo_group_by"];_.each(tasks,function(el){el._pseudo_group_by="Gantt View";});this.fields._pseudo_group_by={type:"string"};}
var split_groups=function(tasks,group_bys){if(group_bys.length===0)
return tasks;var groups=[];_.each(tasks,function(task){var group_name=task[_.first(group_bys)];var group=_.find(groups,function(group){return _.isEqual(group.name,group_name);});if(group===undefined){group={name:group_name,tasks:[],__is_group:true};groups.push(group);}
group.tasks.push(task);});_.each(groups,function(group){group.tasks=split_groups(group.tasks,_.rest(group_bys));});return groups;}
var groups=split_groups(tasks,group_bys);var task_ids={};var generate_task_info=function(task,plevel){if(_.isNumber(task[self.fields_view.arch.attrs.progress])){var percent=task[self.fields_view.arch.attrs.progress]||0;}else{var percent=100;}
var level=plevel||0;if(task.__is_group){var task_infos=_.compact(_.map(task.tasks,function(sub_task){return generate_task_info(sub_task,level+1);}));if(task_infos.length==0)
return;var task_start=_.reduce(_.pluck(task_infos,"task_start"),function(date,memo){return memo===undefined||date<memo?date:memo;},undefined);var task_stop=_.reduce(_.pluck(task_infos,"task_stop"),function(date,memo){return memo===undefined||date>memo?date:memo;},undefined);var duration=(task_stop.getTime()-task_start.getTime())/(1000*60*60);var group_name=task.name?instance.web.format_value(task.name,self.fields[group_bys[level]]):"-";if(level==0){var group=new GanttProjectInfo(_.uniqueId("gantt_project_"),group_name,task_start);_.each(task_infos,function(el){group.addTask(el.task_info);});return group;}else{var group=new GanttTaskInfo(_.uniqueId("gantt_project_task_"),group_name,task_start,duration||1,percent);_.each(task_infos,function(el){group.addChildTask(el.task_info);});return{task_info:group,task_start:task_start,task_stop:task_stop};}}else{var task_name=task.__name;var task_start=instance.web.auto_str_to_date(task[self.fields_view.arch.attrs.date_start]);if(!task_start)
return;var task_stop;if(self.fields_view.arch.attrs.date_stop){task_stop=instance.web.auto_str_to_date(task[self.fields_view.arch.attrs.date_stop]);if(!task_stop)
task_stop=task_start;}else{var tmp=instance.web.format_value(task[self.fields_view.arch.attrs.date_delay],self.fields[self.fields_view.arch.attrs.date_delay]);if(!tmp)
return;task_stop=task_start.clone().addMilliseconds(tmp*60*60*1000);}
var duration=(task_stop.getTime()-task_start.getTime())/(1000*60*60);var id=_.uniqueId("gantt_task_");var task_info=new GanttTaskInfo(id,task_name,task_start,((duration/24)*8)||1,percent);task_info.internal_task=task;task_ids[id]=task_info;return{task_info:task_info,task_start:task_start,task_stop:task_stop};}}
var gantt=new GanttChart();_.each(_.compact(_.map(groups,function(e){return generate_task_info(e,0);})),function(project){gantt.addProject(project);});gantt.setEditable(true);gantt.setImagePath("/web_gantt/static/lib/dhtmlxGantt/codebase/imgs/");gantt.attachEvent("onTaskEndDrag",function(task){self.on_task_changed(task);});gantt.attachEvent("onTaskEndResize",function(task){self.on_task_changed(task);});gantt.create(this.chart_id);$(".taskNameItem",self.$el).click(function(event){var task_info=task_ids[event.target.id];if(task_info){self.on_task_display(task_info.internal_task);}});if(this.is_action_enabled('create')){var td=$($("table td",self.$el)[0]);var rendered=QWeb.render("GanttView-create-button");$(rendered).prependTo(td);$(".oe_gantt_button_create",this.$el).click(this.on_task_create);}
this.$el.find(".oe_gantt td:first > div, .oe_gantt td:eq(1) > div > div").css("overflow","");},on_task_changed:function(task_obj){var self=this;var itask=task_obj.TaskInfo.internal_task;var start=task_obj.getEST();var duration=(task_obj.getDuration()/8)*24;var end=start.clone().addMilliseconds(duration*60*60*1000);var data={};data[self.fields_view.arch.attrs.date_start]=instance.web.auto_date_to_str(start,self.fields[self.fields_view.arch.attrs.date_start].type);if(self.fields_view.arch.attrs.date_stop){data[self.fields_view.arch.attrs.date_stop]=instance.web.auto_date_to_str(end,self.fields[self.fields_view.arch.attrs.date_stop].type);}else{data[self.fields_view.arch.attrs.date_delay]=duration;}
this.dataset.write(itask.id,data);},on_task_display:function(task){var self=this;var pop=new instance.web.form.FormOpenPopup(self);pop.on('write_completed',self,self.reload);pop.show_element(self.dataset.model,task.id,null,{});},on_task_create:function(){var self=this;var pop=new instance.web.form.SelectCreatePopup(this);pop.on("elements_selected",self,function(){self.reload();});pop.select_element(self.dataset.model,{initial_view:"form",});},});};;(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);;function openerp_pos_db(instance,module){module.PosLS=instance.web.Class.extend({name:'openerp_pos_ls',limit:100,init:function(options){options=options||{};this.name=options.name||this.name;this.limit=options.limit||this.limit;this.cache={};this.product_by_id={};this.product_by_ean13={};this.product_by_category_id={};this.category_by_id={};this.root_category_id=0;this.category_products={};this.category_ancestors={};this.category_childs={};this.category_parent={};this.category_search_string={};this.packagings_by_id={};this.packagings_by_product_id={};this.packagings_by_ean13={};},get_category_by_id:function(categ_id){if(categ_id instanceof Array){var list=[];for(var i=0,len=categ_id.length;i<len;i++){var cat=this.category_by_id[categ_id[i]];if(cat){list.push(cat);}else{console.error("get_category_by_id: no category has id:",categ_id[i]);}}
return list;}else{return this.category_by_id[categ_id];}},get_category_childs_ids:function(categ_id){return this.category_childs[categ_id]||[];},get_category_ancestors_ids:function(categ_id){return this.category_ancestors[categ_id]||[];},get_category_parent_id:function(categ_id){return this.category_parent[categ_id]||this.root_category_id;},add_categories:function(categories){var self=this;if(!this.category_by_id[this.root_category_id]){this.category_by_id[this.root_category_id]={id:this.root_category_id,name:'Root',};}
for(var i=0,len=categories.length;i<len;i++){this.category_by_id[categories[i].id]=categories[i];}
for(var i=0,len=categories.length;i<len;i++){var cat=categories[i];var parent_id=cat.parent_id[0]||this.root_category_id;this.category_parent[cat.id]=cat.parent_id[0];if(!this.category_childs[parent_id]){this.category_childs[parent_id]=[];}
this.category_childs[parent_id].push(cat.id);}
function make_ancestors(cat_id,ancestors){self.category_ancestors[cat_id]=ancestors;ancestors=ancestors.slice(0);ancestors.push(cat_id);var childs=self.category_childs[cat_id]||[];for(var i=0,len=childs.length;i<len;i++){make_ancestors(childs[i],ancestors);}}
make_ancestors(this.root_category_id,[]);},load:function(store,deft){if(this.cache[store]!==undefined){return this.cache[store];}
var data=localStorage[this.name+'_'+store];if(data!==undefined){data=JSON.parse(data);this.cache[store]=data;return data;}else{return deft;}},save:function(store,data){var str_data=JSON.stringify(data);localStorage[this.name+'_'+store]=JSON.stringify(data);this.cache[store]=data;},_product_search_string:function(product){var str=''+product.id+':'+product.name;if(product.ean13){str+='|'+product.ean13;}
var packagings=this.packagings_by_product_id[product.id]||[];for(var i=0;i<packagings.length;i++){str+='|'+packagings[i].ean;}
return str+'\n';},add_products:function(products){var stored_categories=this.product_by_category_id;if(!products instanceof Array){products=[products];}
for(var i=0,len=products.length;i<len;i++){var product=products[i];var search_string=this._product_search_string(product);var categ_id=product.pos_categ_id?product.pos_categ_id[0]:this.root_category_id;if(!stored_categories[categ_id]){stored_categories[categ_id]=[];}
stored_categories[categ_id].push(product.id);if(this.category_search_string[categ_id]===undefined){this.category_search_string[categ_id]='';}
this.category_search_string[categ_id]+=search_string;var ancestors=this.get_category_ancestors_ids(categ_id)||[];for(var j=0;j<ancestors.length;j++){var ancestor=ancestors[j];if(!stored_categories[ancestor]){stored_categories[ancestor]=[];}
stored_categories[ancestor].push(product.id);if(this.category_search_string[ancestor]===undefined){this.category_search_string[ancestor]='';}
this.category_search_string[ancestor]+=search_string;}
this.product_by_id[product.id]=product;if(product.ean13){this.product_by_ean13[product.ean13]=product;}}},add_packagings:function(packagings){for(var i=0,len=packagings.length;i<len;i++){var pack=packagings[i];this.packagings_by_id[pack.id]=pack;if(!this.packagings_by_product_id[pack.product_id[0]]){this.packagings_by_product_id[pack.product_id[0]]=[];}
this.packagings_by_product_id[pack.product_id[0]].push(pack);if(pack.ean13){this.packagings_by_ean13[pack.ean13]=pack;}}},clear:function(stores){for(var i=0,len=arguments.length;i<len;i++){localStorage.removeItem(this.name+'_'+arguments[i]);}},_count_props:function(obj){var count=0;for(var prop in obj){if(obj.hasOwnProperty(prop)){count++;}}
return count;},get_product_by_id:function(id){return this.product_by_id[id];},get_product_by_ean13:function(ean13){if(this.product_by_ean13[ean13]){return this.product_by_ean13[ean13];}
var pack=this.packagings_by_ean13[ean13];if(pack){return this.product_by_id[pack.product_id[0]];}
return undefined;},get_product_by_category:function(category_id){var product_ids=this.product_by_category_id[category_id];var list=[];if(product_ids){for(var i=0,len=Math.min(product_ids.length,this.limit);i<len;i++){list.push(this.product_by_id[product_ids[i]]);}}
return list;},search_product_in_category:function(category_id,query){var re=RegExp("([0-9]+):.*?"+query,"gi");var results=[];for(var i=0;i<this.limit;i++){r=re.exec(this.category_search_string[category_id]);if(r){var id=Number(r[1]);results.push(this.get_product_by_id(id));}else{break;}}
return results;},add_order:function(order){var last_id=this.load('last_order_id',0);var orders=this.load('orders',[]);orders.push({id:last_id+1,data:order});this.save('last_order_id',last_id+1);this.save('orders',orders);},remove_order:function(order_id){var orders=this.load('orders',[]);orders=_.filter(orders,function(order){return order.id!==order_id;});this.save('orders',orders);},get_orders:function(){return this.load('orders',[]);},});};function openerp_pos_models(instance,module){var QWeb=instance.web.qweb;function round(value,decimals){var mult=Math.pow(10,decimals||0);return Math.round(value*mult)/mult;}
window.round=round;function round_pr(value,precision){if(!precision||precision<0){throw new Error('round_pr(): needs a precision greater than zero, got '+precision+' instead');}
return Math.round(value/precision)*precision;}
window.round_pr=round_pr;module.PosModel=Backbone.Model.extend({initialize:function(session,attributes){Backbone.Model.prototype.initialize.call(this,attributes);var self=this;this.session=session;this.ready=$.Deferred();this.flush_mutex=new $.Mutex();this.barcode_reader=new module.BarcodeReader({'pos':this});this.proxy=new module.ProxyDevice();this.db=new module.PosLS();this.db.clear('products','categories');this.debug=jQuery.deparam(jQuery.param.querystring()).debug!==undefined;this.set({'nbr_pending_operations':0,'currency':{symbol:'$',position:'after'},'shop':null,'company':null,'user':null,'user_list':null,'partner_list':null,'cashier':null,'orders':new module.OrderCollection(),'products':new module.ProductCollection(),'cashRegisters':null,'bank_statements':null,'taxes':null,'pos_session':null,'pos_config':null,'units':null,'units_by_id':null,'selectedOrder':null,});this.get('orders').bind('remove',function(){self.on_removed_order();});$.when(this.load_server_data()).done(function(){self.ready.resolve();}).fail(function(){self.ready.reject();});},fetch:function(model,fields,domain,ctx){return new instance.web.Model(model).query(fields).filter(domain).context(ctx).all()},load_server_data:function(){var self=this;var loaded=self.fetch('res.users',['name','company_id'],[['id','=',this.session.uid]]).then(function(users){self.set('user',users[0]);return self.fetch('res.company',['currency_id','email','website','company_registry','vat','name','phone','partner_id',],[['id','=',users[0].company_id[0]]]);}).then(function(companies){self.set('company',companies[0]);return self.fetch('res.partner',['contact_address'],[['id','=',companies[0].partner_id[0]]]);}).then(function(company_partners){self.get('company').contact_address=company_partners[0].contact_address;return self.fetch('res.currency',['symbol','position','rounding','accuracy'],[['id','=',self.get('company').currency_id[0]]]);}).then(function(currencies){console.log('Currency:',currencies[0]);self.set('currency',currencies[0]);return self.fetch('product.uom',null,null);}).then(function(units){self.set('units',units);var units_by_id={};for(var i=0,len=units.length;i<len;i++){units_by_id[units[i].id]=units[i];}
self.set('units_by_id',units_by_id);return self.fetch('product.packaging',null,null);}).then(function(packagings){self.set('product.packaging',packagings);return self.fetch('res.users',['name','ean13'],[['ean13','!=',false]]);}).then(function(users){self.set('user_list',users);return self.fetch('res.partner',['name','ean13'],[['ean13','!=',false]]);}).then(function(partners){self.set('partner_list',partners);return self.fetch('account.tax',['amount','price_include','type']);}).then(function(taxes){self.set('taxes',taxes);return self.fetch('pos.session',['id','journal_ids','name','user_id','config_id','start_at','stop_at'],[['state','=','opened'],['user_id','=',self.session.uid]]);}).then(function(sessions){self.set('pos_session',sessions[0]);return self.fetch('pos.config',['name','journal_ids','shop_id','journal_id','iface_self_checkout','iface_led','iface_cashdrawer','iface_payment_terminal','iface_electronic_scale','iface_barscan','iface_vkeyboard','iface_print_via_proxy','iface_cashdrawer','state','sequence_id','session_ids'],[['id','=',self.get('pos_session').config_id[0]]]);}).then(function(configs){var pos_config=configs[0];self.set('pos_config',pos_config);self.iface_electronic_scale=!!pos_config.iface_electronic_scale;self.iface_print_via_proxy=!!pos_config.iface_print_via_proxy;self.iface_vkeyboard=!!pos_config.iface_vkeyboard;self.iface_self_checkout=!!pos_config.iface_self_checkout;self.iface_cashdrawer=!!pos_config.iface_cashdrawer;return self.fetch('sale.shop',[],[['id','=',pos_config.shop_id[0]]]);}).then(function(shops){self.set('shop',shops[0]);return self.fetch('product.packaging',['ean','product_id']);}).then(function(packagings){self.db.add_packagings(packagings);return self.fetch('pos.category',['id','name','parent_id','child_id','image'])}).then(function(categories){self.db.add_categories(categories);return self.fetch('product.product',['name','list_price','price','pos_categ_id','taxes_id','ean13','to_weight','uom_id','uos_id','uos_coeff','mes_type','description_sale','description'],[['sale_ok','=',true],['available_in_pos','=',true]],{pricelist:self.get('shop').pricelist_id[0]});}).then(function(products){self.db.add_products(products);return self.fetch('account.bank.statement',['account_id','currency','journal_id','state','name','user_id','pos_session_id'],[['state','=','open'],['pos_session_id','=',self.get('pos_session').id]]);}).then(function(bank_statements){var journals=new Array();_.each(bank_statements,function(statement){journals.push(statement.journal_id[0])});self.set('bank_statements',bank_statements);return self.fetch('account.journal',undefined,[['id','in',journals]]);}).then(function(journals){self.set('journals',journals);var bank_statements=self.get('bank_statements');for(var i=0,ilen=bank_statements.length;i<ilen;i++){for(var j=0,jlen=journals.length;j<jlen;j++){if(bank_statements[i].journal_id[0]===journals[j].id){bank_statements[i].journal=journals[j];bank_statements[i].self_checkout_payment_method=journals[j].self_checkout_payment_method;}}}
self.set({'cashRegisters':new module.CashRegisterCollection(self.get('bank_statements'))});});return loaded;},log_loaded_data:function(){console.log('PosModel data has been loaded:');console.log('PosModel: units:',this.get('units'));console.log('PosModel: bank_statements:',this.get('bank_statements'));console.log('PosModel: journals:',this.get('journals'));console.log('PosModel: taxes:',this.get('taxes'));console.log('PosModel: pos_session:',this.get('pos_session'));console.log('PosModel: pos_config:',this.get('pos_config'));console.log('PosModel: cashRegisters:',this.get('cashRegisters'));console.log('PosModel: shop:',this.get('shop'));console.log('PosModel: company:',this.get('company'));console.log('PosModel: currency:',this.get('currency'));console.log('PosModel: user_list:',this.get('user_list'));console.log('PosModel: user:',this.get('user'));console.log('PosModel.session:',this.session);console.log('PosModel end of data log.');},on_removed_order:function(removed_order){if(this.get('orders').isEmpty()){this.add_new_order();}
if(this.get('selectedOrder')===removed_order){this.set({selectedOrder:this.get('orders').last()});}},push_order:function(record){this.db.add_order(record);this.flush();},add_new_order:function(){var order=new module.Order({pos:this});this.get('orders').add(order);this.set('selectedOrder',order);},flush:function(){this._flush(0);},_flush:function(index){var self=this;var orders=this.db.get_orders();self.set('nbr_pending_operations',orders.length);var order=orders[index];if(!order){return;}
(new instance.web.Model('pos.order')).get_func('create_from_ui')([order]).fail(function(unused,event){event.preventDefault();console.error('Failed to send order:',order);self._flush(index+1);}).done(function(){self.db.remove_order(order.id);self._flush(index);});},scan_product:function(parsed_ean){var self=this;var product=this.db.get_product_by_ean13(parsed_ean.base_ean);var selectedOrder=this.get('selectedOrder');if(!product){return false;}
if(parsed_ean.type==='price'){selectedOrder.addProduct(new module.Product(product),{price:parsed_ean.value});}else if(parsed_ean.type==='weight'){selectedOrder.addProduct(new module.Product(product),{quantity:parsed_ean.value,merge:false});}else{selectedOrder.addProduct(new module.Product(product));}
return true;},});module.CashRegister=Backbone.Model.extend({});module.CashRegisterCollection=Backbone.Collection.extend({model:module.CashRegister,});module.Product=Backbone.Model.extend({get_image_url:function(){return instance.session.url('/web/binary/image',{model:'product.product',field:'image',id:this.get('id')});},});module.ProductCollection=Backbone.Collection.extend({model:module.Product,});module.Orderline=Backbone.Model.extend({initialize:function(attr,options){this.pos=options.pos;this.order=options.order;this.product=options.product;this.price=options.product.get('price');this.quantity=1;this.quantityStr='1';this.discount=0;this.discountStr='0';this.type='unit';this.selected=false;},set_discount:function(discount){var disc=Math.min(Math.max(parseFloat(discount)||0,0),100);this.discount=disc;this.discountStr=''+disc;this.trigger('change');},get_discount:function(){return this.discount;},get_discount_str:function(){return this.discountStr;},get_product_type:function(){return this.type;},set_quantity:function(quantity){if(quantity==='remove'){this.order.removeOrderline(this);return;}else{var quant=Math.max(parseFloat(quantity)||0,0);var unit=this.get_unit();if(unit){this.quantity=Math.max(unit.rounding,Math.round(quant/unit.rounding)*unit.rounding);this.quantityStr=this.quantity.toFixed(Math.max(0,Math.ceil(Math.log(1.0/unit.rounding)/Math.log(10))));}else{this.quantity=quant;this.quantityStr=''+this.quantity;}}
this.trigger('change');},get_quantity:function(){return this.quantity;},get_quantity_str:function(){return this.quantityStr;},get_quantity_str_with_unit:function(){var unit=this.get_unit();if(unit&&unit.name!=='Unit(s)'){return this.quantityStr+' '+unit.name;}else{return this.quantityStr;}},get_unit:function(){var unit_id=(this.product.get('uos_id')||this.product.get('uom_id'));if(!unit_id){return undefined;}
unit_id=unit_id[0];if(!this.pos){return undefined;}
return this.pos.get('units_by_id')[unit_id];},get_product:function(){return this.product;},set_selected:function(selected){this.selected=selected;this.trigger('change');},is_selected:function(){return this.selected;},can_be_merged_with:function(orderline){if(this.get_product().get('id')!==orderline.get_product().get('id')){return false;}else if(this.get_product_type()!==orderline.get_product_type()){return false;}else if(this.get_discount()>0){return false;}else if(this.price!==orderline.price){return false;}else{return true;}},merge:function(orderline){this.set_quantity(this.get_quantity()+orderline.get_quantity());},export_as_JSON:function(){return{qty:this.get_quantity(),price_unit:this.get_unit_price(),discount:this.get_discount(),product_id:this.get_product().get('id'),};},export_for_printing:function(){return{quantity:this.get_quantity(),unit_name:this.get_unit().name,price:this.get_unit_price(),discount:this.get_discount(),product_name:this.get_product().get('name'),price_display:this.get_display_price(),price_with_tax:this.get_price_with_tax(),price_without_tax:this.get_price_without_tax(),tax:this.get_tax(),product_description:this.get_product().get('description'),product_description_sale:this.get_product().get('description_sale'),};},set_unit_price:function(price){this.price=round(parseFloat(price)||0,2);this.trigger('change');},get_unit_price:function(){var rounding=this.pos.get('currency').rounding;return round_pr(this.price,rounding);},get_display_price:function(){var rounding=this.pos.get('currency').rounding;return round_pr(round_pr(this.get_unit_price()*this.get_quantity(),rounding)*(1-this.get_discount()/100.0),rounding);},get_price_without_tax:function(){return this.get_all_prices().priceWithoutTax;},get_price_with_tax:function(){return this.get_all_prices().priceWithTax;},get_tax:function(){return this.get_all_prices().tax;},get_all_prices:function(){var self=this;var currency_rounding=this.pos.get('currency').rounding;var base=round_pr(this.get_quantity()*this.get_unit_price()*(1.0-(this.get_discount()/100.0)),currency_rounding);var totalTax=base;var totalNoTax=base;var product_list=this.pos.get('product_list');var product=this.get_product();var taxes_ids=product.get('taxes_id');;var taxes=self.pos.get('taxes');var taxtotal=0;_.each(taxes_ids,function(el){var tax=_.detect(taxes,function(t){return t.id===el;});if(tax.price_include){var tmp;if(tax.type==="percent"){tmp=base-round_pr(base/(1+tax.amount),currency_rounding);}else if(tax.type==="fixed"){tmp=round_pr(tax.amount*self.get_quantity(),currency_rounding);}else{throw"This type of tax is not supported by the point of sale: "+tax.type;}
tmp=round_pr(tmp,currency_rounding);taxtotal+=tmp;totalNoTax-=tmp;}else{var tmp;if(tax.type==="percent"){tmp=tax.amount*base;}else if(tax.type==="fixed"){tmp=tax.amount*self.get_quantity();}else{throw"This type of tax is not supported by the point of sale: "+tax.type;}
tmp=round_pr(tmp,currency_rounding);taxtotal+=tmp;totalTax+=tmp;}});return{"priceWithTax":totalTax,"priceWithoutTax":totalNoTax,"tax":taxtotal,};},});module.OrderlineCollection=Backbone.Collection.extend({model:module.Orderline,});module.Paymentline=Backbone.Model.extend({initialize:function(attributes,options){this.amount=0;this.cashregister=options.cashRegister;},set_amount:function(value){this.amount=parseFloat(value)||0;this.trigger('change');},get_amount:function(){return this.amount;},get_cashregister:function(){return this.cashregister;},export_as_JSON:function(){return{name:instance.web.datetime_to_str(new Date()),statement_id:this.cashregister.get('id'),account_id:(this.cashregister.get('account_id'))[0],journal_id:(this.cashregister.get('journal_id'))[0],amount:this.get_amount()};},export_for_printing:function(){return{amount:this.get_amount(),journal:this.cashregister.get('journal_id')[1],};},});module.PaymentlineCollection=Backbone.Collection.extend({model:module.Paymentline,});module.Order=Backbone.Model.extend({initialize:function(attributes){Backbone.Model.prototype.initialize.apply(this,arguments);this.set({creationDate:new Date(),orderLines:new module.OrderlineCollection(),paymentLines:new module.PaymentlineCollection(),name:"Order "+this.generateUniqueId(),client:null,});this.pos=attributes.pos;this.selected_orderline=undefined;this.screen_data={};this.receipt_type='receipt';return this;},generateUniqueId:function(){return new Date().getTime();},addProduct:function(product,options){options=options||{};var attr=product.toJSON();attr.pos=this.pos;attr.order=this;var line=new module.Orderline({},{pos:this.pos,order:this,product:product});if(options.quantity!==undefined){line.set_quantity(options.quantity);}
if(options.price!==undefined){line.set_unit_price(options.price);}
var last_orderline=this.getLastOrderline();if(last_orderline&&last_orderline.can_be_merged_with(line)&&options.merge!==false){last_orderline.merge(line);}else{this.get('orderLines').add(line);}
this.selectLine(this.getLastOrderline());},removeOrderline:function(line){this.get('orderLines').remove(line);this.selectLine(this.getLastOrderline());},getLastOrderline:function(){return this.get('orderLines').at(this.get('orderLines').length-1);},addPaymentLine:function(cashRegister){var paymentLines=this.get('paymentLines');var newPaymentline=new module.Paymentline({},{cashRegister:cashRegister});if(cashRegister.get('journal').type!=='cash'){newPaymentline.set_amount(this.getDueLeft());}
paymentLines.add(newPaymentline);},getName:function(){return this.get('name');},getSubtotal:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_display_price();}),0);},getTotalTaxIncluded:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_price_with_tax();}),0);},getDiscountTotal:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+(orderLine.get_unit_price()*(orderLine.get_discount()/100)*orderLine.get_quantity());}),0);},getTotalTaxExcluded:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_price_without_tax();}),0);},getTax:function(){return(this.get('orderLines')).reduce((function(sum,orderLine){return sum+orderLine.get_tax();}),0);},getPaidTotal:function(){return(this.get('paymentLines')).reduce((function(sum,paymentLine){return sum+paymentLine.get_amount();}),0);},getChange:function(){return this.getPaidTotal()-this.getTotalTaxIncluded();},getDueLeft:function(){return this.getTotalTaxIncluded()-this.getPaidTotal();},set_receipt_type:function(type){this.receipt_type=type;},get_receipt_type:function(){return this.receipt_type;},set_client:function(client){this.set('client',client);},get_client:function(){return this.get('client');},get_client_name:function(){var client=this.get('client');return client?client.name:"";},set_screen_data:function(key,value){if(arguments.length===2){this.screen_data[key]=value;}else if(arguments.length===1){for(key in arguments[0]){this.screen_data[key]=arguments[0][key];}}},get_screen_data:function(key){return this.screen_data[key];},export_for_printing:function(){var orderlines=[];this.get('orderLines').each(function(orderline){orderlines.push(orderline.export_for_printing());});var paymentlines=[];this.get('paymentLines').each(function(paymentline){paymentlines.push(paymentline.export_for_printing());});var client=this.get('client');var cashier=this.pos.get('cashier')||this.pos.get('user');var company=this.pos.get('company');var shop=this.pos.get('shop');var date=new Date();return{orderlines:orderlines,paymentlines:paymentlines,subtotal:this.getSubtotal(),total_with_tax:this.getTotalTaxIncluded(),total_without_tax:this.getTotalTaxExcluded(),total_tax:this.getTax(),total_paid:this.getPaidTotal(),total_discount:this.getDiscountTotal(),change:this.getChange(),name:this.getName(),client:client?client.name:null,invoice_id:null,cashier:cashier?cashier.name:null,date:{year:date.getFullYear(),month:date.getMonth(),date:date.getDate(),day:date.getDay(),hour:date.getHours(),minute:date.getMinutes()},company:{email:company.email,website:company.website,company_registry:company.company_registry,contact_address:company.contact_address,vat:company.vat,name:company.name,phone:company.phone,},shop:{name:shop.name,},currency:this.pos.get('currency'),};},exportAsJSON:function(){var orderLines,paymentLines;orderLines=[];(this.get('orderLines')).each(_.bind(function(item){return orderLines.push([0,0,item.export_as_JSON()]);},this));paymentLines=[];(this.get('paymentLines')).each(_.bind(function(item){return paymentLines.push([0,0,item.export_as_JSON()]);},this));return{name:this.getName(),amount_paid:this.getPaidTotal(),amount_total:this.getTotalTaxIncluded(),amount_tax:this.getTax(),amount_return:this.getChange(),lines:orderLines,statement_ids:paymentLines,pos_session_id:this.pos.get('pos_session').id,partner_id:this.pos.get('client')?this.pos.get('client').id:undefined,user_id:this.pos.get('cashier')?this.pos.get('cashier').id:this.pos.get('user').id,};},getSelectedLine:function(){return this.selected_orderline;},selectLine:function(line){if(line){if(line!==this.selected_orderline){if(this.selected_orderline){this.selected_orderline.set_selected(false);}
this.selected_orderline=line;this.selected_orderline.set_selected(true);}}else{this.selected_orderline=undefined;}},});module.OrderCollection=Backbone.Collection.extend({model:module.Order,});module.NumpadState=Backbone.Model.extend({defaults:{buffer:"0",mode:"quantity"},appendNewChar:function(newChar){var oldBuffer;oldBuffer=this.get('buffer');if(oldBuffer==='0'){this.set({buffer:newChar});}else if(oldBuffer==='-0'){this.set({buffer:"-"+newChar});}else{this.set({buffer:(this.get('buffer'))+newChar});}
this.trigger('set_value',this.get('buffer'));},deleteLastChar:function(){if(this.get('buffer')===""){if(this.get('mode')==='quantity'){this.trigger('set_value','remove');}else{this.trigger('set_value',this.get('buffer'));}}else{var newBuffer=this.get('buffer').slice(0,-1)||"";this.set({buffer:newBuffer});this.trigger('set_value',this.get('buffer'));}},switchSign:function(){var oldBuffer;oldBuffer=this.get('buffer');this.set({buffer:oldBuffer[0]==='-'?oldBuffer.substr(1):"-"+oldBuffer});this.trigger('set_value',this.get('buffer'));},changeMode:function(newMode){this.set({buffer:"0",mode:newMode});},reset:function(){this.set({buffer:"0",mode:"quantity"});},resetValue:function(){this.set({buffer:'0'});},});};function openerp_pos_basewidget(instance,module){module.PosBaseWidget=instance.web.Widget.extend({init:function(parent,options){this._super(parent);options=options||{};this.pos=options.pos||(parent?parent.pos:undefined);this.pos_widget=options.pos_widget||(parent?parent.pos_widget:undefined);this.build_currency_template();},build_currency_template:function(){if(this.pos&&this.pos.get('currency')){this.currency=this.pos.get('currency');}else{this.currency={symbol:'$',position:'after',rounding:0.01};}
var decimals=Math.max(0,Math.ceil(Math.log(1.0/this.currency.rounding)/Math.log(10)));this.format_currency=function(amount){if(typeof amount==='number'){amount=Math.round(amount*100)/100;amount=amount.toFixed(decimals);}
if(this.currency.position==='after'){return amount+' '+this.currency.symbol;}else{return this.currency.symbol+' '+amount;}}},show:function(){this.$el.show();},hide:function(){this.$el.hide();},});};function openerp_pos_keyboard(instance,module){module.OnscreenKeyboardWidget=instance.web.Widget.extend({template:'OnscreenKeyboardSimple',init:function(parent,options){var self=this;this._super(parent,options);options=options||{};this.keyboard_model=options.keyboard_model||'full';if(this.keyboard_model==='full'){this.template='OnscreenKeyboardFull';}
this.input_selector=options.input_selector||'.searchbox input';$(this.input_selector).focus(function(){self.show();});this.capslock=false;this.shift=false;this.numlock=false;},connect:function(){var self=this;$(this.input_selector).focus(function(){self.show();});},writeCharacter:function(character){var $input=$(this.input_selector);$input[0].value+=character;$input.keydown();$input.keyup();},sendReturn:function(){},deleteCharacter:function(){var $input=$(this.input_selector);var input_value=$input[0].value;$input[0].value=input_value.substr(0,input_value.length-1);$input.keydown();$input.keyup();},deleteAllCharacters:function(){var $input=$(this.input_selector);$input[0].value="";$input.keydown();$input.keyup();},show:function(){$('.keyboard_frame').show().animate({'height':'235px'},500,'swing');},hide:function(){var self=this;var frame=$('.keyboard_frame');frame.animate({'height':'0'},500,'swing',function(){frame.hide();self.reset();});},toggleShift:function(){$('.letter').toggleClass('uppercase');$('.symbol span').toggle();self.shift=(self.shift===true)?false:true;self.capslock=false;},toggleCapsLock:function(){$('.letter').toggleClass('uppercase');self.capslock=true;},toggleNumLock:function(){$('.symbol span').toggle();$('.numlock span').toggle();self.numlock=(self.numlock===true)?false:true;},removeShift:function(){if(self.shift===true){$('.symbol span').toggle();if(this.capslock===false)$('.letter').toggleClass('uppercase');self.shift=false;}},reset:function(){if(this.shift){this.toggleShift();}
if(this.capslock){this.toggleCapsLock();}
if(this.numlock){this.toggleNumLock();}},start:function(){var self=this;$('.close_button').click(function(){self.deleteAllCharacters();self.hide();});$('.keyboard li').click(function(){var $this=$(this),character=$this.html();if($this.hasClass('left-shift')||$this.hasClass('right-shift')){self.toggleShift();return false;}
if($this.hasClass('capslock')){self.toggleCapsLock();return false;}
if($this.hasClass('delete')){self.deleteCharacter();return false;}
if($this.hasClass('numlock')){self.toggleNumLock();return false;}
if($this.hasClass('symbol'))character=$('span:visible',$this).html();if($this.hasClass('space'))character=' ';if($this.hasClass('tab'))character="\t";if($this.hasClass('return'))character="\n";if($this.hasClass('uppercase'))character=character.toUpperCase();self.removeShift();self.writeCharacter(character);});},});};function openerp_pos_scrollbar(instance,module){module.ScrollbarWidget=instance.web.Widget.extend({template:'ScrollbarWidget',init:function(parent,options){var self=this;options=options||{};this._super(parent,options);this.target_widget=options.target_widget;this.target_selector=options.target_selector;this.scroll_target=this.target().scrollTop();this.scroll_step=options.step||0.8;this.scroll_duration=options.duration||250;this.wheel_step=options.wheel_step||80;this.name=options.name||'unnamed';this.bottom=false;this.track_bottom=options.track_bottom||false;this.on_show=options.on_show||function(){};this.on_hide=options.on_hide||function(){};this.resize_handler=function(){setTimeout(function(){if(self.bottom&&self.track_bottom){self.set_position(Number.MAX_VALUE);}
self.update_scroller_dimensions();self.update_button_status();self.auto_hide(false);},0);};this.target_mousewheel_handler=function(event,delta){self.scroll(delta*self.wheel_step);}},renderElement:function(){this._super();var self=this;this.$('.up-button').off('click').click(function(){self.page_up();});this.$('.down-button').off('click').click(function(){self.page_down();});this.update_scroller_dimensions(false);this.update_button_status();this.auto_hide(false);this.$el.bind('mousewheel',function(event,delta){self.scroll(delta*self.wheel_step);return false;});this.$el.bind('click',function(event){var vpos=event.pageY-self.$el.offset().top;var spos=self.scroller_dimensions();if(vpos>spos.bar_pos&&vpos<spos.pos){self.page_up();}else if((vpos<spos.bar_pos+spos.bar_height)&&(vpos>spos.pos+spos.height)){self.page_down();}});$(window).unbind('resize',this.resize_handler);$(window).bind('resize',this.resize_handler);this.target().unbind('mousewheel',this.target_mousweheel_handler);this.target().bind('mousewheel',this.target_mousewheel_handler);setTimeout(function(){self.update_scroller_dimensions(false);self.update_button_status();self.auto_hide(false);},0);},bind_events:function(){$(window).resize(function(){});this.target().bind('mousewheel',function(event,delta){self.scroll(delta*self.wheel_step);});},show:function(animated){if(animated){this.$el.show().animate({'width':'48px'},500,'swing');}else{this.$el.show().css('width','48px');}
this.on_show(this);},hide:function(animated){var self=this;if(animated){this.$el.animate({'width':'0px'},500,'swing',function(){self.$el.hide();});}else{this.$el.hide().css('width','0px');}
this.on_hide(this);},scroller_dimensions:function(){var target=this.target()[0];var scroller_height=target.clientHeight/target.scrollHeight||0;var scroller_pos=this.scroll_target/target.scrollHeight||0;var button_up_height=this.$('.up-button')[0].offsetHeight||48;var button_down_height=this.$('.down-button')[0].offsetHeight||48;var bar_height=this.$el[0].offsetHeight||96;var scrollbar_height=bar_height-button_up_height-button_down_height;scroller_pos=scroller_pos*scrollbar_height+button_up_height;scroller_height=scroller_height*scrollbar_height;return{pos:Math.round(scroller_pos),height:Math.round(scroller_height),bar_pos:button_up_height,bar_height:scrollbar_height};},auto_hide:function(animated){var target=this.target()[0];if(target.clientHeight&&(target.clientHeight===target.scrollHeight)){this.hide(animated);}else{this.show(animated);}},get_scroll_step:function(){var target=this.target()[0];var step=target.clientHeight*this.scroll_step;var c=target.scrollHeight/step;var c=Math.max(1,Math.ceil(c));return target.scrollHeight/c;},update_scroller_dimensions:function(animated){var dim=this.scroller_dimensions();var target=this.target()[0];if(animated){this.$('.scroller').animate({'top':dim.pos+'px','height':dim.height+'px'},this.scroll_duration);}else{this.$('.scroller').css({'top':dim.pos+'px','height':dim.height+'px'});}
if(this.scroll_target+target.clientHeight>=target.scrollHeight){this.bottom=true;}else{this.bottom=false;}},update_button_status:function(){var target=this.target()[0];this.$('.up-button').removeClass('disabled');this.$('.down-button').removeClass('disabled');if(this.scroll_target===0){this.$('.up-button').addClass('disabled');}
if(this.scroll_target+target.clientHeight>=target.scrollHeight){this.$('.down-button').addClass('disabled');}},target:function(){if(this.target_widget){if(this.target_selector){return this.target_widget.$(this.target_selector);}else{return this.target_widget.$el;}}else if(this.target_selector){return $(this.target_selector);}else{return undefined;}},page_up:function(){return this.set_position(this.scroll_target-this.get_scroll_step(),true);},page_down:function(){return this.set_position(this.scroll_target+this.get_scroll_step(),true);},scroll:function(pixels){return this.set_position(this.scroll_target-pixels,false);},set_position:function(position,animated){var self=this;var target=this.target()[0];var bottom=target.scrollHeight-target.clientHeight;this.scroll_target=Math.max(0,Math.min(bottom,position));if(this.scroll_target===0){this.position='top';}else if(this.scroll_target==='bottom'){this.position='bottom';}else{this.position='center';}
if(animated){this.target().animate({'scrollTop':this.scroll_target},this.scroll_duration);this.update_button_status();this.update_scroller_dimensions(true);}else{this.target().scrollTop(this.scroll_target);this.update_scroller_dimensions(false);this.update_button_status();}
return this.scroll_target;},get_position:function(){return this.scroll_target;},is_at_bottom:function(){return this.bottom;}});};function openerp_pos_widgets(instance,module){var QWeb=instance.web.qweb;module.ImageCache=instance.web.Class.extend({init:function(options){options=options||{};this.max_size=options.max_size||500;this.cache={};this.access_time={};this.size=0;},get_image_uncached:function(url){var img=new Image();img.src=url;return img;},get_image:function(url){var cached=this.cache[url];if(cached){this.access_time[url]=(new Date()).getTime();return cached;}else{var img=new Image();img.src=url;while(this.size>=this.max_size){var oldestUrl=null;var oldestTime=(new Date()).getTime();for(var url in this.cache){var time=this.access_time[url];if(time<=oldestTime){oldestTime=time;oldestUrl=url;}}
if(oldestUrl){delete this.cache[oldestUrl];delete this.access_time[oldestUrl];}
this.size--;}
this.cache[url]=img;this.access_time[url]=(new Date()).getTime();this.size++;return img;}},});module.NumpadWidget=module.PosBaseWidget.extend({template:'NumpadWidget',init:function(parent,options){this._super(parent);this.state=new module.NumpadState();},start:function(){this.state.bind('change:mode',this.changedMode,this);this.changedMode();this.$el.find('button#numpad-backspace').click(_.bind(this.clickDeleteLastChar,this));this.$el.find('button#numpad-minus').click(_.bind(this.clickSwitchSign,this));this.$el.find('button.number-char').click(_.bind(this.clickAppendNewChar,this));this.$el.find('button.mode-button').click(_.bind(this.clickChangeMode,this));},clickDeleteLastChar:function(){return this.state.deleteLastChar();},clickSwitchSign:function(){return this.state.switchSign();},clickAppendNewChar:function(event){var newChar;newChar=event.currentTarget.innerText||event.currentTarget.textContent;return this.state.appendNewChar(newChar);},clickChangeMode:function(event){var newMode=event.currentTarget.attributes['data-mode'].nodeValue;return this.state.changeMode(newMode);},changedMode:function(){var mode=this.state.get('mode');$('.selected-mode').removeClass('selected-mode');$(_.str.sprintf('.mode-button[data-mode="%s"]',mode),this.$el).addClass('selected-mode');},});module.PaypadWidget=module.PosBaseWidget.extend({template:'PaypadWidget',renderElement:function(){var self=this;this._super();this.pos.get('cashRegisters').each(function(cashRegister){var button=new module.PaypadButtonWidget(self,{pos:self.pos,pos_widget:self.pos_widget,cashRegister:cashRegister,});button.appendTo(self.$el);});}});module.PaypadButtonWidget=module.PosBaseWidget.extend({template:'PaypadButtonWidget',init:function(parent,options){this._super(parent,options);this.cashRegister=options.cashRegister;},renderElement:function(){var self=this;this._super();this.$el.click(function(){if(self.pos.get('selectedOrder').get('screen')==='receipt'){console.warn('TODO should not get there...?');return;}
self.pos.get('selectedOrder').addPaymentLine(self.cashRegister);self.pos_widget.screen_selector.set_current_screen('payment');});},});module.OrderlineWidget=module.PosBaseWidget.extend({template:'OrderlineWidget',init:function(parent,options){this._super(parent,options);this.model=options.model;this.order=options.order;this.model.bind('change',_.bind(function(){this.refresh();},this));},click_handler:function(){this.order.selectLine(this.model);this.trigger('order_line_selected');},renderElement:function(){this._super();this.$el.click(_.bind(this.click_handler,this));if(this.model.is_selected()){this.$el.addClass('selected');}},refresh:function(){this.renderElement();this.trigger('order_line_refreshed');},});module.OrderWidget=module.PosBaseWidget.extend({template:'OrderWidget',init:function(parent,options){this._super(parent,options);this.display_mode=options.display_mode||'numpad';this.set_numpad_state(options.numpadState);this.pos.bind('change:selectedOrder',this.change_selected_order,this);this.bind_orderline_events();this.orderlinewidgets=[];},set_numpad_state:function(numpadState){if(this.numpadState){this.numpadState.unbind('set_value',this.set_value);}
this.numpadState=numpadState;if(this.numpadState){this.numpadState.bind('set_value',this.set_value,this);this.numpadState.reset();}},set_value:function(val){var order=this.pos.get('selectedOrder');if(order.get('orderLines').length!==0){var mode=this.numpadState.get('mode');if(mode==='quantity'){order.getSelectedLine().set_quantity(val);}else if(mode==='discount'){order.getSelectedLine().set_discount(val);}else if(mode==='price'){order.getSelectedLine().set_unit_price(val);}}else{this.pos.get('selectedOrder').destroy();}},change_selected_order:function(){this.currentOrderLines.unbind();this.bind_orderline_events();this.renderElement();},bind_orderline_events:function(){this.currentOrderLines=(this.pos.get('selectedOrder')).get('orderLines');this.currentOrderLines.bind('add',this.renderElement,this);this.currentOrderLines.bind('remove',this.renderElement,this);},update_numpad:function(){this.selected_line=this.pos.get('selectedOrder').getSelectedLine();if(this.numpadState)
this.numpadState.reset();},renderElement:function(){var self=this;this._super();if(this.scrollbar){this.scrollbar.destroy();}
for(var i=0,len=this.orderlinewidgets.length;i<len;i++){this.orderlinewidgets[i].destroy();}
this.orderlinewidgets=[];if(this.display_mode==='maximized'){$('.point-of-sale .order-container').css({'bottom':'0px'});}else if(this.display_mode==='actionbar'){$('.point-of-sale .order-container').css({'bottom':'105px'});}else if(this.display_mode!=='numpad'){console.error('ERROR: OrderWidget renderElement(): wrong display_mode:',this.display_mode);}
var $content=this.$('.orderlines');this.currentOrderLines.each(_.bind(function(orderLine){var line=new module.OrderlineWidget(this,{model:orderLine,order:this.pos.get('selectedOrder'),});line.on('order_line_selected',self,self.update_numpad);line.on('order_line_refreshed',self,self.update_summary);line.appendTo($content);self.orderlinewidgets.push(line);},this));this.update_numpad();this.update_summary();var position=this.scrollbar?this.scrollbar.get_position():0;var at_bottom=this.scrollbar?this.scrollbar.is_at_bottom():false;this.scrollbar=new module.ScrollbarWidget(this,{target_widget:this,target_selector:'.order-scroller',name:'order',track_bottom:true,on_show:function(){self.$('.order-scroller').css({'width':'89%'},100);},on_hide:function(){self.$('.order-scroller').css({'width':'100%'},100);},});this.scrollbar.replace(this.$('.placeholder-ScrollbarWidget'));this.scrollbar.set_position(position);if(at_bottom){this.scrollbar.set_position(Number.MAX_VALUE,false);}},update_summary:function(){var order=this.pos.get('selectedOrder');var total=order?order.getTotalTaxIncluded():0;var taxes=order?total-order.getTotalTaxExcluded():0;this.$('.summary .total > .value').html(this.format_currency(total));this.$('.summary .total .subentry .value').html(this.format_currency(taxes));},set_display_mode:function(mode){if(this.display_mode!==mode){this.display_mode=mode;this.renderElement();}},});module.ProductWidget=module.PosBaseWidget.extend({template:'ProductWidget',init:function(parent,options){this._super(parent,options);this.model=options.model;this.model.attributes.weight=options.weight;this.next_screen=options.next_screen;this.click_product_action=options.click_product_action;},renderElement:function(){this._super();this.$('img').replaceWith(this.pos_widget.image_cache.get_image(this.model.get_image_url()));var self=this;$("a",this.$el).click(function(e){if(self.click_product_action){self.click_product_action(self.model);}});},});module.PaymentlineWidget=module.PosBaseWidget.extend({template:'PaymentlineWidget',init:function(parent,options){this._super(parent,options);this.payment_line=options.payment_line;this.payment_line.bind('change',this.changedAmount,this);},changeAmount:function(event){var newAmount=event.currentTarget.value;var amount=parseFloat(newAmount);if(!isNaN(amount)){this.amount=amount;this.payment_line.set_amount(amount);}},changedAmount:function(){if(this.amount!==this.payment_line.get_amount()){this.renderElement();}},renderElement:function(){var self=this;this.name=this.payment_line.get_cashregister().get('journal_id')[1];this._super();this.$('input').keyup(function(event){self.changeAmount(event);});this.$('.delete-payment-line').click(function(){self.trigger('delete_payment_line',self);});},focus:function(){var val=this.$('input')[0].value;this.$('input')[0].focus();this.$('input')[0].value=val;this.$('input')[0].select();},});module.OrderButtonWidget=module.PosBaseWidget.extend({template:'OrderButtonWidget',init:function(parent,options){this._super(parent,options);var self=this;this.order=options.order;this.order.bind('destroy',function(){self.destroy();});this.order.bind('change',function(){self.renderElement();});this.pos.bind('change:selectedOrder',_.bind(function(pos){var selectedOrder;selectedOrder=pos.get('selectedOrder');if(this.order===selectedOrder){this.setButtonSelected();}},this));},renderElement:function(){this._super();this.$('button.select-order').off('click').click(_.bind(this.selectOrder,this));this.$('button.close-order').off('click').click(_.bind(this.closeOrder,this));},selectOrder:function(event){this.pos.set({selectedOrder:this.order});},setButtonSelected:function(){$('.selected-order').removeClass('selected-order');this.$el.addClass('selected-order');},closeOrder:function(event){this.order.destroy();},});module.ActionButtonWidget=instance.web.Widget.extend({template:'ActionButtonWidget',icon_template:'ActionButtonWidgetWithIcon',init:function(parent,options){this._super(parent,options);this.label=options.label||'button';this.rightalign=options.rightalign||false;this.click_action=options.click;this.disabled=options.disabled||false;if(options.icon){this.icon=options.icon;this.template=this.icon_template;}},set_disabled:function(disabled){if(this.disabled!=disabled){this.disabled=!!disabled;this.renderElement();}},renderElement:function(){this._super();if(this.click_action&&!this.disabled){this.$el.click(_.bind(this.click_action,this));}},});module.ActionBarWidget=instance.web.Widget.extend({template:'ActionBarWidget',init:function(parent,options){this._super(parent,options);this.button_list=[];this.buttons={};this.visibility={};},set_element_visible:function(element,visible,action){if(visible!=this.visibility[element]){this.visibility[element]=!!visible;if(visible){this.$('.'+element).show();}else{this.$('.'+element).hide();}}
if(visible&&action){this.action[element]=action;this.$('.'+element).off('click').click(action);}},set_button_disabled:function(name,disabled){var b=this.buttons[name];if(b){b.set_disabled(disabled);}},destroy_buttons:function(){for(var i=0;i<this.button_list.length;i++){this.button_list[i].destroy();}
this.button_list=[];this.buttons={};return this;},get_button_count:function(){return this.button_list.length;},add_new_button:function(button_options){var button=new module.ActionButtonWidget(this,button_options);this.button_list.push(button);if(button_options.name){this.buttons[button_options.name]=button;}
button.appendTo(this.$('.pos-actionbar-button-list'));return button;},show:function(){this.$el.show();},hide:function(){this.$el.hide();},});module.CategoryButton=module.PosBaseWidget.extend({});module.ProductCategoriesWidget=module.PosBaseWidget.extend({template:'ProductCategoriesWidget',init:function(parent,options){var self=this;this._super(parent,options);this.product_type=options.product_type||'all';this.onlyWeightable=options.onlyWeightable||false;this.category=this.pos.root_category;this.breadcrumb=[];this.subcategories=[];this.set_category();},set_category:function(category){var db=this.pos.db;if(!category){this.category=db.get_category_by_id(db.root_category_id);}else{this.category=category;}
this.breadcrumb=[];var ancestors_ids=db.get_category_ancestors_ids(this.category.id);for(var i=1;i<ancestors_ids.length;i++){this.breadcrumb.push(db.get_category_by_id(ancestors_ids[i]));}
if(this.category.id!==db.root_category_id){this.breadcrumb.push(this.category);}
this.subcategories=db.get_category_by_id(db.get_category_childs_ids(this.category.id));},get_image_url:function(category){return instance.session.url('/web/binary/image',{model:'pos.category',field:'image',id:category.id});},renderElement:function(){var self=this;this._super();var hasimages=false;_.each(this.subcategories,function(category){if(category.image){hasimages=true;}});_.each(this.subcategories,function(category){if(hasimages){var button=QWeb.render('CategoryButton',{category:category});var button=_.str.trim(button);var button=$(button);button.find('img').replaceWith(self.pos_widget.image_cache.get_image(self.get_image_url(category)));}else{var button=QWeb.render('CategorySimpleButton',{category:category});button=_.str.trim(button);var button=$(button);}
button.appendTo(this.$('.category-list')).click(function(event){var id=category.id;var cat=self.pos.db.get_category_by_id(id);self.set_category(cat);self.renderElement();self.search_and_categories(cat);});});this.$(".oe-pos-categories-list a").click(function(event){var id=$(event.target).data("category-id");var category=self.pos.db.get_category_by_id(id);self.set_category(category);self.renderElement();self.search_and_categories(category);});this.search_and_categories();},set_product_type:function(type){this.product_type=type;this.reset_category();},reset_category:function(){this.set_category();this.renderElement();this.search_and_categories();},search_and_categories:function(category){var self=this;var products=this.pos.db.get_product_by_category(this.category.id);self.pos.get('products').reset(products);this.$('.searchbox input').keyup(function(){query=$(this).val().toLowerCase();if(query){var products=self.pos.db.search_product_in_category(self.category.id,query);self.pos.get('products').reset(products);self.$('.search-clear').fadeIn();}else{var products=self.pos.db.get_product_by_category(self.category.id);self.pos.get('products').reset(products);self.$('.search-clear').fadeOut();}});this.$('.searchbox input').click(function(){});this.$('.search-clear').click(function(){var products=self.pos.db.get_product_by_category(self.category.id);self.pos.get('products').reset(products);self.$('.searchbox input').val('').focus();self.$('.search-clear').fadeOut();});},});module.ProductListWidget=module.ScreenWidget.extend({template:'ProductListWidget',init:function(parent,options){var self=this;this._super(parent,options);this.model=options.model;this.productwidgets=[];this.weight=options.weight||0;this.show_scale=options.show_scale||false;this.next_screen=options.next_screen||false;this.click_product_action=options.click_product_action;this.pos.get('products').bind('reset',function(){self.renderElement();});},renderElement:function(){var self=this;this._super();for(var i=0,len=this.productwidgets.length;i<len;i++){this.productwidgets[i].destroy();}
this.productwidgets=[];if(this.scrollbar){this.scrollbar.destroy();}
var products=this.pos.get('products').models||[];for(var i=0,len=products.length;i<len;i++){var product=new module.ProductWidget(self,{model:products[i],click_product_action:this.click_product_action,});this.productwidgets.push(product);product.appendTo(this.$('.product-list'));}
this.scrollbar=new module.ScrollbarWidget(this,{target_widget:this,target_selector:'.product-list-scroller',on_show:function(){self.$('.product-list-scroller').css({'padding-right':'62px'},100);},on_hide:function(){self.$('.product-list-scroller').css({'padding-right':'0px'},100);},});this.scrollbar.replace(this.$('.placeholder-ScrollbarWidget'));},});module.UsernameWidget=module.PosBaseWidget.extend({template:'UsernameWidget',init:function(parent,options){var options=options||{};this._super(parent,options);this.mode=options.mode||'cashier';},set_user_mode:function(mode){this.mode=mode;this.refresh();},refresh:function(){this.renderElement();},get_name:function(){var user;if(this.mode==='cashier'){user=this.pos.get('cashier')||this.pos.get('user');}else{user=this.pos.get('selectedOrder').get_client()||this.pos.get('user');}
if(user){return user.name;}else{return"";}},});module.HeaderButtonWidget=module.PosBaseWidget.extend({template:'HeaderButtonWidget',init:function(parent,options){options=options||{};this._super(parent,options);this.action=options.action;this.label=options.label;},renderElement:function(){var self=this;this._super();if(this.action){this.$el.click(function(){self.action();});}},show:function(){this.$el.show();},hide:function(){this.$el.hide();},});module.DebugWidget=module.PosBaseWidget.extend({template:"DebugWidget",eans:{admin_badge:'0410100000006',client_badge:'0420200000004',invalid_ean:'1232456',soda_33cl:'5449000000996',oranges_kg:'2100002031410',lemon_price:'2301000001560',unknown_product:'9900000000004',},events:['scan_item_success','scan_item_error_unrecognized','payment_request','open_cashbox','print_receipt','print_pdf_invoice','weighting_read_kg','payment_status',],minimized:false,start:function(){var self=this;this.$el.draggable();this.$('.toggle').click(function(){var content=self.$('.content');var bg=self.$el;if(!self.minimized){content.animate({'height':'0'},200);}else{content.css({'height':'auto'});}
self.minimized=!self.minimized;});this.$('.button.accept_payment').click(function(){self.pos.proxy.debug_accept_payment();});this.$('.button.reject_payment').click(function(){self.pos.proxy.debug_reject_payment();});this.$('.button.set_weight').click(function(){var kg=Number(self.$('input.weight').val());if(!isNaN(kg)){self.pos.proxy.debug_set_weight(kg);}});this.$('.button.reset_weight').click(function(){self.pos.proxy.debug_reset_weight();});this.$('.button.custom_ean').click(function(){var ean=self.pos.barcode_reader.sanitize_ean(self.$('input.ean').val()||'0');self.$('input.ean').val(ean);self.pos.barcode_reader.on_ean(ean);});_.each(this.eans,function(ean,name){self.$('.button.'+name).click(function(){self.$('input.ean').val(ean);self.pos.barcode_reader.on_ean(ean);});});_.each(this.events,function(name){self.pos.proxy.add_notification(name,function(){self.$('.event.'+name).stop().clearQueue().css({'background-color':'#6CD11D'});self.$('.event.'+name).animate({'background-color':'#1E1E1E'},2000);});});self.pos.proxy.add_notification('help_needed',function(){self.$('.status.help_needed').addClass('on');});self.pos.proxy.add_notification('help_canceled',function(){self.$('.status.help_needed').removeClass('on');});self.pos.proxy.add_notification('transaction_start',function(){self.$('.status.transaction').addClass('on');});self.pos.proxy.add_notification('transaction_end',function(){self.$('.status.transaction').removeClass('on');});self.pos.proxy.add_notification('weighting_start',function(){self.$('.status.weighting').addClass('on');});self.pos.proxy.add_notification('weighting_end',function(){self.$('.status.weighting').removeClass('on');});},});module.SynchNotificationWidget=module.PosBaseWidget.extend({template:"SynchNotificationWidget",init:function(parent,options){options=options||{};this._super(parent,options);},renderElement:function(){var self=this;this._super();this.$('.oe_pos_synch-notification-button').click(function(){self.pos.flush();});},start:function(){var self=this;this.pos.bind('change:nbr_pending_operations',function(){self.renderElement();});},get_nbr_pending:function(){return this.pos.get('nbr_pending_operations');},});module.PosWidget=module.PosBaseWidget.extend({template:'PosWidget',init:function(){this._super(arguments[0],{});instance.web.blockUI();this.pos=new module.PosModel(this.session);this.pos_widget=this;this.numpad_visible=true;this.left_action_bar_visible=true;this.leftpane_visible=true;this.leftpane_width='440px';this.cashier_controls_visible=true;this.image_cache=new module.ImageCache();},start:function(){var self=this;return self.pos.ready.done(function(){self.build_currency_template();self.renderElement();self.$('.neworder-button').click(function(){self.pos.add_new_order();});self.pos.get('orders').bind('add',function(new_order){var new_order_button=new module.OrderButtonWidget(null,{order:new_order,pos:self.pos});new_order_button.appendTo($('#orders'));new_order_button.selectOrder();},self);self.pos.get('orders').add(new module.Order({pos:self.pos}));self.build_widgets();self.screen_selector.set_default_screen();window.screen_selector=self.screen_selector;self.pos.barcode_reader.connect();instance.webclient.set_content_full_screen(true);if(!self.pos.get('pos_session')){self.screen_selector.show_popup('error','Sorry, we could not create a user session');}else if(!self.pos.get('pos_config')){self.screen_selector.show_popup('error','Sorry, we could not find any PoS Configuration for this session');}
instance.web.unblockUI();self.$('.loader').animate({opacity:0},1500,'swing',function(){self.$('.loader').hide();});}).fail(function(){instance.web.unblockUI();return new instance.web.Model("ir.model.data").get_func("search_read")([['name','=','action_pos_session_opening']],['res_id']).pipe(_.bind(function(res){return instance.session.rpc('/web/action/load',{'action_id':res[0]['res_id']}).pipe(_.bind(function(result){var action=result.result;this.do_action(action);},this));},self));});},build_widgets:function(){var self=this;this.product_screen=new module.ProductScreenWidget(this,{});this.product_screen.appendTo($('#rightpane'));this.receipt_screen=new module.ReceiptScreenWidget(this,{});this.receipt_screen.appendTo($('#rightpane'));this.payment_screen=new module.PaymentScreenWidget(this,{});this.payment_screen.appendTo($('#rightpane'));this.welcome_screen=new module.WelcomeScreenWidget(this,{});this.welcome_screen.appendTo($('#rightpane'));this.client_payment_screen=new module.ClientPaymentScreenWidget(this,{});this.client_payment_screen.appendTo($('#rightpane'));this.scale_invite_screen=new module.ScaleInviteScreenWidget(this,{});this.scale_invite_screen.appendTo($('#rightpane'));this.scale_screen=new module.ScaleScreenWidget(this,{});this.scale_screen.appendTo($('#rightpane'));this.help_popup=new module.HelpPopupWidget(this,{});this.help_popup.appendTo($('.point-of-sale'));this.error_popup=new module.ErrorPopupWidget(this,{});this.error_popup.appendTo($('.point-of-sale'));this.error_product_popup=new module.ProductErrorPopupWidget(this,{});this.error_product_popup.appendTo($('.point-of-sale'));this.error_session_popup=new module.ErrorSessionPopupWidget(this,{});this.error_session_popup.appendTo($('.point-of-sale'));this.choose_receipt_popup=new module.ChooseReceiptPopupWidget(this,{});this.choose_receipt_popup.appendTo($('.point-of-sale'));this.error_negative_price_popup=new module.ErrorNegativePricePopupWidget(this,{});this.error_negative_price_popup.appendTo($('.point-of-sale'));this.notification=new module.SynchNotificationWidget(this,{});this.notification.appendTo(this.$('#rightheader'));this.username=new module.UsernameWidget(this,{});this.username.replace(this.$('.placeholder-UsernameWidget'));this.action_bar=new module.ActionBarWidget(this);this.action_bar.appendTo($(".point-of-sale #rightpane"));this.left_action_bar=new module.ActionBarWidget(this);this.left_action_bar.appendTo($(".point-of-sale #leftpane"));this.paypad=new module.PaypadWidget(this,{});this.paypad.replace($('#placeholder-PaypadWidget'));this.numpad=new module.NumpadWidget(this);this.numpad.replace($('#placeholder-NumpadWidget'));this.order_widget=new module.OrderWidget(this,{});this.order_widget.replace($('#placeholder-OrderWidget'));this.onscreen_keyboard=new module.OnscreenKeyboardWidget(this,{'keyboard_model':'simple'});this.onscreen_keyboard.appendTo($(".point-of-sale #content"));this.close_button=new module.HeaderButtonWidget(this,{label:'Close',action:function(){self.try_close();},});this.close_button.appendTo(this.$('#rightheader'));this.client_button=new module.HeaderButtonWidget(this,{label:'Self-Checkout',action:function(){self.screen_selector.set_user_mode('client');},});this.client_button.appendTo(this.$('#rightheader'));this.screen_selector=new module.ScreenSelector({pos:this.pos,screen_set:{'products':this.product_screen,'payment':this.payment_screen,'client_payment':this.client_payment_screen,'scale_invite':this.scale_invite_screen,'scale':this.scale_screen,'receipt':this.receipt_screen,'welcome':this.welcome_screen,},popup_set:{'help':this.help_popup,'error':this.error_popup,'error-product':this.error_product_popup,'error-session':this.error_session_popup,'error-negative-price':this.error_negative_price_popup,'choose-receipt':this.choose_receipt_popup,},default_client_screen:'welcome',default_cashier_screen:'products',default_mode:this.pos.iface_self_checkout?'client':'cashier',});if(this.pos.debug){this.debug_widget=new module.DebugWidget(this);this.debug_widget.appendTo(this.$('#content'));}},changed_pending_operations:function(){var self=this;this.synch_notification.on_change_nbr_pending(self.pos.get('nbr_pending_operations').length);},set_numpad_visible:function(visible){if(visible!==this.numpad_visible){this.numpad_visible=visible;if(visible){this.set_left_action_bar_visible(false);this.numpad.show();this.paypad.show();this.order_widget.set_display_mode('numpad');}else{this.numpad.hide();this.paypad.hide();if(this.order_widget.display_mode==='numpad'){this.order_widget.set_display_mode('maximized');}}}},set_left_action_bar_visible:function(visible){if(visible!==this.left_action_bar_visible){this.left_action_bar_visible=visible;if(visible){this.set_numpad_visible(false);this.left_action_bar.show();this.order_widget.set_display_mode('actionbar');}else{this.left_action_bar.hide();if(this.order_widget.display_mode==='actionbar'){this.order_widget.set_display_mode('maximized');}}}},set_leftpane_visible:function(visible){if(visible!==this.leftpane_visible){this.leftpane_visible=visible;if(visible){$('#leftpane').show().animate({'width':this.leftpane_width},500,'swing');$('#rightpane').animate({'left':this.leftpane_width},500,'swing');}else{var leftpane=$('#leftpane');$('#leftpane').animate({'width':'0px'},500,'swing',function(){leftpane.hide();});$('#rightpane').animate({'left':'0px'},500,'swing');}}},set_cashier_controls_visible:function(visible){if(visible!==this.cashier_controls_visible){this.cashier_controls_visible=visible;if(visible){$('#loggedas').show();$('#rightheader').show();}else{$('#loggedas').hide();$('#rightheader').hide();}}},try_close:function(){var self=this;self.pos.flush()
self.close();},close:function(){var self=this;this.pos.barcode_reader.disconnect();return new instance.web.Model("ir.model.data").get_func("search_read")([['name','=','action_client_pos_menu']],['res_id']).pipe(_.bind(function(res){return this.rpc('/web/action/load',{'action_id':res[0]['res_id']}).pipe(_.bind(function(result){var action=result;action.context=_.extend(action.context||{},{'cancel_action':{type:'ir.actions.client',tag:'reload'}});this.do_action(action);},this));},this));},destroy:function(){instance.webclient.set_content_full_screen(false);self.pos=undefined;this._super();}});};function openerp_pos_devices(instance,module){module.ProxyDevice=instance.web.Class.extend({init:function(options){options=options||{};url=options.url||'http://localhost:8069';this.weight=0;this.weighting=false;this.paying=false;this.default_payment_status={status:'waiting',message:'',payment_method:undefined,receipt_client:undefined,receipt_shop:undefined,};this.custom_payment_status=this.default_payment_status;this.connection=new instance.web.JsonRPC();this.connection.setup(url);this.bypass_proxy=false;this.notifications={};},message:function(name,params){var ret=new $.Deferred();var callbacks=this.notifications[name]||[];for(var i=0;i<callbacks.length;i++){callbacks[i](params);}
this.connection.rpc('/pos/'+name,params||{}).done(function(result){ret.resolve(result);}).fail(function(error){ret.reject(error);});return ret;},add_notification:function(name,callback){if(!this.notifications[name]){this.notifications[name]=[];}
this.notifications[name].push(callback);},scan_item_success:function(ean){return this.message('scan_item_success',{ean:ean});},scan_item_error_unrecognized:function(ean){return this.message('scan_item_error_unrecognized',{ean:ean});},help_needed:function(){return this.message('help_needed');},help_canceled:function(){return this.message('help_canceled');},weighting_start:function(){if(!this.weighting){this.weighting=true;if(!this.bypass_proxy){this.weight=0;return this.message('weighting_start');}}},weighting_read_kg:function(){var self=this;if(this.bypass_proxy){return this.weight;}else{this.message('weighting_read_kg',{}).done(function(weight){if(self.weighting&&!self.bypass_proxy){self.weight=weight;}});return this.weight;}},debug_set_weight:function(kg){this.bypass_proxy=true;this.weight=kg;},debug_reset_weight:function(){this.bypass_proxy=false;this.weight=0;},weighting_end:function(){if(!this.bypass_proxy){this.weight=0;this.weighting=false;this.message('weighting_end');}},payment_request:function(price){var ret=new $.Deferred();this.paying=true;this.custom_payment_status=this.default_payment_status;return this.message('payment_request',{'price':price});},payment_status:function(){if(this.bypass_proxy){this.bypass_proxy=false;return(new $.Deferred()).resolve(this.custom_payment_status);}else{return this.message('payment_status');}},debug_accept_payment:function(){this.bypass_proxy=true;this.custom_payment_status={status:'paid',message:'Successfull Payment, have a nice day',payment_method:'AMEX',receipt_client:'<xml>bla</xml>',receipt_shop:'<xml>bla</xml>',};},debug_reject_payment:function(){this.bypass_proxy=true;this.custom_payment_status={status:'error-rejected',message:'Sorry you don\'t have enough money :(',};},payment_cancel:function(){this.paying=false;this.custom_payment_status='waiting_for_payment';return this.message('payment_cancel');},transaction_start:function(){return this.message('transaction_start');},transaction_end:function(){return this.message('transaction_end');},cashier_mode_activated:function(){return this.message('cashier_mode_activated');},cashier_mode_deactivated:function(){return this.message('cashier_mode_deactivated');},open_cashbox:function(){return this.message('open_cashbox');},print_receipt:function(receipt){return this.message('print_receipt',{receipt:receipt});},print_pdf_invoice:function(pdfinvoice){return this.message('print_pdf_invoice',{pdfinvoice:pdfinvoice});},});module.BarcodeReader=instance.web.Class.extend({actions:['product','cashier','client','discount',],init:function(attributes){this.pos=attributes.pos;this.action_callback={};this.action_callback_stack=[];this.weight_prefix_set=attributes.weight_prefix_set||{'21':''};this.discount_prefix_set=attributes.discount_prefix_set||{'22':''};this.price_prefix_set=attributes.price_prefix_set||{'23':''};this.cashier_prefix_set=attributes.cashier_prefix_set||{'041':''};this.client_prefix_set=attributes.client_prefix_set||{'042':''};},save_callbacks:function(){var callbacks={};for(name in this.action_callback){callbacks[name]=this.action_callback[name];}
this.action_callback_stack.push(callbacks);},restore_callbacks:function(){if(this.action_callback_stack.length){var callbacks=this.action_callback_stack.pop();this.action_callback=callbacks;}},set_action_callback:function(action,callback){if(arguments.length==2){this.action_callback[action]=callback;}else{var actions=arguments[0];for(action in actions){this.set_action_callback(action,actions[action]);}}},reset_action_callbacks:function(){for(action in this.action_callback){this.action_callback[action]=undefined;}},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2==0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},check_ean:function(ean){return this.ean_checksum(ean)===Number(ean[ean.length-1]);},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean=ean+'0';}
return ean.substr(0,12)+this.ean_checksum(ean);},parse_ean:function(ean){var parse_result={type:'unknown',prefix:'',ean:ean,base_ean:ean,id:'',value:0,unit:'none',};function match_prefix(prefix_set,type){for(prefix in prefix_set){if(ean.substring(0,prefix.length)===prefix){parse_result.prefix=prefix;parse_result.type=type;return true;}}
return false;}
if(!this.check_ean(ean)){parse_result.type='error';}else if(match_prefix(this.price_prefix_set,'price')){parse_result.id=ean.substring(0,7);parse_result.base_ean=this.sanitize_ean(ean.substring(0,7));parse_result.value=Number(ean.substring(7,12))/100.0;parse_result.unit='euro';}else if(match_prefix(this.weight_prefix_set,'weight')){parse_result.id=ean.substring(0,7);parse_result.value=Number(ean.substring(7,12))/1000.0;parse_result.base_ean=this.sanitize_ean(ean.substring(0,7));parse_result.unit='Kg';}else if(match_prefix(this.client_prefix_set,'client')){parse_result.id=ean.substring(0,7);parse_result.unit='Kg';}else if(match_prefix(this.cashier_prefix_set,'cashier')){parse_result.id=ean.substring(0,7);}else if(match_prefix(this.discount_prefix_set,'discount')){parse_result.id=ean.substring(0,7);parse_result.base_ean=this.sanitize_ean(ean.substring(0,7));parse_result.value=Number(ean.substring(7,12))/100.0;parse_result.unit='%';}else{parse_result.type='unit';parse_result.prefix='';parse_result.id=ean;}
return parse_result;},on_ean:function(ean){var parse_result=this.parse_ean(ean);if(parse_result.type==='error'){console.warn('WARNING: barcode checksum error:',parse_result);}else if(parse_result.type in{'unit':'','weight':'','price':''}){if(this.action_callback['product']){this.action_callback['product'](parse_result);}}else{if(this.action_callback[parse_result.type]){this.action_callback[parse_result.type](parse_result);}}},connect:function(){var self=this;var codeNumbers=[];var timeStamp=0;var lastTimeStamp=0;$('body').delegate('','keyup',function(e){if(e.keyCode>=48&&e.keyCode<58){if(codeNumbers.length===0){timeStamp=new Date().getTime();}else{if(lastTimeStamp+30<new Date().getTime()){codeNumbers=[];timeStamp=new Date().getTime();}}
codeNumbers.push(e.keyCode-48);lastTimeStamp=new Date().getTime();if(codeNumbers.length===13){self.on_ean(codeNumbers.join(''));codeNumbers=[];}}else{codeNumbers=[];}});},disconnect:function(){$('body').undelegate('','keyup')},});};function openerp_pos_screens(instance,module){var QWeb=instance.web.qweb;module.ScreenSelector=instance.web.Class.extend({init:function(options){this.pos=options.pos;this.screen_set=options.screen_set||{};this.popup_set=options.popup_set||{};this.default_client_screen=options.default_client_screen;this.default_cashier_screen=options.default_cashier_screen;this.current_popup=null;this.current_mode=options.default_mode||'client';this.current_screen=null;for(screen_name in this.screen_set){this.screen_set[screen_name].hide();}
for(popup_name in this.popup_set){this.popup_set[popup_name].hide();}
this.selected_order=this.pos.get('selectedOrder');this.selected_order.set_screen_data({client_screen:this.default_client_screen,cashier_screen:this.default_cashier_screen,});this.pos.bind('change:selectedOrder',this.load_saved_screen,this);},add_screen:function(screen_name,screen){screen.hide();this.screen_set[screen_name]=screen;return this;},show_popup:function(name){if(this.current_popup){this.close_popup();}
this.current_popup=this.popup_set[name];this.current_popup.show();},close_popup:function(){if(this.current_popup){this.current_popup.close();this.current_popup.hide();this.current_popup=null;}},load_saved_screen:function(){this.close_popup();var selectedOrder=this.pos.get('selectedOrder');if(this.current_mode==='client'){this.set_current_screen(selectedOrder.get_screen_data('client_screen')||this.default_client_screen,null,'refresh');}else if(this.current_mode==='cashier'){this.set_current_screen(selectedOrder.get_screen_data('cashier_screen')||this.default_cashier_screen,null,'refresh');}
this.selected_order=selectedOrder;},set_user_mode:function(user_mode){if(user_mode!==this.current_mode){this.close_popup();this.current_mode=user_mode;this.load_saved_screen();}},get_user_mode:function(){return this.current_mode;},set_current_screen:function(screen_name,params,refresh){var screen=this.screen_set[screen_name];if(!screen){console.error("ERROR: set_current_screen("+screen_name+") : screen not found");}
this.close_popup();var selectedOrder=this.pos.get('selectedOrder');if(this.current_mode==='client'){selectedOrder.set_screen_data('client_screen',screen_name);if(params){selectedOrder.set_screen_data('client_screen_params',params);}}else{selectedOrder.set_screen_data('cashier_screen',screen_name);if(params){selectedOrder.set_screen_data('cashier_screen_params',params);}}
if(screen&&(refresh||screen!==this.current_screen)){if(this.current_screen){this.current_screen.close();this.current_screen.hide();}
this.current_screen=screen;this.current_screen.show();}},get_current_screen_param:function(param){var selected_order=this.pos.get('selectedOrder');if(this.current_mode==='client'){var params=selected_order.get_screen_data('client_screen_params');}else{var params=selected_order.get_screen_data('cashier_screen_params');}
if(params){return params[param];}else{return undefined;}},set_default_screen:function(){this.set_current_screen(this.current_mode==='client'?this.default_client_screen:this.default_cashier_screen);},});module.ScreenWidget=module.PosBaseWidget.extend({show_numpad:true,show_leftpane:true,init:function(parent,options){this._super(parent,options);this.hidden=false;},help_button_action:function(){this.pos_widget.screen_selector.show_popup('help');},barcode_product_screen:'products',barcode_product_error_popup:'error-product',barcode_product_action:function(ean){var self=this;if(self.pos.scan_product(ean)){self.pos.proxy.scan_item_success(ean);if(self.barcode_product_screen){self.pos_widget.screen_selector.set_current_screen(self.barcode_product_screen);}}else{self.pos.proxy.scan_item_error_unrecognized(ean);if(self.barcode_product_error_popup&&self.pos_widget.screen_selector.get_user_mode()!=='cashier'){self.pos_widget.screen_selector.show_popup(self.barcode_product_error_popup);}}},barcode_cashier_action:function(ean){var users=this.pos.get('user_list');for(var i=0,len=users.length;i<len;i++){if(users[i].ean13===ean.ean){this.pos.set('cashier',users[i]);this.pos_widget.username.refresh();this.pos.proxy.cashier_mode_activated();this.pos_widget.screen_selector.set_user_mode('cashier');return true;}}
this.pos.proxy.scan_item_error_unrecognized(ean);return false;},barcode_client_action:function(ean){var partners=this.pos.get('partner_list');for(var i=0,len=partners.length;i<len;i++){if(partners[i].ean13===ean.ean){this.pos.get('selectedOrder').set_client(partners[i]);this.pos_widget.username.refresh();this.pos.proxy.scan_item_success(ean);return true;}}
this.pos.proxy.scan_item_error_unrecognized(ean);return false;},barcode_discount_action:function(ean){this.pos.proxy.scan_item_success(ean);var last_orderline=this.pos.get('selectedOrder').getLastOrderline();if(last_orderline){last_orderline.set_discount(ean.value)}},show_action_bar:function(){this.pos_widget.action_bar.show();this.$el.css({'bottom':'105px'});},hide_action_bar:function(){this.pos_widget.action_bar.hide();this.$el.css({'bottom':'0px'});},add_action_button:function(button_def){this.show_action_bar();return this.pos_widget.action_bar.add_new_button(button_def);},show:function(){var self=this;this.hidden=false;if(this.$el){this.$el.show();}
if(this.pos_widget.action_bar.get_button_count()>0){this.show_action_bar();}else{this.hide_action_bar();}
this.pos_widget.left_action_bar.add_new_button({label:'help',icon:'/point_of_sale/static/src/img/icons/png48/help.png',click:function(){self.help_button_action();},});var self=this;var cashier_mode=this.pos_widget.screen_selector.get_user_mode()==='cashier';this.pos_widget.set_numpad_visible(this.show_numpad&&cashier_mode);this.pos_widget.set_leftpane_visible(this.show_leftpane);this.pos_widget.set_left_action_bar_visible(this.show_leftpane&&!cashier_mode);this.pos_widget.set_cashier_controls_visible(cashier_mode);if(cashier_mode&&this.pos.iface_self_checkout){this.pos_widget.client_button.show();}else{this.pos_widget.client_button.hide();}
if(cashier_mode){this.pos_widget.close_button.show();}else{this.pos_widget.close_button.hide();}
this.pos_widget.username.set_user_mode(this.pos_widget.screen_selector.get_user_mode());this.pos.barcode_reader.set_action_callback({'cashier':self.barcode_cashier_action?function(ean){self.barcode_cashier_action(ean);}:undefined,'product':self.barcode_product_action?function(ean){self.barcode_product_action(ean);}:undefined,'client':self.barcode_client_action?function(ean){self.barcode_client_action(ean);}:undefined,'discount':self.barcode_discount_action?function(ean){self.barcode_discount_action(ean);}:undefined,});},close:function(){if(this.pos.barcode_reader){this.pos.barcode_reader.reset_action_callbacks();}
this.pos_widget.action_bar.destroy_buttons();this.pos_widget.left_action_bar.destroy_buttons();},hide:function(){this.hidden=true;if(this.$el){this.$el.hide();}},renderElement:function(){this._super();if(this.hidden){if(this.$el){this.$el.hide();}}},});module.PopUpWidget=module.PosBaseWidget.extend({show:function(){if(this.$el){this.$el.show();}},close:function(){},hide:function(){if(this.$el){this.$el.hide();}},});module.HelpPopupWidget=module.PopUpWidget.extend({template:'HelpPopupWidget',show:function(){this._super();this.pos.proxy.help_needed();var self=this;this.$el.find('.button').off('click').click(function(){self.pos_widget.screen_selector.close_popup();});},close:function(){this.pos.proxy.help_canceled();},});module.ChooseReceiptPopupWidget=module.PopUpWidget.extend({template:'ChooseReceiptPopupWidget',show:function(){this._super();this.renderElement();var self=this;var currentOrder=self.pos.get('selectedOrder');this.$('.button.receipt').off('click').click(function(){currentOrder.set_receipt_type('receipt');self.pos_widget.screen_selector.set_current_screen('products');});this.$('.button.invoice').off('click').click(function(){currentOrder.set_receipt_type('invoice');self.pos_widget.screen_selector.set_current_screen('products');});},get_client_name:function(){var client=this.pos.get('selectedOrder').get_client();if(client){return client.name;}else{return'';}},});module.ErrorPopupWidget=module.PopUpWidget.extend({template:'ErrorPopupWidget',show:function(){var self=this;this._super();this.pos.proxy.help_needed();this.pos.proxy.scan_item_error_unrecognized();this.pos.barcode_reader.save_callbacks();this.pos.barcode_reader.reset_action_callbacks();this.pos.barcode_reader.set_action_callback({'cashier':function(ean){clearInterval(this.intervalID);self.pos.proxy.cashier_mode_activated();self.pos_widget.screen_selector.set_user_mode('cashier');},});this.$('.footer .button').off('click').click(function(){self.pos_widget.screen_selector.close_popup();});},close:function(){this._super();this.pos.proxy.help_canceled();this.pos.barcode_reader.restore_callbacks();},});module.ProductErrorPopupWidget=module.ErrorPopupWidget.extend({template:'ProductErrorPopupWidget',});module.ErrorSessionPopupWidget=module.ErrorPopupWidget.extend({template:'ErrorSessionPopupWidget',});module.ErrorNegativePricePopupWidget=module.ErrorPopupWidget.extend({template:'ErrorNegativePricePopupWidget',});module.ScaleInviteScreenWidget=module.ScreenWidget.extend({template:'ScaleInviteScreenWidget',next_screen:'scale',previous_screen:'products',show:function(){this._super();var self=this;self.pos.proxy.weighting_start();this.intervalID=setInterval(function(){var weight=self.pos.proxy.weighting_read_kg();if(weight>0.001){clearInterval(this.intervalID);self.pos_widget.screen_selector.set_current_screen(self.next_screen);}},500);this.add_action_button({label:'back',icon:'/point_of_sale/static/src/img/icons/png48/go-previous.png',click:function(){clearInterval(this.intervalID);self.pos.proxy.weighting_end();self.pos_widget.screen_selector.set_current_screen(self.previous_screen);}});},close:function(){this._super();clearInterval(this.intervalID);this.pos.proxy.weighting_end();},});module.ScaleScreenWidget=module.ScreenWidget.extend({template:'ScaleScreenWidget',next_screen:'products',previous_screen:'products',show:function(){this._super();this.renderElement();var self=this;this.add_action_button({label:'back',icon:'/point_of_sale/static/src/img/icons/png48/go-previous.png',click:function(){self.pos_widget.screen_selector.set_current_screen(self.previous_screen);}});this.validate_button=this.add_action_button({label:'Validate',icon:'/point_of_sale/static/src/img/icons/png48/validate.png',click:function(){self.order_product();self.pos_widget.screen_selector.set_current_screen(self.next_screen);},});this.pos.proxy.weighting_start();this.intervalID=setInterval(function(){var weight=self.pos.proxy.weighting_read_kg();if(weight!=self.weight){self.weight=weight;self.renderElement();}},200);},renderElement:function(){var self=this;this._super();this.$('.product-picture').click(function(){self.order_product();self.pos_widget.screen_selector.set_current_screen(self.next_screen);});},get_product:function(){var ss=this.pos_widget.screen_selector;if(ss){return ss.get_current_screen_param('product');}else{return undefined;}},order_product:function(){var weight=this.pos.proxy.weighting_read_kg();this.pos.get('selectedOrder').addProduct(this.get_product(),{quantity:weight});},get_product_name:function(){var product=this.get_product();return(product?product.get('name'):undefined)||'Unnamed Product';},get_product_price:function(){var product=this.get_product();return(product?product.get('price'):0)||0;},get_product_weight:function(){return this.weight||0;},close:function(){this._super();clearInterval(this.intervalID);this.pos.proxy.weighting_end();},});module.JobQueue=function(){var queue=[];var running=false;var run=function(){if(queue.length>0){running=true;var job=queue.shift();setTimeout(function(){var def=job.fun();if(def){def.done(run);}else{run();}},job.delay||0);}else{running=false;}};this.schedule=function(fun,delay){queue.push({fun:fun,delay:delay});if(!running){run();}}
this.clear=function(){queue=[];};};module.ClientPaymentScreenWidget=module.ScreenWidget.extend({template:'ClientPaymentScreenWidget',next_screen:'welcome',previous_screen:'products',show:function(){this._super();var self=this;this.queue=new module.JobQueue();this.canceled=false;this.paid=false;this.start=function(){var def=new $.Deferred();self.pos.proxy.payment_request(self.pos.get('selectedOrder').getDueLeft()).done(function(ack){if(ack==='ok'){self.queue.schedule(self.update);}else if(ack.indexOf('error')===0){console.error('cannot make payment. TODO');}else{console.error('unknown payment request return value:',ack);}
def.resolve();});return def;};this.update=function(){var def=new $.Deferred();if(self.canceled){return def.resolve();}
self.pos.proxy.payment_status().done(function(status){if(status.status==='paid'){var currentOrder=self.pos.get('selectedOrder');var selfCheckoutRegisters=[];for(var i=0;i<self.pos.get('cashRegisters').models.length;i++){var cashregister=self.pos.get('cashRegisters').models[i];if(cashregister.self_checkout_payment_method){selfCheckoutRegisters.push(cashregister);}}
var cashregister=selfCheckoutRegisters[0]||self.pos.get('cashRegisters').models[0];currentOrder.addPaymentLine(cashregister);self.pos.push_order(currentOrder.exportAsJSON())
currentOrder.destroy();self.pos.proxy.transaction_end();self.pos_widget.screen_selector.set_current_screen(self.next_screen);self.paid=true;}else if(status.status.indexOf('error')===0){console.error('error in payment request. TODO');}else if(status.status==='waiting'){self.queue.schedule(self.update,200);}else{console.error('unknown status value:',status.status);}
def.resolve();});return def;}
this.cancel=function(){if(!self.paid&&!self.canceled){self.canceled=true;self.pos.proxy.payment_cancel();self.pos_widget.screen_selector.set_current_screen(self.previous_screen);self.queue.clear();}
return(new $.Deferred()).resolve();}
if(this.pos.get('selectedOrder').getDueLeft()<=0){this.pos_widget.screen_selector.show_popup('error-negative-price');}else{this.queue.schedule(this.start);}
this.add_action_button({label:'back',icon:'/point_of_sale/static/src/img/icons/png48/go-previous.png',click:function(){self.queue.schedule(self.cancel);}});},close:function(){if(this.queue){this.queue.schedule(this.cancel);}
this._super();},});module.WelcomeScreenWidget=module.ScreenWidget.extend({template:'WelcomeScreenWidget',next_screen:'products',show_numpad:false,show_leftpane:false,barcode_product_action:function(ean){this.pos.proxy.transaction_start();this._super(ean);},barcode_client_action:function(ean){this.pos.proxy.transaction_start();this._super(ean);$('.goodbye-message').hide();this.pos_widget.screen_selector.show_popup('choose-receipt');},show:function(){this._super();var self=this;this.add_action_button({label:'help',icon:'/point_of_sale/static/src/img/icons/png48/help.png',click:function(){$('.goodbye-message').css({opacity:1}).hide();self.help_button_action();},});$('.goodbye-message').css({opacity:1}).show();setTimeout(function(){$('.goodbye-message').animate({opacity:0},500,'swing',function(){$('.goodbye-message').hide();});},5000);},});module.ProductScreenWidget=module.ScreenWidget.extend({template:'ProductScreenWidget',scale_screen:'scale_invite',client_next_screen:'client_payment',show_numpad:true,show_leftpane:true,start:function(){var self=this;this.product_categories_widget=new module.ProductCategoriesWidget(this,{});this.product_categories_widget.replace($('.placeholder-ProductCategoriesWidget'));this.product_list_widget=new module.ProductListWidget(this,{click_product_action:function(product){if(product.get('to_weight')&&self.pos.iface_electronic_scale){self.pos_widget.screen_selector.set_current_screen(self.scale_screen,{product:product});}else{self.pos.get('selectedOrder').addProduct(product);}},});this.product_list_widget.replace($('.placeholder-ProductListWidget'));},show:function(){this._super();var self=this;this.product_categories_widget.reset_category();this.pos_widget.order_widget.set_numpad_state(this.pos_widget.numpad.state);if(this.pos.iface_vkeyboard){this.pos_widget.onscreen_keyboard.connect();}
if(this.pos_widget.screen_selector.current_mode==='client'){this.add_action_button({label:'pay',icon:'/point_of_sale/static/src/img/icons/png48/go-next.png',click:function(){self.pos_widget.screen_selector.set_current_screen(self.client_next_screen);}});}},close:function(){this._super();this.pos_widget.order_widget.set_numpad_state(null);this.pos_widget.payment_screen.set_numpad_state(null);},});module.ReceiptScreenWidget=module.ScreenWidget.extend({template:'ReceiptScreenWidget',show_numpad:true,show_leftpane:true,init:function(parent,options){this._super(parent,options);this.model=options.model;this.user=this.pos.get('user');this.company=this.pos.get('company');this.shop_obj=this.pos.get('shop');},renderElement:function(){this._super();this.pos.bind('change:selectedOrder',this.change_selected_order,this);this.change_selected_order();},show:function(){this._super();var self=this;this.add_action_button({label:'Print',icon:'/point_of_sale/static/src/img/icons/png48/printer.png',click:function(){self.print();},});this.add_action_button({label:'Next Order',icon:'/point_of_sale/static/src/img/icons/png48/go-next.png',click:function(){self.finishOrder();},});window.print();},print:function(){window.print();},finishOrder:function(){this.pos.get('selectedOrder').destroy();},change_selected_order:function(){if(this.currentOrderLines)
this.currentOrderLines.unbind();this.currentOrderLines=(this.pos.get('selectedOrder')).get('orderLines');this.currentOrderLines.bind('add',this.refresh,this);this.currentOrderLines.bind('change',this.refresh,this);this.currentOrderLines.bind('remove',this.refresh,this);if(this.currentPaymentLines)
this.currentPaymentLines.unbind();this.currentPaymentLines=(this.pos.get('selectedOrder')).get('paymentLines');this.currentPaymentLines.bind('all',this.refresh,this);this.refresh();},refresh:function(){this.currentOrder=this.pos.get('selectedOrder');$('.pos-receipt-container',this.$el).html(QWeb.render('PosTicket',{widget:this}));},});module.PaymentScreenWidget=module.ScreenWidget.extend({template:'PaymentScreenWidget',back_screen:'products',next_screen:'receipt',init:function(parent,options){this._super(parent,options);this.model=options.model;this.pos.bind('change:selectedOrder',this.change_selected_order,this);this.bindPaymentLineEvents();this.bind_orderline_events();this.paymentlinewidgets=[];this.focusedLine=null;},show:function(){this._super();var self=this;if(this.pos.iface_cashdrawer){this.pos.proxy.open_cashbox();}
this.set_numpad_state(this.pos_widget.numpad.state);this.back_button=this.add_action_button({label:'Back',icon:'/point_of_sale/static/src/img/icons/png48/go-previous.png',click:function(){self.pos_widget.screen_selector.set_current_screen(self.back_screen);},});this.validate_button=this.add_action_button({label:'Validate',name:'validation',icon:'/point_of_sale/static/src/img/icons/png48/validate.png',click:function(){self.validateCurrentOrder();},});this.updatePaymentSummary();this.line_refocus();},close:function(){this._super();this.pos_widget.order_widget.set_numpad_state(null);this.pos_widget.payment_screen.set_numpad_state(null);},back:function(){this.pos_widget.screen_selector.set_current_screen(self.back_screen);},validateCurrentOrder:function(){var currentOrder=this.pos.get('selectedOrder');this.pos.push_order(currentOrder.exportAsJSON())
if(this.pos.iface_print_via_proxy){this.pos.proxy.print_receipt(currentOrder.export_for_printing());this.pos.get('selectedOrder').destroy();}else{this.pos_widget.screen_selector.set_current_screen(this.next_screen);}},bindPaymentLineEvents:function(){this.currentPaymentLines=(this.pos.get('selectedOrder')).get('paymentLines');this.currentPaymentLines.bind('add',this.addPaymentLine,this);this.currentPaymentLines.bind('remove',this.renderElement,this);this.currentPaymentLines.bind('all',this.updatePaymentSummary,this);},bind_orderline_events:function(){this.currentOrderLines=(this.pos.get('selectedOrder')).get('orderLines');this.currentOrderLines.bind('all',this.updatePaymentSummary,this);},change_selected_order:function(){this.currentPaymentLines.unbind();this.bindPaymentLineEvents();this.currentOrderLines.unbind();this.bind_orderline_events();this.renderElement();},line_refocus:function(lineWidget){if(lineWidget){if(this.focusedLine!==lineWidget){this.focusedLine=lineWidget;}}
if(this.focusedLine){this.focusedLine.focus();}},addPaymentLine:function(newPaymentLine){var self=this;var l=new module.PaymentlineWidget(this,{payment_line:newPaymentLine,});l.on('delete_payment_line',self,function(r){self.deleteLine(r);});l.appendTo(this.$('#paymentlines'));this.paymentlinewidgets.push(l);if(this.numpadState){this.numpadState.resetValue();}
this.line_refocus(l);},renderElement:function(){this._super();this.$('#paymentlines').empty();for(var i=0,len=this.paymentlinewidgets.length;i<len;i++){this.paymentlinewidgets[i].destroy();}
this.paymentlinewidgets=[];this.currentPaymentLines.each(_.bind(function(paymentLine){this.addPaymentLine(paymentLine);},this));this.updatePaymentSummary();},deleteLine:function(lineWidget){this.currentPaymentLines.remove([lineWidget.payment_line]);lineWidget.destroy();},updatePaymentSummary:function(){var currentOrder=this.pos.get('selectedOrder');var paidTotal=currentOrder.getPaidTotal();var dueTotal=currentOrder.getTotalTaxIncluded();var remaining=dueTotal>paidTotal?dueTotal-paidTotal:0;var change=paidTotal>dueTotal?paidTotal-dueTotal:0;this.$('#payment-due-total').html(this.format_currency(dueTotal));this.$('#payment-paid-total').html(this.format_currency(paidTotal));this.$('#payment-remaining').html(this.format_currency(remaining));this.$('#payment-change').html(this.format_currency(change));if(currentOrder.selected_orderline===undefined){remaining=1;}
if(this.pos_widget.action_bar){this.pos_widget.action_bar.set_button_disabled('validation',remaining>0);}},set_numpad_state:function(numpadState){if(this.numpadState){this.numpadState.unbind('set_value',this.set_value);this.numpadState.unbind('change:mode',this.setNumpadMode);}
this.numpadState=numpadState;if(this.numpadState){this.numpadState.bind('set_value',this.set_value,this);this.numpadState.bind('change:mode',this.setNumpadMode,this);this.numpadState.reset();this.setNumpadMode();}},setNumpadMode:function(){this.numpadState.set({mode:'payment'});},set_value:function(val){this.currentPaymentLines.last().set_amount(val);},});};openerp.point_of_sale=function(instance){instance.point_of_sale={};var module=instance.point_of_sale;openerp_pos_db(instance,module);openerp_pos_models(instance,module);openerp_pos_basewidget(instance,module);openerp_pos_keyboard(instance,module);openerp_pos_scrollbar(instance,module);openerp_pos_screens(instance,module);openerp_pos_widgets(instance,module);openerp_pos_devices(instance,module);instance.web.client_actions.add('pos.ui','instance.point_of_sale.PosWidget');};